var WG=Object.defineProperty;var XG=(e,t,n)=>t in e?WG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var bo=(e,t,n)=>XG(e,typeof t!="symbol"?t+"":t,n);function ZG(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const u=Object.getOwnPropertyDescriptor(r,a);u&&Object.defineProperty(e,a,u.get?u:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();var $w=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var PT={exports:{}},m1={},AT={exports:{}},_i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uO;function YG(){if(uO)return _i;uO=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),p=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),R=Symbol.iterator;function z($e){return $e===null||typeof $e!="object"?null:($e=R&&$e[R]||$e["@@iterator"],typeof $e=="function"?$e:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,X={};function ue($e,Ke,gt){this.props=$e,this.context=Ke,this.refs=X,this.updater=gt||V}ue.prototype.isReactComponent={},ue.prototype.setState=function($e,Ke){if(typeof $e!="object"&&typeof $e!="function"&&$e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$e,Ke,"setState")},ue.prototype.forceUpdate=function($e){this.updater.enqueueForceUpdate(this,$e,"forceUpdate")};function ie(){}ie.prototype=ue.prototype;function K($e,Ke,gt){this.props=$e,this.context=Ke,this.refs=X,this.updater=gt||V}var ee=K.prototype=new ie;ee.constructor=K,W(ee,ue.prototype),ee.isPureReactComponent=!0;var ae=Array.isArray,he=Object.prototype.hasOwnProperty,xe={current:null},ye={key:!0,ref:!0,__self:!0,__source:!0};function Se($e,Ke,gt){var Yt,Kt={},nn=null,Ut=null;if(Ke!=null)for(Yt in Ke.ref!==void 0&&(Ut=Ke.ref),Ke.key!==void 0&&(nn=""+Ke.key),Ke)he.call(Ke,Yt)&&!ye.hasOwnProperty(Yt)&&(Kt[Yt]=Ke[Yt]);var wn=arguments.length-2;if(wn===1)Kt.children=gt;else if(1<wn){for(var Pn=Array(wn),we=0;we<wn;we++)Pn[we]=arguments[we+2];Kt.children=Pn}if($e&&$e.defaultProps)for(Yt in wn=$e.defaultProps,wn)Kt[Yt]===void 0&&(Kt[Yt]=wn[Yt]);return{$$typeof:e,type:$e,key:nn,ref:Ut,props:Kt,_owner:xe.current}}function je($e,Ke){return{$$typeof:e,type:$e.type,key:Ke,ref:$e.ref,props:$e.props,_owner:$e._owner}}function Re($e){return typeof $e=="object"&&$e!==null&&$e.$$typeof===e}function De($e){var Ke={"=":"=0",":":"=2"};return"$"+$e.replace(/[=:]/g,function(gt){return Ke[gt]})}var at=/\/+/g;function ot($e,Ke){return typeof $e=="object"&&$e!==null&&$e.key!=null?De(""+$e.key):Ke.toString(36)}function Fe($e,Ke,gt,Yt,Kt){var nn=typeof $e;(nn==="undefined"||nn==="boolean")&&($e=null);var Ut=!1;if($e===null)Ut=!0;else switch(nn){case"string":case"number":Ut=!0;break;case"object":switch($e.$$typeof){case e:case t:Ut=!0}}if(Ut)return Ut=$e,Kt=Kt(Ut),$e=Yt===""?"."+ot(Ut,0):Yt,ae(Kt)?(gt="",$e!=null&&(gt=$e.replace(at,"$&/")+"/"),Fe(Kt,Ke,gt,"",function(we){return we})):Kt!=null&&(Re(Kt)&&(Kt=je(Kt,gt+(!Kt.key||Ut&&Ut.key===Kt.key?"":(""+Kt.key).replace(at,"$&/")+"/")+$e)),Ke.push(Kt)),1;if(Ut=0,Yt=Yt===""?".":Yt+":",ae($e))for(var wn=0;wn<$e.length;wn++){nn=$e[wn];var Pn=Yt+ot(nn,wn);Ut+=Fe(nn,Ke,gt,Pn,Kt)}else if(Pn=z($e),typeof Pn=="function")for($e=Pn.call($e),wn=0;!(nn=$e.next()).done;)nn=nn.value,Pn=Yt+ot(nn,wn++),Ut+=Fe(nn,Ke,gt,Pn,Kt);else if(nn==="object")throw Ke=String($e),Error("Objects are not valid as a React child (found: "+(Ke==="[object Object]"?"object with keys {"+Object.keys($e).join(", ")+"}":Ke)+"). If you meant to render a collection of children, use an array instead.");return Ut}function Ze($e,Ke,gt){if($e==null)return $e;var Yt=[],Kt=0;return Fe($e,Yt,"","",function(nn){return Ke.call(gt,nn,Kt++)}),Yt}function Ve($e){if($e._status===-1){var Ke=$e._result;Ke=Ke(),Ke.then(function(gt){($e._status===0||$e._status===-1)&&($e._status=1,$e._result=gt)},function(gt){($e._status===0||$e._status===-1)&&($e._status=2,$e._result=gt)}),$e._status===-1&&($e._status=0,$e._result=Ke)}if($e._status===1)return $e._result.default;throw $e._result}var mt={current:null},We={transition:null},tt={ReactCurrentDispatcher:mt,ReactCurrentBatchConfig:We,ReactCurrentOwner:xe};function Dt(){throw Error("act(...) is not supported in production builds of React.")}return _i.Children={map:Ze,forEach:function($e,Ke,gt){Ze($e,function(){Ke.apply(this,arguments)},gt)},count:function($e){var Ke=0;return Ze($e,function(){Ke++}),Ke},toArray:function($e){return Ze($e,function(Ke){return Ke})||[]},only:function($e){if(!Re($e))throw Error("React.Children.only expected to receive a single React element child.");return $e}},_i.Component=ue,_i.Fragment=n,_i.Profiler=a,_i.PureComponent=K,_i.StrictMode=r,_i.Suspense=b,_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tt,_i.act=Dt,_i.cloneElement=function($e,Ke,gt){if($e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$e+".");var Yt=W({},$e.props),Kt=$e.key,nn=$e.ref,Ut=$e._owner;if(Ke!=null){if(Ke.ref!==void 0&&(nn=Ke.ref,Ut=xe.current),Ke.key!==void 0&&(Kt=""+Ke.key),$e.type&&$e.type.defaultProps)var wn=$e.type.defaultProps;for(Pn in Ke)he.call(Ke,Pn)&&!ye.hasOwnProperty(Pn)&&(Yt[Pn]=Ke[Pn]===void 0&&wn!==void 0?wn[Pn]:Ke[Pn])}var Pn=arguments.length-2;if(Pn===1)Yt.children=gt;else if(1<Pn){wn=Array(Pn);for(var we=0;we<Pn;we++)wn[we]=arguments[we+2];Yt.children=wn}return{$$typeof:e,type:$e.type,key:Kt,ref:nn,props:Yt,_owner:Ut}},_i.createContext=function($e){return $e={$$typeof:p,_currentValue:$e,_currentValue2:$e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$e.Provider={$$typeof:u,_context:$e},$e.Consumer=$e},_i.createElement=Se,_i.createFactory=function($e){var Ke=Se.bind(null,$e);return Ke.type=$e,Ke},_i.createRef=function(){return{current:null}},_i.forwardRef=function($e){return{$$typeof:i,render:$e}},_i.isValidElement=Re,_i.lazy=function($e){return{$$typeof:A,_payload:{_status:-1,_result:$e},_init:Ve}},_i.memo=function($e,Ke){return{$$typeof:C,type:$e,compare:Ke===void 0?null:Ke}},_i.startTransition=function($e){var Ke=We.transition;We.transition={};try{$e()}finally{We.transition=Ke}},_i.unstable_act=Dt,_i.useCallback=function($e,Ke){return mt.current.useCallback($e,Ke)},_i.useContext=function($e){return mt.current.useContext($e)},_i.useDebugValue=function(){},_i.useDeferredValue=function($e){return mt.current.useDeferredValue($e)},_i.useEffect=function($e,Ke){return mt.current.useEffect($e,Ke)},_i.useId=function(){return mt.current.useId()},_i.useImperativeHandle=function($e,Ke,gt){return mt.current.useImperativeHandle($e,Ke,gt)},_i.useInsertionEffect=function($e,Ke){return mt.current.useInsertionEffect($e,Ke)},_i.useLayoutEffect=function($e,Ke){return mt.current.useLayoutEffect($e,Ke)},_i.useMemo=function($e,Ke){return mt.current.useMemo($e,Ke)},_i.useReducer=function($e,Ke,gt){return mt.current.useReducer($e,Ke,gt)},_i.useRef=function($e){return mt.current.useRef($e)},_i.useState=function($e){return mt.current.useState($e)},_i.useSyncExternalStore=function($e,Ke,gt){return mt.current.useSyncExternalStore($e,Ke,gt)},_i.useTransition=function(){return mt.current.useTransition()},_i.version="18.3.1",_i}var cO;function Z2(){return cO||(cO=1,AT.exports=YG()),AT.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hO;function KG(){if(hO)return m1;hO=1;var e=Z2(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function p(i,b,C){var A,R={},z=null,V=null;C!==void 0&&(z=""+C),b.key!==void 0&&(z=""+b.key),b.ref!==void 0&&(V=b.ref);for(A in b)r.call(b,A)&&!u.hasOwnProperty(A)&&(R[A]=b[A]);if(i&&i.defaultProps)for(A in b=i.defaultProps,b)R[A]===void 0&&(R[A]=b[A]);return{$$typeof:t,type:i,key:z,ref:V,props:R,_owner:a.current}}return m1.Fragment=n,m1.jsx=p,m1.jsxs=p,m1}var dO;function JG(){return dO||(dO=1,PT.exports=KG()),PT.exports}var G=JG(),Y=Z2();const Zt=dd(Y),Dk=ZG({__proto__:null,default:Zt},[Y]);var qw={},RT={exports:{}},tc={},LT={exports:{}},OT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fO;function QG(){return fO||(fO=1,function(e){function t(We,tt){var Dt=We.length;We.push(tt);e:for(;0<Dt;){var $e=Dt-1>>>1,Ke=We[$e];if(0<a(Ke,tt))We[$e]=tt,We[Dt]=Ke,Dt=$e;else break e}}function n(We){return We.length===0?null:We[0]}function r(We){if(We.length===0)return null;var tt=We[0],Dt=We.pop();if(Dt!==tt){We[0]=Dt;e:for(var $e=0,Ke=We.length,gt=Ke>>>1;$e<gt;){var Yt=2*($e+1)-1,Kt=We[Yt],nn=Yt+1,Ut=We[nn];if(0>a(Kt,Dt))nn<Ke&&0>a(Ut,Kt)?(We[$e]=Ut,We[nn]=Dt,$e=nn):(We[$e]=Kt,We[Yt]=Dt,$e=Yt);else if(nn<Ke&&0>a(Ut,Dt))We[$e]=Ut,We[nn]=Dt,$e=nn;else break e}}return tt}function a(We,tt){var Dt=We.sortIndex-tt.sortIndex;return Dt!==0?Dt:We.id-tt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var p=Date,i=p.now();e.unstable_now=function(){return p.now()-i}}var b=[],C=[],A=1,R=null,z=3,V=!1,W=!1,X=!1,ue=typeof setTimeout=="function"?setTimeout:null,ie=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(We){for(var tt=n(C);tt!==null;){if(tt.callback===null)r(C);else if(tt.startTime<=We)r(C),tt.sortIndex=tt.expirationTime,t(b,tt);else break;tt=n(C)}}function ae(We){if(X=!1,ee(We),!W)if(n(b)!==null)W=!0,Ve(he);else{var tt=n(C);tt!==null&&mt(ae,tt.startTime-We)}}function he(We,tt){W=!1,X&&(X=!1,ie(Se),Se=-1),V=!0;var Dt=z;try{for(ee(tt),R=n(b);R!==null&&(!(R.expirationTime>tt)||We&&!De());){var $e=R.callback;if(typeof $e=="function"){R.callback=null,z=R.priorityLevel;var Ke=$e(R.expirationTime<=tt);tt=e.unstable_now(),typeof Ke=="function"?R.callback=Ke:R===n(b)&&r(b),ee(tt)}else r(b);R=n(b)}if(R!==null)var gt=!0;else{var Yt=n(C);Yt!==null&&mt(ae,Yt.startTime-tt),gt=!1}return gt}finally{R=null,z=Dt,V=!1}}var xe=!1,ye=null,Se=-1,je=5,Re=-1;function De(){return!(e.unstable_now()-Re<je)}function at(){if(ye!==null){var We=e.unstable_now();Re=We;var tt=!0;try{tt=ye(!0,We)}finally{tt?ot():(xe=!1,ye=null)}}else xe=!1}var ot;if(typeof K=="function")ot=function(){K(at)};else if(typeof MessageChannel<"u"){var Fe=new MessageChannel,Ze=Fe.port2;Fe.port1.onmessage=at,ot=function(){Ze.postMessage(null)}}else ot=function(){ue(at,0)};function Ve(We){ye=We,xe||(xe=!0,ot())}function mt(We,tt){Se=ue(function(){We(e.unstable_now())},tt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(We){We.callback=null},e.unstable_continueExecution=function(){W||V||(W=!0,Ve(he))},e.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<We?Math.floor(1e3/We):5},e.unstable_getCurrentPriorityLevel=function(){return z},e.unstable_getFirstCallbackNode=function(){return n(b)},e.unstable_next=function(We){switch(z){case 1:case 2:case 3:var tt=3;break;default:tt=z}var Dt=z;z=tt;try{return We()}finally{z=Dt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(We,tt){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var Dt=z;z=We;try{return tt()}finally{z=Dt}},e.unstable_scheduleCallback=function(We,tt,Dt){var $e=e.unstable_now();switch(typeof Dt=="object"&&Dt!==null?(Dt=Dt.delay,Dt=typeof Dt=="number"&&0<Dt?$e+Dt:$e):Dt=$e,We){case 1:var Ke=-1;break;case 2:Ke=250;break;case 5:Ke=1073741823;break;case 4:Ke=1e4;break;default:Ke=5e3}return Ke=Dt+Ke,We={id:A++,callback:tt,priorityLevel:We,startTime:Dt,expirationTime:Ke,sortIndex:-1},Dt>$e?(We.sortIndex=Dt,t(C,We),n(b)===null&&We===n(C)&&(X?(ie(Se),Se=-1):X=!0,mt(ae,Dt-$e))):(We.sortIndex=Ke,t(b,We),W||V||(W=!0,Ve(he))),We},e.unstable_shouldYield=De,e.unstable_wrapCallback=function(We){var tt=z;return function(){var Dt=z;z=tt;try{return We.apply(this,arguments)}finally{z=Dt}}}}(OT)),OT}var pO;function e8(){return pO||(pO=1,LT.exports=QG()),LT.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mO;function t8(){if(mO)return tc;mO=1;var e=Z2(),t=e8();function n(v){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+v,F=1;F<arguments.length;F++)S+="&args[]="+encodeURIComponent(arguments[F]);return"Minified React error #"+v+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,a={};function u(v,S){p(v,S),p(v+"Capture",S)}function p(v,S){for(a[v]=S,v=0;v<S.length;v++)r.add(S[v])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),b=Object.prototype.hasOwnProperty,C=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},R={};function z(v){return b.call(R,v)?!0:b.call(A,v)?!1:C.test(v)?R[v]=!0:(A[v]=!0,!1)}function V(v,S,F,H){if(F!==null&&F.type===0)return!1;switch(typeof S){case"function":case"symbol":return!0;case"boolean":return H?!1:F!==null?!F.acceptsBooleans:(v=v.toLowerCase().slice(0,5),v!=="data-"&&v!=="aria-");default:return!1}}function W(v,S,F,H){if(S===null||typeof S>"u"||V(v,S,F,H))return!0;if(H)return!1;if(F!==null)switch(F.type){case 3:return!S;case 4:return S===!1;case 5:return isNaN(S);case 6:return isNaN(S)||1>S}return!1}function X(v,S,F,H,se,de,Le){this.acceptsBooleans=S===2||S===3||S===4,this.attributeName=H,this.attributeNamespace=se,this.mustUseProperty=F,this.propertyName=v,this.type=S,this.sanitizeURL=de,this.removeEmptyString=Le}var ue={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(v){ue[v]=new X(v,0,!1,v,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(v){var S=v[0];ue[S]=new X(S,1,!1,v[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(v){ue[v]=new X(v,2,!1,v.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(v){ue[v]=new X(v,2,!1,v,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(v){ue[v]=new X(v,3,!1,v.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(v){ue[v]=new X(v,3,!0,v,null,!1,!1)}),["capture","download"].forEach(function(v){ue[v]=new X(v,4,!1,v,null,!1,!1)}),["cols","rows","size","span"].forEach(function(v){ue[v]=new X(v,6,!1,v,null,!1,!1)}),["rowSpan","start"].forEach(function(v){ue[v]=new X(v,5,!1,v.toLowerCase(),null,!1,!1)});var ie=/[\-:]([a-z])/g;function K(v){return v[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(v){var S=v.replace(ie,K);ue[S]=new X(S,1,!1,v,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(v){var S=v.replace(ie,K);ue[S]=new X(S,1,!1,v,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(v){var S=v.replace(ie,K);ue[S]=new X(S,1,!1,v,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(v){ue[v]=new X(v,1,!1,v.toLowerCase(),null,!1,!1)}),ue.xlinkHref=new X("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(v){ue[v]=new X(v,1,!1,v.toLowerCase(),null,!0,!0)});function ee(v,S,F,H){var se=ue.hasOwnProperty(S)?ue[S]:null;(se!==null?se.type!==0:H||!(2<S.length)||S[0]!=="o"&&S[0]!=="O"||S[1]!=="n"&&S[1]!=="N")&&(W(S,F,se,H)&&(F=null),H||se===null?z(S)&&(F===null?v.removeAttribute(S):v.setAttribute(S,""+F)):se.mustUseProperty?v[se.propertyName]=F===null?se.type===3?!1:"":F:(S=se.attributeName,H=se.attributeNamespace,F===null?v.removeAttribute(S):(se=se.type,F=se===3||se===4&&F===!0?"":""+F,H?v.setAttributeNS(H,S,F):v.setAttribute(S,F))))}var ae=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,he=Symbol.for("react.element"),xe=Symbol.for("react.portal"),ye=Symbol.for("react.fragment"),Se=Symbol.for("react.strict_mode"),je=Symbol.for("react.profiler"),Re=Symbol.for("react.provider"),De=Symbol.for("react.context"),at=Symbol.for("react.forward_ref"),ot=Symbol.for("react.suspense"),Fe=Symbol.for("react.suspense_list"),Ze=Symbol.for("react.memo"),Ve=Symbol.for("react.lazy"),mt=Symbol.for("react.offscreen"),We=Symbol.iterator;function tt(v){return v===null||typeof v!="object"?null:(v=We&&v[We]||v["@@iterator"],typeof v=="function"?v:null)}var Dt=Object.assign,$e;function Ke(v){if($e===void 0)try{throw Error()}catch(F){var S=F.stack.trim().match(/\n( *(at )?)/);$e=S&&S[1]||""}return`
`+$e+v}var gt=!1;function Yt(v,S){if(!v||gt)return"";gt=!0;var F=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch($t){var H=$t}Reflect.construct(v,[],S)}else{try{S.call()}catch($t){H=$t}v.call(S.prototype)}else{try{throw Error()}catch($t){H=$t}v()}}catch($t){if($t&&H&&typeof $t.stack=="string"){for(var se=$t.stack.split(`
`),de=H.stack.split(`
`),Le=se.length-1,ht=de.length-1;1<=Le&&0<=ht&&se[Le]!==de[ht];)ht--;for(;1<=Le&&0<=ht;Le--,ht--)if(se[Le]!==de[ht]){if(Le!==1||ht!==1)do if(Le--,ht--,0>ht||se[Le]!==de[ht]){var yt=`
`+se[Le].replace(" at new "," at ");return v.displayName&&yt.includes("<anonymous>")&&(yt=yt.replace("<anonymous>",v.displayName)),yt}while(1<=Le&&0<=ht);break}}}finally{gt=!1,Error.prepareStackTrace=F}return(v=v?v.displayName||v.name:"")?Ke(v):""}function Kt(v){switch(v.tag){case 5:return Ke(v.type);case 16:return Ke("Lazy");case 13:return Ke("Suspense");case 19:return Ke("SuspenseList");case 0:case 2:case 15:return v=Yt(v.type,!1),v;case 11:return v=Yt(v.type.render,!1),v;case 1:return v=Yt(v.type,!0),v;default:return""}}function nn(v){if(v==null)return null;if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case ye:return"Fragment";case xe:return"Portal";case je:return"Profiler";case Se:return"StrictMode";case ot:return"Suspense";case Fe:return"SuspenseList"}if(typeof v=="object")switch(v.$$typeof){case De:return(v.displayName||"Context")+".Consumer";case Re:return(v._context.displayName||"Context")+".Provider";case at:var S=v.render;return v=v.displayName,v||(v=S.displayName||S.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case Ze:return S=v.displayName||null,S!==null?S:nn(v.type)||"Memo";case Ve:S=v._payload,v=v._init;try{return nn(v(S))}catch{}}return null}function Ut(v){var S=v.type;switch(v.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return v=S.render,v=v.displayName||v.name||"",S.displayName||(v!==""?"ForwardRef("+v+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nn(S);case 8:return S===Se?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function wn(v){switch(typeof v){case"boolean":case"number":case"string":case"undefined":return v;case"object":return v;default:return""}}function Pn(v){var S=v.type;return(v=v.nodeName)&&v.toLowerCase()==="input"&&(S==="checkbox"||S==="radio")}function we(v){var S=Pn(v)?"checked":"value",F=Object.getOwnPropertyDescriptor(v.constructor.prototype,S),H=""+v[S];if(!v.hasOwnProperty(S)&&typeof F<"u"&&typeof F.get=="function"&&typeof F.set=="function"){var se=F.get,de=F.set;return Object.defineProperty(v,S,{configurable:!0,get:function(){return se.call(this)},set:function(Le){H=""+Le,de.call(this,Le)}}),Object.defineProperty(v,S,{enumerable:F.enumerable}),{getValue:function(){return H},setValue:function(Le){H=""+Le},stopTracking:function(){v._valueTracker=null,delete v[S]}}}}function Rr(v){v._valueTracker||(v._valueTracker=we(v))}function Mr(v){if(!v)return!1;var S=v._valueTracker;if(!S)return!0;var F=S.getValue(),H="";return v&&(H=Pn(v)?v.checked?"true":"false":v.value),v=H,v!==F?(S.setValue(v),!0):!1}function yi(v){if(v=v||(typeof document<"u"?document:void 0),typeof v>"u")return null;try{return v.activeElement||v.body}catch{return v.body}}function Gt(v,S){var F=S.checked;return Dt({},S,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:F??v._wrapperState.initialChecked})}function Io(v,S){var F=S.defaultValue==null?"":S.defaultValue,H=S.checked!=null?S.checked:S.defaultChecked;F=wn(S.value!=null?S.value:F),v._wrapperState={initialChecked:H,initialValue:F,controlled:S.type==="checkbox"||S.type==="radio"?S.checked!=null:S.value!=null}}function qi(v,S){S=S.checked,S!=null&&ee(v,"checked",S,!1)}function Ji(v,S){qi(v,S);var F=wn(S.value),H=S.type;if(F!=null)H==="number"?(F===0&&v.value===""||v.value!=F)&&(v.value=""+F):v.value!==""+F&&(v.value=""+F);else if(H==="submit"||H==="reset"){v.removeAttribute("value");return}S.hasOwnProperty("value")?Yr(v,S.type,F):S.hasOwnProperty("defaultValue")&&Yr(v,S.type,wn(S.defaultValue)),S.checked==null&&S.defaultChecked!=null&&(v.defaultChecked=!!S.defaultChecked)}function cr(v,S,F){if(S.hasOwnProperty("value")||S.hasOwnProperty("defaultValue")){var H=S.type;if(!(H!=="submit"&&H!=="reset"||S.value!==void 0&&S.value!==null))return;S=""+v._wrapperState.initialValue,F||S===v.value||(v.value=S),v.defaultValue=S}F=v.name,F!==""&&(v.name=""),v.defaultChecked=!!v._wrapperState.initialChecked,F!==""&&(v.name=F)}function Yr(v,S,F){(S!=="number"||yi(v.ownerDocument)!==v)&&(F==null?v.defaultValue=""+v._wrapperState.initialValue:v.defaultValue!==""+F&&(v.defaultValue=""+F))}var Bs=Array.isArray;function Ia(v,S,F,H){if(v=v.options,S){S={};for(var se=0;se<F.length;se++)S["$"+F[se]]=!0;for(F=0;F<v.length;F++)se=S.hasOwnProperty("$"+v[F].value),v[F].selected!==se&&(v[F].selected=se),se&&H&&(v[F].defaultSelected=!0)}else{for(F=""+wn(F),S=null,se=0;se<v.length;se++){if(v[se].value===F){v[se].selected=!0,H&&(v[se].defaultSelected=!0);return}S!==null||v[se].disabled||(S=v[se])}S!==null&&(S.selected=!0)}}function so(v,S){if(S.dangerouslySetInnerHTML!=null)throw Error(n(91));return Dt({},S,{value:void 0,defaultValue:void 0,children:""+v._wrapperState.initialValue})}function Ma(v,S){var F=S.value;if(F==null){if(F=S.children,S=S.defaultValue,F!=null){if(S!=null)throw Error(n(92));if(Bs(F)){if(1<F.length)throw Error(n(93));F=F[0]}S=F}S==null&&(S=""),F=S}v._wrapperState={initialValue:wn(F)}}function er(v,S){var F=wn(S.value),H=wn(S.defaultValue);F!=null&&(F=""+F,F!==v.value&&(v.value=F),S.defaultValue==null&&v.defaultValue!==F&&(v.defaultValue=F)),H!=null&&(v.defaultValue=""+H)}function _s(v){var S=v.textContent;S===v._wrapperState.initialValue&&S!==""&&S!==null&&(v.value=S)}function Pa(v){switch(v){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kl(v,S){return v==null||v==="http://www.w3.org/1999/xhtml"?Pa(S):v==="http://www.w3.org/2000/svg"&&S==="foreignObject"?"http://www.w3.org/1999/xhtml":v}var Mo,Aa=function(v){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(S,F,H,se){MSApp.execUnsafeLocalFunction(function(){return v(S,F,H,se)})}:v}(function(v,S){if(v.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in v)v.innerHTML=S;else{for(Mo=Mo||document.createElement("div"),Mo.innerHTML="<svg>"+S.valueOf().toString()+"</svg>",S=Mo.firstChild;v.firstChild;)v.removeChild(v.firstChild);for(;S.firstChild;)v.appendChild(S.firstChild)}});function jo(v,S){if(S){var F=v.firstChild;if(F&&F===v.lastChild&&F.nodeType===3){F.nodeValue=S;return}}v.textContent=S}var xl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bl=["Webkit","ms","Moz","O"];Object.keys(xl).forEach(function(v){bl.forEach(function(S){S=S+v.charAt(0).toUpperCase()+v.substring(1),xl[S]=xl[v]})});function Du(v,S,F){return S==null||typeof S=="boolean"||S===""?"":F||typeof S!="number"||S===0||xl.hasOwnProperty(v)&&xl[v]?(""+S).trim():S+"px"}function Nu(v,S){v=v.style;for(var F in S)if(S.hasOwnProperty(F)){var H=F.indexOf("--")===0,se=Du(F,S[F],H);F==="float"&&(F="cssFloat"),H?v.setProperty(F,se):v[F]=se}}var js=Dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jl(v,S){if(S){if(js[v]&&(S.children!=null||S.dangerouslySetInnerHTML!=null))throw Error(n(137,v));if(S.dangerouslySetInnerHTML!=null){if(S.children!=null)throw Error(n(60));if(typeof S.dangerouslySetInnerHTML!="object"||!("__html"in S.dangerouslySetInnerHTML))throw Error(n(61))}if(S.style!=null&&typeof S.style!="object")throw Error(n(62))}}function vi(v,S){if(v.indexOf("-")===-1)return typeof S.is=="string";switch(v){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hr=null;function Vs(v){return v=v.target||v.srcElement||window,v.correspondingUseElement&&(v=v.correspondingUseElement),v.nodeType===3?v.parentNode:v}var ku=null,Po=null,sa=null;function yc(v){if(v=qf(v)){if(typeof ku!="function")throw Error(n(280));var S=v.stateNode;S&&(S=Cd(S),ku(v.stateNode,v.type,S))}}function Lr(v){Po?sa?sa.push(v):sa=[v]:Po=v}function fo(){if(Po){var v=Po,S=sa;if(sa=Po=null,yc(v),S)for(v=0;v<S.length;v++)yc(S[v])}}function Ao(v,S){return v(S)}function Xo(){}var wt=!1;function ge(v,S,F){if(wt)return v(S,F);wt=!0;try{return Ao(v,S,F)}finally{wt=!1,(Po!==null||sa!==null)&&(Xo(),fo())}}function be(v,S){var F=v.stateNode;if(F===null)return null;var H=Cd(F);if(H===null)return null;F=H[S];e:switch(S){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(H=!H.disabled)||(v=v.type,H=!(v==="button"||v==="input"||v==="select"||v==="textarea")),v=!H;break e;default:v=!1}if(v)return null;if(F&&typeof F!="function")throw Error(n(231,S,typeof F));return F}var ke=!1;if(i)try{var qe={};Object.defineProperty(qe,"passive",{get:function(){ke=!0}}),window.addEventListener("test",qe,qe),window.removeEventListener("test",qe,qe)}catch{ke=!1}function Xe(v,S,F,H,se,de,Le,ht,yt){var $t=Array.prototype.slice.call(arguments,3);try{S.apply(F,$t)}catch(yn){this.onError(yn)}}var et=!1,_t=null,it=!1,bt=null,Ct={onError:function(v){et=!0,_t=v}};function Et(v,S,F,H,se,de,Le,ht,yt){et=!1,_t=null,Xe.apply(Ct,arguments)}function Wt(v,S,F,H,se,de,Le,ht,yt){if(Et.apply(this,arguments),et){if(et){var $t=_t;et=!1,_t=null}else throw Error(n(198));it||(it=!0,bt=$t)}}function sn(v){var S=v,F=v;if(v.alternate)for(;S.return;)S=S.return;else{v=S;do S=v,(S.flags&4098)!==0&&(F=S.return),v=S.return;while(v)}return S.tag===3?F:null}function cn(v){if(v.tag===13){var S=v.memoizedState;if(S===null&&(v=v.alternate,v!==null&&(S=v.memoizedState)),S!==null)return S.dehydrated}return null}function Gn(v){if(sn(v)!==v)throw Error(n(188))}function Zn(v){var S=v.alternate;if(!S){if(S=sn(v),S===null)throw Error(n(188));return S!==v?null:v}for(var F=v,H=S;;){var se=F.return;if(se===null)break;var de=se.alternate;if(de===null){if(H=se.return,H!==null){F=H;continue}break}if(se.child===de.child){for(de=se.child;de;){if(de===F)return Gn(se),v;if(de===H)return Gn(se),S;de=de.sibling}throw Error(n(188))}if(F.return!==H.return)F=se,H=de;else{for(var Le=!1,ht=se.child;ht;){if(ht===F){Le=!0,F=se,H=de;break}if(ht===H){Le=!0,H=se,F=de;break}ht=ht.sibling}if(!Le){for(ht=de.child;ht;){if(ht===F){Le=!0,F=de,H=se;break}if(ht===H){Le=!0,H=de,F=se;break}ht=ht.sibling}if(!Le)throw Error(n(189))}}if(F.alternate!==H)throw Error(n(190))}if(F.tag!==3)throw Error(n(188));return F.stateNode.current===F?v:S}function Wn(v){return v=Zn(v),v!==null?Jn(v):null}function Jn(v){if(v.tag===5||v.tag===6)return v;for(v=v.child;v!==null;){var S=Jn(v);if(S!==null)return S;v=v.sibling}return null}var ai=t.unstable_scheduleCallback,Ai=t.unstable_cancelCallback,mr=t.unstable_shouldYield,Zr=t.unstable_requestPaint,Yn=t.unstable_now,Kr=t.unstable_getCurrentPriorityLevel,Vi=t.unstable_ImmediatePriority,Vo=t.unstable_UserBlockingPriority,Zo=t.unstable_NormalPriority,wl=t.unstable_LowPriority,Es=t.unstable_IdlePriority,mo=null,Ui=null;function Cf(v){if(Ui&&typeof Ui.onCommitFiberRoot=="function")try{Ui.onCommitFiberRoot(mo,v,void 0,(v.current.flags&128)===128)}catch{}}var Ro=Math.clz32?Math.clz32:dg,Fu=Math.log,X_=Math.LN2;function dg(v){return v>>>=0,v===0?32:31-(Fu(v)/X_|0)|0}var sh=64,vc=4194304;function gd(v){switch(v&-v){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return v&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return v}}function $p(v,S){var F=v.pendingLanes;if(F===0)return 0;var H=0,se=v.suspendedLanes,de=v.pingedLanes,Le=F&268435455;if(Le!==0){var ht=Le&~se;ht!==0?H=gd(ht):(de&=Le,de!==0&&(H=gd(de)))}else Le=F&~se,Le!==0?H=gd(Le):de!==0&&(H=gd(de));if(H===0)return 0;if(S!==0&&S!==H&&(S&se)===0&&(se=H&-H,de=S&-S,se>=de||se===16&&(de&4194240)!==0))return S;if((H&4)!==0&&(H|=F&16),S=v.entangledLanes,S!==0)for(v=v.entanglements,S&=H;0<S;)F=31-Ro(S),se=1<<F,H|=v[F],S&=~se;return H}function yv(v,S){switch(v){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Z_(v,S){for(var F=v.suspendedLanes,H=v.pingedLanes,se=v.expirationTimes,de=v.pendingLanes;0<de;){var Le=31-Ro(de),ht=1<<Le,yt=se[Le];yt===-1?((ht&F)===0||(ht&H)!==0)&&(se[Le]=yv(ht,S)):yt<=S&&(v.expiredLanes|=ht),de&=~ht}}function ah(v){return v=v.pendingLanes&-1073741825,v!==0?v:v&1073741824?1073741824:0}function Ra(){var v=sh;return sh<<=1,(sh&4194240)===0&&(sh=64),v}function Qa(v){for(var S=[],F=0;31>F;F++)S.push(v);return S}function Sl(v,S,F){v.pendingLanes|=S,S!==536870912&&(v.suspendedLanes=0,v.pingedLanes=0),v=v.eventTimes,S=31-Ro(S),v[S]=F}function el(v,S){var F=v.pendingLanes&~S;v.pendingLanes=S,v.suspendedLanes=0,v.pingedLanes=0,v.expiredLanes&=S,v.mutableReadLanes&=S,v.entangledLanes&=S,S=v.entanglements;var H=v.eventTimes;for(v=v.expirationTimes;0<F;){var se=31-Ro(F),de=1<<se;S[se]=0,H[se]=-1,v[se]=-1,F&=~de}}function Us(v,S){var F=v.entangledLanes|=S;for(v=v.entanglements;F;){var H=31-Ro(F),se=1<<H;se&S|v[H]&S&&(v[H]|=S),F&=~se}}var mi=0;function fg(v){return v&=-v,1<v?4<v?(v&268435455)!==0?16:536870912:4:1}var qp,tl,Gs,Y_,pg,La=!1,Fr=[],zu=null,Sn=null,xc=null,Tf=new Map,bc=new Map,fr=[],El="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hp(v,S){switch(v){case"focusin":case"focusout":zu=null;break;case"dragenter":case"dragleave":Sn=null;break;case"mouseover":case"mouseout":xc=null;break;case"pointerover":case"pointerout":Tf.delete(S.pointerId);break;case"gotpointercapture":case"lostpointercapture":bc.delete(S.pointerId)}}function Bu(v,S,F,H,se,de){return v===null||v.nativeEvent!==de?(v={blockedOn:S,domEventName:F,eventSystemFlags:H,nativeEvent:de,targetContainers:[se]},S!==null&&(S=qf(S),S!==null&&tl(S)),v):(v.eventSystemFlags|=H,S=v.targetContainers,se!==null&&S.indexOf(se)===-1&&S.push(se),v)}function gn(v,S,F,H,se){switch(S){case"focusin":return zu=Bu(zu,v,S,F,H,se),!0;case"dragenter":return Sn=Bu(Sn,v,S,F,H,se),!0;case"mouseover":return xc=Bu(xc,v,S,F,H,se),!0;case"pointerover":var de=se.pointerId;return Tf.set(de,Bu(Tf.get(de)||null,v,S,F,H,se)),!0;case"gotpointercapture":return de=se.pointerId,bc.set(de,Bu(bc.get(de)||null,v,S,F,H,se)),!0}return!1}function Gr(v){var S=yh(v.target);if(S!==null){var F=sn(S);if(F!==null){if(S=F.tag,S===13){if(S=cn(F),S!==null){v.blockedOn=S,pg(v.priority,function(){Gs(F)});return}}else if(S===3&&F.stateNode.current.memoizedState.isDehydrated){v.blockedOn=F.tag===3?F.stateNode.containerInfo:null;return}}}v.blockedOn=null}function Er(v){if(v.blockedOn!==null)return!1;for(var S=v.targetContainers;0<S.length;){var F=Wp(v.domEventName,v.eventSystemFlags,S[0],v.nativeEvent);if(F===null){F=v.nativeEvent;var H=new F.constructor(F.type,F);Hr=H,F.target.dispatchEvent(H),Hr=null}else return S=qf(F),S!==null&&tl(S),v.blockedOn=F,!1;S.shift()}return!0}function ys(v,S,F){Er(v)&&F.delete(S)}function If(){La=!1,zu!==null&&Er(zu)&&(zu=null),Sn!==null&&Er(Sn)&&(Sn=null),xc!==null&&Er(xc)&&(xc=null),Tf.forEach(ys),bc.forEach(ys)}function Cr(v,S){v.blockedOn===S&&(v.blockedOn=null,La||(La=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,If)))}function nl(v){function S(se){return Cr(se,v)}if(0<Fr.length){Cr(Fr[0],v);for(var F=1;F<Fr.length;F++){var H=Fr[F];H.blockedOn===v&&(H.blockedOn=null)}}for(zu!==null&&Cr(zu,v),Sn!==null&&Cr(Sn,v),xc!==null&&Cr(xc,v),Tf.forEach(S),bc.forEach(S),F=0;F<fr.length;F++)H=fr[F],H.blockedOn===v&&(H.blockedOn=null);for(;0<fr.length&&(F=fr[0],F.blockedOn===null);)Gr(F),F.blockedOn===null&&fr.shift()}var ju=ae.ReactCurrentBatchConfig,Cl=!0;function vs(v,S,F,H){var se=mi,de=ju.transition;ju.transition=null;try{mi=1,rl(v,S,F,H)}finally{mi=se,ju.transition=de}}function Qi(v,S,F,H){var se=mi,de=ju.transition;ju.transition=null;try{mi=4,rl(v,S,F,H)}finally{mi=se,ju.transition=de}}function rl(v,S,F,H){if(Cl){var se=Wp(v,S,F,H);if(se===null)ry(v,S,H,wc,F),Hp(v,H);else if(gn(se,v,S,F,H))H.stopPropagation();else if(Hp(v,H),S&4&&-1<El.indexOf(v)){for(;se!==null;){var de=qf(se);if(de!==null&&qp(de),de=Wp(v,S,F,H),de===null&&ry(v,S,H,wc,F),de===se)break;se=de}se!==null&&H.stopPropagation()}else ry(v,S,H,null,F)}}var wc=null;function Wp(v,S,F,H){if(wc=null,v=Vs(H),v=yh(v),v!==null)if(S=sn(v),S===null)v=null;else if(F=S.tag,F===13){if(v=cn(S),v!==null)return v;v=null}else if(F===3){if(S.stateNode.current.memoizedState.isDehydrated)return S.tag===3?S.stateNode.containerInfo:null;v=null}else S!==v&&(v=null);return wc=v,null}function _d(v){switch(v){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kr()){case Vi:return 1;case Vo:return 4;case Zo:case wl:return 16;case Es:return 536870912;default:return 16}default:return 16}}var Ql=null,yd=null,Yo=null;function eu(){if(Yo)return Yo;var v,S=yd,F=S.length,H,se="value"in Ql?Ql.value:Ql.textContent,de=se.length;for(v=0;v<F&&S[v]===se[v];v++);var Le=F-v;for(H=1;H<=Le&&S[F-H]===se[de-H];H++);return Yo=se.slice(v,1<H?1-H:void 0)}function Ko(v){var S=v.keyCode;return"charCode"in v?(v=v.charCode,v===0&&S===13&&(v=13)):v=S,v===10&&(v=13),32<=v||v===13?v:0}function lh(){return!0}function Tl(){return!1}function di(v){function S(F,H,se,de,Le){this._reactName=F,this._targetInst=se,this.type=H,this.nativeEvent=de,this.target=Le,this.currentTarget=null;for(var ht in v)v.hasOwnProperty(ht)&&(F=v[ht],this[ht]=F?F(de):de[ht]);return this.isDefaultPrevented=(de.defaultPrevented!=null?de.defaultPrevented:de.returnValue===!1)?lh:Tl,this.isPropagationStopped=Tl,this}return Dt(S.prototype,{preventDefault:function(){this.defaultPrevented=!0;var F=this.nativeEvent;F&&(F.preventDefault?F.preventDefault():typeof F.returnValue!="unknown"&&(F.returnValue=!1),this.isDefaultPrevented=lh)},stopPropagation:function(){var F=this.nativeEvent;F&&(F.stopPropagation?F.stopPropagation():typeof F.cancelBubble!="unknown"&&(F.cancelBubble=!0),this.isPropagationStopped=lh)},persist:function(){},isPersistent:lh}),S}var ao={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(v){return v.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tu=di(ao),Fi=Dt({},ao,{view:0,detail:0}),K_=di(Fi),aa,uh,Il,Ml=Dt({},Fi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ec,button:0,buttons:0,relatedTarget:function(v){return v.relatedTarget===void 0?v.fromElement===v.srcElement?v.toElement:v.fromElement:v.relatedTarget},movementX:function(v){return"movementX"in v?v.movementX:(v!==Il&&(Il&&v.type==="mousemove"?(aa=v.screenX-Il.screenX,uh=v.screenY-Il.screenY):uh=aa=0,Il=v),aa)},movementY:function(v){return"movementY"in v?v.movementY:uh}}),vv=di(Ml),Sc=Dt({},Ml,{dataTransfer:0}),Px=di(Sc),mg=Dt({},Fi,{relatedTarget:0}),xs=di(mg),Ax=Dt({},ao,{animationName:0,elapsedTime:0,pseudoElement:0}),vd=di(Ax),xv=Dt({},ao,{clipboardData:function(v){return"clipboardData"in v?v.clipboardData:window.clipboardData}}),Xp=di(xv),Rx=Dt({},ao,{data:0}),bv=di(Rx),Zp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xd(v){var S=this.nativeEvent;return S.getModifierState?S.getModifierState(v):(v=Lx[v])?!!S[v]:!1}function Ec(){return xd}var gg=Dt({},Fi,{key:function(v){if(v.key){var S=Zp[v.key]||v.key;if(S!=="Unidentified")return S}return v.type==="keypress"?(v=Ko(v),v===13?"Enter":String.fromCharCode(v)):v.type==="keydown"||v.type==="keyup"?Yp[v.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ec,charCode:function(v){return v.type==="keypress"?Ko(v):0},keyCode:function(v){return v.type==="keydown"||v.type==="keyup"?v.keyCode:0},which:function(v){return v.type==="keypress"?Ko(v):v.type==="keydown"||v.type==="keyup"?v.keyCode:0}}),ch=di(gg),J_=Dt({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wv=di(J_),Ox=Dt({},Fi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ec}),Sv=di(Ox),Dx=Dt({},ao,{propertyName:0,elapsedTime:0,pseudoElement:0}),hh=di(Dx),pr=Dt({},Ml,{deltaX:function(v){return"deltaX"in v?v.deltaX:"wheelDeltaX"in v?-v.wheelDeltaX:0},deltaY:function(v){return"deltaY"in v?v.deltaY:"wheelDeltaY"in v?-v.wheelDeltaY:"wheelDelta"in v?-v.wheelDelta:0},deltaZ:0,deltaMode:0}),En=di(pr),_g=[9,13,27,32],Vn=i&&"CompositionEvent"in window,il=null;i&&"documentMode"in document&&(il=document.documentMode);var Mf=i&&"TextEvent"in window&&!il,Fn=i&&(!Vn||il&&8<il&&11>=il),yg=" ",dh=!1;function bd(v,S){switch(v){case"keyup":return _g.indexOf(S.keyCode)!==-1;case"keydown":return S.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vg(v){return v=v.detail,typeof v=="object"&&"data"in v?v.data:null}var nu=!1;function Hi(v,S){switch(v){case"compositionend":return vg(S);case"keypress":return S.which!==32?null:(dh=!0,yg);case"textInput":return v=S.data,v===yg&&dh?null:v;default:return null}}function Kp(v,S){if(nu)return v==="compositionend"||!Vn&&bd(v,S)?(v=eu(),Yo=yd=Ql=null,nu=!1,v):null;switch(v){case"paste":return null;case"keypress":if(!(S.ctrlKey||S.altKey||S.metaKey)||S.ctrlKey&&S.altKey){if(S.char&&1<S.char.length)return S.char;if(S.which)return String.fromCharCode(S.which)}return null;case"compositionend":return Fn&&S.locale!=="ko"?null:S.data;default:return null}}var Qt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jp(v){var S=v&&v.nodeName&&v.nodeName.toLowerCase();return S==="input"?!!Qt[v.type]:S==="textarea"}function Vu(v,S,F,H){Lr(H),S=gh(S,"onChange"),0<S.length&&(F=new tu("onChange","change",null,F,H),v.push({event:F,listeners:S}))}var Lo=null,Pf=null;function xg(v){Mg(v,0)}function Pl(v){var S=vh(v);if(Mr(S))return v}function Af(v,S){if(v==="change")return S}var Cc=!1;if(i){var fh;if(i){var ph="oninput"in document;if(!ph){var Ev=document.createElement("div");Ev.setAttribute("oninput","return;"),ph=typeof Ev.oninput=="function"}fh=ph}else fh=!1;Cc=fh&&(!document.documentMode||9<document.documentMode)}function Cv(){Lo&&(Lo.detachEvent("onpropertychange",bg),Pf=Lo=null)}function bg(v){if(v.propertyName==="value"&&Pl(Pf)){var S=[];Vu(S,Pf,v,Vs(v)),ge(xg,S)}}function Tv(v,S,F){v==="focusin"?(Cv(),Lo=S,Pf=F,Lo.attachEvent("onpropertychange",bg)):v==="focusout"&&Cv()}function Iv(v){if(v==="selectionchange"||v==="keyup"||v==="keydown")return Pl(Pf)}function Mv(v,S){if(v==="click")return Pl(S)}function wg(v,S){if(v==="input"||v==="change")return Pl(S)}function Nx(v,S){return v===S&&(v!==0||1/v===1/S)||v!==v&&S!==S}var Cs=typeof Object.is=="function"?Object.is:Nx;function Qp(v,S){if(Cs(v,S))return!0;if(typeof v!="object"||v===null||typeof S!="object"||S===null)return!1;var F=Object.keys(v),H=Object.keys(S);if(F.length!==H.length)return!1;for(H=0;H<F.length;H++){var se=F[H];if(!b.call(S,se)||!Cs(v[se],S[se]))return!1}return!0}function Pv(v){for(;v&&v.firstChild;)v=v.firstChild;return v}function em(v,S){var F=Pv(v);v=0;for(var H;F;){if(F.nodeType===3){if(H=v+F.textContent.length,v<=S&&H>=S)return{node:F,offset:S-v};v=H}e:{for(;F;){if(F.nextSibling){F=F.nextSibling;break e}F=F.parentNode}F=void 0}F=Pv(F)}}function Q_(v,S){return v&&S?v===S?!0:v&&v.nodeType===3?!1:S&&S.nodeType===3?Q_(v,S.parentNode):"contains"in v?v.contains(S):v.compareDocumentPosition?!!(v.compareDocumentPosition(S)&16):!1:!1}function Rf(){for(var v=window,S=yi();S instanceof v.HTMLIFrameElement;){try{var F=typeof S.contentWindow.location.href=="string"}catch{F=!1}if(F)v=S.contentWindow;else break;S=yi(v.document)}return S}function ol(v){var S=v&&v.nodeName&&v.nodeName.toLowerCase();return S&&(S==="input"&&(v.type==="text"||v.type==="search"||v.type==="tel"||v.type==="url"||v.type==="password")||S==="textarea"||v.contentEditable==="true")}function ey(v){var S=Rf(),F=v.focusedElem,H=v.selectionRange;if(S!==F&&F&&F.ownerDocument&&Q_(F.ownerDocument.documentElement,F)){if(H!==null&&ol(F)){if(S=H.start,v=H.end,v===void 0&&(v=S),"selectionStart"in F)F.selectionStart=S,F.selectionEnd=Math.min(v,F.value.length);else if(v=(S=F.ownerDocument||document)&&S.defaultView||window,v.getSelection){v=v.getSelection();var se=F.textContent.length,de=Math.min(H.start,se);H=H.end===void 0?de:Math.min(H.end,se),!v.extend&&de>H&&(se=H,H=de,de=se),se=em(F,de);var Le=em(F,H);se&&Le&&(v.rangeCount!==1||v.anchorNode!==se.node||v.anchorOffset!==se.offset||v.focusNode!==Le.node||v.focusOffset!==Le.offset)&&(S=S.createRange(),S.setStart(se.node,se.offset),v.removeAllRanges(),de>H?(v.addRange(S),v.extend(Le.node,Le.offset)):(S.setEnd(Le.node,Le.offset),v.addRange(S)))}}for(S=[],v=F;v=v.parentNode;)v.nodeType===1&&S.push({element:v,left:v.scrollLeft,top:v.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<S.length;F++)v=S[F],v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}var Sg=i&&"documentMode"in document&&11>=document.documentMode,Uu=null,Lf=null,Al=null,Of=!1;function Eg(v,S,F){var H=F.window===F?F.document:F.nodeType===9?F:F.ownerDocument;Of||Uu==null||Uu!==yi(H)||(H=Uu,"selectionStart"in H&&ol(H)?H={start:H.selectionStart,end:H.selectionEnd}:(H=(H.ownerDocument&&H.ownerDocument.defaultView||window).getSelection(),H={anchorNode:H.anchorNode,anchorOffset:H.anchorOffset,focusNode:H.focusNode,focusOffset:H.focusOffset}),Al&&Qp(Al,H)||(Al=H,H=gh(Lf,"onSelect"),0<H.length&&(S=new tu("onSelect","select",null,S,F),v.push({event:S,listeners:H}),S.target=Uu)))}function Gu(v,S){var F={};return F[v.toLowerCase()]=S.toLowerCase(),F["Webkit"+v]="webkit"+S,F["Moz"+v]="moz"+S,F}var ru={animationend:Gu("Animation","AnimationEnd"),animationiteration:Gu("Animation","AnimationIteration"),animationstart:Gu("Animation","AnimationStart"),transitionend:Gu("Transition","TransitionEnd")},wd={},Df={};i&&(Df=document.createElement("div").style,"AnimationEvent"in window||(delete ru.animationend.animation,delete ru.animationiteration.animation,delete ru.animationstart.animation),"TransitionEvent"in window||delete ru.transitionend.transition);function Rl(v){if(wd[v])return wd[v];if(!ru[v])return v;var S=ru[v],F;for(F in S)if(S.hasOwnProperty(F)&&F in Df)return wd[v]=S[F];return v}var mh=Rl("animationend"),Sd=Rl("animationiteration"),Cg=Rl("animationstart"),tm=Rl("transitionend"),Nf=new Map,iu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hr(v,S){Nf.set(v,S),u(S,[v])}for(var Tg=0;Tg<iu.length;Tg++){var Ig=iu[Tg],kf=Ig.toLowerCase(),ty=Ig[0].toUpperCase()+Ig.slice(1);hr(kf,"on"+ty)}hr(mh,"onAnimationEnd"),hr(Sd,"onAnimationIteration"),hr(Cg,"onAnimationStart"),hr("dblclick","onDoubleClick"),hr("focusin","onFocus"),hr("focusout","onBlur"),hr(tm,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ti=new Set("cancel close invalid load scroll toggle".split(" ").concat(nm));function Av(v,S,F){var H=v.type||"unknown-event";v.currentTarget=F,Wt(H,S,void 0,v),v.currentTarget=null}function Mg(v,S){S=(S&4)!==0;for(var F=0;F<v.length;F++){var H=v[F],se=H.event;H=H.listeners;e:{var de=void 0;if(S)for(var Le=H.length-1;0<=Le;Le--){var ht=H[Le],yt=ht.instance,$t=ht.currentTarget;if(ht=ht.listener,yt!==de&&se.isPropagationStopped())break e;Av(se,ht,$t),de=yt}else for(Le=0;Le<H.length;Le++){if(ht=H[Le],yt=ht.instance,$t=ht.currentTarget,ht=ht.listener,yt!==de&&se.isPropagationStopped())break e;Av(se,ht,$t),de=yt}}}if(it)throw v=bt,it=!1,bt=null,v}function Wi(v,S){var F=S[um];F===void 0&&(F=S[um]=new Set);var H=v+"__bubble";F.has(H)||(ny(S,v,2,!1),F.add(H))}function rm(v,S,F){var H=0;S&&(H|=4),ny(F,v,H,S)}var Ff="_reactListening"+Math.random().toString(36).slice(2);function zf(v){if(!v[Ff]){v[Ff]=!0,r.forEach(function(F){F!=="selectionchange"&&(Ti.has(F)||rm(F,!1,v),rm(F,!0,v))});var S=v.nodeType===9?v:v.ownerDocument;S===null||S[Ff]||(S[Ff]=!0,rm("selectionchange",!1,S))}}function ny(v,S,F,H){switch(_d(S)){case 1:var se=vs;break;case 4:se=Qi;break;default:se=rl}F=se.bind(null,S,F,v),se=void 0,!ke||S!=="touchstart"&&S!=="touchmove"&&S!=="wheel"||(se=!0),H?se!==void 0?v.addEventListener(S,F,{capture:!0,passive:se}):v.addEventListener(S,F,!0):se!==void 0?v.addEventListener(S,F,{passive:se}):v.addEventListener(S,F,!1)}function ry(v,S,F,H,se){var de=H;if((S&1)===0&&(S&2)===0&&H!==null)e:for(;;){if(H===null)return;var Le=H.tag;if(Le===3||Le===4){var ht=H.stateNode.containerInfo;if(ht===se||ht.nodeType===8&&ht.parentNode===se)break;if(Le===4)for(Le=H.return;Le!==null;){var yt=Le.tag;if((yt===3||yt===4)&&(yt=Le.stateNode.containerInfo,yt===se||yt.nodeType===8&&yt.parentNode===se))return;Le=Le.return}for(;ht!==null;){if(Le=yh(ht),Le===null)return;if(yt=Le.tag,yt===5||yt===6){H=de=Le;continue e}ht=ht.parentNode}}H=H.return}ge(function(){var $t=de,yn=Vs(F),xn=[];e:{var pn=Nf.get(v);if(pn!==void 0){var Bn=tu,Kn=v;switch(v){case"keypress":if(Ko(F)===0)break e;case"keydown":case"keyup":Bn=ch;break;case"focusin":Kn="focus",Bn=xs;break;case"focusout":Kn="blur",Bn=xs;break;case"beforeblur":case"afterblur":Bn=xs;break;case"click":if(F.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Bn=vv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Bn=Px;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Bn=Sv;break;case mh:case Sd:case Cg:Bn=vd;break;case tm:Bn=hh;break;case"scroll":Bn=K_;break;case"wheel":Bn=En;break;case"copy":case"cut":case"paste":Bn=Xp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Bn=wv}var tr=(S&4)!==0,xo=!tr&&v==="scroll",Ft=tr?pn!==null?pn+"Capture":null:pn;tr=[];for(var Tt=$t,Vt;Tt!==null;){Vt=Tt;var Tn=Vt.stateNode;if(Vt.tag===5&&Tn!==null&&(Vt=Tn,Ft!==null&&(Tn=be(Tt,Ft),Tn!=null&&tr.push(Tc(Tt,Tn,Vt)))),xo)break;Tt=Tt.return}0<tr.length&&(pn=new Bn(pn,Kn,null,F,yn),xn.push({event:pn,listeners:tr}))}}if((S&7)===0){e:{if(pn=v==="mouseover"||v==="pointerover",Bn=v==="mouseout"||v==="pointerout",pn&&F!==Hr&&(Kn=F.relatedTarget||F.fromElement)&&(yh(Kn)||Kn[sl]))break e;if((Bn||pn)&&(pn=yn.window===yn?yn:(pn=yn.ownerDocument)?pn.defaultView||pn.parentWindow:window,Bn?(Kn=F.relatedTarget||F.toElement,Bn=$t,Kn=Kn?yh(Kn):null,Kn!==null&&(xo=sn(Kn),Kn!==xo||Kn.tag!==5&&Kn.tag!==6)&&(Kn=null)):(Bn=null,Kn=$t),Bn!==Kn)){if(tr=vv,Tn="onMouseLeave",Ft="onMouseEnter",Tt="mouse",(v==="pointerout"||v==="pointerover")&&(tr=wv,Tn="onPointerLeave",Ft="onPointerEnter",Tt="pointer"),xo=Bn==null?pn:vh(Bn),Vt=Kn==null?pn:vh(Kn),pn=new tr(Tn,Tt+"leave",Bn,F,yn),pn.target=xo,pn.relatedTarget=Vt,Tn=null,yh(yn)===$t&&(tr=new tr(Ft,Tt+"enter",Kn,F,yn),tr.target=Vt,tr.relatedTarget=xo,Tn=tr),xo=Tn,Bn&&Kn)t:{for(tr=Bn,Ft=Kn,Tt=0,Vt=tr;Vt;Vt=Ed(Vt))Tt++;for(Vt=0,Tn=Ft;Tn;Tn=Ed(Tn))Vt++;for(;0<Tt-Vt;)tr=Ed(tr),Tt--;for(;0<Vt-Tt;)Ft=Ed(Ft),Vt--;for(;Tt--;){if(tr===Ft||Ft!==null&&tr===Ft.alternate)break t;tr=Ed(tr),Ft=Ed(Ft)}tr=null}else tr=null;Bn!==null&&Oa(xn,pn,Bn,tr,!1),Kn!==null&&xo!==null&&Oa(xn,xo,Kn,tr,!0)}}e:{if(pn=$t?vh($t):window,Bn=pn.nodeName&&pn.nodeName.toLowerCase(),Bn==="select"||Bn==="input"&&pn.type==="file")var or=Af;else if(Jp(pn))if(Cc)or=wg;else{or=Iv;var br=Tv}else(Bn=pn.nodeName)&&Bn.toLowerCase()==="input"&&(pn.type==="checkbox"||pn.type==="radio")&&(or=Mv);if(or&&(or=or(v,$t))){Vu(xn,or,F,yn);break e}br&&br(v,pn,$t),v==="focusout"&&(br=pn._wrapperState)&&br.controlled&&pn.type==="number"&&Yr(pn,"number",pn.value)}switch(br=$t?vh($t):window,v){case"focusin":(Jp(br)||br.contentEditable==="true")&&(Uu=br,Lf=$t,Al=null);break;case"focusout":Al=Lf=Uu=null;break;case"mousedown":Of=!0;break;case"contextmenu":case"mouseup":case"dragend":Of=!1,Eg(xn,F,yn);break;case"selectionchange":if(Sg)break;case"keydown":case"keyup":Eg(xn,F,yn)}var wr;if(Vn)e:{switch(v){case"compositionstart":var Br="onCompositionStart";break e;case"compositionend":Br="onCompositionEnd";break e;case"compositionupdate":Br="onCompositionUpdate";break e}Br=void 0}else nu?bd(v,F)&&(Br="onCompositionEnd"):v==="keydown"&&F.keyCode===229&&(Br="onCompositionStart");Br&&(Fn&&F.locale!=="ko"&&(nu||Br!=="onCompositionStart"?Br==="onCompositionEnd"&&nu&&(wr=eu()):(Ql=yn,yd="value"in Ql?Ql.value:Ql.textContent,nu=!0)),br=gh($t,Br),0<br.length&&(Br=new bv(Br,v,null,F,yn),xn.push({event:Br,listeners:br}),wr?Br.data=wr:(wr=vg(F),wr!==null&&(Br.data=wr)))),(wr=Mf?Hi(v,F):Kp(v,F))&&($t=gh($t,"onBeforeInput"),0<$t.length&&(yn=new bv("onBeforeInput","beforeinput",null,F,yn),xn.push({event:yn,listeners:$t}),yn.data=wr))}Mg(xn,S)})}function Tc(v,S,F){return{instance:v,listener:S,currentTarget:F}}function gh(v,S){for(var F=S+"Capture",H=[];v!==null;){var se=v,de=se.stateNode;se.tag===5&&de!==null&&(se=de,de=be(v,F),de!=null&&H.unshift(Tc(v,de,se)),de=be(v,S),de!=null&&H.push(Tc(v,de,se))),v=v.return}return H}function Ed(v){if(v===null)return null;do v=v.return;while(v&&v.tag!==5);return v||null}function Oa(v,S,F,H,se){for(var de=S._reactName,Le=[];F!==null&&F!==H;){var ht=F,yt=ht.alternate,$t=ht.stateNode;if(yt!==null&&yt===H)break;ht.tag===5&&$t!==null&&(ht=$t,se?(yt=be(F,de),yt!=null&&Le.unshift(Tc(F,yt,ht))):se||(yt=be(F,de),yt!=null&&Le.push(Tc(F,yt,ht)))),F=F.return}Le.length!==0&&v.push({event:S,listeners:Le})}var iy=/\r\n?/g,Pg=/\u0000|\uFFFD/g;function im(v){return(typeof v=="string"?v:""+v).replace(iy,`
`).replace(Pg,"")}function Bf(v,S,F){if(S=im(S),im(v)!==S&&F)throw Error(n(425))}function jf(){}var om=null,Vf=null;function sm(v,S){return v==="textarea"||v==="noscript"||typeof S.children=="string"||typeof S.children=="number"||typeof S.dangerouslySetInnerHTML=="object"&&S.dangerouslySetInnerHTML!==null&&S.dangerouslySetInnerHTML.__html!=null}var am=typeof setTimeout=="function"?setTimeout:void 0,Ag=typeof clearTimeout=="function"?clearTimeout:void 0,oy=typeof Promise=="function"?Promise:void 0,Rv=typeof queueMicrotask=="function"?queueMicrotask:typeof oy<"u"?function(v){return oy.resolve(null).then(v).catch(Uf)}:am;function Uf(v){setTimeout(function(){throw v})}function sy(v,S){var F=S,H=0;do{var se=F.nextSibling;if(v.removeChild(F),se&&se.nodeType===8)if(F=se.data,F==="/$"){if(H===0){v.removeChild(se),nl(S);return}H--}else F!=="$"&&F!=="$?"&&F!=="$!"||H++;F=se}while(F);nl(S)}function _h(v){for(;v!=null;v=v.nextSibling){var S=v.nodeType;if(S===1||S===3)break;if(S===8){if(S=v.data,S==="$"||S==="$!"||S==="$?")break;if(S==="/$")return null}}return v}function Lv(v){v=v.previousSibling;for(var S=0;v;){if(v.nodeType===8){var F=v.data;if(F==="$"||F==="$!"||F==="$?"){if(S===0)return v;S--}else F==="/$"&&S++}v=v.previousSibling}return null}var Gf=Math.random().toString(36).slice(2),$u="__reactFiber$"+Gf,lm="__reactProps$"+Gf,sl="__reactContainer$"+Gf,um="__reactEvents$"+Gf,ay="__reactListeners$"+Gf,$f="__reactHandles$"+Gf;function yh(v){var S=v[$u];if(S)return S;for(var F=v.parentNode;F;){if(S=F[sl]||F[$u]){if(F=S.alternate,S.child!==null||F!==null&&F.child!==null)for(v=Lv(v);v!==null;){if(F=v[$u])return F;v=Lv(v)}return S}v=F,F=v.parentNode}return null}function qf(v){return v=v[$u]||v[sl],!v||v.tag!==5&&v.tag!==6&&v.tag!==13&&v.tag!==3?null:v}function vh(v){if(v.tag===5||v.tag===6)return v.stateNode;throw Error(n(33))}function Cd(v){return v[lm]||null}var Da=[],xh=-1;function $s(v){return{current:v}}function Xi(v){0>xh||(v.current=Da[xh],Da[xh]=null,xh--)}function Ri(v,S){xh++,Da[xh]=v.current,v.current=S}var ou={},Ts=$s(ou),qs=$s(!1),qu=ou;function Td(v,S){var F=v.type.contextTypes;if(!F)return ou;var H=v.stateNode;if(H&&H.__reactInternalMemoizedUnmaskedChildContext===S)return H.__reactInternalMemoizedMaskedChildContext;var se={},de;for(de in F)se[de]=S[de];return H&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=S,v.__reactInternalMemoizedMaskedChildContext=se),se}function la(v){return v=v.childContextTypes,v!=null}function bh(){Xi(qs),Xi(Ts)}function Ov(v,S,F){if(Ts.current!==ou)throw Error(n(168));Ri(Ts,S),Ri(qs,F)}function ly(v,S,F){var H=v.stateNode;if(S=S.childContextTypes,typeof H.getChildContext!="function")return F;H=H.getChildContext();for(var se in H)if(!(se in S))throw Error(n(108,Ut(v)||"Unknown",se));return Dt({},F,H)}function Hf(v){return v=(v=v.stateNode)&&v.__reactInternalMemoizedMergedChildContext||ou,qu=Ts.current,Ri(Ts,v),Ri(qs,qs.current),!0}function cm(v,S,F){var H=v.stateNode;if(!H)throw Error(n(169));F?(v=ly(v,S,qu),H.__reactInternalMemoizedMergedChildContext=v,Xi(qs),Xi(Ts),Ri(Ts,v)):Xi(qs),Ri(qs,F)}var su=null,Id=!1,wh=!1;function Rg(v){su===null?su=[v]:su.push(v)}function Wf(v){Id=!0,Rg(v)}function Hu(){if(!wh&&su!==null){wh=!0;var v=0,S=mi;try{var F=su;for(mi=1;v<F.length;v++){var H=F[v];do H=H(!0);while(H!==null)}su=null,Id=!1}catch(se){throw su!==null&&(su=su.slice(v+1)),ai(Vi,Hu),se}finally{mi=S,wh=!1}}return null}var Ic=[],Mc=0,Sh=null,hm=0,al=[],Is=0,Wu=null,on=1,au="";function Pc(v,S){Ic[Mc++]=hm,Ic[Mc++]=Sh,Sh=v,hm=S}function Ac(v,S,F){al[Is++]=on,al[Is++]=au,al[Is++]=Wu,Wu=v;var H=on;v=au;var se=32-Ro(H)-1;H&=~(1<<se),F+=1;var de=32-Ro(S)+se;if(30<de){var Le=se-se%5;de=(H&(1<<Le)-1).toString(32),H>>=Le,se-=Le,on=1<<32-Ro(S)+se|F<<se|H,au=de+v}else on=1<<de|F<<se|H,au=v}function ua(v){v.return!==null&&(Pc(v,1),Ac(v,1,0))}function Cn(v){for(;v===Sh;)Sh=Ic[--Mc],Ic[Mc]=null,hm=Ic[--Mc],Ic[Mc]=null;for(;v===Wu;)Wu=al[--Is],al[Is]=null,au=al[--Is],al[Is]=null,on=al[--Is],al[Is]=null}var ca=null,ll=null,lo=!1,Na=null;function Lg(v,S){var F=ts(5,null,null,0);F.elementType="DELETED",F.stateNode=S,F.return=v,S=v.deletions,S===null?(v.deletions=[F],v.flags|=16):S.push(F)}function uy(v,S){switch(v.tag){case 5:var F=v.type;return S=S.nodeType!==1||F.toLowerCase()!==S.nodeName.toLowerCase()?null:S,S!==null?(v.stateNode=S,ca=v,ll=_h(S.firstChild),!0):!1;case 6:return S=v.pendingProps===""||S.nodeType!==3?null:S,S!==null?(v.stateNode=S,ca=v,ll=null,!0):!1;case 13:return S=S.nodeType!==8?null:S,S!==null?(F=Wu!==null?{id:on,overflow:au}:null,v.memoizedState={dehydrated:S,treeContext:F,retryLane:1073741824},F=ts(18,null,null,0),F.stateNode=S,F.return=v,v.child=F,ca=v,ll=null,!0):!1;default:return!1}}function Xf(v){return(v.mode&1)!==0&&(v.flags&128)===0}function dm(v){if(lo){var S=ll;if(S){var F=S;if(!uy(v,S)){if(Xf(v))throw Error(n(418));S=_h(F.nextSibling);var H=ca;S&&uy(v,S)?Lg(H,F):(v.flags=v.flags&-4097|2,lo=!1,ca=v)}}else{if(Xf(v))throw Error(n(418));v.flags=v.flags&-4097|2,lo=!1,ca=v}}}function cy(v){for(v=v.return;v!==null&&v.tag!==5&&v.tag!==3&&v.tag!==13;)v=v.return;ca=v}function Zf(v){if(v!==ca)return!1;if(!lo)return cy(v),lo=!0,!1;var S;if((S=v.tag!==3)&&!(S=v.tag!==5)&&(S=v.type,S=S!=="head"&&S!=="body"&&!sm(v.type,v.memoizedProps)),S&&(S=ll)){if(Xf(v))throw lu(),Error(n(418));for(;S;)Lg(v,S),S=_h(S.nextSibling)}if(cy(v),v.tag===13){if(v=v.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));e:{for(v=v.nextSibling,S=0;v;){if(v.nodeType===8){var F=v.data;if(F==="/$"){if(S===0){ll=_h(v.nextSibling);break e}S--}else F!=="$"&&F!=="$!"&&F!=="$?"||S++}v=v.nextSibling}ll=null}}else ll=ca?_h(v.stateNode.nextSibling):null;return!0}function lu(){for(var v=ll;v;)v=_h(v.nextSibling)}function Eh(){ll=ca=null,lo=!1}function fm(v){Na===null?Na=[v]:Na.push(v)}var ha=ae.ReactCurrentBatchConfig;function Ll(v,S,F){if(v=F.ref,v!==null&&typeof v!="function"&&typeof v!="object"){if(F._owner){if(F=F._owner,F){if(F.tag!==1)throw Error(n(309));var H=F.stateNode}if(!H)throw Error(n(147,v));var se=H,de=""+v;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===de?S.ref:(S=function(Le){var ht=se.refs;Le===null?delete ht[de]:ht[de]=Le},S._stringRef=de,S)}if(typeof v!="string")throw Error(n(284));if(!F._owner)throw Error(n(290,v))}return v}function Ch(v,S){throw v=Object.prototype.toString.call(S),Error(n(31,v==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":v))}function pm(v){var S=v._init;return S(v._payload)}function Md(v){function S(Ft,Tt){if(v){var Vt=Ft.deletions;Vt===null?(Ft.deletions=[Tt],Ft.flags|=16):Vt.push(Tt)}}function F(Ft,Tt){if(!v)return null;for(;Tt!==null;)S(Ft,Tt),Tt=Tt.sibling;return null}function H(Ft,Tt){for(Ft=new Map;Tt!==null;)Tt.key!==null?Ft.set(Tt.key,Tt):Ft.set(Tt.index,Tt),Tt=Tt.sibling;return Ft}function se(Ft,Tt){return Ft=gu(Ft,Tt),Ft.index=0,Ft.sibling=null,Ft}function de(Ft,Tt,Vt){return Ft.index=Vt,v?(Vt=Ft.alternate,Vt!==null?(Vt=Vt.index,Vt<Tt?(Ft.flags|=2,Tt):Vt):(Ft.flags|=2,Tt)):(Ft.flags|=1048576,Tt)}function Le(Ft){return v&&Ft.alternate===null&&(Ft.flags|=2),Ft}function ht(Ft,Tt,Vt,Tn){return Tt===null||Tt.tag!==6?(Tt=Fx(Vt,Ft.mode,Tn),Tt.return=Ft,Tt):(Tt=se(Tt,Vt),Tt.return=Ft,Tt)}function yt(Ft,Tt,Vt,Tn){var or=Vt.type;return or===ye?yn(Ft,Tt,Vt.props.children,Tn,Vt.key):Tt!==null&&(Tt.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===Ve&&pm(or)===Tt.type)?(Tn=se(Tt,Vt.props),Tn.ref=Ll(Ft,Tt,Vt),Tn.return=Ft,Tn):(Tn=up(Vt.type,Vt.key,Vt.props,null,Ft.mode,Tn),Tn.ref=Ll(Ft,Tt,Vt),Tn.return=Ft,Tn)}function $t(Ft,Tt,Vt,Tn){return Tt===null||Tt.tag!==4||Tt.stateNode.containerInfo!==Vt.containerInfo||Tt.stateNode.implementation!==Vt.implementation?(Tt=Vv(Vt,Ft.mode,Tn),Tt.return=Ft,Tt):(Tt=se(Tt,Vt.children||[]),Tt.return=Ft,Tt)}function yn(Ft,Tt,Vt,Tn,or){return Tt===null||Tt.tag!==7?(Tt=cp(Vt,Ft.mode,Tn,or),Tt.return=Ft,Tt):(Tt=se(Tt,Vt),Tt.return=Ft,Tt)}function xn(Ft,Tt,Vt){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return Tt=Fx(""+Tt,Ft.mode,Vt),Tt.return=Ft,Tt;if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case he:return Vt=up(Tt.type,Tt.key,Tt.props,null,Ft.mode,Vt),Vt.ref=Ll(Ft,null,Tt),Vt.return=Ft,Vt;case xe:return Tt=Vv(Tt,Ft.mode,Vt),Tt.return=Ft,Tt;case Ve:var Tn=Tt._init;return xn(Ft,Tn(Tt._payload),Vt)}if(Bs(Tt)||tt(Tt))return Tt=cp(Tt,Ft.mode,Vt,null),Tt.return=Ft,Tt;Ch(Ft,Tt)}return null}function pn(Ft,Tt,Vt,Tn){var or=Tt!==null?Tt.key:null;if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return or!==null?null:ht(Ft,Tt,""+Vt,Tn);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case he:return Vt.key===or?yt(Ft,Tt,Vt,Tn):null;case xe:return Vt.key===or?$t(Ft,Tt,Vt,Tn):null;case Ve:return or=Vt._init,pn(Ft,Tt,or(Vt._payload),Tn)}if(Bs(Vt)||tt(Vt))return or!==null?null:yn(Ft,Tt,Vt,Tn,null);Ch(Ft,Vt)}return null}function Bn(Ft,Tt,Vt,Tn,or){if(typeof Tn=="string"&&Tn!==""||typeof Tn=="number")return Ft=Ft.get(Vt)||null,ht(Tt,Ft,""+Tn,or);if(typeof Tn=="object"&&Tn!==null){switch(Tn.$$typeof){case he:return Ft=Ft.get(Tn.key===null?Vt:Tn.key)||null,yt(Tt,Ft,Tn,or);case xe:return Ft=Ft.get(Tn.key===null?Vt:Tn.key)||null,$t(Tt,Ft,Tn,or);case Ve:var br=Tn._init;return Bn(Ft,Tt,Vt,br(Tn._payload),or)}if(Bs(Tn)||tt(Tn))return Ft=Ft.get(Vt)||null,yn(Tt,Ft,Tn,or,null);Ch(Tt,Tn)}return null}function Kn(Ft,Tt,Vt,Tn){for(var or=null,br=null,wr=Tt,Br=Tt=0,Ss=null;wr!==null&&Br<Vt.length;Br++){wr.index>Br?(Ss=wr,wr=null):Ss=wr.sibling;var Oi=pn(Ft,wr,Vt[Br],Tn);if(Oi===null){wr===null&&(wr=Ss);break}v&&wr&&Oi.alternate===null&&S(Ft,wr),Tt=de(Oi,Tt,Br),br===null?or=Oi:br.sibling=Oi,br=Oi,wr=Ss}if(Br===Vt.length)return F(Ft,wr),lo&&Pc(Ft,Br),or;if(wr===null){for(;Br<Vt.length;Br++)wr=xn(Ft,Vt[Br],Tn),wr!==null&&(Tt=de(wr,Tt,Br),br===null?or=wr:br.sibling=wr,br=wr);return lo&&Pc(Ft,Br),or}for(wr=H(Ft,wr);Br<Vt.length;Br++)Ss=Bn(wr,Ft,Br,Vt[Br],Tn),Ss!==null&&(v&&Ss.alternate!==null&&wr.delete(Ss.key===null?Br:Ss.key),Tt=de(Ss,Tt,Br),br===null?or=Ss:br.sibling=Ss,br=Ss);return v&&wr.forEach(function(Nh){return S(Ft,Nh)}),lo&&Pc(Ft,Br),or}function tr(Ft,Tt,Vt,Tn){var or=tt(Vt);if(typeof or!="function")throw Error(n(150));if(Vt=or.call(Vt),Vt==null)throw Error(n(151));for(var br=or=null,wr=Tt,Br=Tt=0,Ss=null,Oi=Vt.next();wr!==null&&!Oi.done;Br++,Oi=Vt.next()){wr.index>Br?(Ss=wr,wr=null):Ss=wr.sibling;var Nh=pn(Ft,wr,Oi.value,Tn);if(Nh===null){wr===null&&(wr=Ss);break}v&&wr&&Nh.alternate===null&&S(Ft,wr),Tt=de(Nh,Tt,Br),br===null?or=Nh:br.sibling=Nh,br=Nh,wr=Ss}if(Oi.done)return F(Ft,wr),lo&&Pc(Ft,Br),or;if(wr===null){for(;!Oi.done;Br++,Oi=Vt.next())Oi=xn(Ft,Oi.value,Tn),Oi!==null&&(Tt=de(Oi,Tt,Br),br===null?or=Oi:br.sibling=Oi,br=Oi);return lo&&Pc(Ft,Br),or}for(wr=H(Ft,wr);!Oi.done;Br++,Oi=Vt.next())Oi=Bn(wr,Ft,Br,Oi.value,Tn),Oi!==null&&(v&&Oi.alternate!==null&&wr.delete(Oi.key===null?Br:Oi.key),Tt=de(Oi,Tt,Br),br===null?or=Oi:br.sibling=Oi,br=Oi);return v&&wr.forEach(function(nw){return S(Ft,nw)}),lo&&Pc(Ft,Br),or}function xo(Ft,Tt,Vt,Tn){if(typeof Vt=="object"&&Vt!==null&&Vt.type===ye&&Vt.key===null&&(Vt=Vt.props.children),typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case he:e:{for(var or=Vt.key,br=Tt;br!==null;){if(br.key===or){if(or=Vt.type,or===ye){if(br.tag===7){F(Ft,br.sibling),Tt=se(br,Vt.props.children),Tt.return=Ft,Ft=Tt;break e}}else if(br.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===Ve&&pm(or)===br.type){F(Ft,br.sibling),Tt=se(br,Vt.props),Tt.ref=Ll(Ft,br,Vt),Tt.return=Ft,Ft=Tt;break e}F(Ft,br);break}else S(Ft,br);br=br.sibling}Vt.type===ye?(Tt=cp(Vt.props.children,Ft.mode,Tn,Vt.key),Tt.return=Ft,Ft=Tt):(Tn=up(Vt.type,Vt.key,Vt.props,null,Ft.mode,Tn),Tn.ref=Ll(Ft,Tt,Vt),Tn.return=Ft,Ft=Tn)}return Le(Ft);case xe:e:{for(br=Vt.key;Tt!==null;){if(Tt.key===br)if(Tt.tag===4&&Tt.stateNode.containerInfo===Vt.containerInfo&&Tt.stateNode.implementation===Vt.implementation){F(Ft,Tt.sibling),Tt=se(Tt,Vt.children||[]),Tt.return=Ft,Ft=Tt;break e}else{F(Ft,Tt);break}else S(Ft,Tt);Tt=Tt.sibling}Tt=Vv(Vt,Ft.mode,Tn),Tt.return=Ft,Ft=Tt}return Le(Ft);case Ve:return br=Vt._init,xo(Ft,Tt,br(Vt._payload),Tn)}if(Bs(Vt))return Kn(Ft,Tt,Vt,Tn);if(tt(Vt))return tr(Ft,Tt,Vt,Tn);Ch(Ft,Vt)}return typeof Vt=="string"&&Vt!==""||typeof Vt=="number"?(Vt=""+Vt,Tt!==null&&Tt.tag===6?(F(Ft,Tt.sibling),Tt=se(Tt,Vt),Tt.return=Ft,Ft=Tt):(F(Ft,Tt),Tt=Fx(Vt,Ft.mode,Tn),Tt.return=Ft,Ft=Tt),Le(Ft)):F(Ft,Tt)}return xo}var Rc=Md(!0),hy=Md(!1),da=$s(null),ei=null,uu=null,mm=null;function gm(){mm=uu=ei=null}function Yf(v){var S=da.current;Xi(da),v._currentValue=S}function Pd(v,S,F){for(;v!==null;){var H=v.alternate;if((v.childLanes&S)!==S?(v.childLanes|=S,H!==null&&(H.childLanes|=S)):H!==null&&(H.childLanes&S)!==S&&(H.childLanes|=S),v===F)break;v=v.return}}function cu(v,S){ei=v,mm=uu=null,v=v.dependencies,v!==null&&v.firstContext!==null&&((v.lanes&S)!==0&&(pa=!0),v.firstContext=null)}function Ms(v){var S=v._currentValue;if(mm!==v)if(v={context:v,memoizedValue:S,next:null},uu===null){if(ei===null)throw Error(n(308));uu=v,ei.dependencies={lanes:0,firstContext:v}}else uu=uu.next=v;return S}var Ol=null;function Xt(v){Ol===null?Ol=[v]:Ol.push(v)}function ln(v,S,F,H){var se=S.interleaved;return se===null?(F.next=F,Xt(S)):(F.next=se.next,se.next=F),S.interleaved=F,ka(v,H)}function ka(v,S){v.lanes|=S;var F=v.alternate;for(F!==null&&(F.lanes|=S),F=v,v=v.return;v!==null;)v.childLanes|=S,F=v.alternate,F!==null&&(F.childLanes|=S),F=v,v=v.return;return F.tag===3?F.stateNode:null}var li=!1;function ft(v){v.updateQueue={baseState:v.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dy(v,S){v=v.updateQueue,S.updateQueue===v&&(S.updateQueue={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,effects:v.effects})}function Dl(v,S){return{eventTime:v,lane:S,tag:0,payload:null,callback:null,next:null}}function Xu(v,S,F){var H=v.updateQueue;if(H===null)return null;if(H=H.shared,(Pe&2)!==0){var se=H.pending;return se===null?S.next=S:(S.next=se.next,se.next=S),H.pending=S,ka(v,F)}return se=H.interleaved,se===null?(S.next=S,Xt(H)):(S.next=se.next,se.next=S),H.interleaved=S,ka(v,F)}function Kf(v,S,F){if(S=S.updateQueue,S!==null&&(S=S.shared,(F&4194240)!==0)){var H=S.lanes;H&=v.pendingLanes,F|=H,S.lanes=F,Us(v,F)}}function fy(v,S){var F=v.updateQueue,H=v.alternate;if(H!==null&&(H=H.updateQueue,F===H)){var se=null,de=null;if(F=F.firstBaseUpdate,F!==null){do{var Le={eventTime:F.eventTime,lane:F.lane,tag:F.tag,payload:F.payload,callback:F.callback,next:null};de===null?se=de=Le:de=de.next=Le,F=F.next}while(F!==null);de===null?se=de=S:de=de.next=S}else se=de=S;F={baseState:H.baseState,firstBaseUpdate:se,lastBaseUpdate:de,shared:H.shared,effects:H.effects},v.updateQueue=F;return}v=F.lastBaseUpdate,v===null?F.firstBaseUpdate=S:v.next=S,F.lastBaseUpdate=S}function _m(v,S,F,H){var se=v.updateQueue;li=!1;var de=se.firstBaseUpdate,Le=se.lastBaseUpdate,ht=se.shared.pending;if(ht!==null){se.shared.pending=null;var yt=ht,$t=yt.next;yt.next=null,Le===null?de=$t:Le.next=$t,Le=yt;var yn=v.alternate;yn!==null&&(yn=yn.updateQueue,ht=yn.lastBaseUpdate,ht!==Le&&(ht===null?yn.firstBaseUpdate=$t:ht.next=$t,yn.lastBaseUpdate=yt))}if(de!==null){var xn=se.baseState;Le=0,yn=$t=yt=null,ht=de;do{var pn=ht.lane,Bn=ht.eventTime;if((H&pn)===pn){yn!==null&&(yn=yn.next={eventTime:Bn,lane:0,tag:ht.tag,payload:ht.payload,callback:ht.callback,next:null});e:{var Kn=v,tr=ht;switch(pn=S,Bn=F,tr.tag){case 1:if(Kn=tr.payload,typeof Kn=="function"){xn=Kn.call(Bn,xn,pn);break e}xn=Kn;break e;case 3:Kn.flags=Kn.flags&-65537|128;case 0:if(Kn=tr.payload,pn=typeof Kn=="function"?Kn.call(Bn,xn,pn):Kn,pn==null)break e;xn=Dt({},xn,pn);break e;case 2:li=!0}}ht.callback!==null&&ht.lane!==0&&(v.flags|=64,pn=se.effects,pn===null?se.effects=[ht]:pn.push(ht))}else Bn={eventTime:Bn,lane:pn,tag:ht.tag,payload:ht.payload,callback:ht.callback,next:null},yn===null?($t=yn=Bn,yt=xn):yn=yn.next=Bn,Le|=pn;if(ht=ht.next,ht===null){if(ht=se.shared.pending,ht===null)break;pn=ht,ht=pn.next,pn.next=null,se.lastBaseUpdate=pn,se.shared.pending=null}}while(!0);if(yn===null&&(yt=xn),se.baseState=yt,se.firstBaseUpdate=$t,se.lastBaseUpdate=yn,S=se.shared.interleaved,S!==null){se=S;do Le|=se.lane,se=se.next;while(se!==S)}else de===null&&(se.shared.lanes=0);vt|=Le,v.lanes=Le,v.memoizedState=xn}}function Ad(v,S,F){if(v=S.effects,S.effects=null,v!==null)for(S=0;S<v.length;S++){var H=v[S],se=H.callback;if(se!==null){if(H.callback=null,H=F,typeof se!="function")throw Error(n(191,se));se.call(H)}}}var ym={},Zu=$s(ym),Jf=$s(ym),Th=$s(ym);function Fa(v){if(v===ym)throw Error(n(174));return v}function vm(v,S){switch(Ri(Th,S),Ri(Jf,v),Ri(Zu,ym),v=S.nodeType,v){case 9:case 11:S=(S=S.documentElement)?S.namespaceURI:Kl(null,"");break;default:v=v===8?S.parentNode:S,S=v.namespaceURI||null,v=v.tagName,S=Kl(S,v)}Xi(Zu),Ri(Zu,S)}function Ih(){Xi(Zu),Xi(Jf),Xi(Th)}function Mh(v){Fa(Th.current);var S=Fa(Zu.current),F=Kl(S,v.type);S!==F&&(Ri(Jf,v),Ri(Zu,F))}function Qf(v){Jf.current===v&&(Xi(Zu),Xi(Jf))}var Gi=$s(0);function Nl(v){for(var S=v;S!==null;){if(S.tag===13){var F=S.memoizedState;if(F!==null&&(F=F.dehydrated,F===null||F.data==="$?"||F.data==="$!"))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var Og=[];function Oo(){for(var v=0;v<Og.length;v++)Og[v]._workInProgressVersionPrimary=null;Og.length=0}var Dg=ae.ReactCurrentDispatcher,Rd=ae.ReactCurrentBatchConfig,Jr=0,qn=null,Jo=null,eo=null,Lc=!1,ul=!1,hu=0,xm=0;function bs(){throw Error(n(321))}function za(v,S){if(S===null)return!1;for(var F=0;F<S.length&&F<v.length;F++)if(!Cs(v[F],S[F]))return!1;return!0}function bm(v,S,F,H,se,de){if(Jr=de,qn=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,Dg.current=v===null||v.memoizedState===null?Ba:Am,v=F(H,se),ul){de=0;do{if(ul=!1,hu=0,25<=de)throw Error(n(301));de+=1,eo=Jo=null,S.updateQueue=null,Dg.current=kv,v=F(H,se)}while(ul)}if(Dg.current=Lh,S=Jo!==null&&Jo.next!==null,Jr=0,eo=Jo=qn=null,Lc=!1,S)throw Error(n(300));return v}function cl(){var v=hu!==0;return hu=0,v}function Ps(){var v={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return eo===null?qn.memoizedState=eo=v:eo=eo.next=v,eo}function fa(){if(Jo===null){var v=qn.alternate;v=v!==null?v.memoizedState:null}else v=Jo.next;var S=eo===null?qn.memoizedState:eo.next;if(S!==null)eo=S,Jo=v;else{if(v===null)throw Error(n(310));Jo=v,v={memoizedState:Jo.memoizedState,baseState:Jo.baseState,baseQueue:Jo.baseQueue,queue:Jo.queue,next:null},eo===null?qn.memoizedState=eo=v:eo=eo.next=v}return eo}function Ph(v,S){return typeof S=="function"?S(v):S}function wm(v){var S=fa(),F=S.queue;if(F===null)throw Error(n(311));F.lastRenderedReducer=v;var H=Jo,se=H.baseQueue,de=F.pending;if(de!==null){if(se!==null){var Le=se.next;se.next=de.next,de.next=Le}H.baseQueue=se=de,F.pending=null}if(se!==null){de=se.next,H=H.baseState;var ht=Le=null,yt=null,$t=de;do{var yn=$t.lane;if((Jr&yn)===yn)yt!==null&&(yt=yt.next={lane:0,action:$t.action,hasEagerState:$t.hasEagerState,eagerState:$t.eagerState,next:null}),H=$t.hasEagerState?$t.eagerState:v(H,$t.action);else{var xn={lane:yn,action:$t.action,hasEagerState:$t.hasEagerState,eagerState:$t.eagerState,next:null};yt===null?(ht=yt=xn,Le=H):yt=yt.next=xn,qn.lanes|=yn,vt|=yn}$t=$t.next}while($t!==null&&$t!==de);yt===null?Le=H:yt.next=ht,Cs(H,S.memoizedState)||(pa=!0),S.memoizedState=H,S.baseState=Le,S.baseQueue=yt,F.lastRenderedState=H}if(v=F.interleaved,v!==null){se=v;do de=se.lane,qn.lanes|=de,vt|=de,se=se.next;while(se!==v)}else se===null&&(F.lanes=0);return[S.memoizedState,F.dispatch]}function Sm(v){var S=fa(),F=S.queue;if(F===null)throw Error(n(311));F.lastRenderedReducer=v;var H=F.dispatch,se=F.pending,de=S.memoizedState;if(se!==null){F.pending=null;var Le=se=se.next;do de=v(de,Le.action),Le=Le.next;while(Le!==se);Cs(de,S.memoizedState)||(pa=!0),S.memoizedState=de,S.baseQueue===null&&(S.baseState=de),F.lastRenderedState=de}return[de,H]}function Ah(){}function Ng(v,S){var F=qn,H=fa(),se=S(),de=!Cs(H.memoizedState,se);if(de&&(H.memoizedState=se,pa=!0),H=H.queue,Cm(ep.bind(null,F,H,v),[v]),H.getSnapshot!==S||de||eo!==null&&eo.memoizedState.tag&1){if(F.flags|=2048,Rh(9,kg.bind(null,F,H,se,S),void 0,null),Ie===null)throw Error(n(349));(Jr&30)!==0||Oc(F,S,se)}return se}function Oc(v,S,F){v.flags|=16384,v={getSnapshot:S,value:F},S=qn.updateQueue,S===null?(S={lastEffect:null,stores:null},qn.updateQueue=S,S.stores=[v]):(F=S.stores,F===null?S.stores=[v]:F.push(v))}function kg(v,S,F,H){S.value=F,S.getSnapshot=H,Fg(S)&&zg(v)}function ep(v,S,F){return F(function(){Fg(S)&&zg(v)})}function Fg(v){var S=v.getSnapshot;v=v.value;try{var F=S();return!Cs(v,F)}catch{return!0}}function zg(v){var S=ka(v,1);S!==null&&Mn(S,v,1,-1)}function Qo(v){var S=Ps();return typeof v=="function"&&(v=v()),S.memoizedState=S.baseState=v,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ph,lastRenderedState:v},S.queue=v,v=v.dispatch=Nv.bind(null,qn,v),[S.memoizedState,v]}function Rh(v,S,F,H){return v={tag:v,create:S,destroy:F,deps:H,next:null},S=qn.updateQueue,S===null?(S={lastEffect:null,stores:null},qn.updateQueue=S,S.lastEffect=v.next=v):(F=S.lastEffect,F===null?S.lastEffect=v.next=v:(H=F.next,F.next=v,v.next=H,S.lastEffect=v)),v}function Em(){return fa().memoizedState}function As(v,S,F,H){var se=Ps();qn.flags|=v,se.memoizedState=Rh(1|S,F,void 0,H===void 0?null:H)}function Ld(v,S,F,H){var se=fa();H=H===void 0?null:H;var de=void 0;if(Jo!==null){var Le=Jo.memoizedState;if(de=Le.destroy,H!==null&&za(H,Le.deps)){se.memoizedState=Rh(S,F,de,H);return}}qn.flags|=v,se.memoizedState=Rh(1|S,F,de,H)}function Bg(v,S){return As(8390656,8,v,S)}function Cm(v,S){return Ld(2048,8,v,S)}function Od(v,S){return Ld(4,2,v,S)}function tp(v,S){return Ld(4,4,v,S)}function Tm(v,S){if(typeof S=="function")return v=v(),S(v),function(){S(null)};if(S!=null)return v=v(),S.current=v,function(){S.current=null}}function Im(v,S,F){return F=F!=null?F.concat([v]):null,Ld(4,4,Tm.bind(null,S,v),F)}function np(){}function Mm(v,S){var F=fa();S=S===void 0?null:S;var H=F.memoizedState;return H!==null&&S!==null&&za(S,H[1])?H[0]:(F.memoizedState=[v,S],v)}function jg(v,S){var F=fa();S=S===void 0?null:S;var H=F.memoizedState;return H!==null&&S!==null&&za(S,H[1])?H[0]:(v=v(),F.memoizedState=[v,S],v)}function Vg(v,S,F){return(Jr&21)===0?(v.baseState&&(v.baseState=!1,pa=!0),v.memoizedState=F):(Cs(F,S)||(F=Ra(),qn.lanes|=F,vt|=F,v.baseState=!0),S)}function Pm(v,S){var F=mi;mi=F!==0&&4>F?F:4,v(!0);var H=Rd.transition;Rd.transition={};try{v(!1),S()}finally{mi=F,Rd.transition=H}}function py(){return fa().memoizedState}function Dv(v,S,F){var H=Ln(v);if(F={lane:H,action:F,hasEagerState:!1,eagerState:null,next:null},my(v))gy(S,F);else if(F=ln(v,S,F,H),F!==null){var se=vn();Mn(F,v,H,se),rp(F,S,H)}}function Nv(v,S,F){var H=Ln(v),se={lane:H,action:F,hasEagerState:!1,eagerState:null,next:null};if(my(v))gy(S,se);else{var de=v.alternate;if(v.lanes===0&&(de===null||de.lanes===0)&&(de=S.lastRenderedReducer,de!==null))try{var Le=S.lastRenderedState,ht=de(Le,F);if(se.hasEagerState=!0,se.eagerState=ht,Cs(ht,Le)){var yt=S.interleaved;yt===null?(se.next=se,Xt(S)):(se.next=yt.next,yt.next=se),S.interleaved=se;return}}catch{}finally{}F=ln(v,S,se,H),F!==null&&(se=vn(),Mn(F,v,H,se),rp(F,S,H))}}function my(v){var S=v.alternate;return v===qn||S!==null&&S===qn}function gy(v,S){ul=Lc=!0;var F=v.pending;F===null?S.next=S:(S.next=F.next,F.next=S),v.pending=S}function rp(v,S,F){if((F&4194240)!==0){var H=S.lanes;H&=v.pendingLanes,F|=H,S.lanes=F,Us(v,F)}}var Lh={readContext:Ms,useCallback:bs,useContext:bs,useEffect:bs,useImperativeHandle:bs,useInsertionEffect:bs,useLayoutEffect:bs,useMemo:bs,useReducer:bs,useRef:bs,useState:bs,useDebugValue:bs,useDeferredValue:bs,useTransition:bs,useMutableSource:bs,useSyncExternalStore:bs,useId:bs,unstable_isNewReconciler:!1},Ba={readContext:Ms,useCallback:function(v,S){return Ps().memoizedState=[v,S===void 0?null:S],v},useContext:Ms,useEffect:Bg,useImperativeHandle:function(v,S,F){return F=F!=null?F.concat([v]):null,As(4194308,4,Tm.bind(null,S,v),F)},useLayoutEffect:function(v,S){return As(4194308,4,v,S)},useInsertionEffect:function(v,S){return As(4,2,v,S)},useMemo:function(v,S){var F=Ps();return S=S===void 0?null:S,v=v(),F.memoizedState=[v,S],v},useReducer:function(v,S,F){var H=Ps();return S=F!==void 0?F(S):S,H.memoizedState=H.baseState=S,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v,lastRenderedState:S},H.queue=v,v=v.dispatch=Dv.bind(null,qn,v),[H.memoizedState,v]},useRef:function(v){var S=Ps();return v={current:v},S.memoizedState=v},useState:Qo,useDebugValue:np,useDeferredValue:function(v){return Ps().memoizedState=v},useTransition:function(){var v=Qo(!1),S=v[0];return v=Pm.bind(null,v[1]),Ps().memoizedState=v,[S,v]},useMutableSource:function(){},useSyncExternalStore:function(v,S,F){var H=qn,se=Ps();if(lo){if(F===void 0)throw Error(n(407));F=F()}else{if(F=S(),Ie===null)throw Error(n(349));(Jr&30)!==0||Oc(H,S,F)}se.memoizedState=F;var de={value:F,getSnapshot:S};return se.queue=de,Bg(ep.bind(null,H,de,v),[v]),H.flags|=2048,Rh(9,kg.bind(null,H,de,F,S),void 0,null),F},useId:function(){var v=Ps(),S=Ie.identifierPrefix;if(lo){var F=au,H=on;F=(H&~(1<<32-Ro(H)-1)).toString(32)+F,S=":"+S+"R"+F,F=hu++,0<F&&(S+="H"+F.toString(32)),S+=":"}else F=xm++,S=":"+S+"r"+F.toString(32)+":";return v.memoizedState=S},unstable_isNewReconciler:!1},Am={readContext:Ms,useCallback:Mm,useContext:Ms,useEffect:Cm,useImperativeHandle:Im,useInsertionEffect:Od,useLayoutEffect:tp,useMemo:jg,useReducer:wm,useRef:Em,useState:function(){return wm(Ph)},useDebugValue:np,useDeferredValue:function(v){var S=fa();return Vg(S,Jo.memoizedState,v)},useTransition:function(){var v=wm(Ph)[0],S=fa().memoizedState;return[v,S]},useMutableSource:Ah,useSyncExternalStore:Ng,useId:py,unstable_isNewReconciler:!1},kv={readContext:Ms,useCallback:Mm,useContext:Ms,useEffect:Cm,useImperativeHandle:Im,useInsertionEffect:Od,useLayoutEffect:tp,useMemo:jg,useReducer:Sm,useRef:Em,useState:function(){return Sm(Ph)},useDebugValue:np,useDeferredValue:function(v){var S=fa();return Jo===null?S.memoizedState=v:Vg(S,Jo.memoizedState,v)},useTransition:function(){var v=Sm(Ph)[0],S=fa().memoizedState;return[v,S]},useMutableSource:Ah,useSyncExternalStore:Ng,useId:py,unstable_isNewReconciler:!1};function kl(v,S){if(v&&v.defaultProps){S=Dt({},S),v=v.defaultProps;for(var F in v)S[F]===void 0&&(S[F]=v[F]);return S}return S}function _y(v,S,F,H){S=v.memoizedState,F=F(H,S),F=F==null?S:Dt({},S,F),v.memoizedState=F,v.lanes===0&&(v.updateQueue.baseState=F)}var Ug={isMounted:function(v){return(v=v._reactInternals)?sn(v)===v:!1},enqueueSetState:function(v,S,F){v=v._reactInternals;var H=vn(),se=Ln(v),de=Dl(H,se);de.payload=S,F!=null&&(de.callback=F),S=Xu(v,de,se),S!==null&&(Mn(S,v,se,H),Kf(S,v,se))},enqueueReplaceState:function(v,S,F){v=v._reactInternals;var H=vn(),se=Ln(v),de=Dl(H,se);de.tag=1,de.payload=S,F!=null&&(de.callback=F),S=Xu(v,de,se),S!==null&&(Mn(S,v,se,H),Kf(S,v,se))},enqueueForceUpdate:function(v,S){v=v._reactInternals;var F=vn(),H=Ln(v),se=Dl(F,H);se.tag=2,S!=null&&(se.callback=S),S=Xu(v,se,H),S!==null&&(Mn(S,v,H,F),Kf(S,v,H))}};function xi(v,S,F,H,se,de,Le){return v=v.stateNode,typeof v.shouldComponentUpdate=="function"?v.shouldComponentUpdate(H,de,Le):S.prototype&&S.prototype.isPureReactComponent?!Qp(F,H)||!Qp(se,de):!0}function yy(v,S,F){var H=!1,se=ou,de=S.contextType;return typeof de=="object"&&de!==null?de=Ms(de):(se=la(S)?qu:Ts.current,H=S.contextTypes,de=(H=H!=null)?Td(v,se):ou),S=new S(F,de),v.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Ug,v.stateNode=S,S._reactInternals=v,H&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=se,v.__reactInternalMemoizedMaskedChildContext=de),S}function Gg(v,S,F,H){v=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(F,H),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(F,H),S.state!==v&&Ug.enqueueReplaceState(S,S.state,null)}function vy(v,S,F,H){var se=v.stateNode;se.props=F,se.state=v.memoizedState,se.refs={},ft(v);var de=S.contextType;typeof de=="object"&&de!==null?se.context=Ms(de):(de=la(S)?qu:Ts.current,se.context=Td(v,de)),se.state=v.memoizedState,de=S.getDerivedStateFromProps,typeof de=="function"&&(_y(v,S,de,F),se.state=v.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof se.getSnapshotBeforeUpdate=="function"||typeof se.UNSAFE_componentWillMount!="function"&&typeof se.componentWillMount!="function"||(S=se.state,typeof se.componentWillMount=="function"&&se.componentWillMount(),typeof se.UNSAFE_componentWillMount=="function"&&se.UNSAFE_componentWillMount(),S!==se.state&&Ug.enqueueReplaceState(se,se.state,null),_m(v,F,se,H),se.state=v.memoizedState),typeof se.componentDidMount=="function"&&(v.flags|=4194308)}function Yu(v,S){try{var F="",H=S;do F+=Kt(H),H=H.return;while(H);var se=F}catch(de){se=`
Error generating stack: `+de.message+`
`+de.stack}return{value:v,source:S,stack:se,digest:null}}function Rm(v,S,F){return{value:v,source:null,stack:F??null,digest:S??null}}function Dd(v,S){try{console.error(S.value)}catch(F){setTimeout(function(){throw F})}}var $g=typeof WeakMap=="function"?WeakMap:Map;function du(v,S,F){F=Dl(-1,F),F.tag=3,F.payload={element:null};var H=S.value;return F.callback=function(){Mt||(Mt=!0,St=H),Dd(v,S)},F}function ip(v,S,F){F=Dl(-1,F),F.tag=3;var H=v.type.getDerivedStateFromError;if(typeof H=="function"){var se=S.value;F.payload=function(){return H(se)},F.callback=function(){Dd(v,S)}}var de=v.stateNode;return de!==null&&typeof de.componentDidCatch=="function"&&(F.callback=function(){Dd(v,S),typeof H!="function"&&(Rt===null?Rt=new Set([this]):Rt.add(this));var Le=S.stack;this.componentDidCatch(S.value,{componentStack:Le!==null?Le:""})}),F}function to(v,S,F){var H=v.pingCache;if(H===null){H=v.pingCache=new $g;var se=new Set;H.set(S,se)}else se=H.get(S),se===void 0&&(se=new Set,H.set(S,se));se.has(F)||(se.add(F),v=Ua.bind(null,v,S,F),S.then(v,v))}function hl(v){do{var S;if((S=v.tag===13)&&(S=v.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return v;v=v.return}while(v!==null);return null}function Nd(v,S,F,H,se){return(v.mode&1)===0?(v===S?v.flags|=65536:(v.flags|=128,F.flags|=131072,F.flags&=-52805,F.tag===1&&(F.alternate===null?F.tag=17:(S=Dl(-1,1),S.tag=2,Xu(F,S,1))),F.lanes|=1),v):(v.flags|=65536,v.lanes=se,v)}var Lm=ae.ReactCurrentOwner,pa=!1;function Hs(v,S,F,H){S.child=v===null?hy(S,null,F,H):Rc(S,v.child,F,H)}function op(v,S,F,H,se){F=F.render;var de=S.ref;return cu(S,se),H=bm(v,S,F,H,de,se),F=cl(),v!==null&&!pa?(S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~se,Ju(v,S,se)):(lo&&F&&ua(S),S.flags|=1,Hs(v,S,H,se),S.child)}function qg(v,S,F,H,se){if(v===null){var de=F.type;return typeof de=="function"&&!Nm(de)&&de.defaultProps===void 0&&F.compare===null&&F.defaultProps===void 0?(S.tag=15,S.type=de,Fv(v,S,de,H,se)):(v=up(F.type,null,H,S,S.mode,se),v.ref=S.ref,v.return=S,S.child=v)}if(de=v.child,(v.lanes&se)===0){var Le=de.memoizedProps;if(F=F.compare,F=F!==null?F:Qp,F(Le,H)&&v.ref===S.ref)return Ju(v,S,se)}return S.flags|=1,v=gu(de,H),v.ref=S.ref,v.return=S,S.child=v}function Fv(v,S,F,H,se){if(v!==null){var de=v.memoizedProps;if(Qp(de,H)&&v.ref===S.ref)if(pa=!1,S.pendingProps=H=de,(v.lanes&se)!==0)(v.flags&131072)!==0&&(pa=!0);else return S.lanes=v.lanes,Ju(v,S,se)}return kd(v,S,F,H,se)}function Hg(v,S,F){var H=S.pendingProps,se=H.children,de=v!==null?v.memoizedState:null;if(H.mode==="hidden")if((S.mode&1)===0)S.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ri(ze,Ne),Ne|=F;else{if((F&1073741824)===0)return v=de!==null?de.baseLanes|F:F,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:v,cachePool:null,transitions:null},S.updateQueue=null,Ri(ze,Ne),Ne|=v,null;S.memoizedState={baseLanes:0,cachePool:null,transitions:null},H=de!==null?de.baseLanes:F,Ri(ze,Ne),Ne|=H}else de!==null?(H=de.baseLanes|F,S.memoizedState=null):H=F,Ri(ze,Ne),Ne|=H;return Hs(v,S,se,F),S.child}function Wg(v,S){var F=S.ref;(v===null&&F!==null||v!==null&&v.ref!==F)&&(S.flags|=512,S.flags|=2097152)}function kd(v,S,F,H,se){var de=la(F)?qu:Ts.current;return de=Td(S,de),cu(S,se),F=bm(v,S,F,H,de,se),H=cl(),v!==null&&!pa?(S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~se,Ju(v,S,se)):(lo&&H&&ua(S),S.flags|=1,Hs(v,S,F,se),S.child)}function Oh(v,S,F,H,se){if(la(F)){var de=!0;Hf(S)}else de=!1;if(cu(S,se),S.stateNode===null)Om(v,S),yy(S,F,H),vy(S,F,H,se),H=!0;else if(v===null){var Le=S.stateNode,ht=S.memoizedProps;Le.props=ht;var yt=Le.context,$t=F.contextType;typeof $t=="object"&&$t!==null?$t=Ms($t):($t=la(F)?qu:Ts.current,$t=Td(S,$t));var yn=F.getDerivedStateFromProps,xn=typeof yn=="function"||typeof Le.getSnapshotBeforeUpdate=="function";xn||typeof Le.UNSAFE_componentWillReceiveProps!="function"&&typeof Le.componentWillReceiveProps!="function"||(ht!==H||yt!==$t)&&Gg(S,Le,H,$t),li=!1;var pn=S.memoizedState;Le.state=pn,_m(S,H,Le,se),yt=S.memoizedState,ht!==H||pn!==yt||qs.current||li?(typeof yn=="function"&&(_y(S,F,yn,H),yt=S.memoizedState),(ht=li||xi(S,F,ht,H,pn,yt,$t))?(xn||typeof Le.UNSAFE_componentWillMount!="function"&&typeof Le.componentWillMount!="function"||(typeof Le.componentWillMount=="function"&&Le.componentWillMount(),typeof Le.UNSAFE_componentWillMount=="function"&&Le.UNSAFE_componentWillMount()),typeof Le.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Le.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=H,S.memoizedState=yt),Le.props=H,Le.state=yt,Le.context=$t,H=ht):(typeof Le.componentDidMount=="function"&&(S.flags|=4194308),H=!1)}else{Le=S.stateNode,dy(v,S),ht=S.memoizedProps,$t=S.type===S.elementType?ht:kl(S.type,ht),Le.props=$t,xn=S.pendingProps,pn=Le.context,yt=F.contextType,typeof yt=="object"&&yt!==null?yt=Ms(yt):(yt=la(F)?qu:Ts.current,yt=Td(S,yt));var Bn=F.getDerivedStateFromProps;(yn=typeof Bn=="function"||typeof Le.getSnapshotBeforeUpdate=="function")||typeof Le.UNSAFE_componentWillReceiveProps!="function"&&typeof Le.componentWillReceiveProps!="function"||(ht!==xn||pn!==yt)&&Gg(S,Le,H,yt),li=!1,pn=S.memoizedState,Le.state=pn,_m(S,H,Le,se);var Kn=S.memoizedState;ht!==xn||pn!==Kn||qs.current||li?(typeof Bn=="function"&&(_y(S,F,Bn,H),Kn=S.memoizedState),($t=li||xi(S,F,$t,H,pn,Kn,yt)||!1)?(yn||typeof Le.UNSAFE_componentWillUpdate!="function"&&typeof Le.componentWillUpdate!="function"||(typeof Le.componentWillUpdate=="function"&&Le.componentWillUpdate(H,Kn,yt),typeof Le.UNSAFE_componentWillUpdate=="function"&&Le.UNSAFE_componentWillUpdate(H,Kn,yt)),typeof Le.componentDidUpdate=="function"&&(S.flags|=4),typeof Le.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Le.componentDidUpdate!="function"||ht===v.memoizedProps&&pn===v.memoizedState||(S.flags|=4),typeof Le.getSnapshotBeforeUpdate!="function"||ht===v.memoizedProps&&pn===v.memoizedState||(S.flags|=1024),S.memoizedProps=H,S.memoizedState=Kn),Le.props=H,Le.state=Kn,Le.context=yt,H=$t):(typeof Le.componentDidUpdate!="function"||ht===v.memoizedProps&&pn===v.memoizedState||(S.flags|=4),typeof Le.getSnapshotBeforeUpdate!="function"||ht===v.memoizedProps&&pn===v.memoizedState||(S.flags|=1024),H=!1)}return fu(v,S,F,H,de,se)}function fu(v,S,F,H,se,de){Wg(v,S);var Le=(S.flags&128)!==0;if(!H&&!Le)return se&&cm(S,F,!1),Ju(v,S,de);H=S.stateNode,Lm.current=S;var ht=Le&&typeof F.getDerivedStateFromError!="function"?null:H.render();return S.flags|=1,v!==null&&Le?(S.child=Rc(S,v.child,null,de),S.child=Rc(S,null,ht,de)):Hs(v,S,ht,de),S.memoizedState=H.state,se&&cm(S,F,!0),S.child}function Fl(v){var S=v.stateNode;S.pendingContext?Ov(v,S.pendingContext,S.pendingContext!==S.context):S.context&&Ov(v,S.context,!1),vm(v,S.containerInfo)}function Dc(v,S,F,H,se){return Eh(),fm(se),S.flags|=256,Hs(v,S,F,H),S.child}var Nc={dehydrated:null,treeContext:null,retryLane:0};function Ku(v){return{baseLanes:v,cachePool:null,transitions:null}}function zv(v,S,F){var H=S.pendingProps,se=Gi.current,de=!1,Le=(S.flags&128)!==0,ht;if((ht=Le)||(ht=v!==null&&v.memoizedState===null?!1:(se&2)!==0),ht?(de=!0,S.flags&=-129):(v===null||v.memoizedState!==null)&&(se|=1),Ri(Gi,se&1),v===null)return dm(S),v=S.memoizedState,v!==null&&(v=v.dehydrated,v!==null)?((S.mode&1)===0?S.lanes=1:v.data==="$!"?S.lanes=8:S.lanes=1073741824,null):(Le=H.children,v=H.fallback,de?(H=S.mode,de=S.child,Le={mode:"hidden",children:Le},(H&1)===0&&de!==null?(de.childLanes=0,de.pendingProps=Le):de=jv(Le,H,0,null),v=cp(v,H,F,null),de.return=S,v.return=S,de.sibling=v,S.child=de,S.child.memoizedState=Ku(F),S.memoizedState=Nc,v):xy(S,Le));if(se=v.memoizedState,se!==null&&(ht=se.dehydrated,ht!==null))return Zg(v,S,Le,H,ht,se,F);if(de){de=H.fallback,Le=S.mode,se=v.child,ht=se.sibling;var yt={mode:"hidden",children:H.children};return(Le&1)===0&&S.child!==se?(H=S.child,H.childLanes=0,H.pendingProps=yt,S.deletions=null):(H=gu(se,yt),H.subtreeFlags=se.subtreeFlags&14680064),ht!==null?de=gu(ht,de):(de=cp(de,Le,F,null),de.flags|=2),de.return=S,H.return=S,H.sibling=de,S.child=H,H=de,de=S.child,Le=v.child.memoizedState,Le=Le===null?Ku(F):{baseLanes:Le.baseLanes|F,cachePool:null,transitions:Le.transitions},de.memoizedState=Le,de.childLanes=v.childLanes&~F,S.memoizedState=Nc,H}return de=v.child,v=de.sibling,H=gu(de,{mode:"visible",children:H.children}),(S.mode&1)===0&&(H.lanes=F),H.return=S,H.sibling=null,v!==null&&(F=S.deletions,F===null?(S.deletions=[v],S.flags|=16):F.push(v)),S.child=H,S.memoizedState=null,H}function xy(v,S){return S=jv({mode:"visible",children:S},v.mode,0,null),S.return=v,v.child=S}function Xg(v,S,F,H){return H!==null&&fm(H),Rc(S,v.child,null,F),v=xy(S,S.pendingProps.children),v.flags|=2,S.memoizedState=null,v}function Zg(v,S,F,H,se,de,Le){if(F)return S.flags&256?(S.flags&=-257,H=Rm(Error(n(422))),Xg(v,S,Le,H)):S.memoizedState!==null?(S.child=v.child,S.flags|=128,null):(de=H.fallback,se=S.mode,H=jv({mode:"visible",children:H.children},se,0,null),de=cp(de,se,Le,null),de.flags|=2,H.return=S,de.return=S,H.sibling=de,S.child=H,(S.mode&1)!==0&&Rc(S,v.child,null,Le),S.child.memoizedState=Ku(Le),S.memoizedState=Nc,de);if((S.mode&1)===0)return Xg(v,S,Le,null);if(se.data==="$!"){if(H=se.nextSibling&&se.nextSibling.dataset,H)var ht=H.dgst;return H=ht,de=Error(n(419)),H=Rm(de,H,void 0),Xg(v,S,Le,H)}if(ht=(Le&v.childLanes)!==0,pa||ht){if(H=Ie,H!==null){switch(Le&-Le){case 4:se=2;break;case 16:se=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:se=32;break;case 536870912:se=268435456;break;default:se=0}se=(se&(H.suspendedLanes|Le))!==0?0:se,se!==0&&se!==de.retryLane&&(de.retryLane=se,ka(v,se),Mn(H,v,se,-1))}return yo(),H=Rm(Error(n(421))),Xg(v,S,Le,H)}return se.data==="$?"?(S.flags|=128,S.child=v.child,S=_a.bind(null,v),se._reactRetry=S,null):(v=de.treeContext,ll=_h(se.nextSibling),ca=S,lo=!0,Na=null,v!==null&&(al[Is++]=on,al[Is++]=au,al[Is++]=Wu,on=v.id,au=v.overflow,Wu=S),S=xy(S,H.children),S.flags|=4096,S)}function by(v,S,F){v.lanes|=S;var H=v.alternate;H!==null&&(H.lanes|=S),Pd(v.return,S,F)}function ws(v,S,F,H,se){var de=v.memoizedState;de===null?v.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:H,tail:F,tailMode:se}:(de.isBackwards=S,de.rendering=null,de.renderingStartTime=0,de.last=H,de.tail=F,de.tailMode=se)}function Fd(v,S,F){var H=S.pendingProps,se=H.revealOrder,de=H.tail;if(Hs(v,S,H.children,F),H=Gi.current,(H&2)!==0)H=H&1|2,S.flags|=128;else{if(v!==null&&(v.flags&128)!==0)e:for(v=S.child;v!==null;){if(v.tag===13)v.memoizedState!==null&&by(v,F,S);else if(v.tag===19)by(v,F,S);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===S)break e;for(;v.sibling===null;){if(v.return===null||v.return===S)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}H&=1}if(Ri(Gi,H),(S.mode&1)===0)S.memoizedState=null;else switch(se){case"forwards":for(F=S.child,se=null;F!==null;)v=F.alternate,v!==null&&Nl(v)===null&&(se=F),F=F.sibling;F=se,F===null?(se=S.child,S.child=null):(se=F.sibling,F.sibling=null),ws(S,!1,se,F,de);break;case"backwards":for(F=null,se=S.child,S.child=null;se!==null;){if(v=se.alternate,v!==null&&Nl(v)===null){S.child=se;break}v=se.sibling,se.sibling=F,F=se,se=v}ws(S,!0,F,null,de);break;case"together":ws(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Om(v,S){(S.mode&1)===0&&v!==null&&(v.alternate=null,S.alternate=null,S.flags|=2)}function Ju(v,S,F){if(v!==null&&(S.dependencies=v.dependencies),vt|=S.lanes,(F&S.childLanes)===0)return null;if(v!==null&&S.child!==v.child)throw Error(n(153));if(S.child!==null){for(v=S.child,F=gu(v,v.pendingProps),S.child=F,F.return=S;v.sibling!==null;)v=v.sibling,F=F.sibling=gu(v,v.pendingProps),F.return=S;F.sibling=null}return S.child}function sp(v,S,F){switch(S.tag){case 3:Fl(S),Eh();break;case 5:Mh(S);break;case 1:la(S.type)&&Hf(S);break;case 4:vm(S,S.stateNode.containerInfo);break;case 10:var H=S.type._context,se=S.memoizedProps.value;Ri(da,H._currentValue),H._currentValue=se;break;case 13:if(H=S.memoizedState,H!==null)return H.dehydrated!==null?(Ri(Gi,Gi.current&1),S.flags|=128,null):(F&S.child.childLanes)!==0?zv(v,S,F):(Ri(Gi,Gi.current&1),v=Ju(v,S,F),v!==null?v.sibling:null);Ri(Gi,Gi.current&1);break;case 19:if(H=(F&S.childLanes)!==0,(v.flags&128)!==0){if(H)return Fd(v,S,F);S.flags|=128}if(se=S.memoizedState,se!==null&&(se.rendering=null,se.tail=null,se.lastEffect=null),Ri(Gi,Gi.current),H)break;return null;case 22:case 23:return S.lanes=0,Hg(v,S,F)}return Ju(v,S,F)}var Dm,ma,ja,zd;Dm=function(v,S){for(var F=S.child;F!==null;){if(F.tag===5||F.tag===6)v.appendChild(F.stateNode);else if(F.tag!==4&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===S)break;for(;F.sibling===null;){if(F.return===null||F.return===S)return;F=F.return}F.sibling.return=F.return,F=F.sibling}},ma=function(){},ja=function(v,S,F,H){var se=v.memoizedProps;if(se!==H){v=S.stateNode,Fa(Zu.current);var de=null;switch(F){case"input":se=Gt(v,se),H=Gt(v,H),de=[];break;case"select":se=Dt({},se,{value:void 0}),H=Dt({},H,{value:void 0}),de=[];break;case"textarea":se=so(v,se),H=so(v,H),de=[];break;default:typeof se.onClick!="function"&&typeof H.onClick=="function"&&(v.onclick=jf)}Jl(F,H);var Le;F=null;for($t in se)if(!H.hasOwnProperty($t)&&se.hasOwnProperty($t)&&se[$t]!=null)if($t==="style"){var ht=se[$t];for(Le in ht)ht.hasOwnProperty(Le)&&(F||(F={}),F[Le]="")}else $t!=="dangerouslySetInnerHTML"&&$t!=="children"&&$t!=="suppressContentEditableWarning"&&$t!=="suppressHydrationWarning"&&$t!=="autoFocus"&&(a.hasOwnProperty($t)?de||(de=[]):(de=de||[]).push($t,null));for($t in H){var yt=H[$t];if(ht=se!=null?se[$t]:void 0,H.hasOwnProperty($t)&&yt!==ht&&(yt!=null||ht!=null))if($t==="style")if(ht){for(Le in ht)!ht.hasOwnProperty(Le)||yt&&yt.hasOwnProperty(Le)||(F||(F={}),F[Le]="");for(Le in yt)yt.hasOwnProperty(Le)&&ht[Le]!==yt[Le]&&(F||(F={}),F[Le]=yt[Le])}else F||(de||(de=[]),de.push($t,F)),F=yt;else $t==="dangerouslySetInnerHTML"?(yt=yt?yt.__html:void 0,ht=ht?ht.__html:void 0,yt!=null&&ht!==yt&&(de=de||[]).push($t,yt)):$t==="children"?typeof yt!="string"&&typeof yt!="number"||(de=de||[]).push($t,""+yt):$t!=="suppressContentEditableWarning"&&$t!=="suppressHydrationWarning"&&(a.hasOwnProperty($t)?(yt!=null&&$t==="onScroll"&&Wi("scroll",v),de||ht===yt||(de=[])):(de=de||[]).push($t,yt))}F&&(de=de||[]).push("style",F);var $t=de;(S.updateQueue=$t)&&(S.flags|=4)}},zd=function(v,S,F,H){F!==H&&(S.flags|=4)};function pu(v,S){if(!lo)switch(v.tailMode){case"hidden":S=v.tail;for(var F=null;S!==null;)S.alternate!==null&&(F=S),S=S.sibling;F===null?v.tail=null:F.sibling=null;break;case"collapsed":F=v.tail;for(var H=null;F!==null;)F.alternate!==null&&(H=F),F=F.sibling;H===null?S||v.tail===null?v.tail=null:v.tail.sibling=null:H.sibling=null}}function Do(v){var S=v.alternate!==null&&v.alternate.child===v.child,F=0,H=0;if(S)for(var se=v.child;se!==null;)F|=se.lanes|se.childLanes,H|=se.subtreeFlags&14680064,H|=se.flags&14680064,se.return=v,se=se.sibling;else for(se=v.child;se!==null;)F|=se.lanes|se.childLanes,H|=se.subtreeFlags,H|=se.flags,se.return=v,se=se.sibling;return v.subtreeFlags|=H,v.childLanes=F,S}function wy(v,S,F){var H=S.pendingProps;switch(Cn(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Do(S),null;case 1:return la(S.type)&&bh(),Do(S),null;case 3:return H=S.stateNode,Ih(),Xi(qs),Xi(Ts),Oo(),H.pendingContext&&(H.context=H.pendingContext,H.pendingContext=null),(v===null||v.child===null)&&(Zf(S)?S.flags|=4:v===null||v.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Na!==null&&(ir(Na),Na=null))),ma(v,S),Do(S),null;case 5:Qf(S);var se=Fa(Th.current);if(F=S.type,v!==null&&S.stateNode!=null)ja(v,S,F,H,se),v.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!H){if(S.stateNode===null)throw Error(n(166));return Do(S),null}if(v=Fa(Zu.current),Zf(S)){H=S.stateNode,F=S.type;var de=S.memoizedProps;switch(H[$u]=S,H[lm]=de,v=(S.mode&1)!==0,F){case"dialog":Wi("cancel",H),Wi("close",H);break;case"iframe":case"object":case"embed":Wi("load",H);break;case"video":case"audio":for(se=0;se<nm.length;se++)Wi(nm[se],H);break;case"source":Wi("error",H);break;case"img":case"image":case"link":Wi("error",H),Wi("load",H);break;case"details":Wi("toggle",H);break;case"input":Io(H,de),Wi("invalid",H);break;case"select":H._wrapperState={wasMultiple:!!de.multiple},Wi("invalid",H);break;case"textarea":Ma(H,de),Wi("invalid",H)}Jl(F,de),se=null;for(var Le in de)if(de.hasOwnProperty(Le)){var ht=de[Le];Le==="children"?typeof ht=="string"?H.textContent!==ht&&(de.suppressHydrationWarning!==!0&&Bf(H.textContent,ht,v),se=["children",ht]):typeof ht=="number"&&H.textContent!==""+ht&&(de.suppressHydrationWarning!==!0&&Bf(H.textContent,ht,v),se=["children",""+ht]):a.hasOwnProperty(Le)&&ht!=null&&Le==="onScroll"&&Wi("scroll",H)}switch(F){case"input":Rr(H),cr(H,de,!0);break;case"textarea":Rr(H),_s(H);break;case"select":case"option":break;default:typeof de.onClick=="function"&&(H.onclick=jf)}H=se,S.updateQueue=H,H!==null&&(S.flags|=4)}else{Le=se.nodeType===9?se:se.ownerDocument,v==="http://www.w3.org/1999/xhtml"&&(v=Pa(F)),v==="http://www.w3.org/1999/xhtml"?F==="script"?(v=Le.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild)):typeof H.is=="string"?v=Le.createElement(F,{is:H.is}):(v=Le.createElement(F),F==="select"&&(Le=v,H.multiple?Le.multiple=!0:H.size&&(Le.size=H.size))):v=Le.createElementNS(v,F),v[$u]=S,v[lm]=H,Dm(v,S,!1,!1),S.stateNode=v;e:{switch(Le=vi(F,H),F){case"dialog":Wi("cancel",v),Wi("close",v),se=H;break;case"iframe":case"object":case"embed":Wi("load",v),se=H;break;case"video":case"audio":for(se=0;se<nm.length;se++)Wi(nm[se],v);se=H;break;case"source":Wi("error",v),se=H;break;case"img":case"image":case"link":Wi("error",v),Wi("load",v),se=H;break;case"details":Wi("toggle",v),se=H;break;case"input":Io(v,H),se=Gt(v,H),Wi("invalid",v);break;case"option":se=H;break;case"select":v._wrapperState={wasMultiple:!!H.multiple},se=Dt({},H,{value:void 0}),Wi("invalid",v);break;case"textarea":Ma(v,H),se=so(v,H),Wi("invalid",v);break;default:se=H}Jl(F,se),ht=se;for(de in ht)if(ht.hasOwnProperty(de)){var yt=ht[de];de==="style"?Nu(v,yt):de==="dangerouslySetInnerHTML"?(yt=yt?yt.__html:void 0,yt!=null&&Aa(v,yt)):de==="children"?typeof yt=="string"?(F!=="textarea"||yt!=="")&&jo(v,yt):typeof yt=="number"&&jo(v,""+yt):de!=="suppressContentEditableWarning"&&de!=="suppressHydrationWarning"&&de!=="autoFocus"&&(a.hasOwnProperty(de)?yt!=null&&de==="onScroll"&&Wi("scroll",v):yt!=null&&ee(v,de,yt,Le))}switch(F){case"input":Rr(v),cr(v,H,!1);break;case"textarea":Rr(v),_s(v);break;case"option":H.value!=null&&v.setAttribute("value",""+wn(H.value));break;case"select":v.multiple=!!H.multiple,de=H.value,de!=null?Ia(v,!!H.multiple,de,!1):H.defaultValue!=null&&Ia(v,!!H.multiple,H.defaultValue,!0);break;default:typeof se.onClick=="function"&&(v.onclick=jf)}switch(F){case"button":case"input":case"select":case"textarea":H=!!H.autoFocus;break e;case"img":H=!0;break e;default:H=!1}}H&&(S.flags|=4)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return Do(S),null;case 6:if(v&&S.stateNode!=null)zd(v,S,v.memoizedProps,H);else{if(typeof H!="string"&&S.stateNode===null)throw Error(n(166));if(F=Fa(Th.current),Fa(Zu.current),Zf(S)){if(H=S.stateNode,F=S.memoizedProps,H[$u]=S,(de=H.nodeValue!==F)&&(v=ca,v!==null))switch(v.tag){case 3:Bf(H.nodeValue,F,(v.mode&1)!==0);break;case 5:v.memoizedProps.suppressHydrationWarning!==!0&&Bf(H.nodeValue,F,(v.mode&1)!==0)}de&&(S.flags|=4)}else H=(F.nodeType===9?F:F.ownerDocument).createTextNode(H),H[$u]=S,S.stateNode=H}return Do(S),null;case 13:if(Xi(Gi),H=S.memoizedState,v===null||v.memoizedState!==null&&v.memoizedState.dehydrated!==null){if(lo&&ll!==null&&(S.mode&1)!==0&&(S.flags&128)===0)lu(),Eh(),S.flags|=98560,de=!1;else if(de=Zf(S),H!==null&&H.dehydrated!==null){if(v===null){if(!de)throw Error(n(318));if(de=S.memoizedState,de=de!==null?de.dehydrated:null,!de)throw Error(n(317));de[$u]=S}else Eh(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;Do(S),de=!1}else Na!==null&&(ir(Na),Na=null),de=!0;if(!de)return S.flags&65536?S:null}return(S.flags&128)!==0?(S.lanes=F,S):(H=H!==null,H!==(v!==null&&v.memoizedState!==null)&&H&&(S.child.flags|=8192,(S.mode&1)!==0&&(v===null||(Gi.current&1)!==0?Ue===0&&(Ue=3):yo())),S.updateQueue!==null&&(S.flags|=4),Do(S),null);case 4:return Ih(),ma(v,S),v===null&&zf(S.stateNode.containerInfo),Do(S),null;case 10:return Yf(S.type._context),Do(S),null;case 17:return la(S.type)&&bh(),Do(S),null;case 19:if(Xi(Gi),de=S.memoizedState,de===null)return Do(S),null;if(H=(S.flags&128)!==0,Le=de.rendering,Le===null)if(H)pu(de,!1);else{if(Ue!==0||v!==null&&(v.flags&128)!==0)for(v=S.child;v!==null;){if(Le=Nl(v),Le!==null){for(S.flags|=128,pu(de,!1),H=Le.updateQueue,H!==null&&(S.updateQueue=H,S.flags|=4),S.subtreeFlags=0,H=F,F=S.child;F!==null;)de=F,v=H,de.flags&=14680066,Le=de.alternate,Le===null?(de.childLanes=0,de.lanes=v,de.child=null,de.subtreeFlags=0,de.memoizedProps=null,de.memoizedState=null,de.updateQueue=null,de.dependencies=null,de.stateNode=null):(de.childLanes=Le.childLanes,de.lanes=Le.lanes,de.child=Le.child,de.subtreeFlags=0,de.deletions=null,de.memoizedProps=Le.memoizedProps,de.memoizedState=Le.memoizedState,de.updateQueue=Le.updateQueue,de.type=Le.type,v=Le.dependencies,de.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),F=F.sibling;return Ri(Gi,Gi.current&1|2),S.child}v=v.sibling}de.tail!==null&&Yn()>It&&(S.flags|=128,H=!0,pu(de,!1),S.lanes=4194304)}else{if(!H)if(v=Nl(Le),v!==null){if(S.flags|=128,H=!0,F=v.updateQueue,F!==null&&(S.updateQueue=F,S.flags|=4),pu(de,!0),de.tail===null&&de.tailMode==="hidden"&&!Le.alternate&&!lo)return Do(S),null}else 2*Yn()-de.renderingStartTime>It&&F!==1073741824&&(S.flags|=128,H=!0,pu(de,!1),S.lanes=4194304);de.isBackwards?(Le.sibling=S.child,S.child=Le):(F=de.last,F!==null?F.sibling=Le:S.child=Le,de.last=Le)}return de.tail!==null?(S=de.tail,de.rendering=S,de.tail=S.sibling,de.renderingStartTime=Yn(),S.sibling=null,F=Gi.current,Ri(Gi,H?F&1|2:F&1),S):(Do(S),null);case 22:case 23:return Ar(),H=S.memoizedState!==null,v!==null&&v.memoizedState!==null!==H&&(S.flags|=8192),H&&(S.mode&1)!==0?(Ne&1073741824)!==0&&(Do(S),S.subtreeFlags&6&&(S.flags|=8192)):Do(S),null;case 24:return null;case 25:return null}throw Error(n(156,S.tag))}function zr(v,S){switch(Cn(S),S.tag){case 1:return la(S.type)&&bh(),v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 3:return Ih(),Xi(qs),Xi(Ts),Oo(),v=S.flags,(v&65536)!==0&&(v&128)===0?(S.flags=v&-65537|128,S):null;case 5:return Qf(S),null;case 13:if(Xi(Gi),v=S.memoizedState,v!==null&&v.dehydrated!==null){if(S.alternate===null)throw Error(n(340));Eh()}return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 19:return Xi(Gi),null;case 4:return Ih(),null;case 10:return Yf(S.type._context),null;case 22:case 23:return Ar(),null;case 24:return null;default:return null}}var mu=!1,Ws=!1,kx=typeof WeakSet=="function"?WeakSet:Set,$n=null;function ga(v,S){var F=v.ref;if(F!==null)if(typeof F=="function")try{F(null)}catch(H){Li(v,S,H)}else F.current=null}function es(v,S,F){try{F()}catch(H){Li(v,S,H)}}var us=!1;function Va(v,S){if(om=Cl,v=Rf(),ol(v)){if("selectionStart"in v)var F={start:v.selectionStart,end:v.selectionEnd};else e:{F=(F=v.ownerDocument)&&F.defaultView||window;var H=F.getSelection&&F.getSelection();if(H&&H.rangeCount!==0){F=H.anchorNode;var se=H.anchorOffset,de=H.focusNode;H=H.focusOffset;try{F.nodeType,de.nodeType}catch{F=null;break e}var Le=0,ht=-1,yt=-1,$t=0,yn=0,xn=v,pn=null;t:for(;;){for(var Bn;xn!==F||se!==0&&xn.nodeType!==3||(ht=Le+se),xn!==de||H!==0&&xn.nodeType!==3||(yt=Le+H),xn.nodeType===3&&(Le+=xn.nodeValue.length),(Bn=xn.firstChild)!==null;)pn=xn,xn=Bn;for(;;){if(xn===v)break t;if(pn===F&&++$t===se&&(ht=Le),pn===de&&++yn===H&&(yt=Le),(Bn=xn.nextSibling)!==null)break;xn=pn,pn=xn.parentNode}xn=Bn}F=ht===-1||yt===-1?null:{start:ht,end:yt}}else F=null}F=F||{start:0,end:0}}else F=null;for(Vf={focusedElem:v,selectionRange:F},Cl=!1,$n=S;$n!==null;)if(S=$n,v=S.child,(S.subtreeFlags&1028)!==0&&v!==null)v.return=S,$n=v;else for(;$n!==null;){S=$n;try{var Kn=S.alternate;if((S.flags&1024)!==0)switch(S.tag){case 0:case 11:case 15:break;case 1:if(Kn!==null){var tr=Kn.memoizedProps,xo=Kn.memoizedState,Ft=S.stateNode,Tt=Ft.getSnapshotBeforeUpdate(S.elementType===S.type?tr:kl(S.type,tr),xo);Ft.__reactInternalSnapshotBeforeUpdate=Tt}break;case 3:var Vt=S.stateNode.containerInfo;Vt.nodeType===1?Vt.textContent="":Vt.nodeType===9&&Vt.documentElement&&Vt.removeChild(Vt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Tn){Li(S,S.return,Tn)}if(v=S.sibling,v!==null){v.return=S.return,$n=v;break}$n=S.return}return Kn=us,us=!1,Kn}function go(v,S,F){var H=S.updateQueue;if(H=H!==null?H.lastEffect:null,H!==null){var se=H=H.next;do{if((se.tag&v)===v){var de=se.destroy;se.destroy=void 0,de!==void 0&&es(S,F,de)}se=se.next}while(se!==H)}}function ap(v,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var F=S=S.next;do{if((F.tag&v)===v){var H=F.create;F.destroy=H()}F=F.next}while(F!==S)}}function Rs(v){var S=v.ref;if(S!==null){var F=v.stateNode;switch(v.tag){case 5:v=F;break;default:v=F}typeof S=="function"?S(v):S.current=v}}function Sy(v){var S=v.alternate;S!==null&&(v.alternate=null,Sy(S)),v.child=null,v.deletions=null,v.sibling=null,v.tag===5&&(S=v.stateNode,S!==null&&(delete S[$u],delete S[lm],delete S[um],delete S[ay],delete S[$f])),v.stateNode=null,v.return=null,v.dependencies=null,v.memoizedProps=null,v.memoizedState=null,v.pendingProps=null,v.stateNode=null,v.updateQueue=null}function kc(v){return v.tag===5||v.tag===3||v.tag===4}function Bv(v){e:for(;;){for(;v.sibling===null;){if(v.return===null||kc(v.return))return null;v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue e;v.child.return=v,v=v.child}if(!(v.flags&2))return v.stateNode}}function _(v,S,F){var H=v.tag;if(H===5||H===6)v=v.stateNode,S?F.nodeType===8?F.parentNode.insertBefore(v,S):F.insertBefore(v,S):(F.nodeType===8?(S=F.parentNode,S.insertBefore(v,F)):(S=F,S.appendChild(v)),F=F._reactRootContainer,F!=null||S.onclick!==null||(S.onclick=jf));else if(H!==4&&(v=v.child,v!==null))for(_(v,S,F),v=v.sibling;v!==null;)_(v,S,F),v=v.sibling}function s(v,S,F){var H=v.tag;if(H===5||H===6)v=v.stateNode,S?F.insertBefore(v,S):F.appendChild(v);else if(H!==4&&(v=v.child,v!==null))for(s(v,S,F),v=v.sibling;v!==null;)s(v,S,F),v=v.sibling}var c=null,g=!1;function x(v,S,F){for(F=F.child;F!==null;)E(v,S,F),F=F.sibling}function E(v,S,F){if(Ui&&typeof Ui.onCommitFiberUnmount=="function")try{Ui.onCommitFiberUnmount(mo,F)}catch{}switch(F.tag){case 5:Ws||ga(F,S);case 6:var H=c,se=g;c=null,x(v,S,F),c=H,g=se,c!==null&&(g?(v=c,F=F.stateNode,v.nodeType===8?v.parentNode.removeChild(F):v.removeChild(F)):c.removeChild(F.stateNode));break;case 18:c!==null&&(g?(v=c,F=F.stateNode,v.nodeType===8?sy(v.parentNode,F):v.nodeType===1&&sy(v,F),nl(v)):sy(c,F.stateNode));break;case 4:H=c,se=g,c=F.stateNode.containerInfo,g=!0,x(v,S,F),c=H,g=se;break;case 0:case 11:case 14:case 15:if(!Ws&&(H=F.updateQueue,H!==null&&(H=H.lastEffect,H!==null))){se=H=H.next;do{var de=se,Le=de.destroy;de=de.tag,Le!==void 0&&((de&2)!==0||(de&4)!==0)&&es(F,S,Le),se=se.next}while(se!==H)}x(v,S,F);break;case 1:if(!Ws&&(ga(F,S),H=F.stateNode,typeof H.componentWillUnmount=="function"))try{H.props=F.memoizedProps,H.state=F.memoizedState,H.componentWillUnmount()}catch(ht){Li(F,S,ht)}x(v,S,F);break;case 21:x(v,S,F);break;case 22:F.mode&1?(Ws=(H=Ws)||F.memoizedState!==null,x(v,S,F),Ws=H):x(v,S,F);break;default:x(v,S,F)}}function I(v){var S=v.updateQueue;if(S!==null){v.updateQueue=null;var F=v.stateNode;F===null&&(F=v.stateNode=new kx),S.forEach(function(H){var se=zl.bind(null,v,H);F.has(H)||(F.add(H),H.then(se,se))})}}function k(v,S){var F=S.deletions;if(F!==null)for(var H=0;H<F.length;H++){var se=F[H];try{var de=v,Le=S,ht=Le;e:for(;ht!==null;){switch(ht.tag){case 5:c=ht.stateNode,g=!1;break e;case 3:c=ht.stateNode.containerInfo,g=!0;break e;case 4:c=ht.stateNode.containerInfo,g=!0;break e}ht=ht.return}if(c===null)throw Error(n(160));E(de,Le,se),c=null,g=!1;var yt=se.alternate;yt!==null&&(yt.return=null),se.return=null}catch($t){Li(se,S,$t)}}if(S.subtreeFlags&12854)for(S=S.child;S!==null;)j(S,v),S=S.sibling}function j(v,S){var F=v.alternate,H=v.flags;switch(v.tag){case 0:case 11:case 14:case 15:if(k(S,v),U(v),H&4){try{go(3,v,v.return),ap(3,v)}catch(tr){Li(v,v.return,tr)}try{go(5,v,v.return)}catch(tr){Li(v,v.return,tr)}}break;case 1:k(S,v),U(v),H&512&&F!==null&&ga(F,F.return);break;case 5:if(k(S,v),U(v),H&512&&F!==null&&ga(F,F.return),v.flags&32){var se=v.stateNode;try{jo(se,"")}catch(tr){Li(v,v.return,tr)}}if(H&4&&(se=v.stateNode,se!=null)){var de=v.memoizedProps,Le=F!==null?F.memoizedProps:de,ht=v.type,yt=v.updateQueue;if(v.updateQueue=null,yt!==null)try{ht==="input"&&de.type==="radio"&&de.name!=null&&qi(se,de),vi(ht,Le);var $t=vi(ht,de);for(Le=0;Le<yt.length;Le+=2){var yn=yt[Le],xn=yt[Le+1];yn==="style"?Nu(se,xn):yn==="dangerouslySetInnerHTML"?Aa(se,xn):yn==="children"?jo(se,xn):ee(se,yn,xn,$t)}switch(ht){case"input":Ji(se,de);break;case"textarea":er(se,de);break;case"select":var pn=se._wrapperState.wasMultiple;se._wrapperState.wasMultiple=!!de.multiple;var Bn=de.value;Bn!=null?Ia(se,!!de.multiple,Bn,!1):pn!==!!de.multiple&&(de.defaultValue!=null?Ia(se,!!de.multiple,de.defaultValue,!0):Ia(se,!!de.multiple,de.multiple?[]:"",!1))}se[lm]=de}catch(tr){Li(v,v.return,tr)}}break;case 6:if(k(S,v),U(v),H&4){if(v.stateNode===null)throw Error(n(162));se=v.stateNode,de=v.memoizedProps;try{se.nodeValue=de}catch(tr){Li(v,v.return,tr)}}break;case 3:if(k(S,v),U(v),H&4&&F!==null&&F.memoizedState.isDehydrated)try{nl(S.containerInfo)}catch(tr){Li(v,v.return,tr)}break;case 4:k(S,v),U(v);break;case 13:k(S,v),U(v),se=v.child,se.flags&8192&&(de=se.memoizedState!==null,se.stateNode.isHidden=de,!de||se.alternate!==null&&se.alternate.memoizedState!==null||(ut=Yn())),H&4&&I(v);break;case 22:if(yn=F!==null&&F.memoizedState!==null,v.mode&1?(Ws=($t=Ws)||yn,k(S,v),Ws=$t):k(S,v),U(v),H&8192){if($t=v.memoizedState!==null,(v.stateNode.isHidden=$t)&&!yn&&(v.mode&1)!==0)for($n=v,yn=v.child;yn!==null;){for(xn=$n=yn;$n!==null;){switch(pn=$n,Bn=pn.child,pn.tag){case 0:case 11:case 14:case 15:go(4,pn,pn.return);break;case 1:ga(pn,pn.return);var Kn=pn.stateNode;if(typeof Kn.componentWillUnmount=="function"){H=pn,F=pn.return;try{S=H,Kn.props=S.memoizedProps,Kn.state=S.memoizedState,Kn.componentWillUnmount()}catch(tr){Li(H,F,tr)}}break;case 5:ga(pn,pn.return);break;case 22:if(pn.memoizedState!==null){oe(xn);continue}}Bn!==null?(Bn.return=pn,$n=Bn):oe(xn)}yn=yn.sibling}e:for(yn=null,xn=v;;){if(xn.tag===5){if(yn===null){yn=xn;try{se=xn.stateNode,$t?(de=se.style,typeof de.setProperty=="function"?de.setProperty("display","none","important"):de.display="none"):(ht=xn.stateNode,yt=xn.memoizedProps.style,Le=yt!=null&&yt.hasOwnProperty("display")?yt.display:null,ht.style.display=Du("display",Le))}catch(tr){Li(v,v.return,tr)}}}else if(xn.tag===6){if(yn===null)try{xn.stateNode.nodeValue=$t?"":xn.memoizedProps}catch(tr){Li(v,v.return,tr)}}else if((xn.tag!==22&&xn.tag!==23||xn.memoizedState===null||xn===v)&&xn.child!==null){xn.child.return=xn,xn=xn.child;continue}if(xn===v)break e;for(;xn.sibling===null;){if(xn.return===null||xn.return===v)break e;yn===xn&&(yn=null),xn=xn.return}yn===xn&&(yn=null),xn.sibling.return=xn.return,xn=xn.sibling}}break;case 19:k(S,v),U(v),H&4&&I(v);break;case 21:break;default:k(S,v),U(v)}}function U(v){var S=v.flags;if(S&2){try{e:{for(var F=v.return;F!==null;){if(kc(F)){var H=F;break e}F=F.return}throw Error(n(160))}switch(H.tag){case 5:var se=H.stateNode;H.flags&32&&(jo(se,""),H.flags&=-33);var de=Bv(v);s(v,de,se);break;case 3:case 4:var Le=H.stateNode.containerInfo,ht=Bv(v);_(v,ht,Le);break;default:throw Error(n(161))}}catch(yt){Li(v,v.return,yt)}v.flags&=-3}S&4096&&(v.flags&=-4097)}function $(v,S,F){$n=v,Q(v)}function Q(v,S,F){for(var H=(v.mode&1)!==0;$n!==null;){var se=$n,de=se.child;if(se.tag===22&&H){var Le=se.memoizedState!==null||mu;if(!Le){var ht=se.alternate,yt=ht!==null&&ht.memoizedState!==null||Ws;ht=mu;var $t=Ws;if(mu=Le,(Ws=yt)&&!$t)for($n=se;$n!==null;)Le=$n,yt=Le.child,Le.tag===22&&Le.memoizedState!==null?pe(se):yt!==null?(yt.return=Le,$n=yt):pe(se);for(;de!==null;)$n=de,Q(de),de=de.sibling;$n=se,mu=ht,Ws=$t}J(v)}else(se.subtreeFlags&8772)!==0&&de!==null?(de.return=se,$n=de):J(v)}}function J(v){for(;$n!==null;){var S=$n;if((S.flags&8772)!==0){var F=S.alternate;try{if((S.flags&8772)!==0)switch(S.tag){case 0:case 11:case 15:Ws||ap(5,S);break;case 1:var H=S.stateNode;if(S.flags&4&&!Ws)if(F===null)H.componentDidMount();else{var se=S.elementType===S.type?F.memoizedProps:kl(S.type,F.memoizedProps);H.componentDidUpdate(se,F.memoizedState,H.__reactInternalSnapshotBeforeUpdate)}var de=S.updateQueue;de!==null&&Ad(S,de,H);break;case 3:var Le=S.updateQueue;if(Le!==null){if(F=null,S.child!==null)switch(S.child.tag){case 5:F=S.child.stateNode;break;case 1:F=S.child.stateNode}Ad(S,Le,F)}break;case 5:var ht=S.stateNode;if(F===null&&S.flags&4){F=ht;var yt=S.memoizedProps;switch(S.type){case"button":case"input":case"select":case"textarea":yt.autoFocus&&F.focus();break;case"img":yt.src&&(F.src=yt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(S.memoizedState===null){var $t=S.alternate;if($t!==null){var yn=$t.memoizedState;if(yn!==null){var xn=yn.dehydrated;xn!==null&&nl(xn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Ws||S.flags&512&&Rs(S)}catch(pn){Li(S,S.return,pn)}}if(S===v){$n=null;break}if(F=S.sibling,F!==null){F.return=S.return,$n=F;break}$n=S.return}}function oe(v){for(;$n!==null;){var S=$n;if(S===v){$n=null;break}var F=S.sibling;if(F!==null){F.return=S.return,$n=F;break}$n=S.return}}function pe(v){for(;$n!==null;){var S=$n;try{switch(S.tag){case 0:case 11:case 15:var F=S.return;try{ap(4,S)}catch(yt){Li(S,F,yt)}break;case 1:var H=S.stateNode;if(typeof H.componentDidMount=="function"){var se=S.return;try{H.componentDidMount()}catch(yt){Li(S,se,yt)}}var de=S.return;try{Rs(S)}catch(yt){Li(S,de,yt)}break;case 5:var Le=S.return;try{Rs(S)}catch(yt){Li(S,Le,yt)}}}catch(yt){Li(S,S.return,yt)}if(S===v){$n=null;break}var ht=S.sibling;if(ht!==null){ht.return=S.return,$n=ht;break}$n=S.return}}var ce=Math.ceil,me=ae.ReactCurrentDispatcher,ve=ae.ReactCurrentOwner,Ee=ae.ReactCurrentBatchConfig,Pe=0,Ie=null,Be=null,Oe=0,Ne=0,ze=$s(0),Ue=0,Ye=null,vt=0,ct=0,Pt=0,At=null,jt=null,ut=0,It=1/0,nt=null,Mt=!1,St=null,Rt=null,xt=!1,Lt=null,en=0,tn=0,rn=null,fn=-1,kn=0;function vn(){return(Pe&6)!==0?Yn():fn!==-1?fn:fn=Yn()}function Ln(v){return(v.mode&1)===0?1:(Pe&2)!==0&&Oe!==0?Oe&-Oe:ha.transition!==null?(kn===0&&(kn=Ra()),kn):(v=mi,v!==0||(v=window.event,v=v===void 0?16:_d(v.type)),v)}function Mn(v,S,F,H){if(50<tn)throw tn=0,rn=null,Error(n(185));Sl(v,F,H),((Pe&2)===0||v!==Ie)&&(v===Ie&&((Pe&2)===0&&(ct|=F),Ue===4&&Nn(v,Oe)),Hn(v,H),F===1&&Pe===0&&(S.mode&1)===0&&(It=Yn()+500,Id&&Hu()))}function Hn(v,S){var F=v.callbackNode;Z_(v,S);var H=$p(v,v===Ie?Oe:0);if(H===0)F!==null&&Ai(F),v.callbackNode=null,v.callbackPriority=0;else if(S=H&-H,v.callbackPriority!==S){if(F!=null&&Ai(F),S===1)v.tag===0?Wf(mn.bind(null,v)):Rg(mn.bind(null,v)),Rv(function(){(Pe&6)===0&&Hu()}),F=null;else{switch(fg(H)){case 1:F=Vi;break;case 4:F=Vo;break;case 16:F=Zo;break;case 536870912:F=Es;break;default:F=Zo}F=Qu(F,Nr.bind(null,v))}v.callbackPriority=S,v.callbackNode=F}}function Nr(v,S){if(fn=-1,kn=0,(Pe&6)!==0)throw Error(n(327));var F=v.callbackNode;if(oi()&&v.callbackNode!==F)return null;var H=$p(v,v===Ie?Oe:0);if(H===0)return null;if((H&30)!==0||(H&v.expiredLanes)!==0||S)S=Xs(v,H);else{S=H;var se=Pe;Pe|=2;var de=_o();(Ie!==v||Oe!==S)&&(nt=null,It=Yn()+500,gi(v,S));do try{Or();break}catch(ht){uo(v,ht)}while(!0);gm(),me.current=de,Pe=se,Be!==null?S=0:(Ie=null,Oe=0,S=Ue)}if(S!==0){if(S===2&&(se=ah(v),se!==0&&(H=se,S=ii(v,se))),S===1)throw F=Ye,gi(v,0),Nn(v,H),Hn(v,Yn()),F;if(S===6)Nn(v,H);else{if(se=v.current.alternate,(H&30)===0&&!Ii(se)&&(S=Xs(v,H),S===2&&(de=ah(v),de!==0&&(H=de,S=ii(v,de))),S===1))throw F=Ye,gi(v,0),Nn(v,H),Hn(v,Yn()),F;switch(v.finishedWork=se,v.finishedLanes=H,S){case 0:case 1:throw Error(n(345));case 2:Wr(v,jt,nt);break;case 3:if(Nn(v,H),(H&130023424)===H&&(S=ut+500-Yn(),10<S)){if($p(v,0)!==0)break;if(se=v.suspendedLanes,(se&H)!==H){vn(),v.pingedLanes|=v.suspendedLanes&se;break}v.timeoutHandle=am(Wr.bind(null,v,jt,nt),S);break}Wr(v,jt,nt);break;case 4:if(Nn(v,H),(H&4194240)===H)break;for(S=v.eventTimes,se=-1;0<H;){var Le=31-Ro(H);de=1<<Le,Le=S[Le],Le>se&&(se=Le),H&=~de}if(H=se,H=Yn()-H,H=(120>H?120:480>H?480:1080>H?1080:1920>H?1920:3e3>H?3e3:4320>H?4320:1960*ce(H/1960))-H,10<H){v.timeoutHandle=am(Wr.bind(null,v,jt,nt),H);break}Wr(v,jt,nt);break;case 5:Wr(v,jt,nt);break;default:throw Error(n(329))}}}return Hn(v,Yn()),v.callbackNode===F?Nr.bind(null,v):null}function ii(v,S){var F=At;return v.current.memoizedState.isDehydrated&&(gi(v,S).flags|=256),v=Xs(v,S),v!==2&&(S=jt,jt=F,S!==null&&ir(S)),v}function ir(v){jt===null?jt=v:jt.push.apply(jt,v)}function Ii(v){for(var S=v;;){if(S.flags&16384){var F=S.updateQueue;if(F!==null&&(F=F.stores,F!==null))for(var H=0;H<F.length;H++){var se=F[H],de=se.getSnapshot;se=se.value;try{if(!Cs(de(),se))return!1}catch{return!1}}}if(F=S.child,S.subtreeFlags&16384&&F!==null)F.return=S,S=F;else{if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Nn(v,S){for(S&=~Pt,S&=~ct,v.suspendedLanes|=S,v.pingedLanes&=~S,v=v.expirationTimes;0<S;){var F=31-Ro(S),H=1<<F;v[F]=-1,S&=~H}}function mn(v){if((Pe&6)!==0)throw Error(n(327));oi();var S=$p(v,0);if((S&1)===0)return Hn(v,Yn()),null;var F=Xs(v,S);if(v.tag!==0&&F===2){var H=ah(v);H!==0&&(S=H,F=ii(v,H))}if(F===1)throw F=Ye,gi(v,0),Nn(v,S),Hn(v,Yn()),F;if(F===6)throw Error(n(345));return v.finishedWork=v.current.alternate,v.finishedLanes=S,Wr(v,jt,nt),Hn(v,Yn()),null}function _r(v,S){var F=Pe;Pe|=1;try{return v(S)}finally{Pe=F,Pe===0&&(It=Yn()+500,Id&&Hu())}}function Pr(v){Lt!==null&&Lt.tag===0&&(Pe&6)===0&&oi();var S=Pe;Pe|=1;var F=Ee.transition,H=mi;try{if(Ee.transition=null,mi=1,v)return v()}finally{mi=H,Ee.transition=F,Pe=S,(Pe&6)===0&&Hu()}}function Ar(){Ne=ze.current,Xi(ze)}function gi(v,S){v.finishedWork=null,v.finishedLanes=0;var F=v.timeoutHandle;if(F!==-1&&(v.timeoutHandle=-1,Ag(F)),Be!==null)for(F=Be.return;F!==null;){var H=F;switch(Cn(H),H.tag){case 1:H=H.type.childContextTypes,H!=null&&bh();break;case 3:Ih(),Xi(qs),Xi(Ts),Oo();break;case 5:Qf(H);break;case 4:Ih();break;case 13:Xi(Gi);break;case 19:Xi(Gi);break;case 10:Yf(H.type._context);break;case 22:case 23:Ar()}F=F.return}if(Ie=v,Be=v=gu(v.current,null),Oe=Ne=S,Ue=0,Ye=null,Pt=ct=vt=0,jt=At=null,Ol!==null){for(S=0;S<Ol.length;S++)if(F=Ol[S],H=F.interleaved,H!==null){F.interleaved=null;var se=H.next,de=F.pending;if(de!==null){var Le=de.next;de.next=se,H.next=Le}F.pending=H}Ol=null}return v}function uo(v,S){do{var F=Be;try{if(gm(),Dg.current=Lh,Lc){for(var H=qn.memoizedState;H!==null;){var se=H.queue;se!==null&&(se.pending=null),H=H.next}Lc=!1}if(Jr=0,eo=Jo=qn=null,ul=!1,hu=0,ve.current=null,F===null||F.return===null){Ue=1,Ye=S,Be=null;break}e:{var de=v,Le=F.return,ht=F,yt=S;if(S=Oe,ht.flags|=32768,yt!==null&&typeof yt=="object"&&typeof yt.then=="function"){var $t=yt,yn=ht,xn=yn.tag;if((yn.mode&1)===0&&(xn===0||xn===11||xn===15)){var pn=yn.alternate;pn?(yn.updateQueue=pn.updateQueue,yn.memoizedState=pn.memoizedState,yn.lanes=pn.lanes):(yn.updateQueue=null,yn.memoizedState=null)}var Bn=hl(Le);if(Bn!==null){Bn.flags&=-257,Nd(Bn,Le,ht,de,S),Bn.mode&1&&to(de,$t,S),S=Bn,yt=$t;var Kn=S.updateQueue;if(Kn===null){var tr=new Set;tr.add(yt),S.updateQueue=tr}else Kn.add(yt);break e}else{if((S&1)===0){to(de,$t,S),yo();break e}yt=Error(n(426))}}else if(lo&&ht.mode&1){var xo=hl(Le);if(xo!==null){(xo.flags&65536)===0&&(xo.flags|=256),Nd(xo,Le,ht,de,S),fm(Yu(yt,ht));break e}}de=yt=Yu(yt,ht),Ue!==4&&(Ue=2),At===null?At=[de]:At.push(de),de=Le;do{switch(de.tag){case 3:de.flags|=65536,S&=-S,de.lanes|=S;var Ft=du(de,yt,S);fy(de,Ft);break e;case 1:ht=yt;var Tt=de.type,Vt=de.stateNode;if((de.flags&128)===0&&(typeof Tt.getDerivedStateFromError=="function"||Vt!==null&&typeof Vt.componentDidCatch=="function"&&(Rt===null||!Rt.has(Vt)))){de.flags|=65536,S&=-S,de.lanes|=S;var Tn=ip(de,ht,S);fy(de,Tn);break e}}de=de.return}while(de!==null)}kr(F)}catch(or){S=or,Be===F&&F!==null&&(Be=F=F.return);continue}break}while(!0)}function _o(){var v=me.current;return me.current=Lh,v===null?Lh:v}function yo(){(Ue===0||Ue===3||Ue===2)&&(Ue=4),Ie===null||(vt&268435455)===0&&(ct&268435455)===0||Nn(Ie,Oe)}function Xs(v,S){var F=Pe;Pe|=2;var H=_o();(Ie!==v||Oe!==S)&&(nt=null,gi(v,S));do try{Ls();break}catch(se){uo(v,se)}while(!0);if(gm(),Pe=F,me.current=H,Be!==null)throw Error(n(261));return Ie=null,Oe=0,Ue}function Ls(){for(;Be!==null;)bi(Be)}function Or(){for(;Be!==null&&!mr();)bi(Be)}function bi(v){var S=ya(v.alternate,v,Ne);v.memoizedProps=v.pendingProps,S===null?kr(v):Be=S,ve.current=null}function kr(v){var S=v;do{var F=S.alternate;if(v=S.return,(S.flags&32768)===0){if(F=wy(F,S,Ne),F!==null){Be=F;return}}else{if(F=zr(F,S),F!==null){F.flags&=32767,Be=F;return}if(v!==null)v.flags|=32768,v.subtreeFlags=0,v.deletions=null;else{Ue=6,Be=null;return}}if(S=S.sibling,S!==null){Be=S;return}Be=S=v}while(S!==null);Ue===0&&(Ue=5)}function Wr(v,S,F){var H=mi,se=Ee.transition;try{Ee.transition=null,mi=1,cs(v,S,F,H)}finally{Ee.transition=se,mi=H}return null}function cs(v,S,F,H){do oi();while(Lt!==null);if((Pe&6)!==0)throw Error(n(327));F=v.finishedWork;var se=v.finishedLanes;if(F===null)return null;if(v.finishedWork=null,v.finishedLanes=0,F===v.current)throw Error(n(177));v.callbackNode=null,v.callbackPriority=0;var de=F.lanes|F.childLanes;if(el(v,de),v===Ie&&(Be=Ie=null,Oe=0),(F.subtreeFlags&2064)===0&&(F.flags&2064)===0||xt||(xt=!0,Qu(Zo,function(){return oi(),null})),de=(F.flags&15990)!==0,(F.subtreeFlags&15990)!==0||de){de=Ee.transition,Ee.transition=null;var Le=mi;mi=1;var ht=Pe;Pe|=4,ve.current=null,Va(v,F),j(F,v),ey(Vf),Cl=!!om,Vf=om=null,v.current=F,$(F),Zr(),Pe=ht,mi=Le,Ee.transition=de}else v.current=F;if(xt&&(xt=!1,Lt=v,en=se),de=v.pendingLanes,de===0&&(Rt=null),Cf(F.stateNode),Hn(v,Yn()),S!==null)for(H=v.onRecoverableError,F=0;F<S.length;F++)se=S[F],H(se.value,{componentStack:se.stack,digest:se.digest});if(Mt)throw Mt=!1,v=St,St=null,v;return(en&1)!==0&&v.tag!==0&&oi(),de=v.pendingLanes,(de&1)!==0?v===rn?tn++:(tn=0,rn=v):tn=0,Hu(),null}function oi(){if(Lt!==null){var v=fg(en),S=Ee.transition,F=mi;try{if(Ee.transition=null,mi=16>v?16:v,Lt===null)var H=!1;else{if(v=Lt,Lt=null,en=0,(Pe&6)!==0)throw Error(n(331));var se=Pe;for(Pe|=4,$n=v.current;$n!==null;){var de=$n,Le=de.child;if(($n.flags&16)!==0){var ht=de.deletions;if(ht!==null){for(var yt=0;yt<ht.length;yt++){var $t=ht[yt];for($n=$t;$n!==null;){var yn=$n;switch(yn.tag){case 0:case 11:case 15:go(8,yn,de)}var xn=yn.child;if(xn!==null)xn.return=yn,$n=xn;else for(;$n!==null;){yn=$n;var pn=yn.sibling,Bn=yn.return;if(Sy(yn),yn===$t){$n=null;break}if(pn!==null){pn.return=Bn,$n=pn;break}$n=Bn}}}var Kn=de.alternate;if(Kn!==null){var tr=Kn.child;if(tr!==null){Kn.child=null;do{var xo=tr.sibling;tr.sibling=null,tr=xo}while(tr!==null)}}$n=de}}if((de.subtreeFlags&2064)!==0&&Le!==null)Le.return=de,$n=Le;else e:for(;$n!==null;){if(de=$n,(de.flags&2048)!==0)switch(de.tag){case 0:case 11:case 15:go(9,de,de.return)}var Ft=de.sibling;if(Ft!==null){Ft.return=de.return,$n=Ft;break e}$n=de.return}}var Tt=v.current;for($n=Tt;$n!==null;){Le=$n;var Vt=Le.child;if((Le.subtreeFlags&2064)!==0&&Vt!==null)Vt.return=Le,$n=Vt;else e:for(Le=Tt;$n!==null;){if(ht=$n,(ht.flags&2048)!==0)try{switch(ht.tag){case 0:case 11:case 15:ap(9,ht)}}catch(or){Li(ht,ht.return,or)}if(ht===Le){$n=null;break e}var Tn=ht.sibling;if(Tn!==null){Tn.return=ht.return,$n=Tn;break e}$n=ht.return}}if(Pe=se,Hu(),Ui&&typeof Ui.onPostCommitFiberRoot=="function")try{Ui.onPostCommitFiberRoot(mo,v)}catch{}H=!0}return H}finally{mi=F,Ee.transition=S}}return!1}function vo(v,S,F){S=Yu(F,S),S=du(v,S,1),v=Xu(v,S,1),S=vn(),v!==null&&(Sl(v,1,S),Hn(v,S))}function Li(v,S,F){if(v.tag===3)vo(v,v,F);else for(;S!==null;){if(S.tag===3){vo(S,v,F);break}else if(S.tag===1){var H=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof H.componentDidCatch=="function"&&(Rt===null||!Rt.has(H))){v=Yu(F,v),v=ip(S,v,1),S=Xu(S,v,1),v=vn(),S!==null&&(Sl(S,1,v),Hn(S,v));break}}S=S.return}}function Ua(v,S,F){var H=v.pingCache;H!==null&&H.delete(S),S=vn(),v.pingedLanes|=v.suspendedLanes&F,Ie===v&&(Oe&F)===F&&(Ue===4||Ue===3&&(Oe&130023424)===Oe&&500>Yn()-ut?gi(v,0):Pt|=F),Hn(v,S)}function dl(v,S){S===0&&((v.mode&1)===0?S=1:(S=vc,vc<<=1,(vc&130023424)===0&&(vc=4194304)));var F=vn();v=ka(v,S),v!==null&&(Sl(v,S,F),Hn(v,F))}function _a(v){var S=v.memoizedState,F=0;S!==null&&(F=S.retryLane),dl(v,F)}function zl(v,S){var F=0;switch(v.tag){case 13:var H=v.stateNode,se=v.memoizedState;se!==null&&(F=se.retryLane);break;case 19:H=v.stateNode;break;default:throw Error(n(314))}H!==null&&H.delete(S),dl(v,F)}var ya;ya=function(v,S,F){if(v!==null)if(v.memoizedProps!==S.pendingProps||qs.current)pa=!0;else{if((v.lanes&F)===0&&(S.flags&128)===0)return pa=!1,sp(v,S,F);pa=(v.flags&131072)!==0}else pa=!1,lo&&(S.flags&1048576)!==0&&Ac(S,hm,S.index);switch(S.lanes=0,S.tag){case 2:var H=S.type;Om(v,S),v=S.pendingProps;var se=Td(S,Ts.current);cu(S,F),se=bm(null,S,H,v,se,F);var de=cl();return S.flags|=1,typeof se=="object"&&se!==null&&typeof se.render=="function"&&se.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,la(H)?(de=!0,Hf(S)):de=!1,S.memoizedState=se.state!==null&&se.state!==void 0?se.state:null,ft(S),se.updater=Ug,S.stateNode=se,se._reactInternals=S,vy(S,H,v,F),S=fu(null,S,H,!0,de,F)):(S.tag=0,lo&&de&&ua(S),Hs(null,S,se,F),S=S.child),S;case 16:H=S.elementType;e:{switch(Om(v,S),v=S.pendingProps,se=H._init,H=se(H._payload),S.type=H,se=S.tag=lp(H),v=kl(H,v),se){case 0:S=kd(null,S,H,v,F);break e;case 1:S=Oh(null,S,H,v,F);break e;case 11:S=op(null,S,H,v,F);break e;case 14:S=qg(null,S,H,kl(H.type,v),F);break e}throw Error(n(306,H,""))}return S;case 0:return H=S.type,se=S.pendingProps,se=S.elementType===H?se:kl(H,se),kd(v,S,H,se,F);case 1:return H=S.type,se=S.pendingProps,se=S.elementType===H?se:kl(H,se),Oh(v,S,H,se,F);case 3:e:{if(Fl(S),v===null)throw Error(n(387));H=S.pendingProps,de=S.memoizedState,se=de.element,dy(v,S),_m(S,H,null,F);var Le=S.memoizedState;if(H=Le.element,de.isDehydrated)if(de={element:H,isDehydrated:!1,cache:Le.cache,pendingSuspenseBoundaries:Le.pendingSuspenseBoundaries,transitions:Le.transitions},S.updateQueue.baseState=de,S.memoizedState=de,S.flags&256){se=Yu(Error(n(423)),S),S=Dc(v,S,H,F,se);break e}else if(H!==se){se=Yu(Error(n(424)),S),S=Dc(v,S,H,F,se);break e}else for(ll=_h(S.stateNode.containerInfo.firstChild),ca=S,lo=!0,Na=null,F=hy(S,null,H,F),S.child=F;F;)F.flags=F.flags&-3|4096,F=F.sibling;else{if(Eh(),H===se){S=Ju(v,S,F);break e}Hs(v,S,H,F)}S=S.child}return S;case 5:return Mh(S),v===null&&dm(S),H=S.type,se=S.pendingProps,de=v!==null?v.memoizedProps:null,Le=se.children,sm(H,se)?Le=null:de!==null&&sm(H,de)&&(S.flags|=32),Wg(v,S),Hs(v,S,Le,F),S.child;case 6:return v===null&&dm(S),null;case 13:return zv(v,S,F);case 4:return vm(S,S.stateNode.containerInfo),H=S.pendingProps,v===null?S.child=Rc(S,null,H,F):Hs(v,S,H,F),S.child;case 11:return H=S.type,se=S.pendingProps,se=S.elementType===H?se:kl(H,se),op(v,S,H,se,F);case 7:return Hs(v,S,S.pendingProps,F),S.child;case 8:return Hs(v,S,S.pendingProps.children,F),S.child;case 12:return Hs(v,S,S.pendingProps.children,F),S.child;case 10:e:{if(H=S.type._context,se=S.pendingProps,de=S.memoizedProps,Le=se.value,Ri(da,H._currentValue),H._currentValue=Le,de!==null)if(Cs(de.value,Le)){if(de.children===se.children&&!qs.current){S=Ju(v,S,F);break e}}else for(de=S.child,de!==null&&(de.return=S);de!==null;){var ht=de.dependencies;if(ht!==null){Le=de.child;for(var yt=ht.firstContext;yt!==null;){if(yt.context===H){if(de.tag===1){yt=Dl(-1,F&-F),yt.tag=2;var $t=de.updateQueue;if($t!==null){$t=$t.shared;var yn=$t.pending;yn===null?yt.next=yt:(yt.next=yn.next,yn.next=yt),$t.pending=yt}}de.lanes|=F,yt=de.alternate,yt!==null&&(yt.lanes|=F),Pd(de.return,F,S),ht.lanes|=F;break}yt=yt.next}}else if(de.tag===10)Le=de.type===S.type?null:de.child;else if(de.tag===18){if(Le=de.return,Le===null)throw Error(n(341));Le.lanes|=F,ht=Le.alternate,ht!==null&&(ht.lanes|=F),Pd(Le,F,S),Le=de.sibling}else Le=de.child;if(Le!==null)Le.return=de;else for(Le=de;Le!==null;){if(Le===S){Le=null;break}if(de=Le.sibling,de!==null){de.return=Le.return,Le=de;break}Le=Le.return}de=Le}Hs(v,S,se.children,F),S=S.child}return S;case 9:return se=S.type,H=S.pendingProps.children,cu(S,F),se=Ms(se),H=H(se),S.flags|=1,Hs(v,S,H,F),S.child;case 14:return H=S.type,se=kl(H,S.pendingProps),se=kl(H.type,se),qg(v,S,H,se,F);case 15:return Fv(v,S,S.type,S.pendingProps,F);case 17:return H=S.type,se=S.pendingProps,se=S.elementType===H?se:kl(H,se),Om(v,S),S.tag=1,la(H)?(v=!0,Hf(S)):v=!1,cu(S,F),yy(S,H,se),vy(S,H,se,F),fu(null,S,H,!0,v,F);case 19:return Fd(v,S,F);case 22:return Hg(v,S,F)}throw Error(n(156,S.tag))};function Qu(v,S){return ai(v,S)}function ec(v,S,F,H){this.tag=v,this.key=F,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=H,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(v,S,F,H){return new ec(v,S,F,H)}function Nm(v){return v=v.prototype,!(!v||!v.isReactComponent)}function lp(v){if(typeof v=="function")return Nm(v)?1:0;if(v!=null){if(v=v.$$typeof,v===at)return 11;if(v===Ze)return 14}return 2}function gu(v,S){var F=v.alternate;return F===null?(F=ts(v.tag,S,v.key,v.mode),F.elementType=v.elementType,F.type=v.type,F.stateNode=v.stateNode,F.alternate=v,v.alternate=F):(F.pendingProps=S,F.type=v.type,F.flags=0,F.subtreeFlags=0,F.deletions=null),F.flags=v.flags&14680064,F.childLanes=v.childLanes,F.lanes=v.lanes,F.child=v.child,F.memoizedProps=v.memoizedProps,F.memoizedState=v.memoizedState,F.updateQueue=v.updateQueue,S=v.dependencies,F.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},F.sibling=v.sibling,F.index=v.index,F.ref=v.ref,F}function up(v,S,F,H,se,de){var Le=2;if(H=v,typeof v=="function")Nm(v)&&(Le=1);else if(typeof v=="string")Le=5;else e:switch(v){case ye:return cp(F.children,se,de,S);case Se:Le=8,se|=8;break;case je:return v=ts(12,F,S,se|2),v.elementType=je,v.lanes=de,v;case ot:return v=ts(13,F,S,se),v.elementType=ot,v.lanes=de,v;case Fe:return v=ts(19,F,S,se),v.elementType=Fe,v.lanes=de,v;case mt:return jv(F,se,de,S);default:if(typeof v=="object"&&v!==null)switch(v.$$typeof){case Re:Le=10;break e;case De:Le=9;break e;case at:Le=11;break e;case Ze:Le=14;break e;case Ve:Le=16,H=null;break e}throw Error(n(130,v==null?v:typeof v,""))}return S=ts(Le,F,S,se),S.elementType=v,S.type=H,S.lanes=de,S}function cp(v,S,F,H){return v=ts(7,v,H,S),v.lanes=F,v}function jv(v,S,F,H){return v=ts(22,v,H,S),v.elementType=mt,v.lanes=F,v.stateNode={isHidden:!1},v}function Fx(v,S,F){return v=ts(6,v,null,S),v.lanes=F,v}function Vv(v,S,F){return S=ts(4,v.children!==null?v.children:[],v.key,S),S.lanes=F,S.stateNode={containerInfo:v.containerInfo,pendingChildren:null,implementation:v.implementation},S}function Jb(v,S,F,H,se){this.tag=S,this.containerInfo=v,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qa(0),this.expirationTimes=Qa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qa(0),this.identifierPrefix=H,this.onRecoverableError=se,this.mutableSourceEagerHydrationData=null}function Uv(v,S,F,H,se,de,Le,ht,yt){return v=new Jb(v,S,F,ht,yt),S===1?(S=1,de===!0&&(S|=8)):S=0,de=ts(3,null,null,S),v.current=de,de.stateNode=v,de.memoizedState={element:H,isDehydrated:F,cache:null,transitions:null,pendingSuspenseBoundaries:null},ft(de),v}function Qb(v,S,F){var H=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xe,key:H==null?null:""+H,children:v,containerInfo:S,implementation:F}}function zx(v){if(!v)return ou;v=v._reactInternals;e:{if(sn(v)!==v||v.tag!==1)throw Error(n(170));var S=v;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(la(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(n(171))}if(v.tag===1){var F=v.type;if(la(F))return ly(v,F,S)}return S}function Bx(v,S,F,H,se,de,Le,ht,yt){return v=Uv(F,H,!0,v,se,de,Le,ht,yt),v.context=zx(null),F=v.current,H=vn(),se=Ln(F),de=Dl(H,se),de.callback=S??null,Xu(F,de,se),v.current.lanes=se,Sl(v,se,H),Hn(v,H),v}function Ey(v,S,F,H){var se=S.current,de=vn(),Le=Ln(se);return F=zx(F),S.context===null?S.context=F:S.pendingContext=F,S=Dl(de,Le),S.payload={element:v},H=H===void 0?null:H,H!==null&&(S.callback=H),v=Xu(se,S,Le),v!==null&&(Mn(v,se,Le,de),Kf(v,se,Le)),Le}function Yg(v){if(v=v.current,!v.child)return null;switch(v.child.tag){case 5:return v.child.stateNode;default:return v.child.stateNode}}function Bd(v,S){if(v=v.memoizedState,v!==null&&v.dehydrated!==null){var F=v.retryLane;v.retryLane=F!==0&&F<S?F:S}}function ns(v,S){Bd(v,S),(v=v.alternate)&&Bd(v,S)}function ew(){return null}var Kg=typeof reportError=="function"?reportError:function(v){console.error(v)};function jx(v){this._internalRoot=v}Gv.prototype.render=jx.prototype.render=function(v){var S=this._internalRoot;if(S===null)throw Error(n(409));Ey(v,S,null,null)},Gv.prototype.unmount=jx.prototype.unmount=function(){var v=this._internalRoot;if(v!==null){this._internalRoot=null;var S=v.containerInfo;Pr(function(){Ey(null,v,null,null)}),S[sl]=null}};function Gv(v){this._internalRoot=v}Gv.prototype.unstable_scheduleHydration=function(v){if(v){var S=Y_();v={blockedOn:null,target:v,priority:S};for(var F=0;F<fr.length&&S!==0&&S<fr[F].priority;F++);fr.splice(F,0,v),F===0&&Gr(v)}};function Vx(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)}function $v(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11&&(v.nodeType!==8||v.nodeValue!==" react-mount-point-unstable "))}function Jg(){}function tw(v,S,F,H,se){if(se){if(typeof H=="function"){var de=H;H=function(){var $t=Yg(Le);de.call($t)}}var Le=Bx(S,H,v,0,null,!1,!1,"",Jg);return v._reactRootContainer=Le,v[sl]=Le.current,zf(v.nodeType===8?v.parentNode:v),Pr(),Le}for(;se=v.lastChild;)v.removeChild(se);if(typeof H=="function"){var ht=H;H=function(){var $t=Yg(yt);ht.call($t)}}var yt=Uv(v,0,!1,null,null,!1,!1,"",Jg);return v._reactRootContainer=yt,v[sl]=yt.current,zf(v.nodeType===8?v.parentNode:v),Pr(function(){Ey(S,yt,F,H)}),yt}function Dh(v,S,F,H,se){var de=F._reactRootContainer;if(de){var Le=de;if(typeof se=="function"){var ht=se;se=function(){var yt=Yg(Le);ht.call(yt)}}Ey(S,Le,v,se)}else Le=tw(F,S,v,se,H);return Yg(Le)}qp=function(v){switch(v.tag){case 3:var S=v.stateNode;if(S.current.memoizedState.isDehydrated){var F=gd(S.pendingLanes);F!==0&&(Us(S,F|1),Hn(S,Yn()),(Pe&6)===0&&(It=Yn()+500,Hu()))}break;case 13:Pr(function(){var H=ka(v,1);if(H!==null){var se=vn();Mn(H,v,1,se)}}),ns(v,1)}},tl=function(v){if(v.tag===13){var S=ka(v,134217728);if(S!==null){var F=vn();Mn(S,v,134217728,F)}ns(v,134217728)}},Gs=function(v){if(v.tag===13){var S=Ln(v),F=ka(v,S);if(F!==null){var H=vn();Mn(F,v,S,H)}ns(v,S)}},Y_=function(){return mi},pg=function(v,S){var F=mi;try{return mi=v,S()}finally{mi=F}},ku=function(v,S,F){switch(S){case"input":if(Ji(v,F),S=F.name,F.type==="radio"&&S!=null){for(F=v;F.parentNode;)F=F.parentNode;for(F=F.querySelectorAll("input[name="+JSON.stringify(""+S)+'][type="radio"]'),S=0;S<F.length;S++){var H=F[S];if(H!==v&&H.form===v.form){var se=Cd(H);if(!se)throw Error(n(90));Mr(H),Ji(H,se)}}}break;case"textarea":er(v,F);break;case"select":S=F.value,S!=null&&Ia(v,!!F.multiple,S,!1)}},Ao=_r,Xo=Pr;var Cy={usingClientEntryPoint:!1,Events:[qf,vh,Cd,Lr,fo,_r]},Ty={findFiberByHostInstance:yh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bC={bundleType:Ty.bundleType,version:Ty.version,rendererPackageName:Ty.rendererPackageName,rendererConfig:Ty.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(v){return v=Wn(v),v===null?null:v.stateNode},findFiberByHostInstance:Ty.findFiberByHostInstance||ew,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qv.isDisabled&&qv.supportsFiber)try{mo=qv.inject(bC),Ui=qv}catch{}}return tc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Cy,tc.createPortal=function(v,S){var F=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vx(S))throw Error(n(200));return Qb(v,S,null,F)},tc.createRoot=function(v,S){if(!Vx(v))throw Error(n(299));var F=!1,H="",se=Kg;return S!=null&&(S.unstable_strictMode===!0&&(F=!0),S.identifierPrefix!==void 0&&(H=S.identifierPrefix),S.onRecoverableError!==void 0&&(se=S.onRecoverableError)),S=Uv(v,1,!1,null,null,F,!1,H,se),v[sl]=S.current,zf(v.nodeType===8?v.parentNode:v),new jx(S)},tc.findDOMNode=function(v){if(v==null)return null;if(v.nodeType===1)return v;var S=v._reactInternals;if(S===void 0)throw typeof v.render=="function"?Error(n(188)):(v=Object.keys(v).join(","),Error(n(268,v)));return v=Wn(S),v=v===null?null:v.stateNode,v},tc.flushSync=function(v){return Pr(v)},tc.hydrate=function(v,S,F){if(!$v(S))throw Error(n(200));return Dh(null,v,S,!0,F)},tc.hydrateRoot=function(v,S,F){if(!Vx(v))throw Error(n(405));var H=F!=null&&F.hydratedSources||null,se=!1,de="",Le=Kg;if(F!=null&&(F.unstable_strictMode===!0&&(se=!0),F.identifierPrefix!==void 0&&(de=F.identifierPrefix),F.onRecoverableError!==void 0&&(Le=F.onRecoverableError)),S=Bx(S,null,v,1,F??null,se,!1,de,Le),v[sl]=S.current,zf(v),H)for(v=0;v<H.length;v++)F=H[v],se=F._getVersion,se=se(F._source),S.mutableSourceEagerHydrationData==null?S.mutableSourceEagerHydrationData=[F,se]:S.mutableSourceEagerHydrationData.push(F,se);return new Gv(S)},tc.render=function(v,S,F){if(!$v(S))throw Error(n(200));return Dh(null,v,S,!1,F)},tc.unmountComponentAtNode=function(v){if(!$v(v))throw Error(n(40));return v._reactRootContainer?(Pr(function(){Dh(null,null,v,!1,function(){v._reactRootContainer=null,v[sl]=null})}),!0):!1},tc.unstable_batchedUpdates=_r,tc.unstable_renderSubtreeIntoContainer=function(v,S,F,H){if(!$v(F))throw Error(n(200));if(v==null||v._reactInternals===void 0)throw Error(n(38));return Dh(v,S,F,!1,H)},tc.version="18.3.1-next-f1338f8080-20240426",tc}var gO;function Nk(){if(gO)return RT.exports;gO=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),RT.exports=t8(),RT.exports}var _O;function n8(){if(_O)return qw;_O=1;var e=Nk();return qw.createRoot=e.createRoot,qw.hydrateRoot=e.hydrateRoot,qw}var r8=n8();function yO(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Tu(...e){return t=>{let n=!1;const r=e.map(a=>{const u=yO(a,t);return!n&&typeof u=="function"&&(n=!0),u});if(n)return()=>{for(let a=0;a<r.length;a++){const u=r[a];typeof u=="function"?u():yO(e[a],null)}}}}function Xr(...e){return Y.useCallback(Tu(...e),e)}function kk(e){const t=i8(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(s8);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}var rx=kk("Slot");function i8(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=l8(a),i=a8(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var o8=Symbol("radix.slottable");function s8(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===o8}function a8(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{const b=u(...i);return a(...i),b}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function l8(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function Fk(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=Fk(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function xE(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=Fk(e))&&(r&&(r+=" "),r+=t);return r}const vO=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,xO=xE,bE=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return xO(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:a,defaultVariants:u}=t,p=Object.keys(a).map(C=>{const A=n==null?void 0:n[C],R=u==null?void 0:u[C];if(A===null)return null;const z=vO(A)||vO(R);return a[C][z]}),i=n&&Object.entries(n).reduce((C,A)=>{let[R,z]=A;return z===void 0||(C[R]=z),C},{}),b=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((C,A)=>{let{class:R,className:z,...V}=A;return Object.entries(V).every(W=>{let[X,ue]=W;return Array.isArray(ue)?ue.includes({...u,...i}[X]):{...u,...i}[X]===ue})?[...C,R,z]:C},[]);return xO(e,p,b,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u8=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),zk=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c8={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h8=Y.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:u,iconNode:p,...i},b)=>Y.createElement("svg",{ref:b,...c8,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:zk("lucide",a),...i},[...p.map(([C,A])=>Y.createElement(C,A)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=(e,t)=>{const n=Y.forwardRef(({className:r,...a},u)=>Y.createElement(h8,{ref:u,iconNode:t,className:zk(`lucide-${u8(e)}`,r),...a}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d8=[["path",{d:"M18 15h-6v4l-7-7 7-7v4h6v6z",key:"lbrdak"}]],f8=oo("ArrowBigLeft",d8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p8=[["path",{d:"M6 9h6V5l7 7-7 7v-4H6V9z",key:"7fvt9c"}]],m8=oo("ArrowBigRight",p8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g8=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],_8=oo("ArrowUpDown",g8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y8=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],v8=oo("BadgeCheck",y8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x8=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M16 12h2",key:"7q9ll5"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M6 8h2",key:"30oboj"}]],b8=oo("BookOpenText",x8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w8=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]],B_=oo("BookText",w8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S8=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Sa=oo("Check",S8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E8=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],db=oo("ChevronDown",E8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C8=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],T8=oo("ChevronLeft",C8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I8=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Bk=oo("ChevronRight",I8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M8=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],jk=oo("ChevronUp",M8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P8=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],nf=oo("ChevronsUpDown",P8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A8=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],DT=oo("CircleCheck",A8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R8=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],L8=oo("Circle",R8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O8=[["path",{d:"M4 9a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h4a1 1 0 0 1 1 1v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4a1 1 0 0 1 1-1h4a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-4a1 1 0 0 1-1-1V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4a1 1 0 0 1-1 1z",key:"1xbrqy"}]],D8=oo("Cross",O8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N8=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],k8=oo("Download",N8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F8=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],z8=oo("Ellipsis",F8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B8=[["path",{d:"m15 18-.722-3.25",key:"1j64jw"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0",key:"1e7gxb"}],["path",{d:"m20 15-1.726-2.05",key:"1cnuld"}],["path",{d:"m4 15 1.726-2.05",key:"1dsqqd"}],["path",{d:"m9 18 .722-3.25",key:"ypw2yx"}]],j8=oo("EyeClosed",B8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V8=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],U8=oo("Eye",V8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G8=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Vk=oo("Layers",G8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $8=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],q8=oo("PanelLeft",$8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H8=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],bO=oo("Plus",H8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W8=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],X8=oo("RefreshCcw",W8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z8=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Uk=oo("RotateCcw",Z8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y8=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],K8=oo("Search",Y8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J8=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gk=oo("Settings",J8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q8=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],$k=oo("Trash2",Q8);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],t$=oo("Upload",e$);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],qk=oo("Wrench",n$);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r$=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],fb=oo("X",r$),NT=768;function i$(){const[e,t]=Y.useState(void 0);return Y.useEffect(()=>{const n=window.matchMedia(`(max-width: ${NT-1}px)`),r=()=>{t(window.innerWidth<NT)};return n.addEventListener("change",r),t(window.innerWidth<NT),()=>n.removeEventListener("change",r)},[]),!!e}const Y2="-",o$=e=>{const t=a$(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:p=>{const i=p.split(Y2);return i[0]===""&&i.length!==1&&i.shift(),Hk(i,t)||s$(p)},getConflictingClassGroupIds:(p,i)=>{const b=n[p]||[];return i&&r[p]?[...b,...r[p]]:b}}},Hk=(e,t)=>{var p;if(e.length===0)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),a=r?Hk(e.slice(1),r):void 0;if(a)return a;if(t.validators.length===0)return;const u=e.join(Y2);return(p=t.validators.find(({validator:i})=>i(u)))==null?void 0:p.classGroupId},wO=/^\[(.+)\]$/,s$=e=>{if(wO.test(e)){const t=wO.exec(e)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},a$=e=>{const{theme:t,classGroups:n}=e,r={nextPart:new Map,validators:[]};for(const a in n)AI(n[a],r,a,t);return r},AI=(e,t,n,r)=>{e.forEach(a=>{if(typeof a=="string"){const u=a===""?t:SO(t,a);u.classGroupId=n;return}if(typeof a=="function"){if(l$(a)){AI(a(r),t,n,r);return}t.validators.push({validator:a,classGroupId:n});return}Object.entries(a).forEach(([u,p])=>{AI(p,SO(t,u),n,r)})})},SO=(e,t)=>{let n=e;return t.split(Y2).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},l$=e=>e.isThemeGetter,u$=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const a=(u,p)=>{n.set(u,p),t++,t>e&&(t=0,r=n,n=new Map)};return{get(u){let p=n.get(u);if(p!==void 0)return p;if((p=r.get(u))!==void 0)return a(u,p),p},set(u,p){n.has(u)?n.set(u,p):a(u,p)}}},RI="!",LI=":",c$=LI.length,h$=e=>{const{prefix:t,experimentalParseClassName:n}=e;let r=a=>{const u=[];let p=0,i=0,b=0,C;for(let W=0;W<a.length;W++){let X=a[W];if(p===0&&i===0){if(X===LI){u.push(a.slice(b,W)),b=W+c$;continue}if(X==="/"){C=W;continue}}X==="["?p++:X==="]"?p--:X==="("?i++:X===")"&&i--}const A=u.length===0?a:a.substring(b),R=d$(A),z=R!==A,V=C&&C>b?C-b:void 0;return{modifiers:u,hasImportantModifier:z,baseClassName:R,maybePostfixModifierPosition:V}};if(t){const a=t+LI,u=r;r=p=>p.startsWith(a)?u(p.substring(a.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:p,maybePostfixModifierPosition:void 0}}if(n){const a=r;r=u=>n({className:u,parseClassName:a})}return r},d$=e=>e.endsWith(RI)?e.substring(0,e.length-1):e.startsWith(RI)?e.substring(1):e,f$=e=>{const t=Object.fromEntries(e.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const a=[];let u=[];return r.forEach(p=>{p[0]==="["||t[p]?(a.push(...u.sort(),p),u=[]):u.push(p)}),a.push(...u.sort()),a}},p$=e=>({cache:u$(e.cacheSize),parseClassName:h$(e),sortModifiers:f$(e),...o$(e)}),m$=/\s+/,g$=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a,sortModifiers:u}=t,p=[],i=e.trim().split(m$);let b="";for(let C=i.length-1;C>=0;C-=1){const A=i[C],{isExternal:R,modifiers:z,hasImportantModifier:V,baseClassName:W,maybePostfixModifierPosition:X}=n(A);if(R){b=A+(b.length>0?" "+b:b);continue}let ue=!!X,ie=r(ue?W.substring(0,X):W);if(!ie){if(!ue){b=A+(b.length>0?" "+b:b);continue}if(ie=r(W),!ie){b=A+(b.length>0?" "+b:b);continue}ue=!1}const K=u(z).join(":"),ee=V?K+RI:K,ae=ee+ie;if(p.includes(ae))continue;p.push(ae);const he=a(ie,ue);for(let xe=0;xe<he.length;++xe){const ye=he[xe];p.push(ee+ye)}b=A+(b.length>0?" "+b:b)}return b};function _$(){let e=0,t,n,r="";for(;e<arguments.length;)(t=arguments[e++])&&(n=Wk(t))&&(r&&(r+=" "),r+=n);return r}const Wk=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=Wk(e[r]))&&(n&&(n+=" "),n+=t);return n};function y$(e,...t){let n,r,a,u=p;function p(b){const C=t.reduce((A,R)=>R(A),e());return n=p$(C),r=n.cache.get,a=n.cache.set,u=i,i(b)}function i(b){const C=r(b);if(C)return C;const A=g$(b,n);return a(b,A),A}return function(){return u(_$.apply(null,arguments))}}const xa=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},Xk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Zk=/^\((?:(\w[\w-]*):)?(.+)\)$/i,v$=/^\d+\/\d+$/,x$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,b$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,w$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,S$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,E$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,a0=e=>v$.test(e),pi=e=>!!e&&!Number.isNaN(Number(e)),u_=e=>!!e&&Number.isInteger(Number(e)),kT=e=>e.endsWith("%")&&pi(e.slice(0,-1)),zm=e=>x$.test(e),C$=()=>!0,T$=e=>b$.test(e)&&!w$.test(e),Yk=()=>!1,I$=e=>S$.test(e),M$=e=>E$.test(e),P$=e=>!ar(e)&&!lr(e),A$=e=>ix(e,Qk,Yk),ar=e=>Xk.test(e),zy=e=>ix(e,e3,T$),FT=e=>ix(e,N$,pi),EO=e=>ix(e,Kk,Yk),R$=e=>ix(e,Jk,M$),Hw=e=>ix(e,t3,I$),lr=e=>Zk.test(e),g1=e=>ox(e,e3),L$=e=>ox(e,k$),CO=e=>ox(e,Kk),O$=e=>ox(e,Qk),D$=e=>ox(e,Jk),Ww=e=>ox(e,t3,!0),ix=(e,t,n)=>{const r=Xk.exec(e);return r?r[1]?t(r[1]):n(r[2]):!1},ox=(e,t,n=!1)=>{const r=Zk.exec(e);return r?r[1]?t(r[1]):n:!1},Kk=e=>e==="position"||e==="percentage",Jk=e=>e==="image"||e==="url",Qk=e=>e==="length"||e==="size"||e==="bg-size",e3=e=>e==="length",N$=e=>e==="number",k$=e=>e==="family-name",t3=e=>e==="shadow",F$=()=>{const e=xa("color"),t=xa("font"),n=xa("text"),r=xa("font-weight"),a=xa("tracking"),u=xa("leading"),p=xa("breakpoint"),i=xa("container"),b=xa("spacing"),C=xa("radius"),A=xa("shadow"),R=xa("inset-shadow"),z=xa("text-shadow"),V=xa("drop-shadow"),W=xa("blur"),X=xa("perspective"),ue=xa("aspect"),ie=xa("ease"),K=xa("animate"),ee=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ae=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],he=()=>[...ae(),lr,ar],xe=()=>["auto","hidden","clip","visible","scroll"],ye=()=>["auto","contain","none"],Se=()=>[lr,ar,b],je=()=>[a0,"full","auto",...Se()],Re=()=>[u_,"none","subgrid",lr,ar],De=()=>["auto",{span:["full",u_,lr,ar]},u_,lr,ar],at=()=>[u_,"auto",lr,ar],ot=()=>["auto","min","max","fr",lr,ar],Fe=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ze=()=>["start","end","center","stretch","center-safe","end-safe"],Ve=()=>["auto",...Se()],mt=()=>[a0,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Se()],We=()=>[e,lr,ar],tt=()=>[...ae(),CO,EO,{position:[lr,ar]}],Dt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],$e=()=>["auto","cover","contain",O$,A$,{size:[lr,ar]}],Ke=()=>[kT,g1,zy],gt=()=>["","none","full",C,lr,ar],Yt=()=>["",pi,g1,zy],Kt=()=>["solid","dashed","dotted","double"],nn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ut=()=>[pi,kT,CO,EO],wn=()=>["","none",W,lr,ar],Pn=()=>["none",pi,lr,ar],we=()=>["none",pi,lr,ar],Rr=()=>[pi,lr,ar],Mr=()=>[a0,"full",...Se()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[zm],breakpoint:[zm],color:[C$],container:[zm],"drop-shadow":[zm],ease:["in","out","in-out"],font:[P$],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[zm],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[zm],shadow:[zm],spacing:["px",pi],text:[zm],"text-shadow":[zm],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",a0,ar,lr,ue]}],container:["container"],columns:[{columns:[pi,ar,lr,i]}],"break-after":[{"break-after":ee()}],"break-before":[{"break-before":ee()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:he()}],overflow:[{overflow:xe()}],"overflow-x":[{"overflow-x":xe()}],"overflow-y":[{"overflow-y":xe()}],overscroll:[{overscroll:ye()}],"overscroll-x":[{"overscroll-x":ye()}],"overscroll-y":[{"overscroll-y":ye()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:je()}],"inset-x":[{"inset-x":je()}],"inset-y":[{"inset-y":je()}],start:[{start:je()}],end:[{end:je()}],top:[{top:je()}],right:[{right:je()}],bottom:[{bottom:je()}],left:[{left:je()}],visibility:["visible","invisible","collapse"],z:[{z:[u_,"auto",lr,ar]}],basis:[{basis:[a0,"full","auto",i,...Se()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[pi,a0,"auto","initial","none",ar]}],grow:[{grow:["",pi,lr,ar]}],shrink:[{shrink:["",pi,lr,ar]}],order:[{order:[u_,"first","last","none",lr,ar]}],"grid-cols":[{"grid-cols":Re()}],"col-start-end":[{col:De()}],"col-start":[{"col-start":at()}],"col-end":[{"col-end":at()}],"grid-rows":[{"grid-rows":Re()}],"row-start-end":[{row:De()}],"row-start":[{"row-start":at()}],"row-end":[{"row-end":at()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ot()}],"auto-rows":[{"auto-rows":ot()}],gap:[{gap:Se()}],"gap-x":[{"gap-x":Se()}],"gap-y":[{"gap-y":Se()}],"justify-content":[{justify:[...Fe(),"normal"]}],"justify-items":[{"justify-items":[...Ze(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ze()]}],"align-content":[{content:["normal",...Fe()]}],"align-items":[{items:[...Ze(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ze(),{baseline:["","last"]}]}],"place-content":[{"place-content":Fe()}],"place-items":[{"place-items":[...Ze(),"baseline"]}],"place-self":[{"place-self":["auto",...Ze()]}],p:[{p:Se()}],px:[{px:Se()}],py:[{py:Se()}],ps:[{ps:Se()}],pe:[{pe:Se()}],pt:[{pt:Se()}],pr:[{pr:Se()}],pb:[{pb:Se()}],pl:[{pl:Se()}],m:[{m:Ve()}],mx:[{mx:Ve()}],my:[{my:Ve()}],ms:[{ms:Ve()}],me:[{me:Ve()}],mt:[{mt:Ve()}],mr:[{mr:Ve()}],mb:[{mb:Ve()}],ml:[{ml:Ve()}],"space-x":[{"space-x":Se()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Se()}],"space-y-reverse":["space-y-reverse"],size:[{size:mt()}],w:[{w:[i,"screen",...mt()]}],"min-w":[{"min-w":[i,"screen","none",...mt()]}],"max-w":[{"max-w":[i,"screen","none","prose",{screen:[p]},...mt()]}],h:[{h:["screen",...mt()]}],"min-h":[{"min-h":["screen","none",...mt()]}],"max-h":[{"max-h":["screen",...mt()]}],"font-size":[{text:["base",n,g1,zy]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,lr,FT]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",kT,ar]}],"font-family":[{font:[L$,ar,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,lr,ar]}],"line-clamp":[{"line-clamp":[pi,"none",lr,FT]}],leading:[{leading:[u,...Se()]}],"list-image":[{"list-image":["none",lr,ar]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",lr,ar]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:We()}],"text-color":[{text:We()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Kt(),"wavy"]}],"text-decoration-thickness":[{decoration:[pi,"from-font","auto",lr,zy]}],"text-decoration-color":[{decoration:We()}],"underline-offset":[{"underline-offset":[pi,"auto",lr,ar]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Se()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",lr,ar]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",lr,ar]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:tt()}],"bg-repeat":[{bg:Dt()}],"bg-size":[{bg:$e()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},u_,lr,ar],radial:["",lr,ar],conic:[u_,lr,ar]},D$,R$]}],"bg-color":[{bg:We()}],"gradient-from-pos":[{from:Ke()}],"gradient-via-pos":[{via:Ke()}],"gradient-to-pos":[{to:Ke()}],"gradient-from":[{from:We()}],"gradient-via":[{via:We()}],"gradient-to":[{to:We()}],rounded:[{rounded:gt()}],"rounded-s":[{"rounded-s":gt()}],"rounded-e":[{"rounded-e":gt()}],"rounded-t":[{"rounded-t":gt()}],"rounded-r":[{"rounded-r":gt()}],"rounded-b":[{"rounded-b":gt()}],"rounded-l":[{"rounded-l":gt()}],"rounded-ss":[{"rounded-ss":gt()}],"rounded-se":[{"rounded-se":gt()}],"rounded-ee":[{"rounded-ee":gt()}],"rounded-es":[{"rounded-es":gt()}],"rounded-tl":[{"rounded-tl":gt()}],"rounded-tr":[{"rounded-tr":gt()}],"rounded-br":[{"rounded-br":gt()}],"rounded-bl":[{"rounded-bl":gt()}],"border-w":[{border:Yt()}],"border-w-x":[{"border-x":Yt()}],"border-w-y":[{"border-y":Yt()}],"border-w-s":[{"border-s":Yt()}],"border-w-e":[{"border-e":Yt()}],"border-w-t":[{"border-t":Yt()}],"border-w-r":[{"border-r":Yt()}],"border-w-b":[{"border-b":Yt()}],"border-w-l":[{"border-l":Yt()}],"divide-x":[{"divide-x":Yt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Yt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Kt(),"hidden","none"]}],"divide-style":[{divide:[...Kt(),"hidden","none"]}],"border-color":[{border:We()}],"border-color-x":[{"border-x":We()}],"border-color-y":[{"border-y":We()}],"border-color-s":[{"border-s":We()}],"border-color-e":[{"border-e":We()}],"border-color-t":[{"border-t":We()}],"border-color-r":[{"border-r":We()}],"border-color-b":[{"border-b":We()}],"border-color-l":[{"border-l":We()}],"divide-color":[{divide:We()}],"outline-style":[{outline:[...Kt(),"none","hidden"]}],"outline-offset":[{"outline-offset":[pi,lr,ar]}],"outline-w":[{outline:["",pi,g1,zy]}],"outline-color":[{outline:We()}],shadow:[{shadow:["","none",A,Ww,Hw]}],"shadow-color":[{shadow:We()}],"inset-shadow":[{"inset-shadow":["none",R,Ww,Hw]}],"inset-shadow-color":[{"inset-shadow":We()}],"ring-w":[{ring:Yt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:We()}],"ring-offset-w":[{"ring-offset":[pi,zy]}],"ring-offset-color":[{"ring-offset":We()}],"inset-ring-w":[{"inset-ring":Yt()}],"inset-ring-color":[{"inset-ring":We()}],"text-shadow":[{"text-shadow":["none",z,Ww,Hw]}],"text-shadow-color":[{"text-shadow":We()}],opacity:[{opacity:[pi,lr,ar]}],"mix-blend":[{"mix-blend":[...nn(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":nn()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[pi]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ut()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ut()}],"mask-image-linear-from-color":[{"mask-linear-from":We()}],"mask-image-linear-to-color":[{"mask-linear-to":We()}],"mask-image-t-from-pos":[{"mask-t-from":Ut()}],"mask-image-t-to-pos":[{"mask-t-to":Ut()}],"mask-image-t-from-color":[{"mask-t-from":We()}],"mask-image-t-to-color":[{"mask-t-to":We()}],"mask-image-r-from-pos":[{"mask-r-from":Ut()}],"mask-image-r-to-pos":[{"mask-r-to":Ut()}],"mask-image-r-from-color":[{"mask-r-from":We()}],"mask-image-r-to-color":[{"mask-r-to":We()}],"mask-image-b-from-pos":[{"mask-b-from":Ut()}],"mask-image-b-to-pos":[{"mask-b-to":Ut()}],"mask-image-b-from-color":[{"mask-b-from":We()}],"mask-image-b-to-color":[{"mask-b-to":We()}],"mask-image-l-from-pos":[{"mask-l-from":Ut()}],"mask-image-l-to-pos":[{"mask-l-to":Ut()}],"mask-image-l-from-color":[{"mask-l-from":We()}],"mask-image-l-to-color":[{"mask-l-to":We()}],"mask-image-x-from-pos":[{"mask-x-from":Ut()}],"mask-image-x-to-pos":[{"mask-x-to":Ut()}],"mask-image-x-from-color":[{"mask-x-from":We()}],"mask-image-x-to-color":[{"mask-x-to":We()}],"mask-image-y-from-pos":[{"mask-y-from":Ut()}],"mask-image-y-to-pos":[{"mask-y-to":Ut()}],"mask-image-y-from-color":[{"mask-y-from":We()}],"mask-image-y-to-color":[{"mask-y-to":We()}],"mask-image-radial":[{"mask-radial":[lr,ar]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ut()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ut()}],"mask-image-radial-from-color":[{"mask-radial-from":We()}],"mask-image-radial-to-color":[{"mask-radial-to":We()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":ae()}],"mask-image-conic-pos":[{"mask-conic":[pi]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ut()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ut()}],"mask-image-conic-from-color":[{"mask-conic-from":We()}],"mask-image-conic-to-color":[{"mask-conic-to":We()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:tt()}],"mask-repeat":[{mask:Dt()}],"mask-size":[{mask:$e()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",lr,ar]}],filter:[{filter:["","none",lr,ar]}],blur:[{blur:wn()}],brightness:[{brightness:[pi,lr,ar]}],contrast:[{contrast:[pi,lr,ar]}],"drop-shadow":[{"drop-shadow":["","none",V,Ww,Hw]}],"drop-shadow-color":[{"drop-shadow":We()}],grayscale:[{grayscale:["",pi,lr,ar]}],"hue-rotate":[{"hue-rotate":[pi,lr,ar]}],invert:[{invert:["",pi,lr,ar]}],saturate:[{saturate:[pi,lr,ar]}],sepia:[{sepia:["",pi,lr,ar]}],"backdrop-filter":[{"backdrop-filter":["","none",lr,ar]}],"backdrop-blur":[{"backdrop-blur":wn()}],"backdrop-brightness":[{"backdrop-brightness":[pi,lr,ar]}],"backdrop-contrast":[{"backdrop-contrast":[pi,lr,ar]}],"backdrop-grayscale":[{"backdrop-grayscale":["",pi,lr,ar]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[pi,lr,ar]}],"backdrop-invert":[{"backdrop-invert":["",pi,lr,ar]}],"backdrop-opacity":[{"backdrop-opacity":[pi,lr,ar]}],"backdrop-saturate":[{"backdrop-saturate":[pi,lr,ar]}],"backdrop-sepia":[{"backdrop-sepia":["",pi,lr,ar]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Se()}],"border-spacing-x":[{"border-spacing-x":Se()}],"border-spacing-y":[{"border-spacing-y":Se()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",lr,ar]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[pi,"initial",lr,ar]}],ease:[{ease:["linear","initial",ie,lr,ar]}],delay:[{delay:[pi,lr,ar]}],animate:[{animate:["none",K,lr,ar]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[X,lr,ar]}],"perspective-origin":[{"perspective-origin":he()}],rotate:[{rotate:Pn()}],"rotate-x":[{"rotate-x":Pn()}],"rotate-y":[{"rotate-y":Pn()}],"rotate-z":[{"rotate-z":Pn()}],scale:[{scale:we()}],"scale-x":[{"scale-x":we()}],"scale-y":[{"scale-y":we()}],"scale-z":[{"scale-z":we()}],"scale-3d":["scale-3d"],skew:[{skew:Rr()}],"skew-x":[{"skew-x":Rr()}],"skew-y":[{"skew-y":Rr()}],transform:[{transform:[lr,ar,"","none","gpu","cpu"]}],"transform-origin":[{origin:he()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Mr()}],"translate-x":[{"translate-x":Mr()}],"translate-y":[{"translate-y":Mr()}],"translate-z":[{"translate-z":Mr()}],"translate-none":["translate-none"],accent:[{accent:We()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:We()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",lr,ar]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Se()}],"scroll-mx":[{"scroll-mx":Se()}],"scroll-my":[{"scroll-my":Se()}],"scroll-ms":[{"scroll-ms":Se()}],"scroll-me":[{"scroll-me":Se()}],"scroll-mt":[{"scroll-mt":Se()}],"scroll-mr":[{"scroll-mr":Se()}],"scroll-mb":[{"scroll-mb":Se()}],"scroll-ml":[{"scroll-ml":Se()}],"scroll-p":[{"scroll-p":Se()}],"scroll-px":[{"scroll-px":Se()}],"scroll-py":[{"scroll-py":Se()}],"scroll-ps":[{"scroll-ps":Se()}],"scroll-pe":[{"scroll-pe":Se()}],"scroll-pt":[{"scroll-pt":Se()}],"scroll-pr":[{"scroll-pr":Se()}],"scroll-pb":[{"scroll-pb":Se()}],"scroll-pl":[{"scroll-pl":Se()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",lr,ar]}],fill:[{fill:["none",...We()]}],"stroke-w":[{stroke:[pi,g1,zy,FT]}],stroke:[{stroke:["none",...We()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},z$=y$(F$),TO=e=>{let t;const n=new Set,r=(C,A)=>{const R=typeof C=="function"?C(t):C;if(!Object.is(R,t)){const z=t;t=A??(typeof R!="object"||R===null)?R:Object.assign({},t,R),n.forEach(V=>V(t,z))}},a=()=>t,i={setState:r,getState:a,getInitialState:()=>b,subscribe:C=>(n.add(C),()=>n.delete(C))},b=t=e(r,a,i);return i},B$=e=>e?TO(e):TO,j$=e=>e;function V$(e,t=j$){const n=Zt.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return Zt.useDebugValue(n),n}const IO=e=>{const t=B$(e),n=r=>V$(t,r);return Object.assign(n,t),n},pb=e=>e?IO(e):IO,MO={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"transparent"}}]},DS={streets:"mapbox://styles/mapbox/streets-v12",outdoors:"mapbox://styles/mapbox/outdoors-v12",light:"mapbox://styles/mapbox/light-v11",dark:"mapbox://styles/mapbox/dark-v11",satellite:"mapbox://styles/mapbox/satellite-v9",satelliteStreets:"mapbox://styles/mapbox/satellite-streets-v12",navigationDay:"mapbox://styles/mapbox/navigation-day-v1",navigationNight:"mapbox://styles/mapbox/navigation-night-v1",blueprint:"mapbox://styles/mortened/cmai5mq6e00y601qyh8e5dmrv",Blank:"blank"};function U$(e){let t="fill";e.geometryType==="Point"||e.geometryType==="MultiPoint"?t="circle":(e.geometryType==="LineString"||e.geometryType==="MultiLineString")&&(t="line");const n=t==="fill"?{"fill-color":e.fillColor,"fill-opacity":e.fillOpacity}:t==="line"?{"line-color":e.fillColor,"line-opacity":e.fillOpacity,"line-width":2}:{"circle-color":e.fillColor,"circle-opacity":e.fillOpacity,"circle-radius":5};return{layerType:t,paint:n}}const qh=pb((e,t)=>({map:null,isBaseVisible:!0,currentStyle:"dark",setMap:n=>e({map:n}),toggleBaseVisibility:async()=>{const{map:n,isBaseVisible:r}=t();if(!n)return;const a=!r,u=wo.getState().layers,p=n.getCenter(),i=n.getZoom(),b=n.getBearing(),C=n.getPitch();console.log("Changing style to:",a?"streets":"blank");const A=a?DS[t().currentStyle]:MO;n.setStyle(A),await new Promise(R=>{n.once("style.load",()=>{n.setCenter(p),n.setZoom(i),n.setBearing(b),n.setPitch(C),u.forEach(z=>{let V="fill";z.geometryType.includes("Point")?V="circle":z.geometryType.includes("LineString")&&(V="line"),n.addSource(z.id,{type:"geojson",data:z.data}),n.addLayer({id:z.id,type:V,source:z.id,paint:{...V==="fill"&&{"fill-color":z.fillColor,"fill-opacity":z.fillOpacity},...V==="circle"&&{"circle-color":z.fillColor,"circle-opacity":z.fillOpacity},...V==="line"&&{"line-color":z.fillColor,"line-opacity":z.fillOpacity,"line-width":2}},layout:{visibility:z.visible?"visible":"none"}})}),R()})}),console.log("Setting new visibility:",a),e({isBaseVisible:a})},updateMapLayers:()=>{const{map:n}=t(),r=wo.getState().layers;n&&(r.forEach(a=>{n.getLayer(a.id)&&n.removeLayer(a.id),n.getSource(a.id)&&n.removeSource(a.id)}),r.forEach(a=>{n.addSource(a.id,{type:"geojson",data:a.data});let u="fill";a.geometryType==="Point"||a.geometryType==="MultiPoint"?u="circle":(a.geometryType==="LineString"||a.geometryType==="MultiLineString")&&(u="line");const p=u==="fill"?{"fill-color":a.fillColor,"fill-opacity":a.fillOpacity}:u==="line"?{"line-color":a.fillColor,"line-opacity":a.fillOpacity,"line-width":2}:{"circle-color":a.fillColor,"circle-opacity":a.fillOpacity,"circle-radius":5};n.addLayer({id:a.id,type:u,source:a.id,paint:p,layout:{visibility:a.visible?"visible":"none"}})}))},updateMapStyle:n=>{const{map:r,isBaseVisible:a}=t();if(!r)return;e({currentStyle:n}),a||e({isBaseVisible:!0});const u=n==="Blank"?MO:DS[n];r.setStyle(u),r.once("style.load",()=>{wo.getState().layers.forEach(i=>{r.addSource(i.id,{type:"geojson",data:i.data});const{layerType:b,paint:C}=U$(i);r.addLayer({id:i.id,type:b,source:i.id,paint:C,layout:{visibility:i.visible?"visible":"none"}})})})}})),wo=pb((e,t)=>({layers:[],selectedLayerId:null,setSelectedLayer:n=>{const r=qh.getState().map,{selectedLayerId:a,layers:u}=t();if(r&&a&&r.getLayer(`${a}-highlight`)&&(r.removeLayer(`${a}-highlight`),r.removeSource(`${a}-highlight`)),r&&n){const p=u.find(i=>i.id===n);p&&(r.addSource(`${n}-highlight`,{type:"geojson",data:p.data}),p.geometryType.includes("Point")?r.addLayer({id:`${n}-highlight`,type:"circle",source:`${n}-highlight`,paint:{"circle-radius":8,"circle-stroke-color":"#ff0000","circle-stroke-width":4,"circle-color":"rgba(0,0,0,0)"}}):p.geometryType.includes("Line")?r.addLayer({id:`${n}-highlight`,type:"line",source:`${n}-highlight`,paint:{"line-color":"#ff0000","line-width":6}}):r.addLayer({id:`${n}-highlight`,type:"line",source:`${n}-highlight`,paint:{"line-color":"#ff0000","line-width":4}}))}e({selectedLayerId:n})},addLayer:n=>{var i;const r=qh.getState().map;if(!r){console.error("Map is not initialized");return}if(!n||!n.data){console.error("Layer or data is undefined:",{layer:n});return}const a=(i=n.data.features[0])==null?void 0:i.geometry.type;if(!a){console.error("Geometry type is undefined for layer:",{layer:n});return}let u="fill";a==="Point"||a==="MultiPoint"?u="circle":(a==="LineString"||a==="MultiLineString")&&(u="line");let p="Polygon";a==="Point"||a==="MultiPoint"?p="Point":(a==="LineString"||a==="MultiLineString")&&(p="LineString"),r.addSource(n.id,{type:"geojson",data:n.data}),r.addLayer({id:n.id,type:u,source:n.id,paint:{...u==="fill"&&{"fill-color":n.fillColor,"fill-opacity":n.fillOpacity},...u==="circle"&&{"circle-color":n.fillColor,"circle-opacity":n.fillOpacity,"circle-radius":5},...u==="line"&&{"line-color":n.fillColor,"line-opacity":n.fillOpacity,"line-width":2}},layout:{visibility:n.visible?"visible":"none"}}),e(b=>({layers:[...b.layers,{...n,geometryType:n.geometryType??p}]}))},removeLayer:n=>{const r=qh.getState().map;r&&(r.getLayer(n)&&r.removeLayer(n),r.getSource(n)&&r.removeSource(n)),e(a=>({layers:a.layers.filter(u=>u.id!==n)}))},updateLayer:(n,r)=>{const a=qh.getState().map;if(console.log("called updateLayer with id:",n,"and layer:",r),!a||!a.getSource(n))return;console.log("Updating layer",r.id,"with geometryType:",r.geometryType,"and color:",r.fillColor);const u=a.getSource(n);u&&u.setData(r.data),r.geometryType==="Polygon"||r.geometryType==="MultiPolygon"?(a.setPaintProperty(n,"fill-color",r.fillColor),a.setPaintProperty(n,"fill-opacity",r.fillOpacity)):r.geometryType==="Point"||r.geometryType==="MultiPoint"?(a.setPaintProperty(n,"circle-color",r.fillColor),a.setPaintProperty(n,"circle-opacity",r.fillOpacity)):(r.geometryType==="LineString"||r.geometryType==="MultiLineString")&&(a.setPaintProperty(n,"line-color",r.fillColor),a.setPaintProperty(n,"line-opacity",r.fillOpacity)),e(p=>({layers:p.layers.map(i=>i.id===n?r:i)}))},toggleLayer:n=>{const r=qh.getState().map;if(r&&r.getLayer(n)){const u=r.getLayoutProperty(n,"visibility")==="visible"?"none":"visible";console.log(u),r.setLayoutProperty(n,"visibility",u)}e(a=>({layers:a.layers.map(u=>u.id===n?{...u,visible:!u.visible}:u)}))},reorderLayers:(n,r)=>{const a=t().layers,u=a[n],p=a.filter((i,b)=>b!==n);p.splice(r,0,u),e({layers:p})}}));function dn(...e){return z$(xE(e))}function Cp(e){const t="/";return e.startsWith("/")?t+e.slice(1):t+e}function ba(e){const t=wo.getState().layers.map(a=>a.name);let n=e,r=1;for(;t.includes(n);)n=`${e} (${r})`,r++;return n}const G$=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe"];function Ds(e=[]){const t=new Set([...wo.getState().layers.map(r=>r.fillColor),...e]);for(const r of G$)if(!t.has(r))return r;let n;do n="#"+Math.random().toString(16).slice(2,8).padStart(6,"0");while(t.has(n));return n}function n3(e,t){var n,r,a;return((n=e.id)==null?void 0:n.toString())??((a=(r=e.properties)==null?void 0:r.id)==null?void 0:a.toString())??t.toString()}const K2=bE("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Qr=Y.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...a},u)=>{const p=r?rx:"button";return G.jsx(p,{className:dn(K2({variant:t,size:n,className:e})),ref:u,...a})});Qr.displayName="Button";const E0=Y.forwardRef(({className:e,type:t,...n},r)=>G.jsx("input",{type:t,className:dn("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...n}));E0.displayName="Input";var Jd=Nk();const jy=dd(Jd);function $$(e){const t=q$(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(W$);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function q$(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=Z$(a),i=X$(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var H$=Symbol("radix.slottable");function W$(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===H$}function X$(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function Z$(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Y$=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ir=Y$.reduce((e,t)=>{const n=$$(`Primitive.${t}`),r=Y.forwardRef((a,u)=>{const{asChild:p,...i}=a,b=p?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(b,{...i,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function r3(e,t){e&&Jd.flushSync(()=>e.dispatchEvent(t))}var K$="Separator",PO="horizontal",J$=["horizontal","vertical"],i3=Y.forwardRef((e,t)=>{const{decorative:n,orientation:r=PO,...a}=e,u=Q$(r)?r:PO,i=n?{role:"none"}:{"aria-orientation":u==="vertical"?u:void 0,role:"separator"};return G.jsx(Ir.div,{"data-orientation":u,...i,...a,ref:t})});i3.displayName=K$;function Q$(e){return J$.includes(e)}var o3=i3;const s3=Y.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...r},a)=>G.jsx(o3,{ref:a,decorative:n,orientation:t,className:dn("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...r}));s3.displayName=o3.displayName;function Dn(e,t,{checkForDefaultPrevented:n=!0}={}){return function(a){if(e==null||e(a),n===!1||!a.defaultPrevented)return t==null?void 0:t(a)}}function eq(e,t){const n=Y.createContext(t),r=u=>{const{children:p,...i}=u,b=Y.useMemo(()=>i,Object.values(i));return G.jsx(n.Provider,{value:b,children:p})};r.displayName=e+"Provider";function a(u){const p=Y.useContext(n);if(p)return p;if(t!==void 0)return t;throw new Error(`\`${u}\` must be used within \`${e}\``)}return[r,a]}function Zl(e,t=[]){let n=[];function r(u,p){const i=Y.createContext(p),b=n.length;n=[...n,p];const C=R=>{var ie;const{scope:z,children:V,...W}=R,X=((ie=z==null?void 0:z[e])==null?void 0:ie[b])||i,ue=Y.useMemo(()=>W,Object.values(W));return G.jsx(X.Provider,{value:ue,children:V})};C.displayName=u+"Provider";function A(R,z){var X;const V=((X=z==null?void 0:z[e])==null?void 0:X[b])||i,W=Y.useContext(V);if(W)return W;if(p!==void 0)return p;throw new Error(`\`${R}\` must be used within \`${u}\``)}return[C,A]}const a=()=>{const u=n.map(p=>Y.createContext(p));return function(i){const b=(i==null?void 0:i[e])||u;return Y.useMemo(()=>({[`__scope${e}`]:{...i,[e]:b}}),[i,b])}};return a.scopeName=e,[r,tq(a,...t)]}function tq(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(u){const p=r.reduce((i,{useScope:b,scopeName:C})=>{const R=b(u)[`__scope${C}`];return{...i,...R}},{});return Y.useMemo(()=>({[`__scope${t.scopeName}`]:p}),[p])}};return n.scopeName=t.scopeName,n}var na=globalThis!=null&&globalThis.document?Y.useLayoutEffect:()=>{},nq=Dk[" useId ".trim().toString()]||(()=>{}),rq=0;function Ns(e){const[t,n]=Y.useState(nq());return na(()=>{n(r=>r??String(rq++))},[e]),e||(t?`radix-${t}`:"")}var iq=Dk[" useInsertionEffect ".trim().toString()]||na;function Hc({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[a,u,p]=oq({defaultProp:t,onChange:n}),i=e!==void 0,b=i?e:a;{const A=Y.useRef(e!==void 0);Y.useEffect(()=>{const R=A.current;R!==i&&console.warn(`${r} is changing from ${R?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),A.current=i},[i,r])}const C=Y.useCallback(A=>{var R;if(i){const z=sq(A)?A(e):A;z!==e&&((R=p.current)==null||R.call(p,z))}else u(A)},[i,e,u,p]);return[b,C]}function oq({defaultProp:e,onChange:t}){const[n,r]=Y.useState(e),a=Y.useRef(n),u=Y.useRef(t);return iq(()=>{u.current=t},[t]),Y.useEffect(()=>{var p;a.current!==n&&((p=u.current)==null||p.call(u,n),a.current=n)},[n,a]),[n,r,u]}function sq(e){return typeof e=="function"}function fd(e){const t=Y.useRef(e);return Y.useEffect(()=>{t.current=e}),Y.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function a3(e,t=globalThis==null?void 0:globalThis.document){const n=fd(e);Y.useEffect(()=>{const r=a=>{a.key==="Escape"&&n(a)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var aq="DismissableLayer",OI="dismissableLayer.update",lq="dismissableLayer.pointerDownOutside",uq="dismissableLayer.focusOutside",AO,l3=Y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mb=Y.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:u,onInteractOutside:p,onDismiss:i,...b}=e,C=Y.useContext(l3),[A,R]=Y.useState(null),z=(A==null?void 0:A.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,V]=Y.useState({}),W=Xr(t,ye=>R(ye)),X=Array.from(C.layers),[ue]=[...C.layersWithOutsidePointerEventsDisabled].slice(-1),ie=X.indexOf(ue),K=A?X.indexOf(A):-1,ee=C.layersWithOutsidePointerEventsDisabled.size>0,ae=K>=ie,he=dq(ye=>{const Se=ye.target,je=[...C.branches].some(Re=>Re.contains(Se));!ae||je||(a==null||a(ye),p==null||p(ye),ye.defaultPrevented||i==null||i())},z),xe=fq(ye=>{const Se=ye.target;[...C.branches].some(Re=>Re.contains(Se))||(u==null||u(ye),p==null||p(ye),ye.defaultPrevented||i==null||i())},z);return a3(ye=>{K===C.layers.size-1&&(r==null||r(ye),!ye.defaultPrevented&&i&&(ye.preventDefault(),i()))},z),Y.useEffect(()=>{if(A)return n&&(C.layersWithOutsidePointerEventsDisabled.size===0&&(AO=z.body.style.pointerEvents,z.body.style.pointerEvents="none"),C.layersWithOutsidePointerEventsDisabled.add(A)),C.layers.add(A),RO(),()=>{n&&C.layersWithOutsidePointerEventsDisabled.size===1&&(z.body.style.pointerEvents=AO)}},[A,z,n,C]),Y.useEffect(()=>()=>{A&&(C.layers.delete(A),C.layersWithOutsidePointerEventsDisabled.delete(A),RO())},[A,C]),Y.useEffect(()=>{const ye=()=>V({});return document.addEventListener(OI,ye),()=>document.removeEventListener(OI,ye)},[]),G.jsx(Ir.div,{...b,ref:W,style:{pointerEvents:ee?ae?"auto":"none":void 0,...e.style},onFocusCapture:Dn(e.onFocusCapture,xe.onFocusCapture),onBlurCapture:Dn(e.onBlurCapture,xe.onBlurCapture),onPointerDownCapture:Dn(e.onPointerDownCapture,he.onPointerDownCapture)})});mb.displayName=aq;var cq="DismissableLayerBranch",hq=Y.forwardRef((e,t)=>{const n=Y.useContext(l3),r=Y.useRef(null),a=Xr(t,r);return Y.useEffect(()=>{const u=r.current;if(u)return n.branches.add(u),()=>{n.branches.delete(u)}},[n.branches]),G.jsx(Ir.div,{...e,ref:a})});hq.displayName=cq;function dq(e,t=globalThis==null?void 0:globalThis.document){const n=fd(e),r=Y.useRef(!1),a=Y.useRef(()=>{});return Y.useEffect(()=>{const u=i=>{if(i.target&&!r.current){let b=function(){u3(lq,n,C,{discrete:!0})};const C={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=b,t.addEventListener("click",a.current,{once:!0})):b()}else t.removeEventListener("click",a.current);r.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",u),t.removeEventListener("click",a.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function fq(e,t=globalThis==null?void 0:globalThis.document){const n=fd(e),r=Y.useRef(!1);return Y.useEffect(()=>{const a=u=>{u.target&&!r.current&&u3(uq,n,{originalEvent:u},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function RO(){const e=new CustomEvent(OI);document.dispatchEvent(e)}function u3(e,t,n,{discrete:r}){const a=n.originalEvent.target,u=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?r3(a,u):a.dispatchEvent(u)}function LO(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function c3(...e){return t=>{let n=!1;const r=e.map(a=>{const u=LO(a,t);return!n&&typeof u=="function"&&(n=!0),u});if(n)return()=>{for(let a=0;a<r.length;a++){const u=r[a];typeof u=="function"?u():LO(e[a],null)}}}}function pq(...e){return Y.useCallback(c3(...e),e)}var h3=Y.forwardRef((e,t)=>{const{children:n,...r}=e,a=Y.Children.toArray(n),u=a.find(gq);if(u){const p=u.props.children,i=a.map(b=>b===u?Y.Children.count(p)>1?Y.Children.only(null):Y.isValidElement(p)?p.props.children:null:b);return G.jsx(DI,{...r,ref:t,children:Y.isValidElement(p)?Y.cloneElement(p,void 0,i):null})}return G.jsx(DI,{...r,ref:t,children:n})});h3.displayName="Slot";var DI=Y.forwardRef((e,t)=>{const{children:n,...r}=e;if(Y.isValidElement(n)){const a=yq(n);return Y.cloneElement(n,{..._q(r,n.props),ref:t?c3(t,a):a})}return Y.Children.count(n)>1?Y.Children.only(null):null});DI.displayName="SlotClone";var mq=({children:e})=>G.jsx(G.Fragment,{children:e});function gq(e){return Y.isValidElement(e)&&e.type===mq}function _q(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function yq(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var vq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],xq=vq.reduce((e,t)=>{const n=Y.forwardRef((r,a)=>{const{asChild:u,...p}=r,i=u?h3:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(i,{...p,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function OO(e){const t=Y.useRef(e);return Y.useEffect(()=>{t.current=e}),Y.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}var zT="focusScope.autoFocusOnMount",BT="focusScope.autoFocusOnUnmount",DO={bubbles:!1,cancelable:!0},bq="FocusScope",gb=Y.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:u,...p}=e,[i,b]=Y.useState(null),C=OO(a),A=OO(u),R=Y.useRef(null),z=pq(t,X=>b(X)),V=Y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Y.useEffect(()=>{if(r){let X=function(ee){if(V.paused||!i)return;const ae=ee.target;i.contains(ae)?R.current=ae:d_(R.current,{select:!0})},ue=function(ee){if(V.paused||!i)return;const ae=ee.relatedTarget;ae!==null&&(i.contains(ae)||d_(R.current,{select:!0}))},ie=function(ee){if(document.activeElement===document.body)for(const he of ee)he.removedNodes.length>0&&d_(i)};document.addEventListener("focusin",X),document.addEventListener("focusout",ue);const K=new MutationObserver(ie);return i&&K.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",X),document.removeEventListener("focusout",ue),K.disconnect()}}},[r,i,V.paused]),Y.useEffect(()=>{if(i){kO.add(V);const X=document.activeElement;if(!i.contains(X)){const ie=new CustomEvent(zT,DO);i.addEventListener(zT,C),i.dispatchEvent(ie),ie.defaultPrevented||(wq(Iq(d3(i)),{select:!0}),document.activeElement===X&&d_(i))}return()=>{i.removeEventListener(zT,C),setTimeout(()=>{const ie=new CustomEvent(BT,DO);i.addEventListener(BT,A),i.dispatchEvent(ie),ie.defaultPrevented||d_(X??document.body,{select:!0}),i.removeEventListener(BT,A),kO.remove(V)},0)}}},[i,C,A,V]);const W=Y.useCallback(X=>{if(!n&&!r||V.paused)return;const ue=X.key==="Tab"&&!X.altKey&&!X.ctrlKey&&!X.metaKey,ie=document.activeElement;if(ue&&ie){const K=X.currentTarget,[ee,ae]=Sq(K);ee&&ae?!X.shiftKey&&ie===ae?(X.preventDefault(),n&&d_(ee,{select:!0})):X.shiftKey&&ie===ee&&(X.preventDefault(),n&&d_(ae,{select:!0})):ie===K&&X.preventDefault()}},[n,r,V.paused]);return G.jsx(xq.div,{tabIndex:-1,...p,ref:z,onKeyDown:W})});gb.displayName=bq;function wq(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(d_(r,{select:t}),document.activeElement!==n)return}function Sq(e){const t=d3(e),n=NO(t,e),r=NO(t.reverse(),e);return[n,r]}function d3(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const a=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||a?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function NO(e,t){for(const n of e)if(!Eq(n,{upTo:t}))return n}function Eq(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Cq(e){return e instanceof HTMLInputElement&&"select"in e}function d_(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Cq(e)&&t&&e.select()}}var kO=Tq();function Tq(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=FO(e,t),e.unshift(t)},remove(t){var n;e=FO(e,t),(n=e[0])==null||n.resume()}}}function FO(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Iq(e){return e.filter(t=>t.tagName!=="A")}var Mq="Portal",_b=Y.forwardRef((e,t)=>{var i;const{container:n,...r}=e,[a,u]=Y.useState(!1);na(()=>u(!0),[]);const p=n||a&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return p?jy.createPortal(G.jsx(Ir.div,{...r,ref:t}),p):null});_b.displayName=Mq;function Pq(e,t){return Y.useReducer((n,r)=>t[n][r]??n,e)}var pc=e=>{const{present:t,children:n}=e,r=Aq(t),a=typeof n=="function"?n({present:r.isPresent}):Y.Children.only(n),u=Xr(r.ref,Rq(a));return typeof n=="function"||r.isPresent?Y.cloneElement(a,{ref:u}):null};pc.displayName="Presence";function Aq(e){const[t,n]=Y.useState(),r=Y.useRef(null),a=Y.useRef(e),u=Y.useRef("none"),p=e?"mounted":"unmounted",[i,b]=Pq(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Y.useEffect(()=>{const C=Xw(r.current);u.current=i==="mounted"?C:"none"},[i]),na(()=>{const C=r.current,A=a.current;if(A!==e){const z=u.current,V=Xw(C);e?b("MOUNT"):V==="none"||(C==null?void 0:C.display)==="none"?b("UNMOUNT"):b(A&&z!==V?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,b]),na(()=>{if(t){let C;const A=t.ownerDocument.defaultView??window,R=V=>{const X=Xw(r.current).includes(V.animationName);if(V.target===t&&X&&(b("ANIMATION_END"),!a.current)){const ue=t.style.animationFillMode;t.style.animationFillMode="forwards",C=A.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=ue)})}},z=V=>{V.target===t&&(u.current=Xw(r.current))};return t.addEventListener("animationstart",z),t.addEventListener("animationcancel",R),t.addEventListener("animationend",R),()=>{A.clearTimeout(C),t.removeEventListener("animationstart",z),t.removeEventListener("animationcancel",R),t.removeEventListener("animationend",R)}}else b("ANIMATION_END")},[t,b]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:Y.useCallback(C=>{r.current=C?getComputedStyle(C):null,n(C)},[])}}function Xw(e){return(e==null?void 0:e.animationName)||"none"}function Rq(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var jT=0;function wE(){Y.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??zO()),document.body.insertAdjacentElement("beforeend",e[1]??zO()),jT++,()=>{jT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),jT--}},[])}function zO(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var bp=function(){return bp=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(t[u]=n[u])}return t},bp.apply(this,arguments)};function f3(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function Lq(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,u;r<a;r++)(u||!(r in t))&&(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return e.concat(u||Array.prototype.slice.call(t))}var yS="right-scroll-bar-position",vS="width-before-scroll-bar",Oq="with-scroll-bars-hidden",Dq="--removed-body-scroll-bar-size";function VT(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Nq(e,t){var n=Y.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var a=n.value;a!==r&&(n.value=r,n.callback(r,a))}}}})[0];return n.callback=t,n.facade}var kq=typeof window<"u"?Y.useLayoutEffect:Y.useEffect,BO=new WeakMap;function Fq(e,t){var n=Nq(null,function(r){return e.forEach(function(a){return VT(a,r)})});return kq(function(){var r=BO.get(n);if(r){var a=new Set(r),u=new Set(e),p=n.current;a.forEach(function(i){u.has(i)||VT(i,null)}),u.forEach(function(i){a.has(i)||VT(i,p)})}BO.set(n,e)},[e]),n}function zq(e){return e}function Bq(e,t){t===void 0&&(t=zq);var n=[],r=!1,a={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(u){var p=t(u,r);return n.push(p),function(){n=n.filter(function(i){return i!==p})}},assignSyncMedium:function(u){for(r=!0;n.length;){var p=n;n=[],p.forEach(u)}n={push:function(i){return u(i)},filter:function(){return n}}},assignMedium:function(u){r=!0;var p=[];if(n.length){var i=n;n=[],i.forEach(u),p=n}var b=function(){var A=p;p=[],A.forEach(u)},C=function(){return Promise.resolve().then(b)};C(),n={push:function(A){p.push(A),C()},filter:function(A){return p=p.filter(A),n}}}};return a}function jq(e){e===void 0&&(e={});var t=Bq(null);return t.options=bp({async:!0,ssr:!1},e),t}var p3=function(e){var t=e.sideCar,n=f3(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return Y.createElement(r,bp({},n))};p3.isSideCarExport=!0;function Vq(e,t){return e.useMedium(t),p3}var m3=jq(),UT=function(){},SE=Y.forwardRef(function(e,t){var n=Y.useRef(null),r=Y.useState({onScrollCapture:UT,onWheelCapture:UT,onTouchMoveCapture:UT}),a=r[0],u=r[1],p=e.forwardProps,i=e.children,b=e.className,C=e.removeScrollBar,A=e.enabled,R=e.shards,z=e.sideCar,V=e.noIsolation,W=e.inert,X=e.allowPinchZoom,ue=e.as,ie=ue===void 0?"div":ue,K=e.gapMode,ee=f3(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ae=z,he=Fq([n,t]),xe=bp(bp({},ee),a);return Y.createElement(Y.Fragment,null,A&&Y.createElement(ae,{sideCar:m3,removeScrollBar:C,shards:R,noIsolation:V,inert:W,setCallbacks:u,allowPinchZoom:!!X,lockRef:n,gapMode:K}),p?Y.cloneElement(Y.Children.only(i),bp(bp({},xe),{ref:he})):Y.createElement(ie,bp({},xe,{className:b,ref:he}),i))});SE.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};SE.classNames={fullWidth:vS,zeroRight:yS};var Uq=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Gq(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Uq();return t&&e.setAttribute("nonce",t),e}function $q(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function qq(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Hq=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Gq())&&($q(t,n),qq(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Wq=function(){var e=Hq();return function(t,n){Y.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},g3=function(){var e=Wq(),t=function(n){var r=n.styles,a=n.dynamic;return e(r,a),null};return t},Xq={left:0,top:0,right:0,gap:0},GT=function(e){return parseInt(e||"",10)||0},Zq=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[GT(n),GT(r),GT(a)]},Yq=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Xq;var t=Zq(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},Kq=g3(),y0="data-scroll-locked",Jq=function(e,t,n,r){var a=e.left,u=e.top,p=e.right,i=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(Oq,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(i,"px ").concat(r,`;
  }
  body[`).concat(y0,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(i,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(yS,` {
    right: `).concat(i,"px ").concat(r,`;
  }
  
  .`).concat(vS,` {
    margin-right: `).concat(i,"px ").concat(r,`;
  }
  
  .`).concat(yS," .").concat(yS,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(vS," .").concat(vS,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(y0,`] {
    `).concat(Dq,": ").concat(i,`px;
  }
`)},jO=function(){var e=parseInt(document.body.getAttribute(y0)||"0",10);return isFinite(e)?e:0},Qq=function(){Y.useEffect(function(){return document.body.setAttribute(y0,(jO()+1).toString()),function(){var e=jO()-1;e<=0?document.body.removeAttribute(y0):document.body.setAttribute(y0,e.toString())}},[])},eH=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=r===void 0?"margin":r;Qq();var u=Y.useMemo(function(){return Yq(a)},[a]);return Y.createElement(Kq,{styles:Jq(u,!t,a,n?"":"!important")})},NI=!1;if(typeof window<"u")try{var Zw=Object.defineProperty({},"passive",{get:function(){return NI=!0,!0}});window.addEventListener("test",Zw,Zw),window.removeEventListener("test",Zw,Zw)}catch{NI=!1}var l0=NI?{passive:!1}:!1,tH=function(e){return e.tagName==="TEXTAREA"},_3=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!tH(e)&&n[t]==="visible")},nH=function(e){return _3(e,"overflowY")},rH=function(e){return _3(e,"overflowX")},VO=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var a=y3(e,r);if(a){var u=v3(e,r),p=u[1],i=u[2];if(p>i)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},iH=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},oH=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},y3=function(e,t){return e==="v"?nH(t):rH(t)},v3=function(e,t){return e==="v"?iH(t):oH(t)},sH=function(e,t){return e==="h"&&t==="rtl"?-1:1},aH=function(e,t,n,r,a){var u=sH(e,window.getComputedStyle(t).direction),p=u*r,i=n.target,b=t.contains(i),C=!1,A=p>0,R=0,z=0;do{var V=v3(e,i),W=V[0],X=V[1],ue=V[2],ie=X-ue-u*W;(W||ie)&&y3(e,i)&&(R+=ie,z+=W),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!b&&i!==document.body||b&&(t.contains(i)||t===i));return(A&&Math.abs(R)<1||!A&&Math.abs(z)<1)&&(C=!0),C},Yw=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},UO=function(e){return[e.deltaX,e.deltaY]},GO=function(e){return e&&"current"in e?e.current:e},lH=function(e,t){return e[0]===t[0]&&e[1]===t[1]},uH=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},cH=0,u0=[];function hH(e){var t=Y.useRef([]),n=Y.useRef([0,0]),r=Y.useRef(),a=Y.useState(cH++)[0],u=Y.useState(g3)[0],p=Y.useRef(e);Y.useEffect(function(){p.current=e},[e]),Y.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var X=Lq([e.lockRef.current],(e.shards||[]).map(GO),!0).filter(Boolean);return X.forEach(function(ue){return ue.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),X.forEach(function(ue){return ue.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var i=Y.useCallback(function(X,ue){if("touches"in X&&X.touches.length===2||X.type==="wheel"&&X.ctrlKey)return!p.current.allowPinchZoom;var ie=Yw(X),K=n.current,ee="deltaX"in X?X.deltaX:K[0]-ie[0],ae="deltaY"in X?X.deltaY:K[1]-ie[1],he,xe=X.target,ye=Math.abs(ee)>Math.abs(ae)?"h":"v";if("touches"in X&&ye==="h"&&xe.type==="range")return!1;var Se=VO(ye,xe);if(!Se)return!0;if(Se?he=ye:(he=ye==="v"?"h":"v",Se=VO(ye,xe)),!Se)return!1;if(!r.current&&"changedTouches"in X&&(ee||ae)&&(r.current=he),!he)return!0;var je=r.current||he;return aH(je,ue,X,je==="h"?ee:ae)},[]),b=Y.useCallback(function(X){var ue=X;if(!(!u0.length||u0[u0.length-1]!==u)){var ie="deltaY"in ue?UO(ue):Yw(ue),K=t.current.filter(function(he){return he.name===ue.type&&(he.target===ue.target||ue.target===he.shadowParent)&&lH(he.delta,ie)})[0];if(K&&K.should){ue.cancelable&&ue.preventDefault();return}if(!K){var ee=(p.current.shards||[]).map(GO).filter(Boolean).filter(function(he){return he.contains(ue.target)}),ae=ee.length>0?i(ue,ee[0]):!p.current.noIsolation;ae&&ue.cancelable&&ue.preventDefault()}}},[]),C=Y.useCallback(function(X,ue,ie,K){var ee={name:X,delta:ue,target:ie,should:K,shadowParent:dH(ie)};t.current.push(ee),setTimeout(function(){t.current=t.current.filter(function(ae){return ae!==ee})},1)},[]),A=Y.useCallback(function(X){n.current=Yw(X),r.current=void 0},[]),R=Y.useCallback(function(X){C(X.type,UO(X),X.target,i(X,e.lockRef.current))},[]),z=Y.useCallback(function(X){C(X.type,Yw(X),X.target,i(X,e.lockRef.current))},[]);Y.useEffect(function(){return u0.push(u),e.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:z}),document.addEventListener("wheel",b,l0),document.addEventListener("touchmove",b,l0),document.addEventListener("touchstart",A,l0),function(){u0=u0.filter(function(X){return X!==u}),document.removeEventListener("wheel",b,l0),document.removeEventListener("touchmove",b,l0),document.removeEventListener("touchstart",A,l0)}},[]);var V=e.removeScrollBar,W=e.inert;return Y.createElement(Y.Fragment,null,W?Y.createElement(u,{styles:uH(a)}):null,V?Y.createElement(eH,{gapMode:e.gapMode}):null)}function dH(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const fH=Vq(m3,hH);var yb=Y.forwardRef(function(e,t){return Y.createElement(SE,bp({},e,{ref:t,sideCar:fH}))});yb.classNames=SE.classNames;var pH=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},c0=new WeakMap,Kw=new WeakMap,Jw={},$T=0,x3=function(e){return e&&(e.host||x3(e.parentNode))},mH=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=x3(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},gH=function(e,t,n,r){var a=mH(t,Array.isArray(e)?e:[e]);Jw[n]||(Jw[n]=new WeakMap);var u=Jw[n],p=[],i=new Set,b=new Set(a),C=function(R){!R||i.has(R)||(i.add(R),C(R.parentNode))};a.forEach(C);var A=function(R){!R||b.has(R)||Array.prototype.forEach.call(R.children,function(z){if(i.has(z))A(z);else try{var V=z.getAttribute(r),W=V!==null&&V!=="false",X=(c0.get(z)||0)+1,ue=(u.get(z)||0)+1;c0.set(z,X),u.set(z,ue),p.push(z),X===1&&W&&Kw.set(z,!0),ue===1&&z.setAttribute(n,"true"),W||z.setAttribute(r,"true")}catch(ie){console.error("aria-hidden: cannot operate on ",z,ie)}})};return A(t),i.clear(),$T++,function(){p.forEach(function(R){var z=c0.get(R)-1,V=u.get(R)-1;c0.set(R,z),u.set(R,V),z||(Kw.has(R)||R.removeAttribute(r),Kw.delete(R)),V||R.removeAttribute(n)}),$T--,$T||(c0=new WeakMap,c0=new WeakMap,Kw=new WeakMap,Jw={})}},EE=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=pH(e);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live]"))),gH(r,a,n,"aria-hidden")):function(){return null}};function _H(e){const t=yH(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(xH);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function yH(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=wH(a),i=bH(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var vH=Symbol("radix.slottable");function xH(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===vH}function bH(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function wH(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var CE="Dialog",[b3,w3]=Zl(CE),[SH,xf]=b3(CE),S3=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:a,onOpenChange:u,modal:p=!0}=e,i=Y.useRef(null),b=Y.useRef(null),[C,A]=Hc({prop:r,defaultProp:a??!1,onChange:u,caller:CE});return G.jsx(SH,{scope:t,triggerRef:i,contentRef:b,contentId:Ns(),titleId:Ns(),descriptionId:Ns(),open:C,onOpenChange:A,onOpenToggle:Y.useCallback(()=>A(R=>!R),[A]),modal:p,children:n})};S3.displayName=CE;var E3="DialogTrigger",C3=Y.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=xf(E3,n),u=Xr(t,a.triggerRef);return G.jsx(Ir.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":eM(a.open),...r,ref:u,onClick:Dn(e.onClick,a.onOpenToggle)})});C3.displayName=E3;var J2="DialogPortal",[EH,T3]=b3(J2,{forceMount:void 0}),I3=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:a}=e,u=xf(J2,t);return G.jsx(EH,{scope:t,forceMount:n,children:Y.Children.map(r,p=>G.jsx(pc,{present:n||u.open,children:G.jsx(_b,{asChild:!0,container:a,children:p})}))})};I3.displayName=J2;var NS="DialogOverlay",M3=Y.forwardRef((e,t)=>{const n=T3(NS,e.__scopeDialog),{forceMount:r=n.forceMount,...a}=e,u=xf(NS,e.__scopeDialog);return u.modal?G.jsx(pc,{present:r||u.open,children:G.jsx(TH,{...a,ref:t})}):null});M3.displayName=NS;var CH=_H("DialogOverlay.RemoveScroll"),TH=Y.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=xf(NS,n);return G.jsx(yb,{as:CH,allowPinchZoom:!0,shards:[a.contentRef],children:G.jsx(Ir.div,{"data-state":eM(a.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),Vy="DialogContent",P3=Y.forwardRef((e,t)=>{const n=T3(Vy,e.__scopeDialog),{forceMount:r=n.forceMount,...a}=e,u=xf(Vy,e.__scopeDialog);return G.jsx(pc,{present:r||u.open,children:u.modal?G.jsx(IH,{...a,ref:t}):G.jsx(MH,{...a,ref:t})})});P3.displayName=Vy;var IH=Y.forwardRef((e,t)=>{const n=xf(Vy,e.__scopeDialog),r=Y.useRef(null),a=Xr(t,n.contentRef,r);return Y.useEffect(()=>{const u=r.current;if(u)return EE(u)},[]),G.jsx(A3,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Dn(e.onCloseAutoFocus,u=>{var p;u.preventDefault(),(p=n.triggerRef.current)==null||p.focus()}),onPointerDownOutside:Dn(e.onPointerDownOutside,u=>{const p=u.detail.originalEvent,i=p.button===0&&p.ctrlKey===!0;(p.button===2||i)&&u.preventDefault()}),onFocusOutside:Dn(e.onFocusOutside,u=>u.preventDefault())})}),MH=Y.forwardRef((e,t)=>{const n=xf(Vy,e.__scopeDialog),r=Y.useRef(!1),a=Y.useRef(!1);return G.jsx(A3,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:u=>{var p,i;(p=e.onCloseAutoFocus)==null||p.call(e,u),u.defaultPrevented||(r.current||(i=n.triggerRef.current)==null||i.focus(),u.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:u=>{var b,C;(b=e.onInteractOutside)==null||b.call(e,u),u.defaultPrevented||(r.current=!0,u.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const p=u.target;((C=n.triggerRef.current)==null?void 0:C.contains(p))&&u.preventDefault(),u.detail.originalEvent.type==="focusin"&&a.current&&u.preventDefault()}})}),A3=Y.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:u,...p}=e,i=xf(Vy,n),b=Y.useRef(null),C=Xr(t,b);return wE(),G.jsxs(G.Fragment,{children:[G.jsx(gb,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:u,children:G.jsx(mb,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":eM(i.open),...p,ref:C,onDismiss:()=>i.onOpenChange(!1)})}),G.jsxs(G.Fragment,{children:[G.jsx(AH,{titleId:i.titleId}),G.jsx(LH,{contentRef:b,descriptionId:i.descriptionId})]})]})}),Q2="DialogTitle",R3=Y.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=xf(Q2,n);return G.jsx(Ir.h2,{id:a.titleId,...r,ref:t})});R3.displayName=Q2;var L3="DialogDescription",O3=Y.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=xf(L3,n);return G.jsx(Ir.p,{id:a.descriptionId,...r,ref:t})});O3.displayName=L3;var D3="DialogClose",N3=Y.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=xf(D3,n);return G.jsx(Ir.button,{type:"button",...r,ref:t,onClick:Dn(e.onClick,()=>a.onOpenChange(!1))})});N3.displayName=D3;function eM(e){return e?"open":"closed"}var k3="DialogTitleWarning",[PH,F3]=eq(k3,{contentName:Vy,titleName:Q2,docsSlug:"dialog"}),AH=({titleId:e})=>{const t=F3(k3),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Y.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},RH="DialogDescriptionWarning",LH=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${F3(RH).contentName}}.`;return Y.useEffect(()=>{var u;const a=(u=e.current)==null?void 0:u.getAttribute("aria-describedby");t&&a&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},tM=S3,OH=C3,TE=I3,sx=M3,ax=P3,vb=R3,xb=O3,IE=N3;const DH=tM,NH=TE,z3=Y.forwardRef(({className:e,...t},n)=>G.jsx(sx,{className:dn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));z3.displayName=sx.displayName;const kH=bE("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),B3=Y.forwardRef(({side:e="right",className:t,children:n,...r},a)=>G.jsxs(NH,{children:[G.jsx(z3,{}),G.jsxs(ax,{ref:a,className:dn(kH({side:e}),t),...r,children:[G.jsxs(IE,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[G.jsx(fb,{className:"h-4 w-4"}),G.jsx("span",{className:"sr-only",children:"Close"})]}),n]})]}));B3.displayName=ax.displayName;const FH=Y.forwardRef(({className:e,...t},n)=>G.jsx(vb,{ref:n,className:dn("text-lg font-semibold text-foreground",e),...t}));FH.displayName=vb.displayName;const zH=Y.forwardRef(({className:e,...t},n)=>G.jsx(xb,{ref:n,className:dn("text-sm text-muted-foreground",e),...t}));zH.displayName=xb.displayName;function $O({className:e,...t}){return G.jsx("div",{className:dn("animate-pulse rounded-md bg-primary/10",e),...t})}function BH(e){const t=jH(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(UH);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function jH(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n,p=Y.isValidElement(a)?$H(a):void 0,i=Xr(p,r);if(Y.isValidElement(a)){const b=GH(u,a.props);return a.type!==Y.Fragment&&(b.ref=i),Y.cloneElement(a,b)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var j3=Symbol("radix.slottable");function VH(e){const t=({children:n})=>G.jsx(G.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=j3,t}function UH(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===j3}function GH(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{const b=u(...i);return a(...i),b}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function $H(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var qH=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],j_=qH.reduce((e,t)=>{const n=BH(`Primitive.${t}`),r=Y.forwardRef((a,u)=>{const{asChild:p,...i}=a,b=p?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(b,{...i,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function HH(e,t){e&&Jd.flushSync(()=>e.dispatchEvent(t))}var WH="DismissableLayer",kI="dismissableLayer.update",XH="dismissableLayer.pointerDownOutside",ZH="dismissableLayer.focusOutside",qO,V3=Y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),U3=Y.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:u,onInteractOutside:p,onDismiss:i,...b}=e,C=Y.useContext(V3),[A,R]=Y.useState(null),z=(A==null?void 0:A.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,V]=Y.useState({}),W=Xr(t,ye=>R(ye)),X=Array.from(C.layers),[ue]=[...C.layersWithOutsidePointerEventsDisabled].slice(-1),ie=X.indexOf(ue),K=A?X.indexOf(A):-1,ee=C.layersWithOutsidePointerEventsDisabled.size>0,ae=K>=ie,he=JH(ye=>{const Se=ye.target,je=[...C.branches].some(Re=>Re.contains(Se));!ae||je||(a==null||a(ye),p==null||p(ye),ye.defaultPrevented||i==null||i())},z),xe=QH(ye=>{const Se=ye.target;[...C.branches].some(Re=>Re.contains(Se))||(u==null||u(ye),p==null||p(ye),ye.defaultPrevented||i==null||i())},z);return a3(ye=>{K===C.layers.size-1&&(r==null||r(ye),!ye.defaultPrevented&&i&&(ye.preventDefault(),i()))},z),Y.useEffect(()=>{if(A)return n&&(C.layersWithOutsidePointerEventsDisabled.size===0&&(qO=z.body.style.pointerEvents,z.body.style.pointerEvents="none"),C.layersWithOutsidePointerEventsDisabled.add(A)),C.layers.add(A),HO(),()=>{n&&C.layersWithOutsidePointerEventsDisabled.size===1&&(z.body.style.pointerEvents=qO)}},[A,z,n,C]),Y.useEffect(()=>()=>{A&&(C.layers.delete(A),C.layersWithOutsidePointerEventsDisabled.delete(A),HO())},[A,C]),Y.useEffect(()=>{const ye=()=>V({});return document.addEventListener(kI,ye),()=>document.removeEventListener(kI,ye)},[]),G.jsx(j_.div,{...b,ref:W,style:{pointerEvents:ee?ae?"auto":"none":void 0,...e.style},onFocusCapture:Dn(e.onFocusCapture,xe.onFocusCapture),onBlurCapture:Dn(e.onBlurCapture,xe.onBlurCapture),onPointerDownCapture:Dn(e.onPointerDownCapture,he.onPointerDownCapture)})});U3.displayName=WH;var YH="DismissableLayerBranch",KH=Y.forwardRef((e,t)=>{const n=Y.useContext(V3),r=Y.useRef(null),a=Xr(t,r);return Y.useEffect(()=>{const u=r.current;if(u)return n.branches.add(u),()=>{n.branches.delete(u)}},[n.branches]),G.jsx(j_.div,{...e,ref:a})});KH.displayName=YH;function JH(e,t=globalThis==null?void 0:globalThis.document){const n=fd(e),r=Y.useRef(!1),a=Y.useRef(()=>{});return Y.useEffect(()=>{const u=i=>{if(i.target&&!r.current){let b=function(){G3(XH,n,C,{discrete:!0})};const C={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=b,t.addEventListener("click",a.current,{once:!0})):b()}else t.removeEventListener("click",a.current);r.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",u),t.removeEventListener("click",a.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function QH(e,t=globalThis==null?void 0:globalThis.document){const n=fd(e),r=Y.useRef(!1);return Y.useEffect(()=>{const a=u=>{u.target&&!r.current&&G3(ZH,n,{originalEvent:u},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function HO(){const e=new CustomEvent(kI);document.dispatchEvent(e)}function G3(e,t,n,{discrete:r}){const a=n.originalEvent.target,u=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?HH(a,u):a.dispatchEvent(u)}const e7=["top","right","bottom","left"],w_=Math.min,jc=Math.max,kS=Math.round,Qw=Math.floor,Tp=e=>({x:e,y:e}),t7={left:"right",right:"left",bottom:"top",top:"bottom"},n7={start:"end",end:"start"};function FI(e,t,n){return jc(e,w_(t,n))}function Km(e,t){return typeof e=="function"?e(t):e}function Jm(e){return e.split("-")[0]}function lx(e){return e.split("-")[1]}function nM(e){return e==="x"?"y":"x"}function rM(e){return e==="y"?"height":"width"}function S_(e){return["top","bottom"].includes(Jm(e))?"y":"x"}function iM(e){return nM(S_(e))}function r7(e,t,n){n===void 0&&(n=!1);const r=lx(e),a=iM(e),u=rM(a);let p=a==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[u]>t.floating[u]&&(p=FS(p)),[p,FS(p)]}function i7(e){const t=FS(e);return[zI(e),t,zI(t)]}function zI(e){return e.replace(/start|end/g,t=>n7[t])}function o7(e,t,n){const r=["left","right"],a=["right","left"],u=["top","bottom"],p=["bottom","top"];switch(e){case"top":case"bottom":return n?t?a:r:t?r:a;case"left":case"right":return t?u:p;default:return[]}}function s7(e,t,n,r){const a=lx(e);let u=o7(Jm(e),n==="start",r);return a&&(u=u.map(p=>p+"-"+a),t&&(u=u.concat(u.map(zI)))),u}function FS(e){return e.replace(/left|right|bottom|top/g,t=>t7[t])}function a7(e){return{top:0,right:0,bottom:0,left:0,...e}}function $3(e){return typeof e!="number"?a7(e):{top:e,right:e,bottom:e,left:e}}function zS(e){const{x:t,y:n,width:r,height:a}=e;return{width:r,height:a,top:n,left:t,right:t+r,bottom:n+a,x:t,y:n}}function WO(e,t,n){let{reference:r,floating:a}=e;const u=S_(t),p=iM(t),i=rM(p),b=Jm(t),C=u==="y",A=r.x+r.width/2-a.width/2,R=r.y+r.height/2-a.height/2,z=r[i]/2-a[i]/2;let V;switch(b){case"top":V={x:A,y:r.y-a.height};break;case"bottom":V={x:A,y:r.y+r.height};break;case"right":V={x:r.x+r.width,y:R};break;case"left":V={x:r.x-a.width,y:R};break;default:V={x:r.x,y:r.y}}switch(lx(t)){case"start":V[p]-=z*(n&&C?-1:1);break;case"end":V[p]+=z*(n&&C?-1:1);break}return V}const l7=async(e,t,n)=>{const{placement:r="bottom",strategy:a="absolute",middleware:u=[],platform:p}=n,i=u.filter(Boolean),b=await(p.isRTL==null?void 0:p.isRTL(t));let C=await p.getElementRects({reference:e,floating:t,strategy:a}),{x:A,y:R}=WO(C,r,b),z=r,V={},W=0;for(let X=0;X<i.length;X++){const{name:ue,fn:ie}=i[X],{x:K,y:ee,data:ae,reset:he}=await ie({x:A,y:R,initialPlacement:r,placement:z,strategy:a,middlewareData:V,rects:C,platform:p,elements:{reference:e,floating:t}});A=K??A,R=ee??R,V={...V,[ue]:{...V[ue],...ae}},he&&W<=50&&(W++,typeof he=="object"&&(he.placement&&(z=he.placement),he.rects&&(C=he.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:a}):he.rects),{x:A,y:R}=WO(C,z,b)),X=-1)}return{x:A,y:R,placement:z,strategy:a,middlewareData:V}};async function V1(e,t){var n;t===void 0&&(t={});const{x:r,y:a,platform:u,rects:p,elements:i,strategy:b}=e,{boundary:C="clippingAncestors",rootBoundary:A="viewport",elementContext:R="floating",altBoundary:z=!1,padding:V=0}=Km(t,e),W=$3(V),ue=i[z?R==="floating"?"reference":"floating":R],ie=zS(await u.getClippingRect({element:(n=await(u.isElement==null?void 0:u.isElement(ue)))==null||n?ue:ue.contextElement||await(u.getDocumentElement==null?void 0:u.getDocumentElement(i.floating)),boundary:C,rootBoundary:A,strategy:b})),K=R==="floating"?{x:r,y:a,width:p.floating.width,height:p.floating.height}:p.reference,ee=await(u.getOffsetParent==null?void 0:u.getOffsetParent(i.floating)),ae=await(u.isElement==null?void 0:u.isElement(ee))?await(u.getScale==null?void 0:u.getScale(ee))||{x:1,y:1}:{x:1,y:1},he=zS(u.convertOffsetParentRelativeRectToViewportRelativeRect?await u.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:K,offsetParent:ee,strategy:b}):K);return{top:(ie.top-he.top+W.top)/ae.y,bottom:(he.bottom-ie.bottom+W.bottom)/ae.y,left:(ie.left-he.left+W.left)/ae.x,right:(he.right-ie.right+W.right)/ae.x}}const u7=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:a,rects:u,platform:p,elements:i,middlewareData:b}=t,{element:C,padding:A=0}=Km(e,t)||{};if(C==null)return{};const R=$3(A),z={x:n,y:r},V=iM(a),W=rM(V),X=await p.getDimensions(C),ue=V==="y",ie=ue?"top":"left",K=ue?"bottom":"right",ee=ue?"clientHeight":"clientWidth",ae=u.reference[W]+u.reference[V]-z[V]-u.floating[W],he=z[V]-u.reference[V],xe=await(p.getOffsetParent==null?void 0:p.getOffsetParent(C));let ye=xe?xe[ee]:0;(!ye||!await(p.isElement==null?void 0:p.isElement(xe)))&&(ye=i.floating[ee]||u.floating[W]);const Se=ae/2-he/2,je=ye/2-X[W]/2-1,Re=w_(R[ie],je),De=w_(R[K],je),at=Re,ot=ye-X[W]-De,Fe=ye/2-X[W]/2+Se,Ze=FI(at,Fe,ot),Ve=!b.arrow&&lx(a)!=null&&Fe!==Ze&&u.reference[W]/2-(Fe<at?Re:De)-X[W]/2<0,mt=Ve?Fe<at?Fe-at:Fe-ot:0;return{[V]:z[V]+mt,data:{[V]:Ze,centerOffset:Fe-Ze-mt,...Ve&&{alignmentOffset:mt}},reset:Ve}}}),c7=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:a,middlewareData:u,rects:p,initialPlacement:i,platform:b,elements:C}=t,{mainAxis:A=!0,crossAxis:R=!0,fallbackPlacements:z,fallbackStrategy:V="bestFit",fallbackAxisSideDirection:W="none",flipAlignment:X=!0,...ue}=Km(e,t);if((n=u.arrow)!=null&&n.alignmentOffset)return{};const ie=Jm(a),K=S_(i),ee=Jm(i)===i,ae=await(b.isRTL==null?void 0:b.isRTL(C.floating)),he=z||(ee||!X?[FS(i)]:i7(i)),xe=W!=="none";!z&&xe&&he.push(...s7(i,X,W,ae));const ye=[i,...he],Se=await V1(t,ue),je=[];let Re=((r=u.flip)==null?void 0:r.overflows)||[];if(A&&je.push(Se[ie]),R){const Fe=r7(a,p,ae);je.push(Se[Fe[0]],Se[Fe[1]])}if(Re=[...Re,{placement:a,overflows:je}],!je.every(Fe=>Fe<=0)){var De,at;const Fe=(((De=u.flip)==null?void 0:De.index)||0)+1,Ze=ye[Fe];if(Ze)return{data:{index:Fe,overflows:Re},reset:{placement:Ze}};let Ve=(at=Re.filter(mt=>mt.overflows[0]<=0).sort((mt,We)=>mt.overflows[1]-We.overflows[1])[0])==null?void 0:at.placement;if(!Ve)switch(V){case"bestFit":{var ot;const mt=(ot=Re.filter(We=>{if(xe){const tt=S_(We.placement);return tt===K||tt==="y"}return!0}).map(We=>[We.placement,We.overflows.filter(tt=>tt>0).reduce((tt,Dt)=>tt+Dt,0)]).sort((We,tt)=>We[1]-tt[1])[0])==null?void 0:ot[0];mt&&(Ve=mt);break}case"initialPlacement":Ve=i;break}if(a!==Ve)return{reset:{placement:Ve}}}return{}}}};function XO(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function ZO(e){return e7.some(t=>e[t]>=0)}const h7=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...a}=Km(e,t);switch(r){case"referenceHidden":{const u=await V1(t,{...a,elementContext:"reference"}),p=XO(u,n.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:ZO(p)}}}case"escaped":{const u=await V1(t,{...a,altBoundary:!0}),p=XO(u,n.floating);return{data:{escapedOffsets:p,escaped:ZO(p)}}}default:return{}}}}};async function d7(e,t){const{placement:n,platform:r,elements:a}=e,u=await(r.isRTL==null?void 0:r.isRTL(a.floating)),p=Jm(n),i=lx(n),b=S_(n)==="y",C=["left","top"].includes(p)?-1:1,A=u&&b?-1:1,R=Km(t,e);let{mainAxis:z,crossAxis:V,alignmentAxis:W}=typeof R=="number"?{mainAxis:R,crossAxis:0,alignmentAxis:null}:{mainAxis:R.mainAxis||0,crossAxis:R.crossAxis||0,alignmentAxis:R.alignmentAxis};return i&&typeof W=="number"&&(V=i==="end"?W*-1:W),b?{x:V*A,y:z*C}:{x:z*C,y:V*A}}const f7=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:a,y:u,placement:p,middlewareData:i}=t,b=await d7(t,e);return p===((n=i.offset)==null?void 0:n.placement)&&(r=i.arrow)!=null&&r.alignmentOffset?{}:{x:a+b.x,y:u+b.y,data:{...b,placement:p}}}}},p7=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:a}=t,{mainAxis:u=!0,crossAxis:p=!1,limiter:i={fn:ue=>{let{x:ie,y:K}=ue;return{x:ie,y:K}}},...b}=Km(e,t),C={x:n,y:r},A=await V1(t,b),R=S_(Jm(a)),z=nM(R);let V=C[z],W=C[R];if(u){const ue=z==="y"?"top":"left",ie=z==="y"?"bottom":"right",K=V+A[ue],ee=V-A[ie];V=FI(K,V,ee)}if(p){const ue=R==="y"?"top":"left",ie=R==="y"?"bottom":"right",K=W+A[ue],ee=W-A[ie];W=FI(K,W,ee)}const X=i.fn({...t,[z]:V,[R]:W});return{...X,data:{x:X.x-n,y:X.y-r,enabled:{[z]:u,[R]:p}}}}}},m7=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:a,rects:u,middlewareData:p}=t,{offset:i=0,mainAxis:b=!0,crossAxis:C=!0}=Km(e,t),A={x:n,y:r},R=S_(a),z=nM(R);let V=A[z],W=A[R];const X=Km(i,t),ue=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(b){const ee=z==="y"?"height":"width",ae=u.reference[z]-u.floating[ee]+ue.mainAxis,he=u.reference[z]+u.reference[ee]-ue.mainAxis;V<ae?V=ae:V>he&&(V=he)}if(C){var ie,K;const ee=z==="y"?"width":"height",ae=["top","left"].includes(Jm(a)),he=u.reference[R]-u.floating[ee]+(ae&&((ie=p.offset)==null?void 0:ie[R])||0)+(ae?0:ue.crossAxis),xe=u.reference[R]+u.reference[ee]+(ae?0:((K=p.offset)==null?void 0:K[R])||0)-(ae?ue.crossAxis:0);W<he?W=he:W>xe&&(W=xe)}return{[z]:V,[R]:W}}}},g7=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:a,rects:u,platform:p,elements:i}=t,{apply:b=()=>{},...C}=Km(e,t),A=await V1(t,C),R=Jm(a),z=lx(a),V=S_(a)==="y",{width:W,height:X}=u.floating;let ue,ie;R==="top"||R==="bottom"?(ue=R,ie=z===(await(p.isRTL==null?void 0:p.isRTL(i.floating))?"start":"end")?"left":"right"):(ie=R,ue=z==="end"?"top":"bottom");const K=X-A.top-A.bottom,ee=W-A.left-A.right,ae=w_(X-A[ue],K),he=w_(W-A[ie],ee),xe=!t.middlewareData.shift;let ye=ae,Se=he;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(Se=ee),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(ye=K),xe&&!z){const Re=jc(A.left,0),De=jc(A.right,0),at=jc(A.top,0),ot=jc(A.bottom,0);V?Se=W-2*(Re!==0||De!==0?Re+De:jc(A.left,A.right)):ye=X-2*(at!==0||ot!==0?at+ot:jc(A.top,A.bottom))}await b({...t,availableWidth:Se,availableHeight:ye});const je=await p.getDimensions(i.floating);return W!==je.width||X!==je.height?{reset:{rects:!0}}:{}}}};function ME(){return typeof window<"u"}function ux(e){return q3(e)?(e.nodeName||"").toLowerCase():"#document"}function Uc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Bp(e){var t;return(t=(q3(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function q3(e){return ME()?e instanceof Node||e instanceof Uc(e).Node:!1}function rf(e){return ME()?e instanceof Element||e instanceof Uc(e).Element:!1}function Rp(e){return ME()?e instanceof HTMLElement||e instanceof Uc(e).HTMLElement:!1}function YO(e){return!ME()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Uc(e).ShadowRoot}function bb(e){const{overflow:t,overflowX:n,overflowY:r,display:a}=of(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(a)}function _7(e){return["table","td","th"].includes(ux(e))}function PE(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function oM(e){const t=sM(),n=rf(e)?of(e):e;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function y7(e){let t=E_(e);for(;Rp(t)&&!C0(t);){if(oM(t))return t;if(PE(t))return null;t=E_(t)}return null}function sM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function C0(e){return["html","body","#document"].includes(ux(e))}function of(e){return Uc(e).getComputedStyle(e)}function AE(e){return rf(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function E_(e){if(ux(e)==="html")return e;const t=e.assignedSlot||e.parentNode||YO(e)&&e.host||Bp(e);return YO(t)?t.host:t}function H3(e){const t=E_(e);return C0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Rp(t)&&bb(t)?t:H3(t)}function U1(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const a=H3(e),u=a===((r=e.ownerDocument)==null?void 0:r.body),p=Uc(a);if(u){const i=BI(p);return t.concat(p,p.visualViewport||[],bb(a)?a:[],i&&n?U1(i):[])}return t.concat(a,U1(a,[],n))}function BI(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function W3(e){const t=of(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const a=Rp(e),u=a?e.offsetWidth:n,p=a?e.offsetHeight:r,i=kS(n)!==u||kS(r)!==p;return i&&(n=u,r=p),{width:n,height:r,$:i}}function aM(e){return rf(e)?e:e.contextElement}function v0(e){const t=aM(e);if(!Rp(t))return Tp(1);const n=t.getBoundingClientRect(),{width:r,height:a,$:u}=W3(t);let p=(u?kS(n.width):n.width)/r,i=(u?kS(n.height):n.height)/a;return(!p||!Number.isFinite(p))&&(p=1),(!i||!Number.isFinite(i))&&(i=1),{x:p,y:i}}const v7=Tp(0);function X3(e){const t=Uc(e);return!sM()||!t.visualViewport?v7:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function x7(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Uc(e)?!1:t}function Uy(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const a=e.getBoundingClientRect(),u=aM(e);let p=Tp(1);t&&(r?rf(r)&&(p=v0(r)):p=v0(e));const i=x7(u,n,r)?X3(u):Tp(0);let b=(a.left+i.x)/p.x,C=(a.top+i.y)/p.y,A=a.width/p.x,R=a.height/p.y;if(u){const z=Uc(u),V=r&&rf(r)?Uc(r):r;let W=z,X=BI(W);for(;X&&r&&V!==W;){const ue=v0(X),ie=X.getBoundingClientRect(),K=of(X),ee=ie.left+(X.clientLeft+parseFloat(K.paddingLeft))*ue.x,ae=ie.top+(X.clientTop+parseFloat(K.paddingTop))*ue.y;b*=ue.x,C*=ue.y,A*=ue.x,R*=ue.y,b+=ee,C+=ae,W=Uc(X),X=BI(W)}}return zS({width:A,height:R,x:b,y:C})}function lM(e,t){const n=AE(e).scrollLeft;return t?t.left+n:Uy(Bp(e)).left+n}function Z3(e,t,n){n===void 0&&(n=!1);const r=e.getBoundingClientRect(),a=r.left+t.scrollLeft-(n?0:lM(e,r)),u=r.top+t.scrollTop;return{x:a,y:u}}function b7(e){let{elements:t,rect:n,offsetParent:r,strategy:a}=e;const u=a==="fixed",p=Bp(r),i=t?PE(t.floating):!1;if(r===p||i&&u)return n;let b={scrollLeft:0,scrollTop:0},C=Tp(1);const A=Tp(0),R=Rp(r);if((R||!R&&!u)&&((ux(r)!=="body"||bb(p))&&(b=AE(r)),Rp(r))){const V=Uy(r);C=v0(r),A.x=V.x+r.clientLeft,A.y=V.y+r.clientTop}const z=p&&!R&&!u?Z3(p,b,!0):Tp(0);return{width:n.width*C.x,height:n.height*C.y,x:n.x*C.x-b.scrollLeft*C.x+A.x+z.x,y:n.y*C.y-b.scrollTop*C.y+A.y+z.y}}function w7(e){return Array.from(e.getClientRects())}function S7(e){const t=Bp(e),n=AE(e),r=e.ownerDocument.body,a=jc(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),u=jc(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let p=-n.scrollLeft+lM(e);const i=-n.scrollTop;return of(r).direction==="rtl"&&(p+=jc(t.clientWidth,r.clientWidth)-a),{width:a,height:u,x:p,y:i}}function E7(e,t){const n=Uc(e),r=Bp(e),a=n.visualViewport;let u=r.clientWidth,p=r.clientHeight,i=0,b=0;if(a){u=a.width,p=a.height;const C=sM();(!C||C&&t==="fixed")&&(i=a.offsetLeft,b=a.offsetTop)}return{width:u,height:p,x:i,y:b}}function C7(e,t){const n=Uy(e,!0,t==="fixed"),r=n.top+e.clientTop,a=n.left+e.clientLeft,u=Rp(e)?v0(e):Tp(1),p=e.clientWidth*u.x,i=e.clientHeight*u.y,b=a*u.x,C=r*u.y;return{width:p,height:i,x:b,y:C}}function KO(e,t,n){let r;if(t==="viewport")r=E7(e,n);else if(t==="document")r=S7(Bp(e));else if(rf(t))r=C7(t,n);else{const a=X3(e);r={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return zS(r)}function Y3(e,t){const n=E_(e);return n===t||!rf(n)||C0(n)?!1:of(n).position==="fixed"||Y3(n,t)}function T7(e,t){const n=t.get(e);if(n)return n;let r=U1(e,[],!1).filter(i=>rf(i)&&ux(i)!=="body"),a=null;const u=of(e).position==="fixed";let p=u?E_(e):e;for(;rf(p)&&!C0(p);){const i=of(p),b=oM(p);!b&&i.position==="fixed"&&(a=null),(u?!b&&!a:!b&&i.position==="static"&&!!a&&["absolute","fixed"].includes(a.position)||bb(p)&&!b&&Y3(e,p))?r=r.filter(A=>A!==p):a=i,p=E_(p)}return t.set(e,r),r}function I7(e){let{element:t,boundary:n,rootBoundary:r,strategy:a}=e;const p=[...n==="clippingAncestors"?PE(t)?[]:T7(t,this._c):[].concat(n),r],i=p[0],b=p.reduce((C,A)=>{const R=KO(t,A,a);return C.top=jc(R.top,C.top),C.right=w_(R.right,C.right),C.bottom=w_(R.bottom,C.bottom),C.left=jc(R.left,C.left),C},KO(t,i,a));return{width:b.right-b.left,height:b.bottom-b.top,x:b.left,y:b.top}}function M7(e){const{width:t,height:n}=W3(e);return{width:t,height:n}}function P7(e,t,n){const r=Rp(t),a=Bp(t),u=n==="fixed",p=Uy(e,!0,u,t);let i={scrollLeft:0,scrollTop:0};const b=Tp(0);if(r||!r&&!u)if((ux(t)!=="body"||bb(a))&&(i=AE(t)),r){const z=Uy(t,!0,u,t);b.x=z.x+t.clientLeft,b.y=z.y+t.clientTop}else a&&(b.x=lM(a));const C=a&&!r&&!u?Z3(a,i):Tp(0),A=p.left+i.scrollLeft-b.x-C.x,R=p.top+i.scrollTop-b.y-C.y;return{x:A,y:R,width:p.width,height:p.height}}function qT(e){return of(e).position==="static"}function JO(e,t){if(!Rp(e)||of(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Bp(e)===n&&(n=n.ownerDocument.body),n}function K3(e,t){const n=Uc(e);if(PE(e))return n;if(!Rp(e)){let a=E_(e);for(;a&&!C0(a);){if(rf(a)&&!qT(a))return a;a=E_(a)}return n}let r=JO(e,t);for(;r&&_7(r)&&qT(r);)r=JO(r,t);return r&&C0(r)&&qT(r)&&!oM(r)?n:r||y7(e)||n}const A7=async function(e){const t=this.getOffsetParent||K3,n=this.getDimensions,r=await n(e.floating);return{reference:P7(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function R7(e){return of(e).direction==="rtl"}const L7={convertOffsetParentRelativeRectToViewportRelativeRect:b7,getDocumentElement:Bp,getClippingRect:I7,getOffsetParent:K3,getElementRects:A7,getClientRects:w7,getDimensions:M7,getScale:v0,isElement:rf,isRTL:R7};function J3(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function O7(e,t){let n=null,r;const a=Bp(e);function u(){var i;clearTimeout(r),(i=n)==null||i.disconnect(),n=null}function p(i,b){i===void 0&&(i=!1),b===void 0&&(b=1),u();const C=e.getBoundingClientRect(),{left:A,top:R,width:z,height:V}=C;if(i||t(),!z||!V)return;const W=Qw(R),X=Qw(a.clientWidth-(A+z)),ue=Qw(a.clientHeight-(R+V)),ie=Qw(A),ee={rootMargin:-W+"px "+-X+"px "+-ue+"px "+-ie+"px",threshold:jc(0,w_(1,b))||1};let ae=!0;function he(xe){const ye=xe[0].intersectionRatio;if(ye!==b){if(!ae)return p();ye?p(!1,ye):r=setTimeout(()=>{p(!1,1e-7)},1e3)}ye===1&&!J3(C,e.getBoundingClientRect())&&p(),ae=!1}try{n=new IntersectionObserver(he,{...ee,root:a.ownerDocument})}catch{n=new IntersectionObserver(he,ee)}n.observe(e)}return p(!0),u}function Q3(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:a=!0,ancestorResize:u=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:b=!1}=r,C=aM(e),A=a||u?[...C?U1(C):[],...U1(t)]:[];A.forEach(ie=>{a&&ie.addEventListener("scroll",n,{passive:!0}),u&&ie.addEventListener("resize",n)});const R=C&&i?O7(C,n):null;let z=-1,V=null;p&&(V=new ResizeObserver(ie=>{let[K]=ie;K&&K.target===C&&V&&(V.unobserve(t),cancelAnimationFrame(z),z=requestAnimationFrame(()=>{var ee;(ee=V)==null||ee.observe(t)})),n()}),C&&!b&&V.observe(C),V.observe(t));let W,X=b?Uy(e):null;b&&ue();function ue(){const ie=Uy(e);X&&!J3(X,ie)&&n(),X=ie,W=requestAnimationFrame(ue)}return n(),()=>{var ie;A.forEach(K=>{a&&K.removeEventListener("scroll",n),u&&K.removeEventListener("resize",n)}),R==null||R(),(ie=V)==null||ie.disconnect(),V=null,b&&cancelAnimationFrame(W)}}const D7=f7,N7=p7,k7=c7,F7=g7,z7=h7,QO=u7,B7=m7,j7=(e,t,n)=>{const r=new Map,a={platform:L7,...n},u={...a.platform,_c:r};return l7(e,t,{...a,platform:u})};var xS=typeof document<"u"?Y.useLayoutEffect:Y.useEffect;function BS(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!BS(e[r],t[r]))return!1;return!0}if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,a[r]))return!1;for(r=n;r--!==0;){const u=a[r];if(!(u==="_owner"&&e.$$typeof)&&!BS(e[u],t[u]))return!1}return!0}return e!==e&&t!==t}function eF(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function eD(e,t){const n=eF(e);return Math.round(t*n)/n}function HT(e){const t=Y.useRef(e);return xS(()=>{t.current=e}),t}function tF(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:a,elements:{reference:u,floating:p}={},transform:i=!0,whileElementsMounted:b,open:C}=e,[A,R]=Y.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[z,V]=Y.useState(r);BS(z,r)||V(r);const[W,X]=Y.useState(null),[ue,ie]=Y.useState(null),K=Y.useCallback(We=>{We!==xe.current&&(xe.current=We,X(We))},[]),ee=Y.useCallback(We=>{We!==ye.current&&(ye.current=We,ie(We))},[]),ae=u||W,he=p||ue,xe=Y.useRef(null),ye=Y.useRef(null),Se=Y.useRef(A),je=b!=null,Re=HT(b),De=HT(a),at=HT(C),ot=Y.useCallback(()=>{if(!xe.current||!ye.current)return;const We={placement:t,strategy:n,middleware:z};De.current&&(We.platform=De.current),j7(xe.current,ye.current,We).then(tt=>{const Dt={...tt,isPositioned:at.current!==!1};Fe.current&&!BS(Se.current,Dt)&&(Se.current=Dt,Jd.flushSync(()=>{R(Dt)}))})},[z,t,n,De,at]);xS(()=>{C===!1&&Se.current.isPositioned&&(Se.current.isPositioned=!1,R(We=>({...We,isPositioned:!1})))},[C]);const Fe=Y.useRef(!1);xS(()=>(Fe.current=!0,()=>{Fe.current=!1}),[]),xS(()=>{if(ae&&(xe.current=ae),he&&(ye.current=he),ae&&he){if(Re.current)return Re.current(ae,he,ot);ot()}},[ae,he,ot,Re,je]);const Ze=Y.useMemo(()=>({reference:xe,floating:ye,setReference:K,setFloating:ee}),[K,ee]),Ve=Y.useMemo(()=>({reference:ae,floating:he}),[ae,he]),mt=Y.useMemo(()=>{const We={position:n,left:0,top:0};if(!Ve.floating)return We;const tt=eD(Ve.floating,A.x),Dt=eD(Ve.floating,A.y);return i?{...We,transform:"translate("+tt+"px, "+Dt+"px)",...eF(Ve.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:tt,top:Dt}},[n,i,Ve.floating,A.x,A.y]);return Y.useMemo(()=>({...A,update:ot,refs:Ze,elements:Ve,floatingStyles:mt}),[A,ot,Ze,Ve,mt])}const V7=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:a}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?QO({element:r.current,padding:a}).fn(n):{}:r?QO({element:r,padding:a}).fn(n):{}}}},nF=(e,t)=>({...D7(e),options:[e,t]}),rF=(e,t)=>({...N7(e),options:[e,t]}),iF=(e,t)=>({...B7(e),options:[e,t]}),oF=(e,t)=>({...k7(e),options:[e,t]}),sF=(e,t)=>({...F7(e),options:[e,t]}),aF=(e,t)=>({...z7(e),options:[e,t]}),lF=(e,t)=>({...V7(e),options:[e,t]});var U7="Arrow",uF=Y.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...u}=e;return G.jsx(j_.svg,{...u,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:G.jsx("polygon",{points:"0,0 30,0 15,10"})})});uF.displayName=U7;var G7=uF;function RE(e){const[t,n]=Y.useState(void 0);return na(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const u=a[0];let p,i;if("borderBoxSize"in u){const b=u.borderBoxSize,C=Array.isArray(b)?b[0]:b;p=C.inlineSize,i=C.blockSize}else p=e.offsetWidth,i=e.offsetHeight;n({width:p,height:i})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var uM="Popper",[cF,hF]=Zl(uM),[$7,dF]=cF(uM),fF=e=>{const{__scopePopper:t,children:n}=e,[r,a]=Y.useState(null);return G.jsx($7,{scope:t,anchor:r,onAnchorChange:a,children:n})};fF.displayName=uM;var pF="PopperAnchor",mF=Y.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,u=dF(pF,n),p=Y.useRef(null),i=Xr(t,p);return Y.useEffect(()=>{u.onAnchorChange((r==null?void 0:r.current)||p.current)}),r?null:G.jsx(j_.div,{...a,ref:i})});mF.displayName=pF;var cM="PopperContent",[q7,H7]=cF(cM),gF=Y.forwardRef((e,t)=>{var Ut,wn,Pn,we,Rr,Mr;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:u="center",alignOffset:p=0,arrowPadding:i=0,avoidCollisions:b=!0,collisionBoundary:C=[],collisionPadding:A=0,sticky:R="partial",hideWhenDetached:z=!1,updatePositionStrategy:V="optimized",onPlaced:W,...X}=e,ue=dF(cM,n),[ie,K]=Y.useState(null),ee=Xr(t,yi=>K(yi)),[ae,he]=Y.useState(null),xe=RE(ae),ye=(xe==null?void 0:xe.width)??0,Se=(xe==null?void 0:xe.height)??0,je=r+(u!=="center"?"-"+u:""),Re=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},De=Array.isArray(C)?C:[C],at=De.length>0,ot={padding:Re,boundary:De.filter(X7),altBoundary:at},{refs:Fe,floatingStyles:Ze,placement:Ve,isPositioned:mt,middlewareData:We}=tF({strategy:"fixed",placement:je,whileElementsMounted:(...yi)=>Q3(...yi,{animationFrame:V==="always"}),elements:{reference:ue.anchor},middleware:[nF({mainAxis:a+Se,alignmentAxis:p}),b&&rF({mainAxis:!0,crossAxis:!1,limiter:R==="partial"?iF():void 0,...ot}),b&&oF({...ot}),sF({...ot,apply:({elements:yi,rects:Gt,availableWidth:Io,availableHeight:qi})=>{const{width:Ji,height:cr}=Gt.reference,Yr=yi.floating.style;Yr.setProperty("--radix-popper-available-width",`${Io}px`),Yr.setProperty("--radix-popper-available-height",`${qi}px`),Yr.setProperty("--radix-popper-anchor-width",`${Ji}px`),Yr.setProperty("--radix-popper-anchor-height",`${cr}px`)}}),ae&&lF({element:ae,padding:i}),Z7({arrowWidth:ye,arrowHeight:Se}),z&&aF({strategy:"referenceHidden",...ot})]}),[tt,Dt]=vF(Ve),$e=fd(W);na(()=>{mt&&($e==null||$e())},[mt,$e]);const Ke=(Ut=We.arrow)==null?void 0:Ut.x,gt=(wn=We.arrow)==null?void 0:wn.y,Yt=((Pn=We.arrow)==null?void 0:Pn.centerOffset)!==0,[Kt,nn]=Y.useState();return na(()=>{ie&&nn(window.getComputedStyle(ie).zIndex)},[ie]),G.jsx("div",{ref:Fe.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ze,transform:mt?Ze.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Kt,"--radix-popper-transform-origin":[(we=We.transformOrigin)==null?void 0:we.x,(Rr=We.transformOrigin)==null?void 0:Rr.y].join(" "),...((Mr=We.hide)==null?void 0:Mr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:G.jsx(q7,{scope:n,placedSide:tt,onArrowChange:he,arrowX:Ke,arrowY:gt,shouldHideArrow:Yt,children:G.jsx(j_.div,{"data-side":tt,"data-align":Dt,...X,ref:ee,style:{...X.style,animation:mt?void 0:"none"}})})})});gF.displayName=cM;var _F="PopperArrow",W7={top:"bottom",right:"left",bottom:"top",left:"right"},yF=Y.forwardRef(function(t,n){const{__scopePopper:r,...a}=t,u=H7(_F,r),p=W7[u.placedSide];return G.jsx("span",{ref:u.onArrowChange,style:{position:"absolute",left:u.arrowX,top:u.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[u.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[u.placedSide],visibility:u.shouldHideArrow?"hidden":void 0},children:G.jsx(G7,{...a,ref:n,style:{...a.style,display:"block"}})})});yF.displayName=_F;function X7(e){return e!==null}var Z7=e=>({name:"transformOrigin",options:e,fn(t){var ue,ie,K;const{placement:n,rects:r,middlewareData:a}=t,p=((ue=a.arrow)==null?void 0:ue.centerOffset)!==0,i=p?0:e.arrowWidth,b=p?0:e.arrowHeight,[C,A]=vF(n),R={start:"0%",center:"50%",end:"100%"}[A],z=(((ie=a.arrow)==null?void 0:ie.x)??0)+i/2,V=(((K=a.arrow)==null?void 0:K.y)??0)+b/2;let W="",X="";return C==="bottom"?(W=p?R:`${z}px`,X=`${-b}px`):C==="top"?(W=p?R:`${z}px`,X=`${r.floating.height+b}px`):C==="right"?(W=`${-b}px`,X=p?R:`${V}px`):C==="left"&&(W=`${r.floating.width+b}px`,X=p?R:`${V}px`),{data:{x:W,y:X}}}});function vF(e){const[t,n="center"]=e.split("-");return[t,n]}var Y7=fF,K7=mF,J7=gF,Q7=yF,e9="Portal",xF=Y.forwardRef((e,t)=>{var i;const{container:n,...r}=e,[a,u]=Y.useState(!1);na(()=>u(!0),[]);const p=n||a&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return p?jy.createPortal(G.jsx(j_.div,{...r,ref:t}),p):null});xF.displayName=e9;var t9=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),n9="VisuallyHidden",bF=Y.forwardRef((e,t)=>G.jsx(j_.span,{...e,ref:t,style:{...t9,...e.style}}));bF.displayName=n9;var r9=bF,[LE,pae]=Zl("Tooltip",[hF]),OE=hF(),wF="TooltipProvider",i9=700,jI="tooltip.open",[o9,hM]=LE(wF),SF=e=>{const{__scopeTooltip:t,delayDuration:n=i9,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:u}=e,p=Y.useRef(!0),i=Y.useRef(!1),b=Y.useRef(0);return Y.useEffect(()=>{const C=b.current;return()=>window.clearTimeout(C)},[]),G.jsx(o9,{scope:t,isOpenDelayedRef:p,delayDuration:n,onOpen:Y.useCallback(()=>{window.clearTimeout(b.current),p.current=!1},[]),onClose:Y.useCallback(()=>{window.clearTimeout(b.current),b.current=window.setTimeout(()=>p.current=!0,r)},[r]),isPointerInTransitRef:i,onPointerInTransitChange:Y.useCallback(C=>{i.current=C},[]),disableHoverableContent:a,children:u})};SF.displayName=wF;var G1="Tooltip",[s9,wb]=LE(G1),EF=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:a,onOpenChange:u,disableHoverableContent:p,delayDuration:i}=e,b=hM(G1,e.__scopeTooltip),C=OE(t),[A,R]=Y.useState(null),z=Ns(),V=Y.useRef(0),W=p??b.disableHoverableContent,X=i??b.delayDuration,ue=Y.useRef(!1),[ie,K]=Hc({prop:r,defaultProp:a??!1,onChange:ye=>{ye?(b.onOpen(),document.dispatchEvent(new CustomEvent(jI))):b.onClose(),u==null||u(ye)},caller:G1}),ee=Y.useMemo(()=>ie?ue.current?"delayed-open":"instant-open":"closed",[ie]),ae=Y.useCallback(()=>{window.clearTimeout(V.current),V.current=0,ue.current=!1,K(!0)},[K]),he=Y.useCallback(()=>{window.clearTimeout(V.current),V.current=0,K(!1)},[K]),xe=Y.useCallback(()=>{window.clearTimeout(V.current),V.current=window.setTimeout(()=>{ue.current=!0,K(!0),V.current=0},X)},[X,K]);return Y.useEffect(()=>()=>{V.current&&(window.clearTimeout(V.current),V.current=0)},[]),G.jsx(Y7,{...C,children:G.jsx(s9,{scope:t,contentId:z,open:ie,stateAttribute:ee,trigger:A,onTriggerChange:R,onTriggerEnter:Y.useCallback(()=>{b.isOpenDelayedRef.current?xe():ae()},[b.isOpenDelayedRef,xe,ae]),onTriggerLeave:Y.useCallback(()=>{W?he():(window.clearTimeout(V.current),V.current=0)},[he,W]),onOpen:ae,onClose:he,disableHoverableContent:W,children:n})})};EF.displayName=G1;var VI="TooltipTrigger",CF=Y.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=wb(VI,n),u=hM(VI,n),p=OE(n),i=Y.useRef(null),b=Xr(t,i,a.onTriggerChange),C=Y.useRef(!1),A=Y.useRef(!1),R=Y.useCallback(()=>C.current=!1,[]);return Y.useEffect(()=>()=>document.removeEventListener("pointerup",R),[R]),G.jsx(K7,{asChild:!0,...p,children:G.jsx(j_.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:b,onPointerMove:Dn(e.onPointerMove,z=>{z.pointerType!=="touch"&&!A.current&&!u.isPointerInTransitRef.current&&(a.onTriggerEnter(),A.current=!0)}),onPointerLeave:Dn(e.onPointerLeave,()=>{a.onTriggerLeave(),A.current=!1}),onPointerDown:Dn(e.onPointerDown,()=>{a.open&&a.onClose(),C.current=!0,document.addEventListener("pointerup",R,{once:!0})}),onFocus:Dn(e.onFocus,()=>{C.current||a.onOpen()}),onBlur:Dn(e.onBlur,a.onClose),onClick:Dn(e.onClick,a.onClose)})})});CF.displayName=VI;var dM="TooltipPortal",[a9,l9]=LE(dM,{forceMount:void 0}),TF=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:a}=e,u=wb(dM,t);return G.jsx(a9,{scope:t,forceMount:n,children:G.jsx(pc,{present:n||u.open,children:G.jsx(xF,{asChild:!0,container:a,children:r})})})};TF.displayName=dM;var T0="TooltipContent",IF=Y.forwardRef((e,t)=>{const n=l9(T0,e.__scopeTooltip),{forceMount:r=n.forceMount,side:a="top",...u}=e,p=wb(T0,e.__scopeTooltip);return G.jsx(pc,{present:r||p.open,children:p.disableHoverableContent?G.jsx(MF,{side:a,...u,ref:t}):G.jsx(u9,{side:a,...u,ref:t})})}),u9=Y.forwardRef((e,t)=>{const n=wb(T0,e.__scopeTooltip),r=hM(T0,e.__scopeTooltip),a=Y.useRef(null),u=Xr(t,a),[p,i]=Y.useState(null),{trigger:b,onClose:C}=n,A=a.current,{onPointerInTransitChange:R}=r,z=Y.useCallback(()=>{i(null),R(!1)},[R]),V=Y.useCallback((W,X)=>{const ue=W.currentTarget,ie={x:W.clientX,y:W.clientY},K=f9(ie,ue.getBoundingClientRect()),ee=p9(ie,K),ae=m9(X.getBoundingClientRect()),he=_9([...ee,...ae]);i(he),R(!0)},[R]);return Y.useEffect(()=>()=>z(),[z]),Y.useEffect(()=>{if(b&&A){const W=ue=>V(ue,A),X=ue=>V(ue,b);return b.addEventListener("pointerleave",W),A.addEventListener("pointerleave",X),()=>{b.removeEventListener("pointerleave",W),A.removeEventListener("pointerleave",X)}}},[b,A,V,z]),Y.useEffect(()=>{if(p){const W=X=>{const ue=X.target,ie={x:X.clientX,y:X.clientY},K=(b==null?void 0:b.contains(ue))||(A==null?void 0:A.contains(ue)),ee=!g9(ie,p);K?z():ee&&(z(),C())};return document.addEventListener("pointermove",W),()=>document.removeEventListener("pointermove",W)}},[b,A,p,C,z]),G.jsx(MF,{...e,ref:u})}),[c9,h9]=LE(G1,{isInside:!1}),d9=VH("TooltipContent"),MF=Y.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":a,onEscapeKeyDown:u,onPointerDownOutside:p,...i}=e,b=wb(T0,n),C=OE(n),{onClose:A}=b;return Y.useEffect(()=>(document.addEventListener(jI,A),()=>document.removeEventListener(jI,A)),[A]),Y.useEffect(()=>{if(b.trigger){const R=z=>{const V=z.target;V!=null&&V.contains(b.trigger)&&A()};return window.addEventListener("scroll",R,{capture:!0}),()=>window.removeEventListener("scroll",R,{capture:!0})}},[b.trigger,A]),G.jsx(U3,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:R=>R.preventDefault(),onDismiss:A,children:G.jsxs(J7,{"data-state":b.stateAttribute,...C,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[G.jsx(d9,{children:r}),G.jsx(c9,{scope:n,isInside:!0,children:G.jsx(r9,{id:b.contentId,role:"tooltip",children:a||r})})]})})});IF.displayName=T0;var PF="TooltipArrow",AF=Y.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=OE(n);return h9(PF,n).isInside?null:G.jsx(Q7,{...a,...r,ref:t})});AF.displayName=PF;function f9(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),u=Math.abs(t.left-e.x);switch(Math.min(n,r,a,u)){case u:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function p9(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function m9(e){const{top:t,right:n,bottom:r,left:a}=e;return[{x:a,y:t},{x:n,y:t},{x:n,y:r},{x:a,y:r}]}function g9(e,t){const{x:n,y:r}=e;let a=!1;for(let u=0,p=t.length-1;u<t.length;p=u++){const i=t[u],b=t[p],C=i.x,A=i.y,R=b.x,z=b.y;A>r!=z>r&&n<(R-C)*(r-A)/(z-A)+C&&(a=!a)}return a}function _9(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),y9(t)}function y9(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const u=t[t.length-1],p=t[t.length-2];if((u.x-p.x)*(a.y-p.y)>=(u.y-p.y)*(a.x-p.x))t.pop();else break}t.push(a)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const a=e[r];for(;n.length>=2;){const u=n[n.length-1],p=n[n.length-2];if((u.x-p.x)*(a.y-p.y)>=(u.y-p.y)*(a.x-p.x))n.pop();else break}n.push(a)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var v9=SF,x9=EF,b9=CF,w9=TF,RF=IF;const LF=v9,OF=x9,DF=b9,fM=Y.forwardRef(({className:e,sideOffset:t=4,...n},r)=>G.jsx(w9,{children:G.jsx(RF,{ref:r,sideOffset:t,className:dn("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...n})}));fM.displayName=RF.displayName;const S9="sidebar_state",E9=60*60*24*7,C9="16rem",T9="18rem",I9="3rem",M9="b",NF=Y.createContext(null);function cx(){const e=Y.useContext(NF);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const kF=Y.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:n,className:r,style:a,children:u,...p},i)=>{const b=i$(),[C,A]=Y.useState(!1),[R,z]=Y.useState(e),V=t??R,W=Y.useCallback(K=>{const ee=typeof K=="function"?K(V):K;n?n(ee):z(ee),document.cookie=`${S9}=${ee}; path=/; max-age=${E9}`},[n,V]),X=Y.useCallback(()=>b?A(K=>!K):W(K=>!K),[b,W,A]);Y.useEffect(()=>{const K=ee=>{ee.key===M9&&(ee.metaKey||ee.ctrlKey)&&(ee.preventDefault(),X())};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[X]);const ue=V?"expanded":"collapsed",ie=Y.useMemo(()=>({state:ue,open:V,setOpen:W,isMobile:b,openMobile:C,setOpenMobile:A,toggleSidebar:X}),[ue,V,W,b,C,A,X]);return G.jsx(NF.Provider,{value:ie,children:G.jsx(LF,{delayDuration:0,children:G.jsx("div",{style:{"--sidebar-width":C9,"--sidebar-width-icon":I9,...a},className:dn("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",r),ref:i,...p,children:u})})})});kF.displayName="SidebarProvider";const jS=Y.forwardRef(({side:e="left",variant:t="sidebar",collapsible:n="icon",className:r,children:a,...u},p)=>{const{isMobile:i,state:b,openMobile:C,setOpenMobile:A}=cx();return n==="none"?G.jsx("div",{className:dn("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",r),ref:p,...u,children:a}):e==="bottom"?G.jsx("div",{className:dn("fixed inset-x-0 bottom-8 z-10 hidden bg-sidebar text-sidebar-foreground md:flex w-fit m-auto rounded-xl shadow",r),ref:p,...u,children:G.jsx("div",{className:"flex h-full w-full flex-col",children:a})}):e==="top"?G.jsx("div",{className:dn("fixed inset-x-0 top-8 z-10 hidden bg-sidebar text-sidebar-foreground md:flex w-fit m-auto rounded-xl shadow",r),ref:p,...u,children:G.jsx("div",{className:"flex h-full w-full flex-col",children:a})}):i?G.jsx(DH,{open:C,onOpenChange:A,...u,children:G.jsx(B3,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":T9},side:e,children:G.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):G.jsxs("div",{ref:p,className:"group peer hidden text-sidebar-foreground md:block","data-state":b,"data-collapsible":b==="collapsed"?n:"","data-variant":t,"data-side":e,children:[G.jsx("div",{className:dn("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),G.jsx("div",{className:dn("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...u,children:G.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})});jS.displayName="Sidebar";const FF=Y.forwardRef(({className:e,onClick:t,...n},r)=>{const{toggleSidebar:a}=cx();return G.jsxs(Qr,{ref:r,"data-sidebar":"trigger",variant:"default",size:"icon",className:dn("h-10 w-10",e),onClick:u=>{t==null||t(u),a()},...n,children:[G.jsx(q8,{}),G.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});FF.displayName="SidebarTrigger";const P9=Y.forwardRef(({className:e,...t},n)=>{const{toggleSidebar:r}=cx();return G.jsx("button",{ref:n,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:dn("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});P9.displayName="SidebarRail";const A9=Y.forwardRef(({className:e,...t},n)=>G.jsx("main",{ref:n,className:dn("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));A9.displayName="SidebarInset";const R9=Y.forwardRef(({className:e,...t},n)=>G.jsx(E0,{ref:n,"data-sidebar":"input",className:dn("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));R9.displayName="SidebarInput";const zF=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"header",className:dn("flex flex-col gap-2 p-2",e),...t}));zF.displayName="SidebarHeader";const L9=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"footer",className:dn("flex flex-col gap-2 p-2",e),...t}));L9.displayName="SidebarFooter";const O9=Y.forwardRef(({className:e,...t},n)=>G.jsx(s3,{ref:n,"data-sidebar":"separator",className:dn("mx-2 w-auto bg-sidebar-border",e),...t}));O9.displayName="SidebarSeparator";const BF=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"content",className:dn("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));BF.displayName="SidebarContent";const D9=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"group",className:dn("relative flex w-full min-w-0 flex-col p-2",e),...t}));D9.displayName="SidebarGroup";const N9=Y.forwardRef(({className:e,asChild:t=!1,...n},r)=>{const a=t?rx:"div";return G.jsx(a,{ref:r,"data-sidebar":"group-label",className:dn("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...n})});N9.displayName="SidebarGroupLabel";const k9=Y.forwardRef(({className:e,asChild:t=!1,...n},r)=>{const a=t?rx:"button";return G.jsx(a,{ref:r,"data-sidebar":"group-action",className:dn("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...n})});k9.displayName="SidebarGroupAction";const jF=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"group-content",className:dn("w-full text-sm",e),...t}));jF.displayName="SidebarGroupContent";const VF=Y.forwardRef(({className:e,...t},n)=>G.jsx("ul",{ref:n,"data-sidebar":"menu",className:dn("flex w-full min-w-0 flex-col gap-1",e),...t}));VF.displayName="SidebarMenu";const bS=Y.forwardRef(({className:e,...t},n)=>G.jsx("li",{ref:n,"data-sidebar":"menu-item",className:dn("group/menu-item relative",e),...t}));bS.displayName="SidebarMenuItem";const F9=bE("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),wS=Y.forwardRef(({asChild:e=!1,isActive:t=!1,variant:n="default",size:r="default",tooltip:a,className:u,...p},i)=>{const b=e?rx:"button",{isMobile:C,state:A}=cx(),R=G.jsx(b,{ref:i,"data-sidebar":"menu-button","data-size":r,"data-active":t,className:dn(F9({variant:n,size:r}),u),...p});return a?(typeof a=="string"&&(a={children:a}),G.jsxs(OF,{children:[G.jsx(DF,{asChild:!0,children:R}),G.jsx(fM,{side:"right",align:"center",hidden:A!=="collapsed"||C,...a})]})):R});wS.displayName="SidebarMenuButton";const z9=Y.forwardRef(({className:e,asChild:t=!1,showOnHover:n=!1,...r},a)=>{const u=t?rx:"button";return G.jsx(u,{ref:a,"data-sidebar":"menu-action",className:dn("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...r})});z9.displayName="SidebarMenuAction";const B9=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,"data-sidebar":"menu-badge",className:dn("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));B9.displayName="SidebarMenuBadge";const j9=Y.forwardRef(({className:e,showIcon:t=!1,...n},r)=>{const a=Y.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return G.jsxs("div",{ref:r,"data-sidebar":"menu-skeleton",className:dn("flex h-8 items-center gap-2 rounded-md px-2",e),...n,children:[t&&G.jsx($O,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),G.jsx($O,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});j9.displayName="SidebarMenuSkeleton";const V9=Y.forwardRef(({className:e,...t},n)=>G.jsx("ul",{ref:n,"data-sidebar":"menu-sub",className:dn("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));V9.displayName="SidebarMenuSub";const U9=Y.forwardRef(({...e},t)=>G.jsx("li",{ref:t,...e}));U9.displayName="SidebarMenuSubItem";const G9=Y.forwardRef(({asChild:e=!1,size:t="md",isActive:n,className:r,...a},u)=>{const p=e?rx:"a";return G.jsx(p,{ref:u,"data-sidebar":"menu-sub-button","data-size":t,"data-active":n,className:dn("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",r),...a})});G9.displayName="SidebarMenuSubButton";function tD(e){const t=$9(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(H9);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function $9(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=X9(a),i=W9(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var q9=Symbol("radix.slottable");function H9(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===q9}function W9(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function X9(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function Sb(e){const t=e+"CollectionProvider",[n,r]=Zl(t),[a,u]=n(t,{collectionRef:{current:null},itemMap:new Map}),p=X=>{const{scope:ue,children:ie}=X,K=Zt.useRef(null),ee=Zt.useRef(new Map).current;return G.jsx(a,{scope:ue,itemMap:ee,collectionRef:K,children:ie})};p.displayName=t;const i=e+"CollectionSlot",b=tD(i),C=Zt.forwardRef((X,ue)=>{const{scope:ie,children:K}=X,ee=u(i,ie),ae=Xr(ue,ee.collectionRef);return G.jsx(b,{ref:ae,children:K})});C.displayName=i;const A=e+"CollectionItemSlot",R="data-radix-collection-item",z=tD(A),V=Zt.forwardRef((X,ue)=>{const{scope:ie,children:K,...ee}=X,ae=Zt.useRef(null),he=Xr(ue,ae),xe=u(A,ie);return Zt.useEffect(()=>(xe.itemMap.set(ae,{ref:ae,...ee}),()=>void xe.itemMap.delete(ae))),G.jsx(z,{[R]:"",ref:he,children:K})});V.displayName=A;function W(X){const ue=u(e+"CollectionConsumer",X);return Zt.useCallback(()=>{const K=ue.collectionRef.current;if(!K)return[];const ee=Array.from(K.querySelectorAll(`[${R}]`));return Array.from(ue.itemMap.values()).sort((xe,ye)=>ee.indexOf(xe.ref.current)-ee.indexOf(ye.ref.current))},[ue.collectionRef,ue.itemMap])}return[{Provider:p,Slot:C,ItemSlot:V},W,r]}var DE="Collapsible",[Z9,UF]=Zl(DE),[Y9,pM]=Z9(DE),GF=Y.forwardRef((e,t)=>{const{__scopeCollapsible:n,open:r,defaultOpen:a,disabled:u,onOpenChange:p,...i}=e,[b,C]=Hc({prop:r,defaultProp:a??!1,onChange:p,caller:DE});return G.jsx(Y9,{scope:n,disabled:u,contentId:Ns(),open:b,onOpenToggle:Y.useCallback(()=>C(A=>!A),[C]),children:G.jsx(Ir.div,{"data-state":gM(b),"data-disabled":u?"":void 0,...i,ref:t})})});GF.displayName=DE;var $F="CollapsibleTrigger",qF=Y.forwardRef((e,t)=>{const{__scopeCollapsible:n,...r}=e,a=pM($F,n);return G.jsx(Ir.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":gM(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:Dn(e.onClick,a.onOpenToggle)})});qF.displayName=$F;var mM="CollapsibleContent",HF=Y.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=pM(mM,e.__scopeCollapsible);return G.jsx(pc,{present:n||a.open,children:({present:u})=>G.jsx(K9,{...r,ref:t,present:u})})});HF.displayName=mM;var K9=Y.forwardRef((e,t)=>{const{__scopeCollapsible:n,present:r,children:a,...u}=e,p=pM(mM,n),[i,b]=Y.useState(r),C=Y.useRef(null),A=Xr(t,C),R=Y.useRef(0),z=R.current,V=Y.useRef(0),W=V.current,X=p.open||i,ue=Y.useRef(X),ie=Y.useRef(void 0);return Y.useEffect(()=>{const K=requestAnimationFrame(()=>ue.current=!1);return()=>cancelAnimationFrame(K)},[]),na(()=>{const K=C.current;if(K){ie.current=ie.current||{transitionDuration:K.style.transitionDuration,animationName:K.style.animationName},K.style.transitionDuration="0s",K.style.animationName="none";const ee=K.getBoundingClientRect();R.current=ee.height,V.current=ee.width,ue.current||(K.style.transitionDuration=ie.current.transitionDuration,K.style.animationName=ie.current.animationName),b(r)}},[p.open,r]),G.jsx(Ir.div,{"data-state":gM(p.open),"data-disabled":p.disabled?"":void 0,id:p.contentId,hidden:!X,...u,ref:A,style:{"--radix-collapsible-content-height":z?`${z}px`:void 0,"--radix-collapsible-content-width":W?`${W}px`:void 0,...e.style},children:X&&a})});function gM(e){return e?"open":"closed"}var J9=GF,Q9=qF,eW=HF,tW=Y.createContext(void 0);function Eb(e){const t=Y.useContext(tW);return e||t||"ltr"}var bf="Accordion",nW=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[_M,rW,iW]=Sb(bf),[NE,mae]=Zl(bf,[iW,UF]),yM=UF(),WF=Zt.forwardRef((e,t)=>{const{type:n,...r}=e,a=r,u=r;return G.jsx(_M.Provider,{scope:e.__scopeAccordion,children:n==="multiple"?G.jsx(lW,{...u,ref:t}):G.jsx(aW,{...a,ref:t})})});WF.displayName=bf;var[XF,oW]=NE(bf),[ZF,sW]=NE(bf,{collapsible:!1}),aW=Zt.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},collapsible:u=!1,...p}=e,[i,b]=Hc({prop:n,defaultProp:r??"",onChange:a,caller:bf});return G.jsx(XF,{scope:e.__scopeAccordion,value:Zt.useMemo(()=>i?[i]:[],[i]),onItemOpen:b,onItemClose:Zt.useCallback(()=>u&&b(""),[u,b]),children:G.jsx(ZF,{scope:e.__scopeAccordion,collapsible:u,children:G.jsx(YF,{...p,ref:t})})})}),lW=Zt.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...u}=e,[p,i]=Hc({prop:n,defaultProp:r??[],onChange:a,caller:bf}),b=Zt.useCallback(A=>i((R=[])=>[...R,A]),[i]),C=Zt.useCallback(A=>i((R=[])=>R.filter(z=>z!==A)),[i]);return G.jsx(XF,{scope:e.__scopeAccordion,value:p,onItemOpen:b,onItemClose:C,children:G.jsx(ZF,{scope:e.__scopeAccordion,collapsible:!0,children:G.jsx(YF,{...u,ref:t})})})}),[uW,kE]=NE(bf),YF=Zt.forwardRef((e,t)=>{const{__scopeAccordion:n,disabled:r,dir:a,orientation:u="vertical",...p}=e,i=Zt.useRef(null),b=Xr(i,t),C=rW(n),R=Eb(a)==="ltr",z=Dn(e.onKeyDown,V=>{var Se;if(!nW.includes(V.key))return;const W=V.target,X=C().filter(je=>{var Re;return!((Re=je.ref.current)!=null&&Re.disabled)}),ue=X.findIndex(je=>je.ref.current===W),ie=X.length;if(ue===-1)return;V.preventDefault();let K=ue;const ee=0,ae=ie-1,he=()=>{K=ue+1,K>ae&&(K=ee)},xe=()=>{K=ue-1,K<ee&&(K=ae)};switch(V.key){case"Home":K=ee;break;case"End":K=ae;break;case"ArrowRight":u==="horizontal"&&(R?he():xe());break;case"ArrowDown":u==="vertical"&&he();break;case"ArrowLeft":u==="horizontal"&&(R?xe():he());break;case"ArrowUp":u==="vertical"&&xe();break}const ye=K%ie;(Se=X[ye].ref.current)==null||Se.focus()});return G.jsx(uW,{scope:n,disabled:r,direction:a,orientation:u,children:G.jsx(_M.Slot,{scope:n,children:G.jsx(Ir.div,{...p,"data-orientation":u,ref:b,onKeyDown:r?void 0:z})})})}),VS="AccordionItem",[cW,vM]=NE(VS),KF=Zt.forwardRef((e,t)=>{const{__scopeAccordion:n,value:r,...a}=e,u=kE(VS,n),p=oW(VS,n),i=yM(n),b=Ns(),C=r&&p.value.includes(r)||!1,A=u.disabled||e.disabled;return G.jsx(cW,{scope:n,open:C,disabled:A,triggerId:b,children:G.jsx(J9,{"data-orientation":u.orientation,"data-state":rz(C),...i,...a,ref:t,disabled:A,open:C,onOpenChange:R=>{R?p.onItemOpen(r):p.onItemClose(r)}})})});KF.displayName=VS;var JF="AccordionHeader",QF=Zt.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=kE(bf,n),u=vM(JF,n);return G.jsx(Ir.h3,{"data-orientation":a.orientation,"data-state":rz(u.open),"data-disabled":u.disabled?"":void 0,...r,ref:t})});QF.displayName=JF;var UI="AccordionTrigger",ez=Zt.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=kE(bf,n),u=vM(UI,n),p=sW(UI,n),i=yM(n);return G.jsx(_M.ItemSlot,{scope:n,children:G.jsx(Q9,{"aria-disabled":u.open&&!p.collapsible||void 0,"data-orientation":a.orientation,id:u.triggerId,...i,...r,ref:t})})});ez.displayName=UI;var tz="AccordionContent",nz=Zt.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=kE(bf,n),u=vM(tz,n),p=yM(n);return G.jsx(eW,{role:"region","aria-labelledby":u.triggerId,"data-orientation":a.orientation,...p,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});nz.displayName=tz;function rz(e){return e?"open":"closed"}var hW=WF,dW=KF,fW=QF,iz=ez,oz=nz;const nD=hW,GI=Y.forwardRef(({className:e,...t},n)=>G.jsx(dW,{ref:n,...t}));GI.displayName="AccordionItem";const $I=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsx(fW,{className:"flex",children:G.jsxs(iz,{ref:r,className:dn("flex flex-1 items-center py-4 text-sm font-medium transition-all text-left [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,G.jsx(db,{className:"h-4 w-4 shrink-0 ml-auto text-muted-foreground transition-transform duration-200"})]})}));$I.displayName=iz.displayName;const qI=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsx(oz,{ref:r,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:G.jsx("div",{className:dn("pb-0 pt-0",e),children:t})}));qI.displayName=oz.displayName;var pW="Arrow",sz=Y.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...u}=e;return G.jsx(Ir.svg,{...u,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:G.jsx("polygon",{points:"0,0 30,0 15,10"})})});sz.displayName=pW;var mW=sz,xM="Popper",[az,hx]=Zl(xM),[gW,lz]=az(xM),uz=e=>{const{__scopePopper:t,children:n}=e,[r,a]=Y.useState(null);return G.jsx(gW,{scope:t,anchor:r,onAnchorChange:a,children:n})};uz.displayName=xM;var cz="PopperAnchor",hz=Y.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,u=lz(cz,n),p=Y.useRef(null),i=Xr(t,p);return Y.useEffect(()=>{u.onAnchorChange((r==null?void 0:r.current)||p.current)}),r?null:G.jsx(Ir.div,{...a,ref:i})});hz.displayName=cz;var bM="PopperContent",[_W,yW]=az(bM),dz=Y.forwardRef((e,t)=>{var Ut,wn,Pn,we,Rr,Mr;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:u="center",alignOffset:p=0,arrowPadding:i=0,avoidCollisions:b=!0,collisionBoundary:C=[],collisionPadding:A=0,sticky:R="partial",hideWhenDetached:z=!1,updatePositionStrategy:V="optimized",onPlaced:W,...X}=e,ue=lz(bM,n),[ie,K]=Y.useState(null),ee=Xr(t,yi=>K(yi)),[ae,he]=Y.useState(null),xe=RE(ae),ye=(xe==null?void 0:xe.width)??0,Se=(xe==null?void 0:xe.height)??0,je=r+(u!=="center"?"-"+u:""),Re=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},De=Array.isArray(C)?C:[C],at=De.length>0,ot={padding:Re,boundary:De.filter(xW),altBoundary:at},{refs:Fe,floatingStyles:Ze,placement:Ve,isPositioned:mt,middlewareData:We}=tF({strategy:"fixed",placement:je,whileElementsMounted:(...yi)=>Q3(...yi,{animationFrame:V==="always"}),elements:{reference:ue.anchor},middleware:[nF({mainAxis:a+Se,alignmentAxis:p}),b&&rF({mainAxis:!0,crossAxis:!1,limiter:R==="partial"?iF():void 0,...ot}),b&&oF({...ot}),sF({...ot,apply:({elements:yi,rects:Gt,availableWidth:Io,availableHeight:qi})=>{const{width:Ji,height:cr}=Gt.reference,Yr=yi.floating.style;Yr.setProperty("--radix-popper-available-width",`${Io}px`),Yr.setProperty("--radix-popper-available-height",`${qi}px`),Yr.setProperty("--radix-popper-anchor-width",`${Ji}px`),Yr.setProperty("--radix-popper-anchor-height",`${cr}px`)}}),ae&&lF({element:ae,padding:i}),bW({arrowWidth:ye,arrowHeight:Se}),z&&aF({strategy:"referenceHidden",...ot})]}),[tt,Dt]=mz(Ve),$e=fd(W);na(()=>{mt&&($e==null||$e())},[mt,$e]);const Ke=(Ut=We.arrow)==null?void 0:Ut.x,gt=(wn=We.arrow)==null?void 0:wn.y,Yt=((Pn=We.arrow)==null?void 0:Pn.centerOffset)!==0,[Kt,nn]=Y.useState();return na(()=>{ie&&nn(window.getComputedStyle(ie).zIndex)},[ie]),G.jsx("div",{ref:Fe.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ze,transform:mt?Ze.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Kt,"--radix-popper-transform-origin":[(we=We.transformOrigin)==null?void 0:we.x,(Rr=We.transformOrigin)==null?void 0:Rr.y].join(" "),...((Mr=We.hide)==null?void 0:Mr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:G.jsx(_W,{scope:n,placedSide:tt,onArrowChange:he,arrowX:Ke,arrowY:gt,shouldHideArrow:Yt,children:G.jsx(Ir.div,{"data-side":tt,"data-align":Dt,...X,ref:ee,style:{...X.style,animation:mt?void 0:"none"}})})})});dz.displayName=bM;var fz="PopperArrow",vW={top:"bottom",right:"left",bottom:"top",left:"right"},pz=Y.forwardRef(function(t,n){const{__scopePopper:r,...a}=t,u=yW(fz,r),p=vW[u.placedSide];return G.jsx("span",{ref:u.onArrowChange,style:{position:"absolute",left:u.arrowX,top:u.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[u.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[u.placedSide],visibility:u.shouldHideArrow?"hidden":void 0},children:G.jsx(mW,{...a,ref:n,style:{...a.style,display:"block"}})})});pz.displayName=fz;function xW(e){return e!==null}var bW=e=>({name:"transformOrigin",options:e,fn(t){var ue,ie,K;const{placement:n,rects:r,middlewareData:a}=t,p=((ue=a.arrow)==null?void 0:ue.centerOffset)!==0,i=p?0:e.arrowWidth,b=p?0:e.arrowHeight,[C,A]=mz(n),R={start:"0%",center:"50%",end:"100%"}[A],z=(((ie=a.arrow)==null?void 0:ie.x)??0)+i/2,V=(((K=a.arrow)==null?void 0:K.y)??0)+b/2;let W="",X="";return C==="bottom"?(W=p?R:`${z}px`,X=`${-b}px`):C==="top"?(W=p?R:`${z}px`,X=`${r.floating.height+b}px`):C==="right"?(W=`${-b}px`,X=p?R:`${V}px`):C==="left"&&(W=`${r.floating.width+b}px`,X=p?R:`${V}px`),{data:{x:W,y:X}}}});function mz(e){const[t,n="center"]=e.split("-");return[t,n]}var FE=uz,zE=hz,wM=dz,SM=pz,WT="rovingFocusGroup.onEntryFocus",wW={bubbles:!1,cancelable:!0},Cb="RovingFocusGroup",[HI,gz,SW]=Sb(Cb),[EW,_z]=Zl(Cb,[SW]),[CW,TW]=EW(Cb),yz=Y.forwardRef((e,t)=>G.jsx(HI.Provider,{scope:e.__scopeRovingFocusGroup,children:G.jsx(HI.Slot,{scope:e.__scopeRovingFocusGroup,children:G.jsx(IW,{...e,ref:t})})}));yz.displayName=Cb;var IW=Y.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:u,currentTabStopId:p,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:b,onEntryFocus:C,preventScrollOnEntryFocus:A=!1,...R}=e,z=Y.useRef(null),V=Xr(t,z),W=Eb(u),[X,ue]=Hc({prop:p,defaultProp:i??null,onChange:b,caller:Cb}),[ie,K]=Y.useState(!1),ee=fd(C),ae=gz(n),he=Y.useRef(!1),[xe,ye]=Y.useState(0);return Y.useEffect(()=>{const Se=z.current;if(Se)return Se.addEventListener(WT,ee),()=>Se.removeEventListener(WT,ee)},[ee]),G.jsx(CW,{scope:n,orientation:r,dir:W,loop:a,currentTabStopId:X,onItemFocus:Y.useCallback(Se=>ue(Se),[ue]),onItemShiftTab:Y.useCallback(()=>K(!0),[]),onFocusableItemAdd:Y.useCallback(()=>ye(Se=>Se+1),[]),onFocusableItemRemove:Y.useCallback(()=>ye(Se=>Se-1),[]),children:G.jsx(Ir.div,{tabIndex:ie||xe===0?-1:0,"data-orientation":r,...R,ref:V,style:{outline:"none",...e.style},onMouseDown:Dn(e.onMouseDown,()=>{he.current=!0}),onFocus:Dn(e.onFocus,Se=>{const je=!he.current;if(Se.target===Se.currentTarget&&je&&!ie){const Re=new CustomEvent(WT,wW);if(Se.currentTarget.dispatchEvent(Re),!Re.defaultPrevented){const De=ae().filter(Ve=>Ve.focusable),at=De.find(Ve=>Ve.active),ot=De.find(Ve=>Ve.id===X),Ze=[at,ot,...De].filter(Boolean).map(Ve=>Ve.ref.current);bz(Ze,A)}}he.current=!1}),onBlur:Dn(e.onBlur,()=>K(!1))})})}),vz="RovingFocusGroupItem",xz=Y.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:u,children:p,...i}=e,b=Ns(),C=u||b,A=TW(vz,n),R=A.currentTabStopId===C,z=gz(n),{onFocusableItemAdd:V,onFocusableItemRemove:W,currentTabStopId:X}=A;return Y.useEffect(()=>{if(r)return V(),()=>W()},[r,V,W]),G.jsx(HI.ItemSlot,{scope:n,id:C,focusable:r,active:a,children:G.jsx(Ir.span,{tabIndex:R?0:-1,"data-orientation":A.orientation,...i,ref:t,onMouseDown:Dn(e.onMouseDown,ue=>{r?A.onItemFocus(C):ue.preventDefault()}),onFocus:Dn(e.onFocus,()=>A.onItemFocus(C)),onKeyDown:Dn(e.onKeyDown,ue=>{if(ue.key==="Tab"&&ue.shiftKey){A.onItemShiftTab();return}if(ue.target!==ue.currentTarget)return;const ie=AW(ue,A.orientation,A.dir);if(ie!==void 0){if(ue.metaKey||ue.ctrlKey||ue.altKey||ue.shiftKey)return;ue.preventDefault();let ee=z().filter(ae=>ae.focusable).map(ae=>ae.ref.current);if(ie==="last")ee.reverse();else if(ie==="prev"||ie==="next"){ie==="prev"&&ee.reverse();const ae=ee.indexOf(ue.currentTarget);ee=A.loop?RW(ee,ae+1):ee.slice(ae+1)}setTimeout(()=>bz(ee))}}),children:typeof p=="function"?p({isCurrentTabStop:R,hasTabStop:X!=null}):p})})});xz.displayName=vz;var MW={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function PW(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function AW(e,t,n){const r=PW(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return MW[r]}function bz(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function RW(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var LW=yz,OW=xz;function DW(e){const t=NW(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(FW);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function NW(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=BW(a),i=zW(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var kW=Symbol("radix.slottable");function FW(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===kW}function zW(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function BW(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var WI=["Enter"," "],jW=["ArrowDown","PageUp","Home"],wz=["ArrowUp","PageDown","End"],VW=[...jW,...wz],UW={ltr:[...WI,"ArrowRight"],rtl:[...WI,"ArrowLeft"]},GW={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Tb="Menu",[$1,$W,qW]=Sb(Tb),[av,Sz]=Zl(Tb,[qW,hx,_z]),Ib=hx(),Ez=_z(),[Cz,V_]=av(Tb),[HW,Mb]=av(Tb),Tz=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:u,modal:p=!0}=e,i=Ib(t),[b,C]=Y.useState(null),A=Y.useRef(!1),R=fd(u),z=Eb(a);return Y.useEffect(()=>{const V=()=>{A.current=!0,document.addEventListener("pointerdown",W,{capture:!0,once:!0}),document.addEventListener("pointermove",W,{capture:!0,once:!0})},W=()=>A.current=!1;return document.addEventListener("keydown",V,{capture:!0}),()=>{document.removeEventListener("keydown",V,{capture:!0}),document.removeEventListener("pointerdown",W,{capture:!0}),document.removeEventListener("pointermove",W,{capture:!0})}},[]),G.jsx(FE,{...i,children:G.jsx(Cz,{scope:t,open:n,onOpenChange:R,content:b,onContentChange:C,children:G.jsx(HW,{scope:t,onClose:Y.useCallback(()=>R(!1),[R]),isUsingKeyboardRef:A,dir:z,modal:p,children:r})})})};Tz.displayName=Tb;var WW="MenuAnchor",EM=Y.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=Ib(n);return G.jsx(zE,{...a,...r,ref:t})});EM.displayName=WW;var CM="MenuPortal",[XW,Iz]=av(CM,{forceMount:void 0}),Mz=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:a}=e,u=V_(CM,t);return G.jsx(XW,{scope:t,forceMount:n,children:G.jsx(pc,{present:n||u.open,children:G.jsx(_b,{asChild:!0,container:a,children:r})})})};Mz.displayName=CM;var Wh="MenuContent",[ZW,TM]=av(Wh),Pz=Y.forwardRef((e,t)=>{const n=Iz(Wh,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,u=V_(Wh,e.__scopeMenu),p=Mb(Wh,e.__scopeMenu);return G.jsx($1.Provider,{scope:e.__scopeMenu,children:G.jsx(pc,{present:r||u.open,children:G.jsx($1.Slot,{scope:e.__scopeMenu,children:p.modal?G.jsx(YW,{...a,ref:t}):G.jsx(KW,{...a,ref:t})})})})}),YW=Y.forwardRef((e,t)=>{const n=V_(Wh,e.__scopeMenu),r=Y.useRef(null),a=Xr(t,r);return Y.useEffect(()=>{const u=r.current;if(u)return EE(u)},[]),G.jsx(IM,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Dn(e.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),KW=Y.forwardRef((e,t)=>{const n=V_(Wh,e.__scopeMenu);return G.jsx(IM,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),JW=DW("MenuContent.ScrollLock"),IM=Y.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:u,onCloseAutoFocus:p,disableOutsidePointerEvents:i,onEntryFocus:b,onEscapeKeyDown:C,onPointerDownOutside:A,onFocusOutside:R,onInteractOutside:z,onDismiss:V,disableOutsideScroll:W,...X}=e,ue=V_(Wh,n),ie=Mb(Wh,n),K=Ib(n),ee=Ez(n),ae=$W(n),[he,xe]=Y.useState(null),ye=Y.useRef(null),Se=Xr(t,ye,ue.onContentChange),je=Y.useRef(0),Re=Y.useRef(""),De=Y.useRef(0),at=Y.useRef(null),ot=Y.useRef("right"),Fe=Y.useRef(0),Ze=W?yb:Y.Fragment,Ve=W?{as:JW,allowPinchZoom:!0}:void 0,mt=tt=>{var Ut,wn;const Dt=Re.current+tt,$e=ae().filter(Pn=>!Pn.disabled),Ke=document.activeElement,gt=(Ut=$e.find(Pn=>Pn.ref.current===Ke))==null?void 0:Ut.textValue,Yt=$e.map(Pn=>Pn.textValue),Kt=cX(Yt,Dt,gt),nn=(wn=$e.find(Pn=>Pn.textValue===Kt))==null?void 0:wn.ref.current;(function Pn(we){Re.current=we,window.clearTimeout(je.current),we!==""&&(je.current=window.setTimeout(()=>Pn(""),1e3))})(Dt),nn&&setTimeout(()=>nn.focus())};Y.useEffect(()=>()=>window.clearTimeout(je.current),[]),wE();const We=Y.useCallback(tt=>{var $e,Ke;return ot.current===(($e=at.current)==null?void 0:$e.side)&&dX(tt,(Ke=at.current)==null?void 0:Ke.area)},[]);return G.jsx(ZW,{scope:n,searchRef:Re,onItemEnter:Y.useCallback(tt=>{We(tt)&&tt.preventDefault()},[We]),onItemLeave:Y.useCallback(tt=>{var Dt;We(tt)||((Dt=ye.current)==null||Dt.focus(),xe(null))},[We]),onTriggerLeave:Y.useCallback(tt=>{We(tt)&&tt.preventDefault()},[We]),pointerGraceTimerRef:De,onPointerGraceIntentChange:Y.useCallback(tt=>{at.current=tt},[]),children:G.jsx(Ze,{...Ve,children:G.jsx(gb,{asChild:!0,trapped:a,onMountAutoFocus:Dn(u,tt=>{var Dt;tt.preventDefault(),(Dt=ye.current)==null||Dt.focus({preventScroll:!0})}),onUnmountAutoFocus:p,children:G.jsx(mb,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:C,onPointerDownOutside:A,onFocusOutside:R,onInteractOutside:z,onDismiss:V,children:G.jsx(LW,{asChild:!0,...ee,dir:ie.dir,orientation:"vertical",loop:r,currentTabStopId:he,onCurrentTabStopIdChange:xe,onEntryFocus:Dn(b,tt=>{ie.isUsingKeyboardRef.current||tt.preventDefault()}),preventScrollOnEntryFocus:!0,children:G.jsx(wM,{role:"menu","aria-orientation":"vertical","data-state":Hz(ue.open),"data-radix-menu-content":"",dir:ie.dir,...K,...X,ref:Se,style:{outline:"none",...X.style},onKeyDown:Dn(X.onKeyDown,tt=>{const $e=tt.target.closest("[data-radix-menu-content]")===tt.currentTarget,Ke=tt.ctrlKey||tt.altKey||tt.metaKey,gt=tt.key.length===1;$e&&(tt.key==="Tab"&&tt.preventDefault(),!Ke&&gt&&mt(tt.key));const Yt=ye.current;if(tt.target!==Yt||!VW.includes(tt.key))return;tt.preventDefault();const nn=ae().filter(Ut=>!Ut.disabled).map(Ut=>Ut.ref.current);wz.includes(tt.key)&&nn.reverse(),lX(nn)}),onBlur:Dn(e.onBlur,tt=>{tt.currentTarget.contains(tt.target)||(window.clearTimeout(je.current),Re.current="")}),onPointerMove:Dn(e.onPointerMove,q1(tt=>{const Dt=tt.target,$e=Fe.current!==tt.clientX;if(tt.currentTarget.contains(Dt)&&$e){const Ke=tt.clientX>Fe.current?"right":"left";ot.current=Ke,Fe.current=tt.clientX}}))})})})})})})});Pz.displayName=Wh;var QW="MenuGroup",MM=Y.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return G.jsx(Ir.div,{role:"group",...r,ref:t})});MM.displayName=QW;var eX="MenuLabel",Az=Y.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return G.jsx(Ir.div,{...r,ref:t})});Az.displayName=eX;var US="MenuItem",rD="menu.itemSelect",BE=Y.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...a}=e,u=Y.useRef(null),p=Mb(US,e.__scopeMenu),i=TM(US,e.__scopeMenu),b=Xr(t,u),C=Y.useRef(!1),A=()=>{const R=u.current;if(!n&&R){const z=new CustomEvent(rD,{bubbles:!0,cancelable:!0});R.addEventListener(rD,V=>r==null?void 0:r(V),{once:!0}),r3(R,z),z.defaultPrevented?C.current=!1:p.onClose()}};return G.jsx(Rz,{...a,ref:b,disabled:n,onClick:Dn(e.onClick,A),onPointerDown:R=>{var z;(z=e.onPointerDown)==null||z.call(e,R),C.current=!0},onPointerUp:Dn(e.onPointerUp,R=>{var z;C.current||(z=R.currentTarget)==null||z.click()}),onKeyDown:Dn(e.onKeyDown,R=>{const z=i.searchRef.current!=="";n||z&&R.key===" "||WI.includes(R.key)&&(R.currentTarget.click(),R.preventDefault())})})});BE.displayName=US;var Rz=Y.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:a,...u}=e,p=TM(US,n),i=Ez(n),b=Y.useRef(null),C=Xr(t,b),[A,R]=Y.useState(!1),[z,V]=Y.useState("");return Y.useEffect(()=>{const W=b.current;W&&V((W.textContent??"").trim())},[u.children]),G.jsx($1.ItemSlot,{scope:n,disabled:r,textValue:a??z,children:G.jsx(OW,{asChild:!0,...i,focusable:!r,children:G.jsx(Ir.div,{role:"menuitem","data-highlighted":A?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...u,ref:C,onPointerMove:Dn(e.onPointerMove,q1(W=>{r?p.onItemLeave(W):(p.onItemEnter(W),W.defaultPrevented||W.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Dn(e.onPointerLeave,q1(W=>p.onItemLeave(W))),onFocus:Dn(e.onFocus,()=>R(!0)),onBlur:Dn(e.onBlur,()=>R(!1))})})})}),tX="MenuCheckboxItem",Lz=Y.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...a}=e;return G.jsx(Fz,{scope:e.__scopeMenu,checked:n,children:G.jsx(BE,{role:"menuitemcheckbox","aria-checked":GS(n)?"mixed":n,...a,ref:t,"data-state":RM(n),onSelect:Dn(a.onSelect,()=>r==null?void 0:r(GS(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Lz.displayName=tX;var Oz="MenuRadioGroup",[nX,rX]=av(Oz,{value:void 0,onValueChange:()=>{}}),Dz=Y.forwardRef((e,t)=>{const{value:n,onValueChange:r,...a}=e,u=fd(r);return G.jsx(nX,{scope:e.__scopeMenu,value:n,onValueChange:u,children:G.jsx(MM,{...a,ref:t})})});Dz.displayName=Oz;var Nz="MenuRadioItem",kz=Y.forwardRef((e,t)=>{const{value:n,...r}=e,a=rX(Nz,e.__scopeMenu),u=n===a.value;return G.jsx(Fz,{scope:e.__scopeMenu,checked:u,children:G.jsx(BE,{role:"menuitemradio","aria-checked":u,...r,ref:t,"data-state":RM(u),onSelect:Dn(r.onSelect,()=>{var p;return(p=a.onValueChange)==null?void 0:p.call(a,n)},{checkForDefaultPrevented:!1})})})});kz.displayName=Nz;var PM="MenuItemIndicator",[Fz,iX]=av(PM,{checked:!1}),zz=Y.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...a}=e,u=iX(PM,n);return G.jsx(pc,{present:r||GS(u.checked)||u.checked===!0,children:G.jsx(Ir.span,{...a,ref:t,"data-state":RM(u.checked)})})});zz.displayName=PM;var oX="MenuSeparator",Bz=Y.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return G.jsx(Ir.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});Bz.displayName=oX;var sX="MenuArrow",jz=Y.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=Ib(n);return G.jsx(SM,{...a,...r,ref:t})});jz.displayName=sX;var AM="MenuSub",[aX,Vz]=av(AM),Uz=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:a}=e,u=V_(AM,t),p=Ib(t),[i,b]=Y.useState(null),[C,A]=Y.useState(null),R=fd(a);return Y.useEffect(()=>(u.open===!1&&R(!1),()=>R(!1)),[u.open,R]),G.jsx(FE,{...p,children:G.jsx(Cz,{scope:t,open:r,onOpenChange:R,content:C,onContentChange:A,children:G.jsx(aX,{scope:t,contentId:Ns(),triggerId:Ns(),trigger:i,onTriggerChange:b,children:n})})})};Uz.displayName=AM;var D1="MenuSubTrigger",Gz=Y.forwardRef((e,t)=>{const n=V_(D1,e.__scopeMenu),r=Mb(D1,e.__scopeMenu),a=Vz(D1,e.__scopeMenu),u=TM(D1,e.__scopeMenu),p=Y.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:b}=u,C={__scopeMenu:e.__scopeMenu},A=Y.useCallback(()=>{p.current&&window.clearTimeout(p.current),p.current=null},[]);return Y.useEffect(()=>A,[A]),Y.useEffect(()=>{const R=i.current;return()=>{window.clearTimeout(R),b(null)}},[i,b]),G.jsx(EM,{asChild:!0,...C,children:G.jsx(Rz,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":Hz(n.open),...e,ref:Tu(t,a.onTriggerChange),onClick:R=>{var z;(z=e.onClick)==null||z.call(e,R),!(e.disabled||R.defaultPrevented)&&(R.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Dn(e.onPointerMove,q1(R=>{u.onItemEnter(R),!R.defaultPrevented&&!e.disabled&&!n.open&&!p.current&&(u.onPointerGraceIntentChange(null),p.current=window.setTimeout(()=>{n.onOpenChange(!0),A()},100))})),onPointerLeave:Dn(e.onPointerLeave,q1(R=>{var V,W;A();const z=(V=n.content)==null?void 0:V.getBoundingClientRect();if(z){const X=(W=n.content)==null?void 0:W.dataset.side,ue=X==="right",ie=ue?-5:5,K=z[ue?"left":"right"],ee=z[ue?"right":"left"];u.onPointerGraceIntentChange({area:[{x:R.clientX+ie,y:R.clientY},{x:K,y:z.top},{x:ee,y:z.top},{x:ee,y:z.bottom},{x:K,y:z.bottom}],side:X}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>u.onPointerGraceIntentChange(null),300)}else{if(u.onTriggerLeave(R),R.defaultPrevented)return;u.onPointerGraceIntentChange(null)}})),onKeyDown:Dn(e.onKeyDown,R=>{var V;const z=u.searchRef.current!=="";e.disabled||z&&R.key===" "||UW[r.dir].includes(R.key)&&(n.onOpenChange(!0),(V=n.content)==null||V.focus(),R.preventDefault())})})})});Gz.displayName=D1;var $z="MenuSubContent",qz=Y.forwardRef((e,t)=>{const n=Iz(Wh,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,u=V_(Wh,e.__scopeMenu),p=Mb(Wh,e.__scopeMenu),i=Vz($z,e.__scopeMenu),b=Y.useRef(null),C=Xr(t,b);return G.jsx($1.Provider,{scope:e.__scopeMenu,children:G.jsx(pc,{present:r||u.open,children:G.jsx($1.Slot,{scope:e.__scopeMenu,children:G.jsx(IM,{id:i.contentId,"aria-labelledby":i.triggerId,...a,ref:C,align:"start",side:p.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:A=>{var R;p.isUsingKeyboardRef.current&&((R=b.current)==null||R.focus()),A.preventDefault()},onCloseAutoFocus:A=>A.preventDefault(),onFocusOutside:Dn(e.onFocusOutside,A=>{A.target!==i.trigger&&u.onOpenChange(!1)}),onEscapeKeyDown:Dn(e.onEscapeKeyDown,A=>{p.onClose(),A.preventDefault()}),onKeyDown:Dn(e.onKeyDown,A=>{var V;const R=A.currentTarget.contains(A.target),z=GW[p.dir].includes(A.key);R&&z&&(u.onOpenChange(!1),(V=i.trigger)==null||V.focus(),A.preventDefault())})})})})})});qz.displayName=$z;function Hz(e){return e?"open":"closed"}function GS(e){return e==="indeterminate"}function RM(e){return GS(e)?"indeterminate":e?"checked":"unchecked"}function lX(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function uX(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function cX(e,t,n){const a=t.length>1&&Array.from(t).every(C=>C===t[0])?t[0]:t,u=n?e.indexOf(n):-1;let p=uX(e,Math.max(u,0));a.length===1&&(p=p.filter(C=>C!==n));const b=p.find(C=>C.toLowerCase().startsWith(a.toLowerCase()));return b!==n?b:void 0}function hX(e,t){const{x:n,y:r}=e;let a=!1;for(let u=0,p=t.length-1;u<t.length;p=u++){const i=t[u],b=t[p],C=i.x,A=i.y,R=b.x,z=b.y;A>r!=z>r&&n<(R-C)*(r-A)/(z-A)+C&&(a=!a)}return a}function dX(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return hX(n,t)}function q1(e){return t=>t.pointerType==="mouse"?e(t):void 0}var fX=Tz,pX=EM,mX=Mz,gX=Pz,_X=MM,yX=Az,vX=BE,xX=Lz,bX=Dz,wX=kz,SX=zz,EX=Bz,CX=jz,TX=Uz,IX=Gz,MX=qz,jE="DropdownMenu",[PX,gae]=Zl(jE,[Sz]),Yl=Sz(),[AX,Wz]=PX(jE),Xz=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:a,defaultOpen:u,onOpenChange:p,modal:i=!0}=e,b=Yl(t),C=Y.useRef(null),[A,R]=Hc({prop:a,defaultProp:u??!1,onChange:p,caller:jE});return G.jsx(AX,{scope:t,triggerId:Ns(),triggerRef:C,contentId:Ns(),open:A,onOpenChange:R,onOpenToggle:Y.useCallback(()=>R(z=>!z),[R]),modal:i,children:G.jsx(fX,{...b,open:A,onOpenChange:R,dir:r,modal:i,children:n})})};Xz.displayName=jE;var Zz="DropdownMenuTrigger",Yz=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...a}=e,u=Wz(Zz,n),p=Yl(n);return G.jsx(pX,{asChild:!0,...p,children:G.jsx(Ir.button,{type:"button",id:u.triggerId,"aria-haspopup":"menu","aria-expanded":u.open,"aria-controls":u.open?u.contentId:void 0,"data-state":u.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:Tu(t,u.triggerRef),onPointerDown:Dn(e.onPointerDown,i=>{!r&&i.button===0&&i.ctrlKey===!1&&(u.onOpenToggle(),u.open||i.preventDefault())}),onKeyDown:Dn(e.onKeyDown,i=>{r||(["Enter"," "].includes(i.key)&&u.onOpenToggle(),i.key==="ArrowDown"&&u.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});Yz.displayName=Zz;var RX="DropdownMenuPortal",Kz=e=>{const{__scopeDropdownMenu:t,...n}=e,r=Yl(t);return G.jsx(mX,{...r,...n})};Kz.displayName=RX;var Jz="DropdownMenuContent",Qz=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Wz(Jz,n),u=Yl(n),p=Y.useRef(!1);return G.jsx(gX,{id:a.contentId,"aria-labelledby":a.triggerId,...u,...r,ref:t,onCloseAutoFocus:Dn(e.onCloseAutoFocus,i=>{var b;p.current||(b=a.triggerRef.current)==null||b.focus(),p.current=!1,i.preventDefault()}),onInteractOutside:Dn(e.onInteractOutside,i=>{const b=i.detail.originalEvent,C=b.button===0&&b.ctrlKey===!0,A=b.button===2||C;(!a.modal||A)&&(p.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Qz.displayName=Jz;var LX="DropdownMenuGroup",OX=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(_X,{...a,...r,ref:t})});OX.displayName=LX;var DX="DropdownMenuLabel",eB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(yX,{...a,...r,ref:t})});eB.displayName=DX;var NX="DropdownMenuItem",tB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(vX,{...a,...r,ref:t})});tB.displayName=NX;var kX="DropdownMenuCheckboxItem",nB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(xX,{...a,...r,ref:t})});nB.displayName=kX;var FX="DropdownMenuRadioGroup",zX=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(bX,{...a,...r,ref:t})});zX.displayName=FX;var BX="DropdownMenuRadioItem",rB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(wX,{...a,...r,ref:t})});rB.displayName=BX;var jX="DropdownMenuItemIndicator",iB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(SX,{...a,...r,ref:t})});iB.displayName=jX;var VX="DropdownMenuSeparator",oB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(EX,{...a,...r,ref:t})});oB.displayName=VX;var UX="DropdownMenuArrow",GX=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(CX,{...a,...r,ref:t})});GX.displayName=UX;var $X=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:a,defaultOpen:u}=e,p=Yl(t),[i,b]=Hc({prop:r,defaultProp:u??!1,onChange:a,caller:"DropdownMenuSub"});return G.jsx(TX,{...p,open:i,onOpenChange:b,children:n})},qX="DropdownMenuSubTrigger",sB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(IX,{...a,...r,ref:t})});sB.displayName=qX;var HX="DropdownMenuSubContent",aB=Y.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Yl(n);return G.jsx(MX,{...a,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});aB.displayName=HX;var WX=Xz,XX=Yz,ZX=Kz,lB=Qz,uB=eB,cB=tB,hB=nB,dB=rB,fB=iB,pB=oB,YX=$X,mB=sB,gB=aB;const _B=WX,yB=XX,KX=YX,vB=Y.forwardRef(({className:e,inset:t,children:n,...r},a)=>G.jsxs(mB,{ref:a,className:dn("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...r,children:[n,G.jsx(Bk,{className:"ml-auto"})]}));vB.displayName=mB.displayName;const xB=Y.forwardRef(({className:e,...t},n)=>G.jsx(gB,{ref:n,className:dn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));xB.displayName=gB.displayName;const LM=Y.forwardRef(({className:e,sideOffset:t=4,...n},r)=>G.jsx(ZX,{children:G.jsx(lB,{ref:r,sideOffset:t,className:dn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));LM.displayName=lB.displayName;const f0=Y.forwardRef(({className:e,inset:t,...n},r)=>G.jsx(cB,{ref:r,className:dn("relative flex cursor-pointer select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",e),...n}));f0.displayName=cB.displayName;const bB=Y.forwardRef(({className:e,children:t,checked:n,...r},a)=>G.jsxs(hB,{ref:a,className:dn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...r,children:[G.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:G.jsx(fB,{children:G.jsx(Sa,{className:"h-4 w-4"})})}),t]}));bB.displayName=hB.displayName;const JX=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsxs(dB,{ref:r,className:dn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[G.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:G.jsx(fB,{children:G.jsx(L8,{className:"h-2 w-2 fill-current"})})}),t]}));JX.displayName=dB.displayName;const QX=Y.forwardRef(({className:e,inset:t,...n},r)=>G.jsx(uB,{ref:r,className:dn("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));QX.displayName=uB.displayName;const eZ=Y.forwardRef(({className:e,...t},n)=>G.jsx(pB,{ref:n,className:dn("-mx-1 my-1 h-px bg-muted",e),...t}));eZ.displayName=pB.displayName;var tZ=Symbol("radix.slottable");function nZ(e){const t=({children:n})=>G.jsx(G.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=tZ,t}var wB="AlertDialog",[rZ,_ae]=Zl(wB,[w3]),hg=w3(),SB=e=>{const{__scopeAlertDialog:t,...n}=e,r=hg(t);return G.jsx(tM,{...r,...n,modal:!0})};SB.displayName=wB;var iZ="AlertDialogTrigger",oZ=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=hg(n);return G.jsx(OH,{...a,...r,ref:t})});oZ.displayName=iZ;var sZ="AlertDialogPortal",EB=e=>{const{__scopeAlertDialog:t,...n}=e,r=hg(t);return G.jsx(TE,{...r,...n})};EB.displayName=sZ;var aZ="AlertDialogOverlay",CB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=hg(n);return G.jsx(sx,{...a,...r,ref:t})});CB.displayName=aZ;var x0="AlertDialogContent",[lZ,uZ]=rZ(x0),cZ=nZ("AlertDialogContent"),TB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,children:r,...a}=e,u=hg(n),p=Y.useRef(null),i=Xr(t,p),b=Y.useRef(null);return G.jsx(PH,{contentName:x0,titleName:IB,docsSlug:"alert-dialog",children:G.jsx(lZ,{scope:n,cancelRef:b,children:G.jsxs(ax,{role:"alertdialog",...u,...a,ref:i,onOpenAutoFocus:Dn(a.onOpenAutoFocus,C=>{var A;C.preventDefault(),(A=b.current)==null||A.focus({preventScroll:!0})}),onPointerDownOutside:C=>C.preventDefault(),onInteractOutside:C=>C.preventDefault(),children:[G.jsx(cZ,{children:r}),G.jsx(dZ,{contentRef:p})]})})})});TB.displayName=x0;var IB="AlertDialogTitle",MB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=hg(n);return G.jsx(vb,{...a,...r,ref:t})});MB.displayName=IB;var PB="AlertDialogDescription",AB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=hg(n);return G.jsx(xb,{...a,...r,ref:t})});AB.displayName=PB;var hZ="AlertDialogAction",RB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=hg(n);return G.jsx(IE,{...a,...r,ref:t})});RB.displayName=hZ;var LB="AlertDialogCancel",OB=Y.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,{cancelRef:a}=uZ(LB,n),u=hg(n),p=Xr(t,a);return G.jsx(IE,{...u,...r,ref:p})});OB.displayName=LB;var dZ=({contentRef:e})=>{const t=`\`${x0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${x0}\` by passing a \`${PB}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${x0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return Y.useEffect(()=>{var r;document.getElementById((r=e.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},fZ=SB,pZ=EB,DB=CB,NB=TB,kB=RB,FB=OB,zB=MB,BB=AB;const Pb=fZ,mZ=pZ,OM=Y.forwardRef(({className:e,...t},n)=>G.jsx(DB,{className:dn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));OM.displayName=DB.displayName;const dx=Y.forwardRef(({className:e,...t},n)=>G.jsxs(mZ,{children:[G.jsx(OM,{}),G.jsx(NB,{ref:n,className:dn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));dx.displayName=NB.displayName;const fx=({className:e,...t})=>G.jsx("div",{className:dn("flex flex-col space-y-2 text-center sm:text-left",e),...t});fx.displayName="AlertDialogHeader";const px=({className:e,...t})=>G.jsx("div",{className:dn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});px.displayName="AlertDialogFooter";const mx=Y.forwardRef(({className:e,...t},n)=>G.jsx(zB,{ref:n,className:dn("text-lg font-semibold",e),...t}));mx.displayName=zB.displayName;const gx=Y.forwardRef(({className:e,...t},n)=>G.jsx(BB,{ref:n,className:dn("text-sm text-muted-foreground",e),...t}));gx.displayName=BB.displayName;const VE=Y.forwardRef(({className:e,...t},n)=>G.jsx(kB,{ref:n,className:dn(K2(),e),...t}));VE.displayName=kB.displayName;const _x=Y.forwardRef(({className:e,...t},n)=>G.jsx(FB,{ref:n,className:dn(K2({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));_x.displayName=FB.displayName;const DM=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("rounded-xl border bg-card text-card-foreground shadow",e),...t}));DM.displayName="Card";const NM=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("flex flex-col space-y-1.5 p-6",e),...t}));NM.displayName="CardHeader";const kM=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("font-semibold leading-none tracking-tight",e),...t}));kM.displayName="CardTitle";const jB=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("text-sm text-muted-foreground",e),...t}));jB.displayName="CardDescription";const FM=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("p-6 pt-0",e),...t}));FM.displayName="CardContent";const gZ=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{ref:n,className:dn("flex items-center p-6 pt-0",e),...t}));gZ.displayName="CardFooter";function $S(e,[t,n]){return Math.min(n,Math.max(t,e))}function zM(e){const t=Y.useRef({value:e,previous:e});return Y.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var VB=["PageUp","PageDown"],UB=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],GB={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},yx="Slider",[XI,_Z,yZ]=Sb(yx),[$B,yae]=Zl(yx,[yZ]),[vZ,UE]=$B(yx),qB=Y.forwardRef((e,t)=>{const{name:n,min:r=0,max:a=100,step:u=1,orientation:p="horizontal",disabled:i=!1,minStepsBetweenThumbs:b=0,defaultValue:C=[r],value:A,onValueChange:R=()=>{},onValueCommit:z=()=>{},inverted:V=!1,form:W,...X}=e,ue=Y.useRef(new Set),ie=Y.useRef(0),ee=p==="horizontal"?xZ:bZ,[ae=[],he]=Hc({prop:A,defaultProp:C,onChange:De=>{var ot;(ot=[...ue.current][ie.current])==null||ot.focus(),R(De)}}),xe=Y.useRef(ae);function ye(De){const at=TZ(ae,De);Re(De,at)}function Se(De){Re(De,ie.current)}function je(){const De=xe.current[ie.current];ae[ie.current]!==De&&z(ae)}function Re(De,at,{commit:ot}={commit:!1}){const Fe=AZ(u),Ze=RZ(Math.round((De-r)/u)*u+r,Fe),Ve=$S(Ze,[r,a]);he((mt=[])=>{const We=EZ(mt,Ve,at);if(PZ(We,b*u)){ie.current=We.indexOf(Ve);const tt=String(We)!==String(mt);return tt&&ot&&z(We),tt?We:mt}else return mt})}return G.jsx(vZ,{scope:e.__scopeSlider,name:n,disabled:i,min:r,max:a,valueIndexToChangeRef:ie,thumbs:ue.current,values:ae,orientation:p,form:W,children:G.jsx(XI.Provider,{scope:e.__scopeSlider,children:G.jsx(XI.Slot,{scope:e.__scopeSlider,children:G.jsx(ee,{"aria-disabled":i,"data-disabled":i?"":void 0,...X,ref:t,onPointerDown:Dn(X.onPointerDown,()=>{i||(xe.current=ae)}),min:r,max:a,inverted:V,onSlideStart:i?void 0:ye,onSlideMove:i?void 0:Se,onSlideEnd:i?void 0:je,onHomeKeyDown:()=>!i&&Re(r,0,{commit:!0}),onEndKeyDown:()=>!i&&Re(a,ae.length-1,{commit:!0}),onStepKeyDown:({event:De,direction:at})=>{if(!i){const Ze=VB.includes(De.key)||De.shiftKey&&UB.includes(De.key)?10:1,Ve=ie.current,mt=ae[Ve],We=u*Ze*at;Re(mt+We,Ve,{commit:!0})}}})})})})});qB.displayName=yx;var[HB,WB]=$B(yx,{startEdge:"left",endEdge:"right",size:"width",direction:1}),xZ=Y.forwardRef((e,t)=>{const{min:n,max:r,dir:a,inverted:u,onSlideStart:p,onSlideMove:i,onSlideEnd:b,onStepKeyDown:C,...A}=e,[R,z]=Y.useState(null),V=Xr(t,ee=>z(ee)),W=Y.useRef(void 0),X=Eb(a),ue=X==="ltr",ie=ue&&!u||!ue&&u;function K(ee){const ae=W.current||R.getBoundingClientRect(),he=[0,ae.width],ye=BM(he,ie?[n,r]:[r,n]);return W.current=ae,ye(ee-ae.left)}return G.jsx(HB,{scope:e.__scopeSlider,startEdge:ie?"left":"right",endEdge:ie?"right":"left",direction:ie?1:-1,size:"width",children:G.jsx(XB,{dir:X,"data-orientation":"horizontal",...A,ref:V,style:{...A.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:ee=>{const ae=K(ee.clientX);p==null||p(ae)},onSlideMove:ee=>{const ae=K(ee.clientX);i==null||i(ae)},onSlideEnd:()=>{W.current=void 0,b==null||b()},onStepKeyDown:ee=>{const he=GB[ie?"from-left":"from-right"].includes(ee.key);C==null||C({event:ee,direction:he?-1:1})}})})}),bZ=Y.forwardRef((e,t)=>{const{min:n,max:r,inverted:a,onSlideStart:u,onSlideMove:p,onSlideEnd:i,onStepKeyDown:b,...C}=e,A=Y.useRef(null),R=Xr(t,A),z=Y.useRef(void 0),V=!a;function W(X){const ue=z.current||A.current.getBoundingClientRect(),ie=[0,ue.height],ee=BM(ie,V?[r,n]:[n,r]);return z.current=ue,ee(X-ue.top)}return G.jsx(HB,{scope:e.__scopeSlider,startEdge:V?"bottom":"top",endEdge:V?"top":"bottom",size:"height",direction:V?1:-1,children:G.jsx(XB,{"data-orientation":"vertical",...C,ref:R,style:{...C.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:X=>{const ue=W(X.clientY);u==null||u(ue)},onSlideMove:X=>{const ue=W(X.clientY);p==null||p(ue)},onSlideEnd:()=>{z.current=void 0,i==null||i()},onStepKeyDown:X=>{const ie=GB[V?"from-bottom":"from-top"].includes(X.key);b==null||b({event:X,direction:ie?-1:1})}})})}),XB=Y.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:a,onSlideEnd:u,onHomeKeyDown:p,onEndKeyDown:i,onStepKeyDown:b,...C}=e,A=UE(yx,n);return G.jsx(Ir.span,{...C,ref:t,onKeyDown:Dn(e.onKeyDown,R=>{R.key==="Home"?(p(R),R.preventDefault()):R.key==="End"?(i(R),R.preventDefault()):VB.concat(UB).includes(R.key)&&(b(R),R.preventDefault())}),onPointerDown:Dn(e.onPointerDown,R=>{const z=R.target;z.setPointerCapture(R.pointerId),R.preventDefault(),A.thumbs.has(z)?z.focus():r(R)}),onPointerMove:Dn(e.onPointerMove,R=>{R.target.hasPointerCapture(R.pointerId)&&a(R)}),onPointerUp:Dn(e.onPointerUp,R=>{const z=R.target;z.hasPointerCapture(R.pointerId)&&(z.releasePointerCapture(R.pointerId),u(R))})})}),ZB="SliderTrack",YB=Y.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,a=UE(ZB,n);return G.jsx(Ir.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...r,ref:t})});YB.displayName=ZB;var ZI="SliderRange",KB=Y.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,a=UE(ZI,n),u=WB(ZI,n),p=Y.useRef(null),i=Xr(t,p),b=a.values.length,C=a.values.map(z=>e4(z,a.min,a.max)),A=b>1?Math.min(...C):0,R=100-Math.max(...C);return G.jsx(Ir.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...r,ref:i,style:{...e.style,[u.startEdge]:A+"%",[u.endEdge]:R+"%"}})});KB.displayName=ZI;var YI="SliderThumb",JB=Y.forwardRef((e,t)=>{const n=_Z(e.__scopeSlider),[r,a]=Y.useState(null),u=Xr(t,i=>a(i)),p=Y.useMemo(()=>r?n().findIndex(i=>i.ref.current===r):-1,[n,r]);return G.jsx(wZ,{...e,ref:u,index:p})}),wZ=Y.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:a,...u}=e,p=UE(YI,n),i=WB(YI,n),[b,C]=Y.useState(null),A=Xr(t,K=>C(K)),R=b?p.form||!!b.closest("form"):!0,z=RE(b),V=p.values[r],W=V===void 0?0:e4(V,p.min,p.max),X=CZ(r,p.values.length),ue=z==null?void 0:z[i.size],ie=ue?IZ(ue,W,i.direction):0;return Y.useEffect(()=>{if(b)return p.thumbs.add(b),()=>{p.thumbs.delete(b)}},[b,p.thumbs]),G.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${W}% + ${ie}px)`},children:[G.jsx(XI.ItemSlot,{scope:e.__scopeSlider,children:G.jsx(Ir.span,{role:"slider","aria-label":e["aria-label"]||X,"aria-valuemin":p.min,"aria-valuenow":V,"aria-valuemax":p.max,"aria-orientation":p.orientation,"data-orientation":p.orientation,"data-disabled":p.disabled?"":void 0,tabIndex:p.disabled?void 0:0,...u,ref:A,style:V===void 0?{display:"none"}:e.style,onFocus:Dn(e.onFocus,()=>{p.valueIndexToChangeRef.current=r})})}),R&&G.jsx(QB,{name:a??(p.name?p.name+(p.values.length>1?"[]":""):void 0),form:p.form,value:V},r)]})});JB.displayName=YI;var SZ="RadioBubbleInput",QB=Y.forwardRef(({__scopeSlider:e,value:t,...n},r)=>{const a=Y.useRef(null),u=Xr(a,r),p=zM(t);return Y.useEffect(()=>{const i=a.current;if(!i)return;const b=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(b,"value").set;if(p!==t&&A){const R=new Event("input",{bubbles:!0});A.call(i,t),i.dispatchEvent(R)}},[p,t]),G.jsx(Ir.input,{style:{display:"none"},...n,ref:u,defaultValue:t})});QB.displayName=SZ;function EZ(e=[],t,n){const r=[...e];return r[n]=t,r.sort((a,u)=>a-u)}function e4(e,t,n){const u=100/(n-t)*(e-t);return $S(u,[0,100])}function CZ(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function TZ(e,t){if(e.length===1)return 0;const n=e.map(a=>Math.abs(a-t)),r=Math.min(...n);return n.indexOf(r)}function IZ(e,t,n){const r=e/2,u=BM([0,50],[0,r]);return(r-u(t)*n)*n}function MZ(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function PZ(e,t){if(t>0){const n=MZ(e);return Math.min(...n)>=t}return!0}function BM(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function AZ(e){return(String(e).split(".")[1]||"").length}function RZ(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var t4=qB,LZ=YB,OZ=KB,DZ=JB;const n4=Y.forwardRef(({className:e,...t},n)=>G.jsxs(t4,{ref:n,className:dn("relative flex w-full touch-none select-none items-center",e),...t,children:[G.jsx(LZ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:G.jsx(OZ,{className:"absolute h-full bg-primary"})}),G.jsx(DZ,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));n4.displayName=t4.displayName;function jp({layerName:e,onNameChange:t,fillColor:n,onFillColorChange:r,fillOpacity:a,onFillOpacityChange:u}){return G.jsxs(DM,{className:"",children:[G.jsx(NM,{children:G.jsx(kM,{children:"Layer Settings"})}),G.jsxs(FM,{children:[G.jsxs("div",{className:"flex flex-row w-full justify-between",children:[G.jsxs("div",{className:"flex flex-col",children:[G.jsx("label",{htmlFor:"layerName",className:"mb-1 text-sm font-medium text-gray-700",children:"Layer Name"}),G.jsx(E0,{id:"layerName",type:"text",placeholder:"Enter layer name",value:e,onChange:p=>t(p.target.value),className:"hover:border-gray-300"})]}),G.jsxs("div",{className:"flex flex-col",children:[G.jsx("label",{htmlFor:"fillColor",className:"mb-1 text-sm font-medium text-gray-700",children:"Fill Color"}),G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(E0,{type:"text",value:n,onChange:p=>r(p.target.value),className:"max-w-[6rem] hover:border-gray-300"}),G.jsx("input",{id:"fillColor",type:"color",value:n,onChange:p=>r(p.target.value),className:"h-8 w-8 rounded border cursor-pointer border-gray-300 hover:scale-110 transition-all duration-200"})]})]})]}),G.jsxs("div",{className:"flex w-full flex-col pt-5 pb-5",children:[G.jsxs("label",{htmlFor:"fillOpacity",className:"mb-1 text-sm font-medium text-gray-700",children:["Opacity: ",Math.floor(a*100),"%"]}),G.jsx(n4,{value:[a*100],onValueChange:p=>u(p[0]/100),min:0,max:100,step:1,className:"w-full"})]})]})]})}function NZ(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const kZ=e=>{switch(e){case"success":return BZ;case"info":return VZ;case"warning":return jZ;case"error":return UZ;default:return null}},FZ=Array(12).fill(0),zZ=({visible:e,className:t})=>Zt.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Zt.createElement("div",{className:"sonner-spinner"},FZ.map((n,r)=>Zt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),BZ=Zt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Zt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),jZ=Zt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Zt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),VZ=Zt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Zt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),UZ=Zt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Zt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),GZ=Zt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Zt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Zt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),$Z=()=>{const[e,t]=Zt.useState(document.hidden);return Zt.useEffect(()=>{const n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e};let KI=1;class qZ{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const n=this.subscribers.indexOf(t);this.subscribers.splice(n,1)}),this.publish=t=>{this.subscribers.forEach(n=>n(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var n;const{message:r,...a}=t,u=typeof(t==null?void 0:t.id)=="number"||((n=t.id)==null?void 0:n.length)>0?t.id:KI++,p=this.toasts.find(b=>b.id===u),i=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),p?this.toasts=this.toasts.map(b=>b.id===u?(this.publish({...b,...t,id:u,title:r}),{...b,...t,id:u,dismissible:i,title:r}):b):this.addToast({title:r,...a,dismissible:i,id:u}),u},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(n=>n({id:t,dismiss:!0})))):this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),t),this.message=(t,n)=>this.create({...n,message:t}),this.error=(t,n)=>this.create({...n,message:t,type:"error"}),this.success=(t,n)=>this.create({...n,type:"success",message:t}),this.info=(t,n)=>this.create({...n,type:"info",message:t}),this.warning=(t,n)=>this.create({...n,type:"warning",message:t}),this.loading=(t,n)=>this.create({...n,type:"loading",message:t}),this.promise=(t,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:t,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));const a=Promise.resolve(t instanceof Function?t():t);let u=r!==void 0,p;const i=a.then(async C=>{if(p=["resolve",C],Zt.isValidElement(C))u=!1,this.create({id:r,type:"default",message:C});else if(WZ(C)&&!C.ok){u=!1;const R=typeof n.error=="function"?await n.error(`HTTP error! status: ${C.status}`):n.error,z=typeof n.description=="function"?await n.description(`HTTP error! status: ${C.status}`):n.description,W=typeof R=="object"&&!Zt.isValidElement(R)?R:{message:R};this.create({id:r,type:"error",description:z,...W})}else if(C instanceof Error){u=!1;const R=typeof n.error=="function"?await n.error(C):n.error,z=typeof n.description=="function"?await n.description(C):n.description,W=typeof R=="object"&&!Zt.isValidElement(R)?R:{message:R};this.create({id:r,type:"error",description:z,...W})}else if(n.success!==void 0){u=!1;const R=typeof n.success=="function"?await n.success(C):n.success,z=typeof n.description=="function"?await n.description(C):n.description,W=typeof R=="object"&&!Zt.isValidElement(R)?R:{message:R};this.create({id:r,type:"success",description:z,...W})}}).catch(async C=>{if(p=["reject",C],n.error!==void 0){u=!1;const A=typeof n.error=="function"?await n.error(C):n.error,R=typeof n.description=="function"?await n.description(C):n.description,V=typeof A=="object"&&!Zt.isValidElement(A)?A:{message:A};this.create({id:r,type:"error",description:R,...V})}}).finally(()=>{u&&(this.dismiss(r),r=void 0),n.finally==null||n.finally.call(n)}),b=()=>new Promise((C,A)=>i.then(()=>p[0]==="reject"?A(p[1]):C(p[1])).catch(A));return typeof r!="string"&&typeof r!="number"?{unwrap:b}:Object.assign(r,{unwrap:b})},this.custom=(t,n)=>{const r=(n==null?void 0:n.id)||KI++;return this.create({jsx:t(r),id:r,...n}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const oc=new qZ,HZ=(e,t)=>{const n=(t==null?void 0:t.id)||KI++;return oc.addToast({title:e,...t,id:n}),n},WZ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",XZ=HZ,ZZ=()=>oc.toasts,YZ=()=>oc.getActiveToasts(),KZ=Object.assign(XZ,{success:oc.success,info:oc.info,warning:oc.warning,error:oc.error,custom:oc.custom,message:oc.message,promise:oc.promise,dismiss:oc.dismiss,loading:oc.loading},{getHistory:ZZ,getToasts:YZ});NZ("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function eS(e){return e.label!==void 0}const JZ=3,QZ="24px",eY="16px",iD=4e3,tY=356,nY=14,rY=45,iY=200;function fp(...e){return e.filter(Boolean).join(" ")}function oY(e){const[t,n]=e.split("-"),r=[];return t&&r.push(t),n&&r.push(n),r}const sY=e=>{var t,n,r,a,u,p,i,b,C;const{invert:A,toast:R,unstyled:z,interacting:V,setHeights:W,visibleToasts:X,heights:ue,index:ie,toasts:K,expanded:ee,removeToast:ae,defaultRichColors:he,closeButton:xe,style:ye,cancelButtonStyle:Se,actionButtonStyle:je,className:Re="",descriptionClassName:De="",duration:at,position:ot,gap:Fe,expandByDefault:Ze,classNames:Ve,icons:mt,closeButtonAriaLabel:We="Close toast"}=e,[tt,Dt]=Zt.useState(null),[$e,Ke]=Zt.useState(null),[gt,Yt]=Zt.useState(!1),[Kt,nn]=Zt.useState(!1),[Ut,wn]=Zt.useState(!1),[Pn,we]=Zt.useState(!1),[Rr,Mr]=Zt.useState(!1),[yi,Gt]=Zt.useState(0),[Io,qi]=Zt.useState(0),Ji=Zt.useRef(R.duration||at||iD),cr=Zt.useRef(null),Yr=Zt.useRef(null),Bs=ie===0,Ia=ie+1<=X,so=R.type,Ma=R.dismissible!==!1,er=R.className||"",_s=R.descriptionClassName||"",Pa=Zt.useMemo(()=>ue.findIndex(Lr=>Lr.toastId===R.id)||0,[ue,R.id]),Kl=Zt.useMemo(()=>{var Lr;return(Lr=R.closeButton)!=null?Lr:xe},[R.closeButton,xe]),Mo=Zt.useMemo(()=>R.duration||at||iD,[R.duration,at]),Aa=Zt.useRef(0),jo=Zt.useRef(0),xl=Zt.useRef(0),bl=Zt.useRef(null),[Du,Nu]=ot.split("-"),js=Zt.useMemo(()=>ue.reduce((Lr,fo,Ao)=>Ao>=Pa?Lr:Lr+fo.height,0),[ue,Pa]),Jl=$Z(),vi=R.invert||A,Hr=so==="loading";jo.current=Zt.useMemo(()=>Pa*Fe+js,[Pa,js]),Zt.useEffect(()=>{Ji.current=Mo},[Mo]),Zt.useEffect(()=>{Yt(!0)},[]),Zt.useEffect(()=>{const Lr=Yr.current;if(Lr){const fo=Lr.getBoundingClientRect().height;return qi(fo),W(Ao=>[{toastId:R.id,height:fo,position:R.position},...Ao]),()=>W(Ao=>Ao.filter(Xo=>Xo.toastId!==R.id))}},[W,R.id]),Zt.useLayoutEffect(()=>{if(!gt)return;const Lr=Yr.current,fo=Lr.style.height;Lr.style.height="auto";const Ao=Lr.getBoundingClientRect().height;Lr.style.height=fo,qi(Ao),W(Xo=>Xo.find(ge=>ge.toastId===R.id)?Xo.map(ge=>ge.toastId===R.id?{...ge,height:Ao}:ge):[{toastId:R.id,height:Ao,position:R.position},...Xo])},[gt,R.title,R.description,W,R.id]);const Vs=Zt.useCallback(()=>{nn(!0),Gt(jo.current),W(Lr=>Lr.filter(fo=>fo.toastId!==R.id)),setTimeout(()=>{ae(R)},iY)},[R,ae,W,jo]);Zt.useEffect(()=>{if(R.promise&&so==="loading"||R.duration===1/0||R.type==="loading")return;let Lr;return ee||V||Jl?(()=>{if(xl.current<Aa.current){const Xo=new Date().getTime()-Aa.current;Ji.current=Ji.current-Xo}xl.current=new Date().getTime()})():(()=>{Ji.current!==1/0&&(Aa.current=new Date().getTime(),Lr=setTimeout(()=>{R.onAutoClose==null||R.onAutoClose.call(R,R),Vs()},Ji.current))})(),()=>clearTimeout(Lr)},[ee,V,R,so,Jl,Vs]),Zt.useEffect(()=>{R.delete&&Vs()},[Vs,R.delete]);function ku(){var Lr;if(mt!=null&&mt.loading){var fo;return Zt.createElement("div",{className:fp(Ve==null?void 0:Ve.loader,R==null||(fo=R.classNames)==null?void 0:fo.loader,"sonner-loader"),"data-visible":so==="loading"},mt.loading)}return Zt.createElement(zZ,{className:fp(Ve==null?void 0:Ve.loader,R==null||(Lr=R.classNames)==null?void 0:Lr.loader),visible:so==="loading"})}const Po=R.icon||(mt==null?void 0:mt[so])||kZ(so);var sa,yc;return Zt.createElement("li",{tabIndex:0,ref:Yr,className:fp(Re,er,Ve==null?void 0:Ve.toast,R==null||(t=R.classNames)==null?void 0:t.toast,Ve==null?void 0:Ve.default,Ve==null?void 0:Ve[so],R==null||(n=R.classNames)==null?void 0:n[so]),"data-sonner-toast":"","data-rich-colors":(sa=R.richColors)!=null?sa:he,"data-styled":!(R.jsx||R.unstyled||z),"data-mounted":gt,"data-promise":!!R.promise,"data-swiped":Rr,"data-removed":Kt,"data-visible":Ia,"data-y-position":Du,"data-x-position":Nu,"data-index":ie,"data-front":Bs,"data-swiping":Ut,"data-dismissible":Ma,"data-type":so,"data-invert":vi,"data-swipe-out":Pn,"data-swipe-direction":$e,"data-expanded":!!(ee||Ze&&gt),style:{"--index":ie,"--toasts-before":ie,"--z-index":K.length-ie,"--offset":`${Kt?yi:jo.current}px`,"--initial-height":Ze?"auto":`${Io}px`,...ye,...R.style},onDragEnd:()=>{wn(!1),Dt(null),bl.current=null},onPointerDown:Lr=>{Hr||!Ma||(cr.current=new Date,Gt(jo.current),Lr.target.setPointerCapture(Lr.pointerId),Lr.target.tagName!=="BUTTON"&&(wn(!0),bl.current={x:Lr.clientX,y:Lr.clientY}))},onPointerUp:()=>{var Lr,fo,Ao;if(Pn||!Ma)return;bl.current=null;const Xo=Number(((Lr=Yr.current)==null?void 0:Lr.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),wt=Number(((fo=Yr.current)==null?void 0:fo.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ge=new Date().getTime()-((Ao=cr.current)==null?void 0:Ao.getTime()),be=tt==="x"?Xo:wt,ke=Math.abs(be)/ge;if(Math.abs(be)>=rY||ke>.11){Gt(jo.current),R.onDismiss==null||R.onDismiss.call(R,R),Ke(tt==="x"?Xo>0?"right":"left":wt>0?"down":"up"),Vs(),we(!0);return}else{var qe,Xe;(qe=Yr.current)==null||qe.style.setProperty("--swipe-amount-x","0px"),(Xe=Yr.current)==null||Xe.style.setProperty("--swipe-amount-y","0px")}Mr(!1),wn(!1),Dt(null)},onPointerMove:Lr=>{var fo,Ao,Xo;if(!bl.current||!Ma||((fo=window.getSelection())==null?void 0:fo.toString().length)>0)return;const ge=Lr.clientY-bl.current.y,be=Lr.clientX-bl.current.x;var ke;const qe=(ke=e.swipeDirections)!=null?ke:oY(ot);!tt&&(Math.abs(be)>1||Math.abs(ge)>1)&&Dt(Math.abs(be)>Math.abs(ge)?"x":"y");let Xe={x:0,y:0};const et=_t=>1/(1.5+Math.abs(_t)/20);if(tt==="y"){if(qe.includes("top")||qe.includes("bottom"))if(qe.includes("top")&&ge<0||qe.includes("bottom")&&ge>0)Xe.y=ge;else{const _t=ge*et(ge);Xe.y=Math.abs(_t)<Math.abs(ge)?_t:ge}}else if(tt==="x"&&(qe.includes("left")||qe.includes("right")))if(qe.includes("left")&&be<0||qe.includes("right")&&be>0)Xe.x=be;else{const _t=be*et(be);Xe.x=Math.abs(_t)<Math.abs(be)?_t:be}(Math.abs(Xe.x)>0||Math.abs(Xe.y)>0)&&Mr(!0),(Ao=Yr.current)==null||Ao.style.setProperty("--swipe-amount-x",`${Xe.x}px`),(Xo=Yr.current)==null||Xo.style.setProperty("--swipe-amount-y",`${Xe.y}px`)}},Kl&&!R.jsx&&so!=="loading"?Zt.createElement("button",{"aria-label":We,"data-disabled":Hr,"data-close-button":!0,onClick:Hr||!Ma?()=>{}:()=>{Vs(),R.onDismiss==null||R.onDismiss.call(R,R)},className:fp(Ve==null?void 0:Ve.closeButton,R==null||(r=R.classNames)==null?void 0:r.closeButton)},(yc=mt==null?void 0:mt.close)!=null?yc:GZ):null,(so||R.icon||R.promise)&&R.icon!==null&&((mt==null?void 0:mt[so])!==null||R.icon)?Zt.createElement("div",{"data-icon":"",className:fp(Ve==null?void 0:Ve.icon,R==null||(a=R.classNames)==null?void 0:a.icon)},R.promise||R.type==="loading"&&!R.icon?R.icon||ku():null,R.type!=="loading"?Po:null):null,Zt.createElement("div",{"data-content":"",className:fp(Ve==null?void 0:Ve.content,R==null||(u=R.classNames)==null?void 0:u.content)},Zt.createElement("div",{"data-title":"",className:fp(Ve==null?void 0:Ve.title,R==null||(p=R.classNames)==null?void 0:p.title)},R.jsx?R.jsx:typeof R.title=="function"?R.title():R.title),R.description?Zt.createElement("div",{"data-description":"",className:fp(De,_s,Ve==null?void 0:Ve.description,R==null||(i=R.classNames)==null?void 0:i.description)},typeof R.description=="function"?R.description():R.description):null),Zt.isValidElement(R.cancel)?R.cancel:R.cancel&&eS(R.cancel)?Zt.createElement("button",{"data-button":!0,"data-cancel":!0,style:R.cancelButtonStyle||Se,onClick:Lr=>{eS(R.cancel)&&Ma&&(R.cancel.onClick==null||R.cancel.onClick.call(R.cancel,Lr),Vs())},className:fp(Ve==null?void 0:Ve.cancelButton,R==null||(b=R.classNames)==null?void 0:b.cancelButton)},R.cancel.label):null,Zt.isValidElement(R.action)?R.action:R.action&&eS(R.action)?Zt.createElement("button",{"data-button":!0,"data-action":!0,style:R.actionButtonStyle||je,onClick:Lr=>{eS(R.action)&&(R.action.onClick==null||R.action.onClick.call(R.action,Lr),!Lr.defaultPrevented&&Vs())},className:fp(Ve==null?void 0:Ve.actionButton,R==null||(C=R.classNames)==null?void 0:C.actionButton)},R.action.label):null)};function oD(){if(typeof window>"u"||typeof document>"u")return"ltr";const e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function aY(e,t){const n={};return[e,t].forEach((r,a)=>{const u=a===1,p=u?"--mobile-offset":"--offset",i=u?eY:QZ;function b(C){["top","right","bottom","left"].forEach(A=>{n[`${p}-${A}`]=typeof C=="number"?`${C}px`:C})}typeof r=="number"||typeof r=="string"?b(r):typeof r=="object"?["top","right","bottom","left"].forEach(C=>{r[C]===void 0?n[`${p}-${C}`]=i:n[`${p}-${C}`]=typeof r[C]=="number"?`${r[C]}px`:r[C]}):b(i)}),n}const lY=Zt.forwardRef(function(t,n){const{invert:r,position:a="bottom-right",hotkey:u=["altKey","KeyT"],expand:p,closeButton:i,className:b,offset:C,mobileOffset:A,theme:R="light",richColors:z,duration:V,style:W,visibleToasts:X=JZ,toastOptions:ue,dir:ie=oD(),gap:K=nY,icons:ee,containerAriaLabel:ae="Notifications"}=t,[he,xe]=Zt.useState([]),ye=Zt.useMemo(()=>Array.from(new Set([a].concat(he.filter($e=>$e.position).map($e=>$e.position)))),[he,a]),[Se,je]=Zt.useState([]),[Re,De]=Zt.useState(!1),[at,ot]=Zt.useState(!1),[Fe,Ze]=Zt.useState(R!=="system"?R:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ve=Zt.useRef(null),mt=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),We=Zt.useRef(null),tt=Zt.useRef(!1),Dt=Zt.useCallback($e=>{xe(Ke=>{var gt;return(gt=Ke.find(Yt=>Yt.id===$e.id))!=null&&gt.delete||oc.dismiss($e.id),Ke.filter(({id:Yt})=>Yt!==$e.id)})},[]);return Zt.useEffect(()=>oc.subscribe($e=>{if($e.dismiss){requestAnimationFrame(()=>{xe(Ke=>Ke.map(gt=>gt.id===$e.id?{...gt,delete:!0}:gt))});return}setTimeout(()=>{jy.flushSync(()=>{xe(Ke=>{const gt=Ke.findIndex(Yt=>Yt.id===$e.id);return gt!==-1?[...Ke.slice(0,gt),{...Ke[gt],...$e},...Ke.slice(gt+1)]:[$e,...Ke]})})})}),[he]),Zt.useEffect(()=>{if(R!=="system"){Ze(R);return}if(R==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Ze("dark"):Ze("light")),typeof window>"u")return;const $e=window.matchMedia("(prefers-color-scheme: dark)");try{$e.addEventListener("change",({matches:Ke})=>{Ze(Ke?"dark":"light")})}catch{$e.addListener(({matches:gt})=>{try{Ze(gt?"dark":"light")}catch(Yt){console.error(Yt)}})}},[R]),Zt.useEffect(()=>{he.length<=1&&De(!1)},[he]),Zt.useEffect(()=>{const $e=Ke=>{var gt;if(u.every(nn=>Ke[nn]||Ke.code===nn)){var Kt;De(!0),(Kt=Ve.current)==null||Kt.focus()}Ke.code==="Escape"&&(document.activeElement===Ve.current||(gt=Ve.current)!=null&&gt.contains(document.activeElement))&&De(!1)};return document.addEventListener("keydown",$e),()=>document.removeEventListener("keydown",$e)},[u]),Zt.useEffect(()=>{if(Ve.current)return()=>{We.current&&(We.current.focus({preventScroll:!0}),We.current=null,tt.current=!1)}},[Ve.current]),Zt.createElement("section",{ref:n,"aria-label":`${ae} ${mt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ye.map(($e,Ke)=>{var gt;const[Yt,Kt]=$e.split("-");return he.length?Zt.createElement("ol",{key:$e,dir:ie==="auto"?oD():ie,tabIndex:-1,ref:Ve,className:b,"data-sonner-toaster":!0,"data-sonner-theme":Fe,"data-y-position":Yt,"data-lifted":Re&&he.length>1&&!p,"data-x-position":Kt,style:{"--front-toast-height":`${((gt=Se[0])==null?void 0:gt.height)||0}px`,"--width":`${tY}px`,"--gap":`${K}px`,...W,...aY(C,A)},onBlur:nn=>{tt.current&&!nn.currentTarget.contains(nn.relatedTarget)&&(tt.current=!1,We.current&&(We.current.focus({preventScroll:!0}),We.current=null))},onFocus:nn=>{nn.target instanceof HTMLElement&&nn.target.dataset.dismissible==="false"||tt.current||(tt.current=!0,We.current=nn.relatedTarget)},onMouseEnter:()=>De(!0),onMouseMove:()=>De(!0),onMouseLeave:()=>{at||De(!1)},onDragEnd:()=>De(!1),onPointerDown:nn=>{nn.target instanceof HTMLElement&&nn.target.dataset.dismissible==="false"||ot(!0)},onPointerUp:()=>ot(!1)},he.filter(nn=>!nn.position&&Ke===0||nn.position===$e).map((nn,Ut)=>{var wn,Pn;return Zt.createElement(sY,{key:nn.id,icons:ee,index:Ut,toast:nn,defaultRichColors:z,duration:(wn=ue==null?void 0:ue.duration)!=null?wn:V,className:ue==null?void 0:ue.className,descriptionClassName:ue==null?void 0:ue.descriptionClassName,invert:r,visibleToasts:X,closeButton:(Pn=ue==null?void 0:ue.closeButton)!=null?Pn:i,interacting:at,position:$e,style:ue==null?void 0:ue.style,unstyled:ue==null?void 0:ue.unstyled,classNames:ue==null?void 0:ue.classNames,cancelButtonStyle:ue==null?void 0:ue.cancelButtonStyle,actionButtonStyle:ue==null?void 0:ue.actionButtonStyle,closeButtonAriaLabel:ue==null?void 0:ue.closeButtonAriaLabel,removeToast:Dt,toasts:he.filter(we=>we.position==nn.position),heights:Se.filter(we=>we.position==nn.position),setHeights:je,expandByDefault:p,gap:K,expanded:Re,swipeDirections:t.swipeDirections})})):null}))});function C_({title:e,description:t,duration:n=2e3,position:r="top-center",icon:a,backgroundColor:u="#a5c7db",textColor:p="#000"}){KZ(e,{description:t,duration:n,position:r,icon:a?G.jsx(a,{className:"h-4 w-4"}):void 0,style:{background:u,color:p}})}function uY({open:e,onOpenChange:t,layer:n}){if(!n)return null;const[r,a]=Y.useState(n.name),[u,p]=Y.useState(n.fillColor),[i,b]=Y.useState(n.fillOpacity),{updateLayer:C}=wo();return G.jsxs(G.Fragment,{children:[G.jsx("div",{className:"z-[100] absolute top-0 right-0 display-none"}),G.jsx(Pb,{open:e,onOpenChange:t,children:G.jsxs(dx,{className:"z-[100] bg-[#a5c7db] sm:rounded-2xl border-0",children:[G.jsxs(fx,{children:[G.jsx(mx,{}),G.jsx(gx,{})]}),G.jsx(jp,{layerName:r,onNameChange:a,fillColor:u,onFillColorChange:p,fillOpacity:i,onFillOpacityChange:b}),G.jsxs(px,{children:[G.jsx(_x,{children:"Cancel"}),G.jsx(VE,{className:"rounded-xl",onClick:async()=>{C(n.id,{...n,name:r,fillColor:u,fillOpacity:i,geometryType:n.geometryType}),t(!1),C_({title:"Layer updated",description:"Layer updated successfully",icon:X8})},children:"Save"})]})]})})]})}function cY(){const e=qh(r=>r.updateMapStyle),t=qh(r=>r.currentStyle),n=r=>r.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,a=>a.toUpperCase());return G.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-6",children:Object.keys(DS).map(r=>r!=="Blank"?G.jsxs("div",{onClick:()=>e(r),className:`
              relative aspect-square w-full overflow-hidden rounded-2xl border-4
              cursor-pointer transition-transform duration-200 ease-in-out
              hover:scale-105
              ${t===r?"border-secondary":"border-primary"}
            `,children:[G.jsx("img",{src:Cp(`/mapStyles/${r}.png`),alt:r,className:"w-full h-full object-cover"}),G.jsx("span",{className:"absolute bottom-0 left-0 w-full bg-black/60 text-white text-xs sm:text-sm text-center py-1 capitalize",children:n(r)})]},r):null)})}function r4({open:e,onOpenChange:t,onSave:n}){const r=()=>{n==null||n(),t(!1)};return G.jsx(Pb,{open:e,onOpenChange:t,children:G.jsxs(dx,{className:"w-full max-w-xl sm:max-w-2xl",children:[G.jsxs(fx,{children:[G.jsx(mx,{children:"Map settings"}),G.jsx(gx,{children:"Choose the style of the map."})]}),G.jsx("div",{className:"py-2",children:G.jsx(cY,{})}),G.jsxs(px,{children:[G.jsx(_x,{asChild:!0,children:G.jsx(Qr,{variant:"secondary",className:"w-full sm:w-auto",children:"Close"})}),G.jsx(Qr,{onClick:r,className:"w-full sm:w-auto",children:"Save"})]})]})})}const sD=e=>e?e.startsWith("Point")?"/icons/point.svg":e.includes("Line")?"/icons/line.svg":"/icons/polygon.svg":"/icons/polygon.svg";function aD({id:e,name:t,onDelete:n,onDownload:r,isVisible:a,onToggleVisibility:u}){const{layers:p,selectedLayerId:i,setSelectedLayer:b}=wo(),C=p.find(ie=>ie.id===e),A=e==="base",R=A?a:(C==null?void 0:C.visible)??!0;console.log("Layer visibility:",{id:e,isVisible:R,layer:C,data:C==null?void 0:C.data});const[z,V]=Y.useState(!1),W=!A,X=e===i,ue=()=>{A||b(X?null:e)};return G.jsxs("div",{className:`flex items-center justify-between p-4 ${X?"border-2 rounded-lg border-red-500":""}`,children:[G.jsxs("div",{className:xE("flex items-center gap-4",W?"hover:opacity-80":"opacity-60 cursor-default"),onClick:W?ue:void 0,children:[G.jsx("span",{className:"flex-none h-5 w-5 shrink-0",style:{backgroundColor:C==null?void 0:C.fillColor,WebkitMask:`url(${Cp(sD(C==null?void 0:C.geometryType))}) center / contain no-repeat`,mask:`url(${Cp(sD(C==null?void 0:C.geometryType))}) center / contain no-repeat`}}),G.jsx("h3",{children:t})]}),G.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[G.jsxs(_B,{children:[G.jsx(yB,{asChild:!0,className:"transition-all duration-900 hover:scale-110",children:G.jsx(z8,{className:"h-5 w-5 cursor-pointer hover:shadow-lg text-black hover:bg-black/10 transition-shadow rounded-full p-0.5"})}),G.jsxs(LM,{align:"end",className:"p-2",children:[G.jsxs(f0,{onClick:()=>V(!0),children:[G.jsx(Gk,{className:"mr-2 h-4 w-4"}),G.jsx("span",{children:"Layer Settings"})]}),!A&&G.jsxs(G.Fragment,{children:[G.jsxs(KX,{children:[G.jsxs(vB,{className:"flex items-center",children:[G.jsx(k8,{className:"mr-2 h-4 w-4"}),G.jsx("span",{children:"Download as"})]}),G.jsxs(xB,{className:"p-1",children:[G.jsx(f0,{onClick:()=>r("geojson"),children:"GeoJSON"}),G.jsx(f0,{onClick:()=>r("gpx"),children:"GPX"}),G.jsx(f0,{onClick:()=>r("png"),children:"Image(PNG)"})]})]}),G.jsxs(f0,{onClick:n,children:[G.jsx($k,{className:"mr-2 h-4 w-4 text-red-500"}),G.jsx("span",{className:"text-red-500",children:"Delete layer"})]})]})]})]}),!A&&G.jsx(uY,{open:z,onOpenChange:V,layer:C},C==null?void 0:C.id),A&&G.jsx(r4,{open:z,onOpenChange:V}),R?G.jsx(U8,{className:"h-5 w-5 cursor-pointer hover:shadow-lg text-black hover:bg-black/10 transition-shadow duration-900 rounded-full p-0.5 hover:scale-110",onClick:()=>{u()}}):G.jsx(j8,{className:"h-5 w-5 cursor-pointer hover:shadow-lg text-black hover:bg-black/10 transition-shadow duration-900 rounded-full p-0.5 hover:scale-110",onClick:()=>{u()}})]})]})}var SS={exports:{}},hY=SS.exports,lD;function dY(){return lD||(lD=1,function(e,t){(function(n,r){r()})(hY,function(){function n(C,A){return typeof A>"u"?A={autoBom:!1}:typeof A!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),A={autoBom:!A}),A.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(C.type)?new Blob(["\uFEFF",C],{type:C.type}):C}function r(C,A,R){var z=new XMLHttpRequest;z.open("GET",C),z.responseType="blob",z.onload=function(){b(z.response,A,R)},z.onerror=function(){console.error("could not download file")},z.send()}function a(C){var A=new XMLHttpRequest;A.open("HEAD",C,!1);try{A.send()}catch{}return 200<=A.status&&299>=A.status}function u(C){try{C.dispatchEvent(new MouseEvent("click"))}catch{var A=document.createEvent("MouseEvents");A.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),C.dispatchEvent(A)}}var p=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $w=="object"&&$w.global===$w?$w:void 0,i=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),b=p.saveAs||(typeof window!="object"||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(C,A,R){var z=p.URL||p.webkitURL,V=document.createElement("a");A=A||C.name||"download",V.download=A,V.rel="noopener",typeof C=="string"?(V.href=C,V.origin===location.origin?u(V):a(V.href)?r(C,A,R):u(V,V.target="_blank")):(V.href=z.createObjectURL(C),setTimeout(function(){z.revokeObjectURL(V.href)},4e4),setTimeout(function(){u(V)},0))}:"msSaveOrOpenBlob"in navigator?function(C,A,R){if(A=A||C.name||"download",typeof C!="string")navigator.msSaveOrOpenBlob(n(C,R),A);else if(a(C))r(C,A,R);else{var z=document.createElement("a");z.href=C,z.target="_blank",setTimeout(function(){u(z)})}}:function(C,A,R,z){if(z=z||open("","_blank"),z&&(z.document.title=z.document.body.innerText="downloading..."),typeof C=="string")return r(C,A,R);var V=C.type==="application/octet-stream",W=/constructor/i.test(p.HTMLElement)||p.safari,X=/CriOS\/[\d]+/.test(navigator.userAgent);if((X||V&&W||i)&&typeof FileReader<"u"){var ue=new FileReader;ue.onloadend=function(){var ee=ue.result;ee=X?ee:ee.replace(/^data:[^;]*;/,"data:attachment/file;"),z?z.location.href=ee:location=ee,z=null},ue.readAsDataURL(C)}else{var ie=p.URL||p.webkitURL,K=ie.createObjectURL(C);z?z.location=K:location.href=K,z=null,setTimeout(function(){ie.revokeObjectURL(K)},4e4)}});p.saveAs=b.saveAs=b,e.exports=b})}(SS)),SS.exports}var uD=dY();function fY(e,t,n){n===void 0&&(n=document.implementation);var r=n.createDocument("http://www.topografix.com/GPX/1/1",""),a=r.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');r.appendChild(a);var u="@dwayneparton/geojson-to-gpx",p=(t==null?void 0:t.creator)||u,i=function(Se){return r.createElementNS("http://www.topografix.com/GPX/1/1",Se)},b=i("gpx");b.setAttribute("version","1.1"),b.setAttribute("creator",p);var C=[],A=[];function R(Se,je,Re){if(Re!==void 0){var De=i(je),at=r.createTextNode(String(Re));De.appendChild(at),Se.appendChild(De)}}function z(Se,je,Re){Re&&typeof Re=="object"&&je.forEach(function(De){var at=Re[De];at&&typeof at=="string"&&je.includes(De)&&R(Se,De,at)})}function V(Se,je){var Re=je.href;if(Re){var De=i("link");De.setAttribute("href",Re),z(De,["text","type"],je),Se.appendChild(De)}}function W(Se){var je=i("trk"),Re=["name","desc","src","type"];return z(je,Re,Se),je}function X(Se,je,Re){var De=je[0],at=je[1],ot=je[2],Fe=je[3],Ze=i(Se);Ze.setAttribute("lat",String(at)),Ze.setAttribute("lon",String(De)),R(Ze,"ele",ot),R(Ze,"time",Fe);var Ve=["name","desc","src","type"];return z(Ze,Ve,Re),Ze}function ue(Se){var je=i("trkseg");return Se.forEach(function(Re){je.appendChild(X("trkpt",Re))}),je}function ie(Se){var je=Se.geometry,Re=Se.properties,De=je.type;switch(De){case"Polygon":break;case"Point":{C.push(X("wpt",je.coordinates,Re));break}case"MultiPoint":{je.coordinates.forEach(function(Ze){C.push(X("wpt",Ze,Re))});break}case"LineString":{var at=W(Re),ot=ue(je.coordinates);at.appendChild(ot),A.push(at);break}case"MultiLineString":{var Fe=W(Re);je.coordinates.forEach(function(Ze){var Ve=ue(Ze);Fe.appendChild(Ve)}),A.push(Fe);break}}}if(t&&typeof t.metadata=="object"){var K=t.metadata,ee=i("metadata");if(R(ee,"name",K.name),R(ee,"desc",K.desc),K.author&&typeof K.author=="object"){var ae=i("author");R(ae,"name",K.author.name),R(ae,"email",K.author.email),K.author.link&&typeof K.author.link=="object"&&V(ae,K.author.link),ee.appendChild(ae)}if(typeof K.copyright=="object"){var he=i("copyright");K.copyright.author&&he.setAttribute("author",K.copyright.author),R(he,"year",K.copyright.year),R(he,"license",K.copyright.license),ee.appendChild(he)}typeof K.link=="object"&&V(ee,K.link),R(ee,"time",K.time),R(ee,"keywords",K.keywords),b.appendChild(ee)}var xe=e.type;switch(xe){case"Feature":{ie(e);break}case"FeatureCollection":{var ye=e.features;ye.forEach(function(Se){ie(Se)});break}}return C.forEach(function(Se){return b.appendChild(Se)}),A.forEach(function(Se){return b.appendChild(Se)}),r.appendChild(b),r}function pY(){const{layers:e,removeLayer:t,toggleLayer:n,reorderLayers:r}=wo(),{isBaseVisible:a,toggleBaseVisibility:u}=qh(),[p,i]=Y.useState(null),[b,C]=Y.useState(null),A=async(ie,K)=>{const ee=e.find(ye=>ye.id===ie);if(!ee)return;const ae={type:"FeatureCollection",features:ee.data.features};let he,xe=ee.name.replace(/[^a-z0-9]/gi,"_");switch(K){case"geojson":he=new Blob([JSON.stringify(ae,null,2)],{type:"application/geo+json"}),xe+=".geojson";break;case"gpx":{const ye=fY(ae,{creator:"SharkGIS"}),Se=new XMLSerializer().serializeToString(ye);he=new Blob([Se],{type:"application/gpx+xml"}),xe+=".gpx";break}case"png":{const ye=qh.getState().map;if(!ye)return;await new Promise(je=>ye.once("idle",je));const Se=await new Promise(je=>ye.getCanvas().toBlob(je,"image/png"));if(!Se)return;uD.saveAs(Se,`${xe}.png`);return}default:return}uD.saveAs(he,xe)},R=async()=>{await u()},z=(ie,K)=>{ie.dataTransfer.setData("text/plain",K.toString()),ie.currentTarget.classList.add("opacity-60"),i(K)},V=(ie,K)=>{ie.preventDefault(),p!==null&&C(K)},W=ie=>{ie.currentTarget.classList.remove("opacity-60"),i(null),C(null)},X=(ie,K)=>{const ee=parseInt(ie.dataTransfer.getData("text/plain"),10);ee!==K&&(r(ee,K),qh.getState().updateMapLayers()),C(null),i(null)},ue=[...e].reverse();return G.jsxs("div",{className:"gap-2 p-3 layer-list",children:[ue.map((ie,K)=>{const ee=e.length-1-K;return G.jsx("div",{draggable:!0,onDragStart:ae=>z(ae,ee),onDragOver:ae=>V(ae,ee),onDragEnd:W,onDrop:ae=>X(ae,ee),className:xE("layer-item cursor-grab active:cursor-grabbing hover:bg-gray-100","transition-all duration-300 rounded-md",ee===b&&"border-2 border-blue-400"),children:G.jsx(aD,{id:ie.id,name:ie.name,onDelete:()=>{t(ie.id),C_({title:"Layer deleted",description:`Layer "${ie.name}" has been deleted.`,icon:$k,backgroundColor:"#f87171"})},onDownload:ae=>A(ie.id,ae),isVisible:ie.visible,onToggleVisibility:()=>n(ie.id)})},ie.id)}),G.jsx("div",{className:"text-sm italic text-gray-500",children:G.jsx(aD,{id:"base",name:"Base map",onDelete:()=>{},onDownload:()=>{},isVisible:a,onToggleVisibility:R})})]})}function lv({open:e,onOpenChange:t,title:n,onSave:r,children:a,description:u,actions:p,saveButtonClassName:i}){return G.jsx(Pb,{open:e,onOpenChange:t,children:G.jsxs(dx,{className:"max-h-[90vh] flex flex-col clip-tool",children:[G.jsxs(fx,{className:"pb-2",children:[G.jsx(mx,{children:n}),u&&G.jsx(gx,{className:"text-sm",children:u})]}),G.jsx("div",{className:"flex-1 min-h-0 overflow-auto",children:a}),G.jsx(px,{className:"pt-2 mt-2 border-t",children:G.jsxs("div",{className:"flex flex-row w-full",children:[p&&G.jsx("div",{className:"flex-1",children:p}),G.jsxs("div",{className:"flex-3 gap-3 flex",children:[G.jsx(_x,{onClick:()=>t(!1),children:"Close"}),r&&G.jsx(Qr,{variant:"default",onClick:r,className:`clip-btn ${i||""}`,children:"Save"})]})]})})]})})}function mY(e){const t=gY(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(yY);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function gY(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=xY(a),i=vY(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var _Y=Symbol("radix.slottable");function yY(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===_Y}function vY(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function xY(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var GE="Popover",[i4,vae]=Zl(GE,[hx]),Ab=hx(),[bY,U_]=i4(GE),o4=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:a,onOpenChange:u,modal:p=!1}=e,i=Ab(t),b=Y.useRef(null),[C,A]=Y.useState(!1),[R,z]=Hc({prop:r,defaultProp:a??!1,onChange:u,caller:GE});return G.jsx(FE,{...i,children:G.jsx(bY,{scope:t,contentId:Ns(),triggerRef:b,open:R,onOpenChange:z,onOpenToggle:Y.useCallback(()=>z(V=>!V),[z]),hasCustomAnchor:C,onCustomAnchorAdd:Y.useCallback(()=>A(!0),[]),onCustomAnchorRemove:Y.useCallback(()=>A(!1),[]),modal:p,children:n})})};o4.displayName=GE;var s4="PopoverAnchor",wY=Y.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=U_(s4,n),u=Ab(n),{onCustomAnchorAdd:p,onCustomAnchorRemove:i}=a;return Y.useEffect(()=>(p(),()=>i()),[p,i]),G.jsx(zE,{...u,...r,ref:t})});wY.displayName=s4;var a4="PopoverTrigger",l4=Y.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=U_(a4,n),u=Ab(n),p=Xr(t,a.triggerRef),i=G.jsx(Ir.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":p4(a.open),...r,ref:p,onClick:Dn(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:G.jsx(zE,{asChild:!0,...u,children:i})});l4.displayName=a4;var jM="PopoverPortal",[SY,EY]=i4(jM,{forceMount:void 0}),u4=e=>{const{__scopePopover:t,forceMount:n,children:r,container:a}=e,u=U_(jM,t);return G.jsx(SY,{scope:t,forceMount:n,children:G.jsx(pc,{present:n||u.open,children:G.jsx(_b,{asChild:!0,container:a,children:r})})})};u4.displayName=jM;var I0="PopoverContent",c4=Y.forwardRef((e,t)=>{const n=EY(I0,e.__scopePopover),{forceMount:r=n.forceMount,...a}=e,u=U_(I0,e.__scopePopover);return G.jsx(pc,{present:r||u.open,children:u.modal?G.jsx(TY,{...a,ref:t}):G.jsx(IY,{...a,ref:t})})});c4.displayName=I0;var CY=mY("PopoverContent.RemoveScroll"),TY=Y.forwardRef((e,t)=>{const n=U_(I0,e.__scopePopover),r=Y.useRef(null),a=Xr(t,r),u=Y.useRef(!1);return Y.useEffect(()=>{const p=r.current;if(p)return EE(p)},[]),G.jsx(yb,{as:CY,allowPinchZoom:!0,children:G.jsx(h4,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Dn(e.onCloseAutoFocus,p=>{var i;p.preventDefault(),u.current||(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Dn(e.onPointerDownOutside,p=>{const i=p.detail.originalEvent,b=i.button===0&&i.ctrlKey===!0,C=i.button===2||b;u.current=C},{checkForDefaultPrevented:!1}),onFocusOutside:Dn(e.onFocusOutside,p=>p.preventDefault(),{checkForDefaultPrevented:!1})})})}),IY=Y.forwardRef((e,t)=>{const n=U_(I0,e.__scopePopover),r=Y.useRef(!1),a=Y.useRef(!1);return G.jsx(h4,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:u=>{var p,i;(p=e.onCloseAutoFocus)==null||p.call(e,u),u.defaultPrevented||(r.current||(i=n.triggerRef.current)==null||i.focus(),u.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:u=>{var b,C;(b=e.onInteractOutside)==null||b.call(e,u),u.defaultPrevented||(r.current=!0,u.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const p=u.target;((C=n.triggerRef.current)==null?void 0:C.contains(p))&&u.preventDefault(),u.detail.originalEvent.type==="focusin"&&a.current&&u.preventDefault()}})}),h4=Y.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:u,disableOutsidePointerEvents:p,onEscapeKeyDown:i,onPointerDownOutside:b,onFocusOutside:C,onInteractOutside:A,...R}=e,z=U_(I0,n),V=Ab(n);return wE(),G.jsx(gb,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:u,children:G.jsx(mb,{asChild:!0,disableOutsidePointerEvents:p,onInteractOutside:A,onEscapeKeyDown:i,onPointerDownOutside:b,onFocusOutside:C,onDismiss:()=>z.onOpenChange(!1),children:G.jsx(wM,{"data-state":p4(z.open),role:"dialog",id:z.contentId,...V,...R,ref:t,style:{...R.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),d4="PopoverClose",MY=Y.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=U_(d4,n);return G.jsx(Ir.button,{type:"button",...r,ref:t,onClick:Dn(e.onClick,()=>a.onOpenChange(!1))})});MY.displayName=d4;var PY="PopoverArrow",f4=Y.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Ab(n);return G.jsx(SM,{...a,...r,ref:t})});f4.displayName=PY;function p4(e){return e?"open":"closed"}var AY=o4,RY=l4,LY=u4,m4=c4,g4=f4;const Kh=AY,Jh=RY,_4=Y.forwardRef(({className:e,...t},n)=>G.jsx(g4,{ref:n,className:dn("fill-popover",e),...t}));_4.displayName=g4.displayName;const Wc=Y.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},a)=>G.jsx(LY,{children:G.jsx(m4,{ref:a,align:t,sideOffset:n,className:dn("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Wc.displayName=m4.displayName;var cD=1,OY=.9,DY=.8,NY=.17,XT=.1,ZT=.999,kY=.9999,FY=.99,zY=/[\\\/_+.#"@\[\(\{&]/,BY=/[\\\/_+.#"@\[\(\{&]/g,jY=/[\s-]/,y4=/[\s-]/g;function JI(e,t,n,r,a,u,p){if(u===t.length)return a===e.length?cD:FY;var i=`${a},${u}`;if(p[i]!==void 0)return p[i];for(var b=r.charAt(u),C=n.indexOf(b,a),A=0,R,z,V,W;C>=0;)R=JI(e,t,n,r,C+1,u+1,p),R>A&&(C===a?R*=cD:zY.test(e.charAt(C-1))?(R*=DY,V=e.slice(a,C-1).match(BY),V&&a>0&&(R*=Math.pow(ZT,V.length))):jY.test(e.charAt(C-1))?(R*=OY,W=e.slice(a,C-1).match(y4),W&&a>0&&(R*=Math.pow(ZT,W.length))):(R*=NY,a>0&&(R*=Math.pow(ZT,C-a))),e.charAt(C)!==t.charAt(u)&&(R*=kY)),(R<XT&&n.charAt(C-1)===r.charAt(u+1)||r.charAt(u+1)===r.charAt(u)&&n.charAt(C-1)!==r.charAt(u))&&(z=JI(e,t,n,r,C+1,u+2,p),z*XT>R&&(R=z*XT)),R>A&&(A=R),C=n.indexOf(b,C+1);return p[i]=A,A}function hD(e){return e.toLowerCase().replace(y4," ")}function VY(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,JI(e,t,hD(e),hD(t),0,0,{})}var _1='[cmdk-group=""]',YT='[cmdk-group-items=""]',UY='[cmdk-group-heading=""]',v4='[cmdk-item=""]',dD=`${v4}:not([aria-disabled="true"])`,QI="cmdk-item-select",p0="data-value",GY=(e,t,n)=>VY(e,t,n),x4=Y.createContext(void 0),Rb=()=>Y.useContext(x4),b4=Y.createContext(void 0),VM=()=>Y.useContext(b4),w4=Y.createContext(void 0),S4=Y.forwardRef((e,t)=>{let n=m0(()=>{var Ke,gt;return{search:"",value:(gt=(Ke=e.value)!=null?Ke:e.defaultValue)!=null?gt:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),r=m0(()=>new Set),a=m0(()=>new Map),u=m0(()=>new Map),p=m0(()=>new Set),i=E4(e),{label:b,children:C,value:A,onValueChange:R,filter:z,shouldFilter:V,loop:W,disablePointerSelection:X=!1,vimBindings:ue=!0,...ie}=e,K=Ns(),ee=Ns(),ae=Ns(),he=Y.useRef(null),xe=eK();Gy(()=>{if(A!==void 0){let Ke=A.trim();n.current.value=Ke,ye.emit()}},[A]),Gy(()=>{xe(6,ot)},[]);let ye=Y.useMemo(()=>({subscribe:Ke=>(p.current.add(Ke),()=>p.current.delete(Ke)),snapshot:()=>n.current,setState:(Ke,gt,Yt)=>{var Kt,nn,Ut,wn;if(!Object.is(n.current[Ke],gt)){if(n.current[Ke]=gt,Ke==="search")at(),Re(),xe(1,De);else if(Ke==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Pn=document.getElementById(ae);Pn?Pn.focus():(Kt=document.getElementById(K))==null||Kt.focus()}if(xe(7,()=>{var Pn;n.current.selectedItemId=(Pn=Fe())==null?void 0:Pn.id,ye.emit()}),Yt||xe(5,ot),((nn=i.current)==null?void 0:nn.value)!==void 0){let Pn=gt??"";(wn=(Ut=i.current).onValueChange)==null||wn.call(Ut,Pn);return}}ye.emit()}},emit:()=>{p.current.forEach(Ke=>Ke())}}),[]),Se=Y.useMemo(()=>({value:(Ke,gt,Yt)=>{var Kt;gt!==((Kt=u.current.get(Ke))==null?void 0:Kt.value)&&(u.current.set(Ke,{value:gt,keywords:Yt}),n.current.filtered.items.set(Ke,je(gt,Yt)),xe(2,()=>{Re(),ye.emit()}))},item:(Ke,gt)=>(r.current.add(Ke),gt&&(a.current.has(gt)?a.current.get(gt).add(Ke):a.current.set(gt,new Set([Ke]))),xe(3,()=>{at(),Re(),n.current.value||De(),ye.emit()}),()=>{u.current.delete(Ke),r.current.delete(Ke),n.current.filtered.items.delete(Ke);let Yt=Fe();xe(4,()=>{at(),(Yt==null?void 0:Yt.getAttribute("id"))===Ke&&De(),ye.emit()})}),group:Ke=>(a.current.has(Ke)||a.current.set(Ke,new Set),()=>{u.current.delete(Ke),a.current.delete(Ke)}),filter:()=>i.current.shouldFilter,label:b||e["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:K,inputId:ae,labelId:ee,listInnerRef:he}),[]);function je(Ke,gt){var Yt,Kt;let nn=(Kt=(Yt=i.current)==null?void 0:Yt.filter)!=null?Kt:GY;return Ke?nn(Ke,n.current.search,gt):0}function Re(){if(!n.current.search||i.current.shouldFilter===!1)return;let Ke=n.current.filtered.items,gt=[];n.current.filtered.groups.forEach(Kt=>{let nn=a.current.get(Kt),Ut=0;nn.forEach(wn=>{let Pn=Ke.get(wn);Ut=Math.max(Pn,Ut)}),gt.push([Kt,Ut])});let Yt=he.current;Ze().sort((Kt,nn)=>{var Ut,wn;let Pn=Kt.getAttribute("id"),we=nn.getAttribute("id");return((Ut=Ke.get(we))!=null?Ut:0)-((wn=Ke.get(Pn))!=null?wn:0)}).forEach(Kt=>{let nn=Kt.closest(YT);nn?nn.appendChild(Kt.parentElement===nn?Kt:Kt.closest(`${YT} > *`)):Yt.appendChild(Kt.parentElement===Yt?Kt:Kt.closest(`${YT} > *`))}),gt.sort((Kt,nn)=>nn[1]-Kt[1]).forEach(Kt=>{var nn;let Ut=(nn=he.current)==null?void 0:nn.querySelector(`${_1}[${p0}="${encodeURIComponent(Kt[0])}"]`);Ut==null||Ut.parentElement.appendChild(Ut)})}function De(){let Ke=Ze().find(Yt=>Yt.getAttribute("aria-disabled")!=="true"),gt=Ke==null?void 0:Ke.getAttribute(p0);ye.setState("value",gt||void 0)}function at(){var Ke,gt,Yt,Kt;if(!n.current.search||i.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let nn=0;for(let Ut of r.current){let wn=(gt=(Ke=u.current.get(Ut))==null?void 0:Ke.value)!=null?gt:"",Pn=(Kt=(Yt=u.current.get(Ut))==null?void 0:Yt.keywords)!=null?Kt:[],we=je(wn,Pn);n.current.filtered.items.set(Ut,we),we>0&&nn++}for(let[Ut,wn]of a.current)for(let Pn of wn)if(n.current.filtered.items.get(Pn)>0){n.current.filtered.groups.add(Ut);break}n.current.filtered.count=nn}function ot(){var Ke,gt,Yt;let Kt=Fe();Kt&&(((Ke=Kt.parentElement)==null?void 0:Ke.firstChild)===Kt&&((Yt=(gt=Kt.closest(_1))==null?void 0:gt.querySelector(UY))==null||Yt.scrollIntoView({block:"nearest"})),Kt.scrollIntoView({block:"nearest"}))}function Fe(){var Ke;return(Ke=he.current)==null?void 0:Ke.querySelector(`${v4}[aria-selected="true"]`)}function Ze(){var Ke;return Array.from(((Ke=he.current)==null?void 0:Ke.querySelectorAll(dD))||[])}function Ve(Ke){let gt=Ze()[Ke];gt&&ye.setState("value",gt.getAttribute(p0))}function mt(Ke){var gt;let Yt=Fe(),Kt=Ze(),nn=Kt.findIndex(wn=>wn===Yt),Ut=Kt[nn+Ke];(gt=i.current)!=null&&gt.loop&&(Ut=nn+Ke<0?Kt[Kt.length-1]:nn+Ke===Kt.length?Kt[0]:Kt[nn+Ke]),Ut&&ye.setState("value",Ut.getAttribute(p0))}function We(Ke){let gt=Fe(),Yt=gt==null?void 0:gt.closest(_1),Kt;for(;Yt&&!Kt;)Yt=Ke>0?JY(Yt,_1):QY(Yt,_1),Kt=Yt==null?void 0:Yt.querySelector(dD);Kt?ye.setState("value",Kt.getAttribute(p0)):mt(Ke)}let tt=()=>Ve(Ze().length-1),Dt=Ke=>{Ke.preventDefault(),Ke.metaKey?tt():Ke.altKey?We(1):mt(1)},$e=Ke=>{Ke.preventDefault(),Ke.metaKey?Ve(0):Ke.altKey?We(-1):mt(-1)};return Y.createElement(Ir.div,{ref:t,tabIndex:-1,...ie,"cmdk-root":"",onKeyDown:Ke=>{var gt;(gt=ie.onKeyDown)==null||gt.call(ie,Ke);let Yt=Ke.nativeEvent.isComposing||Ke.keyCode===229;if(!(Ke.defaultPrevented||Yt))switch(Ke.key){case"n":case"j":{ue&&Ke.ctrlKey&&Dt(Ke);break}case"ArrowDown":{Dt(Ke);break}case"p":case"k":{ue&&Ke.ctrlKey&&$e(Ke);break}case"ArrowUp":{$e(Ke);break}case"Home":{Ke.preventDefault(),Ve(0);break}case"End":{Ke.preventDefault(),tt();break}case"Enter":{Ke.preventDefault();let Kt=Fe();if(Kt){let nn=new Event(QI);Kt.dispatchEvent(nn)}}}}},Y.createElement("label",{"cmdk-label":"",htmlFor:Se.inputId,id:Se.labelId,style:nK},b),$E(e,Ke=>Y.createElement(b4.Provider,{value:ye},Y.createElement(x4.Provider,{value:Se},Ke))))}),$Y=Y.forwardRef((e,t)=>{var n,r;let a=Ns(),u=Y.useRef(null),p=Y.useContext(w4),i=Rb(),b=E4(e),C=(r=(n=b.current)==null?void 0:n.forceMount)!=null?r:p==null?void 0:p.forceMount;Gy(()=>{if(!C)return i.item(a,p==null?void 0:p.id)},[C]);let A=C4(a,u,[e.value,e.children,u],e.keywords),R=VM(),z=T_(xe=>xe.value&&xe.value===A.current),V=T_(xe=>C||i.filter()===!1?!0:xe.search?xe.filtered.items.get(a)>0:!0);Y.useEffect(()=>{let xe=u.current;if(!(!xe||e.disabled))return xe.addEventListener(QI,W),()=>xe.removeEventListener(QI,W)},[V,e.onSelect,e.disabled]);function W(){var xe,ye;X(),(ye=(xe=b.current).onSelect)==null||ye.call(xe,A.current)}function X(){R.setState("value",A.current,!0)}if(!V)return null;let{disabled:ue,value:ie,onSelect:K,forceMount:ee,keywords:ae,...he}=e;return Y.createElement(Ir.div,{ref:Tu(u,t),...he,id:a,"cmdk-item":"",role:"option","aria-disabled":!!ue,"aria-selected":!!z,"data-disabled":!!ue,"data-selected":!!z,onPointerMove:ue||i.getDisablePointerSelection()?void 0:X,onClick:ue?void 0:W},e.children)}),qY=Y.forwardRef((e,t)=>{let{heading:n,children:r,forceMount:a,...u}=e,p=Ns(),i=Y.useRef(null),b=Y.useRef(null),C=Ns(),A=Rb(),R=T_(V=>a||A.filter()===!1?!0:V.search?V.filtered.groups.has(p):!0);Gy(()=>A.group(p),[]),C4(p,i,[e.value,e.heading,b]);let z=Y.useMemo(()=>({id:p,forceMount:a}),[a]);return Y.createElement(Ir.div,{ref:Tu(i,t),...u,"cmdk-group":"",role:"presentation",hidden:R?void 0:!0},n&&Y.createElement("div",{ref:b,"cmdk-group-heading":"","aria-hidden":!0,id:C},n),$E(e,V=>Y.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?C:void 0},Y.createElement(w4.Provider,{value:z},V))))}),HY=Y.forwardRef((e,t)=>{let{alwaysRender:n,...r}=e,a=Y.useRef(null),u=T_(p=>!p.search);return!n&&!u?null:Y.createElement(Ir.div,{ref:Tu(a,t),...r,"cmdk-separator":"",role:"separator"})}),WY=Y.forwardRef((e,t)=>{let{onValueChange:n,...r}=e,a=e.value!=null,u=VM(),p=T_(C=>C.search),i=T_(C=>C.selectedItemId),b=Rb();return Y.useEffect(()=>{e.value!=null&&u.setState("search",e.value)},[e.value]),Y.createElement(Ir.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":b.listId,"aria-labelledby":b.labelId,"aria-activedescendant":i,id:b.inputId,type:"text",value:a?e.value:p,onChange:C=>{a||u.setState("search",C.target.value),n==null||n(C.target.value)}})}),XY=Y.forwardRef((e,t)=>{let{children:n,label:r="Suggestions",...a}=e,u=Y.useRef(null),p=Y.useRef(null),i=T_(C=>C.selectedItemId),b=Rb();return Y.useEffect(()=>{if(p.current&&u.current){let C=p.current,A=u.current,R,z=new ResizeObserver(()=>{R=requestAnimationFrame(()=>{let V=C.offsetHeight;A.style.setProperty("--cmdk-list-height",V.toFixed(1)+"px")})});return z.observe(C),()=>{cancelAnimationFrame(R),z.unobserve(C)}}},[]),Y.createElement(Ir.div,{ref:Tu(u,t),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":i,"aria-label":r,id:b.listId},$E(e,C=>Y.createElement("div",{ref:Tu(p,b.listInnerRef),"cmdk-list-sizer":""},C)))}),ZY=Y.forwardRef((e,t)=>{let{open:n,onOpenChange:r,overlayClassName:a,contentClassName:u,container:p,...i}=e;return Y.createElement(tM,{open:n,onOpenChange:r},Y.createElement(TE,{container:p},Y.createElement(sx,{"cmdk-overlay":"",className:a}),Y.createElement(ax,{"aria-label":e.label,"cmdk-dialog":"",className:u},Y.createElement(S4,{ref:t,...i}))))}),YY=Y.forwardRef((e,t)=>T_(n=>n.filtered.count===0)?Y.createElement(Ir.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),KY=Y.forwardRef((e,t)=>{let{progress:n,children:r,label:a="Loading...",...u}=e;return Y.createElement(Ir.div,{ref:t,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},$E(e,p=>Y.createElement("div",{"aria-hidden":!0},p)))}),mc=Object.assign(S4,{List:XY,Item:$Y,Input:WY,Group:qY,Separator:HY,Dialog:ZY,Empty:YY,Loading:KY});function JY(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function QY(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function E4(e){let t=Y.useRef(e);return Gy(()=>{t.current=e}),t}var Gy=typeof window>"u"?Y.useEffect:Y.useLayoutEffect;function m0(e){let t=Y.useRef();return t.current===void 0&&(t.current=e()),t}function T_(e){let t=VM(),n=()=>e(t.snapshot());return Y.useSyncExternalStore(t.subscribe,n,n)}function C4(e,t,n,r=[]){let a=Y.useRef(),u=Rb();return Gy(()=>{var p;let i=(()=>{var C;for(let A of n){if(typeof A=="string")return A.trim();if(typeof A=="object"&&"current"in A)return A.current?(C=A.current.textContent)==null?void 0:C.trim():a.current}})(),b=r.map(C=>C.trim());u.value(e,i,b),(p=t.current)==null||p.setAttribute(p0,i),a.current=i}),a}var eK=()=>{let[e,t]=Y.useState(),n=m0(()=>new Map);return Gy(()=>{n.current.forEach(r=>r()),n.current=new Map},[e]),(r,a)=>{n.current.set(r,a),t({})}};function tK(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function $E({asChild:e,children:t},n){return e&&Y.isValidElement(t)?Y.cloneElement(tK(t),{ref:t.ref},n(t.props.children)):n(t)}var nK={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const rK=TE,T4=Y.forwardRef(({className:e,...t},n)=>G.jsx(sx,{ref:n,className:dn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));T4.displayName=sx.displayName;const iK=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsxs(rK,{children:[G.jsx(T4,{}),G.jsxs(ax,{ref:r,className:dn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[t,G.jsxs(IE,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[G.jsx(fb,{className:"h-4 w-4"}),G.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));iK.displayName=ax.displayName;const oK=Y.forwardRef(({className:e,...t},n)=>G.jsx(vb,{ref:n,className:dn("text-lg font-semibold leading-none tracking-tight",e),...t}));oK.displayName=vb.displayName;const sK=Y.forwardRef(({className:e,...t},n)=>G.jsx(xb,{ref:n,className:dn("text-sm text-muted-foreground",e),...t}));sK.displayName=xb.displayName;const Qh=Y.forwardRef(({className:e,...t},n)=>G.jsx(mc,{ref:n,className:dn("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));Qh.displayName=mc.displayName;const sf=Y.forwardRef(({className:e,...t},n)=>G.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[G.jsx(K8,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),G.jsx(mc.Input,{ref:n,className:dn("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));sf.displayName=mc.Input.displayName;const ed=Y.forwardRef(({className:e,...t},n)=>G.jsx(mc.List,{ref:n,className:dn("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));ed.displayName=mc.List.displayName;const af=Y.forwardRef((e,t)=>G.jsx(mc.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));af.displayName=mc.Empty.displayName;const td=Y.forwardRef(({className:e,...t},n)=>G.jsx(mc.Group,{ref:n,className:dn("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));td.displayName=mc.Group.displayName;const aK=Y.forwardRef(({className:e,...t},n)=>G.jsx(mc.Separator,{ref:n,className:dn("-mx-1 h-px bg-border",e),...t}));aK.displayName=mc.Separator.displayName;const Gc=Y.forwardRef(({className:e,...t},n)=>G.jsx(mc.Item,{ref:n,className:dn("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...t}));Gc.displayName=mc.Item.displayName;function lK({selectedLayerId:e,setSelectedLayerId:t,bufferDistance:n,setBufferDistance:r,setLayerName:a,errors:u}){const{layers:p}=wo(),[i,b]=Y.useState(!1),C=p.find(R=>R.id===e),A=C?C.name:"Choose input layer";return G.jsxs(G.Fragment,{children:[G.jsxs("div",{className:"mt-2 mb-4 ml-1 mr-1 flex flex-row justify-between items-center",children:[G.jsxs(Kh,{open:i,onOpenChange:b,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox","aria-expanded":i,className:dn("w-[200px] justify-between buffer-input-layer",u.layer&&"border-red-500 border-2"),children:[A,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[200px] p-0",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No layers found."}),G.jsx(td,{children:p.map(R=>G.jsxs(Gc,{value:R.name,onSelect:()=>{t(R.id),a(ba(R.name+"-buffer")),b(!1)},children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",R.id===e?"opacity-100":"opacity-0")}),R.name]},R.id))})]})]})})]}),G.jsx(E0,{type:"number",placeholder:"Enter buffer distance [m]",value:n??"",onChange:R=>r(Number(R.target.value)),className:dn("w-[210px] buffer-distance",u.distance&&"border-red-500 border-2"),min:0,step:1})]}),G.jsx("div",{className:"text-red-500 text-sm m-auto text-center pb-2",children:u.layer&&u.distance?G.jsx("p",{children:"Please select a layer and enter a buffer distance."}):u.layer?G.jsx("p",{children:"Please select a layer."}):u.distance?G.jsx("p",{children:"Please enter a buffer distance."}):null})]})}function Ip(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mp(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function I4(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0,a=e.features;r<a.length;r++){var u=a[r];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!u.geometry||u.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+u.geometry.type)}}function Xc(e){return e.type==="Feature"?e.geometry:e}function fD(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Pp(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=Ip(e),a=Xc(t),u=a.type,p=t.bbox,i=a.coordinates;if(p&&uK(r,p)===!1)return!1;u==="Polygon"&&(i=[i]);for(var b=!1,C=0;C<i.length&&!b;C++)if(pD(r,i[C][0],n.ignoreBoundary)){for(var A=!1,R=1;R<i[C].length&&!A;)pD(r,i[C][R],!n.ignoreBoundary)&&(A=!0),R++;A||(b=!0)}return b}function pD(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var a=0,u=t.length-1;a<t.length;u=a++){var p=t[a][0],i=t[a][1],b=t[u][0],C=t[u][1],A=e[1]*(p-b)+i*(b-e[0])+C*(e[0]-p)===0&&(p-e[0])*(b-e[0])<=0&&(i-e[1])*(C-e[1])<=0;if(A)return!n;var R=i>e[1]!=C>e[1]&&e[0]<(b-p)*(e[1]-i)/(C-i)+p;R&&(r=!r)}return r}function uK(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}var nc=63710088e-1,cK={centimeters:nc*100,centimetres:nc*100,degrees:nc/111325,feet:nc*3.28084,inches:nc*39.37,kilometers:nc/1e3,kilometres:nc/1e3,meters:nc,metres:nc,miles:nc/1609.344,millimeters:nc*1e3,millimetres:nc*1e3,nauticalmiles:nc/1852,radians:1,yards:nc*1.0936};function hK(e,t){t===void 0&&(t="kilometers");var n=cK[t];if(!n)throw new Error(t+" units is invalid");return e*n}function tS(e){var t=e%360;return t*Math.PI/180}function Gm(e,t,n){n===void 0&&(n={});var r=Ip(e),a=Ip(t),u=tS(a[1]-r[1]),p=tS(a[0]-r[0]),i=tS(r[1]),b=tS(a[1]),C=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(i)*Math.cos(b);return hK(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)}function dK(e){var t=e[0],n=e[1],r=e[2],a=e[3],u=Gm(e.slice(0,2),[r,n]),p=Gm(e.slice(0,2),[t,a]);if(u>=p){var i=(n+a)/2;return[t,i-(r-t)/2,r,i+(r-t)/2]}else{var b=(t+r)/2;return[b-(a-n)/2,n,b+(a-n)/2,a]}}var rc=63710088e-1,fK={centimeters:rc*100,centimetres:rc*100,degrees:rc/111325,feet:rc*3.28084,inches:rc*39.37,kilometers:rc/1e3,kilometres:rc/1e3,meters:rc,metres:rc,miles:rc/1609.344,millimeters:rc*1e3,millimetres:rc*1e3,nauticalmiles:rc/1852,radians:1,yards:rc*1.0936};function pK(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function mK(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!gD(e[0])||!gD(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return pK(r,t,n)}function gK(e,t){t===void 0&&(t="kilometers");var n=fK[t];if(!n)throw new Error(t+" units is invalid");return e/n}function mD(e){var t=e%(2*Math.PI);return t*180/Math.PI}function KT(e){var t=e%360;return t*Math.PI/180}function gD(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function e2(e,t,n,r){r===void 0&&(r={});var a=Ip(e),u=KT(a[0]),p=KT(a[1]),i=KT(n),b=gK(t,r.units),C=Math.asin(Math.sin(p)*Math.cos(b)+Math.cos(p)*Math.sin(b)*Math.cos(i)),A=u+Math.atan2(Math.sin(i)*Math.sin(b)*Math.cos(p),Math.cos(b)-Math.sin(p)*Math.sin(C)),R=mD(A),z=mD(C);return mK([R,z],r.properties)}function _K(e){var t=e%(2*Math.PI);return t*180/Math.PI}function nS(e){var t=e%360;return t*Math.PI/180}function UM(e,t,n){if(n===void 0&&(n={}),n.final===!0)return yK(e,t);var r=Ip(e),a=Ip(t),u=nS(r[0]),p=nS(a[0]),i=nS(r[1]),b=nS(a[1]),C=Math.sin(p-u)*Math.cos(b),A=Math.cos(i)*Math.sin(b)-Math.sin(i)*Math.cos(b)*Math.cos(p-u);return _K(Math.atan2(C,A))}function yK(e,t){var n=UM(t,e);return n=(n+180)%360,n}var xu=63710088e-1,M4={centimeters:xu*100,centimetres:xu*100,degrees:xu/111325,feet:xu*3.28084,inches:xu*39.37,kilometers:xu/1e3,kilometres:xu/1e3,meters:xu,metres:xu,miles:xu/1609.344,millimeters:xu*1e3,millimetres:xu*1e3,nauticalmiles:xu/1852,radians:1,yards:xu*1.0936};function Qm(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function GM(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_D(e[0])||!_D(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return Qm(r,t,n)}function eg(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function vK(e,t,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:e};return Qm(r,t,n)}function xK(e,t,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:e};return Qm(r,t,n)}function $M(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return Qm(r,t,n)}function bK(e,t){var n=M4[t];return e*n}function wK(e,t){t===void 0&&(t="kilometers");var n=M4[t];if(!n)throw new Error(t+" units is invalid");return e/n}function _D(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function P4(e,t,n){if(e!==null)for(var r,a,u,p,i,b,C,A=0,R=0,z,V=e.type,W=V==="FeatureCollection",X=V==="Feature",ue=W?e.features.length:1,ie=0;ie<ue;ie++){C=W?e.features[ie].geometry:X?e.geometry:e,z=C?C.type==="GeometryCollection":!1,i=z?C.geometries.length:1;for(var K=0;K<i;K++){var ee=0,ae=0;if(p=z?C.geometries[K]:C,p!==null){b=p.coordinates;var he=p.type;switch(A=0,he){case null:break;case"Point":if(t(b,R,ie,ee,ae)===!1)return!1;R++,ee++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],R,ie,ee,ae)===!1)return!1;R++,he==="MultiPoint"&&ee++}he==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],R,ie,ee,ae)===!1)return!1;R++}he==="MultiLineString"&&ee++,he==="Polygon"&&ae++}he==="Polygon"&&ee++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ae=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],R,ie,ee,ae)===!1)return!1;R++}ae++}ee++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(P4(p.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yD(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function qM(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function H1(e,t){qM(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(Qm(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(Qm(R,a),r,C)===!1)return!1}})}function M0(e){var t=[1/0,1/0,-1/0,-1/0];return P4(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}M0.default=M0;function SK(e,t){t===void 0&&(t={});var n=M0(e),r=(n[0]+n[2])/2,a=(n[1]+n[3])/2;return GM([r,a],t.properties,t)}function t2(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties={},r.geometry=e,r}function EK(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xD(e[0])||!xD(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return t2(r,t,n)}function vD(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function xD(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function n2(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function CK(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return n2(r,t,n)}function TK(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function IK(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function MK(e,t){IK(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(n2(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(n2(R,a),r,C)===!1)return!1}})}function r2(e){if(!e)throw new Error("geojson is required");var t=[];return MK(e,function(n){PK(n,t)}),TK(t)}function PK(e,t){var n=[],r=e.geometry;if(r!==null){switch(r.type){case"Polygon":n=Mp(r);break;case"LineString":n=[Mp(r)]}n.forEach(function(a){var u=AK(a,e.properties);u.forEach(function(p){p.id=t.length,t.push(p)})})}}function AK(e,t){var n=[];return e.reduce(function(r,a){var u=CK([r,a],t);return u.bbox=RK(r,a),n.push(u),a}),n}function RK(e,t){var n=e[0],r=e[1],a=t[0],u=t[1],p=n<a?n:a,i=r<u?r:u,b=n>a?n:a,C=r>u?r:u;return[p,i,b,C]}function bD(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}var rS={exports:{}},ES={exports:{}},LK=ES.exports,wD;function OK(){return wD||(wD=1,function(e,t){(function(n,r){e.exports=r()})(LK,function(){function n(K,ee,ae,he,xe){(function ye(Se,je,Re,De,at){for(;De>Re;){if(De-Re>600){var ot=De-Re+1,Fe=je-Re+1,Ze=Math.log(ot),Ve=.5*Math.exp(2*Ze/3),mt=.5*Math.sqrt(Ze*Ve*(ot-Ve)/ot)*(Fe-ot/2<0?-1:1),We=Math.max(Re,Math.floor(je-Fe*Ve/ot+mt)),tt=Math.min(De,Math.floor(je+(ot-Fe)*Ve/ot+mt));ye(Se,je,We,tt,at)}var Dt=Se[je],$e=Re,Ke=De;for(r(Se,Re,je),at(Se[De],Dt)>0&&r(Se,Re,De);$e<Ke;){for(r(Se,$e,Ke),$e++,Ke--;at(Se[$e],Dt)<0;)$e++;for(;at(Se[Ke],Dt)>0;)Ke--}at(Se[Re],Dt)===0?r(Se,Re,Ke):r(Se,++Ke,De),Ke<=je&&(Re=Ke+1),je<=Ke&&(De=Ke-1)}})(K,ee,ae||0,he||K.length-1,xe||a)}function r(K,ee,ae){var he=K[ee];K[ee]=K[ae],K[ae]=he}function a(K,ee){return K<ee?-1:K>ee?1:0}var u=function(K){K===void 0&&(K=9),this._maxEntries=Math.max(4,K),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function p(K,ee,ae){if(!ae)return ee.indexOf(K);for(var he=0;he<ee.length;he++)if(ae(K,ee[he]))return he;return-1}function i(K,ee){b(K,0,K.children.length,ee,K)}function b(K,ee,ae,he,xe){xe||(xe=ue(null)),xe.minX=1/0,xe.minY=1/0,xe.maxX=-1/0,xe.maxY=-1/0;for(var ye=ee;ye<ae;ye++){var Se=K.children[ye];C(xe,K.leaf?he(Se):Se)}return xe}function C(K,ee){return K.minX=Math.min(K.minX,ee.minX),K.minY=Math.min(K.minY,ee.minY),K.maxX=Math.max(K.maxX,ee.maxX),K.maxY=Math.max(K.maxY,ee.maxY),K}function A(K,ee){return K.minX-ee.minX}function R(K,ee){return K.minY-ee.minY}function z(K){return(K.maxX-K.minX)*(K.maxY-K.minY)}function V(K){return K.maxX-K.minX+(K.maxY-K.minY)}function W(K,ee){return K.minX<=ee.minX&&K.minY<=ee.minY&&ee.maxX<=K.maxX&&ee.maxY<=K.maxY}function X(K,ee){return ee.minX<=K.maxX&&ee.minY<=K.maxY&&ee.maxX>=K.minX&&ee.maxY>=K.minY}function ue(K){return{children:K,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ie(K,ee,ae,he,xe){for(var ye=[ee,ae];ye.length;)if(!((ae=ye.pop())-(ee=ye.pop())<=he)){var Se=ee+Math.ceil((ae-ee)/he/2)*he;n(K,Se,ee,ae,xe),ye.push(ee,Se,Se,ae)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(K){var ee=this.data,ae=[];if(!X(K,ee))return ae;for(var he=this.toBBox,xe=[];ee;){for(var ye=0;ye<ee.children.length;ye++){var Se=ee.children[ye],je=ee.leaf?he(Se):Se;X(K,je)&&(ee.leaf?ae.push(Se):W(K,je)?this._all(Se,ae):xe.push(Se))}ee=xe.pop()}return ae},u.prototype.collides=function(K){var ee=this.data;if(!X(K,ee))return!1;for(var ae=[];ee;){for(var he=0;he<ee.children.length;he++){var xe=ee.children[he],ye=ee.leaf?this.toBBox(xe):xe;if(X(K,ye)){if(ee.leaf||W(K,ye))return!0;ae.push(xe)}}ee=ae.pop()}return!1},u.prototype.load=function(K){if(!K||!K.length)return this;if(K.length<this._minEntries){for(var ee=0;ee<K.length;ee++)this.insert(K[ee]);return this}var ae=this._build(K.slice(),0,K.length-1,0);if(this.data.children.length)if(this.data.height===ae.height)this._splitRoot(this.data,ae);else{if(this.data.height<ae.height){var he=this.data;this.data=ae,ae=he}this._insert(ae,this.data.height-ae.height-1,!0)}else this.data=ae;return this},u.prototype.insert=function(K){return K&&this._insert(K,this.data.height-1),this},u.prototype.clear=function(){return this.data=ue([]),this},u.prototype.remove=function(K,ee){if(!K)return this;for(var ae,he,xe,ye=this.data,Se=this.toBBox(K),je=[],Re=[];ye||je.length;){if(ye||(ye=je.pop(),he=je[je.length-1],ae=Re.pop(),xe=!0),ye.leaf){var De=p(K,ye.children,ee);if(De!==-1)return ye.children.splice(De,1),je.push(ye),this._condense(je),this}xe||ye.leaf||!W(ye,Se)?he?(ae++,ye=he.children[ae],xe=!1):ye=null:(je.push(ye),Re.push(ae),ae=0,he=ye,ye=ye.children[0])}return this},u.prototype.toBBox=function(K){return K},u.prototype.compareMinX=function(K,ee){return K.minX-ee.minX},u.prototype.compareMinY=function(K,ee){return K.minY-ee.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(K){return this.data=K,this},u.prototype._all=function(K,ee){for(var ae=[];K;)K.leaf?ee.push.apply(ee,K.children):ae.push.apply(ae,K.children),K=ae.pop();return ee},u.prototype._build=function(K,ee,ae,he){var xe,ye=ae-ee+1,Se=this._maxEntries;if(ye<=Se)return i(xe=ue(K.slice(ee,ae+1)),this.toBBox),xe;he||(he=Math.ceil(Math.log(ye)/Math.log(Se)),Se=Math.ceil(ye/Math.pow(Se,he-1))),(xe=ue([])).leaf=!1,xe.height=he;var je=Math.ceil(ye/Se),Re=je*Math.ceil(Math.sqrt(Se));ie(K,ee,ae,Re,this.compareMinX);for(var De=ee;De<=ae;De+=Re){var at=Math.min(De+Re-1,ae);ie(K,De,at,je,this.compareMinY);for(var ot=De;ot<=at;ot+=je){var Fe=Math.min(ot+je-1,at);xe.children.push(this._build(K,ot,Fe,he-1))}}return i(xe,this.toBBox),xe},u.prototype._chooseSubtree=function(K,ee,ae,he){for(;he.push(ee),!ee.leaf&&he.length-1!==ae;){for(var xe=1/0,ye=1/0,Se=void 0,je=0;je<ee.children.length;je++){var Re=ee.children[je],De=z(Re),at=(ot=K,Fe=Re,(Math.max(Fe.maxX,ot.maxX)-Math.min(Fe.minX,ot.minX))*(Math.max(Fe.maxY,ot.maxY)-Math.min(Fe.minY,ot.minY))-De);at<ye?(ye=at,xe=De<xe?De:xe,Se=Re):at===ye&&De<xe&&(xe=De,Se=Re)}ee=Se||ee.children[0]}var ot,Fe;return ee},u.prototype._insert=function(K,ee,ae){var he=ae?K:this.toBBox(K),xe=[],ye=this._chooseSubtree(he,this.data,ee,xe);for(ye.children.push(K),C(ye,he);ee>=0&&xe[ee].children.length>this._maxEntries;)this._split(xe,ee),ee--;this._adjustParentBBoxes(he,xe,ee)},u.prototype._split=function(K,ee){var ae=K[ee],he=ae.children.length,xe=this._minEntries;this._chooseSplitAxis(ae,xe,he);var ye=this._chooseSplitIndex(ae,xe,he),Se=ue(ae.children.splice(ye,ae.children.length-ye));Se.height=ae.height,Se.leaf=ae.leaf,i(ae,this.toBBox),i(Se,this.toBBox),ee?K[ee-1].children.push(Se):this._splitRoot(ae,Se)},u.prototype._splitRoot=function(K,ee){this.data=ue([K,ee]),this.data.height=K.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(K,ee,ae){for(var he,xe,ye,Se,je,Re,De,at=1/0,ot=1/0,Fe=ee;Fe<=ae-ee;Fe++){var Ze=b(K,0,Fe,this.toBBox),Ve=b(K,Fe,ae,this.toBBox),mt=(xe=Ze,ye=Ve,Se=void 0,je=void 0,Re=void 0,De=void 0,Se=Math.max(xe.minX,ye.minX),je=Math.max(xe.minY,ye.minY),Re=Math.min(xe.maxX,ye.maxX),De=Math.min(xe.maxY,ye.maxY),Math.max(0,Re-Se)*Math.max(0,De-je)),We=z(Ze)+z(Ve);mt<at?(at=mt,he=Fe,ot=We<ot?We:ot):mt===at&&We<ot&&(ot=We,he=Fe)}return he||ae-ee},u.prototype._chooseSplitAxis=function(K,ee,ae){var he=K.leaf?this.compareMinX:A,xe=K.leaf?this.compareMinY:R;this._allDistMargin(K,ee,ae,he)<this._allDistMargin(K,ee,ae,xe)&&K.children.sort(he)},u.prototype._allDistMargin=function(K,ee,ae,he){K.children.sort(he);for(var xe=this.toBBox,ye=b(K,0,ee,xe),Se=b(K,ae-ee,ae,xe),je=V(ye)+V(Se),Re=ee;Re<ae-ee;Re++){var De=K.children[Re];C(ye,K.leaf?xe(De):De),je+=V(ye)}for(var at=ae-ee-1;at>=ee;at--){var ot=K.children[at];C(Se,K.leaf?xe(ot):ot),je+=V(Se)}return je},u.prototype._adjustParentBBoxes=function(K,ee,ae){for(var he=ae;he>=0;he--)C(ee[he],K)},u.prototype._condense=function(K){for(var ee=K.length-1,ae=void 0;ee>=0;ee--)K[ee].children.length===0?ee>0?(ae=K[ee-1].children).splice(ae.indexOf(K[ee]),1):this.clear():i(K[ee],this.toBBox)},u})}(ES)),ES.exports}var JT={},SD;function A4(){return SD||(SD=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(De,at,ot){ot===void 0&&(ot={});var Fe={type:"Feature"};return(ot.id===0||ot.id)&&(Fe.id=ot.id),ot.bbox&&(Fe.bbox=ot.bbox),Fe.properties=at||{},Fe.geometry=De,Fe}e.feature=t;function n(De,at,ot){switch(De){case"Point":return r(at).geometry;case"LineString":return i(at).geometry;case"Polygon":return u(at).geometry;case"MultiPoint":return R(at).geometry;case"MultiLineString":return A(at).geometry;case"MultiPolygon":return z(at).geometry;default:throw new Error(De+" is invalid")}}e.geometry=n;function r(De,at,ot){if(ot===void 0&&(ot={}),!De)throw new Error("coordinates is required");if(!Array.isArray(De))throw new Error("coordinates must be an Array");if(De.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ye(De[0])||!ye(De[1]))throw new Error("coordinates must contain numbers");var Fe={type:"Point",coordinates:De};return t(Fe,at,ot)}e.point=r;function a(De,at,ot){return ot===void 0&&(ot={}),C(De.map(function(Fe){return r(Fe,at)}),ot)}e.points=a;function u(De,at,ot){ot===void 0&&(ot={});for(var Fe=0,Ze=De;Fe<Ze.length;Fe++){var Ve=Ze[Fe];if(Ve.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var mt=0;mt<Ve[Ve.length-1].length;mt++)if(Ve[Ve.length-1][mt]!==Ve[0][mt])throw new Error("First and last Position are not equivalent.")}var We={type:"Polygon",coordinates:De};return t(We,at,ot)}e.polygon=u;function p(De,at,ot){return ot===void 0&&(ot={}),C(De.map(function(Fe){return u(Fe,at)}),ot)}e.polygons=p;function i(De,at,ot){if(ot===void 0&&(ot={}),De.length<2)throw new Error("coordinates must be an array of two or more positions");var Fe={type:"LineString",coordinates:De};return t(Fe,at,ot)}e.lineString=i;function b(De,at,ot){return ot===void 0&&(ot={}),C(De.map(function(Fe){return i(Fe,at)}),ot)}e.lineStrings=b;function C(De,at){at===void 0&&(at={});var ot={type:"FeatureCollection"};return at.id&&(ot.id=at.id),at.bbox&&(ot.bbox=at.bbox),ot.features=De,ot}e.featureCollection=C;function A(De,at,ot){ot===void 0&&(ot={});var Fe={type:"MultiLineString",coordinates:De};return t(Fe,at,ot)}e.multiLineString=A;function R(De,at,ot){ot===void 0&&(ot={});var Fe={type:"MultiPoint",coordinates:De};return t(Fe,at,ot)}e.multiPoint=R;function z(De,at,ot){ot===void 0&&(ot={});var Fe={type:"MultiPolygon",coordinates:De};return t(Fe,at,ot)}e.multiPolygon=z;function V(De,at,ot){ot===void 0&&(ot={});var Fe={type:"GeometryCollection",geometries:De};return t(Fe,at,ot)}e.geometryCollection=V;function W(De,at){if(at===void 0&&(at=0),at&&!(at>=0))throw new Error("precision must be a positive number");var ot=Math.pow(10,at||0);return Math.round(De*ot)/ot}e.round=W;function X(De,at){at===void 0&&(at="kilometers");var ot=e.factors[at];if(!ot)throw new Error(at+" units is invalid");return De*ot}e.radiansToLength=X;function ue(De,at){at===void 0&&(at="kilometers");var ot=e.factors[at];if(!ot)throw new Error(at+" units is invalid");return De/ot}e.lengthToRadians=ue;function ie(De,at){return ee(ue(De,at))}e.lengthToDegrees=ie;function K(De){var at=De%360;return at<0&&(at+=360),at}e.bearingToAzimuth=K;function ee(De){var at=De%(2*Math.PI);return at*180/Math.PI}e.radiansToDegrees=ee;function ae(De){var at=De%360;return at*Math.PI/180}e.degreesToRadians=ae;function he(De,at,ot){if(at===void 0&&(at="kilometers"),ot===void 0&&(ot="kilometers"),!(De>=0))throw new Error("length must be a positive number");return X(ue(De,at),ot)}e.convertLength=he;function xe(De,at,ot){if(at===void 0&&(at="meters"),ot===void 0&&(ot="kilometers"),!(De>=0))throw new Error("area must be a positive number");var Fe=e.areaFactors[at];if(!Fe)throw new Error("invalid original units");var Ze=e.areaFactors[ot];if(!Ze)throw new Error("invalid final units");return De/Fe*Ze}e.convertArea=xe;function ye(De){return!isNaN(De)&&De!==null&&!Array.isArray(De)}e.isNumber=ye;function Se(De){return!!De&&De.constructor===Object}e.isObject=Se;function je(De){if(!De)throw new Error("bbox is required");if(!Array.isArray(De))throw new Error("bbox must be an Array");if(De.length!==4&&De.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");De.forEach(function(at){if(!ye(at))throw new Error("bbox must only contain numbers")})}e.validateBBox=je;function Re(De){if(!De)throw new Error("id is required");if(["string","number"].indexOf(typeof De)===-1)throw new Error("id must be a number or a string")}e.validateId=Re}(JT)),JT}var Ys={},ED;function DK(){if(ED)return Ys;ED=1,Object.defineProperty(Ys,"__esModule",{value:!0});var e=A4();function t(K,ee,ae){if(K!==null)for(var he,xe,ye,Se,je,Re,De,at=0,ot=0,Fe,Ze=K.type,Ve=Ze==="FeatureCollection",mt=Ze==="Feature",We=Ve?K.features.length:1,tt=0;tt<We;tt++){De=Ve?K.features[tt].geometry:mt?K.geometry:K,Fe=De?De.type==="GeometryCollection":!1,je=Fe?De.geometries.length:1;for(var Dt=0;Dt<je;Dt++){var $e=0,Ke=0;if(Se=Fe?De.geometries[Dt]:De,Se!==null){Re=Se.coordinates;var gt=Se.type;switch(at=ae&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(ee(Re,ot,tt,$e,Ke)===!1)return!1;ot++,$e++;break;case"LineString":case"MultiPoint":for(he=0;he<Re.length;he++){if(ee(Re[he],ot,tt,$e,Ke)===!1)return!1;ot++,gt==="MultiPoint"&&$e++}gt==="LineString"&&$e++;break;case"Polygon":case"MultiLineString":for(he=0;he<Re.length;he++){for(xe=0;xe<Re[he].length-at;xe++){if(ee(Re[he][xe],ot,tt,$e,Ke)===!1)return!1;ot++}gt==="MultiLineString"&&$e++,gt==="Polygon"&&Ke++}gt==="Polygon"&&$e++;break;case"MultiPolygon":for(he=0;he<Re.length;he++){for(Ke=0,xe=0;xe<Re[he].length;xe++){for(ye=0;ye<Re[he][xe].length-at;ye++){if(ee(Re[he][xe][ye],ot,tt,$e,Ke)===!1)return!1;ot++}Ke++}$e++}break;case"GeometryCollection":for(he=0;he<Se.geometries.length;he++)if(t(Se.geometries[he],ee,ae)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function n(K,ee,ae,he){var xe=ae;return t(K,function(ye,Se,je,Re,De){Se===0&&ae===void 0?xe=ye:xe=ee(xe,ye,Se,je,Re,De)},he),xe}function r(K,ee){var ae;switch(K.type){case"FeatureCollection":for(ae=0;ae<K.features.length&&ee(K.features[ae].properties,ae)!==!1;ae++);break;case"Feature":ee(K.properties,0);break}}function a(K,ee,ae){var he=ae;return r(K,function(xe,ye){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye)}),he}function u(K,ee){if(K.type==="Feature")ee(K,0);else if(K.type==="FeatureCollection")for(var ae=0;ae<K.features.length&&ee(K.features[ae],ae)!==!1;ae++);}function p(K,ee,ae){var he=ae;return u(K,function(xe,ye){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye)}),he}function i(K){var ee=[];return t(K,function(ae){ee.push(ae)}),ee}function b(K,ee){var ae,he,xe,ye,Se,je,Re,De,at,ot,Fe=0,Ze=K.type==="FeatureCollection",Ve=K.type==="Feature",mt=Ze?K.features.length:1;for(ae=0;ae<mt;ae++){for(je=Ze?K.features[ae].geometry:Ve?K.geometry:K,De=Ze?K.features[ae].properties:Ve?K.properties:{},at=Ze?K.features[ae].bbox:Ve?K.bbox:void 0,ot=Ze?K.features[ae].id:Ve?K.id:void 0,Re=je?je.type==="GeometryCollection":!1,Se=Re?je.geometries.length:1,xe=0;xe<Se;xe++){if(ye=Re?je.geometries[xe]:je,ye===null){if(ee(null,Fe,De,at,ot)===!1)return!1;continue}switch(ye.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(ee(ye,Fe,De,at,ot)===!1)return!1;break}case"GeometryCollection":{for(he=0;he<ye.geometries.length;he++)if(ee(ye.geometries[he],Fe,De,at,ot)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Fe++}}function C(K,ee,ae){var he=ae;return b(K,function(xe,ye,Se,je,Re){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se,je,Re)}),he}function A(K,ee){b(K,function(ae,he,xe,ye,Se){var je=ae===null?null:ae.type;switch(je){case null:case"Point":case"LineString":case"Polygon":return ee(e.feature(ae,xe,{bbox:ye,id:Se}),he,0)===!1?!1:void 0}var Re;switch(je){case"MultiPoint":Re="Point";break;case"MultiLineString":Re="LineString";break;case"MultiPolygon":Re="Polygon";break}for(var De=0;De<ae.coordinates.length;De++){var at=ae.coordinates[De],ot={type:Re,coordinates:at};if(ee(e.feature(ot,xe),he,De)===!1)return!1}})}function R(K,ee,ae){var he=ae;return A(K,function(xe,ye,Se){ye===0&&Se===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se)}),he}function z(K,ee){A(K,function(ae,he,xe){var ye=0;if(ae.geometry){var Se=ae.geometry.type;if(!(Se==="Point"||Se==="MultiPoint")){var je,Re=0,De=0,at=0;if(t(ae,function(ot,Fe,Ze,Ve,mt){if(je===void 0||he>Re||Ve>De||mt>at){je=ot,Re=he,De=Ve,at=mt,ye=0;return}var We=e.lineString([je,ot],ae.properties);if(ee(We,he,xe,mt,ye)===!1)return!1;ye++,je=ot})===!1)return!1}}})}function V(K,ee,ae){var he=ae,xe=!1;return z(K,function(ye,Se,je,Re,De){xe===!1&&ae===void 0?he=ye:he=ee(he,ye,Se,je,Re,De),xe=!0}),he}function W(K,ee){if(!K)throw new Error("geojson is required");A(K,function(ae,he,xe){if(ae.geometry!==null){var ye=ae.geometry.type,Se=ae.geometry.coordinates;switch(ye){case"LineString":if(ee(ae,he,xe,0,0)===!1)return!1;break;case"Polygon":for(var je=0;je<Se.length;je++)if(ee(e.lineString(Se[je],ae.properties),he,xe,je)===!1)return!1;break}}})}function X(K,ee,ae){var he=ae;return W(K,function(xe,ye,Se,je){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se,je)}),he}function ue(K,ee){if(ee=ee||{},!e.isObject(ee))throw new Error("options is invalid");var ae=ee.featureIndex||0,he=ee.multiFeatureIndex||0,xe=ee.geometryIndex||0,ye=ee.segmentIndex||0,Se=ee.properties,je;switch(K.type){case"FeatureCollection":ae<0&&(ae=K.features.length+ae),Se=Se||K.features[ae].properties,je=K.features[ae].geometry;break;case"Feature":Se=Se||K.properties,je=K.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=K;break;default:throw new Error("geojson is invalid")}if(je===null)return null;var Re=je.coordinates;switch(je.type){case"Point":case"MultiPoint":return null;case"LineString":return ye<0&&(ye=Re.length+ye-1),e.lineString([Re[ye],Re[ye+1]],Se,ee);case"Polygon":return xe<0&&(xe=Re.length+xe),ye<0&&(ye=Re[xe].length+ye-1),e.lineString([Re[xe][ye],Re[xe][ye+1]],Se,ee);case"MultiLineString":return he<0&&(he=Re.length+he),ye<0&&(ye=Re[he].length+ye-1),e.lineString([Re[he][ye],Re[he][ye+1]],Se,ee);case"MultiPolygon":return he<0&&(he=Re.length+he),xe<0&&(xe=Re[he].length+xe),ye<0&&(ye=Re[he][xe].length-ye-1),e.lineString([Re[he][xe][ye],Re[he][xe][ye+1]],Se,ee)}throw new Error("geojson is invalid")}function ie(K,ee){if(ee=ee||{},!e.isObject(ee))throw new Error("options is invalid");var ae=ee.featureIndex||0,he=ee.multiFeatureIndex||0,xe=ee.geometryIndex||0,ye=ee.coordIndex||0,Se=ee.properties,je;switch(K.type){case"FeatureCollection":ae<0&&(ae=K.features.length+ae),Se=Se||K.features[ae].properties,je=K.features[ae].geometry;break;case"Feature":Se=Se||K.properties,je=K.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=K;break;default:throw new Error("geojson is invalid")}if(je===null)return null;var Re=je.coordinates;switch(je.type){case"Point":return e.point(Re,Se,ee);case"MultiPoint":return he<0&&(he=Re.length+he),e.point(Re[he],Se,ee);case"LineString":return ye<0&&(ye=Re.length+ye),e.point(Re[ye],Se,ee);case"Polygon":return xe<0&&(xe=Re.length+xe),ye<0&&(ye=Re[xe].length+ye),e.point(Re[xe][ye],Se,ee);case"MultiLineString":return he<0&&(he=Re.length+he),ye<0&&(ye=Re[he].length+ye),e.point(Re[he][ye],Se,ee);case"MultiPolygon":return he<0&&(he=Re.length+he),xe<0&&(xe=Re[he].length+xe),ye<0&&(ye=Re[he][xe].length-ye),e.point(Re[he][xe][ye],Se,ee)}throw new Error("geojson is invalid")}return Ys.coordAll=i,Ys.coordEach=t,Ys.coordReduce=n,Ys.featureEach=u,Ys.featureReduce=p,Ys.findPoint=ie,Ys.findSegment=ue,Ys.flattenEach=A,Ys.flattenReduce=R,Ys.geomEach=b,Ys.geomReduce=C,Ys.lineEach=W,Ys.lineReduce=X,Ys.propEach=r,Ys.propReduce=a,Ys.segmentEach=z,Ys.segmentReduce=V,Ys}var y1={},Ks={},Bi={},CD;function NK(){if(CD)return Bi;CD=1,Object.defineProperty(Bi,"__esModule",{value:!0});var e=63710088e-1,t={centimeters:e*100,centimetres:e*100,degrees:360/(2*Math.PI),feet:e*3.28084,inches:e*39.37,kilometers:e/1e3,kilometres:e/1e3,meters:e,metres:e,miles:e/1609.344,millimeters:e*1e3,millimetres:e*1e3,nauticalmiles:e/1852,radians:1,yards:e*1.0936},n={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function r(Fe,Ze,Ve={}){const mt={type:"Feature"};return(Ve.id===0||Ve.id)&&(mt.id=Ve.id),Ve.bbox&&(mt.bbox=Ve.bbox),mt.properties=Ze||{},mt.geometry=Fe,mt}function a(Fe,Ze,Ve={}){switch(Fe){case"Point":return u(Ze).geometry;case"LineString":return C(Ze).geometry;case"Polygon":return i(Ze).geometry;case"MultiPoint":return V(Ze).geometry;case"MultiLineString":return z(Ze).geometry;case"MultiPolygon":return W(Ze).geometry;default:throw new Error(Fe+" is invalid")}}function u(Fe,Ze,Ve={}){if(!Fe)throw new Error("coordinates is required");if(!Array.isArray(Fe))throw new Error("coordinates must be an Array");if(Fe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Re(Fe[0])||!Re(Fe[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:Fe},Ze,Ve)}function p(Fe,Ze,Ve={}){return R(Fe.map(mt=>u(mt,Ze)),Ve)}function i(Fe,Ze,Ve={}){for(const We of Fe){if(We.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(We[We.length-1].length!==We[0].length)throw new Error("First and last Position are not equivalent.");for(let tt=0;tt<We[We.length-1].length;tt++)if(We[We.length-1][tt]!==We[0][tt])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:Fe},Ze,Ve)}function b(Fe,Ze,Ve={}){return R(Fe.map(mt=>i(mt,Ze)),Ve)}function C(Fe,Ze,Ve={}){if(Fe.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:Fe},Ze,Ve)}function A(Fe,Ze,Ve={}){return R(Fe.map(mt=>C(mt,Ze)),Ve)}function R(Fe,Ze={}){const Ve={type:"FeatureCollection"};return Ze.id&&(Ve.id=Ze.id),Ze.bbox&&(Ve.bbox=Ze.bbox),Ve.features=Fe,Ve}function z(Fe,Ze,Ve={}){return r({type:"MultiLineString",coordinates:Fe},Ze,Ve)}function V(Fe,Ze,Ve={}){return r({type:"MultiPoint",coordinates:Fe},Ze,Ve)}function W(Fe,Ze,Ve={}){return r({type:"MultiPolygon",coordinates:Fe},Ze,Ve)}function X(Fe,Ze,Ve={}){return r({type:"GeometryCollection",geometries:Fe},Ze,Ve)}function ue(Fe,Ze=0){if(Ze&&!(Ze>=0))throw new Error("precision must be a positive number");const Ve=Math.pow(10,Ze||0);return Math.round(Fe*Ve)/Ve}function ie(Fe,Ze="kilometers"){const Ve=t[Ze];if(!Ve)throw new Error(Ze+" units is invalid");return Fe*Ve}function K(Fe,Ze="kilometers"){const Ve=t[Ze];if(!Ve)throw new Error(Ze+" units is invalid");return Fe/Ve}function ee(Fe,Ze){return xe(K(Fe,Ze))}function ae(Fe){let Ze=Fe%360;return Ze<0&&(Ze+=360),Ze}function he(Fe){return Fe=Fe%360,Fe>180?Fe-360:Fe<-180?Fe+360:Fe}function xe(Fe){return Fe%(2*Math.PI)*180/Math.PI}function ye(Fe){return Fe%360*Math.PI/180}function Se(Fe,Ze="kilometers",Ve="kilometers"){if(!(Fe>=0))throw new Error("length must be a positive number");return ie(K(Fe,Ze),Ve)}function je(Fe,Ze="meters",Ve="kilometers"){if(!(Fe>=0))throw new Error("area must be a positive number");const mt=n[Ze];if(!mt)throw new Error("invalid original units");const We=n[Ve];if(!We)throw new Error("invalid final units");return Fe/mt*We}function Re(Fe){return!isNaN(Fe)&&Fe!==null&&!Array.isArray(Fe)}function De(Fe){return Fe!==null&&typeof Fe=="object"&&!Array.isArray(Fe)}function at(Fe){if(!Fe)throw new Error("bbox is required");if(!Array.isArray(Fe))throw new Error("bbox must be an Array");if(Fe.length!==4&&Fe.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");Fe.forEach(Ze=>{if(!Re(Ze))throw new Error("bbox must only contain numbers")})}function ot(Fe){if(!Fe)throw new Error("id is required");if(["string","number"].indexOf(typeof Fe)===-1)throw new Error("id must be a number or a string")}return Bi.areaFactors=n,Bi.azimuthToBearing=he,Bi.bearingToAzimuth=ae,Bi.convertArea=je,Bi.convertLength=Se,Bi.degreesToRadians=ye,Bi.earthRadius=e,Bi.factors=t,Bi.feature=r,Bi.featureCollection=R,Bi.geometry=a,Bi.geometryCollection=X,Bi.isNumber=Re,Bi.isObject=De,Bi.lengthToDegrees=ee,Bi.lengthToRadians=K,Bi.lineString=C,Bi.lineStrings=A,Bi.multiLineString=z,Bi.multiPoint=V,Bi.multiPolygon=W,Bi.point=u,Bi.points=p,Bi.polygon=i,Bi.polygons=b,Bi.radiansToDegrees=xe,Bi.radiansToLength=ie,Bi.round=ue,Bi.validateBBox=at,Bi.validateId=ot,Bi}var TD;function kK(){if(TD)return Ks;TD=1,Object.defineProperty(Ks,"__esModule",{value:!0});var e=NK();function t(K,ee,ae){if(K!==null)for(var he,xe,ye,Se,je,Re,De,at=0,ot=0,Fe,Ze=K.type,Ve=Ze==="FeatureCollection",mt=Ze==="Feature",We=Ve?K.features.length:1,tt=0;tt<We;tt++){De=Ve?K.features[tt].geometry:mt?K.geometry:K,Fe=De?De.type==="GeometryCollection":!1,je=Fe?De.geometries.length:1;for(var Dt=0;Dt<je;Dt++){var $e=0,Ke=0;if(Se=Fe?De.geometries[Dt]:De,Se!==null){Re=Se.coordinates;var gt=Se.type;switch(at=ae&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(ee(Re,ot,tt,$e,Ke)===!1)return!1;ot++,$e++;break;case"LineString":case"MultiPoint":for(he=0;he<Re.length;he++){if(ee(Re[he],ot,tt,$e,Ke)===!1)return!1;ot++,gt==="MultiPoint"&&$e++}gt==="LineString"&&$e++;break;case"Polygon":case"MultiLineString":for(he=0;he<Re.length;he++){for(xe=0;xe<Re[he].length-at;xe++){if(ee(Re[he][xe],ot,tt,$e,Ke)===!1)return!1;ot++}gt==="MultiLineString"&&$e++,gt==="Polygon"&&Ke++}gt==="Polygon"&&$e++;break;case"MultiPolygon":for(he=0;he<Re.length;he++){for(Ke=0,xe=0;xe<Re[he].length;xe++){for(ye=0;ye<Re[he][xe].length-at;ye++){if(ee(Re[he][xe][ye],ot,tt,$e,Ke)===!1)return!1;ot++}Ke++}$e++}break;case"GeometryCollection":for(he=0;he<Se.geometries.length;he++)if(t(Se.geometries[he],ee,ae)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function n(K,ee,ae,he){var xe=ae;return t(K,function(ye,Se,je,Re,De){Se===0&&ae===void 0?xe=ye:xe=ee(xe,ye,Se,je,Re,De)},he),xe}function r(K,ee){var ae;switch(K.type){case"FeatureCollection":for(ae=0;ae<K.features.length&&ee(K.features[ae].properties,ae)!==!1;ae++);break;case"Feature":ee(K.properties,0);break}}function a(K,ee,ae){var he=ae;return r(K,function(xe,ye){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye)}),he}function u(K,ee){if(K.type==="Feature")ee(K,0);else if(K.type==="FeatureCollection")for(var ae=0;ae<K.features.length&&ee(K.features[ae],ae)!==!1;ae++);}function p(K,ee,ae){var he=ae;return u(K,function(xe,ye){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye)}),he}function i(K){var ee=[];return t(K,function(ae){ee.push(ae)}),ee}function b(K,ee){var ae,he,xe,ye,Se,je,Re,De,at,ot,Fe=0,Ze=K.type==="FeatureCollection",Ve=K.type==="Feature",mt=Ze?K.features.length:1;for(ae=0;ae<mt;ae++){for(je=Ze?K.features[ae].geometry:Ve?K.geometry:K,De=Ze?K.features[ae].properties:Ve?K.properties:{},at=Ze?K.features[ae].bbox:Ve?K.bbox:void 0,ot=Ze?K.features[ae].id:Ve?K.id:void 0,Re=je?je.type==="GeometryCollection":!1,Se=Re?je.geometries.length:1,xe=0;xe<Se;xe++){if(ye=Re?je.geometries[xe]:je,ye===null){if(ee(null,Fe,De,at,ot)===!1)return!1;continue}switch(ye.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(ee(ye,Fe,De,at,ot)===!1)return!1;break}case"GeometryCollection":{for(he=0;he<ye.geometries.length;he++)if(ee(ye.geometries[he],Fe,De,at,ot)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Fe++}}function C(K,ee,ae){var he=ae;return b(K,function(xe,ye,Se,je,Re){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se,je,Re)}),he}function A(K,ee){b(K,function(ae,he,xe,ye,Se){var je=ae===null?null:ae.type;switch(je){case null:case"Point":case"LineString":case"Polygon":return ee(e.feature.call(void 0,ae,xe,{bbox:ye,id:Se}),he,0)===!1?!1:void 0}var Re;switch(je){case"MultiPoint":Re="Point";break;case"MultiLineString":Re="LineString";break;case"MultiPolygon":Re="Polygon";break}for(var De=0;De<ae.coordinates.length;De++){var at=ae.coordinates[De],ot={type:Re,coordinates:at};if(ee(e.feature.call(void 0,ot,xe),he,De)===!1)return!1}})}function R(K,ee,ae){var he=ae;return A(K,function(xe,ye,Se){ye===0&&Se===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se)}),he}function z(K,ee){A(K,function(ae,he,xe){var ye=0;if(ae.geometry){var Se=ae.geometry.type;if(!(Se==="Point"||Se==="MultiPoint")){var je,Re=0,De=0,at=0;if(t(ae,function(ot,Fe,Ze,Ve,mt){if(je===void 0||he>Re||Ve>De||mt>at){je=ot,Re=he,De=Ve,at=mt,ye=0;return}var We=e.lineString.call(void 0,[je,ot],ae.properties);if(ee(We,he,xe,mt,ye)===!1)return!1;ye++,je=ot})===!1)return!1}}})}function V(K,ee,ae){var he=ae,xe=!1;return z(K,function(ye,Se,je,Re,De){xe===!1&&ae===void 0?he=ye:he=ee(he,ye,Se,je,Re,De),xe=!0}),he}function W(K,ee){if(!K)throw new Error("geojson is required");A(K,function(ae,he,xe){if(ae.geometry!==null){var ye=ae.geometry.type,Se=ae.geometry.coordinates;switch(ye){case"LineString":if(ee(ae,he,xe,0,0)===!1)return!1;break;case"Polygon":for(var je=0;je<Se.length;je++)if(ee(e.lineString.call(void 0,Se[je],ae.properties),he,xe,je)===!1)return!1;break}}})}function X(K,ee,ae){var he=ae;return W(K,function(xe,ye,Se,je){ye===0&&ae===void 0?he=xe:he=ee(he,xe,ye,Se,je)}),he}function ue(K,ee){if(ee=ee||{},!e.isObject.call(void 0,ee))throw new Error("options is invalid");var ae=ee.featureIndex||0,he=ee.multiFeatureIndex||0,xe=ee.geometryIndex||0,ye=ee.segmentIndex||0,Se=ee.properties,je;switch(K.type){case"FeatureCollection":ae<0&&(ae=K.features.length+ae),Se=Se||K.features[ae].properties,je=K.features[ae].geometry;break;case"Feature":Se=Se||K.properties,je=K.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=K;break;default:throw new Error("geojson is invalid")}if(je===null)return null;var Re=je.coordinates;switch(je.type){case"Point":case"MultiPoint":return null;case"LineString":return ye<0&&(ye=Re.length+ye-1),e.lineString.call(void 0,[Re[ye],Re[ye+1]],Se,ee);case"Polygon":return xe<0&&(xe=Re.length+xe),ye<0&&(ye=Re[xe].length+ye-1),e.lineString.call(void 0,[Re[xe][ye],Re[xe][ye+1]],Se,ee);case"MultiLineString":return he<0&&(he=Re.length+he),ye<0&&(ye=Re[he].length+ye-1),e.lineString.call(void 0,[Re[he][ye],Re[he][ye+1]],Se,ee);case"MultiPolygon":return he<0&&(he=Re.length+he),xe<0&&(xe=Re[he].length+xe),ye<0&&(ye=Re[he][xe].length-ye-1),e.lineString.call(void 0,[Re[he][xe][ye],Re[he][xe][ye+1]],Se,ee)}throw new Error("geojson is invalid")}function ie(K,ee){if(ee=ee||{},!e.isObject.call(void 0,ee))throw new Error("options is invalid");var ae=ee.featureIndex||0,he=ee.multiFeatureIndex||0,xe=ee.geometryIndex||0,ye=ee.coordIndex||0,Se=ee.properties,je;switch(K.type){case"FeatureCollection":ae<0&&(ae=K.features.length+ae),Se=Se||K.features[ae].properties,je=K.features[ae].geometry;break;case"Feature":Se=Se||K.properties,je=K.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=K;break;default:throw new Error("geojson is invalid")}if(je===null)return null;var Re=je.coordinates;switch(je.type){case"Point":return e.point.call(void 0,Re,Se,ee);case"MultiPoint":return he<0&&(he=Re.length+he),e.point.call(void 0,Re[he],Se,ee);case"LineString":return ye<0&&(ye=Re.length+ye),e.point.call(void 0,Re[ye],Se,ee);case"Polygon":return xe<0&&(xe=Re.length+xe),ye<0&&(ye=Re[xe].length+ye),e.point.call(void 0,Re[xe][ye],Se,ee);case"MultiLineString":return he<0&&(he=Re.length+he),ye<0&&(ye=Re[he].length+ye),e.point.call(void 0,Re[he][ye],Se,ee);case"MultiPolygon":return he<0&&(he=Re.length+he),xe<0&&(xe=Re[he].length+xe),ye<0&&(ye=Re[he][xe].length-ye),e.point.call(void 0,Re[he][xe][ye],Se,ee)}throw new Error("geojson is invalid")}return Ks.coordAll=i,Ks.coordEach=t,Ks.coordReduce=n,Ks.featureEach=u,Ks.featureReduce=p,Ks.findPoint=ie,Ks.findSegment=ue,Ks.flattenEach=A,Ks.flattenReduce=R,Ks.geomEach=b,Ks.geomReduce=C,Ks.lineEach=W,Ks.lineReduce=X,Ks.propEach=r,Ks.propReduce=a,Ks.segmentEach=z,Ks.segmentReduce=V,Ks}var ID;function FK(){if(ID)return y1;ID=1,Object.defineProperty(y1,"__esModule",{value:!0});var e=kK();function t(r,a={}){if(r.bbox!=null&&a.recompute!==!0)return r.bbox;const u=[1/0,1/0,-1/0,-1/0];return e.coordEach.call(void 0,r,p=>{u[0]>p[0]&&(u[0]=p[0]),u[1]>p[1]&&(u[1]=p[1]),u[2]<p[0]&&(u[2]=p[0]),u[3]<p[1]&&(u[3]=p[1])}),u}var n=t;return y1.bbox=t,y1.default=n,y1}var MD;function zK(){if(MD)return rS.exports;MD=1;var e=OK(),t=A4(),n=DK(),r=FK().default,a=n.featureEach;n.coordEach,t.polygon;var u=t.featureCollection;function p(i){var b=new e(i);return b.insert=function(C){if(C.type!=="Feature")throw new Error("invalid feature");return C.bbox=C.bbox?C.bbox:r(C),e.prototype.insert.call(this,C)},b.load=function(C){var A=[];return Array.isArray(C)?C.forEach(function(R){if(R.type!=="Feature")throw new Error("invalid features");R.bbox=R.bbox?R.bbox:r(R),A.push(R)}):a(C,function(R){if(R.type!=="Feature")throw new Error("invalid features");R.bbox=R.bbox?R.bbox:r(R),A.push(R)}),e.prototype.load.call(this,A)},b.remove=function(C,A){if(C.type!=="Feature")throw new Error("invalid feature");return C.bbox=C.bbox?C.bbox:r(C),e.prototype.remove.call(this,C,A)},b.clear=function(){return e.prototype.clear.call(this)},b.search=function(C){var A=e.prototype.search.call(this,this.toBBox(C));return u(A)},b.collides=function(C){return e.prototype.collides.call(this,this.toBBox(C))},b.all=function(){var C=e.prototype.all.call(this);return u(C)},b.toJSON=function(){return e.prototype.toJSON.call(this)},b.fromJSON=function(C){return e.prototype.fromJSON.call(this,C)},b.toBBox=function(C){var A;if(C.bbox)A=C.bbox;else if(Array.isArray(C)&&C.length===4)A=C;else if(Array.isArray(C)&&C.length===6)A=[C[0],C[1],C[3],C[4]];else if(C.type==="Feature")A=r(C);else if(C.type==="FeatureCollection")A=r(C);else throw new Error("invalid geojson");return{minX:A[0],minY:A[1],maxX:A[2],maxY:A[3]}},b}return rS.exports=p,rS.exports.default=p,rS.exports}var BK=zK();const HM=dd(BK);function R4(e,t){var n={},r=[];if(e.type==="LineString"&&(e=t2(e)),t.type==="LineString"&&(t=t2(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var a=PD(e,t);return a&&r.push(a),vD(r)}var u=HM();return u.load(r2(t)),bD(r2(e),function(p){bD(u.search(p),function(i){var b=PD(p,i);if(b){var C=Mp(b).join(",");n[C]||(n[C]=!0,r.push(b))}})}),vD(r)}function PD(e,t){var n=Mp(e),r=Mp(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var a=n[0][0],u=n[0][1],p=n[1][0],i=n[1][1],b=r[0][0],C=r[0][1],A=r[1][0],R=r[1][1],z=(R-C)*(p-a)-(A-b)*(i-u),V=(A-b)*(u-C)-(R-C)*(a-b),W=(p-a)*(u-C)-(i-u)*(a-b);if(z===0)return null;var X=V/z,ue=W/z;if(X>=0&&X<=1&&ue>=0&&ue<=1){var ie=a+X*(p-a),K=u+X*(i-u);return EK([ie,K])}return null}function qS(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function QT(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!RD(e[0])||!RD(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return qS(r,t,n)}function AD(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return qS(r,t,n)}function RD(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function jK(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function VK(e,t){jK(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(qS(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(qS(R,a),r,C)===!1)return!1}})}function UK(e,t,n){n===void 0&&(n={});var r=QT([1/0,1/0],{dist:1/0}),a=0;return VK(e,function(u){for(var p=Mp(u),i=0;i<p.length-1;i++){var b=QT(p[i]);b.properties.dist=Gm(t,b,n);var C=QT(p[i+1]);C.properties.dist=Gm(t,C,n);var A=Gm(b,C,n),R=Math.max(b.properties.dist,C.properties.dist),z=UM(b,C),V=e2(t,R,z+90,n),W=e2(t,R,z-90,n),X=R4(AD([V.geometry.coordinates,W.geometry.coordinates]),AD([b.geometry.coordinates,C.geometry.coordinates])),ue=null;X.features.length>0&&(ue=X.features[0],ue.properties.dist=Gm(t,ue,n),ue.properties.location=a+Gm(b,ue,n)),b.properties.dist<r.properties.dist&&(r=b,r.properties.index=i,r.properties.location=a),C.properties.dist<r.properties.dist&&(r=C,r.properties.index=i+1,r.properties.location=a+A),ue&&ue.properties.dist<r.properties.dist&&(r=ue,r.properties.index=i),a+=A}}),r}function GK(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties={},r.geometry=e,r}function LD(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!OD(e[0])||!OD(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return GK(r,t,n)}function OD(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function $K(e,t,n){n===void 0&&(n={});for(var r=Xc(e),a=r.coordinates,u=0,p=0;p<a.length&&!(t>=u&&p===a.length-1);p++)if(u>=t){var i=t-u;if(i){var b=UM(a[p],a[p-1])-180,C=e2(a[p],i,b,n);return C}else return LD(a[p])}else u+=Gm(a[p],a[p+1],n);return LD(a[a.length-1])}function i2(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function qK(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return i2(r,t,n)}function L4(e,t,n){if(e!==null)for(var r,a,u,p,i,b,C,A=0,R=0,z,V=e.type,W=V==="FeatureCollection",X=V==="Feature",ue=W?e.features.length:1,ie=0;ie<ue;ie++){C=W?e.features[ie].geometry:X?e.geometry:e,z=C?C.type==="GeometryCollection":!1,i=z?C.geometries.length:1;for(var K=0;K<i;K++){var ee=0,ae=0;if(p=z?C.geometries[K]:C,p!==null){b=p.coordinates;var he=p.type;switch(A=0,he){case null:break;case"Point":if(t(b,R,ie,ee,ae)===!1)return!1;R++,ee++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],R,ie,ee,ae)===!1)return!1;R++,he==="MultiPoint"&&ee++}he==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],R,ie,ee,ae)===!1)return!1;R++}he==="MultiLineString"&&ee++,he==="Polygon"&&ae++}he==="Polygon"&&ee++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ae=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],R,ie,ee,ae)===!1)return!1;R++}ae++}ee++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(L4(p.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function HK(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function WK(e,t){HK(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(i2(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(i2(R,a),r,C)===!1)return!1}})}function XK(e,t){WK(e,function(n,r,a){var u=0;if(n.geometry){var p=n.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var i,b=0,C=0,A=0;if(L4(n,function(R,z,V,W,X){if(i===void 0||r>b||W>C||X>A){i=R,b=r,C=W,A=X,u=0;return}var ue=qK([i,R],n.properties);if(t(ue,r,a,X,u)===!1)return!1;u++,i=R})===!1)return!1}}})}function ZK(e,t,n){var r=n,a=!1;return XK(e,function(u,p,i,b,C){a===!1&&n===void 0?r=u:r=t(r,u,p,i,b,C),a=!0}),r}function YK(e,t){return t===void 0&&(t={}),ZK(e,function(n,r){var a=r.geometry.coordinates;return n+Gm(a[0],a[1],t)},0)}function O4(e,t,n){if(e!==null)for(var r,a,u,p,i,b,C,A=0,R=0,z,V=e.type,W=V==="FeatureCollection",X=V==="Feature",ue=W?e.features.length:1,ie=0;ie<ue;ie++){C=W?e.features[ie].geometry:X?e.geometry:e,z=C?C.type==="GeometryCollection":!1,i=z?C.geometries.length:1;for(var K=0;K<i;K++){var ee=0,ae=0;if(p=z?C.geometries[K]:C,p!==null){b=p.coordinates;var he=p.type;switch(A=0,he){case null:break;case"Point":if(t(b,R,ie,ee,ae)===!1)return!1;R++,ee++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],R,ie,ee,ae)===!1)return!1;R++,he==="MultiPoint"&&ee++}he==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],R,ie,ee,ae)===!1)return!1;R++}he==="MultiLineString"&&ee++,he==="Polygon"&&ae++}he==="Polygon"&&ee++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ae=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],R,ie,ee,ae)===!1)return!1;R++}ae++}ee++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(O4(p.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function P0(e){var t=[1/0,1/0,-1/0,-1/0];return O4(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}P0.default=P0;function HS(e,t,n){n===void 0&&(n={});for(var r=Ip(e),a=Mp(t),u=0;u<a.length-1;u++){var p=!1;if(n.ignoreEndVertices&&(u===0&&(p="start"),u===a.length-2&&(p="end"),u===0&&u+1===a.length-1&&(p="both")),KK(a[u],a[u+1],r,p,typeof n.epsilon>"u"?null:n.epsilon))return!0}return!1}function KK(e,t,n,r,a){var u=n[0],p=n[1],i=e[0],b=e[1],C=t[0],A=t[1],R=n[0]-i,z=n[1]-b,V=C-i,W=A-b,X=R*W-z*V;if(a!==null){if(Math.abs(X)>a)return!1}else if(X!==0)return!1;if(r){if(r==="start")return Math.abs(V)>=Math.abs(W)?V>0?i<u&&u<=C:C<=u&&u<i:W>0?b<p&&p<=A:A<=p&&p<b;if(r==="end")return Math.abs(V)>=Math.abs(W)?V>0?i<=u&&u<C:C<u&&u<=i:W>0?b<=p&&p<A:A<p&&p<=b;if(r==="both")return Math.abs(V)>=Math.abs(W)?V>0?i<u&&u<C:C<u&&u<i:W>0?b<p&&p<A:A<p&&p<b}else return Math.abs(V)>=Math.abs(W)?V>0?i<=u&&u<=C:C<=u&&u<=i:W>0?b<=p&&p<=A:A<=p&&p<=b;return!1}function JK(e,t){var n=Xc(e),r=Xc(t),a=n.type,u=r.type;switch(a){case"Point":switch(u){case"MultiPoint":return QK(n,r);case"LineString":return HS(n,r,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return Pp(n,r,{ignoreBoundary:!0});default:throw new Error("feature2 "+u+" geometry not supported")}case"MultiPoint":switch(u){case"MultiPoint":return eJ(n,r);case"LineString":return tJ(n,r);case"Polygon":case"MultiPolygon":return nJ(n,r);default:throw new Error("feature2 "+u+" geometry not supported")}case"LineString":switch(u){case"LineString":return rJ(n,r);case"Polygon":case"MultiPolygon":return iJ(n,r);default:throw new Error("feature2 "+u+" geometry not supported")}case"Polygon":switch(u){case"Polygon":case"MultiPolygon":return oJ(n,r);default:throw new Error("feature2 "+u+" geometry not supported")}default:throw new Error("feature1 "+a+" geometry not supported")}}function QK(e,t){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(N4(t.coordinates[n],e.coordinates)){r=!0;break}return r}function eJ(e,t){for(var n=0;n<e.coordinates.length;n++){for(var r=!1,a=0;a<t.coordinates.length;a++)N4(e.coordinates[n],t.coordinates[a])&&(r=!0);if(!r)return!1}return!0}function tJ(e,t){for(var n=!1,r=0;r<e.coordinates.length;r++){if(!HS(e.coordinates[r],t))return!1;n||(n=HS(e.coordinates[r],t,{ignoreEndVertices:!0}))}return n}function nJ(e,t){for(var n=!0,r=!1,a=0;a<e.coordinates.length;a++){if(r=Pp(e.coordinates[1],t),!r){n=!1;break}r=Pp(e.coordinates[1],t,{ignoreBoundary:!0})}return n&&r}function rJ(e,t){for(var n=0;n<e.coordinates.length;n++)if(!HS(e.coordinates[n],t))return!1;return!0}function iJ(e,t){var n=P0(t),r=P0(e);if(!D4(n,r))return!1;for(var a=!1,u=0;u<e.coordinates.length-1;u++){if(!Pp(e.coordinates[u],t))return!1;if(a||(a=Pp(e.coordinates[u],t,{ignoreBoundary:!0})),!a){var p=sJ(e.coordinates[u],e.coordinates[u+1]);a=Pp(p,t,{ignoreBoundary:!0})}}return a}function oJ(e,t){var n=P0(e),r=P0(t);if(!D4(r,n))return!1;for(var a=0;a<e.coordinates[0].length;a++)if(!Pp(e.coordinates[0][a],t))return!1;return!0}function D4(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function N4(e,t){return e[0]===t[0]&&e[1]===t[1]}function sJ(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function k4(e,t,n){if(e!==null)for(var r,a,u,p,i,b,C,A=0,R=0,z,V=e.type,W=V==="FeatureCollection",X=V==="Feature",ue=W?e.features.length:1,ie=0;ie<ue;ie++){C=W?e.features[ie].geometry:X?e.geometry:e,z=C?C.type==="GeometryCollection":!1,i=z?C.geometries.length:1;for(var K=0;K<i;K++){var ee=0,ae=0;if(p=z?C.geometries[K]:C,p!==null){b=p.coordinates;var he=p.type;switch(A=0,he){case null:break;case"Point":if(t(b,R,ie,ee,ae)===!1)return!1;R++,ee++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],R,ie,ee,ae)===!1)return!1;R++,he==="MultiPoint"&&ee++}he==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],R,ie,ee,ae)===!1)return!1;R++}he==="MultiLineString"&&ee++,he==="Polygon"&&ae++}he==="Polygon"&&ee++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ae=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],R,ie,ee,ae)===!1)return!1;R++}ae++}ee++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(k4(p.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function aJ(e,t){t===void 0&&(t={});var n=t.precision,r=t.coordinates,a=t.mutate;if(n=n==null||isNaN(n)?6:n,r=r==null||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if(typeof n!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(a===!1||a===void 0)&&(e=JSON.parse(JSON.stringify(e)));var u=Math.pow(10,n);return k4(e,function(p){lJ(p,u,r)}),e}function lJ(e,t,n){e.length>n&&e.splice(n,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t;return e}function DD(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function uJ(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function cJ(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function hJ(e,t){cJ(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(DD(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(DD(R,a),r,C)===!1)return!1}})}function ND(e){if(!e)throw new Error("geojson is required");var t=[];return hJ(e,function(n){t.push(n)}),uJ(t)}function o2(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function kD(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return o2(r,t,n)}function z1(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function F4(e,t,n){if(e!==null)for(var r,a,u,p,i,b,C,A=0,R=0,z,V=e.type,W=V==="FeatureCollection",X=V==="Feature",ue=W?e.features.length:1,ie=0;ie<ue;ie++){C=W?e.features[ie].geometry:X?e.geometry:e,z=C?C.type==="GeometryCollection":!1,i=z?C.geometries.length:1;for(var K=0;K<i;K++){var ee=0,ae=0;if(p=z?C.geometries[K]:C,p!==null){b=p.coordinates;var he=p.type;switch(A=0,he){case null:break;case"Point":if(t(b,R,ie,ee,ae)===!1)return!1;R++,ee++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],R,ie,ee,ae)===!1)return!1;R++,he==="MultiPoint"&&ee++}he==="LineString"&&ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],R,ie,ee,ae)===!1)return!1;R++}he==="MultiLineString"&&ee++,he==="Polygon"&&ae++}he==="Polygon"&&ee++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ae=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],R,ie,ee,ae)===!1)return!1;R++}ae++}ee++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(F4(p.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function WM(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function dJ(e,t,n){var r=n;return WM(e,function(a,u){u===0&&n===void 0?r=a:r=t(r,a,u)}),r}function fJ(e,t){var n,r,a,u,p,i,b,C,A,R,z=0,V=e.type==="FeatureCollection",W=e.type==="Feature",X=V?e.features.length:1;for(n=0;n<X;n++){for(i=V?e.features[n].geometry:W?e.geometry:e,C=V?e.features[n].properties:W?e.properties:{},A=V?e.features[n].bbox:W?e.bbox:void 0,R=V?e.features[n].id:W?e.id:void 0,b=i?i.type==="GeometryCollection":!1,p=b?i.geometries.length:1,a=0;a<p;a++){if(u=b?i.geometries[a]:i,u===null){if(t(null,z,C,A,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,z,C,A,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],z,C,A,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function pJ(e,t){fJ(e,function(n,r,a,u,p){var i=n===null?null:n.type;switch(i){case null:case"Point":case"LineString":case"Polygon":return t(o2(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(i){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],R={type:b,coordinates:A};if(t(o2(R,a),r,C)===!1)return!1}})}function s2(e){var t=[1/0,1/0,-1/0,-1/0];return F4(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}s2.default=s2;function mJ(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var n=fD(e),r=fD(t);if(n!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var a=aJ(t,{precision:7});switch(r){case"Point":return a2(e,a);case"MultiPoint":return FD(e,a);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return FD(e,R4(e,a))}}function FD(e,t){var n=[],r=HM();return pJ(t,function(a){if(n.forEach(function(i,b){i.id=b}),!n.length)n=a2(e,a).features,n.forEach(function(i){i.bbox||(i.bbox=dK(s2(i)))}),r.load(z1(n));else{var u=r.search(a);if(u.features.length){var p=z4(a,u);n=n.filter(function(i){return i.id!==p.id}),r.remove(p),WM(a2(p,a),function(i){n.push(i),r.insert(i)})}}}),z1(n)}function a2(e,t){var n=[],r=Mp(e)[0],a=Mp(e)[e.geometry.coordinates.length-1];if(eI(r,Ip(t))||eI(a,Ip(t)))return z1([e]);var u=HM(),p=r2(e);u.load(p);var i=u.search(t);if(!i.features.length)return z1([e]);var b=z4(t,i),C=[r],A=dJ(p,function(R,z,V){var W=Mp(z)[1],X=Ip(t);return V===b.id?(R.push(X),n.push(kD(R)),eI(X,W)?[X]:[X,W]):(R.push(W),R)},C);return A.length>1&&n.push(kD(A)),z1(n)}function z4(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var n,r=1/0;return WM(t,function(a){var u=UK(a,e),p=u.properties.dist;p<r&&(n=a,r=p)}),n}function eI(e,t){return e[0]===t[0]&&e[1]===t[1]}function B4(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function gJ(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return B4(r,t,n)}function _J(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function yJ(e,t,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:e};return B4(r,t,n)}function vJ(e,t){t===void 0&&(t={});var n=Xc(e);switch(!t.properties&&e.type==="Feature"&&(t.properties=e.properties),n.type){case"Polygon":return xJ(n,t);case"MultiPolygon":return bJ(n,t);default:throw new Error("invalid poly")}}function xJ(e,t){t===void 0&&(t={});var n=Xc(e),r=n.coordinates,a=t.properties?t.properties:e.type==="Feature"?e.properties:{};return j4(r,a)}function bJ(e,t){t===void 0&&(t={});var n=Xc(e),r=n.coordinates,a=t.properties?t.properties:e.type==="Feature"?e.properties:{},u=[];return r.forEach(function(p){u.push(j4(p,a))}),_J(u)}function j4(e,t){return e.length>1?yJ(e,t):gJ(e[0],t)}function wJ(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties={},r.geometry=e,r}function SJ(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var u=a[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var i={type:"Polygon",coordinates:e};return wJ(i,t,n)}function EJ(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function CJ(e){return!!e&&e.constructor===Object}function zD(e){return function(){return e}}function TJ(e){return e[0]}function IJ(e){return e[1]}function WS(){this._=null}function qE(e){e.U=e.C=e.L=e.R=e.P=e.N=null}WS.prototype={constructor:WS,insert:function(e,t){var n,r,a;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=BD(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)r=n.U,n===r.L?(a=r.R,a&&a.C?(n.C=a.C=!1,r.C=!0,e=r):(e===n.R&&(v1(this,n),e=n,n=e.U),n.C=!1,r.C=!0,x1(this,r))):(a=r.L,a&&a.C?(n.C=a.C=!1,r.C=!0,e=r):(e===n.L&&(x1(this,n),e=n,n=e.U),n.C=!1,r.C=!0,v1(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,n,r=e.L,a=e.R,u,p;if(r?a?u=BD(a):u=r:u=a,t?t.L===e?t.L=u:t.R=u:this._=u,r&&a?(p=u.C,u.C=e.C,u.L=r,r.U=u,u!==a?(t=u.U,u.U=e.U,e=u.R,t.L=e,u.R=a,a.U=u):(u.U=t,t=u,e=u.R)):(p=e.C,e=u),e&&(e.U=t),!p){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(n=t.R,n.C&&(n.C=!1,t.C=!0,v1(this,t),n=t.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,x1(this,n),n=t.R),n.C=t.C,t.C=n.R.C=!1,v1(this,t),e=this._;break}}else if(n=t.L,n.C&&(n.C=!1,t.C=!0,x1(this,t),n=t.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,v1(this,n),n=t.L),n.C=t.C,t.C=n.L.C=!1,x1(this,t),e=this._;break}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function v1(e,t){var n=t,r=t.R,a=n.U;a?a.L===n?a.L=r:a.R=r:e._=r,r.U=a,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function x1(e,t){var n=t,r=t.L,a=n.U;a?a.L===n?a.L=r:a.R=r:e._=r,r.U=a,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function BD(e){for(;e.L;)e=e.L;return e}function N1(e,t,n,r){var a=[null,null],u=Vl.push(a)-1;return a.left=e,a.right=t,n&&XS(a,e,t,n),r&&XS(a,t,e,r),Vc[e.index].halfedges.push(u),Vc[t.index].halfedges.push(u),a}function b1(e,t,n){var r=[t,n];return r.left=e,r}function XS(e,t,n,r){!e[0]&&!e[1]?(e[0]=r,e.left=t,e.right=n):e.left===n?e[1]=r:e[0]=r}function MJ(e,t,n,r,a){var u=e[0],p=e[1],i=u[0],b=u[1],C=p[0],A=p[1],R=0,z=1,V=C-i,W=A-b,X;if(X=t-i,!(!V&&X>0)){if(X/=V,V<0){if(X<R)return;X<z&&(z=X)}else if(V>0){if(X>z)return;X>R&&(R=X)}if(X=r-i,!(!V&&X<0)){if(X/=V,V<0){if(X>z)return;X>R&&(R=X)}else if(V>0){if(X<R)return;X<z&&(z=X)}if(X=n-b,!(!W&&X>0)){if(X/=W,W<0){if(X<R)return;X<z&&(z=X)}else if(W>0){if(X>z)return;X>R&&(R=X)}if(X=a-b,!(!W&&X<0)){if(X/=W,W<0){if(X>z)return;X>R&&(R=X)}else if(W>0){if(X<R)return;X<z&&(z=X)}return!(R>0)&&!(z<1)||(R>0&&(e[0]=[i+R*V,b+R*W]),z<1&&(e[1]=[i+z*V,b+z*W])),!0}}}}}function PJ(e,t,n,r,a){var u=e[1];if(u)return!0;var p=e[0],i=e.left,b=e.right,C=i[0],A=i[1],R=b[0],z=b[1],V=(C+R)/2,W=(A+z)/2,X,ue;if(z===A){if(V<t||V>=r)return;if(C>R){if(!p)p=[V,n];else if(p[1]>=a)return;u=[V,a]}else{if(!p)p=[V,a];else if(p[1]<n)return;u=[V,n]}}else if(X=(C-R)/(z-A),ue=W-X*V,X<-1||X>1)if(C>R){if(!p)p=[(n-ue)/X,n];else if(p[1]>=a)return;u=[(a-ue)/X,a]}else{if(!p)p=[(a-ue)/X,a];else if(p[1]<n)return;u=[(n-ue)/X,n]}else if(A<z){if(!p)p=[t,X*t+ue];else if(p[0]>=r)return;u=[r,X*r+ue]}else{if(!p)p=[r,X*r+ue];else if(p[0]<t)return;u=[t,X*t+ue]}return e[0]=p,e[1]=u,!0}function AJ(e,t,n,r){for(var a=Vl.length,u;a--;)(!PJ(u=Vl[a],e,t,n,r)||!MJ(u,e,t,n,r)||!(Math.abs(u[0][0]-u[1][0])>ko||Math.abs(u[0][1]-u[1][1])>ko))&&delete Vl[a]}function RJ(e){return Vc[e.index]={site:e,halfedges:[]}}function LJ(e,t){var n=e.site,r=t.left,a=t.right;return n===a&&(a=r,r=n),a?Math.atan2(a[1]-r[1],a[0]-r[0]):(n===r?(r=t[1],a=t[0]):(r=t[0],a=t[1]),Math.atan2(r[0]-a[0],a[1]-r[1]))}function V4(e,t){return t[+(t.left!==e.site)]}function OJ(e,t){return t[+(t.left===e.site)]}function DJ(){for(var e=0,t=Vc.length,n,r,a,u;e<t;++e)if((n=Vc[e])&&(u=(r=n.halfedges).length)){var p=new Array(u),i=new Array(u);for(a=0;a<u;++a)p[a]=a,i[a]=LJ(n,Vl[r[a]]);for(p.sort(function(b,C){return i[C]-i[b]}),a=0;a<u;++a)i[a]=r[p[a]];for(a=0;a<u;++a)r[a]=i[a]}}function NJ(e,t,n,r){var a=Vc.length,u,p,i,b,C,A,R,z,V,W,X,ue,ie=!0;for(u=0;u<a;++u)if(p=Vc[u]){for(i=p.site,C=p.halfedges,b=C.length;b--;)Vl[C[b]]||C.splice(b,1);for(b=0,A=C.length;b<A;)W=OJ(p,Vl[C[b]]),X=W[0],ue=W[1],R=V4(p,Vl[C[++b%A]]),z=R[0],V=R[1],(Math.abs(X-z)>ko||Math.abs(ue-V)>ko)&&(C.splice(b,0,Vl.push(b1(i,W,Math.abs(X-e)<ko&&r-ue>ko?[e,Math.abs(z-e)<ko?V:r]:Math.abs(ue-r)<ko&&n-X>ko?[Math.abs(V-r)<ko?z:n,r]:Math.abs(X-n)<ko&&ue-t>ko?[n,Math.abs(z-n)<ko?V:t]:Math.abs(ue-t)<ko&&X-e>ko?[Math.abs(V-t)<ko?z:e,t]:null))-1),++A);A&&(ie=!1)}if(ie){var K,ee,ae,he=1/0;for(u=0,ie=null;u<a;++u)(p=Vc[u])&&(i=p.site,K=i[0]-e,ee=i[1]-t,ae=K*K+ee*ee,ae<he&&(he=ae,ie=p));if(ie){var xe=[e,t],ye=[e,r],Se=[n,r],je=[n,t];ie.halfedges.push(Vl.push(b1(i=ie.site,xe,ye))-1,Vl.push(b1(i,ye,Se))-1,Vl.push(b1(i,Se,je))-1,Vl.push(b1(i,je,xe))-1)}}for(u=0;u<a;++u)(p=Vc[u])&&(p.halfedges.length||delete Vc[u])}var U4=[],XM;function kJ(){qE(this),this.x=this.y=this.arc=this.site=this.cy=null}function g0(e){var t=e.P,n=e.N;if(!(!t||!n)){var r=t.site,a=e.site,u=n.site;if(r!==u){var p=a[0],i=a[1],b=r[0]-p,C=r[1]-i,A=u[0]-p,R=u[1]-i,z=2*(b*R-C*A);if(!(z>=-1e-12)){var V=b*b+C*C,W=A*A+R*R,X=(R*V-C*W)/z,ue=(b*W-A*V)/z,ie=U4.pop()||new kJ;ie.arc=e,ie.site=a,ie.x=X+p,ie.y=(ie.cy=ue+i)+Math.sqrt(X*X+ue*ue),e.circle=ie;for(var K=null,ee=W1._;ee;)if(ie.y<ee.y||ie.y===ee.y&&ie.x<=ee.x)if(ee.L)ee=ee.L;else{K=ee.P;break}else if(ee.R)ee=ee.R;else{K=ee;break}W1.insert(K,ie),K||(XM=ie)}}}}function b0(e){var t=e.circle;t&&(t.P||(XM=t.N),W1.remove(t),U4.push(t),qE(t),e.circle=null)}var G4=[];function FJ(){qE(this),this.edge=this.site=this.circle=null}function jD(e){var t=G4.pop()||new FJ;return t.site=e,t}function tI(e){b0(e),w0.remove(e),G4.push(e),qE(e)}function zJ(e){var t=e.circle,n=t.x,r=t.cy,a=[n,r],u=e.P,p=e.N,i=[e];tI(e);for(var b=u;b.circle&&Math.abs(n-b.circle.x)<ko&&Math.abs(r-b.circle.cy)<ko;)u=b.P,i.unshift(b),tI(b),b=u;i.unshift(b),b0(b);for(var C=p;C.circle&&Math.abs(n-C.circle.x)<ko&&Math.abs(r-C.circle.cy)<ko;)p=C.N,i.push(C),tI(C),C=p;i.push(C),b0(C);var A=i.length,R;for(R=1;R<A;++R)C=i[R],b=i[R-1],XS(C.edge,b.site,C.site,a);b=i[0],C=i[A-1],C.edge=N1(b.site,C.site,null,a),g0(b),g0(C)}function BJ(e){for(var t=e[0],n=e[1],r,a,u,p,i=w0._;i;)if(u=$4(i,n)-t,u>ko)i=i.L;else if(p=t-jJ(i,n),p>ko){if(!i.R){r=i;break}i=i.R}else{u>-1e-6?(r=i.P,a=i):p>-1e-6?(r=i,a=i.N):r=a=i;break}RJ(e);var b=jD(e);if(w0.insert(r,b),!(!r&&!a)){if(r===a){b0(r),a=jD(r.site),w0.insert(b,a),b.edge=a.edge=N1(r.site,b.site),g0(r),g0(a);return}if(!a){b.edge=N1(r.site,b.site);return}b0(r),b0(a);var C=r.site,A=C[0],R=C[1],z=e[0]-A,V=e[1]-R,W=a.site,X=W[0]-A,ue=W[1]-R,ie=2*(z*ue-V*X),K=z*z+V*V,ee=X*X+ue*ue,ae=[(ue*K-V*ee)/ie+A,(z*ee-X*K)/ie+R];XS(a.edge,C,W,ae),b.edge=N1(C,e,null,ae),a.edge=N1(e,W,null,ae),g0(r),g0(a)}}function $4(e,t){var n=e.site,r=n[0],a=n[1],u=a-t;if(!u)return r;var p=e.P;if(!p)return-1/0;n=p.site;var i=n[0],b=n[1],C=b-t;if(!C)return i;var A=i-r,R=1/u-1/C,z=A/C;return R?(-z+Math.sqrt(z*z-2*R*(A*A/(-2*C)-b+C/2+a-u/2)))/R+r:(r+i)/2}function jJ(e,t){var n=e.N;if(n)return $4(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var ko=1e-6,w0,Vc,W1,Vl;function VJ(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function UJ(e,t){return t[1]-e[1]||t[0]-e[0]}function l2(e,t){var n=e.sort(UJ).pop(),r,a,u;for(Vl=[],Vc=new Array(e.length),w0=new WS,W1=new WS;;)if(u=XM,n&&(!u||n[1]<u.y||n[1]===u.y&&n[0]<u.x))(n[0]!==r||n[1]!==a)&&(BJ(n),r=n[0],a=n[1]),n=e.pop();else if(u)zJ(u.arc);else break;if(DJ(),t){var p=+t[0][0],i=+t[0][1],b=+t[1][0],C=+t[1][1];AJ(p,i,b,C),NJ(p,i,b,C)}this.edges=Vl,this.cells=Vc,w0=W1=Vl=Vc=null}l2.prototype={constructor:l2,polygons:function(){var e=this.edges;return this.cells.map(function(t){var n=t.halfedges.map(function(r){return V4(t,e[r])});return n.data=t.site.data,n})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(n,r){if(i=(u=n.halfedges).length)for(var a=n.site,u,p=-1,i,b,C=t[u[i-1]],A=C.left===a?C.right:C.left;++p<i;)b=A,C=t[u[p]],A=C.left===a?C.right:C.left,b&&A&&r<b.index&&r<A.index&&VJ(a,b,A)<0&&e.push([a.data,b.data,A.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,n){for(var r=this,a,u=r._found||0,p=r.cells.length,i;!(i=r.cells[u]);)if(++u>=p)return null;var b=e-i.site[0],C=t-i.site[1],A=b*b+C*C;do i=r.cells[a=u],u=null,i.halfedges.forEach(function(R){var z=r.edges[R],V=z.left;if(!((V===i.site||!V)&&!(V=z.right))){var W=e-V[0],X=t-V[1],ue=W*W+X*X;ue<A&&(A=ue,u=V.index)}});while(u!==null);return r._found=a,n==null||A<=n*n?i.site:null}};function GJ(){var e=TJ,t=IJ,n=null;function r(a){return new l2(a.map(function(u,p){var i=[Math.round(e(u,p,a)/ko)*ko,Math.round(t(u,p,a)/ko)*ko];return i.index=p,i.data=u,i}),n)}return r.polygons=function(a){return r(a).polygons()},r.links=function(a){return r(a).links()},r.triangles=function(a){return r(a).triangles()},r.x=function(a){return arguments.length?(e=typeof a=="function"?a:zD(+a),r):e},r.y=function(a){return arguments.length?(t=typeof a=="function"?a:zD(+a),r):t},r.extent=function(a){return arguments.length?(n=a==null?null:[[+a[0][0],+a[0][1]],[+a[1][0],+a[1][1]]],r):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},r.size=function(a){return arguments.length?(n=a==null?null:[[0,0],[+a[0],+a[1]]],r):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},r}function $J(e){return e=e.slice(),e.push(e[0]),SJ([e])}function qJ(e,t){if(t=t||{},!CJ(t))throw new Error("options is invalid");var n=t.bbox||[-180,-85,180,85];if(!e)throw new Error("points is required");if(!Array.isArray(n))throw new Error("bbox is invalid");return I4(e,"Point","points"),EJ(GJ().x(function(r){return r.geometry.coordinates[0]}).y(function(r){return r.geometry.coordinates[1]}).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(e.features).map($J))}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function HJ(e,t){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,a,u,p;return p={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function i(C){return function(A){return b([C,A])}}function b(C){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(u=C[0]&2?a.return:C[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,C[1])).done)return u;switch(a=0,u&&(C=[C[0]&2,u.value]),C[0]){case 0:case 1:u=C;break;case 4:return n.label++,{value:C[1],done:!1};case 5:n.label++,a=C[1],C=[0];continue;case 7:C=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){n=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){n.label=C[1];break}if(C[0]===6&&n.label<u[1]){n.label=u[1],u=C;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(C);break}u[2]&&n.ops.pop(),n.trys.pop();continue}C=t.call(e,n)}catch(A){C=[6,A],a=0}finally{r=u=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var I_=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function WJ(e,t){return e>t?1:e<t?-1:0}function f_(e,t,n){for(var r=new I_(null,null),a=r,u=r;;){var p=n(e,t.key);if(p<0){if(t.left===null)break;if(n(e,t.left.key)<0){var i=t.left;if(t.left=i.right,i.right=t,t=i,t.left===null)break}u.left=t,u=t,t=t.left}else if(p>0){if(t.right===null)break;if(n(e,t.right.key)>0){var i=t.right;if(t.right=i.left,i.left=t,t=i,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,u.left=t.right,t.left=r.right,t.right=r.left,t}function nI(e,t,n,r){var a=new I_(e,t);if(n===null)return a.left=a.right=null,a;n=f_(e,n,r);var u=r(e,n.key);return u<0?(a.left=n.left,a.right=n,n.left=null):u>=0&&(a.right=n.right,a.left=n,n.right=null),a}function VD(e,t,n){var r=null,a=null;if(t){t=f_(e,t,n);var u=n(t.key,e);u===0?(r=t.left,a=t.right):u<0?(a=t.right,t.right=null,r=t):(r=t.left,t.left=null,a=t)}return{left:r,right:a}}function XJ(e,t,n){return t===null?e:(e===null||(t=f_(e.key,t,n),t.left=e),t)}function u2(e,t,n,r,a){if(e){r(""+t+(n?" ":" ")+a(e)+`
`);var u=t+(n?"    ":"   ");e.left&&u2(e.left,u,!1,r,a),e.right&&u2(e.right,u,!0,r,a)}}var ZM=function(){function e(t){t===void 0&&(t=WJ),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=nI(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var r=new I_(t,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var a=this._comparator,u=f_(t,this._root,a),p=a(t,u.key);return p===0?this._root=u:(p<0?(r.left=u.left,r.right=u,u.left=null):p>0&&(r.right=u.right,r.left=u,u.right=null),this._size++,this._root=r),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,r){var a;if(n===null)return null;n=f_(t,n,r);var u=r(t,n.key);return u===0?(n.left===null?a=n.right:(a=f_(t,n.left,r),a.right=n.right),this._size--,a):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=f_(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=f_(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var r=this._root,a=[],u=!1;!u;)r!==null?(a.push(r),r=r.left):a.length!==0?(r=a.pop(),t.call(n,r),r=r.right):u=!0;return this},e.prototype.range=function(t,n,r,a){for(var u=[],p=this._comparator,i=this._root,b;u.length!==0||i;)if(i)u.push(i),i=i.left;else{if(i=u.pop(),b=p(i.key,n),b>0)break;if(p(i.key,t)>=0&&r.call(a,i))return this;i=i.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var r=n.key;return t.push(r)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var r=n.data;return t.push(r)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,r=!1,a=0,u=[];!r;)if(n)u.push(n),n=n.left;else if(u.length>0){if(n=u.pop(),a===t)return n;a++,n=n.right}else r=!0;return null},e.prototype.next=function(t){var n=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var a=this._comparator;n;){var u=a(t.key,n.key);if(u===0)break;u<0?(r=n,n=n.left):n=n.right}return r},e.prototype.prev=function(t){var n=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var a=this._comparator;n;){var u=a(t.key,n.key);if(u===0)break;u<0?n=n.left:(r=n,n=n.right)}return r},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return YJ(this._root)},e.prototype.load=function(t,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var a=t.length,u=this._comparator;if(r&&d2(t,n,0,a-1,u),this._root===null)this._root=c2(t,n,0,a),this._size=a;else{var p=KJ(this.toList(),ZJ(t,n),u);a=this._size+a,this._root=h2({head:p},0,a)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var n=[];return u2(this._root,"",!0,function(r){return n.push(r)},t),n.join("")},e.prototype.update=function(t,n,r){var a=this._comparator,u=VD(t,this._root,a),p=u.left,i=u.right;a(t,n)<0?i=nI(n,r,i,a):p=nI(n,r,p,a),this._root=XJ(p,i,a)},e.prototype.split=function(t){return VD(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,r;return HJ(this,function(a){switch(a.label){case 0:t=this._root,n=[],r=!1,a.label=1;case 1:return r?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return a.sent(),t=t.right,[3,5];case 4:r=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function c2(e,t,n,r){var a=r-n;if(a>0){var u=n+Math.floor(a/2),p=e[u],i=t[u],b=new I_(p,i);return b.left=c2(e,t,n,u),b.right=c2(e,t,u+1,r),b}return null}function ZJ(e,t){for(var n=new I_(null,null),r=n,a=0;a<e.length;a++)r=r.next=new I_(e[a],t[a]);return r.next=null,n.next}function YJ(e){for(var t=e,n=[],r=!1,a=new I_(null,null),u=a;!r;)t?(n.push(t),t=t.left):n.length>0?(t=u=u.next=n.pop(),t=t.right):r=!0;return u.next=null,a.next}function h2(e,t,n){var r=n-t;if(r>0){var a=t+Math.floor(r/2),u=h2(e,t,a),p=e.head;return p.left=u,e.head=e.head.next,p.right=h2(e,a+1,n),p}return null}function KJ(e,t,n){for(var r=new I_(null,null),a=r,u=e,p=t;u!==null&&p!==null;)n(u.key,p.key)<0?(a.next=u,u=u.next):(a.next=p,p=p.next),a=a.next;return u!==null?a.next=u:p!==null&&(a.next=p),r.next}function d2(e,t,n,r,a){if(!(n>=r)){for(var u=e[n+r>>1],p=n-1,i=r+1;;){do p++;while(a(e[p],u)<0);do i--;while(a(e[i],u)>0);if(p>=i)break;var b=e[p];e[p]=e[i],e[i]=b,b=t[p],t[p]=t[i],t[i]=b}d2(e,t,n,i,a),d2(e,t,i+1,r,a)}}const Xm=11102230246251565e-32,Bl=134217729,JJ=(3+8*Xm)*Xm;function rI(e,t,n,r,a){let u,p,i,b,C=t[0],A=r[0],R=0,z=0;A>C==A>-C?(u=C,C=t[++R]):(u=A,A=r[++z]);let V=0;if(R<e&&z<n)for(A>C==A>-C?(p=C+u,i=u-(p-C),C=t[++R]):(p=A+u,i=u-(p-A),A=r[++z]),u=p,i!==0&&(a[V++]=i);R<e&&z<n;)A>C==A>-C?(p=u+C,b=p-u,i=u-(p-b)+(C-b),C=t[++R]):(p=u+A,b=p-u,i=u-(p-b)+(A-b),A=r[++z]),u=p,i!==0&&(a[V++]=i);for(;R<e;)p=u+C,b=p-u,i=u-(p-b)+(C-b),C=t[++R],u=p,i!==0&&(a[V++]=i);for(;z<n;)p=u+A,b=p-u,i=u-(p-b)+(A-b),A=r[++z],u=p,i!==0&&(a[V++]=i);return(u!==0||V===0)&&(a[V++]=u),V}function QJ(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function Lb(e){return new Float64Array(e)}const eQ=(3+16*Xm)*Xm,tQ=(2+12*Xm)*Xm,nQ=(9+64*Xm)*Xm*Xm,h0=Lb(4),UD=Lb(8),GD=Lb(12),$D=Lb(16),vu=Lb(4);function rQ(e,t,n,r,a,u,p){let i,b,C,A,R,z,V,W,X,ue,ie,K,ee,ae,he,xe,ye,Se;const je=e-a,Re=n-a,De=t-u,at=r-u;ae=je*at,z=Bl*je,V=z-(z-je),W=je-V,z=Bl*at,X=z-(z-at),ue=at-X,he=W*ue-(ae-V*X-W*X-V*ue),xe=De*Re,z=Bl*De,V=z-(z-De),W=De-V,z=Bl*Re,X=z-(z-Re),ue=Re-X,ye=W*ue-(xe-V*X-W*X-V*ue),ie=he-ye,R=he-ie,h0[0]=he-(ie+R)+(R-ye),K=ae+ie,R=K-ae,ee=ae-(K-R)+(ie-R),ie=ee-xe,R=ee-ie,h0[1]=ee-(ie+R)+(R-xe),Se=K+ie,R=Se-K,h0[2]=K-(Se-R)+(ie-R),h0[3]=Se;let ot=QJ(4,h0),Fe=tQ*p;if(ot>=Fe||-ot>=Fe||(R=e-je,i=e-(je+R)+(R-a),R=n-Re,C=n-(Re+R)+(R-a),R=t-De,b=t-(De+R)+(R-u),R=r-at,A=r-(at+R)+(R-u),i===0&&b===0&&C===0&&A===0)||(Fe=nQ*p+JJ*Math.abs(ot),ot+=je*A+at*i-(De*C+Re*b),ot>=Fe||-ot>=Fe))return ot;ae=i*at,z=Bl*i,V=z-(z-i),W=i-V,z=Bl*at,X=z-(z-at),ue=at-X,he=W*ue-(ae-V*X-W*X-V*ue),xe=b*Re,z=Bl*b,V=z-(z-b),W=b-V,z=Bl*Re,X=z-(z-Re),ue=Re-X,ye=W*ue-(xe-V*X-W*X-V*ue),ie=he-ye,R=he-ie,vu[0]=he-(ie+R)+(R-ye),K=ae+ie,R=K-ae,ee=ae-(K-R)+(ie-R),ie=ee-xe,R=ee-ie,vu[1]=ee-(ie+R)+(R-xe),Se=K+ie,R=Se-K,vu[2]=K-(Se-R)+(ie-R),vu[3]=Se;const Ze=rI(4,h0,4,vu,UD);ae=je*A,z=Bl*je,V=z-(z-je),W=je-V,z=Bl*A,X=z-(z-A),ue=A-X,he=W*ue-(ae-V*X-W*X-V*ue),xe=De*C,z=Bl*De,V=z-(z-De),W=De-V,z=Bl*C,X=z-(z-C),ue=C-X,ye=W*ue-(xe-V*X-W*X-V*ue),ie=he-ye,R=he-ie,vu[0]=he-(ie+R)+(R-ye),K=ae+ie,R=K-ae,ee=ae-(K-R)+(ie-R),ie=ee-xe,R=ee-ie,vu[1]=ee-(ie+R)+(R-xe),Se=K+ie,R=Se-K,vu[2]=K-(Se-R)+(ie-R),vu[3]=Se;const Ve=rI(Ze,UD,4,vu,GD);ae=i*A,z=Bl*i,V=z-(z-i),W=i-V,z=Bl*A,X=z-(z-A),ue=A-X,he=W*ue-(ae-V*X-W*X-V*ue),xe=b*C,z=Bl*b,V=z-(z-b),W=b-V,z=Bl*C,X=z-(z-C),ue=C-X,ye=W*ue-(xe-V*X-W*X-V*ue),ie=he-ye,R=he-ie,vu[0]=he-(ie+R)+(R-ye),K=ae+ie,R=K-ae,ee=ae-(K-R)+(ie-R),ie=ee-xe,R=ee-ie,vu[1]=ee-(ie+R)+(R-xe),Se=K+ie,R=Se-K,vu[2]=K-(Se-R)+(ie-R),vu[3]=Se;const mt=rI(Ve,GD,4,vu,$D);return $D[mt-1]}function iQ(e,t,n,r,a,u){const p=(t-u)*(n-a),i=(e-a)*(r-u),b=p-i,C=Math.abs(p+i);return Math.abs(b)>=eQ*C?b:-rQ(e,t,n,r,a,u,C)}var q4={};const w1=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,f2=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,a=e.ll.y<t.ll.y?t.ll.y:e.ll.y,u=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:a},ur:{x:r,y:u}}};let m_=Number.EPSILON;m_===void 0&&(m_=Math.pow(2,-52));const oQ=m_*m_,qD=(e,t)=>{if(-m_<e&&e<m_&&-m_<t&&t<m_)return 0;const n=e-t;return n*n<oQ*e*t?0:e<t?-1:1};class sQ{constructor(){this.reset()}reset(){this.xRounder=new HD,this.yRounder=new HD}round(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}class HD{constructor(){this.tree=new ZM,this.round(0)}round(t){const n=this.tree.add(t),r=this.tree.prev(n);if(r!==null&&qD(n.key,r.key)===0)return this.tree.remove(t),r.key;const a=this.tree.next(n);return a!==null&&qD(n.key,a.key)===0?(this.tree.remove(t),a.key):t}}const X1=new sQ,CS=(e,t)=>e.x*t.y-e.y*t.x,H4=(e,t)=>e.x*t.x+e.y*t.y,WD=(e,t,n)=>{const r=iQ(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},ZS=e=>Math.sqrt(H4(e,e)),aQ=(e,t,n)=>{const r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return CS(a,r)/ZS(a)/ZS(r)},lQ=(e,t,n)=>{const r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return H4(a,r)/ZS(a)/ZS(r)},XD=(e,t,n)=>t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n},ZD=(e,t,n)=>t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)},uQ=(e,t,n,r)=>{if(t.x===0)return ZD(n,r,e.x);if(r.x===0)return ZD(e,t,n.x);if(t.y===0)return XD(n,r,e.y);if(r.y===0)return XD(e,t,n.y);const a=CS(t,r);if(a==0)return null;const u={x:n.x-e.x,y:n.y-e.y},p=CS(u,t)/a,i=CS(u,r)/a,b=e.x+i*t.x,C=n.x+p*r.x,A=e.y+i*t.y,R=n.y+p*r.y,z=(b+C)/2,V=(A+R)/2;return{x:z,y:V}};class Uh{static compare(t,n){const r=Uh.comparePoints(t.point,n.point);return r!==0?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:y_.compare(t.segment,n.segment))}static comparePoints(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}constructor(t,n){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const n=t.point.events;for(let r=0,a=n.length;r<a;r++){const u=n[r];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let n=0;n<t;n++){const r=this.point.events[n];if(r.segment.consumedBy===void 0)for(let a=n+1;a<t;a++){const u=this.point.events[a];u.consumedBy===void 0&&r.otherSE.point.events===u.otherSE.point.events&&r.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const t=[];for(let n=0,r=this.point.events.length;n<r;n++){const a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}getLeftmostComparator(t){const n=new Map,r=a=>{const u=a.otherSE;n.set(a,{sine:aQ(this.point,t.point,u.point),cosine:lQ(this.point,t.point,u.point)})};return(a,u)=>{n.has(a)||r(a),n.has(u)||r(u);const{sine:p,cosine:i}=n.get(a),{sine:b,cosine:C}=n.get(u);return p>=0&&b>=0?i<C?1:i>C?-1:0:p<0&&b<0?i<C?-1:i>C?1:0:b<p?-1:b>p?1:0}}}let cQ=0;class y_{static compare(t,n){const r=t.leftSE.point.x,a=n.leftSE.point.x,u=t.rightSE.point.x,p=n.rightSE.point.x;if(p<r)return 1;if(u<a)return-1;const i=t.leftSE.point.y,b=n.leftSE.point.y,C=t.rightSE.point.y,A=n.rightSE.point.y;if(r<a){if(b<i&&b<C)return 1;if(b>i&&b>C)return-1;const R=t.comparePoint(n.leftSE.point);if(R<0)return 1;if(R>0)return-1;const z=n.comparePoint(t.rightSE.point);return z!==0?z:-1}if(r>a){if(i<b&&i<A)return-1;if(i>b&&i>A)return 1;const R=n.comparePoint(t.leftSE.point);if(R!==0)return R;const z=t.comparePoint(n.rightSE.point);return z<0?1:z>0?-1:1}if(i<b)return-1;if(i>b)return 1;if(u<p){const R=n.comparePoint(t.rightSE.point);if(R!==0)return R}if(u>p){const R=t.comparePoint(n.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(u!==p){const R=C-i,z=u-r,V=A-b,W=p-a;if(R>z&&V<W)return 1;if(R<z&&V>W)return-1}return u>p?1:u<p||C<A?-1:C>A?1:t.id<n.id?-1:t.id>n.id?1:0}constructor(t,n,r,a){this.id=++cQ,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=a}static fromRing(t,n,r){let a,u,p;const i=Uh.comparePoints(t,n);if(i<0)a=t,u=n,p=1;else if(i>0)a=n,u=t,p=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const b=new Uh(a,!0),C=new Uh(u,!1);return new y_(b,C,[r],[p])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const n=this.leftSE.point,r=this.rightSE.point,a=this.vector();if(n.x===r.x)return t.x===n.x?0:t.x<n.x?1:-1;const u=(t.y-n.y)/a.y,p=n.x+u*a.x;if(t.x===p)return 0;const i=(t.x-n.x)/a.x,b=n.y+i*a.y;return t.y===b?0:t.y<b?-1:1}getIntersection(t){const n=this.bbox(),r=t.bbox(),a=f2(n,r);if(a===null)return null;const u=this.leftSE.point,p=this.rightSE.point,i=t.leftSE.point,b=t.rightSE.point,C=w1(n,i)&&this.comparePoint(i)===0,A=w1(r,u)&&t.comparePoint(u)===0,R=w1(n,b)&&this.comparePoint(b)===0,z=w1(r,p)&&t.comparePoint(p)===0;if(A&&C)return z&&!R?p:!z&&R?b:null;if(A)return R&&u.x===b.x&&u.y===b.y?null:u;if(C)return z&&p.x===i.x&&p.y===i.y?null:i;if(z&&R)return null;if(z)return p;if(R)return b;const V=uQ(u,this.vector(),i,t.vector());return V===null||!w1(a,V)?null:X1.round(V.x,V.y)}split(t){const n=[],r=t.events!==void 0,a=new Uh(t,!0),u=new Uh(t,!1),p=this.rightSE;this.replaceRightSE(u),n.push(u),n.push(a);const i=new y_(a,p,this.rings.slice(),this.windings.slice());return Uh.comparePoints(i.leftSE.point,i.rightSE.point)>0&&i.swapEvents(),Uh.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(a.checkForConsuming(),u.checkForConsuming()),n}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}consume(t){let n=this,r=t;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const a=y_.compare(n,r);if(a!==0){if(a>0){const u=n;n=r,r=u}if(n.prev===r){const u=n;n=r,r=u}for(let u=0,p=r.rings.length;u<p;u++){const i=r.rings[u],b=r.windings[u],C=n.rings.indexOf(i);C===-1?(n.rings.push(i),n.windings.push(b)):n.windings[C]+=b}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,r=this._afterState.windings,a=this._afterState.multiPolys;for(let i=0,b=this.rings.length;i<b;i++){const C=this.rings[i],A=this.windings[i],R=n.indexOf(C);R===-1?(n.push(C),r.push(A)):r[R]+=A}const u=[],p=[];for(let i=0,b=n.length;i<b;i++){if(r[i]===0)continue;const C=n[i],A=C.poly;if(p.indexOf(A)===-1)if(C.isExterior)u.push(A);else{p.indexOf(A)===-1&&p.push(A);const R=u.indexOf(C.poly);R!==-1&&u.splice(R,1)}}for(let i=0,b=u.length;i<b;i++){const C=u[i].multiPoly;a.indexOf(C)===-1&&a.push(C)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Yd.type){case"union":{const r=t.length===0,a=n.length===0;this._isInResult=r!==a;break}case"intersection":{let r,a;t.length<n.length?(r=t.length,a=n.length):(r=n.length,a=t.length),this._isInResult=a===Yd.numMultiPolys&&r<a;break}case"xor":{const r=Math.abs(t.length-n.length);this._isInResult=r%2===1;break}case"difference":{const r=a=>a.length===1&&a[0].isSubject;this._isInResult=r(t)!==r(n);break}default:throw new Error(`Unrecognized operation type found ${Yd.type}`)}return this._isInResult}}class YD{constructor(t,n,r){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=X1.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let u=a;for(let p=1,i=t.length;p<i;p++){if(typeof t[p][0]!="number"||typeof t[p][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let b=X1.round(t[p][0],t[p][1]);b.x===u.x&&b.y===u.y||(this.segments.push(y_.fromRing(u,b,this)),b.x<this.bbox.ll.x&&(this.bbox.ll.x=b.x),b.y<this.bbox.ll.y&&(this.bbox.ll.y=b.y),b.x>this.bbox.ur.x&&(this.bbox.ur.x=b.x),b.y>this.bbox.ur.y&&(this.bbox.ur.y=b.y),u=b)}(a.x!==u.x||a.y!==u.y)&&this.segments.push(y_.fromRing(u,a,this))}getSweepEvents(){const t=[];for(let n=0,r=this.segments.length;n<r;n++){const a=this.segments[n];t.push(a.leftSE),t.push(a.rightSE)}return t}}class hQ{constructor(t,n){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new YD(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,a=t.length;r<a;r++){const u=new YD(t[r],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=n}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let n=0,r=this.interiorRings.length;n<r;n++){const a=this.interiorRings[n].getSweepEvents();for(let u=0,p=a.length;u<p;u++)t.push(a[u])}return t}}class KD{constructor(t,n){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,a=t.length;r<a;r++){const u=new hQ(t[r],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=n}getSweepEvents(){const t=[];for(let n=0,r=this.polys.length;n<r;n++){const a=this.polys[n].getSweepEvents();for(let u=0,p=a.length;u<p;u++)t.push(a[u])}return t}}class YS{static factory(t){const n=[];for(let r=0,a=t.length;r<a;r++){const u=t[r];if(!u.isInResult()||u.ringOut)continue;let p=null,i=u.leftSE,b=u.rightSE;const C=[i],A=i.point,R=[];for(;p=i,i=b,C.push(i),i.point!==A;)for(;;){const z=i.getAvailableLinkedEvents();if(z.length===0){const X=C[0].point,ue=C[C.length-1].point;throw new Error(`Unable to complete output ring starting at [${X.x}, ${X.y}]. Last matching segment found ends at [${ue.x}, ${ue.y}].`)}if(z.length===1){b=z[0].otherSE;break}let V=null;for(let X=0,ue=R.length;X<ue;X++)if(R[X].point===i.point){V=X;break}if(V!==null){const X=R.splice(V)[0],ue=C.splice(X.index);ue.unshift(ue[0].otherSE),n.push(new YS(ue.reverse()));continue}R.push({index:C.length,point:i.point});const W=i.getLeftmostComparator(p);b=z.sort(W)[0].otherSE;break}n.push(new YS(C))}return n}constructor(t){this.events=t;for(let n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const n=[t];for(let C=1,A=this.events.length-1;C<A;C++){const R=this.events[C].point,z=this.events[C+1].point;WD(R,t,z)!==0&&(n.push(R),t=R)}if(n.length===1)return null;const r=n[0],a=n[1];WD(r,t,a)===0&&n.shift(),n.push(n[0]);const u=this.isExteriorRing()?1:-1,p=this.isExteriorRing()?0:n.length-1,i=this.isExteriorRing()?n.length:-1,b=[];for(let C=p;C!=i;C+=u)b.push([n[C].x,n[C].y]);return b}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let a=1,u=this.events.length;a<u;a++){const p=this.events[a];Uh.compare(t,p)>0&&(t=p)}let n=t.segment.prevInResult(),r=n?n.prevInResult():null;for(;;){if(!n)return null;if(!r)return n.ringOut;if(r.ringOut!==n.ringOut)return r.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=r.prevInResult(),r=n?n.prevInResult():null}}}class JD{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let n=0,r=this.interiorRings.length;n<r;n++){const a=this.interiorRings[n].getGeom();a!==null&&t.push(a)}return t}}class dQ{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let n=0,r=this.polys.length;n<r;n++){const a=this.polys[n].getGeom();a!==null&&t.push(a)}return t}_composePolys(t){const n=[];for(let r=0,a=t.length;r<a;r++){const u=t[r];if(!u.poly)if(u.isExteriorRing())n.push(new JD(u));else{const p=u.enclosingRing();p.poly||n.push(new JD(p)),p.poly.addInterior(u)}}return n}}class fQ{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y_.compare;this.queue=t,this.tree=new ZM(n),this.segments=[]}process(t){const n=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),r;const a=t.isLeft?this.tree.add(n):this.tree.find(n);if(!a)throw new Error(`Unable to find segment #${n.id} [${n.leftSE.point.x}, ${n.leftSE.point.y}] -> [${n.rightSE.point.x}, ${n.rightSE.point.y}] in SweepLine tree.`);let u=a,p=a,i,b;for(;i===void 0;)u=this.tree.prev(u),u===null?i=null:u.key.consumedBy===void 0&&(i=u.key);for(;b===void 0;)p=this.tree.next(p),p===null?b=null:p.key.consumedBy===void 0&&(b=p.key);if(t.isLeft){let C=null;if(i){const R=i.getIntersection(n);if(R!==null&&(n.isAnEndpoint(R)||(C=R),!i.isAnEndpoint(R))){const z=this._splitSafely(i,R);for(let V=0,W=z.length;V<W;V++)r.push(z[V])}}let A=null;if(b){const R=b.getIntersection(n);if(R!==null&&(n.isAnEndpoint(R)||(A=R),!b.isAnEndpoint(R))){const z=this._splitSafely(b,R);for(let V=0,W=z.length;V<W;V++)r.push(z[V])}}if(C!==null||A!==null){let R=null;C===null?R=A:A===null?R=C:R=Uh.comparePoints(C,A)<=0?C:A,this.queue.remove(n.rightSE),r.push(n.rightSE);const z=n.split(R);for(let V=0,W=z.length;V<W;V++)r.push(z[V])}r.length>0?(this.tree.remove(n),r.push(t)):(this.segments.push(n),n.prev=i)}else{if(i&&b){const C=i.getIntersection(b);if(C!==null){if(!i.isAnEndpoint(C)){const A=this._splitSafely(i,C);for(let R=0,z=A.length;R<z;R++)r.push(A[R])}if(!b.isAnEndpoint(C)){const A=this._splitSafely(b,C);for(let R=0,z=A.length;R<z;R++)r.push(A[R])}}}this.tree.remove(n)}return r}_splitSafely(t,n){this.tree.remove(t);const r=t.rightSE;this.queue.remove(r);const a=t.split(n);return a.push(r),t.consumedBy===void 0&&this.tree.add(t),a}}const QD=typeof process<"u"&&q4.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,pQ=typeof process<"u"&&q4.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class mQ{run(t,n,r){Yd.type=t,X1.reset();const a=[new KD(n,!0)];for(let R=0,z=r.length;R<z;R++)a.push(new KD(r[R],!1));if(Yd.numMultiPolys=a.length,Yd.type==="difference"){const R=a[0];let z=1;for(;z<a.length;)f2(a[z].bbox,R.bbox)!==null?z++:a.splice(z,1)}if(Yd.type==="intersection")for(let R=0,z=a.length;R<z;R++){const V=a[R];for(let W=R+1,X=a.length;W<X;W++)if(f2(V.bbox,a[W].bbox)===null)return[]}const u=new ZM(Uh.compare);for(let R=0,z=a.length;R<z;R++){const V=a[R].getSweepEvents();for(let W=0,X=V.length;W<X;W++)if(u.insert(V[W]),u.size>QD)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const p=new fQ(u);let i=u.size,b=u.pop();for(;b;){const R=b.key;if(u.size===i){const V=R.segment;throw new Error(`Unable to pop() ${R.isLeft?"left":"right"} SweepEvent [${R.point.x}, ${R.point.y}] from segment #${V.id} [${V.leftSE.point.x}, ${V.leftSE.point.y}] -> [${V.rightSE.point.x}, ${V.rightSE.point.y}] from queue.`)}if(u.size>QD)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(p.segments.length>pQ)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const z=p.process(R);for(let V=0,W=z.length;V<W;V++){const X=z[V];X.consumedBy===void 0&&u.insert(X)}i=u.size,b=u.pop()}X1.reset();const C=YS.factory(p.segments);return new dQ(C).getGeom()}}const Yd=new mQ,gQ=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Yd.run("union",e,n)},_Q=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Yd.run("intersection",e,n)},yQ=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Yd.run("xor",e,n)},vQ=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Yd.run("difference",e,n)};var Z1={union:gQ,intersection:_Q,xor:yQ,difference:vQ};function W4(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function xQ(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var u=a[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var i={type:"Polygon",coordinates:e};return W4(i,t,n)}function bQ(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return W4(r,t,n)}function wQ(e,t){var n=Xc(e),r=Xc(t),a=e.properties||{},u=Z1.difference(n.coordinates,r.coordinates);return u.length===0?null:u.length===1?xQ(u[0],a):bQ(u,a)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var n=Object(this),r=Math.max(Math.min(n.length,9007199254740991),0)||0,a=1 in arguments&&parseInt(Number(arguments[1]),10)||0;a=a<0?Math.max(r+a,0):Math.min(a,r);var u=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(u=u<0?Math.max(r+arguments[2],0):Math.min(u,r);a<u;)n[a]=t,++a;return n},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var $y=function(){};$y.prototype.interfaces_=function(){return[]};$y.prototype.getClass=function(){return $y};$y.prototype.equalsWithTolerance=function(t,n,r){return Math.abs(t-n)<=r};var po=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Dr=function(){},X4={MAX_VALUE:{configurable:!0}};Dr.isNaN=function(t){return Number.isNaN(t)};Dr.doubleToLongBits=function(t){return t};Dr.longBitsToDouble=function(t){return t};Dr.isInfinite=function(t){return!Number.isFinite(t)};X4.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Dr,X4);var gc=function(){},HE=function(){},A0=function(){};function _c(){}var Ot=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},uv={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Ot.prototype.setOrdinate=function(t,n){switch(t){case Ot.X:this.x=n;break;case Ot.Y:this.y=n;break;case Ot.Z:this.z=n;break;default:throw new po("Invalid ordinate index: "+t)}};Ot.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return!(!$y.equalsWithTolerance(this.x,n.x,r)||!$y.equalsWithTolerance(this.y,n.y,r))}};Ot.prototype.getOrdinate=function(t){switch(t){case Ot.X:return this.x;case Ot.Y:return this.y;case Ot.Z:return this.z}throw new po("Invalid ordinate index: "+t)};Ot.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Dr.isNaN(this.z))&&Dr.isNaN(t.z)};Ot.prototype.equals=function(t){return t instanceof Ot?this.equals2D(t):!1};Ot.prototype.equalInZ=function(t,n){return $y.equalsWithTolerance(this.z,t.z,n)};Ot.prototype.compareTo=function(t){var n=t;return this.x<n.x?-1:this.x>n.x?1:this.y<n.y?-1:this.y>n.y?1:0};Ot.prototype.clone=function(){};Ot.prototype.copy=function(){return new Ot(this)};Ot.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Ot.prototype.distance3D=function(t){var n=this.x-t.x,r=this.y-t.y,a=this.z-t.z;return Math.sqrt(n*n+r*r+a*a)};Ot.prototype.distance=function(t){var n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)};Ot.prototype.hashCode=function(){var t=17;return t=37*t+Ot.hashCode(this.x),t=37*t+Ot.hashCode(this.y),t};Ot.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};Ot.prototype.interfaces_=function(){return[gc,HE,_c]};Ot.prototype.getClass=function(){return Ot};Ot.hashCode=function(){if(arguments.length===1){var t=arguments[0],n=Dr.doubleToLongBits(t);return Math.trunc((n^n)>>>32)}};uv.DimensionalComparator.get=function(){return $m};uv.serialVersionUID.get=function(){return 6683108902428367e3};uv.NULL_ORDINATE.get=function(){return Dr.NaN};uv.X.get=function(){return 0};uv.Y.get=function(){return 1};uv.Z.get=function(){return 2};Object.defineProperties(Ot,uv);var $m=function(t){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var n=arguments[0];if(n!==2&&n!==3)throw new po("only 2 or 3 dimensions may be specified");this._dimensionsToTest=n}}};$m.prototype.compare=function(t,n){var r=t,a=n,u=$m.compare(r.x,a.x);if(u!==0)return u;var p=$m.compare(r.y,a.y);if(p!==0)return p;if(this._dimensionsToTest<=2)return 0;var i=$m.compare(r.z,a.z);return i};$m.prototype.interfaces_=function(){return[A0]};$m.prototype.getClass=function(){return $m};$m.compare=function(t,n){return t<n?-1:t>n?1:Dr.isNaN(t)?Dr.isNaN(n)?0:-1:Dr.isNaN(n)?1:0};var R0=function(){};R0.prototype.create=function(){};R0.prototype.interfaces_=function(){return[]};R0.prototype.getClass=function(){return R0};var zt=function(){},Ob={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.toLocationSymbol=function(t){switch(t){case zt.EXTERIOR:return"e";case zt.BOUNDARY:return"b";case zt.INTERIOR:return"i";case zt.NONE:return"-"}throw new po("Unknown location value: "+t)};Ob.INTERIOR.get=function(){return 0};Ob.BOUNDARY.get=function(){return 1};Ob.EXTERIOR.get=function(){return 2};Ob.NONE.get=function(){return-1};Object.defineProperties(zt,Ob);var xr=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Iu=function(){},Z4={LOG_10:{configurable:!0}};Iu.prototype.interfaces_=function(){return[]};Iu.prototype.getClass=function(){return Iu};Iu.log10=function(t){var n=Math.log(t);return Dr.isInfinite(n)||Dr.isNaN(n)?n:n/Iu.LOG_10};Iu.min=function(t,n,r,a){var u=t;return n<u&&(u=n),r<u&&(u=r),a<u&&(u=a),u};Iu.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1],r=arguments[2];return t<n?n:t>r?r:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],u=arguments[1],p=arguments[2];return a<u?u:a>p?p:a}};Iu.wrap=function(t,n){return t<0?n- -t%n:t%n};Iu.max=function(){if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],a=t;return n>a&&(a=n),r>a&&(a=r),a}else if(arguments.length===4){var u=arguments[0],p=arguments[1],i=arguments[2],b=arguments[3],C=u;return p>C&&(C=p),i>C&&(C=i),b>C&&(C=b),C}};Iu.average=function(t,n){return(t+n)/2};Z4.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Iu,Z4);var pd=function(t){this.str=t};pd.prototype.append=function(t){this.str+=t};pd.prototype.setCharAt=function(t,n){this.str=this.str.substr(0,t)+n+this.str.substr(t+1)};pd.prototype.toString=function(t){return this.str};var nd=function(t){this.value=t};nd.prototype.intValue=function(){return this.value};nd.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};nd.isNaN=function(t){return Number.isNaN(t)};var Y1=function(){};Y1.isWhitespace=function(t){return t<=32&&t>=0||t===127};Y1.toUpperCase=function(t){return t.toUpperCase()};var Ht=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];e.call(this,e.parse(r))}}else if(arguments.length===2){var a=arguments[0],u=arguments[1];this.init(a,u)}},rh={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ht.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};Ht.prototype.extractSignificantDigits=function(t,n){var r=this.abs(),a=Ht.magnitude(r._hi),u=Ht.TEN.pow(a);r=r.divide(u),r.gt(Ht.TEN)?(r=r.divide(Ht.TEN),a+=1):r.lt(Ht.ONE)&&(r=r.multiply(Ht.TEN),a-=1);for(var p=a+1,i=new pd,b=Ht.MAX_PRINT_DIGITS-1,C=0;C<=b;C++){t&&C===p&&i.append(".");var A=Math.trunc(r._hi);if(A<0)break;var R=!1,z=0;A>9?(R=!0,z="9"):z="0"+A,i.append(z),r=r.subtract(Ht.valueOf(A)).multiply(Ht.TEN),R&&r.selfAdd(Ht.TEN);var V=!0,W=Ht.magnitude(r._hi);if(W<0&&Math.abs(W)>=b-C&&(V=!1),!V)break}return n[0]=a,i.toString()};Ht.prototype.sqr=function(){return this.multiply(this)};Ht.prototype.doubleValue=function(){return this._hi+this._lo};Ht.prototype.subtract=function(){if(arguments[0]instanceof Ht){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.add(-n)}};Ht.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};Ht.prototype.isZero=function(){return this._hi===0&&this._lo===0};Ht.prototype.selfSubtract=function(){if(arguments[0]instanceof Ht){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}};Ht.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Ht.prototype.min=function(t){return this.le(t)?this:t};Ht.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ht){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfDivide(n,0)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u=null,p=null,i=null,b=null,C=null,A=null,R=null,z=null;return C=this._hi/r,A=Ht.SPLIT*C,u=A-C,z=Ht.SPLIT*r,u=A-u,p=C-u,i=z-r,R=C*r,i=z-i,b=r-i,z=u*i-R+u*b+p*i+p*b,A=(this._hi-R-z+this._lo-C*a)/r,z=C+A,this._hi=z,this._lo=C-z+A,this}};Ht.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Ht.prototype.divide=function(){if(arguments[0]instanceof Ht){var t=arguments[0],n=null,r=null,a=null,u=null,p=null,i=null,b=null,C=null;p=this._hi/t._hi,i=Ht.SPLIT*p,n=i-p,C=Ht.SPLIT*t._hi,n=i-n,r=p-n,a=C-t._hi,b=p*t._hi,a=C-a,u=t._hi-a,C=n*a-b+n*u+r*a+r*u,i=(this._hi-b-C+this._lo-p*t._lo)/t._hi,C=p+i;var A=C,R=p-C+i;return new Ht(A,R)}else if(typeof arguments[0]=="number"){var z=arguments[0];return Dr.isNaN(z)?Ht.createNaN():Ht.copy(this).selfDivide(z,0)}};Ht.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};Ht.prototype.pow=function(t){if(t===0)return Ht.valueOf(1);var n=new Ht(this),r=Ht.valueOf(1),a=Math.abs(t);if(a>1)for(;a>0;)a%2===1&&r.selfMultiply(n),a/=2,a>0&&(n=n.sqr());else r=n;return t<0?r.reciprocal():r};Ht.prototype.ceil=function(){if(this.isNaN())return Ht.NaN;var t=Math.ceil(this._hi),n=0;return t===this._hi&&(n=Math.ceil(this._lo)),new Ht(t,n)};Ht.prototype.compareTo=function(t){var n=t;return this._hi<n._hi?-1:this._hi>n._hi?1:this._lo<n._lo?-1:this._lo>n._lo?1:0};Ht.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};Ht.prototype.setValue=function(){if(arguments[0]instanceof Ht){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.init(n),this}};Ht.prototype.max=function(t){return this.ge(t)?this:t};Ht.prototype.sqrt=function(){if(this.isZero())return Ht.valueOf(0);if(this.isNegative())return Ht.NaN;var t=1/Math.sqrt(this._hi),n=this._hi*t,r=Ht.valueOf(n),a=this.subtract(r.sqr()),u=a._hi*(t*.5);return r.add(u)};Ht.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ht){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0],r=null,a=null,u=null,p=null,i=null,b=null;return u=this._hi+n,i=u-this._hi,p=u-i,p=n-i+(this._hi-p),b=p+this._lo,r=u+b,a=b+(u-r),this._hi=r+a,this._lo=a+(r-this._hi),this}}else if(arguments.length===2){var C=arguments[0],A=arguments[1],R=null,z=null,V=null,W=null,X=null,ue=null,ie=null,K=null;X=this._hi+C,V=this._lo+A,ie=X-this._hi,K=V-this._lo,ue=X-ie,W=V-K,ue=C-ie+(this._hi-ue),W=A-K+(this._lo-W),ie=ue+V,R=X+ie,z=ie+(X-R),ie=W+z;var ee=R+ie,ae=ie+(R-ee);return this._hi=ee,this._lo=ae,this}};Ht.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ht){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfMultiply(n,0)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u=null,p=null,i=null,b=null,C=null,A=null;C=Ht.SPLIT*this._hi,u=C-this._hi,A=Ht.SPLIT*r,u=C-u,p=this._hi-u,i=A-r,C=this._hi*r,i=A-i,b=r-i,A=u*i-C+u*b+p*i+p*b+(this._hi*a+this._lo*r);var R=C+A;u=C-R;var z=A+u;return this._hi=R,this._lo=z,this}};Ht.prototype.selfSqr=function(){return this.selfMultiply(this)};Ht.prototype.floor=function(){if(this.isNaN())return Ht.NaN;var t=Math.floor(this._hi),n=0;return t===this._hi&&(n=Math.floor(this._lo)),new Ht(t,n)};Ht.prototype.negate=function(){return this.isNaN()?this:new Ht(-this._hi,-this._lo)};Ht.prototype.clone=function(){};Ht.prototype.multiply=function(){if(arguments[0]instanceof Ht){var t=arguments[0];return t.isNaN()?Ht.createNaN():Ht.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var n=arguments[0];return Dr.isNaN(n)?Ht.createNaN():Ht.copy(this).selfMultiply(n,0)}};Ht.prototype.isNaN=function(){return Dr.isNaN(this._hi)};Ht.prototype.intValue=function(){return Math.trunc(this._hi)};Ht.prototype.toString=function(){var t=Ht.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};Ht.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!0,n),a=n[0]+1,u=r;if(r.charAt(0)===".")u="0"+r;else if(a<0)u="0."+Ht.stringOfChar("0",-a)+r;else if(r.indexOf(".")===-1){var p=a-r.length,i=Ht.stringOfChar("0",p);u=r+i+".0"}return this.isNegative()?"-"+u:u};Ht.prototype.reciprocal=function(){var t=null,n=null,r=null,a=null,u=null,p=null,i=null,b=null;u=1/this._hi,p=Ht.SPLIT*u,t=p-u,b=Ht.SPLIT*this._hi,t=p-t,n=u-t,r=b-this._hi,i=u*this._hi,r=b-r,a=this._hi-r,b=t*r-i+t*a+n*r+n*a,p=(1-i-b-u*this._lo)/this._hi;var C=u+p,A=u-C+p;return new Ht(C,A)};Ht.prototype.toSciNotation=function(){if(this.isZero())return Ht.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!1,n),a=Ht.SCI_NOT_EXPONENT_CHAR+n[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var u="";r.length>1&&(u=r.substring(1));var p=r.charAt(0)+"."+u;return this.isNegative()?"-"+p+a:p+a};Ht.prototype.abs=function(){return this.isNaN()?Ht.NaN:this.isNegative()?this.negate():new Ht(this)};Ht.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Ht.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};Ht.prototype.add=function(){if(arguments[0]instanceof Ht){var t=arguments[0];return Ht.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var n=arguments[0];return Ht.copy(this).selfAdd(n)}};Ht.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Ht){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this._hi=r,this._lo=a}};Ht.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};Ht.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Ht.prototype.trunc=function(){return this.isNaN()?Ht.NaN:this.isPositive()?this.floor():this.ceil()};Ht.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Ht.prototype.interfaces_=function(){return[_c,gc,HE]};Ht.prototype.getClass=function(){return Ht};Ht.sqr=function(t){return Ht.valueOf(t).selfMultiply(t)};Ht.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return Ht.parse(t)}else if(typeof arguments[0]=="number"){var n=arguments[0];return new Ht(n)}};Ht.sqrt=function(t){return Ht.valueOf(t).sqrt()};Ht.parse=function(t){for(var n=0,r=t.length;Y1.isWhitespace(t.charAt(n));)n++;var a=!1;if(n<r){var u=t.charAt(n);(u==="-"||u==="+")&&(n++,u==="-"&&(a=!0))}for(var p=new Ht,i=0,b=0,C=0;!(n>=r);){var A=t.charAt(n);if(n++,Y1.isDigit(A)){var R=A-"0";p.selfMultiply(Ht.TEN),p.selfAdd(R),i++;continue}if(A==="."){b=i;continue}if(A==="e"||A==="E"){var z=t.substring(n);try{C=nd.parseInt(z)}catch(ie){throw ie instanceof Error?new Error("Invalid exponent "+z+" in string "+t):ie}finally{}break}throw new Error("Unexpected character '"+A+"' at position "+n+" in string "+t)}var V=p,W=i-b-C;if(W===0)V=p;else if(W>0){var X=Ht.TEN.pow(W);V=p.divide(X)}else if(W<0){var ue=Ht.TEN.pow(-W);V=p.multiply(ue)}return a?V.negate():V};Ht.createNaN=function(){return new Ht(Dr.NaN,Dr.NaN)};Ht.copy=function(t){return new Ht(t)};Ht.magnitude=function(t){var n=Math.abs(t),r=Math.log(n)/Math.log(10),a=Math.trunc(Math.floor(r)),u=Math.pow(10,a);return u*10<=n&&(a+=1),a};Ht.stringOfChar=function(t,n){for(var r=new pd,a=0;a<n;a++)r.append(t);return r.toString()};rh.PI.get=function(){return new Ht(3.141592653589793,12246467991473532e-32)};rh.TWO_PI.get=function(){return new Ht(6.283185307179586,24492935982947064e-32)};rh.PI_2.get=function(){return new Ht(1.5707963267948966,6123233995736766e-32)};rh.E.get=function(){return new Ht(2.718281828459045,14456468917292502e-32)};rh.NaN.get=function(){return new Ht(Dr.NaN,Dr.NaN)};rh.EPS.get=function(){return 123259516440783e-46};rh.SPLIT.get=function(){return 134217729};rh.MAX_PRINT_DIGITS.get=function(){return 32};rh.TEN.get=function(){return Ht.valueOf(10)};rh.ONE.get=function(){return Ht.valueOf(1)};rh.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};rh.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Ht,rh);var gl=function(){},Y4={DP_SAFE_EPSILON:{configurable:!0}};gl.prototype.interfaces_=function(){return[]};gl.prototype.getClass=function(){return gl};gl.orientationIndex=function(t,n,r){var a=gl.orientationIndexFilter(t,n,r);if(a<=1)return a;var u=Ht.valueOf(n.x).selfAdd(-t.x),p=Ht.valueOf(n.y).selfAdd(-t.y),i=Ht.valueOf(r.x).selfAdd(-n.x),b=Ht.valueOf(r.y).selfAdd(-n.y);return u.selfMultiply(b).selfSubtract(p.selfMultiply(i)).signum()};gl.signOfDet2x2=function(t,n,r,a){var u=t.multiply(a).selfSubtract(n.multiply(r));return u.signum()};gl.intersection=function(t,n,r,a){var u=Ht.valueOf(a.y).selfSubtract(r.y).selfMultiply(Ht.valueOf(n.x).selfSubtract(t.x)),p=Ht.valueOf(a.x).selfSubtract(r.x).selfMultiply(Ht.valueOf(n.y).selfSubtract(t.y)),i=u.subtract(p),b=Ht.valueOf(a.x).selfSubtract(r.x).selfMultiply(Ht.valueOf(t.y).selfSubtract(r.y)),C=Ht.valueOf(a.y).selfSubtract(r.y).selfMultiply(Ht.valueOf(t.x).selfSubtract(r.x)),A=b.subtract(C),R=A.selfDivide(i).doubleValue(),z=Ht.valueOf(t.x).selfAdd(Ht.valueOf(n.x).selfSubtract(t.x).selfMultiply(R)).doubleValue(),V=Ht.valueOf(n.x).selfSubtract(t.x).selfMultiply(Ht.valueOf(t.y).selfSubtract(r.y)),W=Ht.valueOf(n.y).selfSubtract(t.y).selfMultiply(Ht.valueOf(t.x).selfSubtract(r.x)),X=V.subtract(W),ue=X.selfDivide(i).doubleValue(),ie=Ht.valueOf(r.y).selfAdd(Ht.valueOf(a.y).selfSubtract(r.y).selfMultiply(ue)).doubleValue();return new Ot(z,ie)};gl.orientationIndexFilter=function(t,n,r){var a=null,u=(t.x-r.x)*(n.y-r.y),p=(t.y-r.y)*(n.x-r.x),i=u-p;if(u>0){if(p<=0)return gl.signum(i);a=u+p}else if(u<0){if(p>=0)return gl.signum(i);a=-u-p}else return gl.signum(i);var b=gl.DP_SAFE_EPSILON*a;return i>=b||-i>=b?gl.signum(i):2};gl.signum=function(t){return t>0?1:t<0?-1:0};Y4.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(gl,Y4);var ci=function(){},Db={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Db.X.get=function(){return 0};Db.Y.get=function(){return 1};Db.Z.get=function(){return 2};Db.M.get=function(){return 3};ci.prototype.setOrdinate=function(t,n,r){};ci.prototype.size=function(){};ci.prototype.getOrdinate=function(t,n){};ci.prototype.getCoordinate=function(){};ci.prototype.getCoordinateCopy=function(t){};ci.prototype.getDimension=function(){};ci.prototype.getX=function(t){};ci.prototype.clone=function(){};ci.prototype.expandEnvelope=function(t){};ci.prototype.copy=function(){};ci.prototype.getY=function(t){};ci.prototype.toCoordinateArray=function(){};ci.prototype.interfaces_=function(){return[HE]};ci.prototype.getClass=function(){return ci};Object.defineProperties(ci,Db);var K4=function(){},vx=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(K4),ta=function(){};ta.arraycopy=function(t,n,r,a,u){for(var p=0,i=n;i<n+u;i++)r[a+p]=t[i],p++};ta.getProperty=function(t){return{"line.separator":`
`}[t]};var $c=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[0],u=arguments[1];this.x=a.y*u.w-u.y*a.w,this.y=u.x*a.w-a.x*u.w,this.w=a.x*u.y-u.x*a.y}else if(arguments[0]instanceof Ot&&arguments[1]instanceof Ot){var p=arguments[0],i=arguments[1];this.x=p.y-i.y,this.y=i.x-p.x,this.w=p.x*i.y-i.x*p.y}}else if(arguments.length===3){var b=arguments[0],C=arguments[1],A=arguments[2];this.x=b,this.y=C,this.w=A}else if(arguments.length===4){var R=arguments[0],z=arguments[1],V=arguments[2],W=arguments[3],X=R.y-z.y,ue=z.x-R.x,ie=R.x*z.y-z.x*R.y,K=V.y-W.y,ee=W.x-V.x,ae=V.x*W.y-W.x*V.y;this.x=ue*ae-ee*ie,this.y=K*ie-X*ae,this.w=X*ee-K*ue}};$c.prototype.getY=function(){var t=this.y/this.w;if(Dr.isNaN(t)||Dr.isInfinite(t))throw new vx;return t};$c.prototype.getX=function(){var t=this.x/this.w;if(Dr.isNaN(t)||Dr.isInfinite(t))throw new vx;return t};$c.prototype.getCoordinate=function(){var t=new Ot;return t.x=this.getX(),t.y=this.getY(),t};$c.prototype.interfaces_=function(){return[]};$c.prototype.getClass=function(){return $c};$c.intersection=function(t,n,r,a){var u=t.y-n.y,p=n.x-t.x,i=t.x*n.y-n.x*t.y,b=r.y-a.y,C=a.x-r.x,A=r.x*a.y-a.x*r.y,R=p*A-C*i,z=b*i-u*A,V=u*C-b*p,W=R/V,X=z/V;if(Dr.isNaN(W)||Dr.isInfinite(W)||Dr.isNaN(X)||Dr.isInfinite(X))throw new vx;return new Ot(W,X)};var Qn=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Ot){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.init(r.x,a.x,r.y,a.y)}else if(arguments.length===4){var u=arguments[0],p=arguments[1],i=arguments[2],b=arguments[3];this.init(u,p,i,b)}},J4={serialVersionUID:{configurable:!0}};Qn.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Qn.prototype.equals=function(t){if(!(t instanceof Qn))return!1;var n=t;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()};Qn.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Qn;var n=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny,a=this._maxx<t._maxx?this._maxx:t._maxx,u=this._maxy<t._maxy?this._maxy:t._maxy;return new Qn(n,a,r,u)};Qn.prototype.isNull=function(){return this._maxx<this._minx};Qn.prototype.getMaxX=function(){return this._maxx};Qn.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Ot){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];return this.isNull()||n.isNull()?!1:n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&a>=this._miny&&a<=this._maxy}};Qn.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Qn){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof Ot){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||a>this._maxy||a<this._miny)}};Qn.prototype.getMinY=function(){return this._miny};Qn.prototype.getMinX=function(){return this._minx};Qn.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Ot){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=a,this._maxy=a):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),a<this._miny&&(this._miny=a),a>this._maxy&&(this._maxy=a))}};Qn.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),n=this.getHeight();return t<n?t:n};Qn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Qn.prototype.compareTo=function(t){var n=t;return this.isNull()?n.isNull()?0:-1:n.isNull()?1:this._minx<n._minx?-1:this._minx>n._minx?1:this._miny<n._miny?-1:this._miny>n._miny?1:this._maxx<n._maxx?-1:this._maxx>n._maxx?1:this._maxy<n._maxy?-1:this._maxy>n._maxy?1:0};Qn.prototype.translate=function(t,n){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+n,this.getMaxY()+n)};Qn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Qn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Qn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Qn.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),n=this.getHeight();return t>n?t:n};Qn.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=n,this._maxx+=n,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Qn.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Qn){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof Ot){var n=arguments[0];return this.covers(n)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.covers(r,a)}};Qn.prototype.centre=function(){return this.isNull()?null:new Ot((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Qn.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Ot){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.init(r.x,a.x,r.y,a.y)}else if(arguments.length===4){var u=arguments[0],p=arguments[1],i=arguments[2],b=arguments[3];u<p?(this._minx=u,this._maxx=p):(this._minx=p,this._maxx=u),i<b?(this._miny=i,this._maxy=b):(this._miny=b,this._maxy=i)}};Qn.prototype.getMaxY=function(){return this._maxy};Qn.prototype.distance=function(t){if(this.intersects(t))return 0;var n=0;this._maxx<t._minx?n=t._minx-this._maxx:this._minx>t._maxx&&(n=this._minx-t._maxx);var r=0;return this._maxy<t._miny?r=t._miny-this._maxy:this._miny>t._maxy&&(r=this._miny-t._maxy),n===0?r:r===0?n:Math.sqrt(n*n+r*r)};Qn.prototype.hashCode=function(){var t=17;return t=37*t+Ot.hashCode(this._minx),t=37*t+Ot.hashCode(this._maxx),t=37*t+Ot.hashCode(this._miny),t=37*t+Ot.hashCode(this._maxy),t};Qn.prototype.interfaces_=function(){return[gc,_c]};Qn.prototype.getClass=function(){return Qn};Qn.intersects=function(){if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2];return r.x>=(t.x<n.x?t.x:n.x)&&r.x<=(t.x>n.x?t.x:n.x)&&r.y>=(t.y<n.y?t.y:n.y)&&r.y<=(t.y>n.y?t.y:n.y)}else if(arguments.length===4){var a=arguments[0],u=arguments[1],p=arguments[2],i=arguments[3],b=Math.min(p.x,i.x),C=Math.max(p.x,i.x),A=Math.min(a.x,u.x),R=Math.max(a.x,u.x);return!(A>C||R<b||(b=Math.min(p.y,i.y),C=Math.max(p.y,i.y),A=Math.min(a.y,u.y),R=Math.max(a.y,u.y),A>C)||R<b)}};J4.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Qn,J4);var zh={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},WE=function(t){this.geometryFactory=t||new ti};WE.prototype.read=function(t){var n,r,a;t=t.replace(/[\n\r]/g," ");var u=zh.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(u=zh.emptyTypeStr.exec(t),u[2]=void 0),u&&(r=u[1].toLowerCase(),a=u[2],_0[r]&&(n=_0[r].apply(this,[a]))),n===void 0)throw new Error("Could not parse WKT "+t);return n};WE.prototype.write=function(t){return this.extractGeometry(t)};WE.prototype.extractGeometry=function(t){var n=t.getGeometryType().toLowerCase();if(!gp[n])return null;var r=n.toUpperCase(),a;return t.isEmpty()?a=r+" EMPTY":a=r+"("+gp[n].apply(this,[t])+")",a};var gp={coordinate:function(t){return t.x+" "+t.y},point:function(t){return gp.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var n=this,r=[],a=0,u=t._geometries.length;a<u;++a)r.push("("+gp.point.apply(n,[t._geometries[a]])+")");return r.join(",")},linestring:function(t){for(var n=this,r=[],a=0,u=t._points._coordinates.length;a<u;++a)r.push(gp.coordinate.apply(n,[t._points._coordinates[a]]));return r.join(",")},linearring:function(t){for(var n=this,r=[],a=0,u=t._points._coordinates.length;a<u;++a)r.push(gp.coordinate.apply(n,[t._points._coordinates[a]]));return r.join(",")},multilinestring:function(t){for(var n=this,r=[],a=0,u=t._geometries.length;a<u;++a)r.push("("+gp.linestring.apply(n,[t._geometries[a]])+")");return r.join(",")},polygon:function(t){var n=this,r=[];r.push("("+gp.linestring.apply(this,[t._shell])+")");for(var a=0,u=t._holes.length;a<u;++a)r.push("("+gp.linestring.apply(n,[t._holes[a]])+")");return r.join(",")},multipolygon:function(t){for(var n=this,r=[],a=0,u=t._geometries.length;a<u;++a)r.push("("+gp.polygon.apply(n,[t._geometries[a]])+")");return r.join(",")},geometrycollection:function(t){for(var n=this,r=[],a=0,u=t._geometries.length;a<u;++a)r.push(n.extractGeometry(t._geometries[a]));return r.join(",")}},_0={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var n=t.trim().split(zh.spaces);return this.geometryFactory.createPoint(new Ot(Number.parseFloat(n[0]),Number.parseFloat(n[1])))},multipoint:function(t){var n=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var r,a=t.trim().split(","),u=[],p=0,i=a.length;p<i;++p)r=a[p].replace(zh.trimParens,"$1"),u.push(_0.point.apply(n,[r]));return this.geometryFactory.createMultiPoint(u)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var n=t.trim().split(","),r=[],a,u=0,p=n.length;u<p;++u)a=n[u].trim().split(zh.spaces),r.push(new Ot(Number.parseFloat(a[0]),Number.parseFloat(a[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var n=t.trim().split(","),r=[],a,u=0,p=n.length;u<p;++u)a=n[u].trim().split(zh.spaces),r.push(new Ot(Number.parseFloat(a[0]),Number.parseFloat(a[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){var n=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var r,a=t.trim().split(zh.parenComma),u=[],p=0,i=a.length;p<i;++p)r=a[p].replace(zh.trimParens,"$1"),u.push(_0.linestring.apply(n,[r]));return this.geometryFactory.createMultiLineString(u)},polygon:function(t){var n=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var r,a,u,p=t.trim().split(zh.parenComma),i,b=[],C=0,A=p.length;C<A;++C)r=p[C].replace(zh.trimParens,"$1"),a=_0.linestring.apply(n,[r]),u=n.geometryFactory.createLinearRing(a._points),C===0?i=u:b.push(u);return this.geometryFactory.createPolygon(i,b)},multipolygon:function(t){var n=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var r,a=t.trim().split(zh.doubleParenComma),u=[],p=0,i=a.length;p<i;++p)r=a[p].replace(zh.trimParens,"$1"),u.push(_0.polygon.apply(n,[r]));return this.geometryFactory.createMultiPolygon(u)},geometrycollection:function(t){var n=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=t.trim().split("|"),a=[],u=0,p=r.length;u<p;++u)a.push(n.read(r[u]));return this.geometryFactory.createGeometryCollection(a)}},Zc=function(t){this.parser=new WE(t)};Zc.prototype.write=function(t){return this.parser.write(t)};Zc.toLineString=function(t,n){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+n.x+" "+n.y+" )"};var Lp=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),KS=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Lp),qr=function(){};qr.prototype.interfaces_=function(){return[]};qr.prototype.getClass=function(){return qr};qr.shouldNeverReachHere=function(){if(arguments.length===0)qr.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new KS("Should never reach here"+(t!==null?": "+t:""))}};qr.isTrue=function(){var t,n;if(arguments.length===1)t=arguments[0],qr.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],n=arguments[1],!t))throw n===null?new KS:new KS(n)};qr.equals=function(){var t,n,r;if(arguments.length===2)t=arguments[0],n=arguments[1],qr.equals(t,n,null);else if(arguments.length===3&&(t=arguments[0],n=arguments[1],r=arguments[2],!n.equals(t)))throw new KS("Expected "+t+" but encountered "+n+(r!==null?": "+r:""))};var So=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Ot,this._intPt[1]=new Ot,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},cv={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};So.prototype.getIndexAlongSegment=function(t,n){return this.computeIntLineIndex(),this._intLineIndex[t][n]};So.prototype.getTopologySummary=function(){var t=new pd;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};So.prototype.computeIntersection=function(t,n,r,a){this._inputLines[0][0]=t,this._inputLines[0][1]=n,this._inputLines[1][0]=r,this._inputLines[1][1]=a,this._result=this.computeIntersect(t,n,r,a)};So.prototype.getIntersectionNum=function(){return this._result};So.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],n=this.getEdgeDistance(t,0),r=this.getEdgeDistance(t,1);n>r?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};So.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};So.prototype.setPrecisionModel=function(t){this._precisionModel=t};So.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var n=arguments[0],r=0;r<this._result;r++)if(!(t._intPt[r].equals2D(t._inputLines[n][0])||t._intPt[r].equals2D(t._inputLines[n][1])))return!0;return!1}};So.prototype.getIntersection=function(t){return this._intPt[t]};So.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};So.prototype.hasIntersection=function(){return this._result!==So.NO_INTERSECTION};So.prototype.getEdgeDistance=function(t,n){var r=So.computeEdgeDistance(this._intPt[n],this._inputLines[t][0],this._inputLines[t][1]);return r};So.prototype.isCollinear=function(){return this._result===So.COLLINEAR_INTERSECTION};So.prototype.toString=function(){return Zc.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Zc.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};So.prototype.getEndpoint=function(t,n){return this._inputLines[t][n]};So.prototype.isIntersection=function(t){for(var n=this,r=0;r<this._result;r++)if(n._intPt[r].equals2D(t))return!0;return!1};So.prototype.getIntersectionAlongSegment=function(t,n){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][n]]};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};So.computeEdgeDistance=function(t,n,r){var a=Math.abs(r.x-n.x),u=Math.abs(r.y-n.y),p=-1;if(t.equals(n))p=0;else if(t.equals(r))a>u?p=a:p=u;else{var i=Math.abs(t.x-n.x),b=Math.abs(t.y-n.y);a>u?p=i:p=b,p===0&&!t.equals(n)&&(p=Math.max(i,b))}return qr.isTrue(!(p===0&&!t.equals(n)),"Bad distance calculation"),p};So.nonRobustComputeEdgeDistance=function(t,n,r){var a=t.x-n.x,u=t.y-n.y,p=Math.sqrt(a*a+u*u);return qr.isTrue(!(p===0&&!t.equals(n)),"Invalid distance calculation"),p};cv.DONT_INTERSECT.get=function(){return 0};cv.DO_INTERSECT.get=function(){return 1};cv.COLLINEAR.get=function(){return 2};cv.NO_INTERSECTION.get=function(){return 0};cv.POINT_INTERSECTION.get=function(){return 1};cv.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(So,cv);var G_=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(r){var a=new Qn(this._inputLines[0][0],this._inputLines[0][1]),u=new Qn(this._inputLines[1][0],this._inputLines[1][1]);return a.contains(r)&&u.contains(r)},t.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];if(this._isProper=!1,Qn.intersects(a,u,r)&&On.orientationIndex(a,u,r)===0&&On.orientationIndex(u,a,r)===0)return this._isProper=!0,(r.equals(a)||r.equals(u))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(r,a,u,p,i){i.x=this.smallestInAbsValue(r.x,a.x,u.x,p.x),i.y=this.smallestInAbsValue(r.y,a.y,u.y,p.y),r.x-=i.x,r.y-=i.y,a.x-=i.x,a.y-=i.y,u.x-=i.x,u.y-=i.y,p.x-=i.x,p.y-=i.y},t.prototype.safeHCoordinateIntersection=function(r,a,u,p){var i=null;try{i=$c.intersection(r,a,u,p)}catch(b){if(b instanceof vx)i=t.nearestEndpoint(r,a,u,p);else throw b}finally{}return i},t.prototype.intersection=function(r,a,u,p){var i=this.intersectionWithNormalization(r,a,u,p);return this.isInSegmentEnvelopes(i)||(i=new Ot(t.nearestEndpoint(r,a,u,p))),this._precisionModel!==null&&this._precisionModel.makePrecise(i),i},t.prototype.smallestInAbsValue=function(r,a,u,p){var i=r,b=Math.abs(i);return Math.abs(a)<b&&(i=a,b=Math.abs(a)),Math.abs(u)<b&&(i=u,b=Math.abs(u)),Math.abs(p)<b&&(i=p),i},t.prototype.checkDD=function(r,a,u,p,i){var b=gl.intersection(r,a,u,p),C=this.isInSegmentEnvelopes(b);ta.out.println("DD in env = "+C+"  --------------------- "+b),i.distance(b)>1e-4&&ta.out.println("Distance = "+i.distance(b))},t.prototype.intersectionWithNormalization=function(r,a,u,p){var i=new Ot(r),b=new Ot(a),C=new Ot(u),A=new Ot(p),R=new Ot;this.normalizeToEnvCentre(i,b,C,A,R);var z=this.safeHCoordinateIntersection(i,b,C,A);return z.x+=R.x,z.y+=R.y,z},t.prototype.computeCollinearIntersection=function(r,a,u,p){var i=Qn.intersects(r,a,u),b=Qn.intersects(r,a,p),C=Qn.intersects(u,p,r),A=Qn.intersects(u,p,a);return i&&b?(this._intPt[0]=u,this._intPt[1]=p,e.COLLINEAR_INTERSECTION):C&&A?(this._intPt[0]=r,this._intPt[1]=a,e.COLLINEAR_INTERSECTION):i&&C?(this._intPt[0]=u,this._intPt[1]=r,u.equals(r)&&!b&&!A?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):i&&A?(this._intPt[0]=u,this._intPt[1]=a,u.equals(a)&&!b&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):b&&C?(this._intPt[0]=p,this._intPt[1]=r,p.equals(r)&&!i&&!A?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):b&&A?(this._intPt[0]=p,this._intPt[1]=a,p.equals(a)&&!i&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(r,a,u,p,i){var b=r.x<a.x?r.x:a.x,C=r.y<a.y?r.y:a.y,A=r.x>a.x?r.x:a.x,R=r.y>a.y?r.y:a.y,z=u.x<p.x?u.x:p.x,V=u.y<p.y?u.y:p.y,W=u.x>p.x?u.x:p.x,X=u.y>p.y?u.y:p.y,ue=b>z?b:z,ie=A<W?A:W,K=C>V?C:V,ee=R<X?R:X,ae=(ue+ie)/2,he=(K+ee)/2;i.x=ae,i.y=he,r.x-=i.x,r.y-=i.y,a.x-=i.x,a.y-=i.y,u.x-=i.x,u.y-=i.y,p.x-=i.x,p.y-=i.y},t.prototype.computeIntersect=function(r,a,u,p){if(this._isProper=!1,!Qn.intersects(r,a,u,p))return e.NO_INTERSECTION;var i=On.orientationIndex(r,a,u),b=On.orientationIndex(r,a,p);if(i>0&&b>0||i<0&&b<0)return e.NO_INTERSECTION;var C=On.orientationIndex(u,p,r),A=On.orientationIndex(u,p,a);if(C>0&&A>0||C<0&&A<0)return e.NO_INTERSECTION;var R=i===0&&b===0&&C===0&&A===0;return R?this.computeCollinearIntersection(r,a,u,p):(i===0||b===0||C===0||A===0?(this._isProper=!1,r.equals2D(u)||r.equals2D(p)?this._intPt[0]=r:a.equals2D(u)||a.equals2D(p)?this._intPt[0]=a:i===0?this._intPt[0]=new Ot(u):b===0?this._intPt[0]=new Ot(p):C===0?this._intPt[0]=new Ot(r):A===0&&(this._intPt[0]=new Ot(a))):(this._isProper=!0,this._intPt[0]=this.intersection(r,a,u,p)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(r,a,u,p){var i=r,b=On.distancePointLine(r,u,p),C=On.distancePointLine(a,u,p);return C<b&&(b=C,i=a),C=On.distancePointLine(u,r,a),C<b&&(b=C,i=u),C=On.distancePointLine(p,r,a),C<b&&(b=C,i=p),i},t}(So),qy=function(){};qy.prototype.interfaces_=function(){return[]};qy.prototype.getClass=function(){return qy};qy.orientationIndex=function(t,n,r){var a=n.x-t.x,u=n.y-t.y,p=r.x-n.x,i=r.y-n.y;return qy.signOfDet2x2(a,u,p,i)};qy.signOfDet2x2=function(t,n,r,a){var u=null,p=null,i=null;if(u=1,t===0||a===0)return n===0||r===0?0:n>0?r>0?-u:u:r>0?u:-u;if(n===0||r===0)return a>0?t>0?u:-u:t>0?-u:u;if(n>0?a>0?n<=a||(u=-u,p=t,t=r,r=p,p=n,n=a,a=p):n<=-a?(u=-u,r=-r,a=-a):(p=t,t=-r,r=p,p=n,n=-a,a=p):a>0?-n<=a?(u=-u,t=-t,n=-n):(p=-t,t=r,r=p,p=-n,n=a,a=p):n>=a?(t=-t,n=-n,r=-r,a=-a):(u=-u,p=-t,t=-r,r=p,p=-n,n=-a,a=p),t>0)if(r>0){if(!(t<=r))return u}else return u;else{if(r>0)return-u;if(t>=r)u=-u,t=-t,r=-r;else return-u}for(;;){if(i=Math.floor(r/t),r=r-i*t,a=a-i*n,a<0)return-u;if(a>n)return u;if(t>r+r){if(n<a+a)return u}else{if(n>a+a)return-u;r=t-r,a=n-a,u=-u}if(a===0)return r===0?0:-u;if(r===0||(i=Math.floor(t/r),t=t-i*r,n=n-i*a,n<0))return u;if(n>a)return-u;if(r>t+t){if(a<n+n)return-u}else{if(a>n+n)return u;t=r-t,n=a-n,u=-u}if(n===0)return t===0?0:u;if(t===0)return-u}};var Xh=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Xh.prototype.countSegment=function(t,n){if(t.x<this._p.x&&n.x<this._p.x)return null;if(this._p.x===n.x&&this._p.y===n.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&n.y===this._p.y){var r=t.x,a=n.x;return r>a&&(r=n.x,a=t.x),this._p.x>=r&&this._p.x<=a&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&n.y<=this._p.y||n.y>this._p.y&&t.y<=this._p.y){var u=t.x-this._p.x,p=t.y-this._p.y,i=n.x-this._p.x,b=n.y-this._p.y,C=qy.signOfDet2x2(u,p,i,b);if(C===0)return this._isPointOnSegment=!0,null;b<p&&(C=-C),C>0&&this._crossingCount++}};Xh.prototype.isPointInPolygon=function(){return this.getLocation()!==zt.EXTERIOR};Xh.prototype.getLocation=function(){return this._isPointOnSegment?zt.BOUNDARY:this._crossingCount%2===1?zt.INTERIOR:zt.EXTERIOR};Xh.prototype.isOnSegment=function(){return this._isPointOnSegment};Xh.prototype.interfaces_=function(){return[]};Xh.prototype.getClass=function(){return Xh};Xh.locatePointInRing=function(){if(arguments[0]instanceof Ot&&xr(arguments[1],ci)){for(var t=arguments[0],n=arguments[1],r=new Xh(t),a=new Ot,u=new Ot,p=1;p<n.size();p++)if(n.getCoordinate(p,a),n.getCoordinate(p-1,u),r.countSegment(a,u),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof Ot&&arguments[1]instanceof Array){for(var i=arguments[0],b=arguments[1],C=new Xh(i),A=1;A<b.length;A++){var R=b[A],z=b[A-1];if(C.countSegment(R,z),C.isOnSegment())return C.getLocation()}return C.getLocation()}};var On=function(){},hv={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};On.prototype.interfaces_=function(){return[]};On.prototype.getClass=function(){return On};On.orientationIndex=function(t,n,r){return gl.orientationIndex(t,n,r)};On.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var n=0,r=t[0].x,a=1;a<t.length-1;a++){var u=t[a].x-r,p=t[a+1].y,i=t[a-1].y;n+=u*(i-p)}return n/2}else if(xr(arguments[0],ci)){var b=arguments[0],C=b.size();if(C<3)return 0;var A=new Ot,R=new Ot,z=new Ot;b.getCoordinate(0,R),b.getCoordinate(1,z);var V=R.x;z.x-=V;for(var W=0,X=1;X<C-1;X++)A.y=R.y,R.x=z.x,R.y=z.y,b.getCoordinate(X+1,z),z.x-=V,W+=R.x*(A.y-z.y);return W/2}};On.distanceLineLine=function(t,n,r,a){if(t.equals(n))return On.distancePointLine(t,r,a);if(r.equals(a))return On.distancePointLine(a,t,n);var u=!1;if(!Qn.intersects(t,n,r,a))u=!0;else{var p=(n.x-t.x)*(a.y-r.y)-(n.y-t.y)*(a.x-r.x);if(p===0)u=!0;else{var i=(t.y-r.y)*(a.x-r.x)-(t.x-r.x)*(a.y-r.y),b=(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y),C=b/p,A=i/p;(A<0||A>1||C<0||C>1)&&(u=!0)}}return u?Iu.min(On.distancePointLine(t,r,a),On.distancePointLine(n,r,a),On.distancePointLine(r,t,n),On.distancePointLine(a,t,n)):0};On.isPointInRing=function(t,n){return On.locatePointInRing(t,n)!==zt.EXTERIOR};On.computeLength=function(t){var n=t.size();if(n<=1)return 0;var r=0,a=new Ot;t.getCoordinate(0,a);for(var u=a.x,p=a.y,i=1;i<n;i++){t.getCoordinate(i,a);var b=a.x,C=a.y,A=b-u,R=C-p;r+=Math.sqrt(A*A+R*R),u=b,p=C}return r};On.isCCW=function(t){var n=t.length-1;if(n<3)throw new po("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],a=0,u=1;u<=n;u++){var p=t[u];p.y>r.y&&(r=p,a=u)}var i=a;do i=i-1,i<0&&(i=n);while(t[i].equals2D(r)&&i!==a);var b=a;do b=(b+1)%n;while(t[b].equals2D(r)&&b!==a);var C=t[i],A=t[b];if(C.equals2D(r)||A.equals2D(r)||C.equals2D(A))return!1;var R=On.computeOrientation(C,r,A),z=!1;return R===0?z=C.x>A.x:z=R>0,z};On.locatePointInRing=function(t,n){return Xh.locatePointInRing(t,n)};On.distancePointLinePerpendicular=function(t,n,r){var a=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),u=((n.y-t.y)*(r.x-n.x)-(n.x-t.x)*(r.y-n.y))/a;return Math.abs(u)*Math.sqrt(a)};On.computeOrientation=function(t,n,r){return On.orientationIndex(t,n,r)};On.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];if(n.length===0)throw new po("Line array must contain at least one vertex");for(var r=t.distance(n[0]),a=0;a<n.length-1;a++){var u=On.distancePointLine(t,n[a],n[a+1]);u<r&&(r=u)}return r}else if(arguments.length===3){var p=arguments[0],i=arguments[1],b=arguments[2];if(i.x===b.x&&i.y===b.y)return p.distance(i);var C=(b.x-i.x)*(b.x-i.x)+(b.y-i.y)*(b.y-i.y),A=((p.x-i.x)*(b.x-i.x)+(p.y-i.y)*(b.y-i.y))/C;if(A<=0)return p.distance(i);if(A>=1)return p.distance(b);var R=((i.y-p.y)*(b.x-i.x)-(i.x-p.x)*(b.y-i.y))/C;return Math.abs(R)*Math.sqrt(C)}};On.isOnLine=function(t,n){for(var r=new G_,a=1;a<n.length;a++){var u=n[a-1],p=n[a];if(r.computeIntersection(t,u,p),r.hasIntersection())return!0}return!1};hv.CLOCKWISE.get=function(){return-1};hv.RIGHT.get=function(){return On.CLOCKWISE};hv.COUNTERCLOCKWISE.get=function(){return 1};hv.LEFT.get=function(){return On.COUNTERCLOCKWISE};hv.COLLINEAR.get=function(){return 0};hv.STRAIGHT.get=function(){return On.COLLINEAR};Object.defineProperties(On,hv);var Op=function(){};Op.prototype.filter=function(t){};Op.prototype.interfaces_=function(){return[]};Op.prototype.getClass=function(){return Op};var yr=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},wf={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};yr.prototype.isGeometryCollection=function(){return this.getSortIndex()===yr.SORTINDEX_GEOMETRYCOLLECTION};yr.prototype.getFactory=function(){return this._factory};yr.prototype.getGeometryN=function(t){return this};yr.prototype.getArea=function(){return 0};yr.prototype.isRectangle=function(){return!1};yr.prototype.equals=function(){if(arguments[0]instanceof yr){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var n=arguments[0];if(!(n instanceof yr))return!1;var r=n;return this.equalsExact(r)}};yr.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};yr.prototype.geometryChanged=function(){this.apply(yr.geometryChangedFilter)};yr.prototype.geometryChangedAction=function(){this._envelope=null};yr.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};yr.prototype.getLength=function(){return 0};yr.prototype.getNumGeometries=function(){return 1};yr.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],n=t;return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,a)}};yr.prototype.getUserData=function(){return this._userData};yr.prototype.getSRID=function(){return this._SRID};yr.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};yr.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===yr.SORTINDEX_GEOMETRYCOLLECTION)throw new po("This method does not support GeometryCollection arguments")};yr.prototype.equal=function(t,n,r){return r===0?t.equals(n):t.distance(n)<=r};yr.prototype.norm=function(){var t=this.copy();return t.normalize(),t};yr.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};yr.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Qn(this._envelope)};yr.prototype.setSRID=function(t){this._SRID=t};yr.prototype.setUserData=function(t){this._userData=t};yr.prototype.compare=function(t,n){for(var r=t.iterator(),a=n.iterator();r.hasNext()&&a.hasNext();){var u=r.next(),p=a.next(),i=u.compareTo(p);if(i!==0)return i}return r.hasNext()?1:a.hasNext()?-1:0};yr.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};yr.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===yr.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===yr.SORTINDEX_MULTIPOINT||this.getSortIndex()===yr.SORTINDEX_MULTILINESTRING||this.getSortIndex()===yr.SORTINDEX_MULTIPOLYGON};yr.prototype.interfaces_=function(){return[HE,gc,_c]};yr.prototype.getClass=function(){return yr};yr.hasNonEmptyElements=function(t){for(var n=0;n<t.length;n++)if(!t[n].isEmpty())return!0;return!1};yr.hasNullElements=function(t){for(var n=0;n<t.length;n++)if(t[n]===null)return!0;return!1};wf.serialVersionUID.get=function(){return 8763622679187377e3};wf.SORTINDEX_POINT.get=function(){return 0};wf.SORTINDEX_MULTIPOINT.get=function(){return 1};wf.SORTINDEX_LINESTRING.get=function(){return 2};wf.SORTINDEX_LINEARRING.get=function(){return 3};wf.SORTINDEX_MULTILINESTRING.get=function(){return 4};wf.SORTINDEX_POLYGON.get=function(){return 5};wf.SORTINDEX_MULTIPOLYGON.get=function(){return 6};wf.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};wf.geometryChangedFilter.get=function(){return YM};Object.defineProperties(yr,wf);var YM=function(){};YM.interfaces_=function(){return[Op]};YM.filter=function(t){t.geometryChangedAction()};var lf=function(){};lf.prototype.filter=function(t){};lf.prototype.interfaces_=function(){return[]};lf.prototype.getClass=function(){return lf};var hc=function(){},Vp={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};hc.prototype.isInBoundary=function(t){};hc.prototype.interfaces_=function(){return[]};hc.prototype.getClass=function(){return hc};Vp.Mod2BoundaryNodeRule.get=function(){return L0};Vp.EndPointBoundaryNodeRule.get=function(){return O0};Vp.MultiValentEndPointBoundaryNodeRule.get=function(){return D0};Vp.MonoValentEndPointBoundaryNodeRule.get=function(){return N0};Vp.MOD2_BOUNDARY_RULE.get=function(){return new L0};Vp.ENDPOINT_BOUNDARY_RULE.get=function(){return new O0};Vp.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new D0};Vp.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new N0};Vp.OGC_SFS_BOUNDARY_RULE.get=function(){return hc.MOD2_BOUNDARY_RULE};Object.defineProperties(hc,Vp);var L0=function(){};L0.prototype.isInBoundary=function(t){return t%2===1};L0.prototype.interfaces_=function(){return[hc]};L0.prototype.getClass=function(){return L0};var O0=function(){};O0.prototype.isInBoundary=function(t){return t>0};O0.prototype.interfaces_=function(){return[hc]};O0.prototype.getClass=function(){return O0};var D0=function(){};D0.prototype.isInBoundary=function(t){return t>1};D0.prototype.interfaces_=function(){return[hc]};D0.prototype.getClass=function(){return D0};var N0=function(){};N0.prototype.isInBoundary=function(t){return t===1};N0.prototype.interfaces_=function(){return[hc]};N0.prototype.getClass=function(){return N0};var ds=function(){};ds.prototype.add=function(){};ds.prototype.addAll=function(){};ds.prototype.isEmpty=function(){};ds.prototype.iterator=function(){};ds.prototype.size=function(){};ds.prototype.toArray=function(){};ds.prototype.remove=function(){};function KM(e){this.message=e||""}KM.prototype=new Error;KM.prototype.name="IndexOutOfBoundsException";var xx=function(){};xx.prototype.hasNext=function(){};xx.prototype.next=function(){};xx.prototype.remove=function(){};var qc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(ds);function bx(e){this.message=e||""}bx.prototype=new Error;bx.prototype.name="NoSuchElementException";var In=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof ds&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,ds]},t.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(r){for(var a=this,u=r.iterator();u.hasNext();)a.add(u.next());return!0},t.prototype.set=function(r,a){var u=this.array_[r];return this.array_[r]=a,u},t.prototype.iterator=function(){return new SQ(this)},t.prototype.get=function(r){if(r<0||r>=this.size())throw new KM;return this.array_[r]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var r=this,a=[],u=0,p=this.array_.length;u<p;u++)a.push(r.array_[u]);return a},t.prototype.remove=function(r){for(var a=this,u=!1,p=0,i=this.array_.length;p<i;p++)if(a.array_[p]===r){a.array_.splice(p,1),u=!0;break}return u},t}(qc),SQ=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new bx;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(xx),Nb=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var a=arguments[0],u=arguments[1];this.ensureCapacity(a.length),this.add(a,u)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(a){return this.get(a)},t.prototype.addAll=function(){var a=this;if(arguments.length===2){for(var u=arguments[0],p=arguments[1],i=!1,b=u.iterator();b.hasNext();)a.add(b.next(),p),i=!0;return i}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var a=this,u=e.prototype.clone.call(this),p=0;p<this.size();p++)u.add(p,a.get(p).copy());return u},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var a=this;if(arguments.length===1){var u=arguments[0];e.prototype.add.call(this,u)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var p=arguments[0],i=arguments[1];return this.add(p,i,!0),!0}else if(arguments[0]instanceof Ot&&typeof arguments[1]=="boolean"){var b=arguments[0],C=arguments[1];if(!C&&this.size()>=1){var A=this.get(this.size()-1);if(A.equals2D(b))return null}e.prototype.add.call(this,b)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var R=arguments[0],z=arguments[1];return this.add(R,z),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var V=arguments[0],W=arguments[1],X=arguments[2];if(X)for(var ue=0;ue<V.length;ue++)a.add(V[ue],W);else for(var ie=V.length-1;ie>=0;ie--)a.add(V[ie],W);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Ot){var K=arguments[0],ee=arguments[1],ae=arguments[2];if(!ae){var he=this.size();if(he>0){if(K>0){var xe=this.get(K-1);if(xe.equals2D(ee))return null}if(K<he){var ye=this.get(K);if(ye.equals2D(ee))return null}}}e.prototype.add.call(this,K,ee)}}else if(arguments.length===4){var Se=arguments[0],je=arguments[1],Re=arguments[2],De=arguments[3],at=1;Re>De&&(at=-1);for(var ot=Re;ot!==De;ot+=at)a.add(Se[ot],je);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new Ot(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(In),ni=function(){},XE={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};XE.ForwardComparator.get=function(){return K1};XE.BidirectionalComparator.get=function(){return k0};XE.coordArrayType.get=function(){return new Array(0).fill(null)};ni.prototype.interfaces_=function(){return[]};ni.prototype.getClass=function(){return ni};ni.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};ni.ptNotInList=function(t,n){for(var r=0;r<t.length;r++){var a=t[r];if(ni.indexOf(a,n)<0)return a}return null};ni.scroll=function(t,n){var r=ni.indexOf(n,t);if(r<0)return null;var a=new Array(t.length).fill(null);ta.arraycopy(t,r,a,0,t.length-r),ta.arraycopy(t,0,a,t.length-r,r),ta.arraycopy(a,0,t,0,t.length)};ni.equals=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];if(t===n)return!0;if(t===null||n===null||t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].equals(n[r]))return!1;return!0}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];if(a===u)return!0;if(a===null||u===null||a.length!==u.length)return!1;for(var i=0;i<a.length;i++)if(p.compare(a[i],u[i])!==0)return!1;return!0}};ni.intersection=function(t,n){for(var r=new Nb,a=0;a<t.length;a++)n.intersects(t[a])&&r.add(t[a],!0);return r.toCoordinateArray()};ni.hasRepeatedPoints=function(t){for(var n=1;n<t.length;n++)if(t[n-1].equals(t[n]))return!0;return!1};ni.removeRepeatedPoints=function(t){if(!ni.hasRepeatedPoints(t))return t;var n=new Nb(t,!1);return n.toCoordinateArray()};ni.reverse=function(t){for(var n=t.length-1,r=Math.trunc(n/2),a=0;a<=r;a++){var u=t[a];t[a]=t[n-a],t[n-a]=u}};ni.removeNull=function(t){for(var n=0,r=0;r<t.length;r++)t[r]!==null&&n++;var a=new Array(n).fill(null);if(n===0)return a;for(var u=0,p=0;p<t.length;p++)t[p]!==null&&(a[u++]=t[p]);return a};ni.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],n=new Array(t.length).fill(null),r=0;r<t.length;r++)n[r]=new Ot(t[r]);return n}else if(arguments.length===5)for(var a=arguments[0],u=arguments[1],p=arguments[2],i=arguments[3],b=arguments[4],C=0;C<b;C++)p[i+C]=new Ot(a[u+C])};ni.isEqualReversed=function(t,n){for(var r=0;r<t.length;r++){var a=t[r],u=n[t.length-r-1];if(a.compareTo(u)!==0)return!1}return!0};ni.envelope=function(t){for(var n=new Qn,r=0;r<t.length;r++)n.expandToInclude(t[r]);return n};ni.toCoordinateArray=function(t){return t.toArray(ni.coordArrayType)};ni.atLeastNCoordinatesOrNothing=function(t,n){return n.length>=t?n:[]};ni.indexOf=function(t,n){for(var r=0;r<n.length;r++)if(t.equals(n[r]))return r;return-1};ni.increasingDirection=function(t){for(var n=0;n<Math.trunc(t.length/2);n++){var r=t.length-1-n,a=t[n].compareTo(t[r]);if(a!==0)return a}return 1};ni.compare=function(t,n){for(var r=0;r<t.length&&r<n.length;){var a=t[r].compareTo(n[r]);if(a!==0)return a;r++}return r<n.length?-1:r<t.length?1:0};ni.minCoordinate=function(t){for(var n=null,r=0;r<t.length;r++)(n===null||n.compareTo(t[r])>0)&&(n=t[r]);return n};ni.extract=function(t,n,r){n=Iu.clamp(n,0,t.length),r=Iu.clamp(r,-1,t.length);var a=r-n+1;r<0&&(a=0),n>=t.length&&(a=0),r<n&&(a=0);var u=new Array(a).fill(null);if(a===0)return u;for(var p=0,i=n;i<=r;i++)u[p++]=t[i];return u};Object.defineProperties(ni,XE);var K1=function(){};K1.prototype.compare=function(t,n){var r=t,a=n;return ni.compare(r,a)};K1.prototype.interfaces_=function(){return[A0]};K1.prototype.getClass=function(){return K1};var k0=function(){};k0.prototype.compare=function(t,n){var r=t,a=n;if(r.length<a.length)return-1;if(r.length>a.length)return 1;if(r.length===0)return 0;var u=ni.compare(r,a),p=ni.isEqualReversed(r,a);return p?0:u};k0.prototype.OLDcompare=function(t,n){var r=t,a=n;if(r.length<a.length)return-1;if(r.length>a.length)return 1;if(r.length===0)return 0;for(var u=ni.increasingDirection(r),p=ni.increasingDirection(a),i=u>0?0:r.length-1,b=p>0?0:r.length-1,C=0;C<r.length;C++){var A=r[i].compareTo(a[b]);if(A!==0)return A;i+=u,b+=p}return 0};k0.prototype.interfaces_=function(){return[A0]};k0.prototype.getClass=function(){return k0};var dv=function(){};dv.prototype.get=function(){};dv.prototype.put=function(){};dv.prototype.size=function(){};dv.prototype.values=function(){};dv.prototype.entrySet=function(){};var EQ=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dv);function kb(e){this.message=e||""}kb.prototype=new Error;kb.prototype.name="OperationNotSupported";function ZE(){}ZE.prototype=new ds;ZE.prototype.contains=function(){};var JM=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof ds&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(r){for(var a=this,u=0,p=this.array_.length;u<p;u++){var i=a.array_[u];if(i===r)return!0}return!1},t.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},t.prototype.addAll=function(r){for(var a=this,u=r.iterator();u.hasNext();)a.add(u.next());return!0},t.prototype.remove=function(r){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var r=this,a=[],u=0,p=this.array_.length;u<p;u++)a.push(r.array_[u]);return a},t.prototype.iterator=function(){return new CQ(this)},t}(ZE),CQ=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new bx;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new kb},t}(xx),yp=0,c_=1;function eN(e){return e===null?yp:e.color}function Yi(e){return e===null?null:e.parent}function pp(e,t){e!==null&&(e.color=t)}function iI(e){return e===null?null:e.left}function tN(e){return e===null?null:e.right}function Ea(){this.root_=null,this.size_=0}Ea.prototype=new EQ;Ea.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};Ea.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:yp,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,a;do if(r=n,a=e.compareTo(n.key),a<0)n=n.left;else if(a>0)n=n.right;else{var u=n.value;return n.value=t,u}while(n!==null);var p={key:e,left:null,right:null,value:t,parent:r,color:yp,getValue:function(){return this.value},getKey:function(){return this.key}};return a<0?r.left=p:r.right=p,this.fixAfterInsertion(p),this.size_++,null};Ea.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=c_;e!=null&&e!==this.root_&&e.parent.color===c_;)if(Yi(e)===iI(Yi(Yi(e)))){var n=tN(Yi(Yi(e)));eN(n)===c_?(pp(Yi(e),yp),pp(n,yp),pp(Yi(Yi(e)),c_),e=Yi(Yi(e))):(e===tN(Yi(e))&&(e=Yi(e),t.rotateLeft(e)),pp(Yi(e),yp),pp(Yi(Yi(e)),c_),t.rotateRight(Yi(Yi(e))))}else{var r=iI(Yi(Yi(e)));eN(r)===c_?(pp(Yi(e),yp),pp(r,yp),pp(Yi(Yi(e)),c_),e=Yi(Yi(e))):(e===iI(Yi(e))&&(e=Yi(e),t.rotateRight(e)),pp(Yi(e),yp),pp(Yi(Yi(e)),c_),t.rotateLeft(Yi(Yi(e))))}this.root_.color=yp};Ea.prototype.values=function(){var e=new In,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=Ea.successor(t))!==null;)e.add(t.value);return e};Ea.prototype.entrySet=function(){var e=new JM,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=Ea.successor(t))!==null;)e.add(t);return e};Ea.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};Ea.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};Ea.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};Ea.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,r=e;n!==null&&r===n.right;)r=n,n=n.parent;return n}};Ea.prototype.size=function(){return this.size_};var J1=function(){};J1.prototype.interfaces_=function(){return[]};J1.prototype.getClass=function(){return J1};function Q4(){}Q4.prototype=new ZE;function rd(){this.array_=[],arguments[0]instanceof ds&&this.addAll(arguments[0])}rd.prototype=new Q4;rd.prototype.contains=function(e){for(var t=this,n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===0)return!0}return!1};rd.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};rd.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};rd.prototype.remove=function(e){throw new kb};rd.prototype.size=function(){return this.array_.length};rd.prototype.isEmpty=function(){return this.array_.length===0};rd.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};rd.prototype.iterator=function(){return new YE(this)};var YE=function(e){this.treeSet_=e,this.position_=0};YE.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new bx;return this.treeSet_.array_[this.position_++]};YE.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};YE.prototype.remove=function(){throw new kb};var v_=function(){};v_.sort=function(){var t=arguments[0],n,r,a,u;if(arguments.length===1)u=function(i,b){return i.compareTo(b)},t.sort(u);else if(arguments.length===2)a=arguments[1],u=function(i,b){return a.compare(i,b)},t.sort(u);else if(arguments.length===3){r=t.slice(arguments[1],arguments[2]),r.sort();var p=t.slice(0,arguments[1]).concat(r,t.slice(arguments[2],t.length));for(t.splice(0,t.length),n=0;n<p.length;n++)t.push(p[n])}else if(arguments.length===4)for(r=t.slice(arguments[1],arguments[2]),a=arguments[3],u=function(i,b){return a.compare(i,b)},r.sort(u),p=t.slice(0,arguments[1]).concat(r,t.slice(arguments[2],t.length)),t.splice(0,t.length),n=0;n<p.length;n++)t.push(p[n])};v_.asList=function(t){for(var n=new In,r=0,a=t.length;r<a;r++)n.add(t[r]);return n};var wi=function(){},ih={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ih.P.get=function(){return 0};ih.L.get=function(){return 1};ih.A.get=function(){return 2};ih.FALSE.get=function(){return-1};ih.TRUE.get=function(){return-2};ih.DONTCARE.get=function(){return-3};ih.SYM_FALSE.get=function(){return"F"};ih.SYM_TRUE.get=function(){return"T"};ih.SYM_DONTCARE.get=function(){return"*"};ih.SYM_P.get=function(){return"0"};ih.SYM_L.get=function(){return"1"};ih.SYM_A.get=function(){return"2"};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};wi.toDimensionSymbol=function(t){switch(t){case wi.FALSE:return wi.SYM_FALSE;case wi.TRUE:return wi.SYM_TRUE;case wi.DONTCARE:return wi.SYM_DONTCARE;case wi.P:return wi.SYM_P;case wi.L:return wi.SYM_L;case wi.A:return wi.SYM_A}throw new po("Unknown dimension value: "+t)};wi.toDimensionValue=function(t){switch(Y1.toUpperCase(t)){case wi.SYM_FALSE:return wi.FALSE;case wi.SYM_TRUE:return wi.TRUE;case wi.SYM_DONTCARE:return wi.DONTCARE;case wi.SYM_P:return wi.P;case wi.SYM_L:return wi.L;case wi.SYM_A:return wi.A}throw new po("Unknown dimension symbol: "+t)};Object.defineProperties(wi,ih);var id=function(){};id.prototype.filter=function(t){};id.prototype.interfaces_=function(){return[]};id.prototype.getClass=function(){return id};var Yc=function(){};Yc.prototype.filter=function(t,n){};Yc.prototype.isDone=function(){};Yc.prototype.isGeometryChanged=function(){};Yc.prototype.interfaces_=function(){return[]};Yc.prototype.getClass=function(){return Yc};var Za=function(e){function t(r,a){if(e.call(this,a),this._geometries=r||[],e.hasNullElements(this._geometries))throw new po("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var a=this,u=new Qn,p=0;p<this._geometries.length;p++)u.expandToInclude(a._geometries[p].getEnvelopeInternal());return u},t.prototype.getGeometryN=function(a){return this._geometries[a]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var a=this,u=new Array(this.getNumPoints()).fill(null),p=-1,i=0;i<this._geometries.length;i++)for(var b=a._geometries[i].getCoordinates(),C=0;C<b.length;C++)p++,u[p]=b[C];return u},t.prototype.getArea=function(){for(var a=this,u=0,p=0;p<this._geometries.length;p++)u+=a._geometries[p].getArea();return u},t.prototype.equalsExact=function(){var a=this;if(arguments.length===2){var u=arguments[0],p=arguments[1];if(!this.isEquivalentClass(u))return!1;var i=u;if(this._geometries.length!==i._geometries.length)return!1;for(var b=0;b<this._geometries.length;b++)if(!a._geometries[b].equalsExact(i._geometries[b],p))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var a=this,u=0;u<this._geometries.length;u++)a._geometries[u].normalize();v_.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var a=this,u=wi.FALSE,p=0;p<this._geometries.length;p++)u=Math.max(u,a._geometries[p].getBoundaryDimension());return u},t.prototype.getDimension=function(){for(var a=this,u=wi.FALSE,p=0;p<this._geometries.length;p++)u=Math.max(u,a._geometries[p].getDimension());return u},t.prototype.getLength=function(){for(var a=this,u=0,p=0;p<this._geometries.length;p++)u+=a._geometries[p].getLength();return u},t.prototype.getNumPoints=function(){for(var a=this,u=0,p=0;p<this._geometries.length;p++)u+=a._geometries[p].getNumPoints();return u},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var a=this,u=this._geometries.length,p=new Array(u).fill(null),i=0;i<this._geometries.length;i++)p[i]=a._geometries[i].reverse();return this.getFactory().createGeometryCollection(p)},t.prototype.compareToSameClass=function(){var a=this;if(arguments.length===1){var u=arguments[0],p=new rd(v_.asList(this._geometries)),i=new rd(v_.asList(u._geometries));return this.compare(p,i)}else if(arguments.length===2){for(var b=arguments[0],C=arguments[1],A=b,R=this.getNumGeometries(),z=A.getNumGeometries(),V=0;V<R&&V<z;){var W=a.getGeometryN(V),X=A.getGeometryN(V),ue=W.compareToSameClass(X,C);if(ue!==0)return ue;V++}return V<R?1:V<z?-1:0}},t.prototype.apply=function(){var a=this;if(xr(arguments[0],lf))for(var u=arguments[0],p=0;p<this._geometries.length;p++)a._geometries[p].apply(u);else if(xr(arguments[0],Yc)){var i=arguments[0];if(this._geometries.length===0)return null;for(var b=0;b<this._geometries.length&&(a._geometries[b].apply(i),!i.isDone());b++);i.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],id)){var C=arguments[0];C.filter(this);for(var A=0;A<this._geometries.length;A++)a._geometries[A].apply(C)}else if(xr(arguments[0],Op)){var R=arguments[0];R.filter(this);for(var z=0;z<this._geometries.length;z++)a._geometries[z].apply(R)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),qr.shouldNeverReachHere(),null},t.prototype.clone=function(){var a=this,u=e.prototype.clone.call(this);u._geometries=new Array(this._geometries.length).fill(null);for(var p=0;p<this._geometries.length;p++)u._geometries[p]=a._geometries[p].clone();return u},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var a=this,u=new Array(this._geometries.length).fill(null),p=0;p<u.length;p++)u[p]=a._geometries[p].copy();return new t(u,this._factory)},t.prototype.isEmpty=function(){for(var a=this,u=0;u<this._geometries.length;u++)if(!a._geometries[u].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(yr),M_=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return yr.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];return this.isEquivalentClass(a)?e.prototype.equalsExact.call(this,a,u):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?wi.FALSE:0},t.prototype.isClosed=function(){var a=this;if(this.isEmpty())return!1;for(var u=0;u<this._geometries.length;u++)if(!a._geometries[u].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var a=this,u=this._geometries.length,p=new Array(u).fill(null),i=0;i<this._geometries.length;i++)p[u-1-i]=a._geometries[i].reverse();return this.getFactory().createMultiLineString(p)},t.prototype.getBoundary=function(){return new lc(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var a=this,u=new Array(this._geometries.length).fill(null),p=0;p<u.length;p++)u[p]=a._geometries[p].copy();return new t(u,this._factory)},t.prototype.interfaces_=function(){return[J1]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(Za),lc=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],n=hc.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=n}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=a}};lc.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var n=this.computeBoundaryCoordinates(t);return n.length===1?this._geomFact.createPoint(n[0]):this._geomFact.createMultiPointFromCoords(n)};lc.prototype.getBoundary=function(){return this._geom instanceof Fo?this.boundaryLineString(this._geom):this._geom instanceof M_?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};lc.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var n=this._bnRule.isInBoundary(2);return n?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};lc.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};lc.prototype.computeBoundaryCoordinates=function(t){var n=this,r=new In;this._endpointMap=new Ea;for(var a=0;a<t.getNumGeometries();a++){var u=t.getGeometryN(a);u.getNumPoints()!==0&&(n.addEndpoint(u.getCoordinateN(0)),n.addEndpoint(u.getCoordinateN(u.getNumPoints()-1)))}for(var p=this._endpointMap.entrySet().iterator();p.hasNext();){var i=p.next(),b=i.getValue(),C=b.count;n._bnRule.isInBoundary(C)&&r.add(i.getKey())}return ni.toCoordinateArray(r)};lc.prototype.addEndpoint=function(t){var n=this._endpointMap.get(t);n===null&&(n=new JS,this._endpointMap.put(t,n)),n.count++};lc.prototype.interfaces_=function(){return[]};lc.prototype.getClass=function(){return lc};lc.getBoundary=function(){if(arguments.length===1){var t=arguments[0],n=new lc(t);return n.getBoundary()}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u=new lc(r,a);return u.getBoundary()}};var JS=function(){this.count=null};JS.prototype.interfaces_=function(){return[]};JS.prototype.getClass=function(){return JS};function TQ(){}function IQ(){}var MQ=function(){};function PQ(){}function AQ(){}function RQ(){}var uc=function(){},QM={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};uc.prototype.interfaces_=function(){return[]};uc.prototype.getClass=function(){return uc};uc.chars=function(t,n){for(var r=new Array(n).fill(null),a=0;a<n;a++)r[a]=t;return String(r)};uc.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],n=new PQ,r=new TQ;return t.printStackTrace(r),n.toString()}else if(arguments.length===2){var a=arguments[0],u=arguments[1],p="";new IQ(uc.getStackTrace(a));for(var i=new RQ,b=0;b<u;b++)try{p+=i.readLine()+uc.NEWLINE}catch(C){if(C instanceof AQ)qr.shouldNeverReachHere();else throw C}finally{}return p}};uc.split=function(t,n){for(var r=n.length,a=new In,u=""+t,p=u.indexOf(n);p>=0;){var i=u.substring(0,p);a.add(i),u=u.substring(p+r),p=u.indexOf(n)}u.length>0&&a.add(u);for(var b=new Array(a.size()).fill(null),C=0;C<b.length;C++)b[C]=a.get(C);return b};uc.toString=function(){if(arguments.length===1){var t=arguments[0];return uc.SIMPLE_ORDINATE_FORMAT.format(t)}};uc.spaces=function(t){return uc.chars(" ",t)};QM.NEWLINE.get=function(){return ta.getProperty("line.separator")};QM.SIMPLE_ORDINATE_FORMAT.get=function(){return new MQ};Object.defineProperties(uc,QM);var Ho=function(){};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};Ho.copyCoord=function(t,n,r,a){for(var u=Math.min(t.getDimension(),r.getDimension()),p=0;p<u;p++)r.setOrdinate(a,p,t.getOrdinate(n,p))};Ho.isRing=function(t){var n=t.size();return n===0?!0:n<=3?!1:t.getOrdinate(0,ci.X)===t.getOrdinate(n-1,ci.X)&&t.getOrdinate(0,ci.Y)===t.getOrdinate(n-1,ci.Y)};Ho.isEqual=function(t,n){var r=t.size(),a=n.size();if(r!==a)return!1;for(var u=Math.min(t.getDimension(),n.getDimension()),p=0;p<r;p++)for(var i=0;i<u;i++){var b=t.getOrdinate(p,i),C=n.getOrdinate(p,i);if(t.getOrdinate(p,i)!==n.getOrdinate(p,i)&&!(Dr.isNaN(b)&&Dr.isNaN(C)))return!1}return!0};Ho.extend=function(t,n,r){var a=t.create(r,n.getDimension()),u=n.size();if(Ho.copy(n,0,a,0,u),u>0)for(var p=u;p<r;p++)Ho.copy(n,u-1,a,p,1);return a};Ho.reverse=function(t){for(var n=t.size()-1,r=Math.trunc(n/2),a=0;a<=r;a++)Ho.swap(t,a,n-a)};Ho.swap=function(t,n,r){if(n===r)return null;for(var a=0;a<t.getDimension();a++){var u=t.getOrdinate(n,a);t.setOrdinate(n,a,t.getOrdinate(r,a)),t.setOrdinate(r,a,u)}};Ho.copy=function(t,n,r,a,u){for(var p=0;p<u;p++)Ho.copyCoord(t,n+p,r,a+p)};Ho.toString=function(){if(arguments.length===1){var t=arguments[0],n=t.size();if(n===0)return"()";var r=t.getDimension(),a=new pd;a.append("(");for(var u=0;u<n;u++){u>0&&a.append(" ");for(var p=0;p<r;p++)p>0&&a.append(","),a.append(uc.toString(t.getOrdinate(u,p)))}return a.append(")"),a.toString()}};Ho.ensureValidRing=function(t,n){var r=n.size();if(r===0)return n;if(r<=3)return Ho.createClosedRing(t,n,4);var a=n.getOrdinate(0,ci.X)===n.getOrdinate(r-1,ci.X)&&n.getOrdinate(0,ci.Y)===n.getOrdinate(r-1,ci.Y);return a?n:Ho.createClosedRing(t,n,r+1)};Ho.createClosedRing=function(t,n,r){var a=t.create(r,n.getDimension()),u=n.size();Ho.copy(n,0,a,0,u);for(var p=u;p<r;p++)Ho.copy(n,0,a,p,1);return a};var Fo=function(e){function t(r,a){e.call(this,a),this._points=null,this.init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Qn:this._points.expandEnvelope(new Qn)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var a=this;if(arguments.length===2){var u=arguments[0],p=arguments[1];if(!this.isEquivalentClass(u))return!1;var i=u;if(this._points.size()!==i._points.size())return!1;for(var b=0;b<this._points.size();b++)if(!a.equal(a._points.getCoordinate(b),i._points.getCoordinate(b),p))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var a=this,u=0;u<Math.trunc(this._points.size()/2);u++){var p=a._points.size()-1-u;if(!a._points.getCoordinate(u).equals(a._points.getCoordinate(p)))return a._points.getCoordinate(u).compareTo(a._points.getCoordinate(p))>0&&Ho.reverse(a._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?wi.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return On.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var a=this._points.copy();Ho.reverse(a);var u=this.getFactory().createLineString(a);return u},t.prototype.compareToSameClass=function(){var a=this;if(arguments.length===1){for(var u=arguments[0],p=u,i=0,b=0;i<this._points.size()&&b<p._points.size();){var C=a._points.getCoordinate(i).compareTo(p._points.getCoordinate(b));if(C!==0)return C;i++,b++}return i<this._points.size()?1:b<p._points.size()?-1:0}else if(arguments.length===2){var A=arguments[0],R=arguments[1],z=A;return R.compare(this._points,z._points)}},t.prototype.apply=function(){var a=this;if(xr(arguments[0],lf))for(var u=arguments[0],p=0;p<this._points.size();p++)u.filter(a._points.getCoordinate(p));else if(xr(arguments[0],Yc)){var i=arguments[0];if(this._points.size()===0)return null;for(var b=0;b<this._points.size()&&(i.filter(a._points,b),!i.isDone());b++);i.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],id)){var C=arguments[0];C.filter(this)}else if(xr(arguments[0],Op)){var A=arguments[0];A.filter(this)}},t.prototype.getBoundary=function(){return new lc(this).getBoundary()},t.prototype.isEquivalentClass=function(a){return a instanceof t},t.prototype.clone=function(){var a=e.prototype.clone.call(this);return a._points=this._points.clone(),a},t.prototype.getCoordinateN=function(a){return this._points.getCoordinate(a)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(a){if(a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),a.size()===1)throw new po("Invalid number of points in LineString (found "+a.size()+" - must be 0 or >= 2)");this._points=a},t.prototype.isCoordinate=function(a){for(var u=this,p=0;p<this._points.size();p++)if(u._points.getCoordinate(p).equals(a))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(a){return this.getFactory().createPoint(this._points.getCoordinate(a))},t.prototype.interfaces_=function(){return[J1]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(yr),Q1=function(){};Q1.prototype.interfaces_=function(){return[]};Q1.prototype.getClass=function(){return Q1};var ql=function(e){function t(r,a){e.call(this,a),this._coordinates=r||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Qn;var a=new Qn;return a.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),a},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];return this.isEquivalentClass(a)?this.isEmpty()&&a.isEmpty()?!0:this.isEmpty()!==a.isEmpty()?!1:this.equal(a.getCoordinate(),this.getCoordinate(),u):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return wi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var a=arguments[0],u=a;return this.getCoordinate().compareTo(u.getCoordinate())}else if(arguments.length===2){var p=arguments[0],i=arguments[1],b=p;return i.compare(this._coordinates,b._coordinates)}},t.prototype.apply=function(){if(xr(arguments[0],lf)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this.getCoordinate())}else if(xr(arguments[0],Yc)){var u=arguments[0];if(this.isEmpty())return null;u.filter(this._coordinates,0),u.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],id)){var p=arguments[0];p.filter(this)}else if(xr(arguments[0],Op)){var i=arguments[0];i.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var a=e.prototype.clone.call(this);return a._coordinates=this._coordinates.clone(),a},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(a){a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),qr.isTrue(a.size()<=1),this._coordinates=a},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Q1]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(yr),tg=function(){};tg.prototype.interfaces_=function(){return[]};tg.prototype.getClass=function(){return tg};var gs=function(e){function t(r,a,u){if(e.call(this,u),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),a===null&&(a=[]),e.hasNullElements(a))throw new po("holes must not contain null elements");if(r.isEmpty()&&e.hasNonEmptyElements(a))throw new po("shell is empty but holes are not");this._shell=r,this._holes=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var a=this;if(this.isEmpty())return[];for(var u=new Array(this.getNumPoints()).fill(null),p=-1,i=this._shell.getCoordinates(),b=0;b<i.length;b++)p++,u[p]=i[b];for(var C=0;C<this._holes.length;C++)for(var A=a._holes[C].getCoordinates(),R=0;R<A.length;R++)p++,u[p]=A[R];return u},t.prototype.getArea=function(){var a=this,u=0;u+=Math.abs(On.signedArea(this._shell.getCoordinateSequence()));for(var p=0;p<this._holes.length;p++)u-=Math.abs(On.signedArea(a._holes[p].getCoordinateSequence()));return u},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var a=this._shell.getCoordinateSequence(),u=this.getEnvelopeInternal(),p=0;p<5;p++){var i=a.getX(p);if(!(i===u.getMinX()||i===u.getMaxX()))return!1;var b=a.getY(p);if(!(b===u.getMinY()||b===u.getMaxY()))return!1}for(var C=a.getX(0),A=a.getY(0),R=1;R<=4;R++){var z=a.getX(R),V=a.getY(R),W=z!==C,X=V!==A;if(W===X)return!1;C=z,A=V}return!0},t.prototype.equalsExact=function(){var a=this;if(arguments.length===2){var u=arguments[0],p=arguments[1];if(!this.isEquivalentClass(u))return!1;var i=u,b=this._shell,C=i._shell;if(!b.equalsExact(C,p)||this._holes.length!==i._holes.length)return!1;for(var A=0;A<this._holes.length;A++)if(!a._holes[A].equalsExact(i._holes[A],p))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var a=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var u=0;u<this._holes.length;u++)a.normalize(a._holes[u],!1);v_.sort(this._holes)}else if(arguments.length===2){var p=arguments[0],i=arguments[1];if(p.isEmpty())return null;var b=new Array(p.getCoordinates().length-1).fill(null);ta.arraycopy(p.getCoordinates(),0,b,0,b.length);var C=ni.minCoordinate(p.getCoordinates());ni.scroll(b,C),ta.arraycopy(b,0,p.getCoordinates(),0,b.length),p.getCoordinates()[b.length]=b[0],On.isCCW(p.getCoordinates())===i&&ni.reverse(p.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var a=this,u=0;u+=this._shell.getLength();for(var p=0;p<this._holes.length;p++)u+=a._holes[p].getLength();return u},t.prototype.getNumPoints=function(){for(var a=this,u=this._shell.getNumPoints(),p=0;p<this._holes.length;p++)u+=a._holes[p].getNumPoints();return u},t.prototype.reverse=function(){var a=this,u=this.copy();u._shell=this._shell.copy().reverse(),u._holes=new Array(this._holes.length).fill(null);for(var p=0;p<this._holes.length;p++)u._holes[p]=a._holes[p].copy().reverse();return u},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var a=this;if(arguments.length===1){var u=arguments[0],p=this._shell,i=u._shell;return p.compareToSameClass(i)}else if(arguments.length===2){var b=arguments[0],C=arguments[1],A=b,R=this._shell,z=A._shell,V=R.compareToSameClass(z,C);if(V!==0)return V;for(var W=this.getNumInteriorRing(),X=A.getNumInteriorRing(),ue=0;ue<W&&ue<X;){var ie=a.getInteriorRingN(ue),K=A.getInteriorRingN(ue),ee=ie.compareToSameClass(K,C);if(ee!==0)return ee;ue++}return ue<W?1:ue<X?-1:0}},t.prototype.apply=function(a){var u=this;if(xr(a,lf)){this._shell.apply(a);for(var p=0;p<this._holes.length;p++)u._holes[p].apply(a)}else if(xr(a,Yc)){if(this._shell.apply(a),!a.isDone())for(var i=0;i<this._holes.length&&(u._holes[i].apply(a),!a.isDone());i++);a.isGeometryChanged()&&this.geometryChanged()}else if(xr(a,id))a.filter(this);else if(xr(a,Op)){a.filter(this),this._shell.apply(a);for(var b=0;b<this._holes.length;b++)u._holes[b].apply(a)}},t.prototype.getBoundary=function(){var a=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var u=new Array(this._holes.length+1).fill(null);u[0]=this._shell;for(var p=0;p<this._holes.length;p++)u[p+1]=a._holes[p];return u.length<=1?this.getFactory().createLinearRing(u[0].getCoordinateSequence()):this.getFactory().createMultiLineString(u)},t.prototype.clone=function(){var a=this,u=e.prototype.clone.call(this);u._shell=this._shell.clone(),u._holes=new Array(this._holes.length).fill(null);for(var p=0;p<this._holes.length;p++)u._holes[p]=a._holes[p].clone();return u},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var a=this,u=this._shell.copy(),p=new Array(this._holes.length).fill(null),i=0;i<p.length;i++)p[i]=a._holes[i].copy();return new t(u,p,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(a){return this._holes[a]},t.prototype.interfaces_=function(){return[tg]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(yr),F0=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return yr.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];return this.isEquivalentClass(a)?e.prototype.equalsExact.call(this,a,u):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var a=arguments[0];return this._geometries[a].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return wi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var a=this,u=new Array(this._geometries.length).fill(null),p=0;p<u.length;p++)u[p]=a._geometries[p].copy();return new t(u,this._factory)},t.prototype.interfaces_=function(){return[Q1]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(Za),uf=function(e){function t(r,a){r instanceof Ot&&a instanceof ti&&(r=a.getCoordinateSequenceFactory().create(r)),e.call(this,r,a),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return yr.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return wi.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var a=this._points.copy();Ho.reverse(a);var u=this.getFactory().createLinearRing(a);return u},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new po("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new po("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Fo),Qd=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return yr.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];return this.isEquivalentClass(a)?e.prototype.equalsExact.call(this,a,u):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var a=this,u=this._geometries.length,p=new Array(u).fill(null),i=0;i<this._geometries.length;i++)p[i]=a._geometries[i].reverse();return this.getFactory().createMultiPolygon(p)},t.prototype.getBoundary=function(){var a=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var u=new In,p=0;p<this._geometries.length;p++)for(var i=a._geometries[p],b=i.getBoundary(),C=0;C<b.getNumGeometries();C++)u.add(b.getGeometryN(C));var A=new Array(u.size()).fill(null);return this.getFactory().createMultiLineString(u.toArray(A))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var a=this,u=new Array(this._geometries.length).fill(null),p=0;p<u.length;p++)u[p]=a._geometries[p].copy();return new t(u,this._factory)},t.prototype.interfaces_=function(){return[tg]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(Za),dc=function(t){this._factory=t||null,this._isUserDataCopied=!1},KE={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};dc.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};dc.prototype.edit=function(t,n){if(t===null)return null;var r=this.editInternal(t,n);return this._isUserDataCopied&&r.setUserData(t.getUserData()),r};dc.prototype.editInternal=function(t,n){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Za?this.editGeometryCollection(t,n):t instanceof gs?this.editPolygon(t,n):t instanceof ql?n.edit(t,this._factory):t instanceof Fo?n.edit(t,this._factory):(qr.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};dc.prototype.editGeometryCollection=function(t,n){for(var r=this,a=n.edit(t,this._factory),u=new In,p=0;p<a.getNumGeometries();p++){var i=r.edit(a.getGeometryN(p),n);i===null||i.isEmpty()||u.add(i)}return a.getClass()===F0?this._factory.createMultiPoint(u.toArray([])):a.getClass()===M_?this._factory.createMultiLineString(u.toArray([])):a.getClass()===Qd?this._factory.createMultiPolygon(u.toArray([])):this._factory.createGeometryCollection(u.toArray([]))};dc.prototype.editPolygon=function(t,n){var r=this,a=n.edit(t,this._factory);if(a===null&&(a=this._factory.createPolygon(null)),a.isEmpty())return a;var u=this.edit(a.getExteriorRing(),n);if(u===null||u.isEmpty())return this._factory.createPolygon();for(var p=new In,i=0;i<a.getNumInteriorRing();i++){var b=r.edit(a.getInteriorRingN(i),n);b===null||b.isEmpty()||p.add(b)}return this._factory.createPolygon(u,p.toArray([]))};dc.prototype.interfaces_=function(){return[]};dc.prototype.getClass=function(){return dc};dc.GeometryEditorOperation=function(){};KE.NoOpGeometryOperation.get=function(){return eb};KE.CoordinateOperation.get=function(){return tb};KE.CoordinateSequenceOperation.get=function(){return nb};Object.defineProperties(dc,KE);var eb=function(){};eb.prototype.edit=function(t,n){return t};eb.prototype.interfaces_=function(){return[dc.GeometryEditorOperation]};eb.prototype.getClass=function(){return eb};var tb=function(){};tb.prototype.edit=function(t,n){var r=this.editCoordinates(t.getCoordinates(),t);return r===null?t:t instanceof uf?n.createLinearRing(r):t instanceof Fo?n.createLineString(r):t instanceof ql?r.length>0?n.createPoint(r[0]):n.createPoint():t};tb.prototype.interfaces_=function(){return[dc.GeometryEditorOperation]};tb.prototype.getClass=function(){return tb};var nb=function(){};nb.prototype.edit=function(t,n){return t instanceof uf?n.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Fo?n.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof ql?n.createPoint(this.edit(t.getCoordinateSequence(),t)):t};nb.prototype.interfaces_=function(){return[dc.GeometryEditorOperation]};nb.prototype.getClass=function(){return nb};var $o=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var r=0;r<n;r++)t._coordinates[r]=new Ot}else if(xr(arguments[0],ci)){var a=arguments[0];if(a===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=a.getDimension(),this._coordinates=new Array(a.size()).fill(null);for(var u=0;u<this._coordinates.length;u++)t._coordinates[u]=a.getCoordinateCopy(u)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var p=arguments[0],i=arguments[1];this._coordinates=p,this._dimension=i,p===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],C=arguments[1];this._coordinates=new Array(b).fill(null),this._dimension=C;for(var A=0;A<b;A++)t._coordinates[A]=new Ot}}},e5={serialVersionUID:{configurable:!0}};$o.prototype.setOrdinate=function(t,n,r){switch(n){case ci.X:this._coordinates[t].x=r;break;case ci.Y:this._coordinates[t].y=r;break;case ci.Z:this._coordinates[t].z=r;break;default:throw new po("invalid ordinateIndex")}};$o.prototype.size=function(){return this._coordinates.length};$o.prototype.getOrdinate=function(t,n){switch(n){case ci.X:return this._coordinates[t].x;case ci.Y:return this._coordinates[t].y;case ci.Z:return this._coordinates[t].z}return Dr.NaN};$o.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var n=arguments[0],r=arguments[1];r.x=this._coordinates[n].x,r.y=this._coordinates[n].y,r.z=this._coordinates[n].z}};$o.prototype.getCoordinateCopy=function(t){return new Ot(this._coordinates[t])};$o.prototype.getDimension=function(){return this._dimension};$o.prototype.getX=function(t){return this._coordinates[t].x};$o.prototype.clone=function(){for(var t=this,n=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)n[r]=t._coordinates[r].clone();return new $o(n,this._dimension)};$o.prototype.expandEnvelope=function(t){for(var n=this,r=0;r<this._coordinates.length;r++)t.expandToInclude(n._coordinates[r]);return t};$o.prototype.copy=function(){for(var t=this,n=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)n[r]=t._coordinates[r].copy();return new $o(n,this._dimension)};$o.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var n=new pd(17*this._coordinates.length);n.append("("),n.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)n.append(", "),n.append(t._coordinates[r]);return n.append(")"),n.toString()}else return"()"};$o.prototype.getY=function(t){return this._coordinates[t].y};$o.prototype.toCoordinateArray=function(){return this._coordinates};$o.prototype.interfaces_=function(){return[ci,_c]};$o.prototype.getClass=function(){return $o};e5.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties($o,e5);var cf=function(){},eP={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};cf.prototype.readResolve=function(){return cf.instance()};cf.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new $o(t)}else if(xr(arguments[0],ci)){var n=arguments[0];return new $o(n)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return a>3&&(a=3),a<2?new $o(r):new $o(r,a)}};cf.prototype.interfaces_=function(){return[R0,_c]};cf.prototype.getClass=function(){return cf};cf.instance=function(){return cf.instanceObject};eP.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};eP.instanceObject.get=function(){return new cf};Object.defineProperties(cf,eP);var t5=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(r){return this.map_.get(r)||null},t.prototype.put=function(r,a){return this.map_.set(r,a),a},t.prototype.values=function(){for(var r=new In,a=this.map_.values(),u=a.next();!u.done;)r.add(u.value),u=a.next();return r},t.prototype.entrySet=function(){var r=new JM;return this.map_.entries().forEach(function(a){return r.add(a)}),r},t.prototype.size=function(){return this.map_.size()},t}(dv),Ei=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof od){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},tP={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Ei.prototype.equals=function(t){if(!(t instanceof Ei))return!1;var n=t;return this._modelType===n._modelType&&this._scale===n._scale};Ei.prototype.compareTo=function(t){var n=t,r=this.getMaximumSignificantDigits(),a=n.getMaximumSignificantDigits();return new nd(r).compareTo(new nd(a))};Ei.prototype.getScale=function(){return this._scale};Ei.prototype.isFloating=function(){return this._modelType===Ei.FLOATING||this._modelType===Ei.FLOATING_SINGLE};Ei.prototype.getType=function(){return this._modelType};Ei.prototype.toString=function(){var t="UNKNOWN";return this._modelType===Ei.FLOATING?t="Floating":this._modelType===Ei.FLOATING_SINGLE?t="Floating-Single":this._modelType===Ei.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};Ei.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(Dr.isNaN(t))return t;if(this._modelType===Ei.FLOATING_SINGLE){var n=t;return n}return this._modelType===Ei.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof Ot){var r=arguments[0];if(this._modelType===Ei.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};Ei.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===Ei.FLOATING?t=16:this._modelType===Ei.FLOATING_SINGLE?t=6:this._modelType===Ei.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};Ei.prototype.setScale=function(t){this._scale=Math.abs(t)};Ei.prototype.interfaces_=function(){return[_c,gc]};Ei.prototype.getClass=function(){return Ei};Ei.mostPrecise=function(t,n){return t.compareTo(n)>=0?t:n};tP.serialVersionUID.get=function(){return 7777263578777804e3};tP.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Ei,tP);var od=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},nP={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};od.prototype.readResolve=function(){return od.nameToTypeMap.get(this._name)};od.prototype.toString=function(){return this._name};od.prototype.interfaces_=function(){return[_c]};od.prototype.getClass=function(){return od};nP.serialVersionUID.get=function(){return-552860263173159e4};nP.nameToTypeMap.get=function(){return new t5};Object.defineProperties(od,nP);Ei.Type=od;Ei.FIXED=new od("FIXED");Ei.FLOATING=new od("FLOATING");Ei.FLOATING_SINGLE=new od("FLOATING SINGLE");var ti=function e(){this._precisionModel=new Ei,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?xr(arguments[0],R0)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Ei&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},n5={serialVersionUID:{configurable:!0}};ti.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Ot(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Ot(t.getMinX(),t.getMinY()),new Ot(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Ot(t.getMinX(),t.getMinY()),new Ot(t.getMinX(),t.getMaxY()),new Ot(t.getMaxX(),t.getMaxY()),new Ot(t.getMaxX(),t.getMinY()),new Ot(t.getMinX(),t.getMinY())]),null)};ti.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new Fo(this.getCoordinateSequenceFactory().create(t),this);if(xr(t,ci))return new Fo(t,this)}else return new Fo(this.getCoordinateSequenceFactory().create([]),this)};ti.prototype.createMultiLineString=function(){if(arguments.length===0)return new M_(null,this);if(arguments.length===1){var t=arguments[0];return new M_(t,this)}};ti.prototype.buildGeometry=function(t){for(var n=null,r=!1,a=!1,u=t.iterator();u.hasNext();){var p=u.next(),i=p.getClass();n===null&&(n=i),i!==n&&(r=!0),p.isGeometryCollectionOrDerived()&&(a=!0)}if(n===null)return this.createGeometryCollection();if(r||a)return this.createGeometryCollection(ti.toGeometryArray(t));var b=t.iterator().next(),C=t.size()>1;if(C){if(b instanceof gs)return this.createMultiPolygon(ti.toPolygonArray(t));if(b instanceof Fo)return this.createMultiLineString(ti.toLineStringArray(t));if(b instanceof ql)return this.createMultiPoint(ti.toPointArray(t));qr.shouldNeverReachHere("Unhandled class: "+b.getClass().getName())}return b};ti.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};ti.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Ot){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(xr(arguments[0],ci)){var n=arguments[0];return new ql(n,this)}}};ti.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};ti.prototype.createPolygon=function(){if(arguments.length===0)return new gs(null,null,this);if(arguments.length===1){if(xr(arguments[0],ci)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}else if(arguments[0]instanceof uf){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var a=arguments[0],u=arguments[1];return new gs(a,u,this)}};ti.prototype.getSRID=function(){return this._SRID};ti.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Za(null,this);if(arguments.length===1){var t=arguments[0];return new Za(t,this)}};ti.prototype.createGeometry=function(t){var n=new dc(this);return n.edit(t,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};ti.prototype.getPrecisionModel=function(){return this._precisionModel};ti.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(xr(arguments[0],ci)){var n=arguments[0];return new uf(n,this)}}};ti.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Qd(null,this);if(arguments.length===1){var t=arguments[0];return new Qd(t,this)}};ti.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new F0(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new F0(n,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(xr(arguments[0],ci)){var a=arguments[0];if(a===null)return this.createMultiPoint(new Array(0).fill(null));for(var u=new Array(a.size()).fill(null),p=0;p<a.size();p++){var i=t.getCoordinateSequenceFactory().create(1,a.getDimension());Ho.copy(a,p,i,0,1),u[p]=t.createPoint(i)}return this.createMultiPoint(u)}}};ti.prototype.interfaces_=function(){return[_c]};ti.prototype.getClass=function(){return ti};ti.toMultiPolygonArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toGeometryArray=function(t){if(t===null)return null;var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.getDefaultCoordinateSequenceFactory=function(){return cf.instance()};ti.toMultiLineStringArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toLineStringArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toMultiPointArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toLinearRingArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toPointArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.toPolygonArray=function(t){var n=new Array(t.size()).fill(null);return t.toArray(n)};ti.createPointFromInternalCoord=function(t,n){return n.getPrecisionModel().makePrecise(t),n.getFactory().createPoint(t)};n5.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(ti,n5);var LQ=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],JE=function(t){this.geometryFactory=t||new ti};JE.prototype.read=function(t){var n;typeof t=="string"?n=JSON.parse(t):n=t;var r=n.type;if(!jh[r])throw new Error("Unknown GeoJSON type: "+n.type);return LQ.indexOf(r)!==-1?jh[r].apply(this,[n.coordinates]):r==="GeometryCollection"?jh[r].apply(this,[n.geometries]):jh[r].apply(this,[n])};JE.prototype.write=function(t){var n=t.getGeometryType();if(!_p[n])throw new Error("Geometry is not supported");return _p[n].apply(this,[t])};var jh={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var r=e.geometry.type;if(!jh[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=jh.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,n={};if(e.features){n.features=[];for(var r=0;r<e.features.length;++r)n.features.push(t.read(e.features[r]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(new Ot(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new Ot(e[0],e[1]),new Ot(e[2],e[1]),new Ot(e[2],e[3]),new Ot(e[0],e[3]),new Ot(e[0],e[1])])},Point:function(e){var t=new Ot(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,n=[],r=0;r<e.length;++r)n.push(jh.Point.apply(t,[e[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var t=jh.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,n=[],r=0;r<e.length;++r)n.push(jh.LineString.apply(t,[e[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var t=this,n=jh.coordinates.apply(this,[e[0]]),r=this.geometryFactory.createLinearRing(n),a=[],u=1;u<e.length;++u){var p=e[u],i=jh.coordinates.apply(t,[p]),b=t.geometryFactory.createLinearRing(i);a.push(b)}return this.geometryFactory.createPolygon(r,a)},MultiPolygon:function(e){for(var t=this,n=[],r=0;r<e.length;++r){var a=e[r];n.push(jh.Polygon.apply(t,[a]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var t=this,n=[],r=0;r<e.length;++r){var a=e[r];n.push(t.read(a))}return this.geometryFactory.createGeometryCollection(n)}},_p={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=_p.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var a=e._geometries[r],u=_p.Point.apply(t,[a]);n.push(u.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var t=this,n=[],r=e.getCoordinates(),a=0;a<r.length;++a){var u=r[a];n.push(_p.coordinate.apply(t,[u]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var a=e._geometries[r],u=_p.LineString.apply(t,[a]);n.push(u.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var t=this,n=[],r=_p.LineString.apply(this,[e._shell]);n.push(r.coordinates);for(var a=0;a<e._holes.length;++a){var u=e._holes[a],p=_p.LineString.apply(t,[u]);n.push(p.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var a=e._geometries[r],u=_p.Polygon.apply(t,[a]);n.push(u.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var t=this,n=[],r=0;r<e._geometries.length;++r){var a=e._geometries[r],u=a.getGeometryType();n.push(_p[u].apply(t,[a]))}return{type:"GeometryCollection",geometries:n}}},rP=function(t){this.geometryFactory=t||new ti,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new JE(this.geometryFactory)};rP.prototype.read=function(t){var n=this.parser.read(t);return this.precisionModel.getType()===Ei.FIXED&&this.reducePrecision(n),n};rP.prototype.reducePrecision=function(t){var n=this,r,a;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(r=0,a=t.points.length;r<a;r++)n.precisionModel.makePrecise(t.points[r]);else if(t.geometries)for(r=0,a=t.geometries.length;r<a;r++)n.reducePrecision(t.geometries[r])};var r5=function(){this.parser=new JE(this.geometryFactory)};r5.prototype.write=function(t){return this.parser.write(t)};var bn=function(){},QE={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};bn.prototype.interfaces_=function(){return[]};bn.prototype.getClass=function(){return bn};bn.opposite=function(t){return t===bn.LEFT?bn.RIGHT:t===bn.RIGHT?bn.LEFT:t};QE.ON.get=function(){return 0};QE.LEFT.get=function(){return 1};QE.RIGHT.get=function(){return 2};Object.defineProperties(bn,QE);function eC(e){this.message=e||""}eC.prototype=new Error;eC.prototype.name="EmptyStackException";function md(){this.array_=[]}md.prototype=new qc;md.prototype.add=function(e){return this.array_.push(e),!0};md.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};md.prototype.push=function(e){return this.array_.push(e),e};md.prototype.pop=function(e){if(this.array_.length===0)throw new eC;return this.array_.pop()};md.prototype.peek=function(){if(this.array_.length===0)throw new eC;return this.array_[this.array_.length-1]};md.prototype.empty=function(){return this.array_.length===0};md.prototype.isEmpty=function(){return this.empty()};md.prototype.search=function(e){return this.array_.indexOf(e)};md.prototype.size=function(){return this.array_.length};md.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};var sd=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};sd.prototype.getCoordinate=function(){return this._minCoord};sd.prototype.getRightmostSide=function(t,n){var r=this.getRightmostSideOfSegment(t,n);return r<0&&(r=this.getRightmostSideOfSegment(t,n-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),r};sd.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();qr.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var n=t[this._minIndex-1],r=t[this._minIndex+1],a=On.computeOrientation(this._minCoord,r,n),u=!1;(n.y<this._minCoord.y&&r.y<this._minCoord.y&&a===On.COUNTERCLOCKWISE||n.y>this._minCoord.y&&r.y>this._minCoord.y&&a===On.CLOCKWISE)&&(u=!0),u&&(this._minIndex=this._minIndex-1)};sd.prototype.getRightmostSideOfSegment=function(t,n){var r=t.getEdge(),a=r.getCoordinates();if(n<0||n+1>=a.length||a[n].y===a[n+1].y)return-1;var u=bn.LEFT;return a[n].y<a[n+1].y&&(u=bn.RIGHT),u};sd.prototype.getEdge=function(){return this._orientedDe};sd.prototype.checkForRightmostCoordinate=function(t){for(var n=this,r=t.getEdge().getCoordinates(),a=0;a<r.length-1;a++)(n._minCoord===null||r[a].x>n._minCoord.x)&&(n._minDe=t,n._minIndex=a,n._minCoord=r[a])};sd.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),n=t.getEdges();this._minDe=n.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};sd.prototype.findEdge=function(t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next();a.isForward()&&n.checkForRightmostCoordinate(a)}qr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var u=this.getRightmostSide(this._minDe,this._minIndex);u===bn.LEFT&&(this._orientedDe=this._minDe.getSym())};sd.prototype.interfaces_=function(){return[]};sd.prototype.getClass=function(){return sd};var Dp=function(e){function t(n,r){e.call(this,t.msgWithCoord(n,r)),this.pt=r?new Ot(r):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(r,a){return a?r:r+" [ "+a+" ]"},t}(Lp),tC=function(){this.array_=[]};tC.prototype.addLast=function(t){this.array_.push(t)};tC.prototype.removeFirst=function(){return this.array_.shift()};tC.prototype.isEmpty=function(){return this.array_.length===0};var Ya=function(){this._finder=null,this._dirEdgeList=new In,this._nodes=new In,this._rightMostCoord=null,this._env=null,this._finder=new sd};Ya.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var n=t.next();n.setVisited(!1)}};Ya.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ya.prototype.computeNodeDepth=function(t){for(var n=this,r=null,a=t.getEdges().iterator();a.hasNext();){var u=a.next();if(u.isVisited()||u.getSym().isVisited()){r=u;break}}if(r===null)throw new Dp("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(r);for(var p=t.getEdges().iterator();p.hasNext();){var i=p.next();i.setVisited(!0),n.copySymDepths(i)}};Ya.prototype.computeDepth=function(t){this.clearVisitedEdges();var n=this._finder.getEdge();n.setEdgeDepths(bn.RIGHT,t),this.copySymDepths(n),this.computeDepths(n)};Ya.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Ya.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var n=t.next();n.getDepth(bn.RIGHT)>=1&&n.getDepth(bn.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}};Ya.prototype.computeDepths=function(t){var n=this,r=new JM,a=new tC,u=t.getNode();for(a.addLast(u),r.add(u),t.setVisited(!0);!a.isEmpty();){var p=a.removeFirst();r.add(p),n.computeNodeDepth(p);for(var i=p.getEdges().iterator();i.hasNext();){var b=i.next(),C=b.getSym();if(!C.isVisited()){var A=C.getNode();r.contains(A)||(a.addLast(A),r.add(A))}}}};Ya.prototype.compareTo=function(t){var n=t;return this._rightMostCoord.x<n._rightMostCoord.x?-1:this._rightMostCoord.x>n._rightMostCoord.x?1:0};Ya.prototype.getEnvelope=function(){if(this._env===null){for(var t=new Qn,n=this._dirEdgeList.iterator();n.hasNext();)for(var r=n.next(),a=r.getEdge().getCoordinates(),u=0;u<a.length-1;u++)t.expandToInclude(a[u]);this._env=t}return this._env};Ya.prototype.addReachable=function(t){var n=this,r=new md;for(r.add(t);!r.empty();){var a=r.pop();n.add(a,r)}};Ya.prototype.copySymDepths=function(t){var n=t.getSym();n.setDepth(bn.LEFT,t.getDepth(bn.RIGHT)),n.setDepth(bn.RIGHT,t.getDepth(bn.LEFT))};Ya.prototype.add=function(t,n){var r=this;t.setVisited(!0),this._nodes.add(t);for(var a=t.getEdges().iterator();a.hasNext();){var u=a.next();r._dirEdgeList.add(u);var p=u.getSym(),i=p.getNode();i.isVisited()||n.push(i)}};Ya.prototype.getNodes=function(){return this._nodes};Ya.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ya.prototype.interfaces_=function(){return[gc]};Ya.prototype.getClass=function(){return Ya};var Ki=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[bn.ON]=r}else if(arguments[0]instanceof e){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var u=0;u<this.location.length;u++)t.location[u]=a.location[u]}}else if(arguments.length===3){var p=arguments[0],i=arguments[1],b=arguments[2];this.init(3),this.location[bn.ON]=p,this.location[bn.LEFT]=i,this.location[bn.RIGHT]=b}};Ki.prototype.setAllLocations=function(t){for(var n=this,r=0;r<this.location.length;r++)n.location[r]=t};Ki.prototype.isNull=function(){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==zt.NONE)return!1;return!0};Ki.prototype.setAllLocationsIfNull=function(t){for(var n=this,r=0;r<this.location.length;r++)n.location[r]===zt.NONE&&(n.location[r]=t)};Ki.prototype.isLine=function(){return this.location.length===1};Ki.prototype.merge=function(t){var n=this;if(t.location.length>this.location.length){var r=new Array(3).fill(null);r[bn.ON]=this.location[bn.ON],r[bn.LEFT]=zt.NONE,r[bn.RIGHT]=zt.NONE,this.location=r}for(var a=0;a<this.location.length;a++)n.location[a]===zt.NONE&&a<t.location.length&&(n.location[a]=t.location[a])};Ki.prototype.getLocations=function(){return this.location};Ki.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[bn.LEFT];this.location[bn.LEFT]=this.location[bn.RIGHT],this.location[bn.RIGHT]=t};Ki.prototype.toString=function(){var t=new pd;return this.location.length>1&&t.append(zt.toLocationSymbol(this.location[bn.LEFT])),t.append(zt.toLocationSymbol(this.location[bn.ON])),this.location.length>1&&t.append(zt.toLocationSymbol(this.location[bn.RIGHT])),t.toString()};Ki.prototype.setLocations=function(t,n,r){this.location[bn.ON]=t,this.location[bn.LEFT]=n,this.location[bn.RIGHT]=r};Ki.prototype.get=function(t){return t<this.location.length?this.location[t]:zt.NONE};Ki.prototype.isArea=function(){return this.location.length>1};Ki.prototype.isAnyNull=function(){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]===zt.NONE)return!0;return!1};Ki.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(bn.ON,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.location[n]=r}};Ki.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(zt.NONE)};Ki.prototype.isEqualOnSide=function(t,n){return this.location[n]===t.location[n]};Ki.prototype.allPositionsEqual=function(t){for(var n=this,r=0;r<this.location.length;r++)if(n.location[r]!==t)return!1;return!0};Ki.prototype.interfaces_=function(){return[]};Ki.prototype.getClass=function(){return Ki};var Ni=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Ki(t),this.elt[1]=new Ki(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Ki(n.elt[0]),this.elt[1]=new Ki(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.elt[0]=new Ki(zt.NONE),this.elt[1]=new Ki(zt.NONE),this.elt[r].setLocation(a)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],i=arguments[2];this.elt[0]=new Ki(u,p,i),this.elt[1]=new Ki(u,p,i)}else if(arguments.length===4){var b=arguments[0],C=arguments[1],A=arguments[2],R=arguments[3];this.elt[0]=new Ki(zt.NONE,zt.NONE,zt.NONE),this.elt[1]=new Ki(zt.NONE,zt.NONE,zt.NONE),this.elt[b].setLocations(C,A,R)}};Ni.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};Ni.prototype.setAllLocations=function(t,n){this.elt[t].setAllLocations(n)};Ni.prototype.isNull=function(t){return this.elt[t].isNull()};Ni.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.elt[n].setAllLocationsIfNull(r)}};Ni.prototype.isLine=function(t){return this.elt[t].isLine()};Ni.prototype.merge=function(t){for(var n=this,r=0;r<2;r++)n.elt[r]===null&&t.elt[r]!==null?n.elt[r]=new Ki(t.elt[r]):n.elt[r].merge(t.elt[r])};Ni.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Ni.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(bn.ON)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.elt[n].get(r)}};Ni.prototype.toString=function(){var t=new pd;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};Ni.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};Ni.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};Ni.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setLocation(bn.ON,n)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this.elt[r].setLocation(a,u)}};Ni.prototype.isEqualOnSide=function(t,n){return this.elt[0].isEqualOnSide(t.elt[0],n)&&this.elt[1].isEqualOnSide(t.elt[1],n)};Ni.prototype.allPositionsEqual=function(t,n){return this.elt[t].allPositionsEqual(n)};Ni.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Ki(this.elt[t].location[0]))};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};Ni.toLineLabel=function(t){for(var n=new Ni(zt.NONE),r=0;r<2;r++)n.setLocation(r,t.getLocation(r));return n};var ls=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new In,this._pts=new In,this._label=new Ni(zt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new In,this._geometryFactory=null;var t=arguments[0],n=arguments[1];this._geometryFactory=n,this.computePoints(t),this.computeRing()};ls.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var n=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)n[r]=t._pts.get(r);this._ring=this._geometryFactory.createLinearRing(n),this._isHole=On.isCCW(this._ring.getCoordinates())};ls.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};ls.prototype.computePoints=function(t){var n=this;this._startDe=t;var r=t,a=!0;do{if(r===null)throw new Dp("Found null DirectedEdge");if(r.getEdgeRing()===n)throw new Dp("Directed Edge visited twice during ring-building at "+r.getCoordinate());n._edges.add(r);var u=r.getLabel();qr.isTrue(u.isArea()),n.mergeLabel(u),n.addPoints(r.getEdge(),r.isForward(),a),a=!1,n.setEdgeRing(r,n),r=n.getNext(r)}while(r!==this._startDe)};ls.prototype.getLinearRing=function(){return this._ring};ls.prototype.getCoordinate=function(t){return this._pts.get(t)};ls.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var n=this._startDe;do{var r=n.getNode(),a=r.getEdges().getOutgoingDegree(t);a>t._maxNodeDegree&&(t._maxNodeDegree=a),n=t.getNext(n)}while(n!==this._startDe);this._maxNodeDegree*=2};ls.prototype.addPoints=function(t,n,r){var a=this,u=t.getCoordinates();if(n){var p=1;r&&(p=0);for(var i=p;i<u.length;i++)a._pts.add(u[i])}else{var b=u.length-2;r&&(b=u.length-1);for(var C=b;C>=0;C--)a._pts.add(u[C])}};ls.prototype.isHole=function(){return this._isHole};ls.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};ls.prototype.containsPoint=function(t){var n=this.getLinearRing(),r=n.getEnvelopeInternal();if(!r.contains(t)||!On.isPointInRing(t,n.getCoordinates()))return!1;for(var a=this._holes.iterator();a.hasNext();){var u=a.next();if(u.containsPoint(t))return!1}return!0};ls.prototype.addHole=function(t){this._holes.add(t)};ls.prototype.isShell=function(){return this._shell===null};ls.prototype.getLabel=function(){return this._label};ls.prototype.getEdges=function(){return this._edges};ls.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};ls.prototype.getShell=function(){return this._shell};ls.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=n.getLocation(r,bn.RIGHT);if(a===zt.NONE)return null;if(this._label.getLocation(r)===zt.NONE)return this._label.setLocation(r,a),null}};ls.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};ls.prototype.toPolygon=function(t){for(var n=this,r=new Array(this._holes.size()).fill(null),a=0;a<this._holes.size();a++)r[a]=n._holes.get(a).getLinearRing();var u=t.createPolygon(this.getLinearRing(),r);return u};ls.prototype.interfaces_=function(){return[]};ls.prototype.getClass=function(){return ls};var OQ=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(r,a){r.setMinEdgeRing(a)},t.prototype.getNext=function(r){return r.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ls),DQ=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var r=this,a=new In,u=this._startDe;do{if(u.getMinEdgeRing()===null){var p=new OQ(u,r._geometryFactory);a.add(p)}u=u.getNext()}while(u!==this._startDe);return a},t.prototype.setEdgeRing=function(r,a){r.setEdgeRing(a)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,a=this._startDe;do{var u=a.getNode();u.getEdges().linkMinimalDirectedEdges(r),a=a.getNext()}while(a!==this._startDe)},t.prototype.getNext=function(r){return r.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ls),Mu=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._label=t}}};Mu.prototype.setVisited=function(t){this._isVisited=t};Mu.prototype.setInResult=function(t){this._isInResult=t};Mu.prototype.isCovered=function(){return this._isCovered};Mu.prototype.isCoveredSet=function(){return this._isCoveredSet};Mu.prototype.setLabel=function(t){this._label=t};Mu.prototype.getLabel=function(){return this._label};Mu.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Mu.prototype.updateIM=function(t){qr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Mu.prototype.isInResult=function(){return this._isInResult};Mu.prototype.isVisited=function(){return this._isVisited};Mu.prototype.interfaces_=function(){return[]};Mu.prototype.getClass=function(){return Mu};var nC=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new Ni(0,zt.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var a=r.next();if(a.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(r){},t.prototype.computeMergedLocation=function(r,a){var u=zt.NONE;if(u=this._label.getLocation(a),!r.isNull(a)){var p=r.getLocation(a);u!==zt.BOUNDARY&&(u=p)}return u},t.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];this._label===null?this._label=new Ni(r,a):this._label.setLocation(r,a)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof t){var a=arguments[0];this.mergeLabel(a._label)}else if(arguments[0]instanceof Ni)for(var u=arguments[0],p=0;p<2;p++){var i=r.computeMergedLocation(u,p),b=r._label.getLocation(p);b===zt.NONE&&r._label.setLocation(p,i)}},t.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},t.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var a=zt.NONE;this._label!==null&&(a=this._label.getLocation(r));var u=null;switch(a){case zt.BOUNDARY:u=zt.INTERIOR;break;case zt.INTERIOR:u=zt.BOUNDARY;break;default:u=zt.BOUNDARY;break}this._label.setLocation(r,u)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Mu),ad=function(){this.nodeMap=new Ea,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};ad.prototype.find=function(t){return this.nodeMap.get(t)};ad.prototype.addNode=function(){if(arguments[0]instanceof Ot){var t=arguments[0],n=this.nodeMap.get(t);return n===null&&(n=this.nodeFact.createNode(t),this.nodeMap.put(t,n)),n}else if(arguments[0]instanceof nC){var r=arguments[0],a=this.nodeMap.get(r.getCoordinate());return a===null?(this.nodeMap.put(r.getCoordinate(),r),r):(a.mergeLabel(r),a)}};ad.prototype.print=function(t){for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(t)}};ad.prototype.iterator=function(){return this.nodeMap.values().iterator()};ad.prototype.values=function(){return this.nodeMap.values()};ad.prototype.getBoundaryNodes=function(t){for(var n=new In,r=this.iterator();r.hasNext();){var a=r.next();a.getLabel().getLocation(t)===zt.BOUNDARY&&n.add(a)}return n};ad.prototype.add=function(t){var n=t.getCoordinate(),r=this.addNode(n);r.add(t)};ad.prototype.interfaces_=function(){return[]};ad.prototype.getClass=function(){return ad};var ji=function(){},Fb={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};ji.prototype.interfaces_=function(){return[]};ji.prototype.getClass=function(){return ji};ji.isNorthern=function(t){return t===ji.NE||t===ji.NW};ji.isOpposite=function(t,n){if(t===n)return!1;var r=(t-n+4)%4;return r===2};ji.commonHalfPlane=function(t,n){if(t===n)return t;var r=(t-n+4)%4;if(r===2)return-1;var a=t<n?t:n,u=t>n?t:n;return a===0&&u===3?3:a};ji.isInHalfPlane=function(t,n){return n===ji.SE?t===ji.SE||t===ji.SW:t===n||t===n+1};ji.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];if(t===0&&n===0)throw new po("Cannot compute the quadrant for point ( "+t+", "+n+" )");return t>=0?n>=0?ji.NE:ji.SE:n>=0?ji.NW:ji.SW}else if(arguments[0]instanceof Ot&&arguments[1]instanceof Ot){var r=arguments[0],a=arguments[1];if(a.x===r.x&&a.y===r.y)throw new po("Cannot compute the quadrant for two identical points "+r);return a.x>=r.x?a.y>=r.y?ji.NE:ji.SE:a.y>=r.y?ji.NW:ji.SW}};Fb.NE.get=function(){return 0};Fb.NW.get=function(){return 1};Fb.SW.get=function(){return 2};Fb.SE.get=function(){return 3};Object.defineProperties(ji,Fb);var Ca=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2],u=null;this._edge=n,this.init(r,a),this._label=u}else if(arguments.length===4){var p=arguments[0],i=arguments[1],b=arguments[2],C=arguments[3];this._edge=p,this.init(i,b),this._label=C}};Ca.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:On.computeOrientation(t._p0,t._p1,this._p1)};Ca.prototype.getDy=function(){return this._dy};Ca.prototype.getCoordinate=function(){return this._p0};Ca.prototype.setNode=function(t){this._node=t};Ca.prototype.print=function(t){var n=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),a=r.lastIndexOf("."),u=r.substring(a+1);t.print("  "+u+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label)};Ca.prototype.compareTo=function(t){var n=t;return this.compareDirection(n)};Ca.prototype.getDirectedCoordinate=function(){return this._p1};Ca.prototype.getDx=function(){return this._dx};Ca.prototype.getLabel=function(){return this._label};Ca.prototype.getEdge=function(){return this._edge};Ca.prototype.getQuadrant=function(){return this._quadrant};Ca.prototype.getNode=function(){return this._node};Ca.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),a=n.substring(r+1);return"  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};Ca.prototype.computeLabel=function(t){};Ca.prototype.init=function(t,n){this._p0=t,this._p1=n,this._dx=n.x-t.x,this._dy=n.y-t.y,this._quadrant=ji.quadrant(this._dx,this._dy),qr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Ca.prototype.interfaces_=function(){return[gc]};Ca.prototype.getClass=function(){return Ca};var p2=function(e){function t(){var n=arguments[0],r=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var a=n.getNumPoints()-1;this.init(n.getCoordinate(a),n.getCoordinate(a-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(r){return this._depth[r]},t.prototype.setVisited=function(r){this._isVisited=r},t.prototype.computeDirectedLabel=function(){this._label=new Ni(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(r,a){if(this._depth[r]!==-999&&this._depth[r]!==a)throw new Dp("assigned depths do not match",this.getCoordinate());this._depth[r]=a},t.prototype.isInteriorAreaEdge=function(){for(var r=this,a=!0,u=0;u<2;u++)r._label.isArea(u)&&r._label.getLocation(u,bn.LEFT)===zt.INTERIOR&&r._label.getLocation(u,bn.RIGHT)===zt.INTERIOR||(a=!1);return a},t.prototype.setNextMin=function(r){this._nextMin=r},t.prototype.print=function(r){e.prototype.print.call(this,r),r.print(" "+this._depth[bn.LEFT]+"/"+this._depth[bn.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},t.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},t.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),a=!this._label.isArea(0)||this._label.allPositionsEqual(0,zt.EXTERIOR),u=!this._label.isArea(1)||this._label.allPositionsEqual(1,zt.EXTERIOR);return r&&a&&u},t.prototype.setEdgeRing=function(r){this._edgeRing=r},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},t.prototype.setInResult=function(r){this._isInResult=r},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},t.prototype.setSym=function(r){this._sym=r},t.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},t.prototype.setEdgeDepths=function(r,a){var u=this.getEdge().getDepthDelta();this._isForward||(u=-u);var p=1;r===bn.LEFT&&(p=-1);var i=bn.opposite(r),b=u*p,C=a+b;this.setDepth(r,a),this.setDepth(i,C)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(r){this._next=r},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(r,a){return r===zt.EXTERIOR&&a===zt.INTERIOR?1:r===zt.INTERIOR&&a===zt.EXTERIOR?-1:0},t}(Ca),z0=function(){};z0.prototype.createNode=function(t){return new nC(t,null)};z0.prototype.interfaces_=function(){return[]};z0.prototype.getClass=function(){return z0};var Eo=function(){if(this._edges=new In,this._nodes=null,this._edgeEndList=new In,arguments.length===0)this._nodes=new ad(new z0);else if(arguments.length===1){var t=arguments[0];this._nodes=new ad(t)}};Eo.prototype.printEdges=function(t){var n=this;t.println("Edges:");for(var r=0;r<this._edges.size();r++){t.println("edge "+r+":");var a=n._edges.get(r);a.print(t),a.eiList.print(t)}};Eo.prototype.find=function(t){return this._nodes.find(t)};Eo.prototype.addNode=function(){if(arguments[0]instanceof nC){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof Ot){var n=arguments[0];return this._nodes.addNode(n)}};Eo.prototype.getNodeIterator=function(){return this._nodes.iterator()};Eo.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};Eo.prototype.debugPrintln=function(t){ta.out.println(t)};Eo.prototype.isBoundaryNode=function(t,n){var r=this._nodes.find(n);if(r===null)return!1;var a=r.getLabel();return a!==null&&a.getLocation(t)===zt.BOUNDARY};Eo.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var n=t.next();n.getEdges().linkAllDirectedEdges()}};Eo.prototype.matchInSameDirection=function(t,n,r,a){return t.equals(r)?On.computeOrientation(t,n,a)===On.COLLINEAR&&ji.quadrant(t,n)===ji.quadrant(r,a):!1};Eo.prototype.getEdgeEnds=function(){return this._edgeEndList};Eo.prototype.debugPrint=function(t){ta.out.print(t)};Eo.prototype.getEdgeIterator=function(){return this._edges.iterator()};Eo.prototype.findEdgeInSameDirection=function(t,n){for(var r=this,a=0;a<this._edges.size();a++){var u=r._edges.get(a),p=u.getCoordinates();if(r.matchInSameDirection(t,n,p[0],p[1])||r.matchInSameDirection(t,n,p[p.length-1],p[p.length-2]))return u}return null};Eo.prototype.insertEdge=function(t){this._edges.add(t)};Eo.prototype.findEdgeEnd=function(t){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var r=n.next();if(r.getEdge()===t)return r}return null};Eo.prototype.addEdges=function(t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next();n._edges.add(a);var u=new p2(a,!0),p=new p2(a,!1);u.setSym(p),p.setSym(u),n.add(u),n.add(p)}};Eo.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};Eo.prototype.getNodes=function(){return this._nodes.values()};Eo.prototype.findEdge=function(t,n){for(var r=this,a=0;a<this._edges.size();a++){var u=r._edges.get(a),p=u.getCoordinates();if(t.equals(p[0])&&n.equals(p[1]))return u}return null};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};Eo.linkResultDirectedEdges=function(t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.getEdges().linkResultDirectedEdges()}};var Hl=function(){this._geometryFactory=null,this._shellList=new In;var t=arguments[0];this._geometryFactory=t};Hl.prototype.sortShellsAndHoles=function(t,n,r){for(var a=t.iterator();a.hasNext();){var u=a.next();u.isHole()?r.add(u):n.add(u)}};Hl.prototype.computePolygons=function(t){for(var n=this,r=new In,a=t.iterator();a.hasNext();){var u=a.next(),p=u.toPolygon(n._geometryFactory);r.add(p)}return r};Hl.prototype.placeFreeHoles=function(t,n){for(var r=this,a=n.iterator();a.hasNext();){var u=a.next();if(u.getShell()===null){var p=r.findEdgeRingContaining(u,t);if(p===null)throw new Dp("unable to assign hole to a shell",u.getCoordinate(0));u.setShell(p)}}};Hl.prototype.buildMinimalEdgeRings=function(t,n,r){for(var a=this,u=new In,p=t.iterator();p.hasNext();){var i=p.next();if(i.getMaxNodeDegree()>2){i.linkDirectedEdgesForMinimalEdgeRings();var b=i.buildMinimalRings(),C=a.findShell(b);C!==null?(a.placePolygonHoles(C,b),n.add(C)):r.addAll(b)}else u.add(i)}return u};Hl.prototype.containsPoint=function(t){for(var n=this._shellList.iterator();n.hasNext();){var r=n.next();if(r.containsPoint(t))return!0}return!1};Hl.prototype.buildMaximalEdgeRings=function(t){for(var n=this,r=new In,a=t.iterator();a.hasNext();){var u=a.next();if(u.isInResult()&&u.getLabel().isArea()&&u.getEdgeRing()===null){var p=new DQ(u,n._geometryFactory);r.add(p),p.setInResult()}}return r};Hl.prototype.placePolygonHoles=function(t,n){for(var r=n.iterator();r.hasNext();){var a=r.next();a.isHole()&&a.setShell(t)}};Hl.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};Hl.prototype.findEdgeRingContaining=function(t,n){for(var r=t.getLinearRing(),a=r.getEnvelopeInternal(),u=r.getCoordinateN(0),p=null,i=null,b=n.iterator();b.hasNext();){var C=b.next(),A=C.getLinearRing(),R=A.getEnvelopeInternal();p!==null&&(i=p.getLinearRing().getEnvelopeInternal());var z=!1;R.contains(a)&&On.isPointInRing(u,A.getCoordinates())&&(z=!0),z&&(p===null||i.contains(R))&&(p=C)}return p};Hl.prototype.findShell=function(t){for(var n=0,r=null,a=t.iterator();a.hasNext();){var u=a.next();u.isHole()||(r=u,n++)}return qr.isTrue(n<=1,"found two shells in MinimalEdgeRing list"),r};Hl.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var n=arguments[0],r=arguments[1];Eo.linkResultDirectedEdges(r);var a=this.buildMaximalEdgeRings(n),u=new In,p=this.buildMinimalEdgeRings(a,this._shellList,u);this.sortShellsAndHoles(p,this._shellList,u),this.placeFreeHoles(this._shellList,u)}};Hl.prototype.interfaces_=function(){return[]};Hl.prototype.getClass=function(){return Hl};var B0=function(){};B0.prototype.getBounds=function(){};B0.prototype.interfaces_=function(){return[]};B0.prototype.getClass=function(){return B0};var Kc=function(){this._bounds=null,this._item=null;var t=arguments[0],n=arguments[1];this._bounds=t,this._item=n};Kc.prototype.getItem=function(){return this._item};Kc.prototype.getBounds=function(){return this._bounds};Kc.prototype.interfaces_=function(){return[B0,_c]};Kc.prototype.getClass=function(){return Kc};var Np=function(){this._size=null,this._items=null,this._size=0,this._items=new In,this._items.add(null)};Np.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};Np.prototype.size=function(){return this._size};Np.prototype.reorder=function(t){for(var n=this,r=null,a=this._items.get(t);t*2<=this._size&&(r=t*2,r!==n._size&&n._items.get(r+1).compareTo(n._items.get(r))<0&&r++,n._items.get(r).compareTo(a)<0);t=r)n._items.set(t,n._items.get(r));this._items.set(t,a)};Np.prototype.clear=function(){this._size=0,this._items.clear()};Np.prototype.isEmpty=function(){return this._size===0};Np.prototype.add=function(t){var n=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)n._items.set(r,n._items.get(Math.trunc(r/2)));this._items.set(r,t)};Np.prototype.interfaces_=function(){return[]};Np.prototype.getClass=function(){return Np};var ng=function(){};ng.prototype.visitItem=function(t){};ng.prototype.interfaces_=function(){return[]};ng.prototype.getClass=function(){return ng};var Hy=function(){};Hy.prototype.insert=function(t,n){};Hy.prototype.remove=function(t,n){};Hy.prototype.query=function(){};Hy.prototype.interfaces_=function(){return[]};Hy.prototype.getClass=function(){return Hy};var ms=function(){if(this._childBoundables=new In,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._level=t}}},i5={serialVersionUID:{configurable:!0}};ms.prototype.getLevel=function(){return this._level};ms.prototype.size=function(){return this._childBoundables.size()};ms.prototype.getChildBoundables=function(){return this._childBoundables};ms.prototype.addChildBoundable=function(t){qr.isTrue(this._bounds===null),this._childBoundables.add(t)};ms.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};ms.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};ms.prototype.interfaces_=function(){return[B0,_c]};ms.prototype.getClass=function(){return ms};i5.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(ms,i5);var Jc=function(){};Jc.reverseOrder=function(){return{compare:function(n,r){return r.compareTo(n)}}};Jc.min=function(t){return Jc.sort(t),t.get(0)};Jc.sort=function(t,n){var r=t.toArray();n?v_.sort(r,n):v_.sort(r);for(var a=t.iterator(),u=0,p=r.length;u<p;u++)a.next(),a.set(r[u])};Jc.singletonList=function(t){var n=new In;return n.add(t),n};var os=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundable1=t,this._boundable2=n,this._itemDistance=r,this._distance=this.distance()};os.prototype.expandToQueue=function(t,n){var r=os.isComposite(this._boundable1),a=os.isComposite(this._boundable2);if(r&&a)return os.area(this._boundable1)>os.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,n),null):(this.expand(this._boundable2,this._boundable1,t,n),null);if(r)return this.expand(this._boundable1,this._boundable2,t,n),null;if(a)return this.expand(this._boundable2,this._boundable1,t,n),null;throw new po("neither boundable is composite")};os.prototype.isLeaves=function(){return!(os.isComposite(this._boundable1)||os.isComposite(this._boundable2))};os.prototype.compareTo=function(t){var n=t;return this._distance<n._distance?-1:this._distance>n._distance?1:0};os.prototype.expand=function(t,n,r,a){for(var u=this,p=t.getChildBoundables(),i=p.iterator();i.hasNext();){var b=i.next(),C=new os(b,n,u._itemDistance);C.getDistance()<a&&r.add(C)}};os.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};os.prototype.getDistance=function(){return this._distance};os.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};os.prototype.interfaces_=function(){return[gc]};os.prototype.getClass=function(){return os};os.area=function(t){return t.getBounds().getArea()};os.isComposite=function(t){return t instanceof ms};var ks=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new In,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];qr.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},rC={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ks.prototype.getNodeCapacity=function(){return this._nodeCapacity};ks.prototype.lastNode=function(t){return t.get(t.size()-1)};ks.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var n=arguments[0],r=0,a=n.getChildBoundables().iterator();a.hasNext();){var u=a.next();u instanceof ms?r+=t.size(u):u instanceof Kc&&(r+=1)}return r}};ks.prototype.removeItem=function(t,n){for(var r=null,a=t.getChildBoundables().iterator();a.hasNext();){var u=a.next();u instanceof Kc&&u.getItem()===n&&(r=u)}return r!==null?(t.getChildBoundables().remove(r),!0):!1};ks.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var n=this.itemsTree(this._root);return n===null?new In:n}else if(arguments.length===1){for(var r=arguments[0],a=new In,u=r.getChildBoundables().iterator();u.hasNext();){var p=u.next();if(p instanceof ms){var i=t.itemsTree(p);i!==null&&a.add(i)}else p instanceof Kc?a.add(p.getItem()):qr.shouldNeverReachHere()}return a.size()<=0?null:a}};ks.prototype.insert=function(t,n){qr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Kc(t,n))};ks.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var n=arguments[0],r=new In;return this.boundablesAtLevel(n,this._root,r),r}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];if(qr.isTrue(a>-2),u.getLevel()===a)return p.add(u),null;for(var i=u.getChildBoundables().iterator();i.hasNext();){var b=i.next();b instanceof ms?t.boundablesAtLevel(a,b,p):(qr.isTrue(b instanceof Kc),a===-1&&p.add(b))}return null}};ks.prototype.query=function(){var t=this;if(arguments.length===1){var n=arguments[0];this.build();var r=new In;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r),r}else if(arguments.length===2){var a=arguments[0],u=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.query(a,this._root,u)}else if(arguments.length===3){if(xr(arguments[2],ng)&&arguments[0]instanceof Object&&arguments[1]instanceof ms)for(var p=arguments[0],i=arguments[1],b=arguments[2],C=i.getChildBoundables(),A=0;A<C.size();A++){var R=C.get(A);t.getIntersectsOp().intersects(R.getBounds(),p)&&(R instanceof ms?t.query(p,R,b):R instanceof Kc?b.visitItem(R.getItem()):qr.shouldNeverReachHere())}else if(xr(arguments[2],qc)&&arguments[0]instanceof Object&&arguments[1]instanceof ms)for(var z=arguments[0],V=arguments[1],W=arguments[2],X=V.getChildBoundables(),ue=0;ue<X.size();ue++){var ie=X.get(ue);t.getIntersectsOp().intersects(ie.getBounds(),z)&&(ie instanceof ms?t.query(z,ie,W):ie instanceof Kc?W.add(ie.getItem()):qr.shouldNeverReachHere())}}};ks.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};ks.prototype.getRoot=function(){return this.build(),this._root};ks.prototype.remove=function(){var t=this;if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),n)?this.remove(n,this._root,r):!1}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2],i=this.removeItem(u,p);if(i)return!0;for(var b=null,C=u.getChildBoundables().iterator();C.hasNext();){var A=C.next();if(t.getIntersectsOp().intersects(A.getBounds(),a)&&A instanceof ms&&(i=t.remove(a,A,p),i)){b=A;break}}return b!==null&&b.getChildBoundables().isEmpty()&&u.getChildBoundables().remove(b),i}};ks.prototype.createHigherLevels=function(t,n){qr.isTrue(!t.isEmpty());var r=this.createParentBoundables(t,n+1);return r.size()===1?r.get(0):this.createHigherLevels(r,n+1)};ks.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var n=arguments[0],r=0,a=n.getChildBoundables().iterator();a.hasNext();){var u=a.next();if(u instanceof ms){var p=t.depth(u);p>r&&(r=p)}}return r+1}};ks.prototype.createParentBoundables=function(t,n){var r=this;qr.isTrue(!t.isEmpty());var a=new In;a.add(this.createNode(n));var u=new In(t);Jc.sort(u,this.getComparator());for(var p=u.iterator();p.hasNext();){var i=p.next();r.lastNode(a).getChildBoundables().size()===r.getNodeCapacity()&&a.add(r.createNode(n)),r.lastNode(a).addChildBoundable(i)}return a};ks.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};ks.prototype.interfaces_=function(){return[_c]};ks.prototype.getClass=function(){return ks};ks.compareDoubles=function(t,n){return t>n?1:t<n?-1:0};rC.IntersectsOp.get=function(){return NQ};rC.serialVersionUID.get=function(){return-3886435814360241e3};rC.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(ks,rC);var NQ=function(){},j0=function(){};j0.prototype.distance=function(t,n){};j0.prototype.interfaces_=function(){return[]};j0.prototype.getClass=function(){return j0};var o5=function(e){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,e.call(this,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(a,u){var p=this;qr.isTrue(a.length>0);for(var i=new In,b=0;b<a.length;b++)i.addAll(p.createParentBoundablesFromVerticalSlice(a[b],u));return i},t.prototype.createNode=function(a){return new nN(a)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];if(a.isNull())return null;e.prototype.insert.call(this,a,u)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(a,u){for(var p=Math.trunc(Math.ceil(a.size()/u)),i=new Array(u).fill(null),b=a.iterator(),C=0;C<u;C++){i[C]=new In;for(var A=0;b.hasNext()&&A<p;){var R=b.next();i[C].add(R),A++}}return i},t.prototype.query=function(){if(arguments.length===1){var a=arguments[0];return e.prototype.query.call(this,a)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];e.prototype.query.call(this,u,p)}else if(arguments.length===3){if(xr(arguments[2],ng)&&arguments[0]instanceof Object&&arguments[1]instanceof ms){var i=arguments[0],b=arguments[1],C=arguments[2];e.prototype.query.call(this,i,b,C)}else if(xr(arguments[2],qc)&&arguments[0]instanceof Object&&arguments[1]instanceof ms){var A=arguments[0],R=arguments[1],z=arguments[2];e.prototype.query.call(this,A,R,z)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(a,u){return e.prototype.createParentBoundables.call(this,a,u)},t.prototype.remove=function(){if(arguments.length===2){var a=arguments[0],u=arguments[1];return e.prototype.remove.call(this,a,u)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(a,u){qr.isTrue(!a.isEmpty());var p=Math.trunc(Math.ceil(a.size()/this.getNodeCapacity())),i=new In(a);Jc.sort(i,t.xComparator);var b=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(p))));return this.createParentBoundablesFromVerticalSlices(b,u)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(xr(arguments[0],j0)){var a=arguments[0],u=new os(this.getRoot(),this.getRoot(),a);return this.nearestNeighbour(u)}else if(arguments[0]instanceof os){var p=arguments[0];return this.nearestNeighbour(p,Dr.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&xr(arguments[1],j0)){var i=arguments[0],b=arguments[1],C=new os(this.getRoot(),i.getRoot(),b);return this.nearestNeighbour(C)}else if(arguments[0]instanceof os&&typeof arguments[1]=="number"){var A=arguments[0],R=arguments[1],z=R,V=null,W=new Np;for(W.add(A);!W.isEmpty()&&z>0;){var X=W.poll(),ue=X.getDistance();if(ue>=z)break;X.isLeaves()?(z=ue,V=X):X.expandToQueue(W,z)}return[V.getBoundable(0).getItem(),V.getBoundable(1).getItem()]}}else if(arguments.length===3){var ie=arguments[0],K=arguments[1],ee=arguments[2],ae=new Kc(ie,K),he=new os(this.getRoot(),ae,ee);return this.nearestNeighbour(he)[0]}},t.prototype.interfaces_=function(){return[Hy,_c]},t.prototype.getClass=function(){return t},t.centreX=function(a){return t.avg(a.getMinX(),a.getMaxX())},t.avg=function(a,u){return(a+u)/2},t.centreY=function(a){return t.avg(a.getMinY(),a.getMaxY())},n.STRtreeNode.get=function(){return nN},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[A0]},compare:function(r,a){return e.compareDoubles(t.centreX(r.getBounds()),t.centreX(a.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[A0]},compare:function(r,a){return e.compareDoubles(t.centreY(r.getBounds()),t.centreY(a.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(r,a){return r.intersects(a)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(ks),nN=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var r=null,a=this.getChildBoundables().iterator();a.hasNext();){var u=a.next();r===null?r=new Qn(u.getBounds()):r.expandToInclude(u.getBounds())}return r},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ms),ml=function(){};ml.prototype.interfaces_=function(){return[]};ml.prototype.getClass=function(){return ml};ml.relativeSign=function(t,n){return t<n?-1:t>n?1:0};ml.compare=function(t,n,r){if(n.equals2D(r))return 0;var a=ml.relativeSign(n.x,r.x),u=ml.relativeSign(n.y,r.y);switch(t){case 0:return ml.compareValue(a,u);case 1:return ml.compareValue(u,a);case 2:return ml.compareValue(u,-a);case 3:return ml.compareValue(-a,u);case 4:return ml.compareValue(-a,-u);case 5:return ml.compareValue(-u,-a);case 6:return ml.compareValue(-u,a);case 7:return ml.compareValue(a,-u)}return qr.shouldNeverReachHere("invalid octant value"),0};ml.compareValue=function(t,n){return t<0?-1:t>0?1:n<0?-1:n>0?1:0};var rg=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];this._segString=t,this.coord=new Ot(n),this.segmentIndex=r,this._segmentOctant=a,this._isInterior=!n.equals2D(t.getCoordinate(r))};rg.prototype.getCoordinate=function(){return this.coord};rg.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};rg.prototype.compareTo=function(t){var n=t;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:ml.compare(this._segmentOctant,this.coord,n.coord)};rg.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};rg.prototype.isInterior=function(){return this._isInterior};rg.prototype.interfaces_=function(){return[gc]};rg.prototype.getClass=function(){return rg};var Ka=function(){this._nodeMap=new Ea,this._edge=null;var t=arguments[0];this._edge=t};Ka.prototype.getSplitCoordinates=function(){var t=this,n=new Nb;this.addEndpoints();for(var r=this.iterator(),a=r.next();r.hasNext();){var u=r.next();t.addEdgeCoordinates(a,u,n),a=u}return n.toCoordinateArray()};Ka.prototype.addCollapsedNodes=function(){var t=this,n=new In;this.findCollapsesFromInsertedNodes(n),this.findCollapsesFromExistingVertices(n);for(var r=n.iterator();r.hasNext();){var a=r.next().intValue();t.add(t._edge.getCoordinate(a),a)}};Ka.prototype.print=function(t){t.println("Intersections:");for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(t)}};Ka.prototype.findCollapsesFromExistingVertices=function(t){for(var n=this,r=0;r<this._edge.size()-2;r++){var a=n._edge.getCoordinate(r),u=n._edge.getCoordinate(r+2);a.equals2D(u)&&t.add(new nd(r+1))}};Ka.prototype.addEdgeCoordinates=function(t,n,r){var a=this,u=this._edge.getCoordinate(n.segmentIndex),p=n.isInterior()||!n.coord.equals2D(u);r.add(new Ot(t.coord),!1);for(var i=t.segmentIndex+1;i<=n.segmentIndex;i++)r.add(a._edge.getCoordinate(i));p&&r.add(new Ot(n.coord))};Ka.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ka.prototype.addSplitEdges=function(t){var n=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),a=r.next();r.hasNext();){var u=r.next(),p=n.createSplitEdge(a,u);t.add(p),a=u}};Ka.prototype.findCollapseIndex=function(t,n,r){if(!t.coord.equals2D(n.coord))return!1;var a=n.segmentIndex-t.segmentIndex;return n.isInterior()||a--,a===1?(r[0]=t.segmentIndex+1,!0):!1};Ka.prototype.findCollapsesFromInsertedNodes=function(t){for(var n=this,r=new Array(1).fill(null),a=this.iterator(),u=a.next();a.hasNext();){var p=a.next(),i=n.findCollapseIndex(u,p,r);i&&t.add(new nd(r[0])),u=p}};Ka.prototype.getEdge=function(){return this._edge};Ka.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Ka.prototype.createSplitEdge=function(t,n){var r=this,a=n.segmentIndex-t.segmentIndex+2,u=this._edge.getCoordinate(n.segmentIndex),p=n.isInterior()||!n.coord.equals2D(u);p||a--;var i=new Array(a).fill(null),b=0;i[b++]=new Ot(t.coord);for(var C=t.segmentIndex+1;C<=n.segmentIndex;C++)i[b++]=r._edge.getCoordinate(C);return p&&(i[b]=new Ot(n.coord)),new Wo(i,this._edge.getData())};Ka.prototype.add=function(t,n){var r=new rg(this._edge,t,n,this._edge.getSegmentOctant(n)),a=this._nodeMap.get(r);return a!==null?(qr.isTrue(a.coord.equals2D(t),"Found equal nodes with different coordinates"),a):(this._nodeMap.put(r,r),r)};Ka.prototype.checkSplitEdgesCorrectness=function(t){var n=this._edge.getCoordinates(),r=t.get(0),a=r.getCoordinate(0);if(!a.equals2D(n[0]))throw new Lp("bad split edge start point at "+a);var u=t.get(t.size()-1),p=u.getCoordinates(),i=p[p.length-1];if(!i.equals2D(n[n.length-1]))throw new Lp("bad split edge end point at "+i)};Ka.prototype.interfaces_=function(){return[]};Ka.prototype.getClass=function(){return Ka};var Wy=function(){};Wy.prototype.interfaces_=function(){return[]};Wy.prototype.getClass=function(){return Wy};Wy.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];if(t===0&&n===0)throw new po("Cannot compute the octant for point ( "+t+", "+n+" )");var r=Math.abs(t),a=Math.abs(n);return t>=0?n>=0?r>=a?0:1:r>=a?7:6:n>=0?r>=a?3:2:r>=a?4:5}else if(arguments[0]instanceof Ot&&arguments[1]instanceof Ot){var u=arguments[0],p=arguments[1],i=p.x-u.x,b=p.y-u.y;if(i===0&&b===0)throw new po("Cannot compute the octant for two identical points "+u);return Wy.octant(i,b)}};var hf=function(){};hf.prototype.getCoordinates=function(){};hf.prototype.size=function(){};hf.prototype.getCoordinate=function(t){};hf.prototype.isClosed=function(){};hf.prototype.setData=function(t){};hf.prototype.getData=function(){};hf.prototype.interfaces_=function(){return[]};hf.prototype.getClass=function(){return hf};var rb=function(){};rb.prototype.addIntersection=function(t,n){};rb.prototype.interfaces_=function(){return[hf]};rb.prototype.getClass=function(){return rb};var Wo=function(){this._nodeList=new Ka(this),this._pts=null,this._data=null;var t=arguments[0],n=arguments[1];this._pts=t,this._data=n};Wo.prototype.getCoordinates=function(){return this._pts};Wo.prototype.size=function(){return this._pts.length};Wo.prototype.getCoordinate=function(t){return this._pts[t]};Wo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Wo.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Wo.prototype.setData=function(t){this._data=t};Wo.prototype.safeOctant=function(t,n){return t.equals2D(n)?0:Wy.octant(t,n)};Wo.prototype.getData=function(){return this._data};Wo.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];this.addIntersectionNode(t,n)}else if(arguments.length===4){var r=arguments[0],a=arguments[1],u=arguments[3],p=new Ot(r.getIntersection(u));this.addIntersection(p,a)}};Wo.prototype.toString=function(){return Zc.toLineString(new $o(this._pts))};Wo.prototype.getNodeList=function(){return this._nodeList};Wo.prototype.addIntersectionNode=function(t,n){var r=n,a=r+1;if(a<this._pts.length){var u=this._pts[a];t.equals2D(u)&&(r=a)}var p=this._nodeList.add(t,r);return p};Wo.prototype.addIntersections=function(t,n,r){for(var a=this,u=0;u<t.getIntersectionNum();u++)a.addIntersection(t,n,r,u)};Wo.prototype.interfaces_=function(){return[rb]};Wo.prototype.getClass=function(){return Wo};Wo.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],n=new In;return Wo.getNodedSubstrings(t,n),n}else if(arguments.length===2)for(var r=arguments[0],a=arguments[1],u=r.iterator();u.hasNext();){var p=u.next();p.getNodeList().addSplitEdges(a)}};var rr=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Ot,this.p1=new Ot;else if(arguments.length===1){var t=arguments[0];this.p0=new Ot(t.p0),this.p1=new Ot(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[2],u=arguments[3];this.p0=new Ot(n,r),this.p1=new Ot(a,u)}},s5={serialVersionUID:{configurable:!0}};rr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};rr.prototype.orientationIndex=function(){if(arguments[0]instanceof rr){var t=arguments[0],n=On.orientationIndex(this.p0,this.p1,t.p0),r=On.orientationIndex(this.p0,this.p1,t.p1);return n>=0&&r>=0||n<=0&&r<=0?Math.max(n,r):0}else if(arguments[0]instanceof Ot){var a=arguments[0];return On.orientationIndex(this.p0,this.p1,a)}};rr.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};rr.prototype.isVertical=function(){return this.p0.x===this.p1.x};rr.prototype.equals=function(t){if(!(t instanceof rr))return!1;var n=t;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)};rr.prototype.intersection=function(t){var n=new G_;return n.computeIntersection(this.p0,this.p1,t.p0,t.p1),n.hasIntersection()?n.getIntersection(0):null};rr.prototype.project=function(){if(arguments[0]instanceof Ot){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Ot(t);var n=this.projectionFactor(t),r=new Ot;return r.x=this.p0.x+n*(this.p1.x-this.p0.x),r.y=this.p0.y+n*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof rr){var a=arguments[0],u=this.projectionFactor(a.p0),p=this.projectionFactor(a.p1);if(u>=1&&p>=1||u<=0&&p<=0)return null;var i=this.project(a.p0);u<0&&(i=this.p0),u>1&&(i=this.p1);var b=this.project(a.p1);return p<0&&(b=this.p0),p>1&&(b=this.p1),new rr(i,b)}};rr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};rr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};rr.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};rr.prototype.distancePerpendicular=function(t){return On.distancePointLinePerpendicular(t,this.p0,this.p1)};rr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};rr.prototype.midPoint=function(){return rr.midPoint(this.p0,this.p1)};rr.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var n=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,a=n*n+r*r;if(a<=0)return Dr.NaN;var u=((t.x-this.p0.x)*n+(t.y-this.p0.y)*r)/a;return u};rr.prototype.closestPoints=function(t){var n=this.intersection(t);if(n!==null)return[n,n];var r=new Array(2).fill(null),a=Dr.MAX_VALUE,u=null,p=this.closestPoint(t.p0);a=p.distance(t.p0),r[0]=p,r[1]=t.p0;var i=this.closestPoint(t.p1);u=i.distance(t.p1),u<a&&(a=u,r[0]=i,r[1]=t.p1);var b=t.closestPoint(this.p0);u=b.distance(this.p0),u<a&&(a=u,r[0]=this.p0,r[1]=b);var C=t.closestPoint(this.p1);return u=C.distance(this.p1),u<a&&(a=u,r[0]=this.p1,r[1]=C),r};rr.prototype.closestPoint=function(t){var n=this.projectionFactor(t);if(n>0&&n<1)return this.project(t);var r=this.p0.distance(t),a=this.p1.distance(t);return r<a?this.p0:this.p1};rr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};rr.prototype.getLength=function(){return this.p0.distance(this.p1)};rr.prototype.compareTo=function(t){var n=t,r=this.p0.compareTo(n.p0);return r!==0?r:this.p1.compareTo(n.p1)};rr.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};rr.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};rr.prototype.lineIntersection=function(t){try{var n=$c.intersection(this.p0,this.p1,t.p0,t.p1);return n}catch(r){if(!(r instanceof vx))throw r}finally{}return null};rr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};rr.prototype.pointAlongOffset=function(t,n){var r=this.p0.x+t*(this.p1.x-this.p0.x),a=this.p0.y+t*(this.p1.y-this.p0.y),u=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,i=Math.sqrt(u*u+p*p),b=0,C=0;if(n!==0){if(i<=0)throw new Error("Cannot compute offset from zero-length line segment");b=n*u/i,C=n*p/i}var A=r-C,R=a+b,z=new Ot(A,R);return z};rr.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.p0.x=n.x,this.p0.y=n.y,this.p1.x=r.x,this.p1.y=r.y}};rr.prototype.segmentFraction=function(t){var n=this.projectionFactor(t);return n<0?n=0:(n>1||Dr.isNaN(n))&&(n=1),n};rr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};rr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};rr.prototype.distance=function(){if(arguments[0]instanceof rr){var t=arguments[0];return On.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof Ot){var n=arguments[0];return On.distancePointLine(n,this.p0,this.p1)}};rr.prototype.pointAlong=function(t){var n=new Ot;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n};rr.prototype.hashCode=function(){var t=Dr.doubleToLongBits(this.p0.x);t^=Dr.doubleToLongBits(this.p0.y)*31;var n=Math.trunc(t)^Math.trunc(t>>32),r=Dr.doubleToLongBits(this.p1.x);r^=Dr.doubleToLongBits(this.p1.y)*31;var a=Math.trunc(r)^Math.trunc(r>>32);return n^a};rr.prototype.interfaces_=function(){return[gc,_c]};rr.prototype.getClass=function(){return rr};rr.midPoint=function(t,n){return new Ot((t.x+n.x)/2,(t.y+n.y)/2)};s5.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(rr,s5);var ib=function(){this.tempEnv1=new Qn,this.tempEnv2=new Qn,this._overlapSeg1=new rr,this._overlapSeg2=new rr};ib.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];t.getLineSegment(n,this._overlapSeg1),r.getLineSegment(a,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};ib.prototype.interfaces_=function(){return[]};ib.prototype.getClass=function(){return ib};var Wl=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];this._pts=t,this._start=n,this._end=r,this._context=a};Wl.prototype.getLineSegment=function(t,n){n.p0=this._pts[t],n.p1=this._pts[t+1]};Wl.prototype.computeSelect=function(t,n,r,a){var u=this._pts[n],p=this._pts[r];if(a.tempEnv1.init(u,p),r-n===1)return a.select(this,n),null;if(!t.intersects(a.tempEnv1))return null;var i=Math.trunc((n+r)/2);n<i&&this.computeSelect(t,n,i,a),i<r&&this.computeSelect(t,i,r,a)};Wl.prototype.getCoordinates=function(){for(var t=this,n=new Array(this._end-this._start+1).fill(null),r=0,a=this._start;a<=this._end;a++)n[r++]=t._pts[a];return n};Wl.prototype.computeOverlaps=function(t,n){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,n)};Wl.prototype.setId=function(t){this._id=t};Wl.prototype.select=function(t,n){this.computeSelect(t,this._start,this._end,n)};Wl.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],n=this._pts[this._end];this._env=new Qn(t,n)}return this._env};Wl.prototype.getEndIndex=function(){return this._end};Wl.prototype.getStartIndex=function(){return this._start};Wl.prototype.getContext=function(){return this._context};Wl.prototype.getId=function(){return this._id};Wl.prototype.computeOverlapsInternal=function(t,n,r,a,u,p){var i=this._pts[t],b=this._pts[n],C=r._pts[a],A=r._pts[u];if(n-t===1&&u-a===1)return p.overlap(this,t,r,a),null;if(p.tempEnv1.init(i,b),p.tempEnv2.init(C,A),!p.tempEnv1.intersects(p.tempEnv2))return null;var R=Math.trunc((t+n)/2),z=Math.trunc((a+u)/2);t<R&&(a<z&&this.computeOverlapsInternal(t,R,r,a,z,p),z<u&&this.computeOverlapsInternal(t,R,r,z,u,p)),R<n&&(a<z&&this.computeOverlapsInternal(R,n,r,a,z,p),z<u&&this.computeOverlapsInternal(R,n,r,z,u,p))};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};var Zh=function(){};Zh.prototype.interfaces_=function(){return[]};Zh.prototype.getClass=function(){return Zh};Zh.getChainStartIndices=function(t){var n=0,r=new In;r.add(new nd(n));do{var a=Zh.findChainEnd(t,n);r.add(new nd(a)),n=a}while(n<t.length-1);var u=Zh.toIntArray(r);return u};Zh.findChainEnd=function(t,n){for(var r=n;r<t.length-1&&t[r].equals2D(t[r+1]);)r++;if(r>=t.length-1)return t.length-1;for(var a=ji.quadrant(t[r],t[r+1]),u=n+1;u<t.length;){if(!t[u-1].equals2D(t[u])){var p=ji.quadrant(t[u-1],t[u]);if(p!==a)break}u++}return u-1};Zh.getChains=function(){if(arguments.length===1){var t=arguments[0];return Zh.getChains(t,null)}else if(arguments.length===2){for(var n=arguments[0],r=arguments[1],a=new In,u=Zh.getChainStartIndices(n),p=0;p<u.length-1;p++){var i=new Wl(n,u[p],u[p+1],r);a.add(i)}return a}};Zh.toIntArray=function(t){for(var n=new Array(t.size()).fill(null),r=0;r<n.length;r++)n[r]=t.get(r).intValue();return n};var P_=function(){};P_.prototype.computeNodes=function(t){};P_.prototype.getNodedSubstrings=function(){};P_.prototype.interfaces_=function(){return[]};P_.prototype.getClass=function(){return P_};var ob=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}}};ob.prototype.setSegmentIntersector=function(t){this._segInt=t};ob.prototype.interfaces_=function(){return[P_]};ob.prototype.getClass=function(){return ob};var iP=function(e){function t(r){r?e.call(this,r):e.call(this),this._monoChains=new In,this._index=new o5,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Wo.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(a){for(var u=this,p=Zh.getChains(a.getCoordinates(),a),i=p.iterator();i.hasNext();){var b=i.next();b.setId(u._idCounter++),u._index.insert(b.getEnvelope(),b),u._monoChains.add(b)}},t.prototype.computeNodes=function(a){var u=this;this._nodedSegStrings=a;for(var p=a.iterator();p.hasNext();)u.add(p.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var a=this,u=new rN(this._segInt),p=this._monoChains.iterator();p.hasNext();)for(var i=p.next(),b=a._index.query(i.getEnvelope()),C=b.iterator();C.hasNext();){var A=C.next();if(A.getId()>i.getId()&&(i.computeOverlaps(A,u),a._nOverlaps++),a._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return rN},Object.defineProperties(t,n),t}(ob),rN=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],a=arguments[1],u=arguments[2],p=arguments[3],i=r.getContext(),b=u.getContext();this._si.processIntersections(i,a,b,p)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ib),Si=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var a=arguments[0],u=arguments[1],p=arguments[2],i=arguments[3];this.setQuadrantSegments(a),this.setEndCapStyle(u),this.setJoinStyle(p),this.setMitreLimit(i)}}},Up={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Si.prototype.getEndCapStyle=function(){return this._endCapStyle};Si.prototype.isSingleSided=function(){return this._isSingleSided};Si.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=Si.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Si.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Si.JOIN_ROUND&&(this._quadrantSegments=Si.DEFAULT_QUADRANT_SEGMENTS)};Si.prototype.getJoinStyle=function(){return this._joinStyle};Si.prototype.setJoinStyle=function(t){this._joinStyle=t};Si.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};Si.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Si.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Si.prototype.setEndCapStyle=function(t){this._endCapStyle=t};Si.prototype.getMitreLimit=function(){return this._mitreLimit};Si.prototype.setMitreLimit=function(t){this._mitreLimit=t};Si.prototype.setSingleSided=function(t){this._isSingleSided=t};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};Si.bufferDistanceError=function(t){var n=Math.PI/2/t;return 1-Math.cos(n/2)};Up.CAP_ROUND.get=function(){return 1};Up.CAP_FLAT.get=function(){return 2};Up.CAP_SQUARE.get=function(){return 3};Up.JOIN_ROUND.get=function(){return 1};Up.JOIN_MITRE.get=function(){return 2};Up.JOIN_BEVEL.get=function(){return 3};Up.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Up.DEFAULT_MITRE_LIMIT.get=function(){return 5};Up.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Si,Up);var zo=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=On.COUNTERCLOCKWISE,this._inputLine=t||null},zb={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};zo.prototype.isDeletable=function(t,n,r,a){var u=this._inputLine[t],p=this._inputLine[n],i=this._inputLine[r];return!this.isConcave(u,p,i)||!this.isShallow(u,p,i,a)?!1:this.isShallowSampled(u,p,t,r,a)};zo.prototype.deleteShallowConcavities=function(){for(var t=this,n=1,r=this.findNextNonDeletedIndex(n),a=this.findNextNonDeletedIndex(r),u=!1;a<this._inputLine.length;){var p=!1;t.isDeletable(n,r,a,t._distanceTol)&&(t._isDeleted[r]=zo.DELETE,p=!0,u=!0),p?n=a:n=r,r=t.findNextNonDeletedIndex(n),a=t.findNextNonDeletedIndex(r)}return u};zo.prototype.isShallowConcavity=function(t,n,r,a){var u=On.computeOrientation(t,n,r),p=u===this._angleOrientation;if(!p)return!1;var i=On.distancePointLine(n,t,r);return i<a};zo.prototype.isShallowSampled=function(t,n,r,a,u){var p=this,i=Math.trunc((a-r)/zo.NUM_PTS_TO_CHECK);i<=0&&(i=1);for(var b=r;b<a;b+=i)if(!p.isShallow(t,n,p._inputLine[b],u))return!1;return!0};zo.prototype.isConcave=function(t,n,r){var a=On.computeOrientation(t,n,r),u=a===this._angleOrientation;return u};zo.prototype.simplify=function(t){var n=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=On.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=n.deleteShallowConcavities();while(r);return this.collapseLine()};zo.prototype.findNextNonDeletedIndex=function(t){for(var n=t+1;n<this._inputLine.length&&this._isDeleted[n]===zo.DELETE;)n++;return n};zo.prototype.isShallow=function(t,n,r,a){var u=On.distancePointLine(n,t,r);return u<a};zo.prototype.collapseLine=function(){for(var t=this,n=new Nb,r=0;r<this._inputLine.length;r++)t._isDeleted[r]!==zo.DELETE&&n.add(t._inputLine[r]);return n.toCoordinateArray()};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};zo.simplify=function(t,n){var r=new zo(t);return r.simplify(n)};zb.INIT.get=function(){return 0};zb.DELETE.get=function(){return 1};zb.KEEP.get=function(){return 1};zb.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(zo,zb);var Pu=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new In},a5={COORDINATE_ARRAY_TYPE:{configurable:!0}};Pu.prototype.getCoordinates=function(){var t=this._ptList.toArray(Pu.COORDINATE_ARRAY_TYPE);return t};Pu.prototype.setPrecisionModel=function(t){this._precisionModel=t};Pu.prototype.addPt=function(t){var n=new Ot(t);if(this._precisionModel.makePrecise(n),this.isRedundant(n))return null;this._ptList.add(n)};Pu.prototype.revere=function(){};Pu.prototype.addPts=function(t,n){var r=this;if(n)for(var a=0;a<t.length;a++)r.addPt(t[a]);else for(var u=t.length-1;u>=0;u--)r.addPt(t[u])};Pu.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var n=this._ptList.get(this._ptList.size()-1),r=t.distance(n);return r<this._minimimVertexDistance};Pu.prototype.toString=function(){var t=new ti,n=t.createLineString(this.getCoordinates());return n.toString()};Pu.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Ot(this._ptList.get(0)),n=this._ptList.get(this._ptList.size()-1);if(t.equals(n))return null;this._ptList.add(t)};Pu.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Pu.prototype.interfaces_=function(){return[]};Pu.prototype.getClass=function(){return Pu};a5.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Pu,a5);var si=function(){},fv={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};si.toDegrees=function(t){return t*180/Math.PI};si.normalize=function(t){for(;t>Math.PI;)t-=si.PI_TIMES_2;for(;t<=-Math.PI;)t+=si.PI_TIMES_2;return t};si.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=r.x-n.x,u=r.y-n.y;return Math.atan2(u,a)}};si.isAcute=function(t,n,r){var a=t.x-n.x,u=t.y-n.y,p=r.x-n.x,i=r.y-n.y,b=a*p+u*i;return b>0};si.isObtuse=function(t,n,r){var a=t.x-n.x,u=t.y-n.y,p=r.x-n.x,i=r.y-n.y,b=a*p+u*i;return b<0};si.interiorAngle=function(t,n,r){var a=si.angle(n,t),u=si.angle(n,r);return Math.abs(u-a)};si.normalizePositive=function(t){if(t<0){for(;t<0;)t+=si.PI_TIMES_2;t>=si.PI_TIMES_2&&(t=0)}else{for(;t>=si.PI_TIMES_2;)t-=si.PI_TIMES_2;t<0&&(t=0)}return t};si.angleBetween=function(t,n,r){var a=si.angle(n,t),u=si.angle(n,r);return si.diff(a,u)};si.diff=function(t,n){var r=null;return t<n?r=n-t:r=t-n,r>Math.PI&&(r=2*Math.PI-r),r};si.toRadians=function(t){return t*Math.PI/180};si.getTurn=function(t,n){var r=Math.sin(n-t);return r>0?si.COUNTERCLOCKWISE:r<0?si.CLOCKWISE:si.NONE};si.angleBetweenOriented=function(t,n,r){var a=si.angle(n,t),u=si.angle(n,r),p=u-a;return p<=-Math.PI?p+si.PI_TIMES_2:p>Math.PI?p-si.PI_TIMES_2:p};fv.PI_TIMES_2.get=function(){return 2*Math.PI};fv.PI_OVER_2.get=function(){return Math.PI/2};fv.PI_OVER_4.get=function(){return Math.PI/4};fv.COUNTERCLOCKWISE.get=function(){return On.COUNTERCLOCKWISE};fv.CLOCKWISE.get=function(){return On.CLOCKWISE};fv.NONE.get=function(){return On.COLLINEAR};Object.defineProperties(si,fv);var ho=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new rr,this._seg1=new rr,this._offset0=new rr,this._offset1=new rr,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new G_,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Si.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Bb={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};ho.prototype.addNextSegment=function(t,n){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=On.computeOrientation(this._s0,this._s1,this._s2),a=r===On.CLOCKWISE&&this._side===bn.LEFT||r===On.COUNTERCLOCKWISE&&this._side===bn.RIGHT;r===0?this.addCollinear(n):a?this.addOutsideTurn(r,n):this.addInsideTurn(r,n)};ho.prototype.addLineEndCap=function(t,n){var r=new rr(t,n),a=new rr;this.computeOffsetSegment(r,bn.LEFT,this._distance,a);var u=new rr;this.computeOffsetSegment(r,bn.RIGHT,this._distance,u);var p=n.x-t.x,i=n.y-t.y,b=Math.atan2(i,p);switch(this._bufParams.getEndCapStyle()){case Si.CAP_ROUND:this._segList.addPt(a.p1),this.addFilletArc(n,b+Math.PI/2,b-Math.PI/2,On.CLOCKWISE,this._distance),this._segList.addPt(u.p1);break;case Si.CAP_FLAT:this._segList.addPt(a.p1),this._segList.addPt(u.p1);break;case Si.CAP_SQUARE:var C=new Ot;C.x=Math.abs(this._distance)*Math.cos(b),C.y=Math.abs(this._distance)*Math.sin(b);var A=new Ot(a.p1.x+C.x,a.p1.y+C.y),R=new Ot(u.p1.x+C.x,u.p1.y+C.y);this._segList.addPt(A),this._segList.addPt(R);break}};ho.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};ho.prototype.addMitreJoin=function(t,n,r,a){var u=!0,p=null;try{p=$c.intersection(n.p0,n.p1,r.p0,r.p1);var i=a<=0?1:p.distance(t)/Math.abs(a);i>this._bufParams.getMitreLimit()&&(u=!1)}catch(b){if(b instanceof vx)p=new Ot(0,0),u=!1;else throw b}finally{}u?this._segList.addPt(p):this.addLimitedMitreJoin(n,r,a,this._bufParams.getMitreLimit())};ho.prototype.addFilletCorner=function(t,n,r,a,u){var p=n.x-t.x,i=n.y-t.y,b=Math.atan2(i,p),C=r.x-t.x,A=r.y-t.y,R=Math.atan2(A,C);a===On.CLOCKWISE?b<=R&&(b+=2*Math.PI):b>=R&&(b-=2*Math.PI),this._segList.addPt(n),this.addFilletArc(t,b,R,a,u),this._segList.addPt(r)};ho.prototype.addOutsideTurn=function(t,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*ho.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Si.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Si.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};ho.prototype.createSquare=function(t){this._segList.addPt(new Ot(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Ot(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Ot(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Ot(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};ho.prototype.addSegments=function(t,n){this._segList.addPts(t,n)};ho.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};ho.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};ho.prototype.initSideSegments=function(t,n,r){this._s1=t,this._s2=n,this._side=r,this._seg1.setCoordinates(t,n),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};ho.prototype.addLimitedMitreJoin=function(t,n,r,a){var u=this._seg0.p1,p=si.angle(u,this._seg0.p0),i=si.angleBetweenOriented(this._seg0.p0,u,this._seg1.p1),b=i/2,C=si.normalize(p+b),A=si.normalize(C+Math.PI),R=a*r,z=R*Math.abs(Math.sin(b)),V=r-z,W=u.x+R*Math.cos(A),X=u.y+R*Math.sin(A),ue=new Ot(W,X),ie=new rr(u,ue),K=ie.pointAlongOffset(1,V),ee=ie.pointAlongOffset(1,-V);this._side===bn.LEFT?(this._segList.addPt(K),this._segList.addPt(ee)):(this._segList.addPt(ee),this._segList.addPt(K))};ho.prototype.computeOffsetSegment=function(t,n,r,a){var u=n===bn.LEFT?1:-1,p=t.p1.x-t.p0.x,i=t.p1.y-t.p0.y,b=Math.sqrt(p*p+i*i),C=u*r*p/b,A=u*r*i/b;a.p0.x=t.p0.x-A,a.p0.y=t.p0.y+C,a.p1.x=t.p1.x-A,a.p1.y=t.p1.y+C};ho.prototype.addFilletArc=function(t,n,r,a,u){var p=this,i=a===On.CLOCKWISE?-1:1,b=Math.abs(n-r),C=Math.trunc(b/this._filletAngleQuantum+.5);if(C<1)return null;for(var A=0,R=b/C,z=A,V=new Ot;z<b;){var W=n+i*z;V.x=t.x+u*Math.cos(W),V.y=t.y+u*Math.sin(W),p._segList.addPt(V),z+=R}};ho.prototype.addInsideTurn=function(t,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*ho.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new Ot((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var a=new Ot((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(a)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};ho.prototype.createCircle=function(t){var n=new Ot(t.x+this._distance,t.y);this._segList.addPt(n),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};ho.prototype.addBevelJoin=function(t,n){this._segList.addPt(t.p1),this._segList.addPt(n.p0)};ho.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Pu,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*ho.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};ho.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var n=this._li.getIntersectionNum();n>=2&&(this._bufParams.getJoinStyle()===Si.JOIN_BEVEL||this._bufParams.getJoinStyle()===Si.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,On.CLOCKWISE,this._distance))};ho.prototype.closeRing=function(){this._segList.closeRing()};ho.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};ho.prototype.interfaces_=function(){return[]};ho.prototype.getClass=function(){return ho};Bb.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Bb.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Bb.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Bb.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(ho,Bb);var _l=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],n=arguments[1];this._precisionModel=t,this._bufParams=n};_l.prototype.getOffsetCurve=function(t,n){if(this._distance=n,n===0)return null;var r=n<0,a=Math.abs(n),u=this.getSegGen(a);t.length<=1?this.computePointCurve(t[0],u):this.computeOffsetCurve(t,r,u);var p=u.getCoordinates();return r&&ni.reverse(p),p};_l.prototype.computeSingleSidedBufferCurve=function(t,n,r){var a=this.simplifyTolerance(this._distance);if(n){r.addSegments(t,!0);var u=zo.simplify(t,-a),p=u.length-1;r.initSideSegments(u[p],u[p-1],bn.LEFT),r.addFirstSegment();for(var i=p-2;i>=0;i--)r.addNextSegment(u[i],!0)}else{r.addSegments(t,!1);var b=zo.simplify(t,a),C=b.length-1;r.initSideSegments(b[0],b[1],bn.LEFT),r.addFirstSegment();for(var A=2;A<=C;A++)r.addNextSegment(b[A],!0)}r.addLastSegment(),r.closeRing()};_l.prototype.computeRingBufferCurve=function(t,n,r){var a=this.simplifyTolerance(this._distance);n===bn.RIGHT&&(a=-a);var u=zo.simplify(t,a),p=u.length-1;r.initSideSegments(u[p-1],u[0],n);for(var i=1;i<=p;i++){var b=i!==1;r.addNextSegment(u[i],b)}r.closeRing()};_l.prototype.computeLineBufferCurve=function(t,n){var r=this.simplifyTolerance(this._distance),a=zo.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],bn.LEFT);for(var p=2;p<=u;p++)n.addNextSegment(a[p],!0);n.addLastSegment(),n.addLineEndCap(a[u-1],a[u]);var i=zo.simplify(t,-r),b=i.length-1;n.initSideSegments(i[b],i[b-1],bn.LEFT);for(var C=b-2;C>=0;C--)n.addNextSegment(i[C],!0);n.addLastSegment(),n.addLineEndCap(i[1],i[0]),n.closeRing()};_l.prototype.computePointCurve=function(t,n){switch(this._bufParams.getEndCapStyle()){case Si.CAP_ROUND:n.createCircle(t);break;case Si.CAP_SQUARE:n.createSquare(t);break}};_l.prototype.getLineCurve=function(t,n){if(this._distance=n,n<0&&!this._bufParams.isSingleSided()||n===0)return null;var r=Math.abs(n),a=this.getSegGen(r);if(t.length<=1)this.computePointCurve(t[0],a);else if(this._bufParams.isSingleSided()){var u=n<0;this.computeSingleSidedBufferCurve(t,u,a)}else this.computeLineBufferCurve(t,a);var p=a.getCoordinates();return p};_l.prototype.getBufferParameters=function(){return this._bufParams};_l.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};_l.prototype.getRingCurve=function(t,n,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(r===0)return _l.copyCoordinates(t);var a=this.getSegGen(r);return this.computeRingBufferCurve(t,n,a),a.getCoordinates()};_l.prototype.computeOffsetCurve=function(t,n,r){var a=this.simplifyTolerance(this._distance);if(n){var u=zo.simplify(t,-a),p=u.length-1;r.initSideSegments(u[p],u[p-1],bn.LEFT),r.addFirstSegment();for(var i=p-2;i>=0;i--)r.addNextSegment(u[i],!0)}else{var b=zo.simplify(t,a),C=b.length-1;r.initSideSegments(b[0],b[1],bn.LEFT),r.addFirstSegment();for(var A=2;A<=C;A++)r.addNextSegment(b[A],!0)}r.addLastSegment()};_l.prototype.getSegGen=function(t){return new ho(this._precisionModel,this._bufParams,t)};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};_l.copyCoordinates=function(t){for(var n=new Array(t.length).fill(null),r=0;r<n.length;r++)n[r]=new Ot(t[r]);return n};var Xy=function(){this._subgraphs=null,this._seg=new rr,this._cga=new On;var t=arguments[0];this._subgraphs=t},l5={DepthSegment:{configurable:!0}};Xy.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var n=arguments[0],r=new In,a=this._subgraphs.iterator();a.hasNext();){var u=a.next(),p=u.getEnvelope();n.y<p.getMinY()||n.y>p.getMaxY()||t.findStabbedSegments(n,u.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(xr(arguments[2],qc)&&arguments[0]instanceof Ot&&arguments[1]instanceof p2)for(var i=arguments[0],b=arguments[1],C=arguments[2],A=b.getEdge().getCoordinates(),R=0;R<A.length-1;R++){t._seg.p0=A[R],t._seg.p1=A[R+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var z=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(z<i.x)&&!t._seg.isHorizontal()&&!(i.y<t._seg.p0.y||i.y>t._seg.p1.y)&&On.computeOrientation(t._seg.p0,t._seg.p1,i)!==On.RIGHT){var V=b.getDepth(bn.LEFT);t._seg.p0.equals(A[R])||(V=b.getDepth(bn.RIGHT));var W=new A_(t._seg,V);C.add(W)}}else if(xr(arguments[2],qc)&&arguments[0]instanceof Ot&&xr(arguments[1],qc))for(var X=arguments[0],ue=arguments[1],ie=arguments[2],K=ue.iterator();K.hasNext();){var ee=K.next();ee.isForward()&&t.findStabbedSegments(X,ee,ie)}}};Xy.prototype.getDepth=function(t){var n=this.findStabbedSegments(t);if(n.size()===0)return 0;var r=Jc.min(n);return r._leftDepth};Xy.prototype.interfaces_=function(){return[]};Xy.prototype.getClass=function(){return Xy};l5.DepthSegment.get=function(){return A_};Object.defineProperties(Xy,l5);var A_=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],n=arguments[1];this._upwardSeg=new rr(t),this._leftDepth=n};A_.prototype.compareTo=function(t){var n=t;if(this._upwardSeg.minX()>=n._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=n._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(n._upwardSeg);return r!==0||(r=-1*n._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(n._upwardSeg)};A_.prototype.compareX=function(t,n){var r=t.p0.compareTo(n.p0);return r!==0?r:t.p1.compareTo(n.p1)};A_.prototype.toString=function(){return this._upwardSeg.toString()};A_.prototype.interfaces_=function(){return[gc]};A_.prototype.getClass=function(){return A_};var Ci=function(t,n,r){this.p0=t||null,this.p1=n||null,this.p2=r||null};Ci.prototype.area=function(){return Ci.area(this.p0,this.p1,this.p2)};Ci.prototype.signedArea=function(){return Ci.signedArea(this.p0,this.p1,this.p2)};Ci.prototype.interpolateZ=function(t){if(t===null)throw new po("Supplied point is null.");return Ci.interpolateZ(t,this.p0,this.p1,this.p2)};Ci.prototype.longestSideLength=function(){return Ci.longestSideLength(this.p0,this.p1,this.p2)};Ci.prototype.isAcute=function(){return Ci.isAcute(this.p0,this.p1,this.p2)};Ci.prototype.circumcentre=function(){return Ci.circumcentre(this.p0,this.p1,this.p2)};Ci.prototype.area3D=function(){return Ci.area3D(this.p0,this.p1,this.p2)};Ci.prototype.centroid=function(){return Ci.centroid(this.p0,this.p1,this.p2)};Ci.prototype.inCentre=function(){return Ci.inCentre(this.p0,this.p1,this.p2)};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};Ci.area=function(t,n,r){return Math.abs(((r.x-t.x)*(n.y-t.y)-(n.x-t.x)*(r.y-t.y))/2)};Ci.signedArea=function(t,n,r){return((r.x-t.x)*(n.y-t.y)-(n.x-t.x)*(r.y-t.y))/2};Ci.det=function(t,n,r,a){return t*a-n*r};Ci.interpolateZ=function(t,n,r,a){var u=n.x,p=n.y,i=r.x-u,b=a.x-u,C=r.y-p,A=a.y-p,R=i*A-b*C,z=t.x-u,V=t.y-p,W=(A*z-b*V)/R,X=(-C*z+i*V)/R,ue=n.z+W*(r.z-n.z)+X*(a.z-n.z);return ue};Ci.longestSideLength=function(t,n,r){var a=t.distance(n),u=n.distance(r),p=r.distance(t),i=a;return u>i&&(i=u),p>i&&(i=p),i};Ci.isAcute=function(t,n,r){return!(!si.isAcute(t,n,r)||!si.isAcute(n,r,t)||!si.isAcute(r,t,n))};Ci.circumcentre=function(t,n,r){var a=r.x,u=r.y,p=t.x-a,i=t.y-u,b=n.x-a,C=n.y-u,A=2*Ci.det(p,i,b,C),R=Ci.det(i,p*p+i*i,C,b*b+C*C),z=Ci.det(p,p*p+i*i,b,b*b+C*C),V=a-R/A,W=u+z/A;return new Ot(V,W)};Ci.perpendicularBisector=function(t,n){var r=n.x-t.x,a=n.y-t.y,u=new $c(t.x+r/2,t.y+a/2,1),p=new $c(t.x-a+r/2,t.y+r+a/2,1);return new $c(u,p)};Ci.angleBisector=function(t,n,r){var a=n.distance(t),u=n.distance(r),p=a/(a+u),i=r.x-t.x,b=r.y-t.y,C=new Ot(t.x+p*i,t.y+p*b);return C};Ci.area3D=function(t,n,r){var a=n.x-t.x,u=n.y-t.y,p=n.z-t.z,i=r.x-t.x,b=r.y-t.y,C=r.z-t.z,A=u*C-p*b,R=p*i-a*C,z=a*b-u*i,V=A*A+R*R+z*z,W=Math.sqrt(V)/2;return W};Ci.centroid=function(t,n,r){var a=(t.x+n.x+r.x)/3,u=(t.y+n.y+r.y)/3;return new Ot(a,u)};Ci.inCentre=function(t,n,r){var a=n.distance(r),u=t.distance(r),p=t.distance(n),i=a+u+p,b=(a*t.x+u*n.x+p*r.x)/i,C=(a*t.y+u*n.y+p*r.y)/i;return new Ot(b,C)};var fc=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new In;var t=arguments[0],n=arguments[1],r=arguments[2];this._inputGeom=t,this._distance=n,this._curveBuilder=r};fc.prototype.addPoint=function(t){if(this._distance<=0)return null;var n=t.getCoordinates(),r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,zt.EXTERIOR,zt.INTERIOR)};fc.prototype.addPolygon=function(t){var n=this,r=this._distance,a=bn.LEFT;this._distance<0&&(r=-this._distance,a=bn.RIGHT);var u=t.getExteriorRing(),p=ni.removeRepeatedPoints(u.getCoordinates());if(this._distance<0&&this.isErodedCompletely(u,this._distance)||this._distance<=0&&p.length<3)return null;this.addPolygonRing(p,r,a,zt.EXTERIOR,zt.INTERIOR);for(var i=0;i<t.getNumInteriorRing();i++){var b=t.getInteriorRingN(i),C=ni.removeRepeatedPoints(b.getCoordinates());n._distance>0&&n.isErodedCompletely(b,-n._distance)||n.addPolygonRing(C,r,bn.opposite(a),zt.INTERIOR,zt.EXTERIOR)}};fc.prototype.isTriangleErodedCompletely=function(t,n){var r=new Ci(t[0],t[1],t[2]),a=r.inCentre(),u=On.distancePointLine(a,r.p0,r.p1);return u<Math.abs(n)};fc.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var n=ni.removeRepeatedPoints(t.getCoordinates()),r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,zt.EXTERIOR,zt.INTERIOR)};fc.prototype.addCurve=function(t,n,r){if(t===null||t.length<2)return null;var a=new Wo(t,new Ni(0,zt.BOUNDARY,n,r));this._curveList.add(a)};fc.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};fc.prototype.addPolygonRing=function(t,n,r,a,u){if(n===0&&t.length<uf.MINIMUM_VALID_SIZE)return null;var p=a,i=u;t.length>=uf.MINIMUM_VALID_SIZE&&On.isCCW(t)&&(p=u,i=a,r=bn.opposite(r));var b=this._curveBuilder.getRingCurve(t,r,n);this.addCurve(b,p,i)};fc.prototype.add=function(t){if(t.isEmpty())return null;t instanceof gs?this.addPolygon(t):t instanceof Fo?this.addLineString(t):t instanceof ql?this.addPoint(t):t instanceof F0?this.addCollection(t):t instanceof M_?this.addCollection(t):t instanceof Qd?this.addCollection(t):t instanceof Za&&this.addCollection(t)};fc.prototype.isErodedCompletely=function(t,n){var r=t.getCoordinates();if(r.length<4)return n<0;if(r.length===4)return this.isTriangleErodedCompletely(r,n);var a=t.getEnvelopeInternal(),u=Math.min(a.getHeight(),a.getWidth());return n<0&&2*Math.abs(n)>u};fc.prototype.addCollection=function(t){for(var n=this,r=0;r<t.getNumGeometries();r++){var a=t.getGeometryN(r);n.add(a)}};fc.prototype.interfaces_=function(){return[]};fc.prototype.getClass=function(){return fc};var V0=function(){};V0.prototype.locate=function(t){};V0.prototype.interfaces_=function(){return[]};V0.prototype.getClass=function(){return V0};var ef=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};ef.prototype.next=function(){if(this._atStart)return this._atStart=!1,ef.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new bx;var t=this._parent.getGeometryN(this._index++);return t instanceof Za?(this._subcollectionIterator=new ef(t),this._subcollectionIterator.next()):t};ef.prototype.remove=function(){throw new Error(this.getClass().getName())};ef.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ef.prototype.interfaces_=function(){return[xx]};ef.prototype.getClass=function(){return ef};ef.isAtomic=function(t){return!(t instanceof Za)};var Eu=function(){this._geom=null;var t=arguments[0];this._geom=t};Eu.prototype.locate=function(t){return Eu.locate(t,this._geom)};Eu.prototype.interfaces_=function(){return[V0]};Eu.prototype.getClass=function(){return Eu};Eu.isPointInRing=function(t,n){return n.getEnvelopeInternal().intersects(t)?On.isPointInRing(t,n.getCoordinates()):!1};Eu.containsPointInPolygon=function(t,n){if(n.isEmpty())return!1;var r=n.getExteriorRing();if(!Eu.isPointInRing(t,r))return!1;for(var a=0;a<n.getNumInteriorRing();a++){var u=n.getInteriorRingN(a);if(Eu.isPointInRing(t,u))return!1}return!0};Eu.containsPoint=function(t,n){if(n instanceof gs)return Eu.containsPointInPolygon(t,n);if(n instanceof Za)for(var r=new ef(n);r.hasNext();){var a=r.next();if(a!==n&&Eu.containsPoint(t,a))return!0}return!1};Eu.locate=function(t,n){return n.isEmpty()?zt.EXTERIOR:Eu.containsPoint(t,n)?zt.INTERIOR:zt.EXTERIOR};var Ta=function(){this._edgeMap=new Ea,this._edgeList=null,this._ptInAreaLocation=[zt.NONE,zt.NONE]};Ta.prototype.getNextCW=function(t){this.getEdges();var n=this._edgeList.indexOf(t),r=n-1;return n===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};Ta.prototype.propagateSideLabels=function(t){for(var n=zt.NONE,r=this.iterator();r.hasNext();){var a=r.next(),u=a.getLabel();u.isArea(t)&&u.getLocation(t,bn.LEFT)!==zt.NONE&&(n=u.getLocation(t,bn.LEFT))}if(n===zt.NONE)return null;for(var p=n,i=this.iterator();i.hasNext();){var b=i.next(),C=b.getLabel();if(C.getLocation(t,bn.ON)===zt.NONE&&C.setLocation(t,bn.ON,p),C.isArea(t)){var A=C.getLocation(t,bn.LEFT),R=C.getLocation(t,bn.RIGHT);if(R!==zt.NONE){if(R!==p)throw new Dp("side location conflict",b.getCoordinate());A===zt.NONE&&qr.shouldNeverReachHere("found single null side (at "+b.getCoordinate()+")"),p=A}else qr.isTrue(C.getLocation(t,bn.LEFT)===zt.NONE,"found single null side"),C.setLocation(t,bn.RIGHT,p),C.setLocation(t,bn.LEFT,p)}}};Ta.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var n=t.next();return n.getCoordinate()};Ta.prototype.print=function(t){ta.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(t)}};Ta.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Ta.prototype.checkAreaLabelsConsistent=function(t){var n=this.getEdges();if(n.size()<=0)return!0;var r=n.size()-1,a=n.get(r).getLabel(),u=a.getLocation(t,bn.LEFT);qr.isTrue(u!==zt.NONE,"Found unlabelled area edge");for(var p=u,i=this.iterator();i.hasNext();){var b=i.next(),C=b.getLabel();qr.isTrue(C.isArea(t),"Found non-area edge");var A=C.getLocation(t,bn.LEFT),R=C.getLocation(t,bn.RIGHT);if(A===R||R!==p)return!1;p=A}return!0};Ta.prototype.findIndex=function(t){var n=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var a=n._edgeList.get(r);if(a===t)return r}return-1};Ta.prototype.iterator=function(){return this.getEdges().iterator()};Ta.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new In(this._edgeMap.values())),this._edgeList};Ta.prototype.getLocation=function(t,n,r){return this._ptInAreaLocation[t]===zt.NONE&&(this._ptInAreaLocation[t]=Eu.locate(n,r[t].getGeometry())),this._ptInAreaLocation[t]};Ta.prototype.toString=function(){var t=new pd;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var n=this.iterator();n.hasNext();){var r=n.next();t.append(r),t.append(`
`)}return t.toString()};Ta.prototype.computeEdgeEndLabels=function(t){for(var n=this.iterator();n.hasNext();){var r=n.next();r.computeLabel(t)}};Ta.prototype.computeLabelling=function(t){var n=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],a=this.iterator();a.hasNext();)for(var u=a.next(),p=u.getLabel(),i=0;i<2;i++)p.isLine(i)&&p.getLocation(i)===zt.BOUNDARY&&(r[i]=!0);for(var b=this.iterator();b.hasNext();)for(var C=b.next(),A=C.getLabel(),R=0;R<2;R++)if(A.isAnyNull(R)){var z=zt.NONE;if(r[R])z=zt.EXTERIOR;else{var V=C.getCoordinate();z=n.getLocation(R,V,t)}A.setAllLocationsIfNull(R,z)}};Ta.prototype.getDegree=function(){return this._edgeMap.size()};Ta.prototype.insertEdgeEnd=function(t,n){this._edgeMap.put(t,n),this._edgeList=null};Ta.prototype.interfaces_=function(){return[]};Ta.prototype.getClass=function(){return Ta};var kQ=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var a=null,u=null,p=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var b=r._resultAreaEdgeList.get(i),C=b.getSym();if(b.getLabel().isArea())switch(a===null&&b.isInResult()&&(a=b),p){case r._SCANNING_FOR_INCOMING:if(!C.isInResult())continue;u=C,p=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!b.isInResult())continue;u.setNext(b),p=r._SCANNING_FOR_INCOMING;break}}if(p===this._LINKING_TO_OUTGOING){if(a===null)throw new Dp("no outgoing dirEdge found",this.getCoordinate());qr.isTrue(a.isInResult(),"unable to link last incoming dirEdge"),u.setNext(a)}},t.prototype.insert=function(r){var a=r;this.insertEdgeEnd(a,a)},t.prototype.getRightmostEdge=function(){var r=this.getEdges(),a=r.size();if(a<1)return null;var u=r.get(0);if(a===1)return u;var p=r.get(a-1),i=u.getQuadrant(),b=p.getQuadrant();return ji.isNorthern(i)&&ji.isNorthern(b)?u:!ji.isNorthern(i)&&!ji.isNorthern(b)?p:u.getDy()!==0?u:p.getDy()!==0?p:(qr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(r){ta.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var a=this.iterator();a.hasNext();){var u=a.next();r.print("out "),u.print(r),r.println(),r.print("in "),u.getSym().print(r),r.println()}},t.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new In;for(var a=this.iterator();a.hasNext();){var u=a.next();(u.isInResult()||u.getSym().isInResult())&&r._resultAreaEdgeList.add(u)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(r){for(var a=this.iterator();a.hasNext();){var u=a.next(),p=u.getLabel();p.setAllLocationsIfNull(0,r.getLocation(0)),p.setAllLocationsIfNull(1,r.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var a=null,u=null,p=this._edgeList.size()-1;p>=0;p--){var i=r._edgeList.get(p),b=i.getSym();u===null&&(u=b),a!==null&&b.setNext(a),a=i}u.setNext(a)},t.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var a=arguments[0],u=this.findIndex(a),p=a.getDepth(bn.LEFT),i=a.getDepth(bn.RIGHT),b=this.computeDepths(u+1,this._edgeList.size(),p),C=this.computeDepths(0,u,b);if(C!==i)throw new Dp("depth mismatch at "+a.getCoordinate())}else if(arguments.length===3){for(var A=arguments[0],R=arguments[1],z=arguments[2],V=z,W=A;W<R;W++){var X=r._edgeList.get(W);X.setEdgeDepths(bn.RIGHT,V),V=X.getDepth(bn.LEFT)}return V}},t.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var a=r.next(),u=a.getLabel();u.merge(a.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(r){for(var a=this,u=null,p=null,i=this._SCANNING_FOR_INCOMING,b=this._resultAreaEdgeList.size()-1;b>=0;b--){var C=a._resultAreaEdgeList.get(b),A=C.getSym();switch(u===null&&C.getEdgeRing()===r&&(u=C),i){case a._SCANNING_FOR_INCOMING:if(A.getEdgeRing()!==r)continue;p=A,i=a._LINKING_TO_OUTGOING;break;case a._LINKING_TO_OUTGOING:if(C.getEdgeRing()!==r)continue;p.setNextMin(C),i=a._SCANNING_FOR_INCOMING;break}}i===this._LINKING_TO_OUTGOING&&(qr.isTrue(u!==null,"found null for first outgoing dirEdge"),qr.isTrue(u.getEdgeRing()===r,"unable to link last incoming dirEdge"),p.setNextMin(u))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,a=this.iterator();a.hasNext();){var u=a.next();u.isInResult()&&r++}return r}else if(arguments.length===1){for(var p=arguments[0],i=0,b=this.iterator();b.hasNext();){var C=b.next();C.getEdgeRing()===p&&i++}return i}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var r=zt.NONE,a=this.iterator();a.hasNext();){var u=a.next(),p=u.getSym();if(!u.isLineEdge()){if(u.isInResult()){r=zt.INTERIOR;break}if(p.isInResult()){r=zt.EXTERIOR;break}}}if(r===zt.NONE)return null;for(var i=r,b=this.iterator();b.hasNext();){var C=b.next(),A=C.getSym();C.isLineEdge()?C.getEdge().setCovered(i===zt.INTERIOR):(C.isInResult()&&(i=zt.EXTERIOR),A.isInResult()&&(i=zt.INTERIOR))}},t.prototype.computeLabelling=function(r){var a=this;e.prototype.computeLabelling.call(this,r),this._label=new Ni(zt.NONE);for(var u=this.iterator();u.hasNext();)for(var p=u.next(),i=p.getEdge(),b=i.getLabel(),C=0;C<2;C++){var A=b.getLocation(C);(A===zt.INTERIOR||A===zt.BOUNDARY)&&a._label.setLocation(C,zt.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ta),u5=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(r){return new nC(r,new kQ)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(z0),ig=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};ig.prototype.compareTo=function(t){var n=t,r=ig.compareOriented(this._pts,this._orientation,n._pts,n._orientation);return r};ig.prototype.interfaces_=function(){return[gc]};ig.prototype.getClass=function(){return ig};ig.orientation=function(t){return ni.increasingDirection(t)===1};ig.compareOriented=function(t,n,r,a){for(var u=n?1:-1,p=a?1:-1,i=n?t.length:-1,b=a?r.length:-1,C=n?0:t.length-1,A=a?0:r.length-1;;){var R=t[C].compareTo(r[A]);if(R!==0)return R;C+=u,A+=p;var z=C===i,V=A===b;if(z&&!V)return-1;if(!z&&V)return 1;if(z&&V)return 0}};var Qc=function(){this._edges=new In,this._ocaMap=new Ea};Qc.prototype.print=function(t){var n=this;t.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var a=n._edges.get(r);r>0&&t.print(","),t.print("(");for(var u=a.getCoordinates(),p=0;p<u.length;p++)p>0&&t.print(","),t.print(u[p].x+" "+u[p].y);t.println(")")}t.print(")  ")};Qc.prototype.addAll=function(t){for(var n=this,r=t.iterator();r.hasNext();)n.add(r.next())};Qc.prototype.findEdgeIndex=function(t){for(var n=this,r=0;r<this._edges.size();r++)if(n._edges.get(r).equals(t))return r;return-1};Qc.prototype.iterator=function(){return this._edges.iterator()};Qc.prototype.getEdges=function(){return this._edges};Qc.prototype.get=function(t){return this._edges.get(t)};Qc.prototype.findEqualEdge=function(t){var n=new ig(t.getCoordinates()),r=this._ocaMap.get(n);return r};Qc.prototype.add=function(t){this._edges.add(t);var n=new ig(t.getCoordinates());this._ocaMap.put(n,t)};Qc.prototype.interfaces_=function(){return[]};Qc.prototype.getClass=function(){return Qc};var R_=function(){};R_.prototype.processIntersections=function(t,n,r,a){};R_.prototype.isDone=function(){};R_.prototype.interfaces_=function(){return[]};R_.prototype.getClass=function(){return R_};var Au=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Au.prototype.isTrivialIntersection=function(t,n,r,a){if(t===r&&this._li.getIntersectionNum()===1){if(Au.isAdjacentSegments(n,a))return!0;if(t.isClosed()){var u=t.size()-1;if(n===0&&a===u||a===0&&n===u)return!0}}return!1};Au.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Au.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Au.prototype.getLineIntersector=function(){return this._li};Au.prototype.hasProperIntersection=function(){return this._hasProper};Au.prototype.processIntersections=function(t,n,r,a){if(t===r&&n===a)return null;this.numTests++;var u=t.getCoordinates()[n],p=t.getCoordinates()[n+1],i=r.getCoordinates()[a],b=r.getCoordinates()[a+1];this._li.computeIntersection(u,p,i,b),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,n,r,a)||(this._hasIntersection=!0,t.addIntersections(this._li,n,0),r.addIntersections(this._li,a,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Au.prototype.hasIntersection=function(){return this._hasIntersection};Au.prototype.isDone=function(){return!1};Au.prototype.hasInteriorIntersection=function(){return this._hasInterior};Au.prototype.interfaces_=function(){return[R_]};Au.prototype.getClass=function(){return Au};Au.isAdjacentSegments=function(t,n){return Math.abs(t-n)===1};var ld=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],n=arguments[1],r=arguments[2];this.coord=new Ot(t),this.segmentIndex=n,this.dist=r};ld.prototype.getSegmentIndex=function(){return this.segmentIndex};ld.prototype.getCoordinate=function(){return this.coord};ld.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};ld.prototype.compareTo=function(t){var n=t;return this.compare(n.segmentIndex,n.dist)};ld.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};ld.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};ld.prototype.getDistance=function(){return this.dist};ld.prototype.compare=function(t,n){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<n?-1:this.dist>n?1:0};ld.prototype.interfaces_=function(){return[gc]};ld.prototype.getClass=function(){return ld};var df=function(){this._nodeMap=new Ea,this.edge=null;var t=arguments[0];this.edge=t};df.prototype.print=function(t){t.println("Intersections:");for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(t)}};df.prototype.iterator=function(){return this._nodeMap.values().iterator()};df.prototype.addSplitEdges=function(t){var n=this;this.addEndpoints();for(var r=this.iterator(),a=r.next();r.hasNext();){var u=r.next(),p=n.createSplitEdge(a,u);t.add(p),a=u}};df.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};df.prototype.createSplitEdge=function(t,n){var r=this,a=n.segmentIndex-t.segmentIndex+2,u=this.edge.pts[n.segmentIndex],p=n.dist>0||!n.coord.equals2D(u);p||a--;var i=new Array(a).fill(null),b=0;i[b++]=new Ot(t.coord);for(var C=t.segmentIndex+1;C<=n.segmentIndex;C++)i[b++]=r.edge.pts[C];return p&&(i[b]=n.coord),new QS(i,new Ni(this.edge._label))};df.prototype.add=function(t,n,r){var a=new ld(t,n,r),u=this._nodeMap.get(a);return u!==null?u:(this._nodeMap.put(a,a),a)};df.prototype.isIntersection=function(t){for(var n=this.iterator();n.hasNext();){var r=n.next();if(r.coord.equals(t))return!0}return!1};df.prototype.interfaces_=function(){return[]};df.prototype.getClass=function(){return df};var L_=function(){};L_.prototype.getChainStartIndices=function(t){var n=this,r=0,a=new In;a.add(new nd(r));do{var u=n.findChainEnd(t,r);a.add(new nd(u)),r=u}while(r<t.length-1);var p=L_.toIntArray(a);return p};L_.prototype.findChainEnd=function(t,n){for(var r=ji.quadrant(t[n],t[n+1]),a=n+1;a<t.length;){var u=ji.quadrant(t[a-1],t[a]);if(u!==r)break;a++}return a-1};L_.prototype.interfaces_=function(){return[]};L_.prototype.getClass=function(){return L_};L_.toIntArray=function(t){for(var n=new Array(t.size()).fill(null),r=0;r<n.length;r++)n[r]=t.get(r).intValue();return n};var kp=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Qn,this.env2=new Qn;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var n=new L_;this.startIndex=n.getChainStartIndices(this.pts)};kp.prototype.getCoordinates=function(){return this.pts};kp.prototype.getMaxX=function(t){var n=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return n>r?n:r};kp.prototype.getMinX=function(t){var n=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return n<r?n:r};kp.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],n,n.startIndex[r],n.startIndex[r+1],a)}else if(arguments.length===6){var u=arguments[0],p=arguments[1],i=arguments[2],b=arguments[3],C=arguments[4],A=arguments[5],R=this.pts[u],z=this.pts[p],V=i.pts[b],W=i.pts[C];if(p-u===1&&C-b===1)return A.addIntersections(this.e,u,i.e,b),null;if(this.env1.init(R,z),this.env2.init(V,W),!this.env1.intersects(this.env2))return null;var X=Math.trunc((u+p)/2),ue=Math.trunc((b+C)/2);u<X&&(b<ue&&this.computeIntersectsForChain(u,X,i,b,ue,A),ue<C&&this.computeIntersectsForChain(u,X,i,ue,C,A)),X<p&&(b<ue&&this.computeIntersectsForChain(X,p,i,b,ue,A),ue<C&&this.computeIntersectsForChain(X,p,i,ue,C,A))}};kp.prototype.getStartIndexes=function(){return this.startIndex};kp.prototype.computeIntersects=function(t,n){for(var r=this,a=0;a<this.startIndex.length-1;a++)for(var u=0;u<t.startIndex.length-1;u++)r.computeIntersectsForChain(a,t,u,n)};kp.prototype.interfaces_=function(){return[]};kp.prototype.getClass=function(){return kp};var ea=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)t._depth[n][r]=e.NULL_VALUE},c5={NULL_VALUE:{configurable:!0}};ea.prototype.getDepth=function(t,n){return this._depth[t][n]};ea.prototype.setDepth=function(t,n,r){this._depth[t][n]=r};ea.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var n=0;n<2;n++)for(var r=0;r<3;r++)if(t._depth[n][r]!==ea.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var a=arguments[0];return this._depth[a][1]===ea.NULL_VALUE}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return this._depth[u][p]===ea.NULL_VALUE}};ea.prototype.normalize=function(){for(var t=this,n=0;n<2;n++)if(!t.isNull(n)){var r=t._depth[n][1];t._depth[n][2]<r&&(r=t._depth[n][2]),r<0&&(r=0);for(var a=1;a<3;a++){var u=0;t._depth[n][a]>r&&(u=1),t._depth[n][a]=u}}};ea.prototype.getDelta=function(t){return this._depth[t][bn.RIGHT]-this._depth[t][bn.LEFT]};ea.prototype.getLocation=function(t,n){return this._depth[t][n]<=0?zt.EXTERIOR:zt.INTERIOR};ea.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};ea.prototype.add=function(){var t=this;if(arguments.length===1)for(var n=arguments[0],r=0;r<2;r++)for(var a=1;a<3;a++){var u=n.getLocation(r,a);(u===zt.EXTERIOR||u===zt.INTERIOR)&&(t.isNull(r,a)?t._depth[r][a]=ea.depthAtLocation(u):t._depth[r][a]+=ea.depthAtLocation(u))}else if(arguments.length===3){var p=arguments[0],i=arguments[1],b=arguments[2];b===zt.INTERIOR&&this._depth[p][i]++}};ea.prototype.interfaces_=function(){return[]};ea.prototype.getClass=function(){return ea};ea.depthAtLocation=function(t){return t===zt.EXTERIOR?0:t===zt.INTERIOR?1:ea.NULL_VALUE};c5.NULL_VALUE.get=function(){return-1};Object.defineProperties(ea,c5);var QS=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new df(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ea,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.pts=r,this._label=a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var a=new t(r,Ni.toLineLabel(this._label));return a},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(r){this._isIsolated=r},t.prototype.setName=function(r){this._name=r},t.prototype.equals=function(r){var a=this;if(!(r instanceof t))return!1;var u=r;if(this.pts.length!==u.pts.length)return!1;for(var p=!0,i=!0,b=this.pts.length,C=0;C<this.pts.length;C++)if(a.pts[C].equals2D(u.pts[C])||(p=!1),a.pts[C].equals2D(u.pts[--b])||(i=!1),!p&&!i)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},t.prototype.print=function(r){var a=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var u=0;u<this.pts.length;u++)u>0&&r.print(","),r.print(a.pts[u].x+" "+a.pts[u].y);r.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(r){t.updateIM(this._label,r)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(r){var a=this;r.print("edge "+this._name+": ");for(var u=this.pts.length-1;u>=0;u--)r.print(a.pts[u]+" ");r.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new kp(this)),this._mce},t.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new Qn;for(var a=0;a<this.pts.length;a++)r._env.expandToInclude(r.pts[a])}return this._env},t.prototype.addIntersection=function(r,a,u,p){var i=new Ot(r.getIntersection(p)),b=a,C=r.getEdgeDistance(u,p),A=b+1;if(A<this.pts.length){var R=this.pts[A];i.equals2D(R)&&(b=A,C=0)}this.eiList.add(i,b,C)},t.prototype.toString=function(){var r=this,a=new pd;a.append("edge "+this._name+": "),a.append("LINESTRING (");for(var u=0;u<this.pts.length;u++)u>0&&a.append(","),a.append(r.pts[u].x+" "+r.pts[u].y);return a.append(")  "+this._label+" "+this._depthDelta),a.toString()},t.prototype.isPointwiseEqual=function(r){var a=this;if(this.pts.length!==r.pts.length)return!1;for(var u=0;u<this.pts.length;u++)if(!a.pts[u].equals2D(r.pts[u]))return!1;return!0},t.prototype.setDepthDelta=function(r){this._depthDelta=r},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(r,a,u){for(var p=this,i=0;i<r.getIntersectionNum();i++)p.addIntersection(r,a,u,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];a.setAtLeastIfValid(r.getLocation(0,bn.ON),r.getLocation(1,bn.ON),1),r.isArea()&&(a.setAtLeastIfValid(r.getLocation(0,bn.LEFT),r.getLocation(1,bn.LEFT),2),a.setAtLeastIfValid(r.getLocation(0,bn.RIGHT),r.getLocation(1,bn.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Mu),Wa=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Qc,this._bufParams=t||null};Wa.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};Wa.prototype.insertUniqueEdge=function(t){var n=this._edgeList.findEqualEdge(t);if(n!==null){var r=n.getLabel(),a=t.getLabel();n.isPointwiseEqual(t)||(a=new Ni(t.getLabel()),a.flip()),r.merge(a);var u=Wa.depthDelta(a),p=n.getDepthDelta(),i=p+u;n.setDepthDelta(i)}else this._edgeList.add(t),t.setDepthDelta(Wa.depthDelta(t.getLabel()))};Wa.prototype.buildSubgraphs=function(t,n){for(var r=new In,a=t.iterator();a.hasNext();){var u=a.next(),p=u.getRightmostCoordinate(),i=new Xy(r),b=i.getDepth(p);u.computeDepth(b),u.findResultEdges(),r.add(u),n.add(u.getDirectedEdges(),u.getNodes())}};Wa.prototype.createSubgraphs=function(t){for(var n=new In,r=t.getNodes().iterator();r.hasNext();){var a=r.next();if(!a.isVisited()){var u=new Ya;u.create(a),n.add(u)}}return Jc.sort(n,Jc.reverseOrder()),n};Wa.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};Wa.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var n=new iP,r=new G_;return r.setPrecisionModel(t),n.setSegmentIntersector(new Au(r)),n};Wa.prototype.buffer=function(t,n){var r=this._workingPrecisionModel;r===null&&(r=t.getPrecisionModel()),this._geomFact=t.getFactory();var a=new _l(r,this._bufParams),u=new fc(t,n,a),p=u.getCurves();if(p.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(p,r),this._graph=new Eo(new u5),this._graph.addEdges(this._edgeList.getEdges());var i=this.createSubgraphs(this._graph),b=new Hl(this._geomFact);this.buildSubgraphs(i,b);var C=b.getPolygons();if(C.size()<=0)return this.createEmptyResultGeometry();var A=this._geomFact.buildGeometry(C);return A};Wa.prototype.computeNodedEdges=function(t,n){var r=this,a=this.getNoder(n);a.computeNodes(t);for(var u=a.getNodedSubstrings(),p=u.iterator();p.hasNext();){var i=p.next(),b=i.getCoordinates();if(!(b.length===2&&b[0].equals2D(b[1]))){var C=i.getData(),A=new QS(i.getCoordinates(),new Ni(C));r.insertUniqueEdge(A)}}};Wa.prototype.setNoder=function(t){this._workingNoder=t};Wa.prototype.interfaces_=function(){return[]};Wa.prototype.getClass=function(){return Wa};Wa.depthDelta=function(t){var n=t.getLocation(0,bn.LEFT),r=t.getLocation(0,bn.RIGHT);return n===zt.INTERIOR&&r===zt.EXTERIOR?1:n===zt.EXTERIOR&&r===zt.INTERIOR?-1:0};Wa.convertSegStrings=function(t){for(var n=new ti,r=new In;t.hasNext();){var a=t.next(),u=n.createLineString(a.getCoordinates());r.add(u)}return n.buildGeometry(r)};var og=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],n=arguments[1];this._noder=t,this._scaleFactor=n,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],a=arguments[1],u=arguments[2],p=arguments[3];this._noder=r,this._scaleFactor=a,this._offsetX=u,this._offsetY=p,this._isScaled=!this.isIntegerPrecision()}};og.prototype.rescale=function(){var t=this;if(xr(arguments[0],ds))for(var n=arguments[0],r=n.iterator();r.hasNext();){var a=r.next();t.rescale(a.getCoordinates())}else if(arguments[0]instanceof Array){for(var u=arguments[0],p=0;p<u.length;p++)u[p].x=u[p].x/t._scaleFactor+t._offsetX,u[p].y=u[p].y/t._scaleFactor+t._offsetY;u.length===2&&u[0].equals2D(u[1])&&ta.out.println(u)}};og.prototype.scale=function(){var t=this;if(xr(arguments[0],ds)){for(var n=arguments[0],r=new In,a=n.iterator();a.hasNext();){var u=a.next();r.add(new Wo(t.scale(u.getCoordinates()),u.getData()))}return r}else if(arguments[0]instanceof Array){for(var p=arguments[0],i=new Array(p.length).fill(null),b=0;b<p.length;b++)i[b]=new Ot(Math.round((p[b].x-t._offsetX)*t._scaleFactor),Math.round((p[b].y-t._offsetY)*t._scaleFactor),p[b].z);var C=ni.removeRepeatedPoints(i);return C}};og.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};og.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};og.prototype.computeNodes=function(t){var n=t;this._isScaled&&(n=this.scale(t)),this._noder.computeNodes(n)};og.prototype.interfaces_=function(){return[P_]};og.prototype.getClass=function(){return og};var ud=function(){this._li=new G_,this._segStrings=null;var t=arguments[0];this._segStrings=t},h5={fact:{configurable:!0}};ud.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var r=n.next(),a=r.getCoordinates();t.checkEndPtVertexIntersections(a[0],t._segStrings),t.checkEndPtVertexIntersections(a[a.length-1],t._segStrings)}else if(arguments.length===2){for(var u=arguments[0],p=arguments[1],i=p.iterator();i.hasNext();)for(var b=i.next(),C=b.getCoordinates(),A=1;A<C.length-1;A++)if(C[A].equals(u))throw new Lp("found endpt/interior pt intersection at index "+A+" :pt "+u)}};ud.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();)for(var r=n.next(),a=this._segStrings.iterator();a.hasNext();){var u=a.next();t.checkInteriorIntersections(r,u)}else if(arguments.length===2)for(var p=arguments[0],i=arguments[1],b=p.getCoordinates(),C=i.getCoordinates(),A=0;A<b.length-1;A++)for(var R=0;R<C.length-1;R++)t.checkInteriorIntersections(p,A,i,R);else if(arguments.length===4){var z=arguments[0],V=arguments[1],W=arguments[2],X=arguments[3];if(z===W&&V===X)return null;var ue=z.getCoordinates()[V],ie=z.getCoordinates()[V+1],K=W.getCoordinates()[X],ee=W.getCoordinates()[X+1];if(this._li.computeIntersection(ue,ie,K,ee),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ue,ie)||this.hasInteriorIntersection(this._li,K,ee)))throw new Lp("found non-noded intersection at "+ue+"-"+ie+" and "+K+"-"+ee)}};ud.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};ud.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var r=n.next();t.checkCollapses(r)}else if(arguments.length===1)for(var a=arguments[0],u=a.getCoordinates(),p=0;p<u.length-2;p++)t.checkCollapse(u[p],u[p+1],u[p+2])};ud.prototype.hasInteriorIntersection=function(t,n,r){for(var a=0;a<t.getIntersectionNum();a++){var u=t.getIntersection(a);if(!(u.equals(n)||u.equals(r)))return!0}return!1};ud.prototype.checkCollapse=function(t,n,r){if(t.equals(r))throw new Lp("found non-noded collapse at "+ud.fact.createLineString([t,n,r]))};ud.prototype.interfaces_=function(){return[]};ud.prototype.getClass=function(){return ud};h5.fact.get=function(){return new ti};Object.defineProperties(ud,h5);var yl=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],n=arguments[1],r=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=n,this._li=r,n<=0)throw new po("Scale factor must be non-zero");n!==1&&(this._pt=new Ot(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Ot,this._p1Scaled=new Ot),this.initCorners(this._pt)},d5={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};yl.prototype.intersectsScaled=function(t,n){var r=Math.min(t.x,n.x),a=Math.max(t.x,n.x),u=Math.min(t.y,n.y),p=Math.max(t.y,n.y),i=this._maxx<r||this._minx>a||this._maxy<u||this._miny>p;if(i)return!1;var b=this.intersectsToleranceSquare(t,n);return qr.isTrue(!(i&&b),"Found bad envelope test"),b};yl.prototype.initCorners=function(t){var n=.5;this._minx=t.x-n,this._maxx=t.x+n,this._miny=t.y-n,this._maxy=t.y+n,this._corner[0]=new Ot(this._maxx,this._maxy),this._corner[1]=new Ot(this._minx,this._maxy),this._corner[2]=new Ot(this._minx,this._miny),this._corner[3]=new Ot(this._maxx,this._miny)};yl.prototype.intersects=function(t,n){return this._scaleFactor===1?this.intersectsScaled(t,n):(this.copyScaled(t,this._p0Scaled),this.copyScaled(n,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};yl.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};yl.prototype.getCoordinate=function(){return this._originalPt};yl.prototype.copyScaled=function(t,n){n.x=this.scale(t.x),n.y=this.scale(t.y)};yl.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=yl.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Qn(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};yl.prototype.intersectsPixelClosure=function(t,n){return this._li.computeIntersection(t,n,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,n,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,n,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,n,this._corner[3],this._corner[0]),this._li.hasIntersection()))};yl.prototype.intersectsToleranceSquare=function(t,n){var r=!1,a=!1;return this._li.computeIntersection(t,n,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,n,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,n,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(a=!0),this._li.computeIntersection(t,n,this._corner[3],this._corner[0]),this._li.isProper())||r&&a||t.equals(this._pt)||n.equals(this._pt))};yl.prototype.addSnappedNode=function(t,n){var r=t.getCoordinate(n),a=t.getCoordinate(n+1);return this.intersects(r,a)?(t.addIntersection(this.getCoordinate(),n),!0):!1};yl.prototype.interfaces_=function(){return[]};yl.prototype.getClass=function(){return yl};d5.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(yl,d5);var sb=function(){this.tempEnv1=new Qn,this.selectedSegment=new rr};sb.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var t=arguments[0],n=arguments[1];t.getLineSegment(n,this.selectedSegment),this.select(this.selectedSegment)}}};sb.prototype.interfaces_=function(){return[]};sb.prototype.getClass=function(){return sb};var U0=function(){this._index=null;var t=arguments[0];this._index=t},f5={HotPixelSnapAction:{configurable:!0}};U0.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2],u=n.getSafeEnvelope(),p=new p5(n,r,a);return this._index.query(u,{interfaces_:function(){return[ng]},visitItem:function(i){var b=i;b.select(u,p)}}),p.isNodeAdded()}};U0.prototype.interfaces_=function(){return[]};U0.prototype.getClass=function(){return U0};f5.HotPixelSnapAction.get=function(){return p5};Object.defineProperties(U0,f5);var p5=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],a=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1],u=r.getContext();if(this._parentEdge!==null&&u===this._parentEdge&&a===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(u,a)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(sb),Zy=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new In};Zy.prototype.processIntersections=function(t,n,r,a){var u=this;if(t===r&&n===a)return null;var p=t.getCoordinates()[n],i=t.getCoordinates()[n+1],b=r.getCoordinates()[a],C=r.getCoordinates()[a+1];if(this._li.computeIntersection(p,i,b,C),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var A=0;A<this._li.getIntersectionNum();A++)u._interiorIntersections.add(u._li.getIntersection(A));t.addIntersections(this._li,n,0),r.addIntersections(this._li,a,1)}};Zy.prototype.isDone=function(){return!1};Zy.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Zy.prototype.interfaces_=function(){return[R_]};Zy.prototype.getClass=function(){return Zy};var ff=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new G_,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};ff.prototype.checkCorrectness=function(t){var n=Wo.getNodedSubstrings(t),r=new ud(n);try{r.checkValid()}catch(a){if(a instanceof K4)a.printStackTrace();else throw a}finally{}};ff.prototype.getNodedSubstrings=function(){return Wo.getNodedSubstrings(this._nodedSegStrings)};ff.prototype.snapRound=function(t,n){var r=this.findInteriorIntersections(t,n);this.computeIntersectionSnaps(r),this.computeVertexSnaps(t)};ff.prototype.findInteriorIntersections=function(t,n){var r=new Zy(n);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(t),r.getInteriorIntersections()};ff.prototype.computeVertexSnaps=function(){var t=this;if(xr(arguments[0],ds))for(var n=arguments[0],r=n.iterator();r.hasNext();){var a=r.next();t.computeVertexSnaps(a)}else if(arguments[0]instanceof Wo)for(var u=arguments[0],p=u.getCoordinates(),i=0;i<p.length;i++){var b=new yl(p[i],t._scaleFactor,t._li),C=t._pointSnapper.snap(b,u,i);C&&u.addIntersection(p[i],i)}};ff.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new iP,this._pointSnapper=new U0(this._noder.getIndex()),this.snapRound(t,this._li)};ff.prototype.computeIntersectionSnaps=function(t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next(),u=new yl(a,n._scaleFactor,n._li);n._pointSnapper.snap(u)}};ff.prototype.interfaces_=function(){return[P_]};ff.prototype.getClass=function(){return ff};var Qs=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Si,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._argGeom=n,this._bufParams=r}},wx={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Qs.prototype.bufferFixedPrecision=function(t){var n=new og(new ff(new Ei(1)),t.getScale()),r=new Wa(this._bufParams);r.setWorkingPrecisionModel(t),r.setNoder(n),this._resultGeometry=r.buffer(this._argGeom,this._distance)};Qs.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var n=Qs.MAX_PRECISION_DIGITS;n>=0;n--){try{t.bufferReducedPrecision(n)}catch(p){if(p instanceof Dp)t._saveException=p;else throw p}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],a=Qs.precisionScaleFactor(this._argGeom,this._distance,r),u=new Ei(a);this.bufferFixedPrecision(u)}};Qs.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Ei.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};Qs.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};Qs.prototype.bufferOriginalPrecision=function(){try{var t=new Wa(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(n){if(n instanceof Lp)this._saveException=n;else throw n}finally{}};Qs.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};Qs.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};Qs.prototype.interfaces_=function(){return[]};Qs.prototype.getClass=function(){return Qs};Qs.bufferOp=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],r=new Qs(t),a=r.getResultGeometry(n);return a}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof yr&&typeof arguments[1]=="number"){var u=arguments[0],p=arguments[1],i=arguments[2],b=new Qs(u);b.setQuadrantSegments(i);var C=b.getResultGeometry(p);return C}else if(arguments[2]instanceof Si&&arguments[0]instanceof yr&&typeof arguments[1]=="number"){var A=arguments[0],R=arguments[1],z=arguments[2],V=new Qs(A,z),W=V.getResultGeometry(R);return W}}else if(arguments.length===4){var X=arguments[0],ue=arguments[1],ie=arguments[2],K=arguments[3],ee=new Qs(X);ee.setQuadrantSegments(ie),ee.setEndCapStyle(K);var ae=ee.getResultGeometry(ue);return ae}};Qs.precisionScaleFactor=function(t,n,r){var a=t.getEnvelopeInternal(),u=Iu.max(Math.abs(a.getMaxX()),Math.abs(a.getMaxY()),Math.abs(a.getMinX()),Math.abs(a.getMinY())),p=n>0?n:0,i=u+2*p,b=Math.trunc(Math.log(i)/Math.log(10)+1),C=r-b,A=Math.pow(10,C);return A};wx.CAP_ROUND.get=function(){return Si.CAP_ROUND};wx.CAP_BUTT.get=function(){return Si.CAP_FLAT};wx.CAP_FLAT.get=function(){return Si.CAP_FLAT};wx.CAP_SQUARE.get=function(){return Si.CAP_SQUARE};wx.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Qs,wx);var $a=function(){this._pt=[new Ot,new Ot],this._distance=Dr.NaN,this._isNull=!0};$a.prototype.getCoordinates=function(){return this._pt};$a.prototype.getCoordinate=function(t){return this._pt[t]};$a.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var a=n.distance(r);a<this._distance&&this.initialize(n,r,a)}};$a.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(n),this._distance=t.distance(n),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(a),this._distance=u,this._isNull=!1}};$a.prototype.getDistance=function(){return this._distance};$a.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var a=n.distance(r);a>this._distance&&this.initialize(n,r,a)}};$a.prototype.interfaces_=function(){return[]};$a.prototype.getClass=function(){return $a};var Xd=function(){};Xd.prototype.interfaces_=function(){return[]};Xd.prototype.getClass=function(){return Xd};Xd.computeDistance=function(){if(arguments[2]instanceof $a&&arguments[0]instanceof Fo&&arguments[1]instanceof Ot)for(var t=arguments[0],n=arguments[1],r=arguments[2],a=t.getCoordinates(),u=new rr,p=0;p<a.length-1;p++){u.setCoordinates(a[p],a[p+1]);var i=u.closestPoint(n);r.setMinimum(i,n)}else if(arguments[2]instanceof $a&&arguments[0]instanceof gs&&arguments[1]instanceof Ot){var b=arguments[0],C=arguments[1],A=arguments[2];Xd.computeDistance(b.getExteriorRing(),C,A);for(var R=0;R<b.getNumInteriorRing();R++)Xd.computeDistance(b.getInteriorRingN(R),C,A)}else if(arguments[2]instanceof $a&&arguments[0]instanceof yr&&arguments[1]instanceof Ot){var z=arguments[0],V=arguments[1],W=arguments[2];if(z instanceof Fo)Xd.computeDistance(z,V,W);else if(z instanceof gs)Xd.computeDistance(z,V,W);else if(z instanceof Za)for(var X=z,ue=0;ue<X.getNumGeometries();ue++){var ie=X.getGeometryN(ue);Xd.computeDistance(ie,V,W)}else W.setMinimum(z.getCoordinate(),V)}else if(arguments[2]instanceof $a&&arguments[0]instanceof rr&&arguments[1]instanceof Ot){var K=arguments[0],ee=arguments[1],ae=arguments[2],he=K.closestPoint(ee);ae.setMinimum(he,ee)}};var O_=function(t){this._maxPtDist=new $a,this._inputGeom=t||null},oP={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};O_.prototype.computeMaxMidpointDistance=function(t){var n=new sg(this._inputGeom);t.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};O_.prototype.computeMaxVertexDistance=function(t){var n=new Yy(this._inputGeom);t.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};O_.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};O_.prototype.getDistancePoints=function(){return this._maxPtDist};O_.prototype.interfaces_=function(){return[]};O_.prototype.getClass=function(){return O_};oP.MaxPointDistanceFilter.get=function(){return Yy};oP.MaxMidpointDistanceFilter.get=function(){return sg};Object.defineProperties(O_,oP);var Yy=function(t){this._maxPtDist=new $a,this._minPtDist=new $a,this._geom=t||null};Yy.prototype.filter=function(t){this._minPtDist.initialize(),Xd.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Yy.prototype.getMaxPointDistance=function(){return this._maxPtDist};Yy.prototype.interfaces_=function(){return[lf]};Yy.prototype.getClass=function(){return Yy};var sg=function(t){this._maxPtDist=new $a,this._minPtDist=new $a,this._geom=t||null};sg.prototype.filter=function(t,n){if(n===0)return null;var r=t.getCoordinate(n-1),a=t.getCoordinate(n),u=new Ot((r.x+a.x)/2,(r.y+a.y)/2);this._minPtDist.initialize(),Xd.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};sg.prototype.isDone=function(){return!1};sg.prototype.isGeometryChanged=function(){return!1};sg.prototype.getMaxPointDistance=function(){return this._maxPtDist};sg.prototype.interfaces_=function(){return[Yc]};sg.prototype.getClass=function(){return sg};var Ap=function(t){this._comps=t||null};Ap.prototype.filter=function(t){t instanceof gs&&this._comps.add(t)};Ap.prototype.interfaces_=function(){return[id]};Ap.prototype.getClass=function(){return Ap};Ap.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return Ap.getPolygons(t,new In)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n instanceof gs?r.add(n):n instanceof Za&&n.apply(new Ap(r)),r}};var Js=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._lines=n,this._isForcedToLineString=r}};Js.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof uf){var n=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(n),null}t instanceof Fo&&this._lines.add(t)};Js.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};Js.prototype.interfaces_=function(){return[Op]};Js.prototype.getClass=function(){return Js};Js.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(Js.getLines(t))}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n.getFactory().buildGeometry(Js.getLines(n,r))}};Js.getLines=function(){if(arguments.length===1){var t=arguments[0];return Js.getLines(t,!1)}else if(arguments.length===2){if(xr(arguments[0],ds)&&xr(arguments[1],ds)){for(var n=arguments[0],r=arguments[1],a=n.iterator();a.hasNext();){var u=a.next();Js.getLines(u,r)}return r}else if(arguments[0]instanceof yr&&typeof arguments[1]=="boolean"){var p=arguments[0],i=arguments[1],b=new In;return p.apply(new Js(b,i)),b}else if(arguments[0]instanceof yr&&xr(arguments[1],ds)){var C=arguments[0],A=arguments[1];return C instanceof Fo?A.add(C):C.apply(new Js(A)),A}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&xr(arguments[0],ds)&&xr(arguments[1],ds)){for(var R=arguments[0],z=arguments[1],V=arguments[2],W=R.iterator();W.hasNext();){var X=W.next();Js.getLines(X,z,V)}return z}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof yr&&xr(arguments[1],ds)){var ue=arguments[0],ie=arguments[1],K=arguments[2];return ue.apply(new Js(ie,K)),ie}}};var eh=function(){if(this._boundaryRule=hc.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];if(t===null)throw new po("Rule must be non-null");this._boundaryRule=t}}};eh.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Ot&&arguments[1]instanceof gs){var n=arguments[0],r=arguments[1];if(r.isEmpty())return zt.EXTERIOR;var a=r.getExteriorRing(),u=this.locateInPolygonRing(n,a);if(u===zt.EXTERIOR)return zt.EXTERIOR;if(u===zt.BOUNDARY)return zt.BOUNDARY;for(var p=0;p<r.getNumInteriorRing();p++){var i=r.getInteriorRingN(p),b=t.locateInPolygonRing(n,i);if(b===zt.INTERIOR)return zt.EXTERIOR;if(b===zt.BOUNDARY)return zt.BOUNDARY}return zt.INTERIOR}else if(arguments[0]instanceof Ot&&arguments[1]instanceof Fo){var C=arguments[0],A=arguments[1];if(!A.getEnvelopeInternal().intersects(C))return zt.EXTERIOR;var R=A.getCoordinates();return!A.isClosed()&&(C.equals(R[0])||C.equals(R[R.length-1]))?zt.BOUNDARY:On.isOnLine(C,R)?zt.INTERIOR:zt.EXTERIOR}else if(arguments[0]instanceof Ot&&arguments[1]instanceof ql){var z=arguments[0],V=arguments[1],W=V.getCoordinate();return W.equals2D(z)?zt.INTERIOR:zt.EXTERIOR}};eh.prototype.locateInPolygonRing=function(t,n){return n.getEnvelopeInternal().intersects(t)?On.locatePointInRing(t,n.getCoordinates()):zt.EXTERIOR};eh.prototype.intersects=function(t,n){return this.locate(t,n)!==zt.EXTERIOR};eh.prototype.updateLocationInfo=function(t){t===zt.INTERIOR&&(this._isIn=!0),t===zt.BOUNDARY&&this._numBoundaries++};eh.prototype.computeLocation=function(t,n){var r=this;if(n instanceof ql&&this.updateLocationInfo(this.locateInternal(t,n)),n instanceof Fo)this.updateLocationInfo(this.locateInternal(t,n));else if(n instanceof gs)this.updateLocationInfo(this.locateInternal(t,n));else if(n instanceof M_)for(var a=n,u=0;u<a.getNumGeometries();u++){var p=a.getGeometryN(u);r.updateLocationInfo(r.locateInternal(t,p))}else if(n instanceof Qd)for(var i=n,b=0;b<i.getNumGeometries();b++){var C=i.getGeometryN(b);r.updateLocationInfo(r.locateInternal(t,C))}else if(n instanceof Za)for(var A=new ef(n);A.hasNext();){var R=A.next();R!==n&&r.computeLocation(t,R)}};eh.prototype.locate=function(t,n){return n.isEmpty()?zt.EXTERIOR:n instanceof Fo?this.locateInternal(t,n):n instanceof gs?this.locateInternal(t,n):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,n),this._boundaryRule.isInBoundary(this._numBoundaries)?zt.BOUNDARY:this._numBoundaries>0||this._isIn?zt.INTERIOR:zt.EXTERIOR)};eh.prototype.interfaces_=function(){return[]};eh.prototype.getClass=function(){return eh};var qa=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._component=r,this._segIndex=a,this._pt=u}},m5={INSIDE_AREA:{configurable:!0}};qa.prototype.isInsideArea=function(){return this._segIndex===qa.INSIDE_AREA};qa.prototype.getCoordinate=function(){return this._pt};qa.prototype.getGeometryComponent=function(){return this._component};qa.prototype.getSegmentIndex=function(){return this._segIndex};qa.prototype.interfaces_=function(){return[]};qa.prototype.getClass=function(){return qa};m5.INSIDE_AREA.get=function(){return-1};Object.defineProperties(qa,m5);var Zm=function(t){this._pts=t||null};Zm.prototype.filter=function(t){t instanceof ql&&this._pts.add(t)};Zm.prototype.interfaces_=function(){return[id]};Zm.prototype.getClass=function(){return Zm};Zm.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof ql?Jc.singletonList(t):Zm.getPoints(t,new In)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n instanceof ql?r.add(n):n instanceof Za&&n.apply(new Zm(r)),r}};var Ky=function(){this._locations=null;var t=arguments[0];this._locations=t};Ky.prototype.filter=function(t){(t instanceof ql||t instanceof Fo||t instanceof gs)&&this._locations.add(new qa(t,0,t.getCoordinate()))};Ky.prototype.interfaces_=function(){return[id]};Ky.prototype.getClass=function(){return Ky};Ky.getLocations=function(t){var n=new In;return t.apply(new Ky(n)),n};var ra=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new eh,this._minDistanceLocation=null,this._minDistance=Dr.MAX_VALUE,arguments.length===2){var t=arguments[0],n=arguments[1];this._geom=[t,n],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=a,this._terminateDistance=u}};ra.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var n=new Array(2).fill(null);if(this.computeContainmentDistance(0,n),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,n)}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u=1-r,p=Ap.getPolygons(this._geom[r]);if(p.size()>0){var i=Ky.getLocations(this._geom[u]);if(this.computeContainmentDistance(i,p,a),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[u]=a[0],this._minDistanceLocation[r]=a[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&xr(arguments[0],qc)&&xr(arguments[1],qc)){for(var b=arguments[0],C=arguments[1],A=arguments[2],R=0;R<b.size();R++)for(var z=b.get(R),V=0;V<C.size();V++)if(t.computeContainmentDistance(z,C.get(V),A),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof qa&&arguments[1]instanceof gs){var W=arguments[0],X=arguments[1],ue=arguments[2],ie=W.getCoordinate();if(zt.EXTERIOR!==this._ptLocator.locate(ie,X))return this._minDistance=0,ue[0]=W,ue[1]=new qa(X,ie),null}}};ra.prototype.computeMinDistanceLinesPoints=function(t,n,r){for(var a=this,u=0;u<t.size();u++)for(var p=t.get(u),i=0;i<n.size();i++){var b=n.get(i);if(a.computeMinDistance(p,b,r),a._minDistance<=a._terminateDistance)return null}};ra.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),n=Js.getLines(this._geom[0]),r=Js.getLines(this._geom[1]),a=Zm.getPoints(this._geom[0]),u=Zm.getPoints(this._geom[1]);if(this.computeMinDistanceLines(n,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,u,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,a,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(a,u,t),this.updateMinDistance(t,!1)};ra.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ra.prototype.updateMinDistance=function(t,n){if(t[0]===null)return null;n?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};ra.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};ra.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Fo&&arguments[1]instanceof ql){var n=arguments[0],r=arguments[1],a=arguments[2];if(n.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var u=n.getCoordinates(),p=r.getCoordinate(),i=0;i<u.length-1;i++){var b=On.distancePointLine(p,u[i],u[i+1]);if(b<t._minDistance){t._minDistance=b;var C=new rr(u[i],u[i+1]),A=C.closestPoint(p);a[0]=new qa(n,i,A),a[1]=new qa(r,0,p)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Fo&&arguments[1]instanceof Fo){var R=arguments[0],z=arguments[1],V=arguments[2];if(R.getEnvelopeInternal().distance(z.getEnvelopeInternal())>this._minDistance)return null;for(var W=R.getCoordinates(),X=z.getCoordinates(),ue=0;ue<W.length-1;ue++)for(var ie=0;ie<X.length-1;ie++){var K=On.distanceLineLine(W[ue],W[ue+1],X[ie],X[ie+1]);if(K<t._minDistance){t._minDistance=K;var ee=new rr(W[ue],W[ue+1]),ae=new rr(X[ie],X[ie+1]),he=ee.closestPoints(ae);V[0]=new qa(R,ue,he[0]),V[1]=new qa(z,ie,he[1])}if(t._minDistance<=t._terminateDistance)return null}}}};ra.prototype.computeMinDistancePoints=function(t,n,r){for(var a=this,u=0;u<t.size();u++)for(var p=t.get(u),i=0;i<n.size();i++){var b=n.get(i),C=p.getCoordinate().distance(b.getCoordinate());if(C<a._minDistance&&(a._minDistance=C,r[0]=new qa(p,0,p.getCoordinate()),r[1]=new qa(b,0,b.getCoordinate())),a._minDistance<=a._terminateDistance)return null}};ra.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new po("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ra.prototype.computeMinDistanceLines=function(t,n,r){for(var a=this,u=0;u<t.size();u++)for(var p=t.get(u),i=0;i<n.size();i++){var b=n.get(i);if(a.computeMinDistance(p,b,r),a._minDistance<=a._terminateDistance)return null}};ra.prototype.interfaces_=function(){return[]};ra.prototype.getClass=function(){return ra};ra.distance=function(t,n){var r=new ra(t,n);return r.distance()};ra.isWithinDistance=function(t,n,r){var a=new ra(t,n,r);return a.distance()<=r};ra.nearestPoints=function(t,n){var r=new ra(t,n);return r.nearestPoints()};var wa=function(){this._pt=[new Ot,new Ot],this._distance=Dr.NaN,this._isNull=!0};wa.prototype.getCoordinates=function(){return this._pt};wa.prototype.getCoordinate=function(t){return this._pt[t]};wa.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var a=n.distance(r);a<this._distance&&this.initialize(n,r,a)}};wa.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(n),this._distance=t.distance(n),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(a),this._distance=u,this._isNull=!1}};wa.prototype.toString=function(){return Zc.toLineString(this._pt[0],this._pt[1])};wa.prototype.getDistance=function(){return this._distance};wa.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var a=n.distance(r);a>this._distance&&this.initialize(n,r,a)}};wa.prototype.interfaces_=function(){return[]};wa.prototype.getClass=function(){return wa};var Gh=function(){};Gh.prototype.interfaces_=function(){return[]};Gh.prototype.getClass=function(){return Gh};Gh.computeDistance=function(){if(arguments[2]instanceof wa&&arguments[0]instanceof Fo&&arguments[1]instanceof Ot)for(var t=arguments[0],n=arguments[1],r=arguments[2],a=new rr,u=t.getCoordinates(),p=0;p<u.length-1;p++){a.setCoordinates(u[p],u[p+1]);var i=a.closestPoint(n);r.setMinimum(i,n)}else if(arguments[2]instanceof wa&&arguments[0]instanceof gs&&arguments[1]instanceof Ot){var b=arguments[0],C=arguments[1],A=arguments[2];Gh.computeDistance(b.getExteriorRing(),C,A);for(var R=0;R<b.getNumInteriorRing();R++)Gh.computeDistance(b.getInteriorRingN(R),C,A)}else if(arguments[2]instanceof wa&&arguments[0]instanceof yr&&arguments[1]instanceof Ot){var z=arguments[0],V=arguments[1],W=arguments[2];if(z instanceof Fo)Gh.computeDistance(z,V,W);else if(z instanceof gs)Gh.computeDistance(z,V,W);else if(z instanceof Za)for(var X=z,ue=0;ue<X.getNumGeometries();ue++){var ie=X.getGeometryN(ue);Gh.computeDistance(ie,V,W)}else W.setMinimum(z.getCoordinate(),V)}else if(arguments[2]instanceof wa&&arguments[0]instanceof rr&&arguments[1]instanceof Ot){var K=arguments[0],ee=arguments[1],ae=arguments[2],he=K.closestPoint(ee);ae.setMinimum(he,ee)}};var cc=function(){this._g0=null,this._g1=null,this._ptDist=new wa,this._densifyFrac=0;var t=arguments[0],n=arguments[1];this._g0=t,this._g1=n},sP={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};cc.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};cc.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new po("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};cc.prototype.compute=function(t,n){this.computeOrientedDistance(t,n,this._ptDist),this.computeOrientedDistance(n,t,this._ptDist)};cc.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};cc.prototype.computeOrientedDistance=function(t,n,r){var a=new Jy(n);if(t.apply(a),r.setMaximum(a.getMaxPointDistance()),this._densifyFrac>0){var u=new ag(n,this._densifyFrac);t.apply(u),r.setMaximum(u.getMaxPointDistance())}};cc.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};cc.prototype.interfaces_=function(){return[]};cc.prototype.getClass=function(){return cc};cc.distance=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],r=new cc(t,n);return r.distance()}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2],i=new cc(a,u);return i.setDensifyFraction(p),i.distance()}};sP.MaxPointDistanceFilter.get=function(){return Jy};sP.MaxDensifiedByFractionDistanceFilter.get=function(){return ag};Object.defineProperties(cc,sP);var Jy=function(){this._maxPtDist=new wa,this._minPtDist=new wa,this._euclideanDist=new Gh,this._geom=null;var t=arguments[0];this._geom=t};Jy.prototype.filter=function(t){this._minPtDist.initialize(),Gh.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Jy.prototype.getMaxPointDistance=function(){return this._maxPtDist};Jy.prototype.interfaces_=function(){return[lf]};Jy.prototype.getClass=function(){return Jy};var ag=function(){this._maxPtDist=new wa,this._minPtDist=new wa,this._geom=null,this._numSubSegs=0;var t=arguments[0],n=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/n))};ag.prototype.filter=function(t,n){var r=this;if(n===0)return null;for(var a=t.getCoordinate(n-1),u=t.getCoordinate(n),p=(u.x-a.x)/this._numSubSegs,i=(u.y-a.y)/this._numSubSegs,b=0;b<this._numSubSegs;b++){var C=a.x+b*p,A=a.y+b*i,R=new Ot(C,A);r._minPtDist.initialize(),Gh.computeDistance(r._geom,R,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};ag.prototype.isDone=function(){return!1};ag.prototype.isGeometryChanged=function(){return!1};ag.prototype.getMaxPointDistance=function(){return this._maxPtDist};ag.prototype.interfaces_=function(){return[Yc]};ag.prototype.getClass=function(){return ag};var Gl=function(t,n,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=n||null,this._result=r||null},aP={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Gl.prototype.checkMaximumDistance=function(t,n,r){var a=new cc(n,t);if(a.setDensifyFraction(.25),this._maxDistanceFound=a.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var u=a.getCoordinates();this._errorLocation=u[1],this._errorIndicator=t.getFactory().createLineString(u),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Zc.toLineString(u[0],u[1])+")"}};Gl.prototype.isValid=function(){var t=Math.abs(this._bufDistance),n=Gl.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-n,this._maxValidDistance=t+n,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Gl.VERBOSE&&ta.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Gl.prototype.checkNegativeValid=function(){if(!(this._input instanceof gs||this._input instanceof Qd||this._input instanceof Za))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};Gl.prototype.getErrorIndicator=function(){return this._errorIndicator};Gl.prototype.checkMinimumDistance=function(t,n,r){var a=new ra(t,n,r);if(this._minDistanceFound=a.distance(),this._minDistanceFound<r){this._isValid=!1;var u=a.nearestPoints();this._errorLocation=a.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(u),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Zc.toLineString(u[0],u[1])+" )"}};Gl.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};Gl.prototype.getErrorLocation=function(){return this._errorLocation};Gl.prototype.getPolygonLines=function(t){for(var n=new In,r=new Js(n),a=Ap.getPolygons(t),u=a.iterator();u.hasNext();){var p=u.next();p.apply(r)}return t.getFactory().buildGeometry(n)};Gl.prototype.getErrorMessage=function(){return this._errMsg};Gl.prototype.interfaces_=function(){return[]};Gl.prototype.getClass=function(){return Gl};aP.VERBOSE.get=function(){return!1};aP.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Gl,aP);var ia=function(t,n,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=n||null,this._result=r||null},lP={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};ia.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};ia.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*ia.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var n=new Qn(this._input.getEnvelopeInternal());n.expandBy(this._distance);var r=new Qn(this._result.getEnvelopeInternal());r.expandBy(t),r.contains(n)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};ia.prototype.checkDistance=function(){var t=new Gl(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};ia.prototype.checkArea=function(){var t=this._input.getArea(),n=this._result.getArea();this._distance>0&&t>n&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<n&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};ia.prototype.checkPolygonal=function(){this._result instanceof gs||this._result instanceof Qd||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};ia.prototype.getErrorIndicator=function(){return this._errorIndicator};ia.prototype.getErrorLocation=function(){return this._errorLocation};ia.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};ia.prototype.report=function(t){if(!ia.VERBOSE)return null;ta.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};ia.prototype.getErrorMessage=function(){return this._errorMsg};ia.prototype.interfaces_=function(){return[]};ia.prototype.getClass=function(){return ia};ia.isValidMsg=function(t,n,r){var a=new ia(t,n,r);return a.isValid()?null:a.getErrorMessage()};ia.isValid=function(t,n,r){var a=new ia(t,n,r);return!!a.isValid()};lP.VERBOSE.get=function(){return!1};lP.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(ia,lP);var cd=function(){this._pts=null,this._data=null;var t=arguments[0],n=arguments[1];this._pts=t,this._data=n};cd.prototype.getCoordinates=function(){return this._pts};cd.prototype.size=function(){return this._pts.length};cd.prototype.getCoordinate=function(t){return this._pts[t]};cd.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};cd.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:Wy.octant(this.getCoordinate(t),this.getCoordinate(t+1))};cd.prototype.setData=function(t){this._data=t};cd.prototype.getData=function(){return this._data};cd.prototype.toString=function(){return Zc.toLineString(new $o(this._pts))};cd.prototype.interfaces_=function(){return[hf]};cd.prototype.getClass=function(){return cd};var Fs=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new In,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Fs.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Fs.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};Fs.prototype.getIntersectionSegments=function(){return this._intSegments};Fs.prototype.count=function(){return this._intersectionCount};Fs.prototype.getIntersections=function(){return this._intersections};Fs.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Fs.prototype.setKeepIntersections=function(t){this._keepIntersections=t};Fs.prototype.processIntersections=function(t,n,r,a){if(!this._findAllIntersections&&this.hasIntersection()||t===r&&n===a)return null;if(this._isCheckEndSegmentsOnly){var u=this.isEndSegment(t,n)||this.isEndSegment(r,a);if(!u)return null}var p=t.getCoordinates()[n],i=t.getCoordinates()[n+1],b=r.getCoordinates()[a],C=r.getCoordinates()[a+1];this._li.computeIntersection(p,i,b,C),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=p,this._intSegments[1]=i,this._intSegments[2]=b,this._intSegments[3]=C,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Fs.prototype.isEndSegment=function(t,n){return n===0||n>=t.size()-2};Fs.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Fs.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Fs.prototype.interfaces_=function(){return[R_]};Fs.prototype.getClass=function(){return Fs};Fs.createAllIntersectionsFinder=function(t){var n=new Fs(t);return n.setFindAllIntersections(!0),n};Fs.createAnyIntersectionFinder=function(t){return new Fs(t)};Fs.createIntersectionCounter=function(t){var n=new Fs(t);return n.setFindAllIntersections(!0),n.setKeepIntersections(!1),n};var th=function(){this._li=new G_,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};th.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};th.prototype.getIntersections=function(){return this._segInt.getIntersections()};th.prototype.isValid=function(){return this.execute(),this._isValid};th.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};th.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Fs(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new iP;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};th.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Dp(this.getErrorMessage(),this._segInt.getInteriorIntersection())};th.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Zc.toLineString(t[0],t[1])+" and "+Zc.toLineString(t[2],t[3])};th.prototype.interfaces_=function(){return[]};th.prototype.getClass=function(){return th};th.computeIntersections=function(t){var n=new th(t);return n.setFindAllIntersections(!0),n.isValid(),n.getIntersections()};var D_=function e(){this._nv=null;var t=arguments[0];this._nv=new th(e.toSegmentStrings(t))};D_.prototype.checkValid=function(){this._nv.checkValid()};D_.prototype.interfaces_=function(){return[]};D_.prototype.getClass=function(){return D_};D_.toSegmentStrings=function(t){for(var n=new In,r=t.iterator();r.hasNext();){var a=r.next();n.add(new cd(a.getCoordinates(),a))}return n};D_.checkValid=function(t){var n=new D_(t);n.checkValid()};var Qy=function(t){this._mapOp=t};Qy.prototype.map=function(t){for(var n=this,r=new In,a=0;a<t.getNumGeometries();a++){var u=n._mapOp.map(t.getGeometryN(a));u.isEmpty()||r.add(u)}return t.getFactory().createGeometryCollection(ti.toGeometryArray(r))};Qy.prototype.interfaces_=function(){return[]};Qy.prototype.getClass=function(){return Qy};Qy.map=function(t,n){var r=new Qy(n);return r.map(t)};var hd=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new In,this._resultLineList=new In;var t=arguments[0],n=arguments[1],r=arguments[2];this._op=t,this._geometryFactory=n,this._ptLocator=r};hd.prototype.collectLines=function(t){for(var n=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var a=r.next();n.collectLineEdge(a,t,n._lineEdgesList),n.collectBoundaryTouchEdge(a,t,n._lineEdgesList)}};hd.prototype.labelIsolatedLine=function(t,n){var r=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(n));t.getLabel().setLocation(n,r)};hd.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};hd.prototype.collectLineEdge=function(t,n,r){var a=t.getLabel(),u=t.getEdge();t.isLineEdge()&&!t.isVisited()&&Ur.isResultOfOp(a,n)&&!u.isCovered()&&(r.add(u),t.setVisitedEdge(!0))};hd.prototype.findCoveredLineEdges=function(){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().findCoveredLineEdges()}for(var a=this._op.getGraph().getEdgeEnds().iterator();a.hasNext();){var u=a.next(),p=u.getEdge();if(u.isLineEdge()&&!p.isCoveredSet()){var i=t._op.isCoveredByA(u.getCoordinate());p.setCovered(i)}}};hd.prototype.labelIsolatedLines=function(t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next(),u=a.getLabel();a.isIsolated()&&(u.isNull(0)?n.labelIsolatedLine(a,0):n.labelIsolatedLine(a,1))}};hd.prototype.buildLines=function(t){for(var n=this,r=this._lineEdgesList.iterator();r.hasNext();){var a=r.next(),u=n._geometryFactory.createLineString(a.getCoordinates());n._resultLineList.add(u),a.setInResult(!0)}};hd.prototype.collectBoundaryTouchEdge=function(t,n,r){var a=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;qr.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),Ur.isResultOfOp(a,n)&&n===Ur.INTERSECTION&&(r.add(t.getEdge()),t.setVisitedEdge(!0))};hd.prototype.interfaces_=function(){return[]};hd.prototype.getClass=function(){return hd};var ev=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new In;var t=arguments[0],n=arguments[1];this._op=t,this._geometryFactory=n};ev.prototype.filterCoveredNodeToPoint=function(t){var n=t.getCoordinate();if(!this._op.isCoveredByLA(n)){var r=this._geometryFactory.createPoint(n);this._resultPointList.add(r)}};ev.prototype.extractNonCoveredResultNodes=function(t){for(var n=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var a=r.next();if(!a.isInResult()&&!a.isIncidentEdgeInResult()&&(a.getEdges().getDegree()===0||t===Ur.INTERSECTION)){var u=a.getLabel();Ur.isResultOfOp(u,t)&&n.filterCoveredNodeToPoint(a)}}};ev.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};ev.prototype.interfaces_=function(){return[]};ev.prototype.getClass=function(){return ev};var vl=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};vl.prototype.transformPoint=function(t,n){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};vl.prototype.transformPolygon=function(t,n){var r=this,a=!0,u=this.transformLinearRing(t.getExteriorRing(),t);(u===null||!(u instanceof uf)||u.isEmpty())&&(a=!1);for(var p=new In,i=0;i<t.getNumInteriorRing();i++){var b=r.transformLinearRing(t.getInteriorRingN(i),t);b===null||b.isEmpty()||(b instanceof uf||(a=!1),p.add(b))}if(a)return this._factory.createPolygon(u,p.toArray([]));var C=new In;return u!==null&&C.add(u),C.addAll(p),this._factory.buildGeometry(C)};vl.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};vl.prototype.getInputGeometry=function(){return this._inputGeom};vl.prototype.transformMultiLineString=function(t,n){for(var r=this,a=new In,u=0;u<t.getNumGeometries();u++){var p=r.transformLineString(t.getGeometryN(u),t);p!==null&&(p.isEmpty()||a.add(p))}return this._factory.buildGeometry(a)};vl.prototype.transformCoordinates=function(t,n){return this.copy(t)};vl.prototype.transformLineString=function(t,n){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};vl.prototype.transformMultiPoint=function(t,n){for(var r=this,a=new In,u=0;u<t.getNumGeometries();u++){var p=r.transformPoint(t.getGeometryN(u),t);p!==null&&(p.isEmpty()||a.add(p))}return this._factory.buildGeometry(a)};vl.prototype.transformMultiPolygon=function(t,n){for(var r=this,a=new In,u=0;u<t.getNumGeometries();u++){var p=r.transformPolygon(t.getGeometryN(u),t);p!==null&&(p.isEmpty()||a.add(p))}return this._factory.buildGeometry(a)};vl.prototype.copy=function(t){return t.copy()};vl.prototype.transformGeometryCollection=function(t,n){for(var r=this,a=new In,u=0;u<t.getNumGeometries();u++){var p=r.transform(t.getGeometryN(u));p!==null&&(r._pruneEmptyGeometry&&p.isEmpty()||a.add(p))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ti.toGeometryArray(a)):this._factory.buildGeometry(a)};vl.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof ql)return this.transformPoint(t,null);if(t instanceof F0)return this.transformMultiPoint(t,null);if(t instanceof uf)return this.transformLinearRing(t,null);if(t instanceof Fo)return this.transformLineString(t,null);if(t instanceof M_)return this.transformMultiLineString(t,null);if(t instanceof gs)return this.transformPolygon(t,null);if(t instanceof Qd)return this.transformMultiPolygon(t,null);if(t instanceof Za)return this.transformGeometryCollection(t,null);throw new po("Unknown Geometry subtype: "+t.getClass().getName())};vl.prototype.transformLinearRing=function(t,n){var r=this.transformCoordinates(t.getCoordinateSequence(),t);if(r===null)return this._factory.createLinearRing(null);var a=r.size();return a>0&&a<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};vl.prototype.interfaces_=function(){return[]};vl.prototype.getClass=function(){return vl};var pf=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new rr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Fo&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],a=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=a}};pf.prototype.snapVertices=function(t,n){for(var r=this,a=this._isClosed?t.size()-1:t.size(),u=0;u<a;u++){var p=t.get(u),i=r.findSnapForVertex(p,n);i!==null&&(t.set(u,new Ot(i)),u===0&&r._isClosed&&t.set(t.size()-1,new Ot(i)))}};pf.prototype.findSnapForVertex=function(t,n){for(var r=this,a=0;a<n.length;a++){if(t.equals2D(n[a]))return null;if(t.distance(n[a])<r._snapTolerance)return n[a]}return null};pf.prototype.snapTo=function(t){var n=new Nb(this._srcPts);this.snapVertices(n,t),this.snapSegments(n,t);var r=n.toCoordinateArray();return r};pf.prototype.snapSegments=function(t,n){var r=this;if(n.length===0)return null;var a=n.length;n[0].equals2D(n[n.length-1])&&(a=n.length-1);for(var u=0;u<a;u++){var p=n[u],i=r.findSegmentIndexToSnap(p,t);i>=0&&t.add(i+1,new Ot(p),!1)}};pf.prototype.findSegmentIndexToSnap=function(t,n){for(var r=this,a=Dr.MAX_VALUE,u=-1,p=0;p<n.size()-1;p++){if(r._seg.p0=n.get(p),r._seg.p1=n.get(p+1),r._seg.p0.equals2D(t)||r._seg.p1.equals2D(t)){if(r._allowSnappingToSourceVertices)continue;return-1}var i=r._seg.distance(t);i<r._snapTolerance&&i<a&&(a=i,u=p)}return u};pf.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};pf.prototype.interfaces_=function(){return[]};pf.prototype.getClass=function(){return pf};pf.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var qo=function(t){this._srcGeom=t||null},g5={SNAP_PRECISION_FACTOR:{configurable:!0}};qo.prototype.snapTo=function(t,n){var r=this.extractTargetCoordinates(t),a=new _5(n,r);return a.transform(this._srcGeom)};qo.prototype.snapToSelf=function(t,n){var r=this.extractTargetCoordinates(this._srcGeom),a=new _5(t,r,!0),u=a.transform(this._srcGeom),p=u;return n&&xr(p,tg)&&(p=u.buffer(0)),p};qo.prototype.computeSnapTolerance=function(t){var n=this.computeMinimumSegmentLength(t),r=n/10;return r};qo.prototype.extractTargetCoordinates=function(t){for(var n=new rd,r=t.getCoordinates(),a=0;a<r.length;a++)n.add(r[a]);return n.toArray(new Array(0).fill(null))};qo.prototype.computeMinimumSegmentLength=function(t){for(var n=Dr.MAX_VALUE,r=0;r<t.length-1;r++){var a=t[r].distance(t[r+1]);a<n&&(n=a)}return n};qo.prototype.interfaces_=function(){return[]};qo.prototype.getClass=function(){return qo};qo.snap=function(t,n,r){var a=new Array(2).fill(null),u=new qo(t);a[0]=u.snapTo(n,r);var p=new qo(n);return a[1]=p.snapTo(a[0],r),a};qo.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],n=qo.computeSizeBasedSnapTolerance(t),r=t.getPrecisionModel();if(r.getType()===Ei.FIXED){var a=1/r.getScale()*2/1.415;a>n&&(n=a)}return n}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return Math.min(qo.computeOverlaySnapTolerance(u),qo.computeOverlaySnapTolerance(p))}};qo.computeSizeBasedSnapTolerance=function(t){var n=t.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth()),a=r*qo.SNAP_PRECISION_FACTOR;return a};qo.snapToSelf=function(t,n,r){var a=new qo(t);return a.snapToSelf(n,r)};g5.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(qo,g5);var _5=function(e){function t(n,r,a){e.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=a!==void 0?a:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(r,a){var u=new pf(r,this._snapTolerance);return u.setAllowSnappingToSourceVertices(this._isSelfSnap),u.snapTo(a)},t.prototype.transformCoordinates=function(r,a){var u=r.toCoordinateArray(),p=this.snapLine(u,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(p)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(vl),Ga=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Ga.prototype.getCommon=function(){return Dr.longBitsToDouble(this._commonBits)};Ga.prototype.add=function(t){var n=Dr.doubleToLongBits(t);if(this._isFirst)return this._commonBits=n,this._commonSignExp=Ga.signExpBits(this._commonBits),this._isFirst=!1,null;var r=Ga.signExpBits(n);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Ga.numCommonMostSigMantissaBits(this._commonBits,n),this._commonBits=Ga.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Ga.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],n=Dr.longBitsToDouble(t),r=Dr.toBinaryString(t),a="0000000000000000000000000000000000000000000000000000000000000000"+r,u=a.substring(a.length-64),p=u.substring(0,1)+"  "+u.substring(1,12)+"(exp) "+u.substring(12)+" [ "+n+" ]";return p}};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};Ga.getBit=function(t,n){var r=1<<n;return(t&r)!==0?1:0};Ga.signExpBits=function(t){return t>>52};Ga.zeroLowerBits=function(t,n){var r=(1<<n)-1,a=~r,u=t&a;return u};Ga.numCommonMostSigMantissaBits=function(t,n){for(var r=0,a=52;a>=0;a--){if(Ga.getBit(t,a)!==Ga.getBit(n,a))return r;r++}return 52};var lg=function(){this._commonCoord=null,this._ccFilter=new tv},uP={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};lg.prototype.addCommonBits=function(t){var n=new ug(this._commonCoord);t.apply(n),t.geometryChanged()};lg.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var n=new Ot(this._commonCoord);n.x=-n.x,n.y=-n.y;var r=new ug(n);return t.apply(r),t.geometryChanged(),t};lg.prototype.getCommonCoordinate=function(){return this._commonCoord};lg.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};lg.prototype.interfaces_=function(){return[]};lg.prototype.getClass=function(){return lg};uP.CommonCoordinateFilter.get=function(){return tv};uP.Translater.get=function(){return ug};Object.defineProperties(lg,uP);var tv=function(){this._commonBitsX=new Ga,this._commonBitsY=new Ga};tv.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};tv.prototype.getCommonCoordinate=function(){return new Ot(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};tv.prototype.interfaces_=function(){return[lf]};tv.prototype.getClass=function(){return tv};var ug=function(){this.trans=null;var t=arguments[0];this.trans=t};ug.prototype.filter=function(t,n){var r=t.getOrdinate(n,0)+this.trans.x,a=t.getOrdinate(n,1)+this.trans.y;t.setOrdinate(n,0,r),t.setOrdinate(n,1,a)};ug.prototype.isDone=function(){return!1};ug.prototype.isGeometryChanged=function(){return!0};ug.prototype.interfaces_=function(){return[Yc]};ug.prototype.getClass=function(){return ug};var zs=function(t,n){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=n,this.computeSnapTolerance()};zs.prototype.selfSnap=function(t){var n=new qo(t),r=n.snapTo(t,this._snapTolerance);return r};zs.prototype.removeCommonBits=function(t){this._cbr=new lg,this._cbr.add(t[0]),this._cbr.add(t[1]);var n=new Array(2).fill(null);return n[0]=this._cbr.removeCommonBits(t[0].copy()),n[1]=this._cbr.removeCommonBits(t[1].copy()),n};zs.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};zs.prototype.getResultGeometry=function(t){var n=this.snap(this._geom),r=Ur.overlayOp(n[0],n[1],t);return this.prepareResult(r)};zs.prototype.checkValid=function(t){t.isValid()||ta.out.println("Snapped geometry is invalid")};zs.prototype.computeSnapTolerance=function(){this._snapTolerance=qo.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};zs.prototype.snap=function(t){var n=this.removeCommonBits(t),r=qo.snap(n[0],n[1],this._snapTolerance);return r};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};zs.overlayOp=function(t,n,r){var a=new zs(t,n);return a.getResultGeometry(r)};zs.union=function(t,n){return zs.overlayOp(t,n,Ur.UNION)};zs.intersection=function(t,n){return zs.overlayOp(t,n,Ur.INTERSECTION)};zs.symDifference=function(t,n){return zs.overlayOp(t,n,Ur.SYMDIFFERENCE)};zs.difference=function(t,n){return zs.overlayOp(t,n,Ur.DIFFERENCE)};var Ja=function(t,n){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=n};Ja.prototype.getResultGeometry=function(t){var n=null,r=!1,a=null;try{n=Ur.overlayOp(this._geom[0],this._geom[1],t);var u=!0;u&&(r=!0)}catch(p){if(p instanceof Lp)a=p;else throw p}finally{}if(!r)try{n=zs.overlayOp(this._geom[0],this._geom[1],t)}catch(p){throw p instanceof Lp?a:p}finally{}return n};Ja.prototype.interfaces_=function(){return[]};Ja.prototype.getClass=function(){return Ja};Ja.overlayOp=function(t,n,r){var a=new Ja(t,n);return a.getResultGeometry(r)};Ja.union=function(t,n){return Ja.overlayOp(t,n,Ur.UNION)};Ja.intersection=function(t,n){return Ja.overlayOp(t,n,Ur.INTERSECTION)};Ja.symDifference=function(t,n){return Ja.overlayOp(t,n,Ur.SYMDIFFERENCE)};Ja.difference=function(t,n){return Ja.overlayOp(t,n,Ur.DIFFERENCE)};var ab=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],n=arguments[1];this.mce=t,this.chainIndex=n};ab.prototype.computeIntersections=function(t,n){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,n)};ab.prototype.interfaces_=function(){return[]};ab.prototype.getClass=function(){return ab};var Xl=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=a,this._obj=u}},cP={INSERT:{configurable:!0},DELETE:{configurable:!0}};Xl.prototype.isDelete=function(){return this._eventType===Xl.DELETE};Xl.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};Xl.prototype.getObject=function(){return this._obj};Xl.prototype.compareTo=function(t){var n=t;return this._xValue<n._xValue?-1:this._xValue>n._xValue?1:this._eventType<n._eventType?-1:this._eventType>n._eventType?1:0};Xl.prototype.getInsertEvent=function(){return this._insertEvent};Xl.prototype.isInsert=function(){return this._eventType===Xl.INSERT};Xl.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};Xl.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Xl.prototype.interfaces_=function(){return[gc]};Xl.prototype.getClass=function(){return Xl};cP.INSERT.get=function(){return 1};cP.DELETE.get=function(){return 2};Object.defineProperties(Xl,cP);var eE=function(){};eE.prototype.interfaces_=function(){return[]};eE.prototype.getClass=function(){return eE};var oa=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._li=t,this._includeProper=n,this._recordIsolated=r};oa.prototype.isTrivialIntersection=function(t,n,r,a){if(t===r&&this._li.getIntersectionNum()===1){if(oa.isAdjacentSegments(n,a))return!0;if(t.isClosed()){var u=t.getNumPoints()-1;if(n===0&&a===u||a===0&&n===u)return!0}}return!1};oa.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};oa.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};oa.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};oa.prototype.isBoundaryPointInternal=function(t,n){for(var r=n.iterator();r.hasNext();){var a=r.next(),u=a.getCoordinate();if(t.isIntersection(u))return!0}return!1};oa.prototype.hasProperIntersection=function(){return this._hasProper};oa.prototype.hasIntersection=function(){return this._hasIntersection};oa.prototype.isDone=function(){return this._isDone};oa.prototype.isBoundaryPoint=function(t,n){return n===null?!1:!!(this.isBoundaryPointInternal(t,n[0])||this.isBoundaryPointInternal(t,n[1]))};oa.prototype.setBoundaryNodes=function(t,n){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=n};oa.prototype.addIntersections=function(t,n,r,a){if(t===r&&n===a)return null;this.numTests++;var u=t.getCoordinates()[n],p=t.getCoordinates()[n+1],i=r.getCoordinates()[a],b=r.getCoordinates()[a+1];this._li.computeIntersection(u,p,i,b),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,n,r,a)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,n,0),r.addIntersections(this._li,a,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};oa.isAdjacentSegments=function(t,n){return Math.abs(t-n)===1};var FQ=function(e){function t(){e.call(this),this.events=new In,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var r=this;Jc.sort(this.events);for(var a=0;a<this.events.size();a++){var u=r.events.get(a);u.isDelete()&&u.getInsertEvent().setDeleteEventIndex(a)}},t.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var a=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var u=0;u<this.events.size();u++){var p=r.events.get(u);if(p.isInsert()&&r.processOverlaps(u,p.getDeleteEventIndex(),p,a),a.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof oa&&xr(arguments[0],qc)&&xr(arguments[1],qc)){var i=arguments[0],b=arguments[1],C=arguments[2];this.addEdges(i,i),this.addEdges(b,b),this.computeIntersections(C)}else if(typeof arguments[2]=="boolean"&&xr(arguments[0],qc)&&arguments[1]instanceof oa){var A=arguments[0],R=arguments[1],z=arguments[2];z?this.addEdges(A,null):this.addEdges(A),this.computeIntersections(R)}}},t.prototype.addEdge=function(r,a){for(var u=this,p=r.getMonotoneChainEdge(),i=p.getStartIndexes(),b=0;b<i.length-1;b++){var C=new ab(p,b),A=new Xl(a,p.getMinX(b),C);u.events.add(A),u.events.add(new Xl(p.getMaxX(b),A))}},t.prototype.processOverlaps=function(r,a,u,p){for(var i=this,b=u.getObject(),C=r;C<a;C++){var A=i.events.get(C);if(A.isInsert()){var R=A.getObject();u.isSameLabel(A)||(b.computeIntersections(R,p),i.nOverlaps++)}}},t.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var a=arguments[0],u=a.iterator();u.hasNext();){var p=u.next();r.addEdge(p,p)}else if(arguments.length===2)for(var i=arguments[0],b=arguments[1],C=i.iterator();C.hasNext();){var A=C.next();r.addEdge(A,b)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(eE),mf=function(){this._min=Dr.POSITIVE_INFINITY,this._max=Dr.NEGATIVE_INFINITY},y5={NodeComparator:{configurable:!0}};mf.prototype.getMin=function(){return this._min};mf.prototype.intersects=function(t,n){return!(this._min>n||this._max<t)};mf.prototype.getMax=function(){return this._max};mf.prototype.toString=function(){return Zc.toLineString(new Ot(this._min,0),new Ot(this._max,0))};mf.prototype.interfaces_=function(){return[]};mf.prototype.getClass=function(){return mf};y5.NodeComparator.get=function(){return lb};Object.defineProperties(mf,y5);var lb=function(){};lb.prototype.compare=function(t,n){var r=t,a=n,u=(r._min+r._max)/2,p=(a._min+a._max)/2;return u<p?-1:u>p?1:0};lb.prototype.interfaces_=function(){return[A0]};lb.prototype.getClass=function(){return lb};var zQ=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],r=arguments[1],a=arguments[2];this._min=n,this._max=r,this._item=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(r,a,u){if(!this.intersects(r,a))return null;u.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(mf),BQ=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(r,a){this._min=Math.min(r._min,a._min),this._max=Math.max(r._max,a._max)},t.prototype.query=function(r,a,u){if(!this.intersects(r,a))return null;this._node1!==null&&this._node1.query(r,a,u),this._node2!==null&&this._node2.query(r,a,u)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(mf),gf=function(){this._leaves=new In,this._root=null,this._level=0};gf.prototype.buildTree=function(){var t=this;Jc.sort(this._leaves,new mf.NodeComparator);for(var n=this._leaves,r=null,a=new In;;){if(t.buildLevel(n,a),a.size()===1)return a.get(0);r=n,n=a,a=r}};gf.prototype.insert=function(t,n,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new zQ(t,n,r))};gf.prototype.query=function(t,n,r){this.init(),this._root.query(t,n,r)};gf.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};gf.prototype.printNode=function(t){ta.out.println(Zc.toLineString(new Ot(t._min,this._level),new Ot(t._max,this._level)))};gf.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};gf.prototype.buildLevel=function(t,n){this._level++,n.clear();for(var r=0;r<t.size();r+=2){var a=t.get(r),u=r+1<t.size()?t.get(r):null;if(u===null)n.add(a);else{var p=new BQ(t.get(r),t.get(r+1));n.add(p)}}};gf.prototype.interfaces_=function(){return[]};gf.prototype.getClass=function(){return gf};var G0=function(){this._items=new In};G0.prototype.visitItem=function(t){this._items.add(t)};G0.prototype.getItems=function(){return this._items};G0.prototype.interfaces_=function(){return[ng]};G0.prototype.getClass=function(){return G0};var $0=function(){this._index=null;var t=arguments[0];if(!xr(t,tg))throw new po("Argument must be Polygonal");this._index=new N_(t)},hP={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};$0.prototype.locate=function(t){var n=new Xh(t),r=new q0(n);return this._index.query(t.y,t.y,r),n.getLocation()};$0.prototype.interfaces_=function(){return[V0]};$0.prototype.getClass=function(){return $0};hP.SegmentVisitor.get=function(){return q0};hP.IntervalIndexedGeometry.get=function(){return N_};Object.defineProperties($0,hP);var q0=function(){this._counter=null;var t=arguments[0];this._counter=t};q0.prototype.visitItem=function(t){var n=t;this._counter.countSegment(n.getCoordinate(0),n.getCoordinate(1))};q0.prototype.interfaces_=function(){return[ng]};q0.prototype.getClass=function(){return q0};var N_=function(){this._index=new gf;var t=arguments[0];this.init(t)};N_.prototype.init=function(t){for(var n=this,r=Js.getLines(t),a=r.iterator();a.hasNext();){var u=a.next(),p=u.getCoordinates();n.addLine(p)}};N_.prototype.addLine=function(t){for(var n=this,r=1;r<t.length;r++){var a=new rr(t[r-1],t[r]),u=Math.min(a.p0.y,a.p1.y),p=Math.max(a.p0.y,a.p1.y);n._index.insert(u,p,a)}};N_.prototype.query=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],r=new G0;return this._index.query(t,n,r),r.getItems()}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];this._index.query(a,u,p)}};N_.prototype.interfaces_=function(){return[]};N_.prototype.getClass=function(){return N_};var S1=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new t5,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new eh,arguments.length===2){var n=arguments[0],r=arguments[1],a=hc.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=a,r!==null&&this.add(r)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],i=arguments[2];this._argIndex=u,this._parentGeom=p,this._boundaryNodeRule=i,p!==null&&this.add(p)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(r,a){var u=this._nodes.addNode(a),p=u.getLabel(),i=1,b=zt.NONE;b=p.getLocation(r,bn.ON),b===zt.BOUNDARY&&i++;var C=t.determineBoundary(this._boundaryNodeRule,i);p.setLocation(r,C)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.computeSelfNodes(r,a,!1)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],i=arguments[2],b=new oa(u,!0,!1);b.setIsDoneIfProperInt(i);var C=this.createEdgeSetIntersector(),A=this._parentGeom instanceof uf||this._parentGeom instanceof gs||this._parentGeom instanceof Qd,R=p||!A;return C.computeIntersections(this._edges,b,R),this.addSelfIntersectionNodes(this._argIndex),b}},t.prototype.computeSplitEdges=function(r){for(var a=this._edges.iterator();a.hasNext();){var u=a.next();u.eiList.addSplitEdges(r)}},t.prototype.computeEdgeIntersections=function(r,a,u){var p=new oa(a,u,!0);p.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var i=this.createEdgeSetIntersector();return i.computeIntersections(this._edges,r._edges,p),p},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof ql){var r=arguments[0],a=r.getCoordinate();this.insertPoint(this._argIndex,a,zt.INTERIOR)}else if(arguments[0]instanceof Ot){var u=arguments[0];this.insertPoint(this._argIndex,u,zt.INTERIOR)}},t.prototype.addPolygon=function(r){var a=this;this.addPolygonRing(r.getExteriorRing(),zt.EXTERIOR,zt.INTERIOR);for(var u=0;u<r.getNumInteriorRing();u++){var p=r.getInteriorRingN(u);a.addPolygonRing(p,zt.INTERIOR,zt.EXTERIOR)}},t.prototype.addEdge=function(r){this.insertEdge(r);var a=r.getCoordinates();this.insertPoint(this._argIndex,a[0],zt.BOUNDARY),this.insertPoint(this._argIndex,a[a.length-1],zt.BOUNDARY)},t.prototype.addLineString=function(r){var a=ni.removeRepeatedPoints(r.getCoordinates());if(a.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var u=new QS(a,new Ni(this._argIndex,zt.INTERIOR));this._lineEdgeMap.put(r,u),this.insertEdge(u),qr.isTrue(a.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,a[0]),this.insertBoundaryPoint(this._argIndex,a[a.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),a=new Array(r.size()).fill(null),u=0,p=r.iterator();p.hasNext();){var i=p.next();a[u++]=i.getCoordinate().copy()}return a},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(r,a,u){if(this.isBoundaryNode(r,a))return null;u===zt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,a):this.insertPoint(r,a,u)},t.prototype.addPolygonRing=function(r,a,u){if(r.isEmpty())return null;var p=ni.removeRepeatedPoints(r.getCoordinates());if(p.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=p[0],null;var i=a,b=u;On.isCCW(p)&&(i=u,b=a);var C=new QS(p,new Ni(this._argIndex,zt.BOUNDARY,i,b));this._lineEdgeMap.put(r,C),this.insertEdge(C),this.insertPoint(this._argIndex,p[0],zt.BOUNDARY)},t.prototype.insertPoint=function(r,a,u){var p=this._nodes.addNode(a),i=p.getLabel();i===null?p._label=new Ni(r,u):i.setLocation(r,u)},t.prototype.createEdgeSetIntersector=function(){return new FQ},t.prototype.addSelfIntersectionNodes=function(r){for(var a=this,u=this._edges.iterator();u.hasNext();)for(var p=u.next(),i=p.getLabel().getLocation(r),b=p.eiList.iterator();b.hasNext();){var C=b.next();a.addSelfIntersectionNode(r,C.coord,i)}},t.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof Qd&&(this._useBoundaryDeterminationRule=!1),r instanceof gs)this.addPolygon(r);else if(r instanceof Fo)this.addLineString(r);else if(r instanceof ql)this.addPoint(r);else if(r instanceof F0)this.addCollection(r);else if(r instanceof M_)this.addCollection(r);else if(r instanceof Qd)this.addCollection(r);else if(r instanceof Za)this.addCollection(r);else throw new Error(r.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(r){for(var a=this,u=0;u<r.getNumGeometries();u++){var p=r.getGeometryN(u);a.add(p)}},t.prototype.locate=function(r){return xr(this._parentGeom,tg)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new $0(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(r,a){return r.isInBoundary(a)?zt.BOUNDARY:zt.INTERIOR},t}(Eo),H0=function(){if(this._li=new G_,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new S1(0,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=hc.OGC_SFS_BOUNDARY_RULE;n.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new S1(0,n,a),this._arg[1]=new S1(1,r,a)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],i=arguments[2];u.getPrecisionModel().compareTo(p.getPrecisionModel())>=0?this.setComputationPrecision(u.getPrecisionModel()):this.setComputationPrecision(p.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new S1(0,u,i),this._arg[1]=new S1(1,p,i)}};H0.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};H0.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};H0.prototype.interfaces_=function(){return[]};H0.prototype.getClass=function(){return H0};var x_=function(){};x_.prototype.interfaces_=function(){return[]};x_.prototype.getClass=function(){return x_};x_.map=function(){if(arguments[0]instanceof yr&&xr(arguments[1],x_.MapOp)){for(var t=arguments[0],n=arguments[1],r=new In,a=0;a<t.getNumGeometries();a++){var u=n.map(t.getGeometryN(a));u!==null&&r.add(u)}return t.getFactory().buildGeometry(r)}else if(xr(arguments[0],ds)&&xr(arguments[1],x_.MapOp)){for(var p=arguments[0],i=arguments[1],b=new In,C=p.iterator();C.hasNext();){var A=C.next(),R=i.map(A);R!==null&&b.add(R)}return b}};x_.MapOp=function(){};var Ur=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r),this._ptLocator=new eh,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Qc,this._resultPolyList=new In,this._resultLineList=new In,this._resultPointList=new In,this._graph=new Eo(new u5),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(r){var a=this._edgeList.findEqualEdge(r);if(a!==null){var u=a.getLabel(),p=r.getLabel();a.isPointwiseEqual(r)||(p=new Ni(r.getLabel()),p.flip());var i=a.getDepth();i.isNull()&&i.add(u),i.add(p),u.merge(p)}else this._edgeList.add(r)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var a=r.next(),u=a.getSym();a.isInResult()&&u.isInResult()&&(a.setInResult(!1),u.setInResult(!1))}},t.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},t.prototype.computeGeometry=function(r,a,u,p){var i=new In;return i.addAll(r),i.addAll(a),i.addAll(u),i.isEmpty()?t.createEmptyResult(p,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(i)},t.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next();a.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(r,a){for(var u=this,p=a.iterator();p.hasNext();){var i=p.next(),b=u._ptLocator.locate(r,i);if(b!==zt.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var r=new In,a=this._edgeList.iterator();a.hasNext();){var u=a.next();u.isCollapsed()&&(a.remove(),r.add(u.getCollapsedEdge()))}this._edgeList.addAll(r)},t.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next(),u=a.getEdges().getLabel();a.getLabel().merge(u)}},t.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},t.prototype.insertUniqueEdges=function(r){for(var a=this,u=r.iterator();u.hasNext();){var p=u.next();a.insertUniqueEdge(p)}},t.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var a=new In;this._arg[0].computeSplitEdges(a),this._arg[1].computeSplitEdges(a),this.insertUniqueEdges(a),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),D_.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var u=new Hl(this._geomFact);u.add(this._graph),this._resultPolyList=u.getPolygons();var p=new hd(this,this._geomFact,this._ptLocator);this._resultLineList=p.build(r);var i=new ev(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},t.prototype.labelIncompleteNode=function(r,a){var u=this._ptLocator.locate(r.getCoordinate(),this._arg[a].getGeometry());r.getLabel().setLocation(a,u)},t.prototype.copyPoints=function(r){for(var a=this,u=this._arg[r].getNodeIterator();u.hasNext();){var p=u.next(),i=a._graph.addNode(p.getCoordinate());i.setLabel(r,p.getLabel().getLocation(r))}},t.prototype.findResultAreaEdges=function(r){for(var a=this._graph.getEdgeEnds().iterator();a.hasNext();){var u=a.next(),p=u.getLabel();p.isArea()&&!u.isInteriorAreaEdge()&&t.isResultOfOp(p.getLocation(0,bn.RIGHT),p.getLocation(1,bn.RIGHT),r)&&u.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var a=r.next(),u=a.getLabel(),p=a.getDepth();if(!p.isNull()){p.normalize();for(var i=0;i<2;i++)!u.isNull(i)&&u.isArea()&&!p.isNull(i)&&(p.getDelta(i)===0?u.toLine(i):(qr.isTrue(!p.isNull(i,bn.LEFT),"depth of LEFT side has not been initialized"),u.setLocation(i,bn.LEFT,p.getLocation(i,bn.LEFT)),qr.isTrue(!p.isNull(i,bn.RIGHT),"depth of RIGHT side has not been initialized"),u.setLocation(i,bn.RIGHT,p.getLocation(i,bn.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var r=this,a=this._graph.getNodes().iterator();a.hasNext();){var u=a.next();u.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var r=this,a=this._graph.getNodes().iterator();a.hasNext();){var u=a.next(),p=u.getLabel();u.isIsolated()&&(p.isNull(0)?r.labelIncompleteNode(u,0):r.labelIncompleteNode(u,1)),u.getEdges().updateLabelling(p)}},t.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(H0);Ur.overlayOp=function(e,t,n){var r=new Ur(e,t),a=r.getResultGeometry(n);return a};Ur.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return Ur.createEmptyResult(Ur.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return Qy.map(e,{interfaces_:function(){return[x_.MapOp]},map:function(r){return r.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ja.overlayOp(e,t,Ur.INTERSECTION)};Ur.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ur.createEmptyResult(Ur.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ja.overlayOp(e,t,Ur.SYMDIFFERENCE)};Ur.resultDimension=function(e,t,n){var r=t.getDimension(),a=n.getDimension(),u=-1;switch(e){case Ur.INTERSECTION:u=Math.min(r,a);break;case Ur.UNION:u=Math.max(r,a);break;case Ur.DIFFERENCE:u=r;break;case Ur.SYMDIFFERENCE:u=Math.max(r,a);break}return u};Ur.createEmptyResult=function(e,t,n,r){var a=null;switch(Ur.resultDimension(e,t,n)){case-1:a=r.createGeometryCollection(new Array(0).fill(null));break;case 0:a=r.createPoint();break;case 1:a=r.createLineString();break;case 2:a=r.createPolygon();break}return a};Ur.difference=function(e,t){return e.isEmpty()?Ur.createEmptyResult(Ur.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ja.overlayOp(e,t,Ur.DIFFERENCE))};Ur.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return Ur.isResultOfOp(n,r,t)}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];switch(a===zt.BOUNDARY&&(a=zt.INTERIOR),u===zt.BOUNDARY&&(u=zt.INTERIOR),p){case Ur.INTERSECTION:return a===zt.INTERIOR&&u===zt.INTERIOR;case Ur.UNION:return a===zt.INTERIOR||u===zt.INTERIOR;case Ur.DIFFERENCE:return a===zt.INTERIOR&&u!==zt.INTERIOR;case Ur.SYMDIFFERENCE:return a===zt.INTERIOR&&u!==zt.INTERIOR||a!==zt.INTERIOR&&u===zt.INTERIOR}return!1}};Ur.INTERSECTION=1;Ur.UNION=2;Ur.DIFFERENCE=3;Ur.SYMDIFFERENCE=4;var Ym=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new eh,this._seg=new rr;var t=arguments[0],n=arguments[1];this._g=t,this._boundaryDistanceTolerance=n,this._linework=this.extractLinework(t)};Ym.prototype.isWithinToleranceOfBoundary=function(t){for(var n=this,r=0;r<this._linework.getNumGeometries();r++)for(var a=n._linework.getGeometryN(r),u=a.getCoordinateSequence(),p=0;p<u.size()-1;p++){u.getCoordinate(p,n._seg.p0),u.getCoordinate(p+1,n._seg.p1);var i=n._seg.distance(t);if(i<=n._boundaryDistanceTolerance)return!0}return!1};Ym.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?zt.BOUNDARY:this._ptLocator.locate(t,this._g)};Ym.prototype.extractLinework=function(t){var n=new W0;t.apply(n);var r=n.getLinework(),a=ti.toLineStringArray(r);return t.getFactory().createMultiLineString(a)};Ym.prototype.interfaces_=function(){return[]};Ym.prototype.getClass=function(){return Ym};var W0=function(){this._linework=null,this._linework=new In};W0.prototype.getLinework=function(){return this._linework};W0.prototype.filter=function(t){var n=this;if(t instanceof gs){var r=t;this._linework.add(r.getExteriorRing());for(var a=0;a<r.getNumInteriorRing();a++)n._linework.add(r.getInteriorRingN(a))}};W0.prototype.interfaces_=function(){return[id]};W0.prototype.getClass=function(){return W0};var k_=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};k_.prototype.extractPoints=function(t,n,r){for(var a=this,u=t.getCoordinates(),p=0;p<u.length-1;p++)a.computeOffsetPoints(u[p],u[p+1],n,r)};k_.prototype.setSidesToGenerate=function(t,n){this._doLeft=t,this._doRight=n};k_.prototype.getPoints=function(t){for(var n=this,r=new In,a=Js.getLines(this._g),u=a.iterator();u.hasNext();){var p=u.next();n.extractPoints(p,t,r)}return r};k_.prototype.computeOffsetPoints=function(t,n,r,a){var u=n.x-t.x,p=n.y-t.y,i=Math.sqrt(u*u+p*p),b=r*u/i,C=r*p/i,A=(n.x+t.x)/2,R=(n.y+t.y)/2;if(this._doLeft){var z=new Ot(A-C,R+b);a.add(z)}if(this._doRight){var V=new Ot(A+C,R-b);a.add(V)}};k_.prototype.interfaces_=function(){return[]};k_.prototype.getClass=function(){return k_};var Ru=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new In;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,r],this._locFinder=[new Ym(this._geom[0],this._boundaryDistanceTolerance),new Ym(this._geom[1],this._boundaryDistanceTolerance),new Ym(this._geom[2],this._boundaryDistanceTolerance)]},v5={TOLERANCE:{configurable:!0}};Ru.prototype.reportResult=function(t,n,r){ta.out.println("Overlay result invalid - A:"+zt.toLocationSymbol(n[0])+" B:"+zt.toLocationSymbol(n[1])+" expected:"+(r?"i":"e")+" actual:"+zt.toLocationSymbol(n[2]))};Ru.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var n=this.checkValid(t);return n};Ru.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var n=arguments[0],r=0;r<this._testCoords.size();r++){var a=t._testCoords.get(r);if(!t.checkValid(n,a))return t._invalidLocation=a,!1}return!0}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return this._location[0]=this._locFinder[0].getLocation(p),this._location[1]=this._locFinder[1].getLocation(p),this._location[2]=this._locFinder[2].getLocation(p),Ru.hasLocation(this._location,zt.BOUNDARY)?!0:this.isValidResult(u,this._location)}};Ru.prototype.addTestPts=function(t){var n=new k_(t);this._testCoords.addAll(n.getPoints(5*this._boundaryDistanceTolerance))};Ru.prototype.isValidResult=function(t,n){var r=Ur.isResultOfOp(n[0],n[1],t),a=n[2]===zt.INTERIOR,u=!(r^a);return u||this.reportResult(t,n,r),u};Ru.prototype.getInvalidLocation=function(){return this._invalidLocation};Ru.prototype.interfaces_=function(){return[]};Ru.prototype.getClass=function(){return Ru};Ru.hasLocation=function(t,n){for(var r=0;r<3;r++)if(t[r]===n)return!0;return!1};Ru.computeBoundaryDistanceTolerance=function(t,n){return Math.min(qo.computeSizeBasedSnapTolerance(t),qo.computeSizeBasedSnapTolerance(n))};Ru.isValid=function(t,n,r,a){var u=new Ru(t,n,a);return u.isValid(r)};v5.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Ru,v5);var bu=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};bu.prototype.extractElements=function(t,n){var r=this;if(t===null)return null;for(var a=0;a<t.getNumGeometries();a++){var u=t.getGeometryN(a);r._skipEmpty&&u.isEmpty()||n.add(u)}};bu.prototype.combine=function(){for(var t=this,n=new In,r=this._inputGeoms.iterator();r.hasNext();){var a=r.next();t.extractElements(a,n)}return n.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(n)};bu.prototype.interfaces_=function(){return[]};bu.prototype.getClass=function(){return bu};bu.combine=function(){if(arguments.length===1){var t=arguments[0],n=new bu(t);return n.combine()}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u=new bu(bu.createList(r,a));return u.combine()}else if(arguments.length===3){var p=arguments[0],i=arguments[1],b=arguments[2],C=new bu(bu.createList(p,i,b));return C.combine()}};bu.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};bu.createList=function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],r=new In;return r.add(t),r.add(n),r}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2],i=new In;return i.add(a),i.add(u),i.add(p),i}};var ss=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new In)},x5={STRTREE_NODE_CAPACITY:{configurable:!0}};ss.prototype.reduceToGeometries=function(t){for(var n=this,r=new In,a=t.iterator();a.hasNext();){var u=a.next(),p=null;xr(u,qc)?p=n.unionTree(u):u instanceof yr&&(p=u),r.add(p)}return r};ss.prototype.extractByEnvelope=function(t,n,r){for(var a=new In,u=0;u<n.getNumGeometries();u++){var p=n.getGeometryN(u);p.getEnvelopeInternal().intersects(t)?a.add(p):r.add(p)}return this._geomFactory.buildGeometry(a)};ss.prototype.unionOptimized=function(t,n){var r=t.getEnvelopeInternal(),a=n.getEnvelopeInternal();if(!r.intersects(a)){var u=bu.combine(t,n);return u}if(t.getNumGeometries()<=1&&n.getNumGeometries()<=1)return this.unionActual(t,n);var p=r.intersection(a);return this.unionUsingEnvelopeIntersection(t,n,p)};ss.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new o5(ss.STRTREE_NODE_CAPACITY),n=this._inputPolys.iterator();n.hasNext();){var r=n.next();t.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var a=t.itemsTree(),u=this.unionTree(a);return u};ss.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];if(a-r<=1){var u=ss.getGeometry(n,r);return this.unionSafe(u,null)}else{if(a-r===2)return this.unionSafe(ss.getGeometry(n,r),ss.getGeometry(n,r+1));var p=Math.trunc((a+r)/2),i=this.binaryUnion(n,r,p),b=this.binaryUnion(n,p,a);return this.unionSafe(i,b)}}};ss.prototype.repeatedUnion=function(t){for(var n=null,r=t.iterator();r.hasNext();){var a=r.next();n===null?n=a.copy():n=n.union(a)}return n};ss.prototype.unionSafe=function(t,n){return t===null&&n===null?null:t===null?n.copy():n===null?t.copy():this.unionOptimized(t,n)};ss.prototype.unionActual=function(t,n){return ss.restrictToPolygons(t.union(n))};ss.prototype.unionTree=function(t){var n=this.reduceToGeometries(t),r=this.binaryUnion(n);return r};ss.prototype.unionUsingEnvelopeIntersection=function(t,n,r){var a=new In,u=this.extractByEnvelope(r,t,a),p=this.extractByEnvelope(r,n,a),i=this.unionActual(u,p);a.add(i);var b=bu.combine(a);return b};ss.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],n=t.get(0).getFactory(),r=n.buildGeometry(t),a=r.buffer(0);return a}else if(arguments.length===2){var u=arguments[0],p=arguments[1],i=u.getFactory(),b=i.createGeometryCollection([u,p]),C=b.buffer(0);return C}};ss.prototype.interfaces_=function(){return[]};ss.prototype.getClass=function(){return ss};ss.restrictToPolygons=function(t){if(xr(t,tg))return t;var n=Ap.getPolygons(t);return n.size()===1?n.get(0):t.getFactory().createMultiPolygon(ti.toPolygonArray(n))};ss.getGeometry=function(t,n){return n>=t.size()?null:t.get(n)};ss.union=function(t){var n=new ss(t);return n.union()};x5.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(ss,x5);var tE=function(){};tE.prototype.interfaces_=function(){return[]};tE.prototype.getClass=function(){return tE};tE.union=function(t,n){if(t.isEmpty()||n.isEmpty()){if(t.isEmpty()&&n.isEmpty())return Ur.createEmptyResult(Ur.UNION,t,n,t.getFactory());if(t.isEmpty())return n.copy();if(n.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(n),Ja.overlayOp(t,n,Ur.UNION)};function $_(){return new nE}function nE(){this.reset()}nE.prototype={constructor:nE,reset:function(){this.s=this.t=0},add:function(e){iN(iS,e,this.t),iN(this,iS.s,this.s),this.s?this.t+=iS.t:this.s=iS.t},valueOf:function(){return this.s}};var iS=new nE;function iN(e,t,n){var r=e.s=t+n,a=r-t,u=r-a;e.t=t-u+(n-a)}var is=1e-6,$i=Math.PI,wp=$i/2,oN=$i/4,Fp=$i*2,h_=180/$i,Bh=$i/180,Ha=Math.abs,jQ=Math.atan,X0=Math.atan2,fs=Math.cos,ps=Math.sin,Sx=Math.sqrt;function b5(e){return e>1?0:e<-1?$i:Math.acos(e)}function nv(e){return e>1?wp:e<-1?-wp:Math.asin(e)}function k1(){}function rE(e,t){e&&aN.hasOwnProperty(e.type)&&aN[e.type](e,t)}var sN={Feature:function(e,t){rE(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,a=n.length;++r<a;)rE(n[r].geometry,t)}},aN={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,a=n.length;++r<a;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){m2(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,a=n.length;++r<a;)m2(n[r],t,0)},Polygon:function(e,t){lN(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,a=n.length;++r<a;)lN(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,a=n.length;++r<a;)rE(n[r],t)}};function m2(e,t,n){var r=-1,a=e.length-n,u;for(t.lineStart();++r<a;)u=e[r],t.point(u[0],u[1],u[2]);t.lineEnd()}function lN(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)m2(e[n],t,1);t.polygonEnd()}function VQ(e,t){e&&sN.hasOwnProperty(e.type)?sN[e.type](e,t):rE(e,t)}$_();$_();function g2(e){return[X0(e[1],e[0]),nv(e[2])]}function Z0(e){var t=e[0],n=e[1],r=fs(n);return[r*fs(t),r*ps(t),ps(n)]}function oS(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function iE(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function oI(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function sS(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function _2(e){var t=Sx(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}$_();function w5(e,t){function n(r,a){return r=e(r,a),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,a){return r=t.invert(r,a),r&&e.invert(r[0],r[1])}),n}function y2(e,t){return[e>$i?e-Fp:e<-$i?e+Fp:e,t]}y2.invert=y2;function UQ(e,t,n){return(e%=Fp)?t||n?w5(cN(e),hN(t,n)):cN(e):t||n?hN(t,n):y2}function uN(e){return function(t,n){return t+=e,[t>$i?t-Fp:t<-$i?t+Fp:t,n]}}function cN(e){var t=uN(e);return t.invert=uN(-e),t}function hN(e,t){var n=fs(e),r=ps(e),a=fs(t),u=ps(t);function p(i,b){var C=fs(b),A=fs(i)*C,R=ps(i)*C,z=ps(b),V=z*n+A*r;return[X0(R*a-V*u,A*n-z*r),nv(V*a+R*u)]}return p.invert=function(i,b){var C=fs(b),A=fs(i)*C,R=ps(i)*C,z=ps(b),V=z*a-R*u;return[X0(R*a+z*u,A*n+V*r),nv(V*n-A*r)]},p}function GQ(e,t,n,r,a,u){if(n){var p=fs(t),i=ps(t),b=r*n;a==null?(a=t+r*Fp,u=t-b/2):(a=dN(p,a),u=dN(p,u),(r>0?a<u:a>u)&&(a+=r*Fp));for(var C,A=a;r>0?A>u:A<u;A-=b)C=g2([p,-i*fs(A),-i*ps(A)]),e.point(C[0],C[1])}}function dN(e,t){t=Z0(t),t[0]-=e,_2(t);var n=b5(-t[1]);return((-t[2]<0?-n:n)+Fp-is)%Fp}function S5(){var e=[],t;return{point:function(n,r){t.push([n,r])},lineStart:function(){e.push(t=[])},lineEnd:k1,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function $Q(e,t,n,r,a,u){var p=e[0],i=e[1],b=t[0],C=t[1],A=0,R=1,z=b-p,V=C-i,W;if(W=n-p,!(!z&&W>0)){if(W/=z,z<0){if(W<A)return;W<R&&(R=W)}else if(z>0){if(W>R)return;W>A&&(A=W)}if(W=a-p,!(!z&&W<0)){if(W/=z,z<0){if(W>R)return;W>A&&(A=W)}else if(z>0){if(W<A)return;W<R&&(R=W)}if(W=r-i,!(!V&&W>0)){if(W/=V,V<0){if(W<A)return;W<R&&(R=W)}else if(V>0){if(W>R)return;W>A&&(A=W)}if(W=u-i,!(!V&&W<0)){if(W/=V,V<0){if(W>R)return;W>A&&(A=W)}else if(V>0){if(W<A)return;W<R&&(R=W)}return A>0&&(e[0]=p+A*z,e[1]=i+A*V),R<1&&(t[0]=p+R*z,t[1]=i+R*V),!0}}}}}function TS(e,t){return Ha(e[0]-t[0])<is&&Ha(e[1]-t[1])<is}function aS(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function E5(e,t,n,r,a){var u=[],p=[],i,b;if(e.forEach(function(W){if(!((X=W.length-1)<=0)){var X,ue=W[0],ie=W[X],K;if(TS(ue,ie)){for(a.lineStart(),i=0;i<X;++i)a.point((ue=W[i])[0],ue[1]);a.lineEnd();return}u.push(K=new aS(ue,W,null,!0)),p.push(K.o=new aS(ue,null,K,!1)),u.push(K=new aS(ie,W,null,!1)),p.push(K.o=new aS(ie,null,K,!0))}}),!!u.length){for(p.sort(t),fN(u),fN(p),i=0,b=p.length;i<b;++i)p[i].e=n=!n;for(var C=u[0],A,R;;){for(var z=C,V=!0;z.v;)if((z=z.n)===C)return;A=z.z,a.lineStart();do{if(z.v=z.o.v=!0,z.e){if(V)for(i=0,b=A.length;i<b;++i)a.point((R=A[i])[0],R[1]);else r(z.x,z.n.x,1,a);z=z.n}else{if(V)for(A=z.p.z,i=A.length-1;i>=0;--i)a.point((R=A[i])[0],R[1]);else r(z.x,z.p.x,-1,a);z=z.p}z=z.o,A=z.z,V=!V}while(!z.v);a.lineEnd()}}}function fN(e){if(t=e.length){for(var t,n=0,r=e[0],a;++n<t;)r.n=a=e[n],a.p=r,r=a;r.n=a=e[0],a.p=r}}function C5(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qQ(e){return e.length===1&&(e=HQ(e)),{left:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var u=r+a>>>1;e(t[u],n)<0?r=u+1:a=u}return r},right:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var u=r+a>>>1;e(t[u],n)>0?a=u:r=u+1}return r}}}function HQ(e){return function(t,n){return C5(e(t),n)}}qQ(C5);function T5(e){for(var t=e.length,n,r=-1,a=0,u,p;++r<t;)a+=e[r].length;for(u=new Array(a);--t>=0;)for(p=e[t],n=p.length;--n>=0;)u[--a]=p[n];return u}var lS=1e9,uS=-1e9;function WQ(e,t,n,r){function a(C,A){return e<=C&&C<=n&&t<=A&&A<=r}function u(C,A,R,z){var V=0,W=0;if(C==null||(V=p(C,R))!==(W=p(A,R))||b(C,A)<0^R>0)do z.point(V===0||V===3?e:n,V>1?r:t);while((V=(V+R+4)%4)!==W);else z.point(A[0],A[1])}function p(C,A){return Ha(C[0]-e)<is?A>0?0:3:Ha(C[0]-n)<is?A>0?2:1:Ha(C[1]-t)<is?A>0?1:0:A>0?3:2}function i(C,A){return b(C.x,A.x)}function b(C,A){var R=p(C,1),z=p(A,1);return R!==z?R-z:R===0?A[1]-C[1]:R===1?C[0]-A[0]:R===2?C[1]-A[1]:A[0]-C[0]}return function(C){var A=C,R=S5(),z,V,W,X,ue,ie,K,ee,ae,he,xe,ye={point:Se,lineStart:at,lineEnd:ot,polygonStart:Re,polygonEnd:De};function Se(Ze,Ve){a(Ze,Ve)&&A.point(Ze,Ve)}function je(){for(var Ze=0,Ve=0,mt=V.length;Ve<mt;++Ve)for(var We=V[Ve],tt=1,Dt=We.length,$e=We[0],Ke,gt,Yt=$e[0],Kt=$e[1];tt<Dt;++tt)Ke=Yt,gt=Kt,$e=We[tt],Yt=$e[0],Kt=$e[1],gt<=r?Kt>r&&(Yt-Ke)*(r-gt)>(Kt-gt)*(e-Ke)&&++Ze:Kt<=r&&(Yt-Ke)*(r-gt)<(Kt-gt)*(e-Ke)&&--Ze;return Ze}function Re(){A=R,z=[],V=[],xe=!0}function De(){var Ze=je(),Ve=xe&&Ze,mt=(z=T5(z)).length;(Ve||mt)&&(C.polygonStart(),Ve&&(C.lineStart(),u(null,null,1,C),C.lineEnd()),mt&&E5(z,i,Ze,u,C),C.polygonEnd()),A=C,z=V=W=null}function at(){ye.point=Fe,V&&V.push(W=[]),he=!0,ae=!1,K=ee=NaN}function ot(){z&&(Fe(X,ue),ie&&ae&&R.rejoin(),z.push(R.result())),ye.point=Se,ae&&A.lineEnd()}function Fe(Ze,Ve){var mt=a(Ze,Ve);if(V&&W.push([Ze,Ve]),he)X=Ze,ue=Ve,ie=mt,he=!1,mt&&(A.lineStart(),A.point(Ze,Ve));else if(mt&&ae)A.point(Ze,Ve);else{var We=[K=Math.max(uS,Math.min(lS,K)),ee=Math.max(uS,Math.min(lS,ee))],tt=[Ze=Math.max(uS,Math.min(lS,Ze)),Ve=Math.max(uS,Math.min(lS,Ve))];$Q(We,tt,e,t,n,r)?(ae||(A.lineStart(),A.point(We[0],We[1])),A.point(tt[0],tt[1]),mt||A.lineEnd(),xe=!1):mt&&(A.lineStart(),A.point(Ze,Ve),xe=!1)}K=Ze,ee=Ve,ae=mt}return ye}}var sI=$_();function XQ(e,t){var n=t[0],r=t[1],a=[ps(n),-fs(n),0],u=0,p=0;sI.reset();for(var i=0,b=e.length;i<b;++i)if(A=(C=e[i]).length)for(var C,A,R=C[A-1],z=R[0],V=R[1]/2+oN,W=ps(V),X=fs(V),ue=0;ue<A;++ue,z=K,W=ae,X=he,R=ie){var ie=C[ue],K=ie[0],ee=ie[1]/2+oN,ae=ps(ee),he=fs(ee),xe=K-z,ye=xe>=0?1:-1,Se=ye*xe,je=Se>$i,Re=W*ae;if(sI.add(X0(Re*ye*ps(Se),X*he+Re*fs(Se))),u+=je?xe+ye*Fp:xe,je^z>=n^K>=n){var De=iE(Z0(R),Z0(ie));_2(De);var at=iE(a,De);_2(at);var ot=(je^xe>=0?-1:1)*nv(at[2]);(r>ot||r===ot&&(De[0]||De[1]))&&(p+=je^xe>=0?1:-1)}}return(u<-1e-6||u<is&&sI<-1e-6)^p&1}$_();function pN(e){return e}$_();$_();var Y0=1/0,oE=Y0,ub=-Y0,sE=ub,mN={point:ZQ,lineStart:k1,lineEnd:k1,polygonStart:k1,polygonEnd:k1,result:function(){var e=[[Y0,oE],[ub,sE]];return ub=sE=-(oE=Y0=1/0),e}};function ZQ(e,t){e<Y0&&(Y0=e),e>ub&&(ub=e),t<oE&&(oE=t),t>sE&&(sE=t)}$_();function I5(e,t,n,r){return function(a,u){var p=t(u),i=a.invert(r[0],r[1]),b=S5(),C=t(b),A=!1,R,z,V,W={point:X,lineStart:ie,lineEnd:K,polygonStart:function(){W.point=ee,W.lineStart=ae,W.lineEnd=he,z=[],R=[]},polygonEnd:function(){W.point=X,W.lineStart=ie,W.lineEnd=K,z=T5(z);var xe=XQ(R,i);z.length?(A||(u.polygonStart(),A=!0),E5(z,KQ,xe,n,u)):xe&&(A||(u.polygonStart(),A=!0),u.lineStart(),n(null,null,1,u),u.lineEnd()),A&&(u.polygonEnd(),A=!1),z=R=null},sphere:function(){u.polygonStart(),u.lineStart(),n(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function X(xe,ye){var Se=a(xe,ye);e(xe=Se[0],ye=Se[1])&&u.point(xe,ye)}function ue(xe,ye){var Se=a(xe,ye);p.point(Se[0],Se[1])}function ie(){W.point=ue,p.lineStart()}function K(){W.point=X,p.lineEnd()}function ee(xe,ye){V.push([xe,ye]);var Se=a(xe,ye);C.point(Se[0],Se[1])}function ae(){C.lineStart(),V=[]}function he(){ee(V[0][0],V[0][1]),C.lineEnd();var xe=C.clean(),ye=b.result(),Se,je=ye.length,Re,De,at;if(V.pop(),R.push(V),V=null,!!je){if(xe&1){if(De=ye[0],(Re=De.length-1)>0){for(A||(u.polygonStart(),A=!0),u.lineStart(),Se=0;Se<Re;++Se)u.point((at=De[Se])[0],at[1]);u.lineEnd()}return}je>1&&xe&2&&ye.push(ye.pop().concat(ye.shift())),z.push(ye.filter(YQ))}}return W}}function YQ(e){return e.length>1}function KQ(e,t){return((e=e.x)[0]<0?e[1]-wp-is:wp-e[1])-((t=t.x)[0]<0?t[1]-wp-is:wp-t[1])}const gN=I5(function(){return!0},JQ,eee,[-$i,-wp]);function JQ(e){var t=NaN,n=NaN,r=NaN,a;return{lineStart:function(){e.lineStart(),a=1},point:function(u,p){var i=u>0?$i:-$i,b=Ha(u-t);Ha(b-$i)<is?(e.point(t,n=(n+p)/2>0?wp:-wp),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(i,n),e.point(u,n),a=0):r!==i&&b>=$i&&(Ha(t-r)<is&&(t-=r*is),Ha(u-i)<is&&(u-=i*is),n=QQ(t,n,u,p),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(i,n),a=0),e.point(t=u,n=p),r=i},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-a}}}function QQ(e,t,n,r){var a,u,p=ps(e-n);return Ha(p)>is?jQ((ps(t)*(u=fs(r))*ps(n)-ps(r)*(a=fs(t))*ps(e))/(a*u*p)):(t+r)/2}function eee(e,t,n,r){var a;if(e==null)a=n*wp,r.point(-$i,a),r.point(0,a),r.point($i,a),r.point($i,0),r.point($i,-a),r.point(0,-a),r.point(-$i,-a),r.point(-$i,0),r.point(-$i,a);else if(Ha(e[0]-t[0])>is){var u=e[0]<t[0]?$i:-$i;a=n*u/2,r.point(-u,a),r.point(0,a),r.point(u,a)}else r.point(t[0],t[1])}function tee(e,t){var n=fs(e),r=n>0,a=Ha(n)>is;function u(A,R,z,V){GQ(V,e,t,z,A,R)}function p(A,R){return fs(A)*fs(R)>n}function i(A){var R,z,V,W,X;return{lineStart:function(){W=V=!1,X=1},point:function(ue,ie){var K=[ue,ie],ee,ae=p(ue,ie),he=r?ae?0:C(ue,ie):ae?C(ue+(ue<0?$i:-$i),ie):0;if(!R&&(W=V=ae)&&A.lineStart(),ae!==V&&(ee=b(R,K),(!ee||TS(R,ee)||TS(K,ee))&&(K[0]+=is,K[1]+=is,ae=p(K[0],K[1]))),ae!==V)X=0,ae?(A.lineStart(),ee=b(K,R),A.point(ee[0],ee[1])):(ee=b(R,K),A.point(ee[0],ee[1]),A.lineEnd()),R=ee;else if(a&&R&&r^ae){var xe;!(he&z)&&(xe=b(K,R,!0))&&(X=0,r?(A.lineStart(),A.point(xe[0][0],xe[0][1]),A.point(xe[1][0],xe[1][1]),A.lineEnd()):(A.point(xe[1][0],xe[1][1]),A.lineEnd(),A.lineStart(),A.point(xe[0][0],xe[0][1])))}ae&&(!R||!TS(R,K))&&A.point(K[0],K[1]),R=K,V=ae,z=he},lineEnd:function(){V&&A.lineEnd(),R=null},clean:function(){return X|(W&&V)<<1}}}function b(A,R,z){var V=Z0(A),W=Z0(R),X=[1,0,0],ue=iE(V,W),ie=oS(ue,ue),K=ue[0],ee=ie-K*K;if(!ee)return!z&&A;var ae=n*ie/ee,he=-n*K/ee,xe=iE(X,ue),ye=sS(X,ae),Se=sS(ue,he);oI(ye,Se);var je=xe,Re=oS(ye,je),De=oS(je,je),at=Re*Re-De*(oS(ye,ye)-1);if(!(at<0)){var ot=Sx(at),Fe=sS(je,(-Re-ot)/De);if(oI(Fe,ye),Fe=g2(Fe),!z)return Fe;var Ze=A[0],Ve=R[0],mt=A[1],We=R[1],tt;Ve<Ze&&(tt=Ze,Ze=Ve,Ve=tt);var Dt=Ve-Ze,$e=Ha(Dt-$i)<is,Ke=$e||Dt<is;if(!$e&&We<mt&&(tt=mt,mt=We,We=tt),Ke?$e?mt+We>0^Fe[1]<(Ha(Fe[0]-Ze)<is?mt:We):mt<=Fe[1]&&Fe[1]<=We:Dt>$i^(Ze<=Fe[0]&&Fe[0]<=Ve)){var gt=sS(je,(-Re+ot)/De);return oI(gt,ye),[Fe,g2(gt)]}}}function C(A,R){var z=r?e:$i-e,V=0;return A<-z?V|=1:A>z&&(V|=2),R<-z?V|=4:R>z&&(V|=8),V}return I5(p,i,u,r?[0,-e]:[-$i,e-$i])}function M5(e){return function(t){var n=new v2;for(var r in e)n[r]=e[r];return n.stream=t,n}}function v2(){}v2.prototype={constructor:v2,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function P5(e,t,n){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],u=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),u!=null&&e.clipExtent(null),VQ(n,e.stream(mN));var p=mN.result(),i=Math.min(r/(p[1][0]-p[0][0]),a/(p[1][1]-p[0][1])),b=+t[0][0]+(r-i*(p[1][0]+p[0][0]))/2,C=+t[0][1]+(a-i*(p[1][1]+p[0][1]))/2;return u!=null&&e.clipExtent(u),e.scale(i*150).translate([b,C])}function nee(e,t,n){return P5(e,[[0,0],t],n)}var _N=16,ree=fs(30*Bh);function yN(e,t){return+t?oee(e,t):iee(e)}function iee(e){return M5({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function oee(e,t){function n(r,a,u,p,i,b,C,A,R,z,V,W,X,ue){var ie=C-r,K=A-a,ee=ie*ie+K*K;if(ee>4*t&&X--){var ae=p+z,he=i+V,xe=b+W,ye=Sx(ae*ae+he*he+xe*xe),Se=nv(xe/=ye),je=Ha(Ha(xe)-1)<is||Ha(u-R)<is?(u+R)/2:X0(he,ae),Re=e(je,Se),De=Re[0],at=Re[1],ot=De-r,Fe=at-a,Ze=K*ot-ie*Fe;(Ze*Ze/ee>t||Ha((ie*ot+K*Fe)/ee-.5)>.3||p*z+i*V+b*W<ree)&&(n(r,a,u,p,i,b,De,at,je,ae/=ye,he/=ye,xe,X,ue),ue.point(De,at),n(De,at,je,ae,he,xe,C,A,R,z,V,W,X,ue))}}return function(r){var a,u,p,i,b,C,A,R,z,V,W,X,ue={point:ie,lineStart:K,lineEnd:ae,polygonStart:function(){r.polygonStart(),ue.lineStart=he},polygonEnd:function(){r.polygonEnd(),ue.lineStart=K}};function ie(Se,je){Se=e(Se,je),r.point(Se[0],Se[1])}function K(){R=NaN,ue.point=ee,r.lineStart()}function ee(Se,je){var Re=Z0([Se,je]),De=e(Se,je);n(R,z,A,V,W,X,R=De[0],z=De[1],A=Se,V=Re[0],W=Re[1],X=Re[2],_N,r),r.point(R,z)}function ae(){ue.point=ie,r.lineEnd()}function he(){K(),ue.point=xe,ue.lineEnd=ye}function xe(Se,je){ee(a=Se,je),u=R,p=z,i=V,b=W,C=X,ue.point=ee}function ye(){n(R,z,A,V,W,X,u,p,a,i,b,C,_N,r),ue.lineEnd=ae,ae()}return ue}}var see=M5({point:function(e,t){this.stream.point(e*Bh,t*Bh)}});function aee(e){return lee(function(){return e})()}function lee(e){var t,n=150,r=480,a=250,u,p,i=0,b=0,C=0,A=0,R=0,z,V,W=null,X=gN,ue=null,ie,K,ee,ae=pN,he=.5,xe=yN(De,he),ye,Se;function je(Fe){return Fe=V(Fe[0]*Bh,Fe[1]*Bh),[Fe[0]*n+u,p-Fe[1]*n]}function Re(Fe){return Fe=V.invert((Fe[0]-u)/n,(p-Fe[1])/n),Fe&&[Fe[0]*h_,Fe[1]*h_]}function De(Fe,Ze){return Fe=t(Fe,Ze),[Fe[0]*n+u,p-Fe[1]*n]}je.stream=function(Fe){return ye&&Se===Fe?ye:ye=see(X(z,xe(ae(Se=Fe))))},je.clipAngle=function(Fe){return arguments.length?(X=+Fe?tee(W=Fe*Bh,6*Bh):(W=null,gN),ot()):W*h_},je.clipExtent=function(Fe){return arguments.length?(ae=Fe==null?(ue=ie=K=ee=null,pN):WQ(ue=+Fe[0][0],ie=+Fe[0][1],K=+Fe[1][0],ee=+Fe[1][1]),ot()):ue==null?null:[[ue,ie],[K,ee]]},je.scale=function(Fe){return arguments.length?(n=+Fe,at()):n},je.translate=function(Fe){return arguments.length?(r=+Fe[0],a=+Fe[1],at()):[r,a]},je.center=function(Fe){return arguments.length?(i=Fe[0]%360*Bh,b=Fe[1]%360*Bh,at()):[i*h_,b*h_]},je.rotate=function(Fe){return arguments.length?(C=Fe[0]%360*Bh,A=Fe[1]%360*Bh,R=Fe.length>2?Fe[2]%360*Bh:0,at()):[C*h_,A*h_,R*h_]},je.precision=function(Fe){return arguments.length?(xe=yN(De,he=Fe*Fe),ot()):Sx(he)},je.fitExtent=function(Fe,Ze){return P5(je,Fe,Ze)},je.fitSize=function(Fe,Ze){return nee(je,Fe,Ze)};function at(){V=w5(z=UQ(C,A,R),t);var Fe=t(i,b);return u=r-Fe[0]*n,p=a+Fe[1]*n,ot()}function ot(){return ye=Se=null,je}return function(){return t=e.apply(this,arguments),je.invert=t.invert&&Re,at()}}function A5(e){return function(t,n){var r=fs(t),a=fs(n),u=e(r*a);return[u*a*ps(t),u*ps(n)]}}function R5(e){return function(t,n){var r=Sx(t*t+n*n),a=e(r),u=ps(a),p=fs(a);return[X0(t*u,r*p),nv(r&&n*u/r)]}}var uee=A5(function(e){return Sx(2/(1+e))});uee.invert=R5(function(e){return 2*nv(e/2)});var L5=A5(function(e){return(e=b5(e))&&e/ps(e)});L5.invert=R5(function(e){return e});function cee(){return aee(L5).scale(79.4188).clipAngle(180-.001)}function vN(e,t){return[e,t]}vN.invert=vN;function hee(e,t,n){n=n||{};var r=n.units||"kilometers",a=n.steps||8;if(!e)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var u=[];switch(e.type){case"GeometryCollection":return qM(e,function(p){var i=IS(p,t,r,a);i&&u.push(i)}),eg(u);case"FeatureCollection":return yD(e,function(p){var i=IS(p,t,r,a);i&&yD(i,function(b){b&&u.push(b)})}),eg(u)}return IS(e,t,r,a)}function IS(e,t,n,r){var a=e.properties||{},u=e.type==="Feature"?e.geometry:e;if(u.type==="GeometryCollection"){var p=[];return qM(e,function(X){var ue=IS(X,t,n,r);ue&&p.push(ue)}),eg(p)}var i=dee(u),b={type:u.type,coordinates:D5(u.coordinates,i)},C=new rP,A=C.read(b),R=bK(wK(t,n),"meters"),z=Qs.bufferOp(A,R,r),V=new r5;if(z=V.write(z),!O5(z.coordinates)){var W={type:z.type,coordinates:N5(z.coordinates,i)};return Qm(W,a)}}function O5(e){return Array.isArray(e[0])?O5(e[0]):isNaN(e[0])}function D5(e,t){return typeof e[0]!="object"?t(e):e.map(function(n){return D5(n,t)})}function N5(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(n){return N5(n,t)})}function dee(e){var t=SK(e).geometry.coordinates,n=[-t[0],-t[1]];return cee().rotate(n).scale(xu)}function k5(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function fee(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var u=a[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var i={type:"Polygon",coordinates:e};return k5(i,t,n)}function pee(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return k5(r,t,n)}function S0(e,t,n){n===void 0&&(n={});var r=Xc(e),a=Xc(t),u=Z1.union(r.coordinates,a.coordinates);return u.length===0?null:u.length===1?fee(u[0],n.properties):pee(u,n.properties)}function F5(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function mee(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var u=a[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var i={type:"Polygon",coordinates:e};return F5(i,t,n)}function gee(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return F5(r,t,n)}function z5(e,t,n){n===void 0&&(n={});var r=Xc(e),a=Xc(t),u=Z1.intersection(r.coordinates,a.coordinates);return u.length===0?null:u.length===1?mee(u[0],n.properties):gee(u,n.properties)}function _ee(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties={},r.geometry=e,r}function yee(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function xN(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return _ee(r,t,n)}function vee(e){return!!e&&e.constructor===Object}function xee(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function bN(e,t){if(t=t||{},!vee(t))throw new Error("options is invalid");var n=t.propertyName;I4(e,"Polygon","dissolve");var r=[];if(t.propertyName){var a={};xee(e,function(b){Object.prototype.hasOwnProperty.call(a,b.properties[n])||(a[b.properties[n]]=[]),a[b.properties[n]].push(b)});for(var u=Object.keys(a),p=0;p<u.length;p++){var i=xN(Z1.union.apply(null,a[u[p]].map(function(b){return b.geometry.coordinates})));i.properties[n]=u[p],r.push(i)}}else return ND(xN(Z1.union.apply(null,e.features.map(function(b){return b.geometry.coordinates}))));return ND(yee(r))}const pl=[];for(let e=0;e<256;++e)pl.push((e+256).toString(16).slice(1));function bee(e,t=0){return(pl[e[t+0]]+pl[e[t+1]]+pl[e[t+2]]+pl[e[t+3]]+"-"+pl[e[t+4]]+pl[e[t+5]]+"-"+pl[e[t+6]]+pl[e[t+7]]+"-"+pl[e[t+8]]+pl[e[t+9]]+"-"+pl[e[t+10]]+pl[e[t+11]]+pl[e[t+12]]+pl[e[t+13]]+pl[e[t+14]]+pl[e[t+15]]).toLowerCase()}let aI;const wee=new Uint8Array(16);function See(){if(!aI){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");aI=crypto.getRandomValues.bind(crypto)}return aI(wee)}const Eee=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wN={randomUUID:Eee};function cg(e,t,n){var a;if(wN.randomUUID&&!e)return wN.randomUUID();e=e||{};const r=e.random??((a=e.rng)==null?void 0:a.call(e))??See();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,bee(r)}function B5(e){return t=>typeof t===e}var Cee=B5("function"),Tee=e=>e===null,SN=e=>Object.prototype.toString.call(e).slice(8,-1)==="RegExp",EN=e=>!Iee(e)&&!Tee(e)&&(Cee(e)||typeof e=="object"),Iee=B5("undefined");function Mee(e,t){const{length:n}=e;if(n!==t.length)return!1;for(let r=n;r--!==0;)if(!wu(e[r],t[r]))return!1;return!0}function Pee(e,t){if(e.byteLength!==t.byteLength)return!1;const n=new DataView(e.buffer),r=new DataView(t.buffer);let a=e.byteLength;for(;a--;)if(n.getUint8(a)!==r.getUint8(a))return!1;return!0}function Aee(e,t){if(e.size!==t.size)return!1;for(const n of e.entries())if(!t.has(n[0]))return!1;for(const n of e.entries())if(!wu(n[1],t.get(n[0])))return!1;return!0}function Ree(e,t){if(e.size!==t.size)return!1;for(const n of e.entries())if(!t.has(n[0]))return!1;return!0}function wu(e,t){if(e===t)return!0;if(e&&EN(e)&&t&&EN(t)){if(e.constructor!==t.constructor)return!1;if(Array.isArray(e)&&Array.isArray(t))return Mee(e,t);if(e instanceof Map&&t instanceof Map)return Aee(e,t);if(e instanceof Set&&t instanceof Set)return Ree(e,t);if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return Pee(e,t);if(SN(e)&&SN(t))return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let a=n.length;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[a]))return!1;for(let a=n.length;a--!==0;){const u=n[a];if(!(u==="_owner"&&e.$$typeof)&&!wu(e[u],t[u]))return!1}return!0}return Number.isNaN(e)&&Number.isNaN(t)?!0:e===t}var Lee=["Array","ArrayBuffer","AsyncFunction","AsyncGenerator","AsyncGeneratorFunction","Date","Error","Function","Generator","GeneratorFunction","HTMLElement","Map","Object","Promise","RegExp","Set","WeakMap","WeakSet"],Oee=["bigint","boolean","null","number","string","symbol","undefined"];function iC(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(/HTML\w+Element/.test(t))return"HTMLElement";if(Dee(t))return t}function Sf(e){return t=>iC(t)===e}function Dee(e){return Lee.includes(e)}function Ex(e){return t=>typeof t===e}function Nee(e){return Oee.includes(e)}var kee=["innerHTML","ownerDocument","style","attributes","nodeValue"];function Xn(e){if(e===null)return"null";switch(typeof e){case"bigint":return"bigint";case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"symbol":return"symbol";case"undefined":return"undefined"}if(Xn.array(e))return"Array";if(Xn.plainFunction(e))return"Function";const t=iC(e);return t||"Object"}Xn.array=Array.isArray;Xn.arrayOf=(e,t)=>!Xn.array(e)&&!Xn.function(t)?!1:e.every(n=>t(n));Xn.asyncGeneratorFunction=e=>iC(e)==="AsyncGeneratorFunction";Xn.asyncFunction=Sf("AsyncFunction");Xn.bigint=Ex("bigint");Xn.boolean=e=>e===!0||e===!1;Xn.date=Sf("Date");Xn.defined=e=>!Xn.undefined(e);Xn.domElement=e=>Xn.object(e)&&!Xn.plainObject(e)&&e.nodeType===1&&Xn.string(e.nodeName)&&kee.every(t=>t in e);Xn.empty=e=>Xn.string(e)&&e.length===0||Xn.array(e)&&e.length===0||Xn.object(e)&&!Xn.map(e)&&!Xn.set(e)&&Object.keys(e).length===0||Xn.set(e)&&e.size===0||Xn.map(e)&&e.size===0;Xn.error=Sf("Error");Xn.function=Ex("function");Xn.generator=e=>Xn.iterable(e)&&Xn.function(e.next)&&Xn.function(e.throw);Xn.generatorFunction=Sf("GeneratorFunction");Xn.instanceOf=(e,t)=>!e||!t?!1:Object.getPrototypeOf(e)===t.prototype;Xn.iterable=e=>!Xn.nullOrUndefined(e)&&Xn.function(e[Symbol.iterator]);Xn.map=Sf("Map");Xn.nan=e=>Number.isNaN(e);Xn.null=e=>e===null;Xn.nullOrUndefined=e=>Xn.null(e)||Xn.undefined(e);Xn.number=e=>Ex("number")(e)&&!Xn.nan(e);Xn.numericString=e=>Xn.string(e)&&e.length>0&&!Number.isNaN(Number(e));Xn.object=e=>!Xn.nullOrUndefined(e)&&(Xn.function(e)||typeof e=="object");Xn.oneOf=(e,t)=>Xn.array(e)?e.indexOf(t)>-1:!1;Xn.plainFunction=Sf("Function");Xn.plainObject=e=>{if(iC(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.getPrototypeOf({})};Xn.primitive=e=>Xn.null(e)||Nee(typeof e);Xn.promise=Sf("Promise");Xn.propertyOf=(e,t,n)=>{if(!Xn.object(e)||!t)return!1;const r=e[t];return Xn.function(n)?n(r):Xn.defined(r)};Xn.regexp=Sf("RegExp");Xn.set=Sf("Set");Xn.string=Ex("string");Xn.symbol=Ex("symbol");Xn.undefined=Ex("undefined");Xn.weakMap=Sf("WeakMap");Xn.weakSet=Sf("WeakSet");var ur=Xn;function Fee(...e){return e.every(t=>ur.string(t)||ur.array(t)||ur.plainObject(t))}function zee(e,t,n){return j5(e,t)?[e,t].every(ur.array)?!e.some(PN(n))&&t.some(PN(n)):[e,t].every(ur.plainObject)?!Object.entries(e).some(MN(n))&&Object.entries(t).some(MN(n)):t===n:!1}function CN(e,t,n){const{actual:r,key:a,previous:u,type:p}=n,i=Sp(e,a),b=Sp(t,a);let C=[i,b].every(ur.number)&&(p==="increased"?i<b:i>b);return ur.undefined(r)||(C=C&&b===r),ur.undefined(u)||(C=C&&i===u),C}function TN(e,t,n){const{key:r,type:a,value:u}=n,p=Sp(e,r),i=Sp(t,r),b=a==="added"?p:i,C=a==="added"?i:p;if(!ur.nullOrUndefined(u)){if(ur.defined(b)){if(ur.array(b)||ur.plainObject(b))return zee(b,C,u)}else return wu(C,u);return!1}return[p,i].every(ur.array)?!C.every(dP(b)):[p,i].every(ur.plainObject)?Bee(Object.keys(b),Object.keys(C)):![p,i].every(A=>ur.primitive(A)&&ur.defined(A))&&(a==="added"?!ur.defined(p)&&ur.defined(i):ur.defined(p)&&!ur.defined(i))}function IN(e,t,{key:n}={}){let r=Sp(e,n),a=Sp(t,n);if(!j5(r,a))throw new TypeError("Inputs have different types");if(!Fee(r,a))throw new TypeError("Inputs don't have length");return[r,a].every(ur.plainObject)&&(r=Object.keys(r),a=Object.keys(a)),[r,a]}function MN(e){return([t,n])=>ur.array(e)?wu(e,n)||e.some(r=>wu(r,n)||ur.array(n)&&dP(n)(r)):ur.plainObject(e)&&e[t]?!!e[t]&&wu(e[t],n):wu(e,n)}function Bee(e,t){return t.some(n=>!e.includes(n))}function PN(e){return t=>ur.array(e)?e.some(n=>wu(n,t)||ur.array(t)&&dP(t)(n)):wu(e,t)}function E1(e,t){return ur.array(e)?e.some(n=>wu(n,t)):wu(e,t)}function dP(e){return t=>e.some(n=>wu(n,t))}function j5(...e){return e.every(ur.array)||e.every(ur.number)||e.every(ur.plainObject)||e.every(ur.string)}function Sp(e,t){return ur.plainObject(e)||ur.array(e)?ur.string(t)?t.split(".").reduce((r,a)=>r&&r[a],e):ur.number(t)?e[t]:e:e}function aE(e,t){if([e,t].some(ur.nullOrUndefined))throw new Error("Missing required parameters");if(![e,t].every(A=>ur.plainObject(A)||ur.array(A)))throw new Error("Expected plain objects or array");return{added:(A,R)=>{try{return TN(e,t,{key:A,type:"added",value:R})}catch{return!1}},changed:(A,R,z)=>{try{const V=Sp(e,A),W=Sp(t,A),X=ur.defined(R),ue=ur.defined(z);if(X||ue){const ie=ue?E1(z,V):!E1(R,V),K=E1(R,W);return ie&&K}return[V,W].every(ur.array)||[V,W].every(ur.plainObject)?!wu(V,W):V!==W}catch{return!1}},changedFrom:(A,R,z)=>{if(!ur.defined(A))return!1;try{const V=Sp(e,A),W=Sp(t,A),X=ur.defined(z);return E1(R,V)&&(X?E1(z,W):!X)}catch{return!1}},decreased:(A,R,z)=>{if(!ur.defined(A))return!1;try{return CN(e,t,{key:A,actual:R,previous:z,type:"decreased"})}catch{return!1}},emptied:A=>{try{const[R,z]=IN(e,t,{key:A});return!!R.length&&!z.length}catch{return!1}},filled:A=>{try{const[R,z]=IN(e,t,{key:A});return!R.length&&!!z.length}catch{return!1}},increased:(A,R,z)=>{if(!ur.defined(A))return!1;try{return CN(e,t,{key:A,actual:R,previous:z,type:"increased"})}catch{return!1}},removed:(A,R)=>{try{return TN(e,t,{key:A,type:"removed",value:R})}catch{return!1}}}}var lI,AN;function jee(){if(AN)return lI;AN=1;var e=new Error("Element already at target scroll position"),t=new Error("Scroll cancelled"),n=Math.min,r=Date.now;lI={left:a("scrollLeft"),top:a("scrollTop")};function a(i){return function(C,A,R,z){R=R||{},typeof R=="function"&&(z=R,R={}),typeof z!="function"&&(z=p);var V=r(),W=C[i],X=R.ease||u,ue=isNaN(R.duration)?350:+R.duration,ie=!1;return W===A?z(e,C[i]):requestAnimationFrame(ee),K;function K(){ie=!0}function ee(ae){if(ie)return z(t,C[i]);var he=r(),xe=n(1,(he-V)/ue),ye=X(xe);C[i]=ye*(A-W)+W,xe<1?requestAnimationFrame(ee):requestAnimationFrame(function(){z(null,C[i])})}}}function u(i){return .5*(1-Math.cos(Math.PI*i))}function p(){}return lI}var Vee=jee();const Uee=dd(Vee);var MS={exports:{}},Gee=MS.exports,RN;function $ee(){return RN||(RN=1,function(e){(function(t,n){e.exports?e.exports=n():t.Scrollparent=n()})(Gee,function(){function t(r){var a=getComputedStyle(r,null).getPropertyValue("overflow");return a.indexOf("scroll")>-1||a.indexOf("auto")>-1}function n(r){if(r instanceof HTMLElement||r instanceof SVGElement){for(var a=r.parentNode;a.parentNode;){if(t(a))return a;a=a.parentNode}return document.scrollingElement||document.documentElement}}return n})}(MS)),MS.exports}var qee=$ee();const V5=dd(qee);var uI,LN;function Hee(){if(LN)return uI;LN=1;var e=function(r){return Object.prototype.hasOwnProperty.call(r,"props")},t=function(r,a){return r+n(a)},n=function(r){return r===null||typeof r=="boolean"||typeof r>"u"?"":typeof r=="number"?r.toString():typeof r=="string"?r:Array.isArray(r)?r.reduce(t,""):e(r)&&Object.prototype.hasOwnProperty.call(r.props,"children")?n(r.props.children):""};return n.default=n,uI=n,uI}var Wee=Hee();const ON=dd(Wee);var cI,DN;function Xee(){if(DN)return cI;DN=1;var e=function(K){return t(K)&&!n(K)};function t(ie){return!!ie&&typeof ie=="object"}function n(ie){var K=Object.prototype.toString.call(ie);return K==="[object RegExp]"||K==="[object Date]"||u(ie)}var r=typeof Symbol=="function"&&Symbol.for,a=r?Symbol.for("react.element"):60103;function u(ie){return ie.$$typeof===a}function p(ie){return Array.isArray(ie)?[]:{}}function i(ie,K){return K.clone!==!1&&K.isMergeableObject(ie)?X(p(ie),ie,K):ie}function b(ie,K,ee){return ie.concat(K).map(function(ae){return i(ae,ee)})}function C(ie,K){if(!K.customMerge)return X;var ee=K.customMerge(ie);return typeof ee=="function"?ee:X}function A(ie){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(ie).filter(function(K){return Object.propertyIsEnumerable.call(ie,K)}):[]}function R(ie){return Object.keys(ie).concat(A(ie))}function z(ie,K){try{return K in ie}catch{return!1}}function V(ie,K){return z(ie,K)&&!(Object.hasOwnProperty.call(ie,K)&&Object.propertyIsEnumerable.call(ie,K))}function W(ie,K,ee){var ae={};return ee.isMergeableObject(ie)&&R(ie).forEach(function(he){ae[he]=i(ie[he],ee)}),R(K).forEach(function(he){V(ie,he)||(z(ie,he)&&ee.isMergeableObject(K[he])?ae[he]=C(he,ee)(ie[he],K[he],ee):ae[he]=i(K[he],ee))}),ae}function X(ie,K,ee){ee=ee||{},ee.arrayMerge=ee.arrayMerge||b,ee.isMergeableObject=ee.isMergeableObject||e,ee.cloneUnlessOtherwiseSpecified=i;var ae=Array.isArray(K),he=Array.isArray(ie),xe=ae===he;return xe?ae?ee.arrayMerge(ie,K,ee):W(ie,K,ee):i(K,ee)}X.all=function(K,ee){if(!Array.isArray(K))throw new Error("first argument should be an array");return K.reduce(function(ae,he){return X(ae,he,ee)},{})};var ue=X;return cI=ue,cI}var Zee=Xee();const Kd=dd(Zee);var hI={exports:{}},dI,NN;function Yee(){if(NN)return dI;NN=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return dI=e,dI}var fI,kN;function Kee(){if(kN)return fI;kN=1;var e=Yee();function t(){}function n(){}return n.resetWarningCache=t,fI=function(){function r(p,i,b,C,A,R){if(R!==e){var z=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw z.name="Invariant Violation",z}}r.isRequired=r;function a(){return r}var u={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:a,element:r,elementType:r,instanceOf:a,node:r,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:n,resetWarningCache:t};return u.PropTypes=u,u},fI}var FN;function Jee(){return FN||(FN=1,hI.exports=Kee()()),hI.exports}var Qee=Jee();const Rn=dd(Qee);/**!
 * @fileOverview Kickass library to create and place poppers near their reference elements.
 * @version 1.16.1
 * @license
 * Copyright (c) 2016 Federico Zivolo and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */var jb=typeof window<"u"&&typeof document<"u"&&typeof navigator<"u",ete=function(){for(var e=["Edge","Trident","Firefox"],t=0;t<e.length;t+=1)if(jb&&navigator.userAgent.indexOf(e[t])>=0)return 1;return 0}();function tte(e){var t=!1;return function(){t||(t=!0,window.Promise.resolve().then(function(){t=!1,e()}))}}function nte(e){var t=!1;return function(){t||(t=!0,setTimeout(function(){t=!1,e()},ete))}}var rte=jb&&window.Promise,ite=rte?tte:nte;function U5(e){var t={};return e&&t.toString.call(e)==="[object Function]"}function pv(e,t){if(e.nodeType!==1)return[];var n=e.ownerDocument.defaultView,r=n.getComputedStyle(e,null);return t?r[t]:r}function fP(e){return e.nodeName==="HTML"?e:e.parentNode||e.host}function Vb(e){if(!e)return document.body;switch(e.nodeName){case"HTML":case"BODY":return e.ownerDocument.body;case"#document":return e.body}var t=pv(e),n=t.overflow,r=t.overflowX,a=t.overflowY;return/(auto|scroll|overlay)/.test(n+a+r)?e:Vb(fP(e))}function G5(e){return e&&e.referenceNode?e.referenceNode:e}var zN=jb&&!!(window.MSInputMethodContext&&document.documentMode),BN=jb&&/MSIE 10/.test(navigator.userAgent);function Cx(e){return e===11?zN:e===10?BN:zN||BN}function K0(e){if(!e)return document.documentElement;for(var t=Cx(10)?document.body:null,n=e.offsetParent||null;n===t&&e.nextElementSibling;)n=(e=e.nextElementSibling).offsetParent;var r=n&&n.nodeName;return!r||r==="BODY"||r==="HTML"?e?e.ownerDocument.documentElement:document.documentElement:["TH","TD","TABLE"].indexOf(n.nodeName)!==-1&&pv(n,"position")==="static"?K0(n):n}function ote(e){var t=e.nodeName;return t==="BODY"?!1:t==="HTML"||K0(e.firstElementChild)===e}function x2(e){return e.parentNode!==null?x2(e.parentNode):e}function lE(e,t){if(!e||!e.nodeType||!t||!t.nodeType)return document.documentElement;var n=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,r=n?e:t,a=n?t:e,u=document.createRange();u.setStart(r,0),u.setEnd(a,0);var p=u.commonAncestorContainer;if(e!==p&&t!==p||r.contains(a))return ote(p)?p:K0(p);var i=x2(e);return i.host?lE(i.host,t):lE(e,x2(t).host)}function J0(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top",n=t==="top"?"scrollTop":"scrollLeft",r=e.nodeName;if(r==="BODY"||r==="HTML"){var a=e.ownerDocument.documentElement,u=e.ownerDocument.scrollingElement||a;return u[n]}return e[n]}function ste(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=J0(t,"top"),a=J0(t,"left"),u=n?-1:1;return e.top+=r*u,e.bottom+=r*u,e.left+=a*u,e.right+=a*u,e}function jN(e,t){var n=t==="x"?"Left":"Top",r=n==="Left"?"Right":"Bottom";return parseFloat(e["border"+n+"Width"])+parseFloat(e["border"+r+"Width"])}function VN(e,t,n,r){return Math.max(t["offset"+e],t["scroll"+e],n["client"+e],n["offset"+e],n["scroll"+e],Cx(10)?parseInt(n["offset"+e])+parseInt(r["margin"+(e==="Height"?"Top":"Left")])+parseInt(r["margin"+(e==="Height"?"Bottom":"Right")]):0)}function $5(e){var t=e.body,n=e.documentElement,r=Cx(10)&&getComputedStyle(n);return{height:VN("Height",t,n,r),width:VN("Width",t,n,r)}}var ate=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},lte=function(){function e(t,n){for(var r=0;r<n.length;r++){var a=n[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Q0=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Hh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function F_(e){return Hh({},e,{right:e.left+e.width,bottom:e.top+e.height})}function b2(e){var t={};try{if(Cx(10)){t=e.getBoundingClientRect();var n=J0(e,"top"),r=J0(e,"left");t.top+=n,t.left+=r,t.bottom+=n,t.right+=r}else t=e.getBoundingClientRect()}catch{}var a={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},u=e.nodeName==="HTML"?$5(e.ownerDocument):{},p=u.width||e.clientWidth||a.width,i=u.height||e.clientHeight||a.height,b=e.offsetWidth-p,C=e.offsetHeight-i;if(b||C){var A=pv(e);b-=jN(A,"x"),C-=jN(A,"y"),a.width-=b,a.height-=C}return F_(a)}function pP(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=Cx(10),a=t.nodeName==="HTML",u=b2(e),p=b2(t),i=Vb(e),b=pv(t),C=parseFloat(b.borderTopWidth),A=parseFloat(b.borderLeftWidth);n&&a&&(p.top=Math.max(p.top,0),p.left=Math.max(p.left,0));var R=F_({top:u.top-p.top-C,left:u.left-p.left-A,width:u.width,height:u.height});if(R.marginTop=0,R.marginLeft=0,!r&&a){var z=parseFloat(b.marginTop),V=parseFloat(b.marginLeft);R.top-=C-z,R.bottom-=C-z,R.left-=A-V,R.right-=A-V,R.marginTop=z,R.marginLeft=V}return(r&&!n?t.contains(i):t===i&&i.nodeName!=="BODY")&&(R=ste(R,t)),R}function ute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=e.ownerDocument.documentElement,r=pP(e,n),a=Math.max(n.clientWidth,window.innerWidth||0),u=Math.max(n.clientHeight,window.innerHeight||0),p=t?0:J0(n),i=t?0:J0(n,"left"),b={top:p-r.top+r.marginTop,left:i-r.left+r.marginLeft,width:a,height:u};return F_(b)}function q5(e){var t=e.nodeName;if(t==="BODY"||t==="HTML")return!1;if(pv(e,"position")==="fixed")return!0;var n=fP(e);return n?q5(n):!1}function H5(e){if(!e||!e.parentElement||Cx())return document.documentElement;for(var t=e.parentElement;t&&pv(t,"transform")==="none";)t=t.parentElement;return t||document.documentElement}function mP(e,t,n,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,u={top:0,left:0},p=a?H5(e):lE(e,G5(t));if(r==="viewport")u=ute(p,a);else{var i=void 0;r==="scrollParent"?(i=Vb(fP(t)),i.nodeName==="BODY"&&(i=e.ownerDocument.documentElement)):r==="window"?i=e.ownerDocument.documentElement:i=r;var b=pP(i,p,a);if(i.nodeName==="HTML"&&!q5(p)){var C=$5(e.ownerDocument),A=C.height,R=C.width;u.top+=b.top-b.marginTop,u.bottom=A+b.top,u.left+=b.left-b.marginLeft,u.right=R+b.left}else u=b}n=n||0;var z=typeof n=="number";return u.left+=z?n:n.left||0,u.top+=z?n:n.top||0,u.right-=z?n:n.right||0,u.bottom-=z?n:n.bottom||0,u}function cte(e){var t=e.width,n=e.height;return t*n}function W5(e,t,n,r,a){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(e.indexOf("auto")===-1)return e;var p=mP(n,r,u,a),i={top:{width:p.width,height:t.top-p.top},right:{width:p.right-t.right,height:p.height},bottom:{width:p.width,height:p.bottom-t.bottom},left:{width:t.left-p.left,height:p.height}},b=Object.keys(i).map(function(z){return Hh({key:z},i[z],{area:cte(i[z])})}).sort(function(z,V){return V.area-z.area}),C=b.filter(function(z){var V=z.width,W=z.height;return V>=n.clientWidth&&W>=n.clientHeight}),A=C.length>0?C[0].key:b[0].key,R=e.split("-")[1];return A+(R?"-"+R:"")}function X5(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=r?H5(t):lE(t,G5(n));return pP(n,a,r)}function Z5(e){var t=e.ownerDocument.defaultView,n=t.getComputedStyle(e),r=parseFloat(n.marginTop||0)+parseFloat(n.marginBottom||0),a=parseFloat(n.marginLeft||0)+parseFloat(n.marginRight||0),u={width:e.offsetWidth+a,height:e.offsetHeight+r};return u}function uE(e){var t={left:"right",right:"left",bottom:"top",top:"bottom"};return e.replace(/left|right|bottom|top/g,function(n){return t[n]})}function Y5(e,t,n){n=n.split("-")[0];var r=Z5(e),a={width:r.width,height:r.height},u=["right","left"].indexOf(n)!==-1,p=u?"top":"left",i=u?"left":"top",b=u?"height":"width",C=u?"width":"height";return a[p]=t[p]+t[b]/2-r[b]/2,n===i?a[i]=t[i]-r[C]:a[i]=t[uE(i)],a}function Ub(e,t){return Array.prototype.find?e.find(t):e.filter(t)[0]}function hte(e,t,n){if(Array.prototype.findIndex)return e.findIndex(function(a){return a[t]===n});var r=Ub(e,function(a){return a[t]===n});return e.indexOf(r)}function K5(e,t,n){var r=n===void 0?e:e.slice(0,hte(e,"name",n));return r.forEach(function(a){a.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var u=a.function||a.fn;a.enabled&&U5(u)&&(t.offsets.popper=F_(t.offsets.popper),t.offsets.reference=F_(t.offsets.reference),t=u(t,a))}),t}function dte(){if(!this.state.isDestroyed){var e={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};e.offsets.reference=X5(this.state,this.popper,this.reference,this.options.positionFixed),e.placement=W5(this.options.placement,e.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),e.originalPlacement=e.placement,e.positionFixed=this.options.positionFixed,e.offsets.popper=Y5(this.popper,e.offsets.reference,e.placement),e.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",e=K5(this.modifiers,e),this.state.isCreated?this.options.onUpdate(e):(this.state.isCreated=!0,this.options.onCreate(e))}}function J5(e,t){return e.some(function(n){var r=n.name,a=n.enabled;return a&&r===t})}function gP(e){for(var t=[!1,"ms","Webkit","Moz","O"],n=e.charAt(0).toUpperCase()+e.slice(1),r=0;r<t.length;r++){var a=t[r],u=a?""+a+n:e;if(typeof document.body.style[u]<"u")return u}return null}function fte(){return this.state.isDestroyed=!0,J5(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[gP("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function Q5(e){var t=e.ownerDocument;return t?t.defaultView:window}function ej(e,t,n,r){var a=e.nodeName==="BODY",u=a?e.ownerDocument.defaultView:e;u.addEventListener(t,n,{passive:!0}),a||ej(Vb(u.parentNode),t,n,r),r.push(u)}function pte(e,t,n,r){n.updateBound=r,Q5(e).addEventListener("resize",n.updateBound,{passive:!0});var a=Vb(e);return ej(a,"scroll",n.updateBound,n.scrollParents),n.scrollElement=a,n.eventsEnabled=!0,n}function mte(){this.state.eventsEnabled||(this.state=pte(this.reference,this.options,this.state,this.scheduleUpdate))}function gte(e,t){return Q5(e).removeEventListener("resize",t.updateBound),t.scrollParents.forEach(function(n){n.removeEventListener("scroll",t.updateBound)}),t.updateBound=null,t.scrollParents=[],t.scrollElement=null,t.eventsEnabled=!1,t}function _te(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=gte(this.reference,this.state))}function _P(e){return e!==""&&!isNaN(parseFloat(e))&&isFinite(e)}function w2(e,t){Object.keys(t).forEach(function(n){var r="";["width","height","top","right","bottom","left"].indexOf(n)!==-1&&_P(t[n])&&(r="px"),e.style[n]=t[n]+r})}function yte(e,t){Object.keys(t).forEach(function(n){var r=t[n];r!==!1?e.setAttribute(n,t[n]):e.removeAttribute(n)})}function vte(e){return w2(e.instance.popper,e.styles),yte(e.instance.popper,e.attributes),e.arrowElement&&Object.keys(e.arrowStyles).length&&w2(e.arrowElement,e.arrowStyles),e}function xte(e,t,n,r,a){var u=X5(a,t,e,n.positionFixed),p=W5(n.placement,u,t,e,n.modifiers.flip.boundariesElement,n.modifiers.flip.padding);return t.setAttribute("x-placement",p),w2(t,{position:n.positionFixed?"fixed":"absolute"}),n}function bte(e,t){var n=e.offsets,r=n.popper,a=n.reference,u=Math.round,p=Math.floor,i=function(ie){return ie},b=u(a.width),C=u(r.width),A=["left","right"].indexOf(e.placement)!==-1,R=e.placement.indexOf("-")!==-1,z=b%2===C%2,V=b%2===1&&C%2===1,W=t?A||R||z?u:p:i,X=t?u:i;return{left:W(V&&!R&&t?r.left-1:r.left),top:X(r.top),bottom:X(r.bottom),right:W(r.right)}}var wte=jb&&/Firefox/i.test(navigator.userAgent);function Ste(e,t){var n=t.x,r=t.y,a=e.offsets.popper,u=Ub(e.instance.modifiers,function(ee){return ee.name==="applyStyle"}).gpuAcceleration;u!==void 0&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var p=u!==void 0?u:t.gpuAcceleration,i=K0(e.instance.popper),b=b2(i),C={position:a.position},A=bte(e,window.devicePixelRatio<2||!wte),R=n==="bottom"?"top":"bottom",z=r==="right"?"left":"right",V=gP("transform"),W=void 0,X=void 0;if(R==="bottom"?i.nodeName==="HTML"?X=-i.clientHeight+A.bottom:X=-b.height+A.bottom:X=A.top,z==="right"?i.nodeName==="HTML"?W=-i.clientWidth+A.right:W=-b.width+A.right:W=A.left,p&&V)C[V]="translate3d("+W+"px, "+X+"px, 0)",C[R]=0,C[z]=0,C.willChange="transform";else{var ue=R==="bottom"?-1:1,ie=z==="right"?-1:1;C[R]=X*ue,C[z]=W*ie,C.willChange=R+", "+z}var K={"x-placement":e.placement};return e.attributes=Hh({},K,e.attributes),e.styles=Hh({},C,e.styles),e.arrowStyles=Hh({},e.offsets.arrow,e.arrowStyles),e}function tj(e,t,n){var r=Ub(e,function(i){var b=i.name;return b===t}),a=!!r&&e.some(function(i){return i.name===n&&i.enabled&&i.order<r.order});if(!a){var u="`"+t+"`",p="`"+n+"`";console.warn(p+" modifier is required by "+u+" modifier in order to work, be sure to include it before "+u+"!")}return a}function Ete(e,t){var n;if(!tj(e.instance.modifiers,"arrow","keepTogether"))return e;var r=t.element;if(typeof r=="string"){if(r=e.instance.popper.querySelector(r),!r)return e}else if(!e.instance.popper.contains(r))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),e;var a=e.placement.split("-")[0],u=e.offsets,p=u.popper,i=u.reference,b=["left","right"].indexOf(a)!==-1,C=b?"height":"width",A=b?"Top":"Left",R=A.toLowerCase(),z=b?"left":"top",V=b?"bottom":"right",W=Z5(r)[C];i[V]-W<p[R]&&(e.offsets.popper[R]-=p[R]-(i[V]-W)),i[R]+W>p[V]&&(e.offsets.popper[R]+=i[R]+W-p[V]),e.offsets.popper=F_(e.offsets.popper);var X=i[R]+i[C]/2-W/2,ue=pv(e.instance.popper),ie=parseFloat(ue["margin"+A]),K=parseFloat(ue["border"+A+"Width"]),ee=X-e.offsets.popper[R]-ie-K;return ee=Math.max(Math.min(p[C]-W,ee),0),e.arrowElement=r,e.offsets.arrow=(n={},Q0(n,R,Math.round(ee)),Q0(n,z,""),n),e}function Cte(e){return e==="end"?"start":e==="start"?"end":e}var nj=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],pI=nj.slice(3);function UN(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=pI.indexOf(e),r=pI.slice(n+1).concat(pI.slice(0,n));return t?r.reverse():r}var mI={FLIP:"flip",CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise"};function Tte(e,t){if(J5(e.instance.modifiers,"inner")||e.flipped&&e.placement===e.originalPlacement)return e;var n=mP(e.instance.popper,e.instance.reference,t.padding,t.boundariesElement,e.positionFixed),r=e.placement.split("-")[0],a=uE(r),u=e.placement.split("-")[1]||"",p=[];switch(t.behavior){case mI.FLIP:p=[r,a];break;case mI.CLOCKWISE:p=UN(r);break;case mI.COUNTERCLOCKWISE:p=UN(r,!0);break;default:p=t.behavior}return p.forEach(function(i,b){if(r!==i||p.length===b+1)return e;r=e.placement.split("-")[0],a=uE(r);var C=e.offsets.popper,A=e.offsets.reference,R=Math.floor,z=r==="left"&&R(C.right)>R(A.left)||r==="right"&&R(C.left)<R(A.right)||r==="top"&&R(C.bottom)>R(A.top)||r==="bottom"&&R(C.top)<R(A.bottom),V=R(C.left)<R(n.left),W=R(C.right)>R(n.right),X=R(C.top)<R(n.top),ue=R(C.bottom)>R(n.bottom),ie=r==="left"&&V||r==="right"&&W||r==="top"&&X||r==="bottom"&&ue,K=["top","bottom"].indexOf(r)!==-1,ee=!!t.flipVariations&&(K&&u==="start"&&V||K&&u==="end"&&W||!K&&u==="start"&&X||!K&&u==="end"&&ue),ae=!!t.flipVariationsByContent&&(K&&u==="start"&&W||K&&u==="end"&&V||!K&&u==="start"&&ue||!K&&u==="end"&&X),he=ee||ae;(z||ie||he)&&(e.flipped=!0,(z||ie)&&(r=p[b+1]),he&&(u=Cte(u)),e.placement=r+(u?"-"+u:""),e.offsets.popper=Hh({},e.offsets.popper,Y5(e.instance.popper,e.offsets.reference,e.placement)),e=K5(e.instance.modifiers,e,"flip"))}),e}function Ite(e){var t=e.offsets,n=t.popper,r=t.reference,a=e.placement.split("-")[0],u=Math.floor,p=["top","bottom"].indexOf(a)!==-1,i=p?"right":"bottom",b=p?"left":"top",C=p?"width":"height";return n[i]<u(r[b])&&(e.offsets.popper[b]=u(r[b])-n[C]),n[b]>u(r[i])&&(e.offsets.popper[b]=u(r[i])),e}function Mte(e,t,n,r){var a=e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),u=+a[1],p=a[2];if(!u)return e;if(p.indexOf("%")===0){var i=void 0;switch(p){case"%p":i=n;break;case"%":case"%r":default:i=r}var b=F_(i);return b[t]/100*u}else if(p==="vh"||p==="vw"){var C=void 0;return p==="vh"?C=Math.max(document.documentElement.clientHeight,window.innerHeight||0):C=Math.max(document.documentElement.clientWidth,window.innerWidth||0),C/100*u}else return u}function Pte(e,t,n,r){var a=[0,0],u=["right","left"].indexOf(r)!==-1,p=e.split(/(\+|\-)/).map(function(A){return A.trim()}),i=p.indexOf(Ub(p,function(A){return A.search(/,|\s/)!==-1}));p[i]&&p[i].indexOf(",")===-1&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var b=/\s*,\s*|\s+/,C=i!==-1?[p.slice(0,i).concat([p[i].split(b)[0]]),[p[i].split(b)[1]].concat(p.slice(i+1))]:[p];return C=C.map(function(A,R){var z=(R===1?!u:u)?"height":"width",V=!1;return A.reduce(function(W,X){return W[W.length-1]===""&&["+","-"].indexOf(X)!==-1?(W[W.length-1]=X,V=!0,W):V?(W[W.length-1]+=X,V=!1,W):W.concat(X)},[]).map(function(W){return Mte(W,z,t,n)})}),C.forEach(function(A,R){A.forEach(function(z,V){_P(z)&&(a[R]+=z*(A[V-1]==="-"?-1:1))})}),a}function Ate(e,t){var n=t.offset,r=e.placement,a=e.offsets,u=a.popper,p=a.reference,i=r.split("-")[0],b=void 0;return _P(+n)?b=[+n,0]:b=Pte(n,u,p,i),i==="left"?(u.top+=b[0],u.left-=b[1]):i==="right"?(u.top+=b[0],u.left+=b[1]):i==="top"?(u.left+=b[0],u.top-=b[1]):i==="bottom"&&(u.left+=b[0],u.top+=b[1]),e.popper=u,e}function Rte(e,t){var n=t.boundariesElement||K0(e.instance.popper);e.instance.reference===n&&(n=K0(n));var r=gP("transform"),a=e.instance.popper.style,u=a.top,p=a.left,i=a[r];a.top="",a.left="",a[r]="";var b=mP(e.instance.popper,e.instance.reference,t.padding,n,e.positionFixed);a.top=u,a.left=p,a[r]=i,t.boundaries=b;var C=t.priority,A=e.offsets.popper,R={primary:function(V){var W=A[V];return A[V]<b[V]&&!t.escapeWithReference&&(W=Math.max(A[V],b[V])),Q0({},V,W)},secondary:function(V){var W=V==="right"?"left":"top",X=A[W];return A[V]>b[V]&&!t.escapeWithReference&&(X=Math.min(A[W],b[V]-(V==="right"?A.width:A.height))),Q0({},W,X)}};return C.forEach(function(z){var V=["left","top"].indexOf(z)!==-1?"primary":"secondary";A=Hh({},A,R[V](z))}),e.offsets.popper=A,e}function Lte(e){var t=e.placement,n=t.split("-")[0],r=t.split("-")[1];if(r){var a=e.offsets,u=a.reference,p=a.popper,i=["bottom","top"].indexOf(n)!==-1,b=i?"left":"top",C=i?"width":"height",A={start:Q0({},b,u[b]),end:Q0({},b,u[b]+u[C]-p[C])};e.offsets.popper=Hh({},p,A[r])}return e}function Ote(e){if(!tj(e.instance.modifiers,"hide","preventOverflow"))return e;var t=e.offsets.reference,n=Ub(e.instance.modifiers,function(r){return r.name==="preventOverflow"}).boundaries;if(t.bottom<n.top||t.left>n.right||t.top>n.bottom||t.right<n.left){if(e.hide===!0)return e;e.hide=!0,e.attributes["x-out-of-boundaries"]=""}else{if(e.hide===!1)return e;e.hide=!1,e.attributes["x-out-of-boundaries"]=!1}return e}function Dte(e){var t=e.placement,n=t.split("-")[0],r=e.offsets,a=r.popper,u=r.reference,p=["left","right"].indexOf(n)!==-1,i=["top","left"].indexOf(n)===-1;return a[p?"left":"top"]=u[n]-(i?a[p?"width":"height"]:0),e.placement=uE(t),e.offsets.popper=F_(a),e}var Nte={shift:{order:100,enabled:!0,fn:Lte},offset:{order:200,enabled:!0,fn:Ate,offset:0},preventOverflow:{order:300,enabled:!0,fn:Rte,priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:Ite},arrow:{order:500,enabled:!0,fn:Ete,element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:Tte,behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:Dte},hide:{order:800,enabled:!0,fn:Ote},computeStyle:{order:850,enabled:!0,fn:Ste,gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:vte,onLoad:xte,gpuAcceleration:void 0}},kte={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:Nte},cb=function(){function e(t,n){var r=this,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ate(this,e),this.scheduleUpdate=function(){return requestAnimationFrame(r.update)},this.update=ite(this.update.bind(this)),this.options=Hh({},e.Defaults,a),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=t&&t.jquery?t[0]:t,this.popper=n&&n.jquery?n[0]:n,this.options.modifiers={},Object.keys(Hh({},e.Defaults.modifiers,a.modifiers)).forEach(function(p){r.options.modifiers[p]=Hh({},e.Defaults.modifiers[p]||{},a.modifiers?a.modifiers[p]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(p){return Hh({name:p},r.options.modifiers[p])}).sort(function(p,i){return p.order-i.order}),this.modifiers.forEach(function(p){p.enabled&&U5(p.onLoad)&&p.onLoad(r.reference,r.popper,r.options,p,r.state)}),this.update();var u=this.options.eventsEnabled;u&&this.enableEventListeners(),this.state.eventsEnabled=u}return lte(e,[{key:"update",value:function(){return dte.call(this)}},{key:"destroy",value:function(){return fte.call(this)}},{key:"enableEventListeners",value:function(){return mte.call(this)}},{key:"disableEventListeners",value:function(){return _te.call(this)}}]),e}();cb.Utils=(typeof window<"u"?window:global).PopperUtils;cb.placements=nj;cb.Defaults=kte;var Fte=["innerHTML","ownerDocument","style","attributes","nodeValue"],zte=["Array","ArrayBuffer","AsyncFunction","AsyncGenerator","AsyncGeneratorFunction","Date","Error","Function","Generator","GeneratorFunction","HTMLElement","Map","Object","Promise","RegExp","Set","WeakMap","WeakSet"],Bte=["bigint","boolean","null","number","string","symbol","undefined"];function oC(e){var t=Object.prototype.toString.call(e).slice(8,-1);if(/HTML\w+Element/.test(t))return"HTMLElement";if(jte(t))return t}function Ef(e){return function(t){return oC(t)===e}}function jte(e){return zte.includes(e)}function Tx(e){return function(t){return typeof t===e}}function Vte(e){return Bte.includes(e)}function an(e){if(e===null)return"null";switch(typeof e){case"bigint":return"bigint";case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"symbol":return"symbol";case"undefined":return"undefined"}if(an.array(e))return"Array";if(an.plainFunction(e))return"Function";var t=oC(e);return t||"Object"}an.array=Array.isArray;an.arrayOf=function(e,t){return!an.array(e)&&!an.function(t)?!1:e.every(function(n){return t(n)})};an.asyncGeneratorFunction=function(e){return oC(e)==="AsyncGeneratorFunction"};an.asyncFunction=Ef("AsyncFunction");an.bigint=Tx("bigint");an.boolean=function(e){return e===!0||e===!1};an.date=Ef("Date");an.defined=function(e){return!an.undefined(e)};an.domElement=function(e){return an.object(e)&&!an.plainObject(e)&&e.nodeType===1&&an.string(e.nodeName)&&Fte.every(function(t){return t in e})};an.empty=function(e){return an.string(e)&&e.length===0||an.array(e)&&e.length===0||an.object(e)&&!an.map(e)&&!an.set(e)&&Object.keys(e).length===0||an.set(e)&&e.size===0||an.map(e)&&e.size===0};an.error=Ef("Error");an.function=Tx("function");an.generator=function(e){return an.iterable(e)&&an.function(e.next)&&an.function(e.throw)};an.generatorFunction=Ef("GeneratorFunction");an.instanceOf=function(e,t){return!e||!t?!1:Object.getPrototypeOf(e)===t.prototype};an.iterable=function(e){return!an.nullOrUndefined(e)&&an.function(e[Symbol.iterator])};an.map=Ef("Map");an.nan=function(e){return Number.isNaN(e)};an.null=function(e){return e===null};an.nullOrUndefined=function(e){return an.null(e)||an.undefined(e)};an.number=function(e){return Tx("number")(e)&&!an.nan(e)};an.numericString=function(e){return an.string(e)&&e.length>0&&!Number.isNaN(Number(e))};an.object=function(e){return!an.nullOrUndefined(e)&&(an.function(e)||typeof e=="object")};an.oneOf=function(e,t){return an.array(e)?e.indexOf(t)>-1:!1};an.plainFunction=Ef("Function");an.plainObject=function(e){if(oC(e)!=="Object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.getPrototypeOf({})};an.primitive=function(e){return an.null(e)||Vte(typeof e)};an.promise=Ef("Promise");an.propertyOf=function(e,t,n){if(!an.object(e)||!t)return!1;var r=e[t];return an.function(n)?n(r):an.defined(r)};an.regexp=Ef("RegExp");an.set=Ef("Set");an.string=Tx("string");an.symbol=Tx("symbol");an.undefined=Tx("undefined");an.weakMap=Ef("WeakMap");an.weakSet=Ef("WeakSet");function rj(e){return function(t){return typeof t===e}}var Ute=rj("function"),Gte=function(e){return e===null},GN=function(e){return Object.prototype.toString.call(e).slice(8,-1)==="RegExp"},$N=function(e){return!$te(e)&&!Gte(e)&&(Ute(e)||typeof e=="object")},$te=rj("undefined"),S2=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function qte(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=n;r--!==0;)if(!ac(e[r],t[r]))return!1;return!0}function Hte(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e.buffer),r=new DataView(t.buffer),a=e.byteLength;a--;)if(n.getUint8(a)!==r.getUint8(a))return!1;return!0}function Wte(e,t){var n,r,a,u;if(e.size!==t.size)return!1;try{for(var p=S2(e.entries()),i=p.next();!i.done;i=p.next()){var b=i.value;if(!t.has(b[0]))return!1}}catch(R){n={error:R}}finally{try{i&&!i.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}try{for(var C=S2(e.entries()),A=C.next();!A.done;A=C.next()){var b=A.value;if(!ac(b[1],t.get(b[0])))return!1}}catch(R){a={error:R}}finally{try{A&&!A.done&&(u=C.return)&&u.call(C)}finally{if(a)throw a.error}}return!0}function Xte(e,t){var n,r;if(e.size!==t.size)return!1;try{for(var a=S2(e.entries()),u=a.next();!u.done;u=a.next()){var p=u.value;if(!t.has(p[0]))return!1}}catch(i){n={error:i}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return!0}function ac(e,t){if(e===t)return!0;if(e&&$N(e)&&t&&$N(t)){if(e.constructor!==t.constructor)return!1;if(Array.isArray(e)&&Array.isArray(t))return qte(e,t);if(e instanceof Map&&t instanceof Map)return Wte(e,t);if(e instanceof Set&&t instanceof Set)return Xte(e,t);if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return Hte(e,t);if(GN(e)&&GN(t))return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=n.length;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[a]))return!1;for(var a=n.length;a--!==0;){var u=n[a];if(!(u==="_owner"&&e.$$typeof)&&!ac(e[u],t[u]))return!1}return!0}return Number.isNaN(e)&&Number.isNaN(t)?!0:e===t}function Zte(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.every(function(n){return an.string(n)||an.array(n)||an.plainObject(n)})}function Yte(e,t,n){return ij(e,t)?[e,t].every(an.array)?!e.some(ZN(n))&&t.some(ZN(n)):[e,t].every(an.plainObject)?!Object.entries(e).some(XN(n))&&Object.entries(t).some(XN(n)):t===n:!1}function qN(e,t,n){var r=n.actual,a=n.key,u=n.previous,p=n.type,i=Ep(e,a),b=Ep(t,a),C=[i,b].every(an.number)&&(p==="increased"?i<b:i>b);return an.undefined(r)||(C=C&&b===r),an.undefined(u)||(C=C&&i===u),C}function HN(e,t,n){var r=n.key,a=n.type,u=n.value,p=Ep(e,r),i=Ep(t,r),b=a==="added"?p:i,C=a==="added"?i:p;if(!an.nullOrUndefined(u)){if(an.defined(b)){if(an.array(b)||an.plainObject(b))return Yte(b,C,u)}else return ac(C,u);return!1}return[p,i].every(an.array)?!C.every(yP(b)):[p,i].every(an.plainObject)?Kte(Object.keys(b),Object.keys(C)):![p,i].every(function(A){return an.primitive(A)&&an.defined(A)})&&(a==="added"?!an.defined(p)&&an.defined(i):an.defined(p)&&!an.defined(i))}function WN(e,t,n){var r=n===void 0?{}:n,a=r.key,u=Ep(e,a),p=Ep(t,a);if(!ij(u,p))throw new TypeError("Inputs have different types");if(!Zte(u,p))throw new TypeError("Inputs don't have length");return[u,p].every(an.plainObject)&&(u=Object.keys(u),p=Object.keys(p)),[u,p]}function XN(e){return function(t){var n=t[0],r=t[1];return an.array(e)?ac(e,r)||e.some(function(a){return ac(a,r)||an.array(r)&&yP(r)(a)}):an.plainObject(e)&&e[n]?!!e[n]&&ac(e[n],r):ac(e,r)}}function Kte(e,t){return t.some(function(n){return!e.includes(n)})}function ZN(e){return function(t){return an.array(e)?e.some(function(n){return ac(n,t)||an.array(t)&&yP(t)(n)}):ac(e,t)}}function C1(e,t){return an.array(e)?e.some(function(n){return ac(n,t)}):ac(e,t)}function yP(e){return function(t){return e.some(function(n){return ac(n,t)})}}function ij(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.every(an.array)||e.every(an.number)||e.every(an.plainObject)||e.every(an.string)}function Ep(e,t){if(an.plainObject(e)||an.array(e)){if(an.string(t)){var n=t.split(".");return n.reduce(function(r,a){return r&&r[a]},e)}return an.number(t)?e[t]:e}return e}function Jte(e,t){if([e,t].some(an.nullOrUndefined))throw new Error("Missing required parameters");if(![e,t].every(function(R){return an.plainObject(R)||an.array(R)}))throw new Error("Expected plain objects or array");var n=function(R,z){try{return HN(e,t,{key:R,type:"added",value:z})}catch{return!1}},r=function(R,z,V){try{var W=Ep(e,R),X=Ep(t,R),ue=an.defined(z),ie=an.defined(V);if(ue||ie){var K=ie?C1(V,W):!C1(z,W),ee=C1(z,X);return K&&ee}return[W,X].every(an.array)||[W,X].every(an.plainObject)?!ac(W,X):W!==X}catch{return!1}},a=function(R,z,V){if(!an.defined(R))return!1;try{var W=Ep(e,R),X=Ep(t,R),ue=an.defined(V);return C1(z,W)&&(ue?C1(V,X):!ue)}catch{return!1}},u=function(R,z){return an.defined(R)?r(R,z):!1},p=function(R,z,V){if(!an.defined(R))return!1;try{return qN(e,t,{key:R,actual:z,previous:V,type:"decreased"})}catch{return!1}},i=function(R){try{var z=WN(e,t,{key:R}),V=z[0],W=z[1];return!!V.length&&!W.length}catch{return!1}},b=function(R){try{var z=WN(e,t,{key:R}),V=z[0],W=z[1];return!V.length&&!!W.length}catch{return!1}},C=function(R,z,V){if(!an.defined(R))return!1;try{return qN(e,t,{key:R,actual:z,previous:V,type:"increased"})}catch{return!1}},A=function(R,z){try{return HN(e,t,{key:R,type:"removed",value:z})}catch{return!1}};return{added:n,changed:r,changedFrom:a,changedTo:u,decreased:p,emptied:i,filled:b,increased:C,removed:A}}function YN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function rs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YN(Object(n),!0).forEach(function(r){Ul(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YN(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Gb(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qte(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sj(r.key),r)}}function $b(e,t,n){return t&&Qte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ul(e,t,n){return t=sj(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qb(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E2(e,t)}function cE(e){return cE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},cE(e)}function E2(e,t){return E2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},E2(e,t)}function ene(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tne(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,u;for(u=0;u<r.length;u++)a=r[u],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function oj(e,t){if(e==null)return{};var n=tne(e,t),r,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)r=u[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Bm(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nne(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Bm(e)}function Hb(e){var t=ene();return function(){var r=cE(e),a;if(t){var u=cE(this).constructor;a=Reflect.construct(r,arguments,u)}else a=r.apply(this,arguments);return nne(this,a)}}function rne(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function sj(e){var t=rne(e,"string");return typeof t=="symbol"?t:String(t)}var ine={flip:{padding:20},preventOverflow:{padding:10}},one="The typeValidator argument must be a function with the signature function(props, propName, componentName).",sne="The error message is optional, but must be a string if provided.";function ane(e,t,n,r){return typeof e=="boolean"?e:typeof e=="function"?e(t,n,r):e?!!e:!1}function lne(e,t){return Object.hasOwnProperty.call(e,t)}function une(e,t,n,r){return new Error("Required ".concat(e[t]," `").concat(t,"` was not specified in `").concat(n,"`."))}function cne(e,t){if(typeof e!="function")throw new TypeError(one);if(t)throw new TypeError(sne)}function KN(e,t,n){return cne(e,n),function(r,a,u){for(var p=arguments.length,i=new Array(p>3?p-3:0),b=3;b<p;b++)i[b-3]=arguments[b];return ane(t,r,a,u)?lne(r,a)?e.apply(void 0,[r,a,u].concat(i)):une(r,a,u):e.apply(void 0,[r,a,u].concat(i))}}var ki={INIT:"init",IDLE:"idle",OPENING:"opening",OPEN:"open",CLOSING:"closing"},T1=jy.createPortal!==void 0;function vp(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function gI(){return"ontouchstart"in window&&/Mobi/.test(navigator.userAgent)}function cS(e){var t=e.title,n=e.data,r=e.warn,a=r===void 0?!1:r,u=e.debug,p=u===void 0?!1:u,i=a?console.warn||console.error:console.log;p&&t&&n&&(console.groupCollapsed("%creact-floater: ".concat(t),"color: #9b00ff; font-weight: bold; font-size: 12px;"),Array.isArray(n)?n.forEach(function(b){an.plainObject(b)&&b.key?i.apply(console,[b.key,b.value]):i.apply(console,[b])}):i.apply(console,[n]),console.groupEnd())}function hne(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;e.addEventListener(t,n,r)}function dne(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;e.removeEventListener(t,n,r)}function fne(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a;a=function(p){n(p),dne(e,t,a)},hne(e,t,a,r)}function JN(){}var aj=function(e){qb(n,e);var t=Hb(n);function n(){return Gb(this,n),t.apply(this,arguments)}return $b(n,[{key:"componentDidMount",value:function(){vp()&&(this.node||this.appendNode(),T1||this.renderPortal())}},{key:"componentDidUpdate",value:function(){vp()&&(T1||this.renderPortal())}},{key:"componentWillUnmount",value:function(){!vp()||!this.node||(T1||jy.unmountComponentAtNode(this.node),this.node&&this.node.parentNode===document.body&&(document.body.removeChild(this.node),this.node=void 0))}},{key:"appendNode",value:function(){var a=this.props,u=a.id,p=a.zIndex;this.node||(this.node=document.createElement("div"),u&&(this.node.id=u),p&&(this.node.style.zIndex=p),document.body.appendChild(this.node))}},{key:"renderPortal",value:function(){if(!vp())return null;var a=this.props,u=a.children,p=a.setRef;if(this.node||this.appendNode(),T1)return jy.createPortal(u,this.node);var i=jy.unstable_renderSubtreeIntoContainer(this,u.length>1?Zt.createElement("div",null,u):u[0],this.node);return p(i),null}},{key:"renderReact16",value:function(){var a=this.props,u=a.hasChildren,p=a.placement,i=a.target;return u?this.renderPortal():i||p==="center"?this.renderPortal():null}},{key:"render",value:function(){return T1?this.renderReact16():null}}]),n}(Zt.Component);Ul(aj,"propTypes",{children:Rn.oneOfType([Rn.element,Rn.array]),hasChildren:Rn.bool,id:Rn.oneOfType([Rn.string,Rn.number]),placement:Rn.string,setRef:Rn.func.isRequired,target:Rn.oneOfType([Rn.object,Rn.string]),zIndex:Rn.number});var lj=function(e){qb(n,e);var t=Hb(n);function n(){return Gb(this,n),t.apply(this,arguments)}return $b(n,[{key:"parentStyle",get:function(){var a=this.props,u=a.placement,p=a.styles,i=p.arrow.length,b={pointerEvents:"none",position:"absolute",width:"100%"};return u.startsWith("top")?(b.bottom=0,b.left=0,b.right=0,b.height=i):u.startsWith("bottom")?(b.left=0,b.right=0,b.top=0,b.height=i):u.startsWith("left")?(b.right=0,b.top=0,b.bottom=0):u.startsWith("right")&&(b.left=0,b.top=0),b}},{key:"render",value:function(){var a=this.props,u=a.placement,p=a.setArrowRef,i=a.styles,b=i.arrow,C=b.color,A=b.display,R=b.length,z=b.margin,V=b.position,W=b.spread,X={display:A,position:V},ue,ie=W,K=R;return u.startsWith("top")?(ue="0,0 ".concat(ie/2,",").concat(K," ").concat(ie,",0"),X.bottom=0,X.marginLeft=z,X.marginRight=z):u.startsWith("bottom")?(ue="".concat(ie,",").concat(K," ").concat(ie/2,",0 0,").concat(K),X.top=0,X.marginLeft=z,X.marginRight=z):u.startsWith("left")?(K=W,ie=R,ue="0,0 ".concat(ie,",").concat(K/2," 0,").concat(K),X.right=0,X.marginTop=z,X.marginBottom=z):u.startsWith("right")&&(K=W,ie=R,ue="".concat(ie,",").concat(K," ").concat(ie,",0 0,").concat(K/2),X.left=0,X.marginTop=z,X.marginBottom=z),Zt.createElement("div",{className:"__floater__arrow",style:this.parentStyle},Zt.createElement("span",{ref:p,style:X},Zt.createElement("svg",{width:ie,height:K,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Zt.createElement("polygon",{points:ue,fill:C}))))}}]),n}(Zt.Component);Ul(lj,"propTypes",{placement:Rn.string.isRequired,setArrowRef:Rn.func.isRequired,styles:Rn.object.isRequired});var pne=["color","height","width"];function uj(e){var t=e.handleClick,n=e.styles,r=n.color,a=n.height,u=n.width,p=oj(n,pne);return Zt.createElement("button",{"aria-label":"close",onClick:t,style:p,type:"button"},Zt.createElement("svg",{width:"".concat(u,"px"),height:"".concat(a,"px"),viewBox:"0 0 18 18",version:"1.1",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Zt.createElement("g",null,Zt.createElement("path",{d:"M8.13911129,9.00268191 L0.171521827,17.0258467 C-0.0498027049,17.248715 -0.0498027049,17.6098394 0.171521827,17.8327545 C0.28204354,17.9443526 0.427188206,17.9998706 0.572051765,17.9998706 C0.71714958,17.9998706 0.862013139,17.9443526 0.972581703,17.8327545 L9.0000937,9.74924618 L17.0276057,17.8327545 C17.1384085,17.9443526 17.2832721,17.9998706 17.4281356,17.9998706 C17.5729992,17.9998706 17.718097,17.9443526 17.8286656,17.8327545 C18.0499901,17.6098862 18.0499901,17.2487618 17.8286656,17.0258467 L9.86135722,9.00268191 L17.8340066,0.973848225 C18.0553311,0.750979934 18.0553311,0.389855532 17.8340066,0.16694039 C17.6126821,-0.0556467968 17.254037,-0.0556467968 17.0329467,0.16694039 L9.00042166,8.25611765 L0.967006424,0.167268345 C0.745681892,-0.0553188426 0.387317931,-0.0553188426 0.165993399,0.167268345 C-0.0553311331,0.390136635 -0.0553311331,0.751261038 0.165993399,0.974176179 L8.13920499,9.00268191 L8.13911129,9.00268191 Z",fill:r}))))}uj.propTypes={handleClick:Rn.func.isRequired,styles:Rn.object.isRequired};function cj(e){var t=e.content,n=e.footer,r=e.handleClick,a=e.open,u=e.positionWrapper,p=e.showCloseButton,i=e.title,b=e.styles,C={content:Zt.isValidElement(t)?t:Zt.createElement("div",{className:"__floater__content",style:b.content},t)};return i&&(C.title=Zt.isValidElement(i)?i:Zt.createElement("div",{className:"__floater__title",style:b.title},i)),n&&(C.footer=Zt.isValidElement(n)?n:Zt.createElement("div",{className:"__floater__footer",style:b.footer},n)),(p||u)&&!an.boolean(a)&&(C.close=Zt.createElement(uj,{styles:b.close,handleClick:r})),Zt.createElement("div",{className:"__floater__container",style:b.container},C.close,C.title,C.content,C.footer)}cj.propTypes={content:Rn.node.isRequired,footer:Rn.node,handleClick:Rn.func.isRequired,open:Rn.bool,positionWrapper:Rn.bool.isRequired,showCloseButton:Rn.bool.isRequired,styles:Rn.object.isRequired,title:Rn.node};var hj=function(e){qb(n,e);var t=Hb(n);function n(){return Gb(this,n),t.apply(this,arguments)}return $b(n,[{key:"style",get:function(){var a=this.props,u=a.disableAnimation,p=a.component,i=a.placement,b=a.hideArrow,C=a.status,A=a.styles,R=A.arrow.length,z=A.floater,V=A.floaterCentered,W=A.floaterClosing,X=A.floaterOpening,ue=A.floaterWithAnimation,ie=A.floaterWithComponent,K={};return b||(i.startsWith("top")?K.padding="0 0 ".concat(R,"px"):i.startsWith("bottom")?K.padding="".concat(R,"px 0 0"):i.startsWith("left")?K.padding="0 ".concat(R,"px 0 0"):i.startsWith("right")&&(K.padding="0 0 0 ".concat(R,"px"))),[ki.OPENING,ki.OPEN].indexOf(C)!==-1&&(K=rs(rs({},K),X)),C===ki.CLOSING&&(K=rs(rs({},K),W)),C===ki.OPEN&&!u&&(K=rs(rs({},K),ue)),i==="center"&&(K=rs(rs({},K),V)),p&&(K=rs(rs({},K),ie)),rs(rs({},z),K)}},{key:"render",value:function(){var a=this.props,u=a.component,p=a.handleClick,i=a.hideArrow,b=a.setFloaterRef,C=a.status,A={},R=["__floater"];return u?Zt.isValidElement(u)?A.content=Zt.cloneElement(u,{closeFn:p}):A.content=u({closeFn:p}):A.content=Zt.createElement(cj,this.props),C===ki.OPEN&&R.push("__floater__open"),i||(A.arrow=Zt.createElement(lj,this.props)),Zt.createElement("div",{ref:b,className:R.join(" "),style:this.style},Zt.createElement("div",{className:"__floater__body"},A.content,A.arrow))}}]),n}(Zt.Component);Ul(hj,"propTypes",{component:Rn.oneOfType([Rn.func,Rn.element]),content:Rn.node,disableAnimation:Rn.bool.isRequired,footer:Rn.node,handleClick:Rn.func.isRequired,hideArrow:Rn.bool.isRequired,open:Rn.bool,placement:Rn.string.isRequired,positionWrapper:Rn.bool.isRequired,setArrowRef:Rn.func.isRequired,setFloaterRef:Rn.func.isRequired,showCloseButton:Rn.bool,status:Rn.string.isRequired,styles:Rn.object.isRequired,title:Rn.node});var dj=function(e){qb(n,e);var t=Hb(n);function n(){return Gb(this,n),t.apply(this,arguments)}return $b(n,[{key:"render",value:function(){var a=this.props,u=a.children,p=a.handleClick,i=a.handleMouseEnter,b=a.handleMouseLeave,C=a.setChildRef,A=a.setWrapperRef,R=a.style,z=a.styles,V;if(u)if(Zt.Children.count(u)===1)if(!Zt.isValidElement(u))V=Zt.createElement("span",null,u);else{var W=an.function(u.type)?"innerRef":"ref";V=Zt.cloneElement(Zt.Children.only(u),Ul({},W,C))}else V=u;return V?Zt.createElement("span",{ref:A,style:rs(rs({},z),R),onClick:p,onMouseEnter:i,onMouseLeave:b},V):null}}]),n}(Zt.Component);Ul(dj,"propTypes",{children:Rn.node,handleClick:Rn.func.isRequired,handleMouseEnter:Rn.func.isRequired,handleMouseLeave:Rn.func.isRequired,setChildRef:Rn.func.isRequired,setWrapperRef:Rn.func.isRequired,style:Rn.object,styles:Rn.object.isRequired});var mne={zIndex:100};function gne(e){var t=Kd(mne,e.options||{});return{wrapper:{cursor:"help",display:"inline-flex",flexDirection:"column",zIndex:t.zIndex},wrapperPosition:{left:-1e3,position:"absolute",top:-1e3,visibility:"hidden"},floater:{display:"inline-block",filter:"drop-shadow(0 0 3px rgba(0, 0, 0, 0.3))",maxWidth:300,opacity:0,position:"relative",transition:"opacity 0.3s",visibility:"hidden",zIndex:t.zIndex},floaterOpening:{opacity:1,visibility:"visible"},floaterWithAnimation:{opacity:1,transition:"opacity 0.3s, transform 0.2s",visibility:"visible"},floaterWithComponent:{maxWidth:"100%"},floaterClosing:{opacity:0,visibility:"visible"},floaterCentered:{left:"50%",position:"fixed",top:"50%",transform:"translate(-50%, -50%)"},container:{backgroundColor:"#fff",color:"#666",minHeight:60,minWidth:200,padding:20,position:"relative",zIndex:10},title:{borderBottom:"1px solid #555",color:"#555",fontSize:18,marginBottom:5,paddingBottom:6,paddingRight:18},content:{fontSize:15},close:{backgroundColor:"transparent",border:0,borderRadius:0,color:"#555",fontSize:0,height:15,outline:"none",padding:10,position:"absolute",right:0,top:0,width:15,WebkitAppearance:"none"},footer:{borderTop:"1px solid #ccc",fontSize:13,marginTop:10,paddingTop:5},arrow:{color:"#fff",display:"inline-flex",length:16,margin:8,position:"absolute",spread:32},options:t}}var _ne=["arrow","flip","offset"],yne=["position","top","right","bottom","left"],vP=function(e){qb(n,e);var t=Hb(n);function n(r){var a;return Gb(this,n),a=t.call(this,r),Ul(Bm(a),"setArrowRef",function(u){a.arrowRef=u}),Ul(Bm(a),"setChildRef",function(u){a.childRef=u}),Ul(Bm(a),"setFloaterRef",function(u){a.floaterRef=u}),Ul(Bm(a),"setWrapperRef",function(u){a.wrapperRef=u}),Ul(Bm(a),"handleTransitionEnd",function(){var u=a.state.status,p=a.props.callback;a.wrapperPopper&&a.wrapperPopper.instance.update(),a.setState({status:u===ki.OPENING?ki.OPEN:ki.IDLE},function(){var i=a.state.status;p(i===ki.OPEN?"open":"close",a.props)})}),Ul(Bm(a),"handleClick",function(){var u=a.props,p=u.event,i=u.open;if(!an.boolean(i)){var b=a.state,C=b.positionWrapper,A=b.status;(a.event==="click"||a.event==="hover"&&C)&&(cS({title:"click",data:[{event:p,status:A===ki.OPEN?"closing":"opening"}],debug:a.debug}),a.toggle())}}),Ul(Bm(a),"handleMouseEnter",function(){var u=a.props,p=u.event,i=u.open;if(!(an.boolean(i)||gI())){var b=a.state.status;a.event==="hover"&&b===ki.IDLE&&(cS({title:"mouseEnter",data:[{key:"originalEvent",value:p}],debug:a.debug}),clearTimeout(a.eventDelayTimeout),a.toggle())}}),Ul(Bm(a),"handleMouseLeave",function(){var u=a.props,p=u.event,i=u.eventDelay,b=u.open;if(!(an.boolean(b)||gI())){var C=a.state,A=C.status,R=C.positionWrapper;a.event==="hover"&&(cS({title:"mouseLeave",data:[{key:"originalEvent",value:p}],debug:a.debug}),i?[ki.OPENING,ki.OPEN].indexOf(A)!==-1&&!R&&!a.eventDelayTimeout&&(a.eventDelayTimeout=setTimeout(function(){delete a.eventDelayTimeout,a.toggle()},i*1e3)):a.toggle(ki.IDLE))}}),a.state={currentPlacement:r.placement,needsUpdate:!1,positionWrapper:r.wrapperOptions.position&&!!r.target,status:ki.INIT,statusWrapper:ki.INIT},a._isMounted=!1,a.hasMounted=!1,vp()&&window.addEventListener("load",function(){a.popper&&a.popper.instance.update(),a.wrapperPopper&&a.wrapperPopper.instance.update()}),a}return $b(n,[{key:"componentDidMount",value:function(){if(vp()){var a=this.state.positionWrapper,u=this.props,p=u.children,i=u.open,b=u.target;this._isMounted=!0,cS({title:"init",data:{hasChildren:!!p,hasTarget:!!b,isControlled:an.boolean(i),positionWrapper:a,target:this.target,floater:this.floaterRef},debug:this.debug}),this.hasMounted||(this.initPopper(),this.hasMounted=!0),!p&&b&&an.boolean(i)}}},{key:"componentDidUpdate",value:function(a,u){if(vp()){var p=this.props,i=p.autoOpen,b=p.open,C=p.target,A=p.wrapperOptions,R=Jte(u,this.state),z=R.changedFrom,V=R.changed;if(a.open!==b){var W;an.boolean(b)&&(W=b?ki.OPENING:ki.CLOSING),this.toggle(W)}(a.wrapperOptions.position!==A.position||a.target!==C)&&this.changeWrapperPosition(this.props),V("status",ki.IDLE)&&b?this.toggle(ki.OPEN):z("status",ki.INIT,ki.IDLE)&&i&&this.toggle(ki.OPEN),this.popper&&V("status",ki.OPENING)&&this.popper.instance.update(),this.floaterRef&&(V("status",ki.OPENING)||V("status",ki.CLOSING))&&fne(this.floaterRef,"transitionend",this.handleTransitionEnd),V("needsUpdate",!0)&&this.rebuildPopper()}}},{key:"componentWillUnmount",value:function(){vp()&&(this._isMounted=!1,this.popper&&this.popper.instance.destroy(),this.wrapperPopper&&this.wrapperPopper.instance.destroy())}},{key:"initPopper",value:function(){var a=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.target,p=this.state.positionWrapper,i=this.props,b=i.disableFlip,C=i.getPopper,A=i.hideArrow,R=i.offset,z=i.placement,V=i.wrapperOptions,W=z==="top"||z==="bottom"?"flip":["right","bottom-end","top-end","left","top-start","bottom-start"];if(z==="center")this.setState({status:ki.IDLE});else if(u&&this.floaterRef){var X=this.options,ue=X.arrow,ie=X.flip,K=X.offset,ee=oj(X,_ne);new cb(u,this.floaterRef,{placement:z,modifiers:rs({arrow:rs({enabled:!A,element:this.arrowRef},ue),flip:rs({enabled:!b,behavior:W},ie),offset:rs({offset:"0, ".concat(R,"px")},K)},ee),onCreate:function(xe){var ye;if(a.popper=xe,!((ye=a.floaterRef)!==null&&ye!==void 0&&ye.isConnected)){a.setState({needsUpdate:!0});return}C(xe,"floater"),a._isMounted&&a.setState({currentPlacement:xe.placement,status:ki.IDLE}),z!==xe.placement&&setTimeout(function(){xe.instance.update()},1)},onUpdate:function(xe){a.popper=xe;var ye=a.state.currentPlacement;a._isMounted&&xe.placement!==ye&&a.setState({currentPlacement:xe.placement})}})}if(p){var ae=an.undefined(V.offset)?0:V.offset;new cb(this.target,this.wrapperRef,{placement:V.placement||z,modifiers:{arrow:{enabled:!1},offset:{offset:"0, ".concat(ae,"px")},flip:{enabled:!1}},onCreate:function(xe){a.wrapperPopper=xe,a._isMounted&&a.setState({statusWrapper:ki.IDLE}),C(xe,"wrapper"),z!==xe.placement&&setTimeout(function(){xe.instance.update()},1)}})}}},{key:"rebuildPopper",value:function(){var a=this;this.floaterRefInterval=setInterval(function(){var u;(u=a.floaterRef)!==null&&u!==void 0&&u.isConnected&&(clearInterval(a.floaterRefInterval),a.setState({needsUpdate:!1}),a.initPopper())},50)}},{key:"changeWrapperPosition",value:function(a){var u=a.target,p=a.wrapperOptions;this.setState({positionWrapper:p.position&&!!u})}},{key:"toggle",value:function(a){var u=this.state.status,p=u===ki.OPEN?ki.CLOSING:ki.OPENING;an.undefined(a)||(p=a),this.setState({status:p})}},{key:"debug",get:function(){var a=this.props.debug;return a||vp()&&"ReactFloaterDebug"in window&&!!window.ReactFloaterDebug}},{key:"event",get:function(){var a=this.props,u=a.disableHoverToClick,p=a.event;return p==="hover"&&gI()&&!u?"click":p}},{key:"options",get:function(){var a=this.props.options;return Kd(ine,a||{})}},{key:"styles",get:function(){var a=this,u=this.state,p=u.status,i=u.positionWrapper,b=u.statusWrapper,C=this.props.styles,A=Kd(gne(C),C);if(i){var R;[ki.IDLE].indexOf(p)===-1||[ki.IDLE].indexOf(b)===-1?R=A.wrapperPosition:R=this.wrapperPopper.styles,A.wrapper=rs(rs({},A.wrapper),R)}if(this.target){var z=window.getComputedStyle(this.target);this.wrapperStyles?A.wrapper=rs(rs({},A.wrapper),this.wrapperStyles):["relative","static"].indexOf(z.position)===-1&&(this.wrapperStyles={},i||(yne.forEach(function(V){a.wrapperStyles[V]=z[V]}),A.wrapper=rs(rs({},A.wrapper),this.wrapperStyles),this.target.style.position="relative",this.target.style.top="auto",this.target.style.right="auto",this.target.style.bottom="auto",this.target.style.left="auto"))}return A}},{key:"target",get:function(){if(!vp())return null;var a=this.props.target;return a?an.domElement(a)?a:document.querySelector(a):this.childRef||this.wrapperRef}},{key:"render",value:function(){var a=this.state,u=a.currentPlacement,p=a.positionWrapper,i=a.status,b=this.props,C=b.children,A=b.component,R=b.content,z=b.disableAnimation,V=b.footer,W=b.hideArrow,X=b.id,ue=b.open,ie=b.showCloseButton,K=b.style,ee=b.target,ae=b.title,he=Zt.createElement(dj,{handleClick:this.handleClick,handleMouseEnter:this.handleMouseEnter,handleMouseLeave:this.handleMouseLeave,setChildRef:this.setChildRef,setWrapperRef:this.setWrapperRef,style:K,styles:this.styles.wrapper},C),xe={};return p?xe.wrapperInPortal=he:xe.wrapperAsChildren=he,Zt.createElement("span",null,Zt.createElement(aj,{hasChildren:!!C,id:X,placement:u,setRef:this.setFloaterRef,target:ee,zIndex:this.styles.options.zIndex},Zt.createElement(hj,{component:A,content:R,disableAnimation:z,footer:V,handleClick:this.handleClick,hideArrow:W||u==="center",open:ue,placement:u,positionWrapper:p,setArrowRef:this.setArrowRef,setFloaterRef:this.setFloaterRef,showCloseButton:ie,status:i,styles:this.styles,title:ae}),xe.wrapperInPortal),xe.wrapperAsChildren)}}]),n}(Zt.Component);Ul(vP,"propTypes",{autoOpen:Rn.bool,callback:Rn.func,children:Rn.node,component:KN(Rn.oneOfType([Rn.func,Rn.element]),function(e){return!e.content}),content:KN(Rn.node,function(e){return!e.component}),debug:Rn.bool,disableAnimation:Rn.bool,disableFlip:Rn.bool,disableHoverToClick:Rn.bool,event:Rn.oneOf(["hover","click"]),eventDelay:Rn.number,footer:Rn.node,getPopper:Rn.func,hideArrow:Rn.bool,id:Rn.oneOfType([Rn.string,Rn.number]),offset:Rn.number,open:Rn.bool,options:Rn.object,placement:Rn.oneOf(["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","auto","center"]),showCloseButton:Rn.bool,style:Rn.object,styles:Rn.object,target:Rn.oneOfType([Rn.object,Rn.string]),title:Rn.node,wrapperOptions:Rn.shape({offset:Rn.number,placement:Rn.oneOf(["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","auto"]),position:Rn.bool})});Ul(vP,"defaultProps",{autoOpen:!1,callback:JN,debug:!1,disableAnimation:!1,disableFlip:!1,disableHoverToClick:!1,event:"click",eventDelay:.4,getPopper:JN,hideArrow:!1,offset:15,placement:"bottom",showCloseButton:!1,styles:{},target:null,wrapperOptions:{position:!1}});var vne=Object.defineProperty,xne=(e,t,n)=>t in e?vne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dr=(e,t,n)=>xne(e,typeof t!="symbol"?t+"":t,n),ro={INIT:"init",START:"start",STOP:"stop",RESET:"reset",PREV:"prev",NEXT:"next",GO:"go",CLOSE:"close",SKIP:"skip",UPDATE:"update"},Zd={TOUR_START:"tour:start",STEP_BEFORE:"step:before",BEACON:"beacon",TOOLTIP:"tooltip",STEP_AFTER:"step:after",TOUR_END:"tour:end",TOUR_STATUS:"tour:status",TARGET_NOT_FOUND:"error:target_not_found"},ri={INIT:"init",READY:"ready",BEACON:"beacon",TOOLTIP:"tooltip",COMPLETE:"complete",ERROR:"error"},Mi={IDLE:"idle",READY:"ready",WAITING:"waiting",RUNNING:"running",PAUSED:"paused",SKIPPED:"skipped",FINISHED:"finished"};function p_(){var e;return!!(typeof window<"u"&&((e=window.document)!=null&&e.createElement))}function fj(e){return e?e.getBoundingClientRect():null}function bne(e=!1){const{body:t,documentElement:n}=document;if(!t||!n)return 0;if(e){const r=[t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight].sort((u,p)=>u-p),a=Math.floor(r.length/2);return r.length%2===0?(r[a-1]+r[a])/2:r[a]}return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}function qm(e){if(typeof e=="string")try{return document.querySelector(e)}catch{return null}return e}function wne(e){return!e||e.nodeType!==1?null:getComputedStyle(e)}function hb(e,t,n){if(!e)return By();const r=V5(e);if(r){if(r.isSameNode(By()))return n?document:By();if(!(r.scrollHeight>r.offsetHeight)&&!t)return r.style.overflow="initial",By()}return r}function sC(e,t){if(!e)return!1;const n=hb(e,t);return n?!n.isSameNode(By()):!1}function Sne(e){return e.offsetParent!==document.body}function ex(e,t="fixed"){if(!e||!(e instanceof HTMLElement))return!1;const{nodeName:n}=e,r=wne(e);return n==="BODY"||n==="HTML"?!1:r&&r.position===t?!0:e.parentNode?ex(e.parentNode,t):!1}function Ene(e){var t;if(!e)return!1;let n=e;for(;n&&n!==document.body;){if(n instanceof HTMLElement){const{display:r,visibility:a}=getComputedStyle(n);if(r==="none"||a==="hidden")return!1}n=(t=n.parentElement)!=null?t:null}return!0}function Cne(e,t,n){var r,a,u;const p=fj(e),i=hb(e,n),b=sC(e,n),C=ex(e);let A=0,R=(r=p==null?void 0:p.top)!=null?r:0;if(b&&C){const z=(a=e==null?void 0:e.offsetTop)!=null?a:0,V=(u=i==null?void 0:i.scrollTop)!=null?u:0;R=z-V}else i instanceof HTMLElement&&(A=i.scrollTop,!b&&!ex(e)&&(R+=A),i.isSameNode(By())||(R+=By().scrollTop));return Math.floor(R-t)}function Tne(e,t,n){var r;if(!e)return 0;const{offsetTop:a=0,scrollTop:u=0}=(r=V5(e))!=null?r:{};let p=e.getBoundingClientRect().top+u;a&&(sC(e,n)||Sne(e))&&(p-=a);const i=Math.floor(p-t);return i<0?0:i}function By(){var e;return(e=document.scrollingElement)!=null?e:document.documentElement}function Ine(e,t){const{duration:n,element:r}=t;return new Promise((a,u)=>{const{scrollTop:p}=r,i=e>p?e-p:p-e;Uee.top(r,e,{duration:i<100?50:n},b=>b&&b.message!=="Element already at target scroll position"?u(b):a())})}var I1=Jd.createPortal!==void 0;function pj(e=navigator.userAgent){let t=e;return typeof window>"u"?t="node":document.documentMode?t="ie":/Edge/.test(e)?t="edge":window.opera||e.includes(" OPR/")?t="opera":typeof window.InstallTrigger<"u"?t="firefox":window.chrome?t="chrome":/(Version\/([\d._]+).*Safari|CriOS|FxiOS| Mobile\/)/.test(e)&&(t="safari"),t}function PS(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function xp(e,t={}){const{defaultValue:n,step:r,steps:a}=t;let u=ON(e);if(u)(u.includes("{step}")||u.includes("{steps}"))&&r&&a&&(u=u.replace("{step}",r.toString()).replace("{steps}",a.toString()));else if(Y.isValidElement(e)&&!Object.values(e.props).length&&PS(e.type)==="function"){const p=e.type({});u=xp(p,t)}else u=ON(n);return u}function Mne(e,t){return!ur.plainObject(e)||!ur.array(t)?!1:Object.keys(e).every(n=>t.includes(n))}function Pne(e){const t=/^#?([\da-f])([\da-f])([\da-f])$/i,n=e.replace(t,(a,u,p,i)=>u+u+p+p+i+i),r=/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i.exec(n);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[]}function QN(e){return e.disableBeacon||e.placement==="center"}function ek(){return!["chrome","safari","firefox","opera"].includes(pj())}function rv({data:e,debug:t=!1,title:n,warn:r=!1}){const a=r?console.warn||console.error:console.log;t&&(n&&e?(console.groupCollapsed(`%creact-joyride: ${n}`,"color: #ff0044; font-weight: bold; font-size: 12px;"),Array.isArray(e)?e.forEach(u=>{ur.plainObject(u)&&u.key?a.apply(console,[u.key,u.value]):a.apply(console,[u])}):a.apply(console,[e]),console.groupEnd()):console.error("Missing title or data props"))}function Ane(e){return Object.keys(e)}function mj(e,...t){if(!ur.plainObject(e))throw new TypeError("Expected an object");const n={};for(const r in e)({}).hasOwnProperty.call(e,r)&&(t.includes(r)||(n[r]=e[r]));return n}function Rne(e,...t){if(!ur.plainObject(e))throw new TypeError("Expected an object");if(!t.length)return e;const n={};for(const r in e)({}).hasOwnProperty.call(e,r)&&t.includes(r)&&(n[r]=e[r]);return n}function C2(e,t,n){const r=u=>u.replace("{step}",String(t)).replace("{steps}",String(n));if(PS(e)==="string")return r(e);if(!Y.isValidElement(e))return e;const{children:a}=e.props;if(PS(a)==="string"&&a.includes("{step}"))return Y.cloneElement(e,{children:r(a)});if(Array.isArray(a))return Y.cloneElement(e,{children:a.map(u=>typeof u=="string"?r(u):C2(u,t,n))});if(PS(e.type)==="function"&&!Object.values(e.props).length){const u=e.type({});return C2(u,t,n)}return e}function Lne(e){const{isFirstStep:t,lifecycle:n,previousLifecycle:r,scrollToFirstStep:a,step:u,target:p}=e;return!u.disableScrolling&&(!t||a||n===ri.TOOLTIP)&&u.placement!=="center"&&(!u.isFixed||!ex(p))&&r!==n&&[ri.BEACON,ri.TOOLTIP].includes(n)}var One={options:{preventOverflow:{boundariesElement:"scrollParent"}},wrapperOptions:{offset:-18,position:!0}},gj={back:"Back",close:"Close",last:"Last",next:"Next",nextLabelWithProgress:"Next (Step {step} of {steps})",open:"Open the dialog",skip:"Skip"},Dne={event:"click",placement:"bottom",offset:10,disableBeacon:!1,disableCloseOnEsc:!1,disableOverlay:!1,disableOverlayClose:!1,disableScrollParentFix:!1,disableScrolling:!1,hideBackButton:!1,hideCloseButton:!1,hideFooter:!1,isFixed:!1,locale:gj,showProgress:!1,showSkipButton:!1,spotlightClicks:!1,spotlightPadding:10},Nne={continuous:!1,debug:!1,disableCloseOnEsc:!1,disableOverlay:!1,disableOverlayClose:!1,disableScrolling:!1,disableScrollParentFix:!1,getHelpers:void 0,hideBackButton:!1,run:!0,scrollOffset:20,scrollDuration:300,scrollToFirstStep:!1,showSkipButton:!1,showProgress:!1,spotlightClicks:!1,spotlightPadding:10,steps:[]},kne={arrowColor:"#fff",backgroundColor:"#fff",beaconSize:36,overlayColor:"rgba(0, 0, 0, 0.5)",primaryColor:"#f04",spotlightShadow:"0 0 15px rgba(0, 0, 0, 0.5)",textColor:"#333",width:380,zIndex:100},M1={backgroundColor:"transparent",border:0,borderRadius:0,color:"#555",cursor:"pointer",fontSize:16,lineHeight:1,padding:8,WebkitAppearance:"none"},tk={borderRadius:4,position:"absolute"};function Fne(e,t){var n,r,a,u,p;const{floaterProps:i,styles:b}=e,C=Kd((n=t.floaterProps)!=null?n:{},i??{}),A=Kd(b??{},(r=t.styles)!=null?r:{}),R=Kd(kne,A.options||{}),z=t.placement==="center"||t.disableBeacon;let{width:V}=R;window.innerWidth>480&&(V=380),"width"in R&&(V=typeof R.width=="number"&&window.innerWidth<R.width?window.innerWidth-30:R.width);const W={bottom:0,left:0,overflow:"hidden",position:"absolute",right:0,top:0,zIndex:R.zIndex},X={beacon:{...M1,display:z?"none":"inline-block",height:R.beaconSize,position:"relative",width:R.beaconSize,zIndex:R.zIndex},beaconInner:{animation:"joyride-beacon-inner 1.2s infinite ease-in-out",backgroundColor:R.primaryColor,borderRadius:"50%",display:"block",height:"50%",left:"50%",opacity:.7,position:"absolute",top:"50%",transform:"translate(-50%, -50%)",width:"50%"},beaconOuter:{animation:"joyride-beacon-outer 1.2s infinite ease-in-out",backgroundColor:`rgba(${Pne(R.primaryColor).join(",")}, 0.2)`,border:`2px solid ${R.primaryColor}`,borderRadius:"50%",boxSizing:"border-box",display:"block",height:"100%",left:0,opacity:.9,position:"absolute",top:0,transformOrigin:"center",width:"100%"},tooltip:{backgroundColor:R.backgroundColor,borderRadius:5,boxSizing:"border-box",color:R.textColor,fontSize:16,maxWidth:"100%",padding:15,position:"relative",width:V},tooltipContainer:{lineHeight:1.4,textAlign:"center"},tooltipTitle:{fontSize:18,margin:0},tooltipContent:{padding:"20px 10px"},tooltipFooter:{alignItems:"center",display:"flex",justifyContent:"flex-end",marginTop:15},tooltipFooterSpacer:{flex:1},buttonNext:{...M1,backgroundColor:R.primaryColor,borderRadius:4,color:"#fff"},buttonBack:{...M1,color:R.primaryColor,marginLeft:"auto",marginRight:5},buttonClose:{...M1,color:R.textColor,height:14,padding:15,position:"absolute",right:0,top:0,width:14},buttonSkip:{...M1,color:R.textColor,fontSize:14},overlay:{...W,backgroundColor:R.overlayColor,mixBlendMode:"hard-light"},overlayLegacy:{...W},overlayLegacyCenter:{...W,backgroundColor:R.overlayColor},spotlight:{...tk,backgroundColor:"gray"},spotlightLegacy:{...tk,boxShadow:`0 0 0 9999px ${R.overlayColor}, ${R.spotlightShadow}`},floaterStyles:{arrow:{color:(p=(u=(a=C==null?void 0:C.styles)==null?void 0:a.arrow)==null?void 0:u.color)!=null?p:R.arrowColor},options:{zIndex:R.zIndex+100}},options:R};return Kd(X,A)}function zne(e){return Rne(e,"beaconComponent","disableCloseOnEsc","disableOverlay","disableOverlayClose","disableScrolling","disableScrollParentFix","floaterProps","hideBackButton","hideCloseButton","locale","showProgress","showSkipButton","spotlightClicks","spotlightPadding","styles","tooltipComponent")}function d0(e,t){var n,r,a,u,p,i;const b=t??{},C=Kd.all([Dne,zne(e),b],{isMergeableObject:ur.plainObject}),A=Fne(e,C),R=sC(qm(C.target),C.disableScrollParentFix),z=Kd.all([One,(n=e.floaterProps)!=null?n:{},(r=C.floaterProps)!=null?r:{}]);return z.offset=C.offset,z.styles=Kd((a=z.styles)!=null?a:{},A.floaterStyles),z.offset+=(p=(u=e.spotlightPadding)!=null?u:C.spotlightPadding)!=null?p:0,C.placementBeacon&&z.wrapperOptions&&(z.wrapperOptions.placement=C.placementBeacon),R&&z.options.preventOverflow&&(z.options.preventOverflow.boundariesElement="window"),{...C,locale:Kd.all([gj,(i=e.locale)!=null?i:{},C.locale||{}]),floaterProps:z,styles:mj(A,"floaterStyles")}}function _j(e,t=!1){return ur.plainObject(e)?e.target?!0:(rv({title:"validateStep",data:"target is missing from the step",warn:!0,debug:t}),!1):(rv({title:"validateStep",data:"step must be an object",warn:!0,debug:t}),!1)}function nk(e,t=!1){return ur.array(e)?e.every(n=>_j(n,t)):(rv({title:"validateSteps",data:"steps must be an array",warn:!0,debug:t}),!1)}var yj={action:"init",controlled:!1,index:0,lifecycle:ri.INIT,origin:null,size:0,status:Mi.IDLE},rk=Ane(mj(yj,"controlled","size")),Bne=class{constructor(t){dr(this,"beaconPopper"),dr(this,"tooltipPopper"),dr(this,"data",new Map),dr(this,"listener"),dr(this,"store",new Map),dr(this,"addListener",u=>{this.listener=u}),dr(this,"setSteps",u=>{const{size:p,status:i}=this.getState(),b={size:u.length,status:i};this.data.set("steps",u),i===Mi.WAITING&&!p&&u.length&&(b.status=Mi.RUNNING),this.setState(b)}),dr(this,"getPopper",u=>u==="beacon"?this.beaconPopper:this.tooltipPopper),dr(this,"setPopper",(u,p)=>{u==="beacon"?this.beaconPopper=p:this.tooltipPopper=p}),dr(this,"cleanupPoppers",()=>{this.beaconPopper=null,this.tooltipPopper=null}),dr(this,"close",(u=null)=>{const{index:p,status:i}=this.getState();i===Mi.RUNNING&&this.setState({...this.getNextState({action:ro.CLOSE,index:p+1,origin:u})})}),dr(this,"go",u=>{const{controlled:p,status:i}=this.getState();if(p||i!==Mi.RUNNING)return;const b=this.getSteps()[u];this.setState({...this.getNextState({action:ro.GO,index:u}),status:b?i:Mi.FINISHED})}),dr(this,"info",()=>this.getState()),dr(this,"next",()=>{const{index:u,status:p}=this.getState();p===Mi.RUNNING&&this.setState(this.getNextState({action:ro.NEXT,index:u+1}))}),dr(this,"open",()=>{const{status:u}=this.getState();u===Mi.RUNNING&&this.setState({...this.getNextState({action:ro.UPDATE,lifecycle:ri.TOOLTIP})})}),dr(this,"prev",()=>{const{index:u,status:p}=this.getState();p===Mi.RUNNING&&this.setState({...this.getNextState({action:ro.PREV,index:u-1})})}),dr(this,"reset",(u=!1)=>{const{controlled:p}=this.getState();p||this.setState({...this.getNextState({action:ro.RESET,index:0}),status:u?Mi.RUNNING:Mi.READY})}),dr(this,"skip",()=>{const{status:u}=this.getState();u===Mi.RUNNING&&this.setState({action:ro.SKIP,lifecycle:ri.INIT,status:Mi.SKIPPED})}),dr(this,"start",u=>{const{index:p,size:i}=this.getState();this.setState({...this.getNextState({action:ro.START,index:ur.number(u)?u:p},!0),status:i?Mi.RUNNING:Mi.WAITING})}),dr(this,"stop",(u=!1)=>{const{index:p,status:i}=this.getState();[Mi.FINISHED,Mi.SKIPPED].includes(i)||this.setState({...this.getNextState({action:ro.STOP,index:p+(u?1:0)}),status:Mi.PAUSED})}),dr(this,"update",u=>{var p,i;if(!Mne(u,rk))throw new Error(`State is not valid. Valid keys: ${rk.join(", ")}`);this.setState({...this.getNextState({...this.getState(),...u,action:(p=u.action)!=null?p:ro.UPDATE,origin:(i=u.origin)!=null?i:null},!0)})});const{continuous:n=!1,stepIndex:r,steps:a=[]}=t??{};this.setState({action:ro.INIT,controlled:ur.number(r),continuous:n,index:ur.number(r)?r:0,lifecycle:ri.INIT,origin:null,status:a.length?Mi.READY:Mi.IDLE},!0),this.beaconPopper=null,this.tooltipPopper=null,this.listener=null,this.setSteps(a)}getState(){return this.store.size?{action:this.store.get("action")||"",controlled:this.store.get("controlled")||!1,index:parseInt(this.store.get("index"),10),lifecycle:this.store.get("lifecycle")||"",origin:this.store.get("origin")||null,size:this.store.get("size")||0,status:this.store.get("status")||""}:{...yj}}getNextState(t,n=!1){var r,a,u,p,i;const{action:b,controlled:C,index:A,size:R,status:z}=this.getState(),V=ur.number(t.index)?t.index:A,W=C&&!n?A:Math.min(Math.max(V,0),R);return{action:(r=t.action)!=null?r:b,controlled:C,index:W,lifecycle:(a=t.lifecycle)!=null?a:ri.INIT,origin:(u=t.origin)!=null?u:null,size:(p=t.size)!=null?p:R,status:W===R?Mi.FINISHED:(i=t.status)!=null?i:z}}getSteps(){const t=this.data.get("steps");return Array.isArray(t)?t:[]}hasUpdatedState(t){const n=JSON.stringify(t),r=JSON.stringify(this.getState());return n!==r}setState(t,n=!1){const r=this.getState(),{action:a,index:u,lifecycle:p,origin:i=null,size:b,status:C}={...r,...t};this.store.set("action",a),this.store.set("index",u),this.store.set("lifecycle",p),this.store.set("origin",i),this.store.set("size",b),this.store.set("status",C),n&&(this.store.set("controlled",t.controlled),this.store.set("continuous",t.continuous)),this.listener&&this.hasUpdatedState(r)&&this.listener(this.getState())}getHelpers(){return{close:this.close,go:this.go,info:this.info,next:this.next,open:this.open,prev:this.prev,reset:this.reset,skip:this.skip}}};function jne(e){return new Bne(e)}function Vne({styles:e}){return Y.createElement("div",{key:"JoyrideSpotlight",className:"react-joyride__spotlight","data-test-id":"spotlight",style:e})}var Une=Vne,Gne=class extends Y.Component{constructor(){super(...arguments),dr(this,"isActive",!1),dr(this,"resizeTimeout"),dr(this,"scrollTimeout"),dr(this,"scrollParent"),dr(this,"state",{isScrolling:!1,mouseOverSpotlight:!1,showSpotlight:!0}),dr(this,"hideSpotlight",()=>{const{continuous:e,disableOverlay:t,lifecycle:n}=this.props,r=[ri.INIT,ri.BEACON,ri.COMPLETE,ri.ERROR];return t||(e?r.includes(n):n!==ri.TOOLTIP)}),dr(this,"handleMouseMove",e=>{const{mouseOverSpotlight:t}=this.state,{height:n,left:r,position:a,top:u,width:p}=this.spotlightStyles,i=a==="fixed"?e.clientY:e.pageY,b=a==="fixed"?e.clientX:e.pageX,C=i>=u&&i<=u+n,R=b>=r&&b<=r+p&&C;R!==t&&this.updateState({mouseOverSpotlight:R})}),dr(this,"handleScroll",()=>{const{target:e}=this.props,t=qm(e);if(this.scrollParent!==document){const{isScrolling:n}=this.state;n||this.updateState({isScrolling:!0,showSpotlight:!1}),clearTimeout(this.scrollTimeout),this.scrollTimeout=window.setTimeout(()=>{this.updateState({isScrolling:!1,showSpotlight:!0})},50)}else ex(t,"sticky")&&this.updateState({})}),dr(this,"handleResize",()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(()=>{this.isActive&&this.forceUpdate()},100)})}componentDidMount(){const{debug:e,disableScrolling:t,disableScrollParentFix:n=!1,target:r}=this.props,a=qm(r);this.scrollParent=hb(a??document.body,n,!0),this.isActive=!0,window.addEventListener("resize",this.handleResize)}componentDidUpdate(e){var t;const{disableScrollParentFix:n,lifecycle:r,spotlightClicks:a,target:u}=this.props,{changed:p}=aE(e,this.props);if(p("target")||p("disableScrollParentFix")){const i=qm(u);this.scrollParent=hb(i??document.body,n,!0)}p("lifecycle",ri.TOOLTIP)&&((t=this.scrollParent)==null||t.addEventListener("scroll",this.handleScroll,{passive:!0}),setTimeout(()=>{const{isScrolling:i}=this.state;i||this.updateState({showSpotlight:!0})},100)),(p("spotlightClicks")||p("disableOverlay")||p("lifecycle"))&&(a&&r===ri.TOOLTIP?window.addEventListener("mousemove",this.handleMouseMove,!1):r!==ri.TOOLTIP&&window.removeEventListener("mousemove",this.handleMouseMove))}componentWillUnmount(){var e;this.isActive=!1,window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("resize",this.handleResize),clearTimeout(this.resizeTimeout),clearTimeout(this.scrollTimeout),(e=this.scrollParent)==null||e.removeEventListener("scroll",this.handleScroll)}get overlayStyles(){const{mouseOverSpotlight:e}=this.state,{disableOverlayClose:t,placement:n,styles:r}=this.props;let a=r.overlay;return ek()&&(a=n==="center"?r.overlayLegacyCenter:r.overlayLegacy),{cursor:t?"default":"pointer",height:bne(),pointerEvents:e?"none":"auto",...a}}get spotlightStyles(){var e,t,n;const{showSpotlight:r}=this.state,{disableScrollParentFix:a=!1,spotlightClicks:u,spotlightPadding:p=0,styles:i,target:b}=this.props,C=qm(b),A=fj(C),R=ex(C),z=Cne(C,p,a);return{...ek()?i.spotlightLegacy:i.spotlight,height:Math.round(((e=A==null?void 0:A.height)!=null?e:0)+p*2),left:Math.round(((t=A==null?void 0:A.left)!=null?t:0)-p),opacity:r?1:0,pointerEvents:u?"none":"auto",position:R?"fixed":"absolute",top:z,transition:"opacity 0.2s",width:Math.round(((n=A==null?void 0:A.width)!=null?n:0)+p*2)}}updateState(e){this.isActive&&this.setState(t=>({...t,...e}))}render(){const{showSpotlight:e}=this.state,{onClickOverlay:t,placement:n}=this.props,{hideSpotlight:r,overlayStyles:a,spotlightStyles:u}=this;if(r())return null;let p=n!=="center"&&e&&Y.createElement(Une,{styles:u});if(pj()==="safari"){const{mixBlendMode:i,zIndex:b,...C}=a;p=Y.createElement("div",{style:{...C}},p),delete a.backgroundColor}return Y.createElement("div",{className:"react-joyride__overlay","data-test-id":"overlay",onClick:t,role:"presentation",style:a},p)}},$ne=class extends Y.Component{constructor(){super(...arguments),dr(this,"node",null)}componentDidMount(){const{id:e}=this.props;p_()&&(this.node=document.createElement("div"),this.node.id=e,document.body.appendChild(this.node),I1||this.renderReact15())}componentDidUpdate(){p_()&&(I1||this.renderReact15())}componentWillUnmount(){!p_()||!this.node||(I1||Jd.unmountComponentAtNode(this.node),this.node.parentNode===document.body&&(document.body.removeChild(this.node),this.node=null))}renderReact15(){if(!p_())return;const{children:e}=this.props;this.node&&Jd.unstable_renderSubtreeIntoContainer(this,e,this.node)}renderReact16(){if(!p_()||!I1)return null;const{children:e}=this.props;return this.node?Jd.createPortal(e,this.node):null}render(){return I1?this.renderReact16():null}},qne=class{constructor(e,t){if(dr(this,"element"),dr(this,"options"),dr(this,"canBeTabbed",n=>{const{tabIndex:r}=n;return r===null||r<0?!1:this.canHaveFocus(n)}),dr(this,"canHaveFocus",n=>{const r=/input|select|textarea|button|object/,a=n.nodeName.toLowerCase();return(r.test(a)&&!n.getAttribute("disabled")||a==="a"&&!!n.getAttribute("href"))&&this.isVisible(n)}),dr(this,"findValidTabElements",()=>[].slice.call(this.element.querySelectorAll("*"),0).filter(this.canBeTabbed)),dr(this,"handleKeyDown",n=>{const{code:r="Tab"}=this.options;n.code===r&&this.interceptTab(n)}),dr(this,"interceptTab",n=>{n.preventDefault();const r=this.findValidTabElements(),{shiftKey:a}=n;if(!r.length)return;let u=document.activeElement?r.indexOf(document.activeElement):0;u===-1||!a&&u+1===r.length?u=0:a&&u===0?u=r.length-1:u+=a?-1:1,r[u].focus()}),dr(this,"isHidden",n=>{const r=n.offsetWidth<=0&&n.offsetHeight<=0,a=window.getComputedStyle(n);return r&&!n.innerHTML?!0:r&&a.getPropertyValue("overflow")!=="visible"||a.getPropertyValue("display")==="none"}),dr(this,"isVisible",n=>{let r=n;for(;r;)if(r instanceof HTMLElement){if(r===document.body)break;if(this.isHidden(r))return!1;r=r.parentNode}return!0}),dr(this,"removeScope",()=>{window.removeEventListener("keydown",this.handleKeyDown)}),dr(this,"checkFocus",n=>{document.activeElement!==n&&(n.focus(),window.requestAnimationFrame(()=>this.checkFocus(n)))}),dr(this,"setFocus",()=>{const{selector:n}=this.options;if(!n)return;const r=this.element.querySelector(n);r&&window.requestAnimationFrame(()=>this.checkFocus(r))}),!(e instanceof HTMLElement))throw new TypeError("Invalid parameter: element must be an HTMLElement");this.element=e,this.options=t,window.addEventListener("keydown",this.handleKeyDown,!1),this.setFocus()}},Hne=class extends Y.Component{constructor(e){if(super(e),dr(this,"beacon",null),dr(this,"setBeaconRef",a=>{this.beacon=a}),e.beaconComponent)return;const t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.id="joyride-beacon-animation",e.nonce&&n.setAttribute("nonce",e.nonce),n.appendChild(document.createTextNode(`
        @keyframes joyride-beacon-inner {
          20% {
            opacity: 0.9;
          }
        
          90% {
            opacity: 0.7;
          }
        }
        
        @keyframes joyride-beacon-outer {
          0% {
            transform: scale(1);
          }
        
          45% {
            opacity: 0.7;
            transform: scale(0.75);
          }
        
          100% {
            opacity: 0.9;
            transform: scale(1);
          }
        }
      `)),t.appendChild(n)}componentDidMount(){const{shouldFocus:e}=this.props;setTimeout(()=>{ur.domElement(this.beacon)&&e&&this.beacon.focus()},0)}componentWillUnmount(){const e=document.getElementById("joyride-beacon-animation");e!=null&&e.parentNode&&e.parentNode.removeChild(e)}render(){const{beaconComponent:e,continuous:t,index:n,isLastStep:r,locale:a,onClickOrHover:u,size:p,step:i,styles:b}=this.props,C=xp(a.open),A={"aria-label":C,onClick:u,onMouseEnter:u,ref:this.setBeaconRef,title:C};let R;if(e){const z=e;R=Y.createElement(z,{continuous:t,index:n,isLastStep:r,size:p,step:i,...A})}else R=Y.createElement("button",{key:"JoyrideBeacon",className:"react-joyride__beacon","data-test-id":"button-beacon",style:b.beacon,type:"button",...A},Y.createElement("span",{style:b.beaconInner}),Y.createElement("span",{style:b.beaconOuter}));return R}};function Wne({styles:e,...t}){const{color:n,height:r,width:a,...u}=e;return Zt.createElement("button",{style:u,type:"button",...t},Zt.createElement("svg",{height:typeof r=="number"?`${r}px`:r,preserveAspectRatio:"xMidYMid",version:"1.1",viewBox:"0 0 18 18",width:typeof a=="number"?`${a}px`:a,xmlns:"http://www.w3.org/2000/svg"},Zt.createElement("g",null,Zt.createElement("path",{d:"M8.13911129,9.00268191 L0.171521827,17.0258467 C-0.0498027049,17.248715 -0.0498027049,17.6098394 0.171521827,17.8327545 C0.28204354,17.9443526 0.427188206,17.9998706 0.572051765,17.9998706 C0.71714958,17.9998706 0.862013139,17.9443526 0.972581703,17.8327545 L9.0000937,9.74924618 L17.0276057,17.8327545 C17.1384085,17.9443526 17.2832721,17.9998706 17.4281356,17.9998706 C17.5729992,17.9998706 17.718097,17.9443526 17.8286656,17.8327545 C18.0499901,17.6098862 18.0499901,17.2487618 17.8286656,17.0258467 L9.86135722,9.00268191 L17.8340066,0.973848225 C18.0553311,0.750979934 18.0553311,0.389855532 17.8340066,0.16694039 C17.6126821,-0.0556467968 17.254037,-0.0556467968 17.0329467,0.16694039 L9.00042166,8.25611765 L0.967006424,0.167268345 C0.745681892,-0.0553188426 0.387317931,-0.0553188426 0.165993399,0.167268345 C-0.0553311331,0.390136635 -0.0553311331,0.751261038 0.165993399,0.974176179 L8.13920499,9.00268191 L8.13911129,9.00268191 Z",fill:n}))))}var Xne=Wne;function Zne(e){const{backProps:t,closeProps:n,index:r,isLastStep:a,primaryProps:u,skipProps:p,step:i,tooltipProps:b}=e,{content:C,hideBackButton:A,hideCloseButton:R,hideFooter:z,showSkipButton:V,styles:W,title:X}=i,ue={};return ue.primary=Y.createElement("button",{"data-test-id":"button-primary",style:W.buttonNext,type:"button",...u}),V&&!a&&(ue.skip=Y.createElement("button",{"aria-live":"off","data-test-id":"button-skip",style:W.buttonSkip,type:"button",...p})),!A&&r>0&&(ue.back=Y.createElement("button",{"data-test-id":"button-back",style:W.buttonBack,type:"button",...t})),ue.close=!R&&Y.createElement(Xne,{"data-test-id":"button-close",styles:W.buttonClose,...n}),Y.createElement("div",{key:"JoyrideTooltip","aria-label":xp(X??C),className:"react-joyride__tooltip",style:W.tooltip,...b},Y.createElement("div",{style:W.tooltipContainer},X&&Y.createElement("h1",{"aria-label":xp(X),style:W.tooltipTitle},X),Y.createElement("div",{style:W.tooltipContent},C)),!z&&Y.createElement("div",{style:W.tooltipFooter},Y.createElement("div",{style:W.tooltipFooterSpacer},ue.skip),ue.back,ue.primary),ue.close)}var Yne=Zne,Kne=class extends Y.Component{constructor(){super(...arguments),dr(this,"handleClickBack",e=>{e.preventDefault();const{helpers:t}=this.props;t.prev()}),dr(this,"handleClickClose",e=>{e.preventDefault();const{helpers:t}=this.props;t.close("button_close")}),dr(this,"handleClickPrimary",e=>{e.preventDefault();const{continuous:t,helpers:n}=this.props;if(!t){n.close("button_primary");return}n.next()}),dr(this,"handleClickSkip",e=>{e.preventDefault();const{helpers:t}=this.props;t.skip()}),dr(this,"getElementsProps",()=>{const{continuous:e,index:t,isLastStep:n,setTooltipRef:r,size:a,step:u}=this.props,{back:p,close:i,last:b,next:C,nextLabelWithProgress:A,skip:R}=u.locale,z=xp(p),V=xp(i),W=xp(b),X=xp(C),ue=xp(R);let ie=i,K=V;if(e){if(ie=C,K=X,u.showProgress&&!n){const ee=xp(A,{step:t+1,steps:a});ie=C2(A,t+1,a),K=ee}n&&(ie=b,K=W)}return{backProps:{"aria-label":z,children:p,"data-action":"back",onClick:this.handleClickBack,role:"button",title:z},closeProps:{"aria-label":V,children:i,"data-action":"close",onClick:this.handleClickClose,role:"button",title:V},primaryProps:{"aria-label":K,children:ie,"data-action":"primary",onClick:this.handleClickPrimary,role:"button",title:K},skipProps:{"aria-label":ue,children:R,"data-action":"skip",onClick:this.handleClickSkip,role:"button",title:ue},tooltipProps:{"aria-modal":!0,ref:r,role:"alertdialog"}}})}render(){const{continuous:e,index:t,isLastStep:n,setTooltipRef:r,size:a,step:u}=this.props,{beaconComponent:p,tooltipComponent:i,...b}=u;let C;if(i){const A={...this.getElementsProps(),continuous:e,index:t,isLastStep:n,size:a,step:b,setTooltipRef:r},R=i;C=Y.createElement(R,{...A})}else C=Y.createElement(Yne,{...this.getElementsProps(),continuous:e,index:t,isLastStep:n,size:a,step:u});return C}},Jne=class extends Y.Component{constructor(){super(...arguments),dr(this,"scope",null),dr(this,"tooltip",null),dr(this,"handleClickHoverBeacon",e=>{const{step:t,store:n}=this.props;e.type==="mouseenter"&&t.event!=="hover"||n.update({lifecycle:ri.TOOLTIP})}),dr(this,"setTooltipRef",e=>{this.tooltip=e}),dr(this,"setPopper",(e,t)=>{var n;const{action:r,lifecycle:a,step:u,store:p}=this.props;t==="wrapper"?p.setPopper("beacon",e):p.setPopper("tooltip",e),p.getPopper("beacon")&&(p.getPopper("tooltip")||u.placement==="center")&&a===ri.INIT&&p.update({action:r,lifecycle:ri.READY}),(n=u.floaterProps)!=null&&n.getPopper&&u.floaterProps.getPopper(e,t)}),dr(this,"renderTooltip",e=>{const{continuous:t,helpers:n,index:r,size:a,step:u}=this.props;return Y.createElement(Kne,{continuous:t,helpers:n,index:r,isLastStep:r+1===a,setTooltipRef:this.setTooltipRef,size:a,step:u,...e})})}componentDidMount(){const{debug:e,index:t}=this.props;rv({title:`step:${t}`,data:[{key:"props",value:this.props}],debug:e})}componentDidUpdate(e){var t;const{action:n,callback:r,continuous:a,controlled:u,debug:p,helpers:i,index:b,lifecycle:C,shouldScroll:A,status:R,step:z,store:V}=this.props,{changed:W,changedFrom:X}=aE(e,this.props),ue=i.info(),ie=a&&n!==ro.CLOSE&&(b>0||n===ro.PREV),K=W("action")||W("index")||W("lifecycle")||W("status"),ee=X("lifecycle",[ri.TOOLTIP,ri.INIT],ri.INIT),ae=W("action",[ro.NEXT,ro.PREV,ro.SKIP,ro.CLOSE]),he=u&&b===e.index;if(ae&&(ee||he)&&r({...ue,index:e.index,lifecycle:ri.COMPLETE,step:e.step,type:Zd.STEP_AFTER}),z.placement==="center"&&R===Mi.RUNNING&&W("index")&&n!==ro.START&&C===ri.INIT&&V.update({lifecycle:ri.READY}),K){const xe=qm(z.target),ye=!!xe;ye&&Ene(xe)?(X("status",Mi.READY,Mi.RUNNING)||X("lifecycle",ri.INIT,ri.READY))&&r({...ue,step:z,type:Zd.STEP_BEFORE}):(console.warn(ye?"Target not visible":"Target not mounted",z),r({...ue,type:Zd.TARGET_NOT_FOUND,step:z}),u||V.update({index:b+(n===ro.PREV?-1:1)}))}X("lifecycle",ri.INIT,ri.READY)&&V.update({lifecycle:QN(z)||ie?ri.TOOLTIP:ri.BEACON}),W("index")&&rv({title:`step:${C}`,data:[{key:"props",value:this.props}],debug:p}),W("lifecycle",ri.BEACON)&&r({...ue,step:z,type:Zd.BEACON}),W("lifecycle",ri.TOOLTIP)&&(r({...ue,step:z,type:Zd.TOOLTIP}),A&&this.tooltip&&(this.scope=new qne(this.tooltip,{selector:"[data-action=primary]"}),this.scope.setFocus())),X("lifecycle",[ri.TOOLTIP,ri.INIT],ri.INIT)&&((t=this.scope)==null||t.removeScope(),V.cleanupPoppers())}componentWillUnmount(){var e;(e=this.scope)==null||e.removeScope()}get open(){const{lifecycle:e,step:t}=this.props;return QN(t)||e===ri.TOOLTIP}render(){const{continuous:e,debug:t,index:n,nonce:r,shouldScroll:a,size:u,step:p}=this.props,i=qm(p.target);return!_j(p)||!ur.domElement(i)?null:Y.createElement("div",{key:`JoyrideStep-${n}`,className:"react-joyride__step"},Y.createElement(vP,{...p.floaterProps,component:this.renderTooltip,debug:t,getPopper:this.setPopper,id:`react-joyride-step-${n}`,open:this.open,placement:p.placement,target:p.target},Y.createElement(Hne,{beaconComponent:p.beaconComponent,continuous:e,index:n,isLastStep:n+1===u,locale:p.locale,nonce:r,onClickOrHover:this.handleClickHoverBeacon,shouldFocus:a,size:u,step:p,styles:p.styles})))}},vj=class extends Y.Component{constructor(e){super(e),dr(this,"helpers"),dr(this,"store"),dr(this,"callback",p=>{const{callback:i}=this.props;ur.function(i)&&i(p)}),dr(this,"handleKeyboard",p=>{const{index:i,lifecycle:b}=this.state,{steps:C}=this.props,A=C[i];b===ri.TOOLTIP&&p.code==="Escape"&&A&&!A.disableCloseOnEsc&&this.store.close("keyboard")}),dr(this,"handleClickOverlay",()=>{const{index:p}=this.state,{steps:i}=this.props;d0(this.props,i[p]).disableOverlayClose||this.helpers.close("overlay")}),dr(this,"syncState",p=>{this.setState(p)});const{debug:t,getHelpers:n,run:r=!0,stepIndex:a}=e;this.store=jne({...e,controlled:r&&ur.number(a)}),this.helpers=this.store.getHelpers();const{addListener:u}=this.store;rv({title:"init",data:[{key:"props",value:this.props},{key:"state",value:this.state}],debug:t}),u(this.syncState),n&&n(this.helpers),this.state=this.store.getState()}componentDidMount(){if(!p_())return;const{debug:e,disableCloseOnEsc:t,run:n,steps:r}=this.props,{start:a}=this.store;nk(r,e)&&n&&a(),t||document.body.addEventListener("keydown",this.handleKeyboard,{passive:!0})}componentDidUpdate(e,t){if(!p_())return;const{action:n,controlled:r,index:a,status:u}=this.state,{debug:p,run:i,stepIndex:b,steps:C}=this.props,{stepIndex:A,steps:R}=e,{reset:z,setSteps:V,start:W,stop:X,update:ue}=this.store,{changed:ie}=aE(e,this.props),{changed:K,changedFrom:ee}=aE(t,this.state),ae=d0(this.props,C[a]),he=!wu(R,C),xe=ur.number(b)&&ie("stepIndex"),ye=qm(ae.target);if(he&&(nk(C,p)?V(C):console.warn("Steps are not valid",C)),ie("run")&&(i?W(b):X()),xe){let Re=ur.number(A)&&A<b?ro.NEXT:ro.PREV;n===ro.STOP&&(Re=ro.START),[Mi.FINISHED,Mi.SKIPPED].includes(u)||ue({action:n===ro.CLOSE?ro.CLOSE:Re,index:b,lifecycle:ri.INIT})}!r&&u===Mi.RUNNING&&a===0&&!ye&&(this.store.update({index:a+1}),this.callback({...this.state,type:Zd.TARGET_NOT_FOUND,step:ae}));const Se={...this.state,index:a,step:ae};if(K("action",[ro.NEXT,ro.PREV,ro.SKIP,ro.CLOSE])&&K("status",Mi.PAUSED)){const Re=d0(this.props,C[t.index]);this.callback({...Se,index:t.index,lifecycle:ri.COMPLETE,step:Re,type:Zd.STEP_AFTER})}if(K("status",[Mi.FINISHED,Mi.SKIPPED])){const Re=d0(this.props,C[t.index]);r||this.callback({...Se,index:t.index,lifecycle:ri.COMPLETE,step:Re,type:Zd.STEP_AFTER}),this.callback({...Se,type:Zd.TOUR_END,step:Re,index:t.index}),z()}else ee("status",[Mi.IDLE,Mi.READY],Mi.RUNNING)?this.callback({...Se,type:Zd.TOUR_START}):(K("status")||K("action",ro.RESET))&&this.callback({...Se,type:Zd.TOUR_STATUS});this.scrollToStep(t)}componentWillUnmount(){const{disableCloseOnEsc:e}=this.props;e||document.body.removeEventListener("keydown",this.handleKeyboard)}scrollToStep(e){const{index:t,lifecycle:n,status:r}=this.state,{debug:a,disableScrollParentFix:u=!1,scrollDuration:p,scrollOffset:i=20,scrollToFirstStep:b=!1,steps:C}=this.props,A=d0(this.props,C[t]),R=qm(A.target),z=Lne({isFirstStep:t===0,lifecycle:n,previousLifecycle:e.lifecycle,scrollToFirstStep:b,step:A,target:R});if(r===Mi.RUNNING&&z){const V=sC(R,u),W=hb(R,u);let X=Math.floor(Tne(R,i,u))||0;rv({title:"scrollToStep",data:[{key:"index",value:t},{key:"lifecycle",value:n},{key:"status",value:r}],debug:a});const ue=this.store.getPopper("beacon"),ie=this.store.getPopper("tooltip");if(n===ri.BEACON&&ue){const{offsets:K,placement:ee}=ue;!["bottom"].includes(ee)&&!V&&(X=Math.floor(K.popper.top-i))}else if(n===ri.TOOLTIP&&ie){const{flipped:K,offsets:ee,placement:ae}=ie;["top","right","left"].includes(ae)&&!K&&!V?X=Math.floor(ee.popper.top-i):X-=A.spotlightPadding}X=X>=0?X:0,r===Mi.RUNNING&&Ine(X,{element:W,duration:p}).then(()=>{setTimeout(()=>{var K;(K=this.store.getPopper("tooltip"))==null||K.instance.update()},10)})}}render(){if(!p_())return null;const{index:e,lifecycle:t,status:n}=this.state,{continuous:r=!1,debug:a=!1,nonce:u,scrollToFirstStep:p=!1,steps:i}=this.props,b=n===Mi.RUNNING,C={};if(b&&i[e]){const A=d0(this.props,i[e]);C.step=Y.createElement(Jne,{...this.state,callback:this.callback,continuous:r,debug:a,helpers:this.helpers,nonce:u,shouldScroll:!A.disableScrolling&&(e!==0||p),step:A,store:this.store}),C.overlay=Y.createElement($ne,{id:"react-joyride-portal"},Y.createElement(Gne,{...A,continuous:r,debug:a,lifecycle:t,onClickOverlay:this.handleClickOverlay}))}return Y.createElement("div",{className:"react-joyride"},C.step,C.overlay)}};dr(vj,"defaultProps",Nne);var xj=vj;function mv({steps:e,run:t,onStop:n,zIndex:r=1e4,disableOverlay:a=!1,stepIndex:u=0,onStepChange:p}){return t?Jd.createPortal(G.jsx(xj,{run:t,steps:e,stepIndex:u,continuous:!0,showSkipButton:!1,showProgress:!0,disableOverlay:a,spotlightClicks:!0,disableScrolling:!0,disableCloseOnEsc:!0,hideBackButton:!1,hideCloseButton:!1,scrollToFirstStep:!1,scrollOffset:0,floaterProps:{disableAnimation:!0,hideArrow:!1,offset:10,styles:{wrapper:{pointerEvents:"auto"}},options:{preventOverflow:{boundariesElement:"viewport"}}},styles:{options:{zIndex:r,primaryColor:"#4182C4",overlayColor:a?"transparent":"rgba(0, 0, 0, 0.3)",spotlightShadow:"none"},tooltip:{borderRadius:"0.5rem",width:300,fontSize:16,height:"auto",pointerEvents:"auto"},tooltipContent:{padding:"12px"},buttonNext:{backgroundColor:"#4182C4",fontSize:14,padding:"8px 16px"},buttonBack:{color:"grey",fontSize:14,padding:"8px 16px"},buttonClose:{padding:"8px",color:"red"}},callback:i=>{const{action:b,index:C,status:A,type:R}=i;R==="step:after"&&(b==="next"||b==="prev")&&p&&p(b==="next"?C+1:C-1),(A==="finished"||A==="skipped"||b==="close")&&n()}}),document.body):null}const ik=[{target:".upload-files",content:"Drag and drop your files here, or click to select them.",disableBeacon:!0},{target:".layer-form",content:"Configure color, opacity and name for your layer(s).",disableBeacon:!0},{target:".layer-upload-btn",content:"Click here to upload your layer(s).",disableBeacon:!0}],ok=[{target:".feature-extraction",content:"We will now extract the area of Trondheim municipality from the Trndelag county boundary.",disableBeacon:!0,placement:"center"},{target:".input-layer",content:"First, select the 'trondelag' layer from this dropdown.",disableBeacon:!0,placement:"right"},{target:".rows-per-page",content:"Next, set the number of rows per page to 50 to see all features at once.",disableBeacon:!0,placement:"top"},{target:".scroll-table",content:"Scroll down to find the row which contains 'Trondheim - Trante' in the 'kommmunenavn' column.",disableBeacon:!0,placement:"top"},{target:".select-trondheim-checkbox",content:"Select the corresponding checkbox of Trondheim. (Hint: it should be the last row.)",disableBeacon:!0,placement:"left"},{target:".save-btn",content:"Finally, click 'Save' to create a new layer with the extracted feature.",disableBeacon:!0,placement:"top"}],sk=[{target:".feature-extraction",content:"We will now extract shallow water areas from the depth layer.",disableBeacon:!0,placement:"center"},{target:".input-layer",content:"Select the 'trondheim-depth' layer as the input layer.",disableBeacon:!0,placement:"right"},{target:"[data-testid='select-field']",content:"Select the 'maksimumsdybde' field from this dropdown.",disableBeacon:!0,placement:"left"},{target:"[data-testid='operator-select']",content:"Choose the '<=' (less than or equal to) operator.",disableBeacon:!0,placement:"top"},{target:"[data-testid='value-input']",content:"Type '5' in this value field to filter for shallow water areas.",disableBeacon:!0,placement:"bottom"},{target:"[data-testid='add-filter-btn']",content:"Click 'Add Filter' to apply the filter condition.",disableBeacon:!0,placement:"bottom"},{target:".select-all-checkbox",content:"Now select all features by clicking the checkbox in the header row.",disableBeacon:!0,placement:"left"},{target:".save-btn",content:"Click 'Save' to create a new layer with the extracted shallow water areas.",disableBeacon:!0,placement:"top"}],ak=[{target:".clip-input-layer",content:"Select 'swimming-spots' and 'AIS' as input.",disableBeacon:!0,placement:"left"},{target:".clip-clip-layer",content:"Select the 'trondheim' layer as the clip layer.",disableBeacon:!0,placement:"right"},{target:".clip-styles",content:"Adjust the styles for the clipped layers. Try to set 100% opacity and a bright color for the swimming spots layer to make them stand out.",disableBeacon:!0,placement:"top"},{target:".clip-btn",content:"Click to clip the layers. Be patient, this may take a few seconds.",disableBeacon:!0,placement:"left"}],lk=[{target:".dissolve-tool",content:"We will now dissolve the depth layer to simplify it.",disableBeacon:!0,placement:"center"},{target:".dissolve-input-layer",content:"Select the trondheim-depth layer as the input layer.",disableBeacon:!0,placement:"left"},{target:".dissolve-field",content:"Select the 'maksimumsdybde' field to dissolve polygons with the same maximum depth value.",disableBeacon:!0,placement:"left"},{target:".dissolve-form",content:"Name the new layer 'depth-dissolved' and adjust the styles if needed.",disableBeacon:!0,placement:"left"},{target:".dissolve-btn",content:"Click save to dissolve the layer. This will take a few seconds.",disableBeacon:!0,placement:"left"}],uk=[{target:".buffer-tool",content:"We will now create a buffer around the AIS data to avoid areas with heavy boat/ship traffic.",disableBeacon:!0,placement:"center"},{target:".buffer-input-layer",content:"Select the AIS layer as the input layer.",disableBeacon:!0,placement:"left"},{target:".buffer-distance",content:"Set the buffer distance to 300 meters.",disableBeacon:!0,placement:"right"},{target:".buffer-btn",content:"Click to create the buffer.",disableBeacon:!0}],ck=[{target:".difference-tool",content:"We will now find suitable kayaking areas by subtracting the trafficated areas from the shallow water areas.",disableBeacon:!0,placement:"center"},{target:".difference-base-layer",content:"Select the 'shallow-water' layer as the base input layer.",disableBeacon:!0,placement:"left"},{target:".difference-subtract-layer",content:"Select the 'traffic' layer as the layer to subtract.",disableBeacon:!0,placement:"right"},{target:".difference-styles",content:"Name the new layer 'Kayaking areas' and set a 20% opacity.",disableBeacon:!0,placement:"top"},{target:".difference-btn",content:"Click to create the difference layer. This will take a few seconds.",disableBeacon:!0,placement:"left"}],Qne=[{target:".map-container",content:"Click on a desired swimming spot to start your line. Then move the cursor and continue clicking to add points along your desired path through the shallow, safe areas. To finish a line, double-click or press 'Enter' on your keyboard.",disableBeacon:!0,placement:"center"},{target:".bottom-toolbar",content:"Use these controls while drawing: 'Add another' to create multiple lines, 'Clear all' to restart your drawing, or 'Cancel' to exit drawing mode without saving.",disableBeacon:!0,placement:"top"},{target:".finish-btn",content:"When you're happy with your route, click 'Finish' to save it as a new layer.",disableBeacon:!0,placement:"top"}];var ere="container_509563",tre="inner_231322",_I="cube_568da8",yI="cube__inner_37e6c8";const Ix=({size:e=45,color:t="black",speed:n=1.75})=>G.jsx("div",{className:ere,style:{"--uib-size":e+"px","--uib-color":t,"--uib-speed":n+"s"},children:G.jsxs("div",{className:tre,children:[G.jsx("div",{className:_I,children:G.jsx("div",{className:yI})}),G.jsx("div",{className:_I,children:G.jsx("div",{className:yI})}),G.jsx("div",{className:_I,children:G.jsx("div",{className:yI})})]})});function nre({open:e,onOpenChange:t}){const[n,r]=Y.useState(""),[a,u]=Y.useState(null),[p,i]=Y.useState(""),[b,C]=Y.useState(Ds()),[A,R]=Y.useState(1),[z,V]=Y.useState({layer:!1,distance:!1}),[W,X]=Y.useState(!1),[ue,ie]=Y.useState(!1),[K,ee]=Y.useState(0),{layers:ae,addLayer:he}=wo();async function xe(je,Re,De){return new Promise((at,ot)=>{setTimeout(()=>{try{const Fe=ae.find(We=>We.id===je);if(!Fe)throw new Error("Layer not found");const Ze=hee(Fe.data,Re,{units:"meters"}),Ve=Ze.features[0],mt=(Ve==null?void 0:Ve.geometry.type)==="Polygon"?"Polygon":"MultiPolygon";he({id:cg(),name:De,data:Ze,visible:!0,fillColor:b,fillOpacity:A,geometryType:mt},b,A),at()}catch(Fe){ot(Fe)}},0)})}async function ye(){X(!0);const je=!!n,Re=!!a;if(!je||!Re){V({layer:!je,distance:!Re}),X(!1);return}try{await new Promise(De=>setTimeout(De,0)),await xe(n,a,p),t(!1),Se(),C_({title:"Buffer Created",description:`Buffer layer "${p}" created successfully.`,icon:Sa})}catch(De){console.error("Buffer operation failed:",De)}finally{X(!1)}}const Se=()=>{r(""),u(null),i(""),C(Ds()),V({layer:!1,distance:!1})};return G.jsxs(G.Fragment,{children:[G.jsx(lv,{open:e,onOpenChange:je=>{t(je),je||(Se(),X(!1))},title:"Buffer",description:"Create a polygon at a specified distance around the input layer.",onSave:ye,actions:G.jsx(Qr,{onClick:()=>ie(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})}),saveButtonClassName:"buffer-btn",children:G.jsxs("div",{className:"buffer-tool",children:[G.jsx(lK,{selectedLayerId:n,setSelectedLayerId:r,bufferDistance:a,setBufferDistance:u,layerName:p,setLayerName:i,errors:z}),G.jsx(jp,{layerName:p,onNameChange:i,fillColor:b,fillOpacity:A,onFillColorChange:C,onFillOpacityChange:R}),W&&G.jsx("div",{className:"flex justify-center items-center mt-4",children:G.jsx(Ix,{color:"#ff8847",size:60})})]})}),G.jsx(mv,{steps:uk,run:ue&&e,onStop:()=>{ie(!1),ee(0)},stepIndex:K,onStepChange:je=>ee(Math.max(0,Math.min(je,uk.length-1))),disableOverlay:!0})]})}function rre({selectedLayerId:e,setSelectedLayerId:t,dissolveField:n,setDissolveField:r,setLayerName:a,errors:u}){const{layers:p}=wo(),[i,b]=Y.useState(!1),[C,A]=Y.useState(!1),R=p.find(W=>W.id===e),z=R?R.name:"Choose input layer",V=Y.useMemo(()=>{if(!R)return[];const W=R.data.features.find(X=>X.properties);return W?Object.keys(W.properties):[]},[R]);return G.jsx(G.Fragment,{children:G.jsxs("div",{className:"space-y-4",children:[G.jsxs(Kh,{open:i,onOpenChange:b,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-full justify-between dissolve-input-layer",u.layer&&"border-red-500 border-2"),children:[z,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-full p-0",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No layers found."}),G.jsx(td,{children:p.map(W=>G.jsxs(Gc,{value:W.name,onSelect:()=>{t(W.id),a(ba(`${W.name}-dissolve`)),r(null),b(!1)},children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",W.id===e?"opacity-100":"opacity-0")}),W.name]},W.id))})]})]})})]}),R&&V.length>0&&G.jsxs(Kh,{open:C,onOpenChange:A,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"secondary",className:"w-full justify-between dissolve-field",children:[n??"Dissolve by field (optional)",G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-full p-0",children:G.jsx(Qh,{children:G.jsx(ed,{children:G.jsxs(td,{children:[G.jsxs(Gc,{value:"None",onSelect:()=>r(null),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",n===null?"opacity-100":"opacity-0")}),"(merge all)"]},"__none__"),V.map(W=>G.jsxs(Gc,{value:W,onSelect:()=>r(W),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",W===n?"opacity-100":"opacity-0")}),W]},W))]})})})})]}),G.jsx("div",{className:"text-red-500 text-sm m-auto text-center pb-2",children:u.layer&&G.jsx("p",{children:"Please select a layer."})})]})})}function ire({open:e,onOpenChange:t}){const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState(""),[p,i]=Y.useState(null),[b,C]=Y.useState(""),[A,R]=Y.useState(Ds()),[z,V]=Y.useState(.7),[W,X]=Y.useState(!1),[ue,ie]=Y.useState({layer:!1}),[K,ee]=Y.useState(!1),[ae,he]=Y.useState(0),xe=G.jsx(Qr,{onClick:()=>ee(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})});function ye(){ee(!1),he(0)}function Se(Fe){he(Math.max(0,Math.min(Fe,lk.length-1)))}async function je(){X(!0);const Fe=!!a;if(!Fe){ie({layer:!Fe}),X(!1);return}try{await new Promise(Ze=>setTimeout(Ze,0)),await De(a,p),C_({title:"Dissolve completed",description:`New layer "${b}" created successfully!`,icon:Sa}),X(!1),t(!1),u(""),i(null),C(""),R(Ds()),ie({layer:!1})}catch(Ze){console.error("Dissolve operation failed:",Ze),X(!1),alert(`Dissolve failed: ${Ze instanceof Error?Ze.message:"Unknown error"}`)}}function Re(Fe){try{if(!Fe.geometry||!Fe.geometry.coordinates)return!1;if(Fe.geometry.type==="Polygon"){const Ze=Fe.geometry.coordinates;if(!Ze||Ze.length===0)return!1;for(const Ve of Ze){if(!Ve||Ve.length<4)return!1;const mt=Ve[0],We=Ve[Ve.length-1];if(!mt||!We||mt.length<2||We.length<2||Math.abs(mt[0]-We[0])>1e-10||Math.abs(mt[1]-We[1])>1e-10)return!1}return!0}else if(Fe.geometry.type==="MultiPolygon"){const Ze=Fe.geometry.coordinates;if(!Ze||Ze.length===0)return!1;for(const Ve of Ze){if(!Ve||Ve.length===0)return!1;for(const mt of Ve){if(!mt||mt.length<4)return!1;const We=mt[0],tt=mt[mt.length-1];if(!We||!tt||We.length<2||tt.length<2||Math.abs(We[0]-tt[0])>1e-10||Math.abs(We[1]-tt[1])>1e-10)return!1}}return!0}return!1}catch(Ze){return console.warn("Geometry validation error:",Ze),!1}}async function De(Fe,Ze){return new Promise((Ve,mt)=>{setTimeout(()=>{try{const We=n.find($e=>$e.id===Fe);if(!We)throw new Error("Source layer not found");const tt=We.data.features.filter($e=>$e.geometry&&($e.geometry.type==="Polygon"||$e.geometry.type==="MultiPolygon"));if(tt.length===0)throw new Error("No polygon or multipolygon features found in the selected layer");const Dt=tt.filter($e=>Re($e));if(Dt.length===0)throw new Error("No valid polygon geometries found");if(console.log(`Found ${Dt.length} valid features out of ${tt.length} total polygon features`),Ze){const $e={};Dt.forEach(Yt=>{var Ut;const Kt=(Ut=Yt.properties)==null?void 0:Ut[Ze],nn=Kt!=null?String(Kt):"__null__";$e[nn]||($e[nn]=[]),$e[nn].push(Yt)});const Ke=[];for(const[Yt,Kt]of Object.entries($e)){const nn=at(Kt,Ze,Yt);nn&&Ke.push(nn)}if(Ke.length===0)throw new Error("No features were successfully dissolved");const gt={id:cg(),name:b,data:{type:"FeatureCollection",features:Ke},fillColor:A,fillOpacity:z,visible:!0,geometryType:"Polygon"};r(gt,A,z)}else{const $e=ot(Dt);if(!$e)throw new Error("Failed to dissolve all features into single feature");const Ke={id:cg(),name:b,data:{type:"FeatureCollection",features:[$e]},fillColor:A,fillOpacity:z,visible:!0,geometryType:"Polygon"};r(Ke,A,z)}Ve()}catch(We){mt(We)}},0)})}function at(Fe,Ze,Ve){try{if(Fe.length===0)return null;if(Fe.length===1)return{...Fe[0],properties:{[Ze]:Ve==="__null__"?null:Ve}};const mt={type:"FeatureCollection",features:Fe};try{const We=bN(mt,{propertyName:Ze});if(We.features.length>0)return{...We.features[0],properties:{[Ze]:Ve==="__null__"?null:Ve}};throw new Error("Dissolve returned no features")}catch(We){console.warn(`Turf dissolve failed for group ${Ve}, trying union approach:`,We);try{let tt=Fe[0];for(let Dt=1;Dt<Fe.length;Dt++)tt=S0(tt,Fe[Dt]);return{...tt,properties:{[Ze]:Ve==="__null__"?null:Ve}}}catch(tt){console.warn(`Union also failed for group ${Ve}:`,tt);let Dt=[];return Fe.forEach($e=>{$e.geometry.type==="Polygon"?Dt.push($e.geometry.coordinates):$e.geometry.type==="MultiPolygon"&&Dt.push(...$e.geometry.coordinates)}),Dt.length===0?null:{type:"Feature",geometry:{type:"MultiPolygon",coordinates:Dt},properties:{[Ze]:Ve==="__null__"?null:Ve}}}}}catch(mt){return console.warn(`Failed to dissolve group ${Ve}:`,mt),null}}function ot(Fe){try{if(Fe.length===1)return{...Fe[0],properties:{}};const Ze={type:"FeatureCollection",features:Fe};try{const Ve=bN(Ze);if(Ve.features.length>0){let mt=Ve.features[0];for(let We=1;We<Ve.features.length;We++)mt=S0(mt,Ve.features[We]);return{...mt,properties:{}}}else throw new Error("Dissolve returned no features")}catch(Ve){console.warn("Turf dissolve failed, trying union approach:",Ve);try{let mt=Fe[0];for(let We=1;We<Fe.length;We++)mt=S0(mt,Fe[We]);return{...mt,properties:{}}}catch(mt){console.warn("Union also failed, combining without dissolving:",mt);let We=[];return Fe.forEach(tt=>{tt.geometry.type==="Polygon"?We.push(tt.geometry.coordinates):tt.geometry.type==="MultiPolygon"&&We.push(...tt.geometry.coordinates)}),We.length===0?null:{type:"Feature",geometry:{type:"MultiPolygon",coordinates:We},properties:{}}}}}catch(Ze){return console.warn("Failed to dissolve all features:",Ze),null}}return G.jsxs(G.Fragment,{children:[G.jsx(lv,{open:e,onOpenChange:Fe=>{t(Fe),Fe||(u(""),i(null),C(""),ie({layer:!1}))},title:"Dissolve",onSave:je,description:p?`Merges all polygons that share the same value in "${p}" into single features, removing internal boundaries.`:"Merges all polygons of the selected layer into one feature, removing internal boundaries.",actions:xe,saveButtonClassName:"dissolve-btn",children:G.jsxs("div",{className:"dissolve-tool",children:[G.jsx(rre,{selectedLayerId:a,setSelectedLayerId:u,dissolveField:p,setDissolveField:i,layerName:b,setLayerName:C,errors:ue}),W&&G.jsx("div",{className:"flex justify-center align-center",children:G.jsx(Ix,{color:"#ff8847",size:60})}),G.jsx("div",{className:"dissolve-form",children:G.jsx(jp,{layerName:b,onNameChange:C,fillColor:A,fillOpacity:z,onFillColorChange:R,onFillOpacityChange:V})})]})}),G.jsx(mv,{steps:lk,run:K&&e,onStop:ye,stepIndex:ae,onStepChange:Se,disableOverlay:!0})]})}function ore({open:e,onOpenChange:t,title:n,onSave:r,children:a,description:u,setRunSteps:p}){return G.jsx(Pb,{open:e,onOpenChange:t,children:G.jsxs(dx,{className:"max-w-[1000px] w-[70vw] max-h-[90vh] overflow-hidden feature-extraction",children:[G.jsxs(fx,{children:[G.jsx(mx,{children:n}),G.jsx(gx,{children:u})]}),G.jsx("div",{className:"overflow-hidden",children:a}),G.jsx(px,{children:G.jsxs("div",{className:"flex flex-row w-full",children:[G.jsx("div",{className:"flex-1",children:G.jsx(Qr,{onClick:()=>p(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})})}),G.jsxs("div",{className:"flex-3 gap-3 flex",children:[G.jsx(_x,{onClick:()=>t(!1),className:"rounded-xl",children:"Close"}),r&&G.jsx(VE,{onClick:r,className:"rounded-xl save-btn",children:"Save"})]})]})})]})})}const Wb=pb(e=>({selectedLayerId:null,filterConditions:[],filteredFeatures:[],selectedFeatures:[],setSelectedLayerId:t=>e({selectedLayerId:t}),addFilterCondition:t=>e(n=>({filterConditions:[...n.filterConditions,t]})),removeFilterCondition:t=>e(n=>({filterConditions:n.filterConditions.filter((r,a)=>a!==t)})),clearFilters:()=>e({filterConditions:[]}),setSelectedFeatures:t=>e({selectedFeatures:t})}));/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function g_(e,t){return typeof e=="function"?e(t):e}function nh(e,t){return n=>{t.setState(r=>({...r,[e]:g_(n,r[e])}))}}function aC(e){return e instanceof Function}function sre(e){return Array.isArray(e)&&e.every(t=>typeof t=="number")}function are(e,t){const n=[],r=a=>{a.forEach(u=>{n.push(u);const p=t(u);p!=null&&p.length&&r(p)})};return r(e),n}function jr(e,t,n){let r=[],a;return u=>{let p;n.key&&n.debug&&(p=Date.now());const i=e(u);if(!(i.length!==r.length||i.some((A,R)=>r[R]!==A)))return a;r=i;let C;if(n.key&&n.debug&&(C=Date.now()),a=t(...i),n==null||n.onChange==null||n.onChange(a),n.key&&n.debug&&n!=null&&n.debug()){const A=Math.round((Date.now()-p)*100)/100,R=Math.round((Date.now()-C)*100)/100,z=R/16,V=(W,X)=>{for(W=String(W);W.length<X;)W=" "+W;return W};console.info(`%c ${V(R,5)} /${V(A,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*z,120))}deg 100% 31%);`,n==null?void 0:n.key)}return a}}function Vr(e,t,n,r){return{debug:()=>{var a;return(a=e==null?void 0:e.debugAll)!=null?a:e[t]},key:!1,onChange:r}}function lre(e,t,n,r){const a=()=>{var p;return(p=u.getValue())!=null?p:e.options.renderFallbackValue},u={id:`${t.id}_${n.id}`,row:t,column:n,getValue:()=>t.getValue(r),renderValue:a,getContext:jr(()=>[e,n,t,u],(p,i,b,C)=>({table:p,column:i,row:b,cell:C,getValue:C.getValue,renderValue:C.renderValue}),Vr(e.options,"debugCells"))};return e._features.forEach(p=>{p.createCell==null||p.createCell(u,n,t,e)},{}),u}function ure(e,t,n,r){var a,u;const i={...e._getDefaultColumnDef(),...t},b=i.accessorKey;let C=(a=(u=i.id)!=null?u:b?typeof String.prototype.replaceAll=="function"?b.replaceAll(".","_"):b.replace(/\./g,"_"):void 0)!=null?a:typeof i.header=="string"?i.header:void 0,A;if(i.accessorFn?A=i.accessorFn:b&&(b.includes(".")?A=z=>{let V=z;for(const X of b.split(".")){var W;V=(W=V)==null?void 0:W[X]}return V}:A=z=>z[i.accessorKey]),!C)throw new Error;let R={id:`${String(C)}`,accessorFn:A,parent:r,depth:n,columnDef:i,columns:[],getFlatColumns:jr(()=>[!0],()=>{var z;return[R,...(z=R.columns)==null?void 0:z.flatMap(V=>V.getFlatColumns())]},Vr(e.options,"debugColumns")),getLeafColumns:jr(()=>[e._getOrderColumnsFn()],z=>{var V;if((V=R.columns)!=null&&V.length){let W=R.columns.flatMap(X=>X.getLeafColumns());return z(W)}return[R]},Vr(e.options,"debugColumns"))};for(const z of e._features)z.createColumn==null||z.createColumn(R,e);return R}const jl="debugHeaders";function hk(e,t,n){var r;let u={id:(r=n.id)!=null?r:t.id,column:t,index:n.index,isPlaceholder:!!n.isPlaceholder,placeholderId:n.placeholderId,depth:n.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const p=[],i=b=>{b.subHeaders&&b.subHeaders.length&&b.subHeaders.map(i),p.push(b)};return i(u),p},getContext:()=>({table:e,header:u,column:t})};return e._features.forEach(p=>{p.createHeader==null||p.createHeader(u,e)}),u}const cre={createTable:e=>{e.getHeaderGroups=jr(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r,a)=>{var u,p;const i=(u=r==null?void 0:r.map(R=>n.find(z=>z.id===R)).filter(Boolean))!=null?u:[],b=(p=a==null?void 0:a.map(R=>n.find(z=>z.id===R)).filter(Boolean))!=null?p:[],C=n.filter(R=>!(r!=null&&r.includes(R.id))&&!(a!=null&&a.includes(R.id)));return hS(t,[...i,...C,...b],e)},Vr(e.options,jl)),e.getCenterHeaderGroups=jr(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r,a)=>(n=n.filter(u=>!(r!=null&&r.includes(u.id))&&!(a!=null&&a.includes(u.id))),hS(t,n,e,"center")),Vr(e.options,jl)),e.getLeftHeaderGroups=jr(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(t,n,r)=>{var a;const u=(a=r==null?void 0:r.map(p=>n.find(i=>i.id===p)).filter(Boolean))!=null?a:[];return hS(t,u,e,"left")},Vr(e.options,jl)),e.getRightHeaderGroups=jr(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(t,n,r)=>{var a;const u=(a=r==null?void 0:r.map(p=>n.find(i=>i.id===p)).filter(Boolean))!=null?a:[];return hS(t,u,e,"right")},Vr(e.options,jl)),e.getFooterGroups=jr(()=>[e.getHeaderGroups()],t=>[...t].reverse(),Vr(e.options,jl)),e.getLeftFooterGroups=jr(()=>[e.getLeftHeaderGroups()],t=>[...t].reverse(),Vr(e.options,jl)),e.getCenterFooterGroups=jr(()=>[e.getCenterHeaderGroups()],t=>[...t].reverse(),Vr(e.options,jl)),e.getRightFooterGroups=jr(()=>[e.getRightHeaderGroups()],t=>[...t].reverse(),Vr(e.options,jl)),e.getFlatHeaders=jr(()=>[e.getHeaderGroups()],t=>t.map(n=>n.headers).flat(),Vr(e.options,jl)),e.getLeftFlatHeaders=jr(()=>[e.getLeftHeaderGroups()],t=>t.map(n=>n.headers).flat(),Vr(e.options,jl)),e.getCenterFlatHeaders=jr(()=>[e.getCenterHeaderGroups()],t=>t.map(n=>n.headers).flat(),Vr(e.options,jl)),e.getRightFlatHeaders=jr(()=>[e.getRightHeaderGroups()],t=>t.map(n=>n.headers).flat(),Vr(e.options,jl)),e.getCenterLeafHeaders=jr(()=>[e.getCenterFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),Vr(e.options,jl)),e.getLeftLeafHeaders=jr(()=>[e.getLeftFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),Vr(e.options,jl)),e.getRightLeafHeaders=jr(()=>[e.getRightFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),Vr(e.options,jl)),e.getLeafHeaders=jr(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(t,n,r)=>{var a,u,p,i,b,C;return[...(a=(u=t[0])==null?void 0:u.headers)!=null?a:[],...(p=(i=n[0])==null?void 0:i.headers)!=null?p:[],...(b=(C=r[0])==null?void 0:C.headers)!=null?b:[]].map(A=>A.getLeafHeaders()).flat()},Vr(e.options,jl))}};function hS(e,t,n,r){var a,u;let p=0;const i=function(z,V){V===void 0&&(V=1),p=Math.max(p,V),z.filter(W=>W.getIsVisible()).forEach(W=>{var X;(X=W.columns)!=null&&X.length&&i(W.columns,V+1)},0)};i(e);let b=[];const C=(z,V)=>{const W={depth:V,id:[r,`${V}`].filter(Boolean).join("_"),headers:[]},X=[];z.forEach(ue=>{const ie=[...X].reverse()[0],K=ue.column.depth===W.depth;let ee,ae=!1;if(K&&ue.column.parent?ee=ue.column.parent:(ee=ue.column,ae=!0),ie&&(ie==null?void 0:ie.column)===ee)ie.subHeaders.push(ue);else{const he=hk(n,ee,{id:[r,V,ee.id,ue==null?void 0:ue.id].filter(Boolean).join("_"),isPlaceholder:ae,placeholderId:ae?`${X.filter(xe=>xe.column===ee).length}`:void 0,depth:V,index:X.length});he.subHeaders.push(ue),X.push(he)}W.headers.push(ue),ue.headerGroup=W}),b.push(W),V>0&&C(X,V-1)},A=t.map((z,V)=>hk(n,z,{depth:p,index:V}));C(A,p-1),b.reverse();const R=z=>z.filter(W=>W.column.getIsVisible()).map(W=>{let X=0,ue=0,ie=[0];W.subHeaders&&W.subHeaders.length?(ie=[],R(W.subHeaders).forEach(ee=>{let{colSpan:ae,rowSpan:he}=ee;X+=ae,ie.push(he)})):X=1;const K=Math.min(...ie);return ue=ue+K,W.colSpan=X,W.rowSpan=ue,{colSpan:X,rowSpan:ue}});return R((a=(u=b[0])==null?void 0:u.headers)!=null?a:[]),b}const xP=(e,t,n,r,a,u,p)=>{let i={id:t,index:r,original:n,depth:a,parentId:p,_valuesCache:{},_uniqueValuesCache:{},getValue:b=>{if(i._valuesCache.hasOwnProperty(b))return i._valuesCache[b];const C=e.getColumn(b);if(C!=null&&C.accessorFn)return i._valuesCache[b]=C.accessorFn(i.original,r),i._valuesCache[b]},getUniqueValues:b=>{if(i._uniqueValuesCache.hasOwnProperty(b))return i._uniqueValuesCache[b];const C=e.getColumn(b);if(C!=null&&C.accessorFn)return C.columnDef.getUniqueValues?(i._uniqueValuesCache[b]=C.columnDef.getUniqueValues(i.original,r),i._uniqueValuesCache[b]):(i._uniqueValuesCache[b]=[i.getValue(b)],i._uniqueValuesCache[b])},renderValue:b=>{var C;return(C=i.getValue(b))!=null?C:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>are(i.subRows,b=>b.subRows),getParentRow:()=>i.parentId?e.getRow(i.parentId,!0):void 0,getParentRows:()=>{let b=[],C=i;for(;;){const A=C.getParentRow();if(!A)break;b.push(A),C=A}return b.reverse()},getAllCells:jr(()=>[e.getAllLeafColumns()],b=>b.map(C=>lre(e,i,C,C.id)),Vr(e.options,"debugRows")),_getAllCellsByColumnId:jr(()=>[i.getAllCells()],b=>b.reduce((C,A)=>(C[A.column.id]=A,C),{}),Vr(e.options,"debugRows"))};for(let b=0;b<e._features.length;b++){const C=e._features[b];C==null||C.createRow==null||C.createRow(i,e)}return i},hre={createColumn:(e,t)=>{e._getFacetedRowModel=t.options.getFacetedRowModel&&t.options.getFacetedRowModel(t,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():t.getPreFilteredRowModel(),e._getFacetedUniqueValues=t.options.getFacetedUniqueValues&&t.options.getFacetedUniqueValues(t,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=t.options.getFacetedMinMaxValues&&t.options.getFacetedMinMaxValues(t,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},bj=(e,t,n)=>{var r,a;const u=n==null||(r=n.toString())==null?void 0:r.toLowerCase();return!!(!((a=e.getValue(t))==null||(a=a.toString())==null||(a=a.toLowerCase())==null)&&a.includes(u))};bj.autoRemove=e=>tf(e);const wj=(e,t,n)=>{var r;return!!(!((r=e.getValue(t))==null||(r=r.toString())==null)&&r.includes(n))};wj.autoRemove=e=>tf(e);const Sj=(e,t,n)=>{var r;return((r=e.getValue(t))==null||(r=r.toString())==null?void 0:r.toLowerCase())===(n==null?void 0:n.toLowerCase())};Sj.autoRemove=e=>tf(e);const Ej=(e,t,n)=>{var r;return(r=e.getValue(t))==null?void 0:r.includes(n)};Ej.autoRemove=e=>tf(e);const Cj=(e,t,n)=>!n.some(r=>{var a;return!((a=e.getValue(t))!=null&&a.includes(r))});Cj.autoRemove=e=>tf(e)||!(e!=null&&e.length);const Tj=(e,t,n)=>n.some(r=>{var a;return(a=e.getValue(t))==null?void 0:a.includes(r)});Tj.autoRemove=e=>tf(e)||!(e!=null&&e.length);const Ij=(e,t,n)=>e.getValue(t)===n;Ij.autoRemove=e=>tf(e);const Mj=(e,t,n)=>e.getValue(t)==n;Mj.autoRemove=e=>tf(e);const bP=(e,t,n)=>{let[r,a]=n;const u=e.getValue(t);return u>=r&&u<=a};bP.resolveFilterValue=e=>{let[t,n]=e,r=typeof t!="number"?parseFloat(t):t,a=typeof n!="number"?parseFloat(n):n,u=t===null||Number.isNaN(r)?-1/0:r,p=n===null||Number.isNaN(a)?1/0:a;if(u>p){const i=u;u=p,p=i}return[u,p]};bP.autoRemove=e=>tf(e)||tf(e[0])&&tf(e[1]);const Vm={includesString:bj,includesStringSensitive:wj,equalsString:Sj,arrIncludes:Ej,arrIncludesAll:Cj,arrIncludesSome:Tj,equals:Ij,weakEquals:Mj,inNumberRange:bP};function tf(e){return e==null||e===""}const dre={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:nh("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,t)=>{e.getAutoFilterFn=()=>{const n=t.getCoreRowModel().flatRows[0],r=n==null?void 0:n.getValue(e.id);return typeof r=="string"?Vm.includesString:typeof r=="number"?Vm.inNumberRange:typeof r=="boolean"||r!==null&&typeof r=="object"?Vm.equals:Array.isArray(r)?Vm.arrIncludes:Vm.weakEquals},e.getFilterFn=()=>{var n,r;return aC(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(n=(r=t.options.filterFns)==null?void 0:r[e.columnDef.filterFn])!=null?n:Vm[e.columnDef.filterFn]},e.getCanFilter=()=>{var n,r,a;return((n=e.columnDef.enableColumnFilter)!=null?n:!0)&&((r=t.options.enableColumnFilters)!=null?r:!0)&&((a=t.options.enableFilters)!=null?a:!0)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var n;return(n=t.getState().columnFilters)==null||(n=n.find(r=>r.id===e.id))==null?void 0:n.value},e.getFilterIndex=()=>{var n,r;return(n=(r=t.getState().columnFilters)==null?void 0:r.findIndex(a=>a.id===e.id))!=null?n:-1},e.setFilterValue=n=>{t.setColumnFilters(r=>{const a=e.getFilterFn(),u=r==null?void 0:r.find(A=>A.id===e.id),p=g_(n,u?u.value:void 0);if(dk(a,p,e)){var i;return(i=r==null?void 0:r.filter(A=>A.id!==e.id))!=null?i:[]}const b={id:e.id,value:p};if(u){var C;return(C=r==null?void 0:r.map(A=>A.id===e.id?b:A))!=null?C:[]}return r!=null&&r.length?[...r,b]:[b]})}},createRow:(e,t)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=t=>{const n=e.getAllLeafColumns(),r=a=>{var u;return(u=g_(t,a))==null?void 0:u.filter(p=>{const i=n.find(b=>b.id===p.id);if(i){const b=i.getFilterFn();if(dk(b,p.value,i))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(r)},e.resetColumnFilters=t=>{var n,r;e.setColumnFilters(t?[]:(n=(r=e.initialState)==null?void 0:r.columnFilters)!=null?n:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function dk(e,t,n){return(e&&e.autoRemove?e.autoRemove(t,n):!1)||typeof t>"u"||typeof t=="string"&&!t}const fre=(e,t,n)=>n.reduce((r,a)=>{const u=a.getValue(e);return r+(typeof u=="number"?u:0)},0),pre=(e,t,n)=>{let r;return n.forEach(a=>{const u=a.getValue(e);u!=null&&(r>u||r===void 0&&u>=u)&&(r=u)}),r},mre=(e,t,n)=>{let r;return n.forEach(a=>{const u=a.getValue(e);u!=null&&(r<u||r===void 0&&u>=u)&&(r=u)}),r},gre=(e,t,n)=>{let r,a;return n.forEach(u=>{const p=u.getValue(e);p!=null&&(r===void 0?p>=p&&(r=a=p):(r>p&&(r=p),a<p&&(a=p)))}),[r,a]},_re=(e,t)=>{let n=0,r=0;if(t.forEach(a=>{let u=a.getValue(e);u!=null&&(u=+u)>=u&&(++n,r+=u)}),n)return r/n},yre=(e,t)=>{if(!t.length)return;const n=t.map(u=>u.getValue(e));if(!sre(n))return;if(n.length===1)return n[0];const r=Math.floor(n.length/2),a=n.sort((u,p)=>u-p);return n.length%2!==0?a[r]:(a[r-1]+a[r])/2},vre=(e,t)=>Array.from(new Set(t.map(n=>n.getValue(e))).values()),xre=(e,t)=>new Set(t.map(n=>n.getValue(e))).size,bre=(e,t)=>t.length,vI={sum:fre,min:pre,max:mre,extent:gre,mean:_re,median:yre,unique:vre,uniqueCount:xre,count:bre},wre={getDefaultColumnDef:()=>({aggregatedCell:e=>{var t,n;return(t=(n=e.getValue())==null||n.toString==null?void 0:n.toString())!=null?t:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:nh("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,t)=>{e.toggleGrouping=()=>{t.setGrouping(n=>n!=null&&n.includes(e.id)?n.filter(r=>r!==e.id):[...n??[],e.id])},e.getCanGroup=()=>{var n,r;return((n=e.columnDef.enableGrouping)!=null?n:!0)&&((r=t.options.enableGrouping)!=null?r:!0)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var n;return(n=t.getState().grouping)==null?void 0:n.includes(e.id)},e.getGroupedIndex=()=>{var n;return(n=t.getState().grouping)==null?void 0:n.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const n=e.getCanGroup();return()=>{n&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const n=t.getCoreRowModel().flatRows[0],r=n==null?void 0:n.getValue(e.id);if(typeof r=="number")return vI.sum;if(Object.prototype.toString.call(r)==="[object Date]")return vI.extent},e.getAggregationFn=()=>{var n,r;if(!e)throw new Error;return aC(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(n=(r=t.options.aggregationFns)==null?void 0:r[e.columnDef.aggregationFn])!=null?n:vI[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=t=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(t),e.resetGrouping=t=>{var n,r;e.setGrouping(t?[]:(n=(r=e.initialState)==null?void 0:r.grouping)!=null?n:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,t)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=n=>{if(e._groupingValuesCache.hasOwnProperty(n))return e._groupingValuesCache[n];const r=t.getColumn(n);return r!=null&&r.columnDef.getGroupingValue?(e._groupingValuesCache[n]=r.columnDef.getGroupingValue(e.original),e._groupingValuesCache[n]):e.getValue(n)},e._groupingValuesCache={}},createCell:(e,t,n,r)=>{e.getIsGrouped=()=>t.getIsGrouped()&&t.id===n.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&t.getIsGrouped(),e.getIsAggregated=()=>{var a;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((a=n.subRows)!=null&&a.length)}}};function Sre(e,t,n){if(!(t!=null&&t.length)||!n)return e;const r=e.filter(u=>!t.includes(u.id));return n==="remove"?r:[...t.map(u=>e.find(p=>p.id===u)).filter(Boolean),...r]}const Ere={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:nh("columnOrder",e)}),createColumn:(e,t)=>{e.getIndex=jr(n=>[B1(t,n)],n=>n.findIndex(r=>r.id===e.id),Vr(t.options,"debugColumns")),e.getIsFirstColumn=n=>{var r;return((r=B1(t,n)[0])==null?void 0:r.id)===e.id},e.getIsLastColumn=n=>{var r;const a=B1(t,n);return((r=a[a.length-1])==null?void 0:r.id)===e.id}},createTable:e=>{e.setColumnOrder=t=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(t),e.resetColumnOrder=t=>{var n;e.setColumnOrder(t?[]:(n=e.initialState.columnOrder)!=null?n:[])},e._getOrderColumnsFn=jr(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(t,n,r)=>a=>{let u=[];if(!(t!=null&&t.length))u=a;else{const p=[...t],i=[...a];for(;i.length&&p.length;){const b=p.shift(),C=i.findIndex(A=>A.id===b);C>-1&&u.push(i.splice(C,1)[0])}u=[...u,...i]}return Sre(u,n,r)},Vr(e.options,"debugTable"))}},xI=()=>({left:[],right:[]}),Cre={getInitialState:e=>({columnPinning:xI(),...e}),getDefaultOptions:e=>({onColumnPinningChange:nh("columnPinning",e)}),createColumn:(e,t)=>{e.pin=n=>{const r=e.getLeafColumns().map(a=>a.id).filter(Boolean);t.setColumnPinning(a=>{var u,p;if(n==="right"){var i,b;return{left:((i=a==null?void 0:a.left)!=null?i:[]).filter(R=>!(r!=null&&r.includes(R))),right:[...((b=a==null?void 0:a.right)!=null?b:[]).filter(R=>!(r!=null&&r.includes(R))),...r]}}if(n==="left"){var C,A;return{left:[...((C=a==null?void 0:a.left)!=null?C:[]).filter(R=>!(r!=null&&r.includes(R))),...r],right:((A=a==null?void 0:a.right)!=null?A:[]).filter(R=>!(r!=null&&r.includes(R)))}}return{left:((u=a==null?void 0:a.left)!=null?u:[]).filter(R=>!(r!=null&&r.includes(R))),right:((p=a==null?void 0:a.right)!=null?p:[]).filter(R=>!(r!=null&&r.includes(R)))}})},e.getCanPin=()=>e.getLeafColumns().some(r=>{var a,u,p;return((a=r.columnDef.enablePinning)!=null?a:!0)&&((u=(p=t.options.enableColumnPinning)!=null?p:t.options.enablePinning)!=null?u:!0)}),e.getIsPinned=()=>{const n=e.getLeafColumns().map(i=>i.id),{left:r,right:a}=t.getState().columnPinning,u=n.some(i=>r==null?void 0:r.includes(i)),p=n.some(i=>a==null?void 0:a.includes(i));return u?"left":p?"right":!1},e.getPinnedIndex=()=>{var n,r;const a=e.getIsPinned();return a?(n=(r=t.getState().columnPinning)==null||(r=r[a])==null?void 0:r.indexOf(e.id))!=null?n:-1:0}},createRow:(e,t)=>{e.getCenterVisibleCells=jr(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left,t.getState().columnPinning.right],(n,r,a)=>{const u=[...r??[],...a??[]];return n.filter(p=>!u.includes(p.column.id))},Vr(t.options,"debugRows")),e.getLeftVisibleCells=jr(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left],(n,r)=>(r??[]).map(u=>n.find(p=>p.column.id===u)).filter(Boolean).map(u=>({...u,position:"left"})),Vr(t.options,"debugRows")),e.getRightVisibleCells=jr(()=>[e._getAllVisibleCells(),t.getState().columnPinning.right],(n,r)=>(r??[]).map(u=>n.find(p=>p.column.id===u)).filter(Boolean).map(u=>({...u,position:"right"})),Vr(t.options,"debugRows"))},createTable:e=>{e.setColumnPinning=t=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(t),e.resetColumnPinning=t=>{var n,r;return e.setColumnPinning(t?xI():(n=(r=e.initialState)==null?void 0:r.columnPinning)!=null?n:xI())},e.getIsSomeColumnsPinned=t=>{var n;const r=e.getState().columnPinning;if(!t){var a,u;return!!((a=r.left)!=null&&a.length||(u=r.right)!=null&&u.length)}return!!((n=r[t])!=null&&n.length)},e.getLeftLeafColumns=jr(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(t,n)=>(n??[]).map(r=>t.find(a=>a.id===r)).filter(Boolean),Vr(e.options,"debugColumns")),e.getRightLeafColumns=jr(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(t,n)=>(n??[]).map(r=>t.find(a=>a.id===r)).filter(Boolean),Vr(e.options,"debugColumns")),e.getCenterLeafColumns=jr(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r)=>{const a=[...n??[],...r??[]];return t.filter(u=>!a.includes(u.id))},Vr(e.options,"debugColumns"))}};function Tre(e){return e||(typeof document<"u"?document:null)}const dS={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},bI=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),Ire={getDefaultColumnDef:()=>dS,getInitialState:e=>({columnSizing:{},columnSizingInfo:bI(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:nh("columnSizing",e),onColumnSizingInfoChange:nh("columnSizingInfo",e)}),createColumn:(e,t)=>{e.getSize=()=>{var n,r,a;const u=t.getState().columnSizing[e.id];return Math.min(Math.max((n=e.columnDef.minSize)!=null?n:dS.minSize,(r=u??e.columnDef.size)!=null?r:dS.size),(a=e.columnDef.maxSize)!=null?a:dS.maxSize)},e.getStart=jr(n=>[n,B1(t,n),t.getState().columnSizing],(n,r)=>r.slice(0,e.getIndex(n)).reduce((a,u)=>a+u.getSize(),0),Vr(t.options,"debugColumns")),e.getAfter=jr(n=>[n,B1(t,n),t.getState().columnSizing],(n,r)=>r.slice(e.getIndex(n)+1).reduce((a,u)=>a+u.getSize(),0),Vr(t.options,"debugColumns")),e.resetSize=()=>{t.setColumnSizing(n=>{let{[e.id]:r,...a}=n;return a})},e.getCanResize=()=>{var n,r;return((n=e.columnDef.enableResizing)!=null?n:!0)&&((r=t.options.enableColumnResizing)!=null?r:!0)},e.getIsResizing=()=>t.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,t)=>{e.getSize=()=>{let n=0;const r=a=>{if(a.subHeaders.length)a.subHeaders.forEach(r);else{var u;n+=(u=a.column.getSize())!=null?u:0}};return r(e),n},e.getStart=()=>{if(e.index>0){const n=e.headerGroup.headers[e.index-1];return n.getStart()+n.getSize()}return 0},e.getResizeHandler=n=>{const r=t.getColumn(e.column.id),a=r==null?void 0:r.getCanResize();return u=>{if(!r||!a||(u.persist==null||u.persist(),wI(u)&&u.touches&&u.touches.length>1))return;const p=e.getSize(),i=e?e.getLeafHeaders().map(ie=>[ie.column.id,ie.column.getSize()]):[[r.id,r.getSize()]],b=wI(u)?Math.round(u.touches[0].clientX):u.clientX,C={},A=(ie,K)=>{typeof K=="number"&&(t.setColumnSizingInfo(ee=>{var ae,he;const xe=t.options.columnResizeDirection==="rtl"?-1:1,ye=(K-((ae=ee==null?void 0:ee.startOffset)!=null?ae:0))*xe,Se=Math.max(ye/((he=ee==null?void 0:ee.startSize)!=null?he:0),-.999999);return ee.columnSizingStart.forEach(je=>{let[Re,De]=je;C[Re]=Math.round(Math.max(De+De*Se,0)*100)/100}),{...ee,deltaOffset:ye,deltaPercentage:Se}}),(t.options.columnResizeMode==="onChange"||ie==="end")&&t.setColumnSizing(ee=>({...ee,...C})))},R=ie=>A("move",ie),z=ie=>{A("end",ie),t.setColumnSizingInfo(K=>({...K,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},V=Tre(n),W={moveHandler:ie=>R(ie.clientX),upHandler:ie=>{V==null||V.removeEventListener("mousemove",W.moveHandler),V==null||V.removeEventListener("mouseup",W.upHandler),z(ie.clientX)}},X={moveHandler:ie=>(ie.cancelable&&(ie.preventDefault(),ie.stopPropagation()),R(ie.touches[0].clientX),!1),upHandler:ie=>{var K;V==null||V.removeEventListener("touchmove",X.moveHandler),V==null||V.removeEventListener("touchend",X.upHandler),ie.cancelable&&(ie.preventDefault(),ie.stopPropagation()),z((K=ie.touches[0])==null?void 0:K.clientX)}},ue=Mre()?{passive:!1}:!1;wI(u)?(V==null||V.addEventListener("touchmove",X.moveHandler,ue),V==null||V.addEventListener("touchend",X.upHandler,ue)):(V==null||V.addEventListener("mousemove",W.moveHandler,ue),V==null||V.addEventListener("mouseup",W.upHandler,ue)),t.setColumnSizingInfo(ie=>({...ie,startOffset:b,startSize:p,deltaOffset:0,deltaPercentage:0,columnSizingStart:i,isResizingColumn:r.id}))}}},createTable:e=>{e.setColumnSizing=t=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(t),e.setColumnSizingInfo=t=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(t),e.resetColumnSizing=t=>{var n;e.setColumnSizing(t?{}:(n=e.initialState.columnSizing)!=null?n:{})},e.resetHeaderSizeInfo=t=>{var n;e.setColumnSizingInfo(t?bI():(n=e.initialState.columnSizingInfo)!=null?n:bI())},e.getTotalSize=()=>{var t,n;return(t=(n=e.getHeaderGroups()[0])==null?void 0:n.headers.reduce((r,a)=>r+a.getSize(),0))!=null?t:0},e.getLeftTotalSize=()=>{var t,n;return(t=(n=e.getLeftHeaderGroups()[0])==null?void 0:n.headers.reduce((r,a)=>r+a.getSize(),0))!=null?t:0},e.getCenterTotalSize=()=>{var t,n;return(t=(n=e.getCenterHeaderGroups()[0])==null?void 0:n.headers.reduce((r,a)=>r+a.getSize(),0))!=null?t:0},e.getRightTotalSize=()=>{var t,n;return(t=(n=e.getRightHeaderGroups()[0])==null?void 0:n.headers.reduce((r,a)=>r+a.getSize(),0))!=null?t:0}}};let fS=null;function Mre(){if(typeof fS=="boolean")return fS;let e=!1;try{const t={get passive(){return e=!0,!1}},n=()=>{};window.addEventListener("test",n,t),window.removeEventListener("test",n)}catch{e=!1}return fS=e,fS}function wI(e){return e.type==="touchstart"}const Pre={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:nh("columnVisibility",e)}),createColumn:(e,t)=>{e.toggleVisibility=n=>{e.getCanHide()&&t.setColumnVisibility(r=>({...r,[e.id]:n??!e.getIsVisible()}))},e.getIsVisible=()=>{var n,r;const a=e.columns;return(n=a.length?a.some(u=>u.getIsVisible()):(r=t.getState().columnVisibility)==null?void 0:r[e.id])!=null?n:!0},e.getCanHide=()=>{var n,r;return((n=e.columnDef.enableHiding)!=null?n:!0)&&((r=t.options.enableHiding)!=null?r:!0)},e.getToggleVisibilityHandler=()=>n=>{e.toggleVisibility==null||e.toggleVisibility(n.target.checked)}},createRow:(e,t)=>{e._getAllVisibleCells=jr(()=>[e.getAllCells(),t.getState().columnVisibility],n=>n.filter(r=>r.column.getIsVisible()),Vr(t.options,"debugRows")),e.getVisibleCells=jr(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(n,r,a)=>[...n,...r,...a],Vr(t.options,"debugRows"))},createTable:e=>{const t=(n,r)=>jr(()=>[r(),r().filter(a=>a.getIsVisible()).map(a=>a.id).join("_")],a=>a.filter(u=>u.getIsVisible==null?void 0:u.getIsVisible()),Vr(e.options,"debugColumns"));e.getVisibleFlatColumns=t("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=t("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=t("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=t("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=t("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=n=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(n),e.resetColumnVisibility=n=>{var r;e.setColumnVisibility(n?{}:(r=e.initialState.columnVisibility)!=null?r:{})},e.toggleAllColumnsVisible=n=>{var r;n=(r=n)!=null?r:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((a,u)=>({...a,[u.id]:n||!(u.getCanHide!=null&&u.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(n=>!(n.getIsVisible!=null&&n.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(n=>n.getIsVisible==null?void 0:n.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>n=>{var r;e.toggleAllColumnsVisible((r=n.target)==null?void 0:r.checked)}}};function B1(e,t){return t?t==="center"?e.getCenterVisibleLeafColumns():t==="left"?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const Are={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},Rre={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:nh("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:t=>{var n;const r=(n=e.getCoreRowModel().flatRows[0])==null||(n=n._getAllCellsByColumnId()[t.id])==null?void 0:n.getValue();return typeof r=="string"||typeof r=="number"}}),createColumn:(e,t)=>{e.getCanGlobalFilter=()=>{var n,r,a,u;return((n=e.columnDef.enableGlobalFilter)!=null?n:!0)&&((r=t.options.enableGlobalFilter)!=null?r:!0)&&((a=t.options.enableFilters)!=null?a:!0)&&((u=t.options.getColumnCanGlobalFilter==null?void 0:t.options.getColumnCanGlobalFilter(e))!=null?u:!0)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>Vm.includesString,e.getGlobalFilterFn=()=>{var t,n;const{globalFilterFn:r}=e.options;return aC(r)?r:r==="auto"?e.getGlobalAutoFilterFn():(t=(n=e.options.filterFns)==null?void 0:n[r])!=null?t:Vm[r]},e.setGlobalFilter=t=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(t)},e.resetGlobalFilter=t=>{e.setGlobalFilter(t?void 0:e.initialState.globalFilter)}}},Lre={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:nh("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let t=!1,n=!1;e._autoResetExpanded=()=>{var r,a;if(!t){e._queue(()=>{t=!0});return}if((r=(a=e.options.autoResetAll)!=null?a:e.options.autoResetExpanded)!=null?r:!e.options.manualExpanding){if(n)return;n=!0,e._queue(()=>{e.resetExpanded(),n=!1})}},e.setExpanded=r=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(r),e.toggleAllRowsExpanded=r=>{r??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=r=>{var a,u;e.setExpanded(r?{}:(a=(u=e.initialState)==null?void 0:u.expanded)!=null?a:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(r=>r.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>r=>{r.persist==null||r.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const r=e.getState().expanded;return r===!0||Object.values(r).some(Boolean)},e.getIsAllRowsExpanded=()=>{const r=e.getState().expanded;return typeof r=="boolean"?r===!0:!(!Object.keys(r).length||e.getRowModel().flatRows.some(a=>!a.getIsExpanded()))},e.getExpandedDepth=()=>{let r=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(u=>{const p=u.split(".");r=Math.max(r,p.length)}),r},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,t)=>{e.toggleExpanded=n=>{t.setExpanded(r=>{var a;const u=r===!0?!0:!!(r!=null&&r[e.id]);let p={};if(r===!0?Object.keys(t.getRowModel().rowsById).forEach(i=>{p[i]=!0}):p=r,n=(a=n)!=null?a:!u,!u&&n)return{...p,[e.id]:!0};if(u&&!n){const{[e.id]:i,...b}=p;return b}return r})},e.getIsExpanded=()=>{var n;const r=t.getState().expanded;return!!((n=t.options.getIsRowExpanded==null?void 0:t.options.getIsRowExpanded(e))!=null?n:r===!0||r!=null&&r[e.id])},e.getCanExpand=()=>{var n,r,a;return(n=t.options.getRowCanExpand==null?void 0:t.options.getRowCanExpand(e))!=null?n:((r=t.options.enableExpanding)!=null?r:!0)&&!!((a=e.subRows)!=null&&a.length)},e.getIsAllParentsExpanded=()=>{let n=!0,r=e;for(;n&&r.parentId;)r=t.getRow(r.parentId,!0),n=r.getIsExpanded();return n},e.getToggleExpandedHandler=()=>{const n=e.getCanExpand();return()=>{n&&e.toggleExpanded()}}}},T2=0,I2=10,SI=()=>({pageIndex:T2,pageSize:I2}),Ore={getInitialState:e=>({...e,pagination:{...SI(),...e==null?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:nh("pagination",e)}),createTable:e=>{let t=!1,n=!1;e._autoResetPageIndex=()=>{var r,a;if(!t){e._queue(()=>{t=!0});return}if((r=(a=e.options.autoResetAll)!=null?a:e.options.autoResetPageIndex)!=null?r:!e.options.manualPagination){if(n)return;n=!0,e._queue(()=>{e.resetPageIndex(),n=!1})}},e.setPagination=r=>{const a=u=>g_(r,u);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(a)},e.resetPagination=r=>{var a;e.setPagination(r?SI():(a=e.initialState.pagination)!=null?a:SI())},e.setPageIndex=r=>{e.setPagination(a=>{let u=g_(r,a.pageIndex);const p=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return u=Math.max(0,Math.min(u,p)),{...a,pageIndex:u}})},e.resetPageIndex=r=>{var a,u;e.setPageIndex(r?T2:(a=(u=e.initialState)==null||(u=u.pagination)==null?void 0:u.pageIndex)!=null?a:T2)},e.resetPageSize=r=>{var a,u;e.setPageSize(r?I2:(a=(u=e.initialState)==null||(u=u.pagination)==null?void 0:u.pageSize)!=null?a:I2)},e.setPageSize=r=>{e.setPagination(a=>{const u=Math.max(1,g_(r,a.pageSize)),p=a.pageSize*a.pageIndex,i=Math.floor(p/u);return{...a,pageIndex:i,pageSize:u}})},e.setPageCount=r=>e.setPagination(a=>{var u;let p=g_(r,(u=e.options.pageCount)!=null?u:-1);return typeof p=="number"&&(p=Math.max(-1,p)),{...a,pageCount:p}}),e.getPageOptions=jr(()=>[e.getPageCount()],r=>{let a=[];return r&&r>0&&(a=[...new Array(r)].fill(null).map((u,p)=>p)),a},Vr(e.options,"debugTable")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:r}=e.getState().pagination,a=e.getPageCount();return a===-1?!0:a===0?!1:r<a-1},e.previousPage=()=>e.setPageIndex(r=>r-1),e.nextPage=()=>e.setPageIndex(r=>r+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var r;return(r=e.options.pageCount)!=null?r:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var r;return(r=e.options.rowCount)!=null?r:e.getPrePaginationRowModel().rows.length}}},EI=()=>({top:[],bottom:[]}),Dre={getInitialState:e=>({rowPinning:EI(),...e}),getDefaultOptions:e=>({onRowPinningChange:nh("rowPinning",e)}),createRow:(e,t)=>{e.pin=(n,r,a)=>{const u=r?e.getLeafRows().map(b=>{let{id:C}=b;return C}):[],p=a?e.getParentRows().map(b=>{let{id:C}=b;return C}):[],i=new Set([...p,e.id,...u]);t.setRowPinning(b=>{var C,A;if(n==="bottom"){var R,z;return{top:((R=b==null?void 0:b.top)!=null?R:[]).filter(X=>!(i!=null&&i.has(X))),bottom:[...((z=b==null?void 0:b.bottom)!=null?z:[]).filter(X=>!(i!=null&&i.has(X))),...Array.from(i)]}}if(n==="top"){var V,W;return{top:[...((V=b==null?void 0:b.top)!=null?V:[]).filter(X=>!(i!=null&&i.has(X))),...Array.from(i)],bottom:((W=b==null?void 0:b.bottom)!=null?W:[]).filter(X=>!(i!=null&&i.has(X)))}}return{top:((C=b==null?void 0:b.top)!=null?C:[]).filter(X=>!(i!=null&&i.has(X))),bottom:((A=b==null?void 0:b.bottom)!=null?A:[]).filter(X=>!(i!=null&&i.has(X)))}})},e.getCanPin=()=>{var n;const{enableRowPinning:r,enablePinning:a}=t.options;return typeof r=="function"?r(e):(n=r??a)!=null?n:!0},e.getIsPinned=()=>{const n=[e.id],{top:r,bottom:a}=t.getState().rowPinning,u=n.some(i=>r==null?void 0:r.includes(i)),p=n.some(i=>a==null?void 0:a.includes(i));return u?"top":p?"bottom":!1},e.getPinnedIndex=()=>{var n,r;const a=e.getIsPinned();if(!a)return-1;const u=(n=a==="top"?t.getTopRows():t.getBottomRows())==null?void 0:n.map(p=>{let{id:i}=p;return i});return(r=u==null?void 0:u.indexOf(e.id))!=null?r:-1}},createTable:e=>{e.setRowPinning=t=>e.options.onRowPinningChange==null?void 0:e.options.onRowPinningChange(t),e.resetRowPinning=t=>{var n,r;return e.setRowPinning(t?EI():(n=(r=e.initialState)==null?void 0:r.rowPinning)!=null?n:EI())},e.getIsSomeRowsPinned=t=>{var n;const r=e.getState().rowPinning;if(!t){var a,u;return!!((a=r.top)!=null&&a.length||(u=r.bottom)!=null&&u.length)}return!!((n=r[t])!=null&&n.length)},e._getPinnedRows=(t,n,r)=>{var a;return((a=e.options.keepPinnedRows)==null||a?(n??[]).map(p=>{const i=e.getRow(p,!0);return i.getIsAllParentsExpanded()?i:null}):(n??[]).map(p=>t.find(i=>i.id===p))).filter(Boolean).map(p=>({...p,position:r}))},e.getTopRows=jr(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(t,n)=>e._getPinnedRows(t,n,"top"),Vr(e.options,"debugRows")),e.getBottomRows=jr(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(t,n)=>e._getPinnedRows(t,n,"bottom"),Vr(e.options,"debugRows")),e.getCenterRows=jr(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(t,n,r)=>{const a=new Set([...n??[],...r??[]]);return t.filter(u=>!a.has(u.id))},Vr(e.options,"debugRows"))}},Nre={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:nh("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=t=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(t),e.resetRowSelection=t=>{var n;return e.setRowSelection(t?{}:(n=e.initialState.rowSelection)!=null?n:{})},e.toggleAllRowsSelected=t=>{e.setRowSelection(n=>{t=typeof t<"u"?t:!e.getIsAllRowsSelected();const r={...n},a=e.getPreGroupedRowModel().flatRows;return t?a.forEach(u=>{u.getCanSelect()&&(r[u.id]=!0)}):a.forEach(u=>{delete r[u.id]}),r})},e.toggleAllPageRowsSelected=t=>e.setRowSelection(n=>{const r=typeof t<"u"?t:!e.getIsAllPageRowsSelected(),a={...n};return e.getRowModel().rows.forEach(u=>{M2(a,u.id,r,!0,e)}),a}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=jr(()=>[e.getState().rowSelection,e.getCoreRowModel()],(t,n)=>Object.keys(t).length?CI(e,n):{rows:[],flatRows:[],rowsById:{}},Vr(e.options,"debugTable")),e.getFilteredSelectedRowModel=jr(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(t,n)=>Object.keys(t).length?CI(e,n):{rows:[],flatRows:[],rowsById:{}},Vr(e.options,"debugTable")),e.getGroupedSelectedRowModel=jr(()=>[e.getState().rowSelection,e.getSortedRowModel()],(t,n)=>Object.keys(t).length?CI(e,n):{rows:[],flatRows:[],rowsById:{}},Vr(e.options,"debugTable")),e.getIsAllRowsSelected=()=>{const t=e.getFilteredRowModel().flatRows,{rowSelection:n}=e.getState();let r=!!(t.length&&Object.keys(n).length);return r&&t.some(a=>a.getCanSelect()&&!n[a.id])&&(r=!1),r},e.getIsAllPageRowsSelected=()=>{const t=e.getPaginationRowModel().flatRows.filter(a=>a.getCanSelect()),{rowSelection:n}=e.getState();let r=!!t.length;return r&&t.some(a=>!n[a.id])&&(r=!1),r},e.getIsSomeRowsSelected=()=>{var t;const n=Object.keys((t=e.getState().rowSelection)!=null?t:{}).length;return n>0&&n<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const t=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:t.filter(n=>n.getCanSelect()).some(n=>n.getIsSelected()||n.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>t=>{e.toggleAllRowsSelected(t.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>t=>{e.toggleAllPageRowsSelected(t.target.checked)}},createRow:(e,t)=>{e.toggleSelected=(n,r)=>{const a=e.getIsSelected();t.setRowSelection(u=>{var p;if(n=typeof n<"u"?n:!a,e.getCanSelect()&&a===n)return u;const i={...u};return M2(i,e.id,n,(p=r==null?void 0:r.selectChildren)!=null?p:!0,t),i})},e.getIsSelected=()=>{const{rowSelection:n}=t.getState();return wP(e,n)},e.getIsSomeSelected=()=>{const{rowSelection:n}=t.getState();return P2(e,n)==="some"},e.getIsAllSubRowsSelected=()=>{const{rowSelection:n}=t.getState();return P2(e,n)==="all"},e.getCanSelect=()=>{var n;return typeof t.options.enableRowSelection=="function"?t.options.enableRowSelection(e):(n=t.options.enableRowSelection)!=null?n:!0},e.getCanSelectSubRows=()=>{var n;return typeof t.options.enableSubRowSelection=="function"?t.options.enableSubRowSelection(e):(n=t.options.enableSubRowSelection)!=null?n:!0},e.getCanMultiSelect=()=>{var n;return typeof t.options.enableMultiRowSelection=="function"?t.options.enableMultiRowSelection(e):(n=t.options.enableMultiRowSelection)!=null?n:!0},e.getToggleSelectedHandler=()=>{const n=e.getCanSelect();return r=>{var a;n&&e.toggleSelected((a=r.target)==null?void 0:a.checked)}}}},M2=(e,t,n,r,a)=>{var u;const p=a.getRow(t,!0);n?(p.getCanMultiSelect()||Object.keys(e).forEach(i=>delete e[i]),p.getCanSelect()&&(e[t]=!0)):delete e[t],r&&(u=p.subRows)!=null&&u.length&&p.getCanSelectSubRows()&&p.subRows.forEach(i=>M2(e,i.id,n,r,a))};function CI(e,t){const n=e.getState().rowSelection,r=[],a={},u=function(p,i){return p.map(b=>{var C;const A=wP(b,n);if(A&&(r.push(b),a[b.id]=b),(C=b.subRows)!=null&&C.length&&(b={...b,subRows:u(b.subRows)}),A)return b}).filter(Boolean)};return{rows:u(t.rows),flatRows:r,rowsById:a}}function wP(e,t){var n;return(n=t[e.id])!=null?n:!1}function P2(e,t,n){var r;if(!((r=e.subRows)!=null&&r.length))return!1;let a=!0,u=!1;return e.subRows.forEach(p=>{if(!(u&&!a)&&(p.getCanSelect()&&(wP(p,t)?u=!0:a=!1),p.subRows&&p.subRows.length)){const i=P2(p,t);i==="all"?u=!0:(i==="some"&&(u=!0),a=!1)}}),a?"all":u?"some":!1}const A2=/([0-9]+)/gm,kre=(e,t,n)=>Pj(z_(e.getValue(n)).toLowerCase(),z_(t.getValue(n)).toLowerCase()),Fre=(e,t,n)=>Pj(z_(e.getValue(n)),z_(t.getValue(n))),zre=(e,t,n)=>SP(z_(e.getValue(n)).toLowerCase(),z_(t.getValue(n)).toLowerCase()),Bre=(e,t,n)=>SP(z_(e.getValue(n)),z_(t.getValue(n))),jre=(e,t,n)=>{const r=e.getValue(n),a=t.getValue(n);return r>a?1:r<a?-1:0},Vre=(e,t,n)=>SP(e.getValue(n),t.getValue(n));function SP(e,t){return e===t?0:e>t?1:-1}function z_(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function Pj(e,t){const n=e.split(A2).filter(Boolean),r=t.split(A2).filter(Boolean);for(;n.length&&r.length;){const a=n.shift(),u=r.shift(),p=parseInt(a,10),i=parseInt(u,10),b=[p,i].sort();if(isNaN(b[0])){if(a>u)return 1;if(u>a)return-1;continue}if(isNaN(b[1]))return isNaN(p)?-1:1;if(p>i)return 1;if(i>p)return-1}return n.length-r.length}const P1={alphanumeric:kre,alphanumericCaseSensitive:Fre,text:zre,textCaseSensitive:Bre,datetime:jre,basic:Vre},Ure={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:nh("sorting",e),isMultiSortEvent:t=>t.shiftKey}),createColumn:(e,t)=>{e.getAutoSortingFn=()=>{const n=t.getFilteredRowModel().flatRows.slice(10);let r=!1;for(const a of n){const u=a==null?void 0:a.getValue(e.id);if(Object.prototype.toString.call(u)==="[object Date]")return P1.datetime;if(typeof u=="string"&&(r=!0,u.split(A2).length>1))return P1.alphanumeric}return r?P1.text:P1.basic},e.getAutoSortDir=()=>{const n=t.getFilteredRowModel().flatRows[0];return typeof(n==null?void 0:n.getValue(e.id))=="string"?"asc":"desc"},e.getSortingFn=()=>{var n,r;if(!e)throw new Error;return aC(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(n=(r=t.options.sortingFns)==null?void 0:r[e.columnDef.sortingFn])!=null?n:P1[e.columnDef.sortingFn]},e.toggleSorting=(n,r)=>{const a=e.getNextSortingOrder(),u=typeof n<"u"&&n!==null;t.setSorting(p=>{const i=p==null?void 0:p.find(V=>V.id===e.id),b=p==null?void 0:p.findIndex(V=>V.id===e.id);let C=[],A,R=u?n:a==="desc";if(p!=null&&p.length&&e.getCanMultiSort()&&r?i?A="toggle":A="add":p!=null&&p.length&&b!==p.length-1?A="replace":i?A="toggle":A="replace",A==="toggle"&&(u||a||(A="remove")),A==="add"){var z;C=[...p,{id:e.id,desc:R}],C.splice(0,C.length-((z=t.options.maxMultiSortColCount)!=null?z:Number.MAX_SAFE_INTEGER))}else A==="toggle"?C=p.map(V=>V.id===e.id?{...V,desc:R}:V):A==="remove"?C=p.filter(V=>V.id!==e.id):C=[{id:e.id,desc:R}];return C})},e.getFirstSortDir=()=>{var n,r;return((n=(r=e.columnDef.sortDescFirst)!=null?r:t.options.sortDescFirst)!=null?n:e.getAutoSortDir()==="desc")?"desc":"asc"},e.getNextSortingOrder=n=>{var r,a;const u=e.getFirstSortDir(),p=e.getIsSorted();return p?p!==u&&((r=t.options.enableSortingRemoval)==null||r)&&(!(n&&(a=t.options.enableMultiRemove)!=null)||a)?!1:p==="desc"?"asc":"desc":u},e.getCanSort=()=>{var n,r;return((n=e.columnDef.enableSorting)!=null?n:!0)&&((r=t.options.enableSorting)!=null?r:!0)&&!!e.accessorFn},e.getCanMultiSort=()=>{var n,r;return(n=(r=e.columnDef.enableMultiSort)!=null?r:t.options.enableMultiSort)!=null?n:!!e.accessorFn},e.getIsSorted=()=>{var n;const r=(n=t.getState().sorting)==null?void 0:n.find(a=>a.id===e.id);return r?r.desc?"desc":"asc":!1},e.getSortIndex=()=>{var n,r;return(n=(r=t.getState().sorting)==null?void 0:r.findIndex(a=>a.id===e.id))!=null?n:-1},e.clearSorting=()=>{t.setSorting(n=>n!=null&&n.length?n.filter(r=>r.id!==e.id):[])},e.getToggleSortingHandler=()=>{const n=e.getCanSort();return r=>{n&&(r.persist==null||r.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?t.options.isMultiSortEvent==null?void 0:t.options.isMultiSortEvent(r):!1))}}},createTable:e=>{e.setSorting=t=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(t),e.resetSorting=t=>{var n,r;e.setSorting(t?[]:(n=(r=e.initialState)==null?void 0:r.sorting)!=null?n:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},Gre=[cre,Pre,Ere,Cre,hre,dre,Are,Rre,Ure,wre,Lre,Ore,Dre,Nre,Ire];function $re(e){var t,n;const r=[...Gre,...(t=e._features)!=null?t:[]];let a={_features:r};const u=a._features.reduce((z,V)=>Object.assign(z,V.getDefaultOptions==null?void 0:V.getDefaultOptions(a)),{}),p=z=>a.options.mergeOptions?a.options.mergeOptions(u,z):{...u,...z};let b={...{},...(n=e.initialState)!=null?n:{}};a._features.forEach(z=>{var V;b=(V=z.getInitialState==null?void 0:z.getInitialState(b))!=null?V:b});const C=[];let A=!1;const R={_features:r,options:{...u,...e},initialState:b,_queue:z=>{C.push(z),A||(A=!0,Promise.resolve().then(()=>{for(;C.length;)C.shift()();A=!1}).catch(V=>setTimeout(()=>{throw V})))},reset:()=>{a.setState(a.initialState)},setOptions:z=>{const V=g_(z,a.options);a.options=p(V)},getState:()=>a.options.state,setState:z=>{a.options.onStateChange==null||a.options.onStateChange(z)},_getRowId:(z,V,W)=>{var X;return(X=a.options.getRowId==null?void 0:a.options.getRowId(z,V,W))!=null?X:`${W?[W.id,V].join("."):V}`},getCoreRowModel:()=>(a._getCoreRowModel||(a._getCoreRowModel=a.options.getCoreRowModel(a)),a._getCoreRowModel()),getRowModel:()=>a.getPaginationRowModel(),getRow:(z,V)=>{let W=(V?a.getPrePaginationRowModel():a.getRowModel()).rowsById[z];if(!W&&(W=a.getCoreRowModel().rowsById[z],!W))throw new Error;return W},_getDefaultColumnDef:jr(()=>[a.options.defaultColumn],z=>{var V;return z=(V=z)!=null?V:{},{header:W=>{const X=W.header.column.columnDef;return X.accessorKey?X.accessorKey:X.accessorFn?X.id:null},cell:W=>{var X,ue;return(X=(ue=W.renderValue())==null||ue.toString==null?void 0:ue.toString())!=null?X:null},...a._features.reduce((W,X)=>Object.assign(W,X.getDefaultColumnDef==null?void 0:X.getDefaultColumnDef()),{}),...z}},Vr(e,"debugColumns")),_getColumnDefs:()=>a.options.columns,getAllColumns:jr(()=>[a._getColumnDefs()],z=>{const V=function(W,X,ue){return ue===void 0&&(ue=0),W.map(ie=>{const K=ure(a,ie,ue,X),ee=ie;return K.columns=ee.columns?V(ee.columns,K,ue+1):[],K})};return V(z)},Vr(e,"debugColumns")),getAllFlatColumns:jr(()=>[a.getAllColumns()],z=>z.flatMap(V=>V.getFlatColumns()),Vr(e,"debugColumns")),_getAllFlatColumnsById:jr(()=>[a.getAllFlatColumns()],z=>z.reduce((V,W)=>(V[W.id]=W,V),{}),Vr(e,"debugColumns")),getAllLeafColumns:jr(()=>[a.getAllColumns(),a._getOrderColumnsFn()],(z,V)=>{let W=z.flatMap(X=>X.getLeafColumns());return V(W)},Vr(e,"debugColumns")),getColumn:z=>a._getAllFlatColumnsById()[z]};Object.assign(a,R);for(let z=0;z<a._features.length;z++){const V=a._features[z];V==null||V.createTable==null||V.createTable(a)}return a}function qre(){return e=>jr(()=>[e.options.data],t=>{const n={rows:[],flatRows:[],rowsById:{}},r=function(a,u,p){u===void 0&&(u=0);const i=[];for(let C=0;C<a.length;C++){const A=xP(e,e._getRowId(a[C],C,p),a[C],C,u,void 0,p==null?void 0:p.id);if(n.flatRows.push(A),n.rowsById[A.id]=A,i.push(A),e.options.getSubRows){var b;A.originalSubRows=e.options.getSubRows(a[C],C),(b=A.originalSubRows)!=null&&b.length&&(A.subRows=r(A.originalSubRows,u+1,A))}}return i};return n.rows=r(t),n},Vr(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function Hre(e){const t=[],n=r=>{var a;t.push(r),(a=r.subRows)!=null&&a.length&&r.getIsExpanded()&&r.subRows.forEach(n)};return e.rows.forEach(n),{rows:t,flatRows:e.flatRows,rowsById:e.rowsById}}function Wre(e,t,n){return n.options.filterFromLeafRows?Xre(e,t,n):Zre(e,t,n)}function Xre(e,t,n){var r;const a=[],u={},p=(r=n.options.maxLeafRowFilterDepth)!=null?r:100,i=function(b,C){C===void 0&&(C=0);const A=[];for(let z=0;z<b.length;z++){var R;let V=b[z];const W=xP(n,V.id,V.original,V.index,V.depth,void 0,V.parentId);if(W.columnFilters=V.columnFilters,(R=V.subRows)!=null&&R.length&&C<p){if(W.subRows=i(V.subRows,C+1),V=W,t(V)&&!W.subRows.length){A.push(V),u[V.id]=V,a.push(V);continue}if(t(V)||W.subRows.length){A.push(V),u[V.id]=V,a.push(V);continue}}else V=W,t(V)&&(A.push(V),u[V.id]=V,a.push(V))}return A};return{rows:i(e),flatRows:a,rowsById:u}}function Zre(e,t,n){var r;const a=[],u={},p=(r=n.options.maxLeafRowFilterDepth)!=null?r:100,i=function(b,C){C===void 0&&(C=0);const A=[];for(let z=0;z<b.length;z++){let V=b[z];if(t(V)){var R;if((R=V.subRows)!=null&&R.length&&C<p){const X=xP(n,V.id,V.original,V.index,V.depth,void 0,V.parentId);X.subRows=i(V.subRows,C+1),V=X}A.push(V),a.push(V),u[V.id]=V}}return A};return{rows:i(e),flatRows:a,rowsById:u}}function Yre(){return e=>jr(()=>[e.getPreFilteredRowModel(),e.getState().columnFilters,e.getState().globalFilter],(t,n,r)=>{if(!t.rows.length||!(n!=null&&n.length)&&!r){for(let z=0;z<t.flatRows.length;z++)t.flatRows[z].columnFilters={},t.flatRows[z].columnFiltersMeta={};return t}const a=[],u=[];(n??[]).forEach(z=>{var V;const W=e.getColumn(z.id);if(!W)return;const X=W.getFilterFn();X&&a.push({id:z.id,filterFn:X,resolvedValue:(V=X.resolveFilterValue==null?void 0:X.resolveFilterValue(z.value))!=null?V:z.value})});const p=(n??[]).map(z=>z.id),i=e.getGlobalFilterFn(),b=e.getAllLeafColumns().filter(z=>z.getCanGlobalFilter());r&&i&&b.length&&(p.push("__global__"),b.forEach(z=>{var V;u.push({id:z.id,filterFn:i,resolvedValue:(V=i.resolveFilterValue==null?void 0:i.resolveFilterValue(r))!=null?V:r})}));let C,A;for(let z=0;z<t.flatRows.length;z++){const V=t.flatRows[z];if(V.columnFilters={},a.length)for(let W=0;W<a.length;W++){C=a[W];const X=C.id;V.columnFilters[X]=C.filterFn(V,X,C.resolvedValue,ue=>{V.columnFiltersMeta[X]=ue})}if(u.length){for(let W=0;W<u.length;W++){A=u[W];const X=A.id;if(A.filterFn(V,X,A.resolvedValue,ue=>{V.columnFiltersMeta[X]=ue})){V.columnFilters.__global__=!0;break}}V.columnFilters.__global__!==!0&&(V.columnFilters.__global__=!1)}}const R=z=>{for(let V=0;V<p.length;V++)if(z.columnFilters[p[V]]===!1)return!1;return!0};return Wre(t.rows,R,e)},Vr(e.options,"debugTable","getFilteredRowModel",()=>e._autoResetPageIndex()))}function Kre(e){return t=>jr(()=>[t.getState().pagination,t.getPrePaginationRowModel(),t.options.paginateExpandedRows?void 0:t.getState().expanded],(n,r)=>{if(!r.rows.length)return r;const{pageSize:a,pageIndex:u}=n;let{rows:p,flatRows:i,rowsById:b}=r;const C=a*u,A=C+a;p=p.slice(C,A);let R;t.options.paginateExpandedRows?R={rows:p,flatRows:i,rowsById:b}:R=Hre({rows:p,flatRows:i,rowsById:b}),R.flatRows=[];const z=V=>{R.flatRows.push(V),V.subRows.length&&V.subRows.forEach(z)};return R.rows.forEach(z),R},Vr(t.options,"debugTable"))}function Jre(){return e=>jr(()=>[e.getState().sorting,e.getPreSortedRowModel()],(t,n)=>{if(!n.rows.length||!(t!=null&&t.length))return n;const r=e.getState().sorting,a=[],u=r.filter(b=>{var C;return(C=e.getColumn(b.id))==null?void 0:C.getCanSort()}),p={};u.forEach(b=>{const C=e.getColumn(b.id);C&&(p[b.id]={sortUndefined:C.columnDef.sortUndefined,invertSorting:C.columnDef.invertSorting,sortingFn:C.getSortingFn()})});const i=b=>{const C=b.map(A=>({...A}));return C.sort((A,R)=>{for(let V=0;V<u.length;V+=1){var z;const W=u[V],X=p[W.id],ue=X.sortUndefined,ie=(z=W==null?void 0:W.desc)!=null?z:!1;let K=0;if(ue){const ee=A.getValue(W.id),ae=R.getValue(W.id),he=ee===void 0,xe=ae===void 0;if(he||xe){if(ue==="first")return he?-1:1;if(ue==="last")return he?1:-1;K=he&&xe?0:he?ue:-ue}}if(K===0&&(K=X.sortingFn(A,R,W.id)),K!==0)return ie&&(K*=-1),X.invertSorting&&(K*=-1),K}return A.index-R.index}),C.forEach(A=>{var R;a.push(A),(R=A.subRows)!=null&&R.length&&(A.subRows=i(A.subRows))}),C};return{rows:i(n.rows),flatRows:a,rowsById:n.rowsById}},Vr(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function fk(e,t){return e?Qre(e)?Y.createElement(e,t):e:null}function Qre(e){return eie(e)||typeof e=="function"||tie(e)}function eie(e){return typeof e=="function"&&(()=>{const t=Object.getPrototypeOf(e);return t.prototype&&t.prototype.isReactComponent})()}function tie(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function nie(e){const t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[n]=Y.useState(()=>({current:$re(t)})),[r,a]=Y.useState(()=>n.current.initialState);return n.current.setOptions(u=>({...u,...e,state:{...r,...e.state},onStateChange:p=>{a(p),e.onStateChange==null||e.onStateChange(p)}})),n.current}function rie(e){const t=iie(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(sie);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function iie(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n,p=Y.isValidElement(a)?lie(a):void 0,i=Xr(p,r);if(Y.isValidElement(a)){const b=aie(u,a.props);return a.type!==Y.Fragment&&(b.ref=i),Y.cloneElement(a,b)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var oie=Symbol("radix.slottable");function sie(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===oie}function aie(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{const b=u(...i);return a(...i),b}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function lie(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var uie=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],EP=uie.reduce((e,t)=>{const n=rie(`Primitive.${t}`),r=Y.forwardRef((a,u)=>{const{asChild:p,...i}=a,b=p?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(b,{...i,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),lC="Checkbox",[cie,bae]=Zl(lC),[hie,CP]=cie(lC);function die(e){const{__scopeCheckbox:t,checked:n,children:r,defaultChecked:a,disabled:u,form:p,name:i,onCheckedChange:b,required:C,value:A="on",internal_do_not_use_render:R}=e,[z,V]=Hc({prop:n,defaultProp:a??!1,onChange:b,caller:lC}),[W,X]=Y.useState(null),[ue,ie]=Y.useState(null),K=Y.useRef(!1),ee=W?!!p||!!W.closest("form"):!0,ae={checked:z,disabled:u,setChecked:V,control:W,setControl:X,name:i,form:p,value:A,hasConsumerStoppedPropagationRef:K,required:C,defaultChecked:b_(a)?!1:a,isFormControl:ee,bubbleInput:ue,setBubbleInput:ie};return G.jsx(hie,{scope:t,...ae,children:fie(R)?R(ae):r})}var Aj="CheckboxTrigger",Rj=Y.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...r},a)=>{const{control:u,value:p,disabled:i,checked:b,required:C,setControl:A,setChecked:R,hasConsumerStoppedPropagationRef:z,isFormControl:V,bubbleInput:W}=CP(Aj,e),X=Xr(a,A),ue=Y.useRef(b);return Y.useEffect(()=>{const ie=u==null?void 0:u.form;if(ie){const K=()=>R(ue.current);return ie.addEventListener("reset",K),()=>ie.removeEventListener("reset",K)}},[u,R]),G.jsx(EP.button,{type:"button",role:"checkbox","aria-checked":b_(b)?"mixed":b,"aria-required":C,"data-state":kj(b),"data-disabled":i?"":void 0,disabled:i,value:p,...r,ref:X,onKeyDown:Dn(t,ie=>{ie.key==="Enter"&&ie.preventDefault()}),onClick:Dn(n,ie=>{R(K=>b_(K)?!0:!K),W&&V&&(z.current=ie.isPropagationStopped(),z.current||ie.stopPropagation())})})});Rj.displayName=Aj;var TP=Y.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:u,required:p,disabled:i,value:b,onCheckedChange:C,form:A,...R}=e;return G.jsx(die,{__scopeCheckbox:n,checked:a,defaultChecked:u,disabled:i,required:p,onCheckedChange:C,name:r,form:A,value:b,internal_do_not_use_render:({isFormControl:z})=>G.jsxs(G.Fragment,{children:[G.jsx(Rj,{...R,ref:t,__scopeCheckbox:n}),z&&G.jsx(Nj,{__scopeCheckbox:n})]})})});TP.displayName=lC;var Lj="CheckboxIndicator",Oj=Y.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...a}=e,u=CP(Lj,n);return G.jsx(pc,{present:r||b_(u.checked)||u.checked===!0,children:G.jsx(EP.span,{"data-state":kj(u.checked),"data-disabled":u.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});Oj.displayName=Lj;var Dj="CheckboxBubbleInput",Nj=Y.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:u,defaultChecked:p,required:i,disabled:b,name:C,value:A,form:R,bubbleInput:z,setBubbleInput:V}=CP(Dj,e),W=Xr(n,V),X=zM(u),ue=RE(r);Y.useEffect(()=>{const K=z;if(!K)return;const ee=window.HTMLInputElement.prototype,he=Object.getOwnPropertyDescriptor(ee,"checked").set,xe=!a.current;if(X!==u&&he){const ye=new Event("click",{bubbles:xe});K.indeterminate=b_(u),he.call(K,b_(u)?!1:u),K.dispatchEvent(ye)}},[z,X,u,a]);const ie=Y.useRef(b_(u)?!1:u);return G.jsx(EP.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??ie.current,required:i,disabled:b,name:C,value:A,form:R,...t,tabIndex:-1,ref:W,style:{...t.style,...ue,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Nj.displayName=Dj;function fie(e){return typeof e=="function"}function b_(e){return e==="indeterminate"}function kj(e){return b_(e)?"indeterminate":e?"checked":"unchecked"}const R2=Y.forwardRef(({className:e,...t},n)=>G.jsx(TP,{ref:n,className:dn("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:G.jsx(Oj,{className:dn("flex items-center justify-center text-current"),children:G.jsx(Sa,{className:"h-4 w-4"})})}));R2.displayName=TP.displayName;const Fj=Y.forwardRef(({className:e,...t},n)=>G.jsx("div",{className:"relative w-full overflow-auto",children:G.jsx("table",{ref:n,className:dn("w-full caption-bottom text-sm",e),...t})}));Fj.displayName="Table";const zj=Y.forwardRef(({className:e,...t},n)=>G.jsx("thead",{ref:n,className:dn("[&_tr]:border-b",e),...t}));zj.displayName="TableHeader";const Bj=Y.forwardRef(({className:e,...t},n)=>G.jsx("tbody",{ref:n,className:dn("[&_tr:last-child]:border-0",e),...t}));Bj.displayName="TableBody";const pie=Y.forwardRef(({className:e,...t},n)=>G.jsx("tfoot",{ref:n,className:dn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));pie.displayName="TableFooter";const AS=Y.forwardRef(({className:e,...t},n)=>G.jsx("tr",{ref:n,className:dn("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));AS.displayName="TableRow";const jj=Y.forwardRef(({className:e,...t},n)=>G.jsx("th",{ref:n,className:dn("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));jj.displayName="TableHead";const L2=Y.forwardRef(({className:e,...t},n)=>G.jsx("td",{ref:n,className:dn("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));L2.displayName="TableCell";const mie=Y.forwardRef(({className:e,...t},n)=>G.jsx("caption",{ref:n,className:dn("mt-4 text-sm text-muted-foreground",e),...t}));mie.displayName="TableCaption";function gie(e){const t=_ie(e),n=Y.forwardRef((r,a)=>{const{children:u,...p}=r,i=Y.Children.toArray(u),b=i.find(vie);if(b){const C=b.props.children,A=i.map(R=>R===b?Y.Children.count(C)>1?Y.Children.only(null):Y.isValidElement(C)?C.props.children:null:R);return G.jsx(t,{...p,ref:a,children:Y.isValidElement(C)?Y.cloneElement(C,void 0,A):null})}return G.jsx(t,{...p,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function _ie(e){const t=Y.forwardRef((n,r)=>{const{children:a,...u}=n;if(Y.isValidElement(a)){const p=bie(a),i=xie(u,a.props);return a.type!==Y.Fragment&&(i.ref=r?Tu(r,p):p),Y.cloneElement(a,i)}return Y.Children.count(a)>1?Y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var yie=Symbol("radix.slottable");function vie(e){return Y.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===yie}function xie(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...i)=>{u(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function bie(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Vj=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),wie="VisuallyHidden",Sie=Y.forwardRef((e,t)=>G.jsx(Ir.span,{...e,ref:t,style:{...Vj,...e.style}}));Sie.displayName=wie;var Eie=[" ","Enter","ArrowUp","ArrowDown"],Cie=[" ","Enter"],iv="Select",[uC,cC,Tie]=Sb(iv),[Mx,wae]=Zl(iv,[Tie,hx]),hC=hx(),[Iie,q_]=Mx(iv),[Mie,Pie]=Mx(iv),Uj=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:a,onOpenChange:u,value:p,defaultValue:i,onValueChange:b,dir:C,name:A,autoComplete:R,disabled:z,required:V,form:W}=e,X=hC(t),[ue,ie]=Y.useState(null),[K,ee]=Y.useState(null),[ae,he]=Y.useState(!1),xe=Eb(C),[ye,Se]=Hc({prop:r,defaultProp:a??!1,onChange:u,caller:iv}),[je,Re]=Hc({prop:p,defaultProp:i,onChange:b,caller:iv}),De=Y.useRef(null),at=ue?W||!!ue.closest("form"):!0,[ot,Fe]=Y.useState(new Set),Ze=Array.from(ot).map(Ve=>Ve.props.value).join(";");return G.jsx(FE,{...X,children:G.jsxs(Iie,{required:V,scope:t,trigger:ue,onTriggerChange:ie,valueNode:K,onValueNodeChange:ee,valueNodeHasChildren:ae,onValueNodeHasChildrenChange:he,contentId:Ns(),value:je,onValueChange:Re,open:ye,onOpenChange:Se,dir:xe,triggerPointerDownPosRef:De,disabled:z,children:[G.jsx(uC.Provider,{scope:t,children:G.jsx(Mie,{scope:e.__scopeSelect,onNativeOptionAdd:Y.useCallback(Ve=>{Fe(mt=>new Set(mt).add(Ve))},[]),onNativeOptionRemove:Y.useCallback(Ve=>{Fe(mt=>{const We=new Set(mt);return We.delete(Ve),We})},[]),children:n})}),at?G.jsxs(dV,{"aria-hidden":!0,required:V,tabIndex:-1,name:A,autoComplete:R,value:je,onChange:Ve=>Re(Ve.target.value),disabled:z,form:W,children:[je===void 0?G.jsx("option",{value:""}):null,Array.from(ot)]},Ze):null]})})};Uj.displayName=iv;var Gj="SelectTrigger",$j=Y.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:r=!1,...a}=e,u=hC(n),p=q_(Gj,n),i=p.disabled||r,b=Xr(t,p.onTriggerChange),C=cC(n),A=Y.useRef("touch"),[R,z,V]=pV(X=>{const ue=C().filter(ee=>!ee.disabled),ie=ue.find(ee=>ee.value===p.value),K=mV(ue,X,ie);K!==void 0&&p.onValueChange(K.value)}),W=X=>{i||(p.onOpenChange(!0),V()),X&&(p.triggerPointerDownPosRef.current={x:Math.round(X.pageX),y:Math.round(X.pageY)})};return G.jsx(zE,{asChild:!0,...u,children:G.jsx(Ir.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":fV(p.value)?"":void 0,...a,ref:b,onClick:Dn(a.onClick,X=>{X.currentTarget.focus(),A.current!=="mouse"&&W(X)}),onPointerDown:Dn(a.onPointerDown,X=>{A.current=X.pointerType;const ue=X.target;ue.hasPointerCapture(X.pointerId)&&ue.releasePointerCapture(X.pointerId),X.button===0&&X.ctrlKey===!1&&X.pointerType==="mouse"&&(W(X),X.preventDefault())}),onKeyDown:Dn(a.onKeyDown,X=>{const ue=R.current!=="";!(X.ctrlKey||X.altKey||X.metaKey)&&X.key.length===1&&z(X.key),!(ue&&X.key===" ")&&Eie.includes(X.key)&&(W(),X.preventDefault())})})})});$j.displayName=Gj;var qj="SelectValue",Hj=Y.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,children:u,placeholder:p="",...i}=e,b=q_(qj,n),{onValueNodeHasChildrenChange:C}=b,A=u!==void 0,R=Xr(t,b.onValueNodeChange);return na(()=>{C(A)},[C,A]),G.jsx(Ir.span,{...i,ref:R,style:{pointerEvents:"none"},children:fV(b.value)?G.jsx(G.Fragment,{children:p}):u})});Hj.displayName=qj;var Aie="SelectIcon",Wj=Y.forwardRef((e,t)=>{const{__scopeSelect:n,children:r,...a}=e;return G.jsx(Ir.span,{"aria-hidden":!0,...a,ref:t,children:r||""})});Wj.displayName=Aie;var Rie="SelectPortal",Xj=e=>G.jsx(_b,{asChild:!0,...e});Xj.displayName=Rie;var ov="SelectContent",Zj=Y.forwardRef((e,t)=>{const n=q_(ov,e.__scopeSelect),[r,a]=Y.useState();if(na(()=>{a(new DocumentFragment)},[]),!n.open){const u=r;return u?Jd.createPortal(G.jsx(Yj,{scope:e.__scopeSelect,children:G.jsx(uC.Slot,{scope:e.__scopeSelect,children:G.jsx("div",{children:e.children})})}),u):null}return G.jsx(Kj,{...e,ref:t})});Zj.displayName=ov;var Wd=10,[Yj,H_]=Mx(ov),Lie="SelectContentImpl",Oie=gie("SelectContent.RemoveScroll"),Kj=Y.forwardRef((e,t)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:u,onPointerDownOutside:p,side:i,sideOffset:b,align:C,alignOffset:A,arrowPadding:R,collisionBoundary:z,collisionPadding:V,sticky:W,hideWhenDetached:X,avoidCollisions:ue,...ie}=e,K=q_(ov,n),[ee,ae]=Y.useState(null),[he,xe]=Y.useState(null),ye=Xr(t,Ut=>ae(Ut)),[Se,je]=Y.useState(null),[Re,De]=Y.useState(null),at=cC(n),[ot,Fe]=Y.useState(!1),Ze=Y.useRef(!1);Y.useEffect(()=>{if(ee)return EE(ee)},[ee]),wE();const Ve=Y.useCallback(Ut=>{const[wn,...Pn]=at().map(Mr=>Mr.ref.current),[we]=Pn.slice(-1),Rr=document.activeElement;for(const Mr of Ut)if(Mr===Rr||(Mr==null||Mr.scrollIntoView({block:"nearest"}),Mr===wn&&he&&(he.scrollTop=0),Mr===we&&he&&(he.scrollTop=he.scrollHeight),Mr==null||Mr.focus(),document.activeElement!==Rr))return},[at,he]),mt=Y.useCallback(()=>Ve([Se,ee]),[Ve,Se,ee]);Y.useEffect(()=>{ot&&mt()},[ot,mt]);const{onOpenChange:We,triggerPointerDownPosRef:tt}=K;Y.useEffect(()=>{if(ee){let Ut={x:0,y:0};const wn=we=>{var Rr,Mr;Ut={x:Math.abs(Math.round(we.pageX)-(((Rr=tt.current)==null?void 0:Rr.x)??0)),y:Math.abs(Math.round(we.pageY)-(((Mr=tt.current)==null?void 0:Mr.y)??0))}},Pn=we=>{Ut.x<=10&&Ut.y<=10?we.preventDefault():ee.contains(we.target)||We(!1),document.removeEventListener("pointermove",wn),tt.current=null};return tt.current!==null&&(document.addEventListener("pointermove",wn),document.addEventListener("pointerup",Pn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",wn),document.removeEventListener("pointerup",Pn,{capture:!0})}}},[ee,We,tt]),Y.useEffect(()=>{const Ut=()=>We(!1);return window.addEventListener("blur",Ut),window.addEventListener("resize",Ut),()=>{window.removeEventListener("blur",Ut),window.removeEventListener("resize",Ut)}},[We]);const[Dt,$e]=pV(Ut=>{const wn=at().filter(Rr=>!Rr.disabled),Pn=wn.find(Rr=>Rr.ref.current===document.activeElement),we=mV(wn,Ut,Pn);we&&setTimeout(()=>we.ref.current.focus())}),Ke=Y.useCallback((Ut,wn,Pn)=>{const we=!Ze.current&&!Pn;(K.value!==void 0&&K.value===wn||we)&&(je(Ut),we&&(Ze.current=!0))},[K.value]),gt=Y.useCallback(()=>ee==null?void 0:ee.focus(),[ee]),Yt=Y.useCallback((Ut,wn,Pn)=>{const we=!Ze.current&&!Pn;(K.value!==void 0&&K.value===wn||we)&&De(Ut)},[K.value]),Kt=r==="popper"?O2:Jj,nn=Kt===O2?{side:i,sideOffset:b,align:C,alignOffset:A,arrowPadding:R,collisionBoundary:z,collisionPadding:V,sticky:W,hideWhenDetached:X,avoidCollisions:ue}:{};return G.jsx(Yj,{scope:n,content:ee,viewport:he,onViewportChange:xe,itemRefCallback:Ke,selectedItem:Se,onItemLeave:gt,itemTextRefCallback:Yt,focusSelectedItem:mt,selectedItemText:Re,position:r,isPositioned:ot,searchRef:Dt,children:G.jsx(yb,{as:Oie,allowPinchZoom:!0,children:G.jsx(gb,{asChild:!0,trapped:K.open,onMountAutoFocus:Ut=>{Ut.preventDefault()},onUnmountAutoFocus:Dn(a,Ut=>{var wn;(wn=K.trigger)==null||wn.focus({preventScroll:!0}),Ut.preventDefault()}),children:G.jsx(mb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:Ut=>Ut.preventDefault(),onDismiss:()=>K.onOpenChange(!1),children:G.jsx(Kt,{role:"listbox",id:K.contentId,"data-state":K.open?"open":"closed",dir:K.dir,onContextMenu:Ut=>Ut.preventDefault(),...ie,...nn,onPlaced:()=>Fe(!0),ref:ye,style:{display:"flex",flexDirection:"column",outline:"none",...ie.style},onKeyDown:Dn(ie.onKeyDown,Ut=>{const wn=Ut.ctrlKey||Ut.altKey||Ut.metaKey;if(Ut.key==="Tab"&&Ut.preventDefault(),!wn&&Ut.key.length===1&&$e(Ut.key),["ArrowUp","ArrowDown","Home","End"].includes(Ut.key)){let we=at().filter(Rr=>!Rr.disabled).map(Rr=>Rr.ref.current);if(["ArrowUp","End"].includes(Ut.key)&&(we=we.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ut.key)){const Rr=Ut.target,Mr=we.indexOf(Rr);we=we.slice(Mr+1)}setTimeout(()=>Ve(we)),Ut.preventDefault()}})})})})})})});Kj.displayName=Lie;var Die="SelectItemAlignedPosition",Jj=Y.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:r,...a}=e,u=q_(ov,n),p=H_(ov,n),[i,b]=Y.useState(null),[C,A]=Y.useState(null),R=Xr(t,ye=>A(ye)),z=cC(n),V=Y.useRef(!1),W=Y.useRef(!0),{viewport:X,selectedItem:ue,selectedItemText:ie,focusSelectedItem:K}=p,ee=Y.useCallback(()=>{if(u.trigger&&u.valueNode&&i&&C&&X&&ue&&ie){const ye=u.trigger.getBoundingClientRect(),Se=C.getBoundingClientRect(),je=u.valueNode.getBoundingClientRect(),Re=ie.getBoundingClientRect();if(u.dir!=="rtl"){const Rr=Re.left-Se.left,Mr=je.left-Rr,yi=ye.left-Mr,Gt=ye.width+yi,Io=Math.max(Gt,Se.width),qi=window.innerWidth-Wd,Ji=$S(Mr,[Wd,Math.max(Wd,qi-Io)]);i.style.minWidth=Gt+"px",i.style.left=Ji+"px"}else{const Rr=Se.right-Re.right,Mr=window.innerWidth-je.right-Rr,yi=window.innerWidth-ye.right-Mr,Gt=ye.width+yi,Io=Math.max(Gt,Se.width),qi=window.innerWidth-Wd,Ji=$S(Mr,[Wd,Math.max(Wd,qi-Io)]);i.style.minWidth=Gt+"px",i.style.right=Ji+"px"}const De=z(),at=window.innerHeight-Wd*2,ot=X.scrollHeight,Fe=window.getComputedStyle(C),Ze=parseInt(Fe.borderTopWidth,10),Ve=parseInt(Fe.paddingTop,10),mt=parseInt(Fe.borderBottomWidth,10),We=parseInt(Fe.paddingBottom,10),tt=Ze+Ve+ot+We+mt,Dt=Math.min(ue.offsetHeight*5,tt),$e=window.getComputedStyle(X),Ke=parseInt($e.paddingTop,10),gt=parseInt($e.paddingBottom,10),Yt=ye.top+ye.height/2-Wd,Kt=at-Yt,nn=ue.offsetHeight/2,Ut=ue.offsetTop+nn,wn=Ze+Ve+Ut,Pn=tt-wn;if(wn<=Yt){const Rr=De.length>0&&ue===De[De.length-1].ref.current;i.style.bottom="0px";const Mr=C.clientHeight-X.offsetTop-X.offsetHeight,yi=Math.max(Kt,nn+(Rr?gt:0)+Mr+mt),Gt=wn+yi;i.style.height=Gt+"px"}else{const Rr=De.length>0&&ue===De[0].ref.current;i.style.top="0px";const yi=Math.max(Yt,Ze+X.offsetTop+(Rr?Ke:0)+nn)+Pn;i.style.height=yi+"px",X.scrollTop=wn-Yt+X.offsetTop}i.style.margin=`${Wd}px 0`,i.style.minHeight=Dt+"px",i.style.maxHeight=at+"px",r==null||r(),requestAnimationFrame(()=>V.current=!0)}},[z,u.trigger,u.valueNode,i,C,X,ue,ie,u.dir,r]);na(()=>ee(),[ee]);const[ae,he]=Y.useState();na(()=>{C&&he(window.getComputedStyle(C).zIndex)},[C]);const xe=Y.useCallback(ye=>{ye&&W.current===!0&&(ee(),K==null||K(),W.current=!1)},[ee,K]);return G.jsx(kie,{scope:n,contentWrapper:i,shouldExpandOnScrollRef:V,onScrollButtonChange:xe,children:G.jsx("div",{ref:b,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ae},children:G.jsx(Ir.div,{...a,ref:R,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});Jj.displayName=Die;var Nie="SelectPopperPosition",O2=Y.forwardRef((e,t)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=Wd,...u}=e,p=hC(n);return G.jsx(wM,{...p,...u,ref:t,align:r,collisionPadding:a,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});O2.displayName=Nie;var[kie,IP]=Mx(ov,{}),D2="SelectViewport",Qj=Y.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:r,...a}=e,u=H_(D2,n),p=IP(D2,n),i=Xr(t,u.onViewportChange),b=Y.useRef(0);return G.jsxs(G.Fragment,{children:[G.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),G.jsx(uC.Slot,{scope:n,children:G.jsx(Ir.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:Dn(a.onScroll,C=>{const A=C.currentTarget,{contentWrapper:R,shouldExpandOnScrollRef:z}=p;if(z!=null&&z.current&&R){const V=Math.abs(b.current-A.scrollTop);if(V>0){const W=window.innerHeight-Wd*2,X=parseFloat(R.style.minHeight),ue=parseFloat(R.style.height),ie=Math.max(X,ue);if(ie<W){const K=ie+V,ee=Math.min(W,K),ae=K-ee;R.style.height=ee+"px",R.style.bottom==="0px"&&(A.scrollTop=ae>0?ae:0,R.style.justifyContent="flex-end")}}}b.current=A.scrollTop})})})]})});Qj.displayName=D2;var eV="SelectGroup",[Fie,zie]=Mx(eV),Bie=Y.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=Ns();return G.jsx(Fie,{scope:n,id:a,children:G.jsx(Ir.div,{role:"group","aria-labelledby":a,...r,ref:t})})});Bie.displayName=eV;var tV="SelectLabel",nV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=zie(tV,n);return G.jsx(Ir.div,{id:a.id,...r,ref:t})});nV.displayName=tV;var hE="SelectItem",[jie,rV]=Mx(hE),iV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:u,...p}=e,i=q_(hE,n),b=H_(hE,n),C=i.value===r,[A,R]=Y.useState(u??""),[z,V]=Y.useState(!1),W=Xr(t,K=>{var ee;return(ee=b.itemRefCallback)==null?void 0:ee.call(b,K,r,a)}),X=Ns(),ue=Y.useRef("touch"),ie=()=>{a||(i.onValueChange(r),i.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return G.jsx(jie,{scope:n,value:r,disabled:a,textId:X,isSelected:C,onItemTextChange:Y.useCallback(K=>{R(ee=>ee||((K==null?void 0:K.textContent)??"").trim())},[]),children:G.jsx(uC.ItemSlot,{scope:n,value:r,disabled:a,textValue:A,children:G.jsx(Ir.div,{role:"option","aria-labelledby":X,"data-highlighted":z?"":void 0,"aria-selected":C&&z,"data-state":C?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...p,ref:W,onFocus:Dn(p.onFocus,()=>V(!0)),onBlur:Dn(p.onBlur,()=>V(!1)),onClick:Dn(p.onClick,()=>{ue.current!=="mouse"&&ie()}),onPointerUp:Dn(p.onPointerUp,()=>{ue.current==="mouse"&&ie()}),onPointerDown:Dn(p.onPointerDown,K=>{ue.current=K.pointerType}),onPointerMove:Dn(p.onPointerMove,K=>{var ee;ue.current=K.pointerType,a?(ee=b.onItemLeave)==null||ee.call(b):ue.current==="mouse"&&K.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Dn(p.onPointerLeave,K=>{var ee;K.currentTarget===document.activeElement&&((ee=b.onItemLeave)==null||ee.call(b))}),onKeyDown:Dn(p.onKeyDown,K=>{var ae;((ae=b.searchRef)==null?void 0:ae.current)!==""&&K.key===" "||(Cie.includes(K.key)&&ie(),K.key===" "&&K.preventDefault())})})})})});iV.displayName=hE;var F1="SelectItemText",oV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,...u}=e,p=q_(F1,n),i=H_(F1,n),b=rV(F1,n),C=Pie(F1,n),[A,R]=Y.useState(null),z=Xr(t,ie=>R(ie),b.onItemTextChange,ie=>{var K;return(K=i.itemTextRefCallback)==null?void 0:K.call(i,ie,b.value,b.disabled)}),V=A==null?void 0:A.textContent,W=Y.useMemo(()=>G.jsx("option",{value:b.value,disabled:b.disabled,children:V},b.value),[b.disabled,b.value,V]),{onNativeOptionAdd:X,onNativeOptionRemove:ue}=C;return na(()=>(X(W),()=>ue(W)),[X,ue,W]),G.jsxs(G.Fragment,{children:[G.jsx(Ir.span,{id:b.textId,...u,ref:z}),b.isSelected&&p.valueNode&&!p.valueNodeHasChildren?Jd.createPortal(u.children,p.valueNode):null]})});oV.displayName=F1;var sV="SelectItemIndicator",aV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return rV(sV,n).isSelected?G.jsx(Ir.span,{"aria-hidden":!0,...r,ref:t}):null});aV.displayName=sV;var N2="SelectScrollUpButton",lV=Y.forwardRef((e,t)=>{const n=H_(N2,e.__scopeSelect),r=IP(N2,e.__scopeSelect),[a,u]=Y.useState(!1),p=Xr(t,r.onScrollButtonChange);return na(()=>{if(n.viewport&&n.isPositioned){let i=function(){const C=b.scrollTop>0;u(C)};const b=n.viewport;return i(),b.addEventListener("scroll",i),()=>b.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),a?G.jsx(cV,{...e,ref:p,onAutoScroll:()=>{const{viewport:i,selectedItem:b}=n;i&&b&&(i.scrollTop=i.scrollTop-b.offsetHeight)}}):null});lV.displayName=N2;var k2="SelectScrollDownButton",uV=Y.forwardRef((e,t)=>{const n=H_(k2,e.__scopeSelect),r=IP(k2,e.__scopeSelect),[a,u]=Y.useState(!1),p=Xr(t,r.onScrollButtonChange);return na(()=>{if(n.viewport&&n.isPositioned){let i=function(){const C=b.scrollHeight-b.clientHeight,A=Math.ceil(b.scrollTop)<C;u(A)};const b=n.viewport;return i(),b.addEventListener("scroll",i),()=>b.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),a?G.jsx(cV,{...e,ref:p,onAutoScroll:()=>{const{viewport:i,selectedItem:b}=n;i&&b&&(i.scrollTop=i.scrollTop+b.offsetHeight)}}):null});uV.displayName=k2;var cV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=e,u=H_("SelectScrollButton",n),p=Y.useRef(null),i=cC(n),b=Y.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return Y.useEffect(()=>()=>b(),[b]),na(()=>{var A;const C=i().find(R=>R.ref.current===document.activeElement);(A=C==null?void 0:C.ref.current)==null||A.scrollIntoView({block:"nearest"})},[i]),G.jsx(Ir.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:Dn(a.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(r,50))}),onPointerMove:Dn(a.onPointerMove,()=>{var C;(C=u.onItemLeave)==null||C.call(u),p.current===null&&(p.current=window.setInterval(r,50))}),onPointerLeave:Dn(a.onPointerLeave,()=>{b()})})}),Vie="SelectSeparator",hV=Y.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return G.jsx(Ir.div,{"aria-hidden":!0,...r,ref:t})});hV.displayName=Vie;var F2="SelectArrow",Uie=Y.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=hC(n),u=q_(F2,n),p=H_(F2,n);return u.open&&p.position==="popper"?G.jsx(SM,{...a,...r,ref:t}):null});Uie.displayName=F2;var Gie="SelectBubbleInput",dV=Y.forwardRef(({__scopeSelect:e,value:t,...n},r)=>{const a=Y.useRef(null),u=Xr(r,a),p=zM(t);return Y.useEffect(()=>{const i=a.current;if(!i)return;const b=window.HTMLSelectElement.prototype,A=Object.getOwnPropertyDescriptor(b,"value").set;if(p!==t&&A){const R=new Event("change",{bubbles:!0});A.call(i,t),i.dispatchEvent(R)}},[p,t]),G.jsx(Ir.select,{...n,style:{...Vj,...n.style},ref:u,defaultValue:t})});dV.displayName=Gie;function fV(e){return e===""||e===void 0}function pV(e){const t=fd(e),n=Y.useRef(""),r=Y.useRef(0),a=Y.useCallback(p=>{const i=n.current+p;t(i),function b(C){n.current=C,window.clearTimeout(r.current),C!==""&&(r.current=window.setTimeout(()=>b(""),1e3))}(i)},[t]),u=Y.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return Y.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,u]}function mV(e,t,n){const a=t.length>1&&Array.from(t).every(C=>C===t[0])?t[0]:t,u=n?e.indexOf(n):-1;let p=$ie(e,Math.max(u,0));a.length===1&&(p=p.filter(C=>C!==n));const b=p.find(C=>C.textValue.toLowerCase().startsWith(a.toLowerCase()));return b!==n?b:void 0}function $ie(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var qie=Uj,gV=$j,Hie=Hj,Wie=Wj,Xie=Xj,_V=Zj,Zie=Qj,yV=nV,vV=iV,Yie=oV,Kie=aV,xV=lV,bV=uV,wV=hV;const z2=qie,B2=Hie,dE=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsxs(gV,{ref:r,className:dn("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,G.jsx(Wie,{asChild:!0,children:G.jsx(db,{className:"h-4 w-4 opacity-50"})})]}));dE.displayName=gV.displayName;const SV=Y.forwardRef(({className:e,...t},n)=>G.jsx(xV,{ref:n,className:dn("flex cursor-default items-center justify-center py-1",e),...t,children:G.jsx(jk,{className:"h-4 w-4"})}));SV.displayName=xV.displayName;const EV=Y.forwardRef(({className:e,...t},n)=>G.jsx(bV,{ref:n,className:dn("flex cursor-default items-center justify-center py-1",e),...t,children:G.jsx(db,{className:"h-4 w-4"})}));EV.displayName=bV.displayName;const fE=Y.forwardRef(({className:e,children:t,position:n="popper",...r},a)=>G.jsx(Xie,{children:G.jsxs(_V,{ref:a,className:dn("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...r,children:[G.jsx(SV,{}),G.jsx(Zie,{className:dn("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),G.jsx(EV,{})]})}));fE.displayName=_V.displayName;const Jie=Y.forwardRef(({className:e,...t},n)=>G.jsx(yV,{ref:n,className:dn("px-2 py-1.5 text-sm font-semibold",e),...t}));Jie.displayName=yV.displayName;const Um=Y.forwardRef(({className:e,children:t,...n},r)=>G.jsxs(vV,{ref:r,className:dn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[G.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:G.jsx(Kie,{children:G.jsx(Sa,{className:"h-4 w-4"})})}),G.jsx(Yie,{children:t})]}));Um.displayName=vV.displayName;const Qie=Y.forwardRef(({className:e,...t},n)=>G.jsx(wV,{ref:n,className:dn("-mx-1 my-1 h-px bg-muted",e),...t}));Qie.displayName=wV.displayName;function CV(e){return Array.isArray(e)?e.map(CV).join(", "):e&&typeof e=="object"?JSON.stringify(e):e==null?"":String(e)}function eoe({data:e}){var K;const[t,n]=Y.useState([]),[r,a]=Y.useState([]),[u,p]=Y.useState({}),[i,b]=Y.useState({}),[C,A]=Y.useState(!1),[R,z]=Y.useState(10),[V,W]=Y.useState(0),X=Wb(ee=>ee.setSelectedFeatures),ue=Y.useMemo(()=>{if(!e.length)return[];const ee=Object.keys(e[0]).filter(ae=>ae!=="id");return[{id:"select",header:({table:ae})=>G.jsx(R2,{checked:ae.getIsAllRowsSelected()||ae.getIsSomeRowsSelected()&&"indeterminate",onCheckedChange:he=>ae.toggleAllRowsSelected(!!he),"aria-label":"Select all"}),cell:({row:ae})=>G.jsx(R2,{checked:ae.getIsSelected(),onCheckedChange:he=>ae.toggleSelected(!!he),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},...ee.map(ae=>({id:ae,accessorFn:he=>he[ae],header:({column:he})=>G.jsxs(Qr,{variant:"ghost",onClick:()=>he.toggleSorting(he.getIsSorted()==="asc"),children:[ae,G.jsx(_8,{className:"ml-2 h-4 w-4"})]}),cell:({getValue:he})=>G.jsx("div",{children:CV(he())})}))]},[e]),ie=nie({data:e,columns:ue,onSortingChange:n,onColumnFiltersChange:a,getCoreRowModel:qre(),getPaginationRowModel:Kre(),getSortedRowModel:Jre(),getFilteredRowModel:Yre(),onColumnVisibilityChange:p,onRowSelectionChange:b,enableRowSelection:!0,state:{sorting:t,columnFilters:r,columnVisibility:u,rowSelection:i,pagination:{pageIndex:V,pageSize:R}},onPaginationChange:ee=>{if(typeof ee=="function"){const ae=ee({pageIndex:V,pageSize:R});W(ae.pageIndex),z(ae.pageSize)}}});return Y.useEffect(()=>{const ee=ie.getSelectedRowModel().rows.map(ae=>ae.original.id.toString());X(ee)},[i,X,ie]),G.jsxs("div",{className:"h-full flex flex-col",children:[G.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[G.jsxs("div",{className:"flex items-center gap-4",children:[G.jsxs("span",{className:"text-sm text-muted-foreground",children:[ie.getFilteredSelectedRowModel().rows.length," of"," ",ie.getFilteredRowModel().rows.length," row(s) selected"]}),G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),G.jsxs(z2,{value:R.toString(),onValueChange:ee=>z(Number(ee)),children:[G.jsx(dE,{className:"h-8 w-[70px] rows-per-page",children:G.jsx(B2,{placeholder:R})}),G.jsx(fE,{children:[10,20,30,40,50].map(ee=>G.jsx(Um,{value:ee.toString(),children:ee},ee))})]})]})]}),G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsxs(Qr,{variant:"outline",size:"sm",onClick:()=>ie.previousPage(),disabled:!ie.getCanPreviousPage(),className:"flex items-center gap-1",children:[G.jsx(T8,{className:"h-4 w-4"}),"Previous"]}),G.jsxs(Qr,{variant:"outline",size:"sm",onClick:()=>ie.nextPage(),disabled:!ie.getCanNextPage(),className:"flex items-center gap-1",children:["Next",G.jsx(Bk,{className:"h-4 w-4"})]}),G.jsxs(_B,{open:C,onOpenChange:A,children:[G.jsx(yB,{asChild:!0,children:G.jsxs(Qr,{variant:"outline",size:"sm",className:"flex items-center gap-1",children:["Columns",G.jsx(db,{className:"h-4 w-4"})]})}),G.jsx(LM,{align:"end",className:"w-[200px]",children:ie.getAllColumns().filter(ee=>ee.getCanHide()).map(ee=>G.jsx(bB,{className:"capitalize hover:bg-muted",checked:ee.getIsVisible(),onCheckedChange:ae=>ee.toggleVisibility(!!ae),children:ee.id},ee.id))})]})]})]}),G.jsx("div",{className:"flex-1 overflow-auto select-trondheim-checkbox scroll-table",children:G.jsxs(Fj,{children:[G.jsx(zj,{className:"sticky top-0 bg-background z-10 select-all-checkbox",children:ie.getHeaderGroups().map(ee=>G.jsx(AS,{children:ee.headers.map(ae=>G.jsx(jj,{className:"whitespace-nowrap text-center bg-muted/50",children:ae.isPlaceholder?null:fk(ae.column.columnDef.header,ae.getContext())},ae.id))},ee.id))}),G.jsx(Bj,{children:(K=ie.getRowModel().rows)!=null&&K.length?ie.getRowModel().rows.map(ee=>G.jsx(AS,{"data-state":ee.getIsSelected()&&"selected",className:"hover:bg-muted/50 extract-results",children:ee.getVisibleCells().map(ae=>G.jsx(L2,{className:"whitespace-nowrap text-center",children:fk(ae.column.columnDef.cell,ae.getContext())},ae.id))},ee.id)):G.jsx(AS,{children:G.jsx(L2,{colSpan:ue.length,className:"h-24 text-center",children:"No results."})})})]})})]})}function toe(){const{layers:e}=wo(),{selectedLayerId:t,filterConditions:n}=Wb(),r=e.find(p=>p.id===t);if(!r)return G.jsx("div",{className:"flex items-center justify-center h-32 border rounded-md",children:G.jsx("p",{className:"text-muted-foreground",children:"No layer selected"})});const a=r.data.features,u=a.filter(p=>n.every(i=>{var A;const b=(A=p.properties)==null?void 0:A[i.field],C=i.value;switch(i.operator){case"=":return b==C;case"!=":return b!=C;case">":return Number(b)>Number(C);case"<":return Number(b)<Number(C);case">=":return Number(b)>=Number(C);case"<=":return Number(b)<=Number(C);default:return!0}})).map(p=>({id:n3(p,a.indexOf(p)),...p.properties}));return G.jsx("div",{className:"h-full flex flex-col min-h-0 attribute-table",children:G.jsx(eoe,{data:u})})}function noe(){var W;const{layers:e}=wo(),{selectedLayerId:t,filterConditions:n,addFilterCondition:r,removeFilterCondition:a}=Wb(),u=e.find(X=>X.id===t),p=((W=u==null?void 0:u.data.features[0])==null?void 0:W.properties)||{},[i,b]=Y.useState(""),[C,A]=Y.useState("="),[R,z]=Y.useState(""),V=()=>{!i||!R||(r({field:i,operator:C,value:R}),b(""),A("="),z(""))};return G.jsxs("div",{className:"space-y-4",children:[G.jsxs("div",{className:"flex gap-8",children:[G.jsxs(z2,{value:i,onValueChange:b,children:[G.jsx(dE,{className:"w-[180px] select-field","data-testid":"select-field",children:G.jsx(B2,{placeholder:"Select field"})}),G.jsx(fE,{children:Object.keys(p).map(X=>G.jsx(Um,{value:X,children:X},X))})]}),G.jsxs(z2,{value:C,onValueChange:X=>A(X),children:[G.jsx(dE,{className:"w-[120px] operator-select","data-testid":"operator-select",children:G.jsx(B2,{})}),G.jsxs(fE,{children:[G.jsx(Um,{value:"=",children:"="}),G.jsx(Um,{value:"!=",children:"!="}),G.jsx(Um,{value:">",children:">"}),G.jsx(Um,{value:"<",children:"<"}),G.jsx(Um,{value:">=",children:">="}),G.jsx(Um,{value:"<=",children:"<="})]})]}),G.jsx(E0,{value:R,onChange:X=>z(X.target.value),placeholder:"Value",className:"w-[180px] value-input","data-testid":"value-input"}),G.jsx(Qr,{className:"ml-auto",onClick:V,"data-testid":"add-filter-btn",children:"Add Filter"})]}),n.length>0&&G.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((X,ue)=>G.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-muted rounded-md text-sm",children:[G.jsxs("span",{children:[X.field," ",X.operator," ",X.value]}),G.jsx(Qr,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-muted-foreground/20",onClick:()=>a(ue),children:G.jsx(fb,{className:"h-3 w-3"})})]},ue))})]})}function roe({selectedLayerId:e,setSelectedLayerId:t}){const{layers:n}=wo(),{setSelectedLayerId:r}=Wb(),a=n.find(z=>z.id===e),u=a?a.name:"Choose input layer",[p,i]=Y.useState(!1),[b,C]=Y.useState(!1),[A,R]=Y.useState(!0);return Y.useEffect(()=>{r(e),C(!0)},[e,r]),G.jsxs("div",{className:"flex flex-col h-full",children:[G.jsxs("div",{className:"flex flex-row justify-between mb-2 ",children:[G.jsxs(Kh,{open:p,onOpenChange:i,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox","aria-expanded":p,className:"w-[200px] justify-between input-layer",children:[u,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[200px] p-0",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No layers found."}),G.jsx(td,{children:n.map(z=>G.jsx(Gc,{value:z.name,onSelect:()=>{t(z.id),r(z.id),i(!1)},children:z.name},z.id))})]})]})})]}),G.jsxs("div",{className:"flex gap-2",children:[G.jsx(Qr,{variant:"secondary",onClick:()=>R(!A),className:"flex items-center gap-2",children:A?G.jsxs(G.Fragment,{children:["Hide Filters ",G.jsx(jk,{className:"h-4 w-4"})]}):G.jsxs(G.Fragment,{children:["Show Filters ",G.jsx(db,{className:"h-4 w-4"})]})}),G.jsxs(Qr,{variant:"secondary",onClick:()=>C(!b),children:[b?"Hide":"Show"," Table"]})]})]}),G.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[A&&G.jsx("div",{className:"border rounded-lg p-3 bg-muted/50 mb-2",children:G.jsx(noe,{})}),b&&G.jsx("div",{className:"flex-1 min-h-0 border rounded-lg",children:G.jsx("div",{className:"h-full overflow-auto",children:G.jsx(toe,{})})})]})]})}function ioe(e,t){let n;try{n=e()}catch{return}return{getItem:a=>{var u;const p=b=>b===null?null:JSON.parse(b,void 0),i=(u=n.getItem(a))!=null?u:null;return i instanceof Promise?i.then(p):p(i)},setItem:(a,u)=>n.setItem(a,JSON.stringify(u,void 0)),removeItem:a=>n.removeItem(a)}}const j2=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(r){return j2(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return j2(r)(n)}}}},ooe=(e,t)=>(n,r,a)=>{let u={storage:ioe(()=>localStorage),partialize:X=>X,version:0,merge:(X,ue)=>({...ue,...X}),...t},p=!1;const i=new Set,b=new Set;let C=u.storage;if(!C)return e((...X)=>{console.warn(`[zustand persist middleware] Unable to update item '${u.name}', the given storage is currently unavailable.`),n(...X)},r,a);const A=()=>{const X=u.partialize({...r()});return C.setItem(u.name,{state:X,version:u.version})},R=a.setState;a.setState=(X,ue)=>{R(X,ue),A()};const z=e((...X)=>{n(...X),A()},r,a);a.getInitialState=()=>z;let V;const W=()=>{var X,ue;if(!C)return;p=!1,i.forEach(K=>{var ee;return K((ee=r())!=null?ee:z)});const ie=((ue=u.onRehydrateStorage)==null?void 0:ue.call(u,(X=r())!=null?X:z))||void 0;return j2(C.getItem.bind(C))(u.name).then(K=>{if(K)if(typeof K.version=="number"&&K.version!==u.version){if(u.migrate){const ee=u.migrate(K.state,K.version);return ee instanceof Promise?ee.then(ae=>[!0,ae]):[!0,ee]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,K.state];return[!1,void 0]}).then(K=>{var ee;const[ae,he]=K;if(V=u.merge(he,(ee=r())!=null?ee:z),n(V,!0),ae)return A()}).then(()=>{ie==null||ie(V,void 0),V=r(),p=!0,b.forEach(K=>K(V))}).catch(K=>{ie==null||ie(void 0,K)})};return a.persist={setOptions:X=>{u={...u,...X},X.storage&&(C=X.storage)},clearStorage:()=>{C==null||C.removeItem(u.name)},getOptions:()=>u,rehydrate:()=>W(),hasHydrated:()=>p,onHydrate:X=>(i.add(X),()=>{i.delete(X)}),onFinishHydration:X=>(b.add(X),()=>{b.delete(X)})},u.skipHydration||W(),V||z},soe=ooe,jm=[{title:"Welcome to SharkGIS",body:`This tutorial showcases some key functionalities of the web app through a practical scenario: planning a safe kayak route in Trondheim's waterways.

Toggle this tutorial with the book icon, and note that refreshing the page will reset all progress including layers and settings.`},{title:"Map Navigation",body:`Navigate the map by clicking and dragging, or use your arrow keys to pan around. Zoom in and out by scrolling. You can toggle visual map controls on and off through the settings menu.

`},{title:"The Kayaking Mission",body:"You and a friend have decided to explore Trondheim's waterways by kayak. As beginners, safety is your primary concern. Your route must meet three critical requirements: stay in shallow waters in case of capsize, maintain distance to other boat/ship traffic, and padle between 2-3 accessible launch points.",image:Cp("/kayak.jpg"),imageAlt:"Kayaking in shallow waters"},{title:"Prepare Your Data",body:"Download the necessary data files from this [link](https://github.com/mortened/SharkGIS/tree/main/src/tutorial/data). It contains:\n\n- `trondelag.geojson`: Trndelag county boundary\n- `trondheim-depth.geojson`: Water depth polygons for Trondheim\n- `AIS.geojson`: Cleaned Automatic Identification System (AIS) data for boat/ships locations on a day in May 2025 \n- `swimming-spots.geojson`: Popular swimming spots around Norway"},{title:"Upload files to SharkGIS",body:"To start, upload the data files you downloaded. Click the Upload button in the top bar and select all four files at once."},{title:"View Uploaded Layers",body:"Once uploaded, you will see the new layers appear in the sidebar. Click the eye icon to toggle visibility, and the three dots next to each layer name to access options like renaming, deleting, or downloading."},{title:"Extract Trondheim Municipality",body:"Isolate just Trondheim from the larger county boundary. Open the Feature Extractor tool from the sidebar and follow the detailed steps inside the tool by clicking the book icon in the bottom left corner."},{title:"Clean Up Your Workspace",body:`Delete the original 'trondelag-boundary' layer since you no longer need it. Click the three dots next to the layer name and select Delete Layer.

Next, style your Trondheim boundary for better visibility. Click the three dots next to 'trondheim-boundary' and choose Layer Settings. Set the opacity to 10% so it remains visible but unobtrusive, and change the color to light gray.`},{title:"Clip The Data",body:"Trim the AIS data and swimming spots to only include areas within Trondheim's boundaries. The depth data is already limited to Trondheim. Open the Clip Tool from the sidebar and follow the steps inside the tool - again by clicking the book icon in the bottom left corner."},{title:"Create Safety Buffers",body:"Create 300 meter safety buffers around the AIS points to try to stay clear of boat traffic. Open the Buffer Tool from the sidebar and follow the steps inside the tool."},{title:"Identify Shallow Water Areas",body:"Use the Feature Extractor tool again to filter out deep waters from the depth polygons. Follow the steps inside the tool."},{title:"Dissolve Shallow Water Areas",body:"To make the shallow water areas easier to work with, dissolve them into a single polygon. Open the Dissolve Tool from the sidebar and follow the steps inside the tool."},{title:"Calculate Safe Kayaking Areas",body:"Subract the traffic buffers from the shallow water areas to find safe kayaking zones. Open the Difference Tool from the sidebar and follow the steps inside the tool."},{title:"Plan Your Route",body:"Create your kayak route using the Line Drawing Tool. Select 2-3 swimming spots as waypoints and draw your path through the green 'safe-kayak-zones', avoiding traffic areas and deep water. Follow the steps inside the tool by clicking the book icon in the bottom toolbar which appears when you start drawing.",image:Cp("/route.png"),imageAlt:"Example kayak route through safe waters"},{title:"Mission Accomplished",body:`Congratulations! You've successfully completed a comprehensive GIS analysis workflow. You extracted municipal boundaries, identified safe water depths, avoided shipping traffic zones, and planned an optimal kayak route.

Next steps include exporting your route as GPX for GPS devices, experimenting with different styling options, and exploring other GIS tools. In real-world applications, always verify current weather and tide conditions before any water activities.`}],aoe={4:{target:".upload-btn",content:"Click here to upload the data.",placement:"bottom"},5:{target:".layer-list",content:"Your layers will appear here.",placement:"right"},6:{target:".feature-extractor-btn",content:"Open Feature Extractor to isolate Trondheim municipality.",placement:"right"},8:{target:".clip-tool-btn",content:"Use Clip Tool to trim AIS and swimming spots data to Trondheim boundaries.",placement:"right"},9:{target:".buffer-tool-btn",content:"Create safety buffers around traffic points.",placement:"right"},10:{target:".feature-extractor-btn",content:"Extract shallow water areas using Feature Extractor.",placement:"right"},11:{target:".dissolve-tool-btn",content:"Dissolve shallow water areas into a single polygon.",placement:"right"},12:{target:".difference-tool-btn",content:"Calculate safe areas by removing traffic zones from shallow water.",placement:"right"},13:{target:".line-drawing-btn",content:"Draw your kayak route.",placement:"bottom"}},MP=pb()(soe(e=>({phase:-1,step:0,nextPhase:()=>e(t=>({phase:Math.min(t.phase+1,jm.length-1),step:0})),prevPhase:()=>e(t=>({phase:Math.max(t.phase-1,0),step:0})),nextStep:()=>e(t=>({step:t.step+1})),reset:()=>e({phase:0,step:0})}),{name:"sharkgis-tutorial"}));function loe({open:e,onOpenChange:t}){const[n,r]=Y.useState(""),{clearFilters:a,selectedFeatures:u}=Wb(),{layers:p,addLayer:i}=wo(),[b,C]=Y.useState(!1),[A,R]=Y.useState(0),[z,V]=Y.useState(!1),{phase:W}=MP();function X(){V(!0);const ee=p.find(je=>je.id===n);if(!ee)return;const he=ee.data.features.filter((je,Re)=>u.includes(n3(je,Re)));if(he.length===0){console.log("No features selected");return}const xe={type:"FeatureCollection",features:he},ye=`extracted_${n}_${Date.now()}`,Se=ba(`${ee.name}-extracted`);i({id:ye,name:Se,data:xe,fillColor:Ds(),fillOpacity:.7,visible:!0,geometryType:ee.geometryType},Ds(),.7),t(!1),V(!1),C_({title:"Features Extracted",description:`Extracted features from ${ee.name} and created a new layer.`,icon:Sa}),a()}function ue(ee){ee||(a(),C(!1),R(0),V(!1)),t(ee)}function ie(){C(!1)}function K(ee){W<=5?R(Math.max(0,Math.min(ee,ok.length-1))):R(Math.max(0,Math.min(ee,sk.length-1)))}return G.jsxs(G.Fragment,{children:[G.jsx(ore,{open:e,onOpenChange:ue,title:"Feature Extraction",description:"Extract features based on attribute values",onSave:X,runSteps:b,setRunSteps:C,children:G.jsxs("div",{className:"h-[calc(100vh-300px)] feature-extraction",children:[z&&G.jsx("div",{className:"flex justify-center align-center ",children:G.jsx(Ix,{color:"#ff8847",size:60})}),G.jsx(roe,{selectedLayerId:n,setSelectedLayerId:r})]})}),G.jsx(mv,{steps:W<=6?ok:sk,run:b&&e,onStop:ie,disableOverlay:!0,stepIndex:A,onStepChange:K})]})}function uoe({open:e,onOpenChange:t}){const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState([]),[p,i]=Y.useState(""),[b,C]=Y.useState(Ds()),[A,R]=Y.useState(1),[z,V]=Y.useState({layers:!1});function W(){if(a.length<2){V({layers:!0});return}ue(a,p)&&(t(!1),u([]),i(""),C(Ds()),V({layers:!1}))}function X(ie,K){try{const he=S0(ie,K);if(he)return he}catch(he){typeof(he==null?void 0:he.message)=="string"&&he.message.includes("Must have at least 2 geometries")||console.warn("Union failed, falling back to MultiPolygon merge:",he)}const ee=[],ae=he=>{he.geometry.type==="Polygon"?ee.push(he.geometry.coordinates):ee.push(...he.geometry.coordinates)};return ae(ie),ae(K),$M(ee)}function ue(ie,K){const ee=n.filter(je=>ie.includes(je.id));let ae=null,he=0;for(const je of ee){const Re=je.data;H1(Re,De=>{he+=1,ae=ae?X(ae,De):De})}if(!ae||he<2)return console.error("Union failed  need at least two valid polygon features."),V({layers:!0}),!1;const xe=Qm(ae.geometry),ye=eg([xe]),Se=xe.geometry.type;return r({data:ye,name:K||ba("union"),id:cg(),visible:!0,fillColor:b,fillOpacity:A,geometryType:Se},b,A),!0}return G.jsxs(lv,{open:e,onOpenChange:ie=>{t(ie),ie||V({layers:!1})},title:"Union",description:"Creates a new polygon layer that is the geometric union of two or more input polygon layers.",onSave:W,children:[G.jsx(coe,{selectedLayerIds:a,setSelectedLayerIds:u,setLayerName:i,errors:z}),G.jsx(jp,{layerName:p,onNameChange:i,fillColor:b,fillOpacity:A,onFillColorChange:C,onFillOpacityChange:R})]})}function coe({selectedLayerIds:e,setSelectedLayerIds:t,setLayerName:n,errors:r}){const{layers:a}=wo(),[u,p]=Y.useState(!1),i=a.filter(A=>A.geometryType==="Polygon"||A.geometryType==="MultiPolygon"),b=e.length===0?"Choose polygon layers":`${e.length} layer${e.length>1?"s":""} selected`,C=(A,R)=>{t(z=>{const V=z.includes(A)?z.filter(W=>W!==A):[...z,A];return V.length&&!R.includes("-union")&&n(ba(`${R}-union`)),V})};return G.jsxs("div",{className:"mt-2 mb-4 ml-1 mr-1 flex flex-row justify-between items-center",children:[G.jsxs(Kh,{open:u,onOpenChange:p,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox","aria-expanded":u,className:dn("w-[230px] justify-between",r.layers&&"border-red-500 border-2"),children:[b,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No polygon layers found."}),G.jsx(td,{children:i.map(A=>{const R=e.includes(A.id);return G.jsxs(Gc,{value:A.name,onSelect:()=>C(A.id,A.name),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",R?"opacity-100":"opacity-0")}),A.name]},A.id)})})]})]})})]}),G.jsx("div",{className:"text-red-500 text-sm m-auto text-center",children:r.layers&&G.jsx("p",{className:"text-sm text-red-500",children:"Select at least two polygon layers."})})]})}function hoe({open:e,onOpenChange:t}){const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState([]),[p,i]=Y.useState(""),[b,C]=Y.useState(Ds()),[A,R]=Y.useState(1),[z,V]=Y.useState({layers:!1});function W(K,ee){const[ae,he,xe,ye]=M0(K),[Se,je,Re,De]=M0(ee);return!(ae>Re||Se>xe||he>De||je>ye)}function X(K,ee){try{return z5(K,ee)}catch(ae){return console.warn("Intersection error, skipping pair:",ae),null}}function ue(K,ee){const ae=K.map(ye=>{const Se=n.find(je=>je.id===ye);return Se?(Se.data.features||[]).filter(je=>je.geometry.type==="Polygon"||je.geometry.type==="MultiPolygon"):[]});ae.some(ye=>ye.length===0)&&console.warn("One or more layers have no polygon features to intersect.");let he=ae[0];for(let ye=1;ye<ae.length&&he.length;ye++){const Se=ae[ye],je=[];for(const Re of he)for(const De of Se){if(!W(Re,De))continue;const at=X(Re,De);at&&je.push(at)}he=je}if(!he.length)return console.warn("No overlapping area found among selected layers."),!1;const xe=eg(he);return r({data:xe,name:ee||ba("intersect"),id:cg(),visible:!0,fillColor:b,fillOpacity:A,geometryType:"Polygon"},b,A),!0}function ie(){if(a.length<2){V({layers:!0});return}ue(a,p)&&(t(!1),u([]),i(""),C(Ds()),V({layers:!1}))}return G.jsxs(lv,{open:e,onOpenChange:K=>{t(K),K||V({layers:!1})},title:"Intersect",description:"Creates a new polygon layer from the overlapping area of the selected polygon layers.",onSave:ie,children:[G.jsx(doe,{selectedLayerIds:a,setSelectedLayerIds:u,setLayerName:i,errors:z}),G.jsx(jp,{layerName:p,onNameChange:i,fillColor:b,fillOpacity:A,onFillColorChange:C,onFillOpacityChange:R})]})}function doe({selectedLayerIds:e,setSelectedLayerIds:t,setLayerName:n,errors:r}){const{layers:a}=wo(),[u,p]=Y.useState(!1),i=a.filter(A=>A.geometryType==="Polygon"||A.geometryType==="MultiPolygon"),b=e.length?`${e.length} layer${e.length>1?"s":""} selected`:"Choose polygon layers",C=(A,R)=>{t(z=>{const V=z.includes(A)?z.filter(W=>W!==A):[...z,A];return V.length&&!R.includes("-intersect")&&n(ba(`${R}-intersect`)),V})};return G.jsxs("div",{className:"mt-2 mb-4 ml-1 mr-1 flex flex-row items-center gap-2",children:[G.jsxs(Kh,{open:u,onOpenChange:p,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-[230px] justify-between",r.layers&&"border-red-500 border-2"),children:[b,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0","aria-label":"Polygon layer list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No polygon layers found."}),G.jsx(td,{children:i.map(A=>{const R=e.includes(A.id);return G.jsxs(Gc,{value:A.name,onSelect:()=>C(A.id,A.name),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",R?"opacity-100":"opacity-0")}),A.name]},A.id)})})]})]})})]}),r.layers&&G.jsx("p",{className:"text-sm text-red-500",children:"Select at least two polygon layers."})]})}function foe({open:e,onOpenChange:t}){const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState(!1),[p,i]=Y.useState(0),[b,C]=Y.useState(!1),A=G.jsx(Qr,{onClick:()=>u(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})});function R(){u(!1),i(0)}function z(Fe){i(Math.max(0,Math.min(Fe,ck.length-1)))}const[V,W]=Y.useState(null),[X,ue]=Y.useState([]),[ie,K]=Y.useState(""),[ee,ae]=Y.useState(Ds()),[he,xe]=Y.useState(1),[ye,Se]=Y.useState({base:!1,subtract:!1});async function je(){C(!0);const Fe=!V||X.length===0;if(Se({base:!V,subtract:X.length===0}),Fe){C(!1);return}try{if(await new Promise(Ve=>setTimeout(Ve,0)),!await ot(V,X,ie))return;t(!1),Re(),C_({title:"Difference Created",description:`Difference layer "${ie}" created successfully.`,icon:Sa})}catch(Ze){console.error("Difference operation failed:",Ze)}finally{C(!1)}}function Re(){W(null),ue([]),K(""),ae(Ds()),xe(1),Se({base:!1,subtract:!1})}Y.useEffect(()=>{e||(W(null),ue([]),K(""),ae(Ds()),xe(1),Se({base:!1,subtract:!1}))},[e]);function De(Fe,Ze){try{const We=S0(Fe,Ze);if(We)return We}catch(We){typeof(We==null?void 0:We.message)=="string"&&We.message.includes("Must have at least 2 geometries")||console.warn("Union failed, falling back to MultiPolygon merge: ",We)}const Ve=[],mt=We=>{We.geometry.type==="Polygon"?Ve.push(We.geometry.coordinates):Ve.push(...We.geometry.coordinates)};return mt(Fe),mt(Ze),$M(Ve)}function at(Fe,Ze){try{const Ve=wQ(Fe,Ze);if(Ve)return Ve}catch(Ve){console.warn("Difference failed, returning original geometry",Ve)}return Fe}async function ot(Fe,Ze,Ve){return new Promise((mt,We)=>{setTimeout(()=>{try{const tt=n.find(Ut=>Ut.id===Fe),Dt=n.filter(Ut=>Ze.includes(Ut.id));if(!tt||Dt.length===0){mt(!1);return}let $e=null;if(H1(tt.data,Ut=>{$e=$e?De($e,Ut):Ut}),!$e){mt(!1);return}let Ke=null;for(const Ut of Dt)H1(Ut.data,wn=>{Ke=Ke?De(Ke,wn):wn});if(!Ke)return!1;const gt=at($e,Ke);gt||(console.warn("Difference resulted in no geometry"),mt(!1));const Yt=Qm(gt.geometry),Kt=eg([Yt]),nn=Yt.geometry.type;r({data:Kt,name:Ve||ba("difference"),id:cg(),visible:!0,fillColor:ee,fillOpacity:he,geometryType:nn},ee,he),mt(!0)}catch(tt){console.error("Difference failed:",tt),We(tt)}},0)})}return G.jsxs(G.Fragment,{children:[G.jsxs(lv,{open:e,onOpenChange:Fe=>{t(Fe),Fe||(Re(),C(!1))},title:"Difference",description:"Creates a new polygon layer representing the difference between a base polygon layer and one or more subtract polygon layers.",onSave:je,actions:A,saveButtonClassName:"difference-btn",children:[G.jsx("div",{className:"difference-tool",children:G.jsx(poe,{baseLayerId:V,setBaseLayerId:W,subtractLayerIds:X,setSubtractLayerIds:ue,setLayerName:K,errors:ye})}),b&&G.jsx("div",{className:"flex justify-center items-center mt-4",children:G.jsx(Ix,{color:"#ff8847",size:60})}),G.jsx("div",{className:"difference-styles",children:G.jsx(jp,{layerName:ie,onNameChange:K,fillColor:ee,fillOpacity:he,onFillColorChange:ae,onFillOpacityChange:xe})})]}),G.jsx(mv,{steps:ck,run:a&&e,onStop:R,stepIndex:p,onStepChange:z,disableOverlay:!0})]})}function poe({baseLayerId:e,setBaseLayerId:t,subtractLayerIds:n,setSubtractLayerIds:r,setLayerName:a,errors:u}){var ue;const{layers:p}=wo(),[i,b]=Y.useState(!1),[C,A]=Y.useState(!1),R=p.filter(ie=>ie.geometryType==="Polygon"||ie.geometryType==="MultiPolygon"),z=(ie,K)=>{r(ee=>{var he;const ae=ee.includes(ie)?ee.filter(xe=>xe!==ie):[...ee,ie];if(e&&!K.includes("-diff")){const xe=((he=p.find(ye=>ye.id===e))==null?void 0:he.name)||"";a(ba(`${xe}-diff`))}return ae})},V=(ie,K)=>{t(e===ie?null:ie),K.includes("-diff")||a(ba(`${K}-diff`)),r(ee=>ee.filter(ae=>ae!==ie)),b(!1)},W=e?((ue=p.find(ie=>ie.id===e))==null?void 0:ue.name)??"Choose base layer":"Choose base layer",X=n.length===0?"Choose subtract layers":`${n.length} layer${n.length>1?"s":""} selected`;return G.jsxs(G.Fragment,{children:[G.jsxs("div",{className:"mb-2 ml-1 mr-1 flex flex-row gap-3",children:[G.jsxs(Kh,{open:i,onOpenChange:b,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-[230px] justify-between difference-base-layer",u.base&&"border-red-500 border-2"),children:[W,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0","aria-label":"Base layer list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No polygon layers found."}),G.jsx(td,{children:R.map(ie=>{const K=e===ie.id;return G.jsxs(Gc,{value:ie.name,onSelect:()=>V(ie.id,ie.name),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",K?"opacity-100":"opacity-0")}),ie.name]},ie.id)})})]})]})})]}),G.jsxs(Kh,{open:C,onOpenChange:A,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-[230px] justify-between difference-subtract-layer",u.subtract&&"border-red-500 border-2"),children:[X,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0","aria-label":"Subtract layer list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No polygon layers found."}),G.jsx(td,{children:R.filter(ie=>ie.id!==e).map(ie=>{const K=n.includes(ie.id);return G.jsxs(Gc,{value:ie.name,onSelect:()=>z(ie.id,ie.name),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",K?"opacity-100":"opacity-0")}),ie.name]},ie.id)})})]})]})})]})]}),G.jsx("div",{className:"text-red-500 text-sm m-auto text-center mb-2",children:u.base&&u.subtract?G.jsx("p",{className:"text-sm",children:"Select a base polygon layer and at least one subtract polygon layer."}):u.base?G.jsx("p",{className:"text-sm",children:"Select a base polygon layer."}):u.subtract?G.jsx("p",{className:"text-sm",children:"Select at least one subtract polygon layer."}):null})]})}function TV({layers:e,onChange:t}){return G.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto pr-1",children:e.map((n,r)=>G.jsx(jp,{layerName:n.name,onNameChange:a=>t(r,{name:a}),fillColor:n.color,onFillColorChange:a=>t(r,{color:a}),fillOpacity:n.opacity,onFillOpacityChange:a=>t(r,{opacity:a})},n.file.name))})}function moe({open:e,onOpenChange:t}){const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState(!1),[p,i]=Y.useState(0),[b,C]=Y.useState(!1),A=G.jsx(Qr,{onClick:()=>u(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})});function R(){u(!1),i(0)}function z(Ve){i(Math.max(0,Math.min(Ve,ak.length-1)))}const[V,W]=Y.useState([]),[X,ue]=Y.useState(""),[ie,K]=Y.useState([]),[ee,ae]=Y.useState({input:!1,clip:!1});function he(){C(!1),W([]),ue(""),K([]),ae({input:!1,clip:!1})}const xe=Ve=>{const mt=new Set(ie.map($e=>$e.inputLayerId)),We=new Set(ie.map($e=>$e.color)),tt=Ve.filter($e=>!mt.has($e)).map($e=>{const Ke=n.find(Yt=>Yt.id===$e),gt=Ds([...We]);return We.add(gt),{inputLayerId:$e,name:ba(`${(Ke==null?void 0:Ke.name)||"layer"}-clip`),color:gt,opacity:.8}}),Dt=ie.filter($e=>Ve.includes($e.inputLayerId));K([...Dt,...tt])};function ye(Ve,mt){try{const Dt=S0(Ve,mt);if(Dt)return Dt}catch{}const We=[],tt=Dt=>{Dt.geometry.type==="Polygon"?We.push(Dt.geometry.coordinates):We.push(...Dt.geometry.coordinates)};return tt(Ve),tt(mt),$M(We)}function Se(Ve,mt){if(Ve.geometry.type==="Point")return Pp(Ve,mt)?Ve:null;const We=Ve.geometry.coordinates.filter(tt=>Pp(GM(tt),mt));return We.length?xK(We):null}function je(Ve,mt){if(JK(Ve,mt))return Ve;const We=vJ(mt),Dt=mJ(Ve,We).features.filter($e=>{const Ke=$K($e,YK($e)/2,{units:"kilometers"});return Pp(Ke,mt)});return Dt.length?Dt.length===1?Dt[0]:vK(Dt.map($e=>$e.geometry.coordinates),Ve.properties):null}function Re(Ve,mt){const We=z5(Ve,mt);return We||null}async function De(){return new Promise(Ve=>{setTimeout(()=>{try{const mt=n.filter($e=>V.includes($e.id)),We=n.find($e=>$e.id===X);if(!mt.length||!We){Ve(!1);return}let tt=null;if(H1(We.data,$e=>{tt=tt?ye(tt,$e):$e}),!tt){Ve(!1);return}let Dt=0;for(const $e of mt){const Ke=ie.find(Yt=>Yt.inputLayerId===$e.id);if(!Ke)continue;const gt=[];if(H1($e.data,Yt=>{const Kt=Yt.geometry.type;let nn=null;Kt==="Point"||Kt==="MultiPoint"?nn=Se(Yt,tt):Kt==="LineString"||Kt==="MultiLineString"?nn=je(Yt,tt):(Kt==="Polygon"||Kt==="MultiPolygon")&&(nn=Re(Yt,tt)),nn&&gt.push({...nn,properties:Yt.properties})}),gt.length>0){const Yt=eg(gt);r({data:Yt,name:ba(Ke.name),id:cg(),visible:!0,fillColor:Ke.color,fillOpacity:Ke.opacity,geometryType:$e.geometryType},Ke.color,Ke.opacity),Dt++}}Ve(Dt>0)}catch(mt){console.error("Error during clipping operation:",mt),Ve(!1)}},0)})}async function at(){C(!0);const Ve=!V.length,mt=!X;if(ae({input:Ve,clip:mt}),Ve||mt){C(!1);return}const We=await De();C(!1),We&&(t(!1),he())}const ot=(Ve,mt)=>{K(We=>We.map((tt,Dt)=>Dt===Ve?{...tt,...mt}:tt))},Fe=ie.map(Ve=>({file:new File([],Ve.name),name:Ve.name,color:Ve.color,opacity:Ve.opacity})),Ze=(Ve,mt)=>{ot(Ve,mt)};return G.jsxs(G.Fragment,{children:[G.jsxs(lv,{open:e,onOpenChange:Ve=>{t(Ve),Ve||(u(!1),i(0),ae({input:!1,clip:!1}),he())},title:"Clip",description:"Clip multiple input layers using a single polygon clip layer.",onSave:at,actions:A,saveButtonClassName:"clip-btn",children:[G.jsx(goe,{inputLayerIds:V,setInputLayerIds:Ve=>{W(Ve),xe(Ve)},clipLayerId:X,setClipLayerId:Ve=>{ue(Ve)},errors:ee}),b&&G.jsx("div",{className:"flex justify-center align-center ",children:G.jsx(Ix,{color:"#ff8847",size:60})}),G.jsx("div",{className:"clip-styles",children:ie.length>0&&G.jsxs("div",{className:"mt-4",children:[G.jsx("h3",{className:"text-sm font-medium mb-2",children:"Output Layer Settings"}),ie.length===1?G.jsx(jp,{layerName:ie[0].name,onNameChange:Ve=>ot(0,{name:Ve}),fillColor:ie[0].color,onFillColorChange:Ve=>ot(0,{color:Ve}),fillOpacity:ie[0].opacity,onFillOpacityChange:Ve=>ot(0,{opacity:Ve})}):G.jsx(TV,{layers:Fe,onChange:Ze})]})})]}),G.jsx(mv,{steps:ak,run:a&&e,onStop:R,stepIndex:p,onStepChange:z,disableOverlay:!0})]})}function goe({inputLayerIds:e,setInputLayerIds:t,clipLayerId:n,setClipLayerId:r,errors:a}){var ue;const{layers:u}=wo(),[p,i]=Y.useState(!1),[b,C]=Y.useState(!1),A=u,R=u.filter(ie=>ie.geometryType==="Polygon"||ie.geometryType==="MultiPolygon"),z=ie=>{const K=e.includes(ie)?e.filter(ee=>ee!==ie):[...e,ie];t(K),n===ie&&r("")},V=ie=>{const K=n===ie?"":ie;r(K),K&&t(e.filter(ee=>ee!==ie)),C(!1)},W=e.length?`${e.length} input layer${e.length>1?"s":""}`:"Choose input layers",X=n&&((ue=u.find(ie=>ie.id===n))==null?void 0:ue.name)||"Choose clip polygon";return G.jsxs(G.Fragment,{children:[G.jsxs("div",{className:"mb-2 ml-1 mr-1 flex flex-row gap-3",children:[G.jsxs(Kh,{open:p,onOpenChange:i,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-[230px] justify-between clip-input-layer",a.input&&"border-red-500 border-2"),children:[W,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0","aria-label":"Input layer list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No layers found."}),G.jsx(td,{children:A.filter(ie=>ie.id!==n).map(ie=>{const K=e.includes(ie.id);return G.jsxs(Gc,{value:ie.name,onSelect:()=>z(ie.id),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",K?"opacity-100":"opacity-0")}),ie.name]},ie.id)})})]})]})})]}),G.jsxs(Kh,{open:b,onOpenChange:C,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-[230px] justify-between clip-clip-layer",a.clip&&"border-red-500 border-2"),children:[X,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[230px] p-0","aria-label":"Clip polygon list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer..."}),G.jsxs(ed,{children:[G.jsx(af,{children:"No polygon layers found."}),G.jsx(td,{children:R.filter(ie=>!e.includes(ie.id)).map(ie=>{const K=n===ie.id;return G.jsxs(Gc,{value:ie.name,onSelect:()=>V(ie.id),children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",K?"opacity-100":"opacity-0")}),ie.name]},ie.id)})})]})]})})]})]}),G.jsx("div",{className:"text-red-500 text-sm m-auto text-center mb-2",children:a.input&&a.clip?G.jsx("p",{className:"text-sm text-red-500",children:"Select at least one input layer and one clip polygon layer."}):a.input?G.jsx("p",{className:"text-sm text-red-500",children:"Select at least one input layer."}):a.clip?G.jsx("p",{className:"text-sm text-red-500",children:"Select one clip polygon layer."}):null})]})}function _oe({open:e,onOpenChange:t}){var ye;const{layers:n,addLayer:r}=wo(),[a,u]=Y.useState(""),[p,i]=Y.useState(!1),[b,C]=Y.useState(""),[A,R]=Y.useState(.7),[z,V]=Y.useState(Ds()),[W,X]=Y.useState(!1),[ue,ie]=Y.useState(!1),K=n.filter(Se=>Se.geometryType==="Point"||Se.geometryType==="MultiPoint"),ee=a?((ye=n.find(Se=>Se.id===a))==null?void 0:ye.name)??"Choose input layer":"Choose input layer",ae=(Se,je)=>{u(Se),je.includes("-voronoi")?C(ba(je)):C(ba(`${je}-voronoi`)),X(!1)};function he(){ie(!0);const Se=!a;if(i(Se),Se)return;const je=n.find(De=>De.id===a);if(!je)return;xe(je)&&(t(!1),ie(!1))}Y.useEffect(()=>{e||(u(""),C(""),V(Ds()),R(.7),X(!1),i(!1),ie(!1))},[e]);function xe(Se){try{const je=[];if(Se.data.features.forEach(Ze=>{Ze.geometry.type==="Point"?je.push(Ze):Ze.geometry.type==="MultiPoint"&&Ze.geometry.coordinates.forEach(Ve=>{je.push(GM(Ve,Ze.properties))})}),je.length<3)return console.error("Voronoi requires at least 3 points"),!1;const Re=eg(je),De=M0(Re),at=qJ(Re,{bbox:De});if(!at||at.features.length===0)return console.error("Failed to generate Voronoi polygons"),!1;const ot=at.features.filter(Ze=>Ze.geometry&&Ze.geometry.type);if(ot.length===0)return console.error("No valid Voronoi polygons generated"),!1;const Fe=eg(ot);return r({id:cg(),name:b||ba("voronoi"),data:Fe,fillColor:z,fillOpacity:A,visible:!0,geometryType:"Polygon"},z,A),!0}catch(je){return console.error("Error generating Voronoi diagram:",je),!1}}return G.jsxs(lv,{open:e,onOpenChange:Se=>{t(Se),Se||i(!1)},title:"Voronoi",description:"Creates a Voronoi polygon layer from an existing point layer.",onSave:he,children:[G.jsx("div",{className:"mb-2 ml-1 mr-1 flex flex-row gap-3",children:G.jsxs(Kh,{open:W,onOpenChange:X,children:[G.jsx(Jh,{asChild:!0,children:G.jsxs(Qr,{variant:"default",role:"combobox",className:dn("w-full justify-between",p&&"border-red-500 border-2"),children:[ee,G.jsx(nf,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),G.jsx(Wc,{className:"w-[250px] p-0","aria-label":"Input layer list",children:G.jsxs(Qh,{children:[G.jsx(sf,{placeholder:"Search layer"}),G.jsxs(ed,{children:[G.jsx(af,{children:"No point layers found."}),G.jsx(td,{children:K.map(Se=>{const je=Se.id===a;return G.jsxs(Gc,{value:Se.name,onSelect:()=>ae(Se.id,Se.name),className:"hover:bg-accent hover:text-accent-foreground cursor-pointer",children:[G.jsx(Sa,{className:dn("mr-2 h-4 w-4",je?"opacity-100":"opacity-0")}),Se.name]},Se.id)})})]})]})})]})}),ue&&G.jsx("div",{className:"flex justify-center align-center ",children:G.jsx(Ix,{color:"#ff8847",size:60})}),p&&G.jsx("div",{className:"mb-2 text-sm text-red-500",children:"Please select an input layer."}),G.jsx(jp,{layerName:b,onNameChange:C,fillColor:z,fillOpacity:A,onFillColorChange:V,onFillOpacityChange:R})]})}const yoe=[{name:"Buffer",icon:"buffer"},{name:"Intersect",icon:"intersect"},{name:"Union",icon:"union"},{name:"Difference",icon:"difference"},{name:"Dissolve",icon:"dissolve"},{name:"Clip",icon:"clip"},{name:"Voronoi",icon:"voronoi"},{name:"Feature extraction",icon:"filter"}];function voe(){const[e,t]=Y.useState(null),[n,r]=Y.useState(!1);function a(u){t(u),r(!0)}return G.jsxs("div",{className:"flex flex-col",children:[yoe.map(u=>G.jsxs(Qr,{variant:"ghost",size:"lg",onClick:()=>a(u.name),className:`m-2 justify-start${u.name==="Feature extraction"?" feature-extractor-btn":""}${u.name==="Clip"?" clip-tool-btn":""}${u.name==="Dissolve"?" dissolve-tool-btn":""} ${u.name==="Buffer"?" buffer-tool-btn":""} ${u.name==="Difference"?" difference-tool-btn":""} `,children:[G.jsx("img",{src:Cp(`/icons/${u.icon}.svg`),alt:u.name,className:"h-6 w-6"}),G.jsx("span",{className:"text-s",children:u.name})]},u.name)),e==="Buffer"&&G.jsx(nre,{open:n,onOpenChange:r}),e==="Intersect"&&G.jsx(hoe,{open:n,onOpenChange:r}),e==="Union"&&G.jsx(uoe,{open:n,onOpenChange:r}),e==="Difference"&&G.jsx(foe,{open:n,onOpenChange:r}),e==="Dissolve"&&G.jsx(ire,{open:n,onOpenChange:r}),e==="Clip"&&G.jsx(moe,{open:n,onOpenChange:r}),e==="Voronoi"&&G.jsx(_oe,{open:n,onOpenChange:r}),e==="Feature extraction"&&G.jsx("div",{className:"feature-extractor",children:G.jsx(loe,{open:n,onOpenChange:r})})]})}const xoe=[{title:"Layers",icon:Vk},{title:"Tools",icon:qk},{title:"Settings",icon:Gk}];function boe(){const{state:e}=cx(),[t,n]=Y.useState(!0),[r,a]=Y.useState(!0),[u,p]=Y.useState(!1);return Y.useEffect(()=>{e!=="expanded"&&(n(!1),a(!1))},[e]),G.jsxs(jS,{className:"border-r",children:[G.jsx(zF,{className:"h-16 flex items-center justify-center",children:G.jsxs("div",{className:"flex items-center justify-center",children:[G.jsx("img",{src:Cp("/logo.png"),alt:"SharkGIS",className:`transition-all duration-200 ease-linear ${e==="expanded"?"w-14 h-14":"w-8 h-8"}`}),G.jsx("h1",{className:`text-2xl font-bold transition-all duration-200 ease-linear ${e==="expanded"?"opacity-100":"opacity-0 w-0 overflow-hidden"}`,children:"SharkGIS"})]})}),G.jsxs(BF,{children:[G.jsx(jF,{children:G.jsx(VF,{children:xoe.map(i=>i.title==="Layers"&&e==="expanded"?G.jsx(bS,{children:G.jsx(nD,{type:"single",collapsible:!0,value:t?"layers":"",onValueChange:b=>{n(b==="layers")},children:G.jsxs(GI,{value:"layers",className:"border-none",children:[G.jsx(wS,{asChild:!0,children:G.jsx($I,{className:"flex items-center gap-2 px-2 py-1 rounded-md hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",children:G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(Vk,{className:"h-5 w-5"}),G.jsx("span",{className:"text-lg",children:"Layers"})]})})}),G.jsx(qI,{children:G.jsx(pY,{})})]})})},i.title):i.title==="Tools"&&e==="expanded"?G.jsx(bS,{children:G.jsx(nD,{type:"single",collapsible:!0,value:r?"tools":"",onValueChange:b=>{a(b==="tools")},children:G.jsxs(GI,{value:"tools",className:"border-none",children:[G.jsx(wS,{asChild:!0,children:G.jsx($I,{className:"flex items-center gap-2 px-2 py-1 rounded-md hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",children:G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(qk,{className:"h-5 w-5"}),G.jsx("span",{className:"text-lg",children:"Tools"})]})})}),G.jsx(qI,{children:G.jsx(voe,{})})]})})},i.title):G.jsx(bS,{children:G.jsxs(wS,{onClick:()=>p(!0),className:"flex items-center gap-2 px-2 py-1 rounded-md hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",children:[G.jsx(i.icon,{className:"h-5 w-5"}),G.jsx("span",{className:"text-lg",children:"Settings"})]})},i.title))})}),G.jsx(r4,{open:u,onOpenChange:p})]})]})}var RS={exports:{}},woe=RS.exports,pk;function Soe(){return pk||(pk=1,function(e,t){(function(n,r){e.exports=r()})(woe,function(){var n,r,a;function u(i,b){if(!n)n=b;else if(!r)r=b;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",A={};n(A),a=b(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}u(["exports"],function(i){function b(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var C,A={},R={};function z(){if(C)return R;C=1,Object.defineProperty(R,"__esModule",{value:!0}),R.setMatrixArrayType=function(m){R.ARRAY_TYPE=o=m},R.toRadian=function(m){return m*d},R.equals=function(m,f){return Math.abs(m-f)<=h*Math.max(1,Math.abs(m),Math.abs(f))},R.RANDOM=R.ARRAY_TYPE=R.EPSILON=void 0;var h=1e-6;R.EPSILON=h;var o=typeof Float32Array<"u"?Float32Array:Array;R.ARRAY_TYPE=o;var l=Math.random;R.RANDOM=l;var d=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,f=arguments.length;f--;)m+=arguments[f]*arguments[f];return Math.sqrt(m)}),R}var V,W={};function X(){if(V)return W;function h(f){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},h(f)}V=1,Object.defineProperty(W,"__esModule",{value:!0}),W.create=function(){var f=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},W.clone=function(f){var y=new o.ARRAY_TYPE(4);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y},W.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f},W.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},W.fromValues=function(f,y,T,M){var O=new o.ARRAY_TYPE(4);return O[0]=f,O[1]=y,O[2]=T,O[3]=M,O},W.set=function(f,y,T,M,O){return f[0]=y,f[1]=T,f[2]=M,f[3]=O,f},W.transpose=function(f,y){if(f===y){var T=y[1];f[1]=y[2],f[2]=T}else f[0]=y[0],f[1]=y[2],f[2]=y[1],f[3]=y[3];return f},W.invert=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=T*w-O*M;return P?(f[0]=w*(P=1/P),f[1]=-M*P,f[2]=-O*P,f[3]=T*P,f):null},W.adjoint=function(f,y){var T=y[0];return f[0]=y[3],f[1]=-y[1],f[2]=-y[2],f[3]=T,f},W.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},W.multiply=d,W.rotate=function(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=Math.sin(T),L=Math.cos(T);return f[0]=M*L+w*N,f[1]=O*L+P*N,f[2]=M*-N+w*L,f[3]=O*-N+P*L,f},W.scale=function(f,y,T){var M=y[1],O=y[2],w=y[3],P=T[0],N=T[1];return f[0]=y[0]*P,f[1]=M*P,f[2]=O*N,f[3]=w*N,f},W.fromRotation=function(f,y){var T=Math.sin(y),M=Math.cos(y);return f[0]=M,f[1]=T,f[2]=-T,f[3]=M,f},W.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f},W.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},W.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},W.LDU=function(f,y,T,M){return f[2]=M[2]/M[0],T[0]=M[0],T[1]=M[1],T[3]=M[3]-f[2]*T[1],[f,y,T]},W.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f},W.subtract=m,W.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]},W.equals=function(f,y){var T=f[0],M=f[1],O=f[2],w=f[3],P=y[0],N=y[1],L=y[2],D=y[3];return Math.abs(T-P)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(M-N)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(N))&&Math.abs(O-L)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(L))&&Math.abs(w-D)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs(D))},W.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f},W.multiplyScalarAndAdd=function(f,y,T,M){return f[0]=y[0]+T[0]*M,f[1]=y[1]+T[1]*M,f[2]=y[2]+T[2]*M,f[3]=y[3]+T[3]*M,f},W.sub=W.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(f===null||h(f)!=="object"&&typeof f!="function")return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var M={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if(w!=="default"&&Object.prototype.hasOwnProperty.call(f,w)){var P=O?Object.getOwnPropertyDescriptor(f,w):null;P&&(P.get||P.set)?Object.defineProperty(M,w,P):M[w]=f[w]}return M.default=f,T&&T.set(f,M),M}(z());function l(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(l=function(M){return M?T:y})(f)}function d(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=T[0],L=T[1],D=T[2],B=T[3];return f[0]=M*N+w*L,f[1]=O*N+P*L,f[2]=M*D+w*B,f[3]=O*D+P*B,f}function m(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f}return W.mul=d,W.sub=m,W}var ue,ie={};function K(){if(ue)return ie;function h(f){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},h(f)}ue=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.create=function(){var f=new o.ARRAY_TYPE(6);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},ie.clone=function(f){var y=new o.ARRAY_TYPE(6);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y},ie.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f},ie.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},ie.fromValues=function(f,y,T,M,O,w){var P=new o.ARRAY_TYPE(6);return P[0]=f,P[1]=y,P[2]=T,P[3]=M,P[4]=O,P[5]=w,P},ie.set=function(f,y,T,M,O,w,P){return f[0]=y,f[1]=T,f[2]=M,f[3]=O,f[4]=w,f[5]=P,f},ie.invert=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=y[4],N=y[5],L=T*w-M*O;return L?(f[0]=w*(L=1/L),f[1]=-M*L,f[2]=-O*L,f[3]=T*L,f[4]=(O*N-w*P)*L,f[5]=(M*P-T*N)*L,f):null},ie.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},ie.multiply=d,ie.rotate=function(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=Math.sin(T),B=Math.cos(T);return f[0]=M*B+w*D,f[1]=O*B+P*D,f[2]=M*-D+w*B,f[3]=O*-D+P*B,f[4]=N,f[5]=L,f},ie.scale=function(f,y,T){var M=y[1],O=y[2],w=y[3],P=y[4],N=y[5],L=T[0],D=T[1];return f[0]=y[0]*L,f[1]=M*L,f[2]=O*D,f[3]=w*D,f[4]=P,f[5]=N,f},ie.translate=function(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=T[0],B=T[1];return f[0]=M,f[1]=O,f[2]=w,f[3]=P,f[4]=M*D+w*B+N,f[5]=O*D+P*B+L,f},ie.fromRotation=function(f,y){var T=Math.sin(y),M=Math.cos(y);return f[0]=M,f[1]=T,f[2]=-T,f[3]=M,f[4]=0,f[5]=0,f},ie.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f[4]=0,f[5]=0,f},ie.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=y[0],f[5]=y[1],f},ie.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},ie.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},ie.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f},ie.subtract=m,ie.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f},ie.multiplyScalarAndAdd=function(f,y,T,M){return f[0]=y[0]+T[0]*M,f[1]=y[1]+T[1]*M,f[2]=y[2]+T[2]*M,f[3]=y[3]+T[3]*M,f[4]=y[4]+T[4]*M,f[5]=y[5]+T[5]*M,f},ie.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]},ie.equals=function(f,y){var T=f[0],M=f[1],O=f[2],w=f[3],P=f[4],N=f[5],L=y[0],D=y[1],B=y[2],q=y[3],Z=y[4],re=y[5];return Math.abs(T-L)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(L))&&Math.abs(M-D)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(D))&&Math.abs(O-B)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(B))&&Math.abs(w-q)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs(q))&&Math.abs(P-Z)<=o.EPSILON*Math.max(1,Math.abs(P),Math.abs(Z))&&Math.abs(N-re)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(re))},ie.sub=ie.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(f===null||h(f)!=="object"&&typeof f!="function")return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var M={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if(w!=="default"&&Object.prototype.hasOwnProperty.call(f,w)){var P=O?Object.getOwnPropertyDescriptor(f,w):null;P&&(P.get||P.set)?Object.defineProperty(M,w,P):M[w]=f[w]}return M.default=f,T&&T.set(f,M),M}(z());function l(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(l=function(M){return M?T:y})(f)}function d(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=T[0],B=T[1],q=T[2],Z=T[3],re=T[4],ne=T[5];return f[0]=M*D+w*B,f[1]=O*D+P*B,f[2]=M*q+w*Z,f[3]=O*q+P*Z,f[4]=M*re+w*ne+N,f[5]=O*re+P*ne+L,f}function m(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f}return ie.mul=d,ie.sub=m,ie}var ee,ae={};function he(){if(ee)return ae;function h(f){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},h(f)}ee=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=function(){var f=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},ae.fromMat4=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[4],f[4]=y[5],f[5]=y[6],f[6]=y[8],f[7]=y[9],f[8]=y[10],f},ae.clone=function(f){var y=new o.ARRAY_TYPE(9);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y[6]=f[6],y[7]=f[7],y[8]=f[8],y},ae.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},ae.fromValues=function(f,y,T,M,O,w,P,N,L){var D=new o.ARRAY_TYPE(9);return D[0]=f,D[1]=y,D[2]=T,D[3]=M,D[4]=O,D[5]=w,D[6]=P,D[7]=N,D[8]=L,D},ae.set=function(f,y,T,M,O,w,P,N,L,D){return f[0]=y,f[1]=T,f[2]=M,f[3]=O,f[4]=w,f[5]=P,f[6]=N,f[7]=L,f[8]=D,f},ae.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ae.transpose=function(f,y){if(f===y){var T=y[1],M=y[2],O=y[5];f[1]=y[3],f[2]=y[6],f[3]=T,f[5]=y[7],f[6]=M,f[7]=O}else f[0]=y[0],f[1]=y[3],f[2]=y[6],f[3]=y[1],f[4]=y[4],f[5]=y[7],f[6]=y[2],f[7]=y[5],f[8]=y[8];return f},ae.invert=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=y[4],N=y[5],L=y[6],D=y[7],B=y[8],q=B*P-N*D,Z=-B*w+N*L,re=D*w-P*L,ne=T*q+M*Z+O*re;return ne?(f[0]=q*(ne=1/ne),f[1]=(-B*M+O*D)*ne,f[2]=(N*M-O*P)*ne,f[3]=Z*ne,f[4]=(B*T-O*L)*ne,f[5]=(-N*T+O*w)*ne,f[6]=re*ne,f[7]=(-D*T+M*L)*ne,f[8]=(P*T-M*w)*ne,f):null},ae.adjoint=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=y[4],N=y[5],L=y[6],D=y[7],B=y[8];return f[0]=P*B-N*D,f[1]=O*D-M*B,f[2]=M*N-O*P,f[3]=N*L-w*B,f[4]=T*B-O*L,f[5]=O*w-T*N,f[6]=w*D-P*L,f[7]=M*L-T*D,f[8]=T*P-M*w,f},ae.determinant=function(f){var y=f[3],T=f[4],M=f[5],O=f[6],w=f[7],P=f[8];return f[0]*(P*T-M*w)+f[1]*(-P*y+M*O)+f[2]*(w*y-T*O)},ae.multiply=d,ae.translate=function(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=y[6],B=y[7],q=y[8],Z=T[0],re=T[1];return f[0]=M,f[1]=O,f[2]=w,f[3]=P,f[4]=N,f[5]=L,f[6]=Z*M+re*P+D,f[7]=Z*O+re*N+B,f[8]=Z*w+re*L+q,f},ae.rotate=function(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=y[6],B=y[7],q=y[8],Z=Math.sin(T),re=Math.cos(T);return f[0]=re*M+Z*P,f[1]=re*O+Z*N,f[2]=re*w+Z*L,f[3]=re*P-Z*M,f[4]=re*N-Z*O,f[5]=re*L-Z*w,f[6]=D,f[7]=B,f[8]=q,f},ae.scale=function(f,y,T){var M=T[0],O=T[1];return f[0]=M*y[0],f[1]=M*y[1],f[2]=M*y[2],f[3]=O*y[3],f[4]=O*y[4],f[5]=O*y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},ae.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=y[0],f[7]=y[1],f[8]=1,f},ae.fromRotation=function(f,y){var T=Math.sin(y),M=Math.cos(y);return f[0]=M,f[1]=T,f[2]=0,f[3]=-T,f[4]=M,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ae.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=0,f[4]=y[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ae.fromMat2d=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=0,f[3]=y[2],f[4]=y[3],f[5]=0,f[6]=y[4],f[7]=y[5],f[8]=1,f},ae.fromQuat=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=T+T,N=M+M,L=O+O,D=T*P,B=M*P,q=M*N,Z=O*P,re=O*N,ne=O*L,te=w*P,le=w*N,fe=w*L;return f[0]=1-q-ne,f[3]=B-fe,f[6]=Z+le,f[1]=B+fe,f[4]=1-D-ne,f[7]=re-te,f[2]=Z-le,f[5]=re+te,f[8]=1-D-q,f},ae.normalFromMat4=function(f,y){var T=y[0],M=y[1],O=y[2],w=y[3],P=y[4],N=y[5],L=y[6],D=y[7],B=y[8],q=y[9],Z=y[10],re=y[11],ne=y[12],te=y[13],le=y[14],fe=y[15],_e=T*N-M*P,Me=T*L-O*P,Ce=T*D-w*P,Te=M*L-O*N,Ge=M*D-w*N,Ae=O*D-w*L,He=B*te-q*ne,Qe=B*le-Z*ne,Je=B*fe-re*ne,st=q*le-Z*te,rt=q*fe-re*te,dt=Z*fe-re*le,lt=_e*dt-Me*rt+Ce*st+Te*Je-Ge*Qe+Ae*He;return lt?(f[0]=(N*dt-L*rt+D*st)*(lt=1/lt),f[1]=(L*Je-P*dt-D*Qe)*lt,f[2]=(P*rt-N*Je+D*He)*lt,f[3]=(O*rt-M*dt-w*st)*lt,f[4]=(T*dt-O*Je+w*Qe)*lt,f[5]=(M*Je-T*rt-w*He)*lt,f[6]=(te*Ae-le*Ge+fe*Te)*lt,f[7]=(le*Ce-ne*Ae-fe*Me)*lt,f[8]=(ne*Ge-te*Ce+fe*_e)*lt,f):null},ae.projection=function(f,y,T){return f[0]=2/y,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/T,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},ae.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},ae.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},ae.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f[6]=y[6]+T[6],f[7]=y[7]+T[7],f[8]=y[8]+T[8],f},ae.subtract=m,ae.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f[6]=y[6]*T,f[7]=y[7]*T,f[8]=y[8]*T,f},ae.multiplyScalarAndAdd=function(f,y,T,M){return f[0]=y[0]+T[0]*M,f[1]=y[1]+T[1]*M,f[2]=y[2]+T[2]*M,f[3]=y[3]+T[3]*M,f[4]=y[4]+T[4]*M,f[5]=y[5]+T[5]*M,f[6]=y[6]+T[6]*M,f[7]=y[7]+T[7]*M,f[8]=y[8]+T[8]*M,f},ae.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]&&f[6]===y[6]&&f[7]===y[7]&&f[8]===y[8]},ae.equals=function(f,y){var T=f[0],M=f[1],O=f[2],w=f[3],P=f[4],N=f[5],L=f[6],D=f[7],B=f[8],q=y[0],Z=y[1],re=y[2],ne=y[3],te=y[4],le=y[5],fe=y[6],_e=y[7],Me=y[8];return Math.abs(T-q)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(q))&&Math.abs(M-Z)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(Z))&&Math.abs(O-re)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(w-ne)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs(ne))&&Math.abs(P-te)<=o.EPSILON*Math.max(1,Math.abs(P),Math.abs(te))&&Math.abs(N-le)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(le))&&Math.abs(L-fe)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(fe))&&Math.abs(D-_e)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(_e))&&Math.abs(B-Me)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(Me))},ae.sub=ae.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(f===null||h(f)!=="object"&&typeof f!="function")return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var M={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if(w!=="default"&&Object.prototype.hasOwnProperty.call(f,w)){var P=O?Object.getOwnPropertyDescriptor(f,w):null;P&&(P.get||P.set)?Object.defineProperty(M,w,P):M[w]=f[w]}return M.default=f,T&&T.set(f,M),M}(z());function l(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(l=function(M){return M?T:y})(f)}function d(f,y,T){var M=y[0],O=y[1],w=y[2],P=y[3],N=y[4],L=y[5],D=y[6],B=y[7],q=y[8],Z=T[0],re=T[1],ne=T[2],te=T[3],le=T[4],fe=T[5],_e=T[6],Me=T[7],Ce=T[8];return f[0]=Z*M+re*P+ne*D,f[1]=Z*O+re*N+ne*B,f[2]=Z*w+re*L+ne*q,f[3]=te*M+le*P+fe*D,f[4]=te*O+le*N+fe*B,f[5]=te*w+le*L+fe*q,f[6]=_e*M+Me*P+Ce*D,f[7]=_e*O+Me*N+Ce*B,f[8]=_e*w+Me*L+Ce*q,f}function m(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f[6]=y[6]-T[6],f[7]=y[7]-T[7],f[8]=y[8]-T[8],f}return ae.mul=d,ae.sub=m,ae}var xe,ye={};function Se(){if(xe)return ye;function h(w){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},h(w)}xe=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.create=function(){var w=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w},ye.clone=function(w){var P=new o.ARRAY_TYPE(16);return P[0]=w[0],P[1]=w[1],P[2]=w[2],P[3]=w[3],P[4]=w[4],P[5]=w[5],P[6]=w[6],P[7]=w[7],P[8]=w[8],P[9]=w[9],P[10]=w[10],P[11]=w[11],P[12]=w[12],P[13]=w[13],P[14]=w[14],P[15]=w[15],P},ye.copy=function(w,P){return w[0]=P[0],w[1]=P[1],w[2]=P[2],w[3]=P[3],w[4]=P[4],w[5]=P[5],w[6]=P[6],w[7]=P[7],w[8]=P[8],w[9]=P[9],w[10]=P[10],w[11]=P[11],w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15],w},ye.fromValues=function(w,P,N,L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce){var Te=new o.ARRAY_TYPE(16);return Te[0]=w,Te[1]=P,Te[2]=N,Te[3]=L,Te[4]=D,Te[5]=B,Te[6]=q,Te[7]=Z,Te[8]=re,Te[9]=ne,Te[10]=te,Te[11]=le,Te[12]=fe,Te[13]=_e,Te[14]=Me,Te[15]=Ce,Te},ye.set=function(w,P,N,L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce,Te){return w[0]=P,w[1]=N,w[2]=L,w[3]=D,w[4]=B,w[5]=q,w[6]=Z,w[7]=re,w[8]=ne,w[9]=te,w[10]=le,w[11]=fe,w[12]=_e,w[13]=Me,w[14]=Ce,w[15]=Te,w},ye.identity=d,ye.transpose=function(w,P){if(w===P){var N=P[1],L=P[2],D=P[3],B=P[6],q=P[7],Z=P[11];w[1]=P[4],w[2]=P[8],w[3]=P[12],w[4]=N,w[6]=P[9],w[7]=P[13],w[8]=L,w[9]=B,w[11]=P[14],w[12]=D,w[13]=q,w[14]=Z}else w[0]=P[0],w[1]=P[4],w[2]=P[8],w[3]=P[12],w[4]=P[1],w[5]=P[5],w[6]=P[9],w[7]=P[13],w[8]=P[2],w[9]=P[6],w[10]=P[10],w[11]=P[14],w[12]=P[3],w[13]=P[7],w[14]=P[11],w[15]=P[15];return w},ye.invert=function(w,P){var N=P[0],L=P[1],D=P[2],B=P[3],q=P[4],Z=P[5],re=P[6],ne=P[7],te=P[8],le=P[9],fe=P[10],_e=P[11],Me=P[12],Ce=P[13],Te=P[14],Ge=P[15],Ae=N*Z-L*q,He=N*re-D*q,Qe=N*ne-B*q,Je=L*re-D*Z,st=L*ne-B*Z,rt=D*ne-B*re,dt=te*Ce-le*Me,lt=te*Te-fe*Me,pt=te*Ge-_e*Me,kt=le*Te-fe*Ce,Nt=le*Ge-_e*Ce,hn=fe*Ge-_e*Te,qt=Ae*hn-He*Nt+Qe*kt+Je*pt-st*lt+rt*dt;return qt?(w[0]=(Z*hn-re*Nt+ne*kt)*(qt=1/qt),w[1]=(D*Nt-L*hn-B*kt)*qt,w[2]=(Ce*rt-Te*st+Ge*Je)*qt,w[3]=(fe*st-le*rt-_e*Je)*qt,w[4]=(re*pt-q*hn-ne*lt)*qt,w[5]=(N*hn-D*pt+B*lt)*qt,w[6]=(Te*Qe-Me*rt-Ge*He)*qt,w[7]=(te*rt-fe*Qe+_e*He)*qt,w[8]=(q*Nt-Z*pt+ne*dt)*qt,w[9]=(L*pt-N*Nt-B*dt)*qt,w[10]=(Me*st-Ce*Qe+Ge*Ae)*qt,w[11]=(le*Qe-te*st-_e*Ae)*qt,w[12]=(Z*lt-q*kt-re*dt)*qt,w[13]=(N*kt-L*lt+D*dt)*qt,w[14]=(Ce*He-Me*Je-Te*Ae)*qt,w[15]=(te*Je-le*He+fe*Ae)*qt,w):null},ye.adjoint=function(w,P){var N=P[0],L=P[1],D=P[2],B=P[3],q=P[4],Z=P[5],re=P[6],ne=P[7],te=P[8],le=P[9],fe=P[10],_e=P[11],Me=P[12],Ce=P[13],Te=P[14],Ge=P[15];return w[0]=Z*(fe*Ge-_e*Te)-le*(re*Ge-ne*Te)+Ce*(re*_e-ne*fe),w[1]=-(L*(fe*Ge-_e*Te)-le*(D*Ge-B*Te)+Ce*(D*_e-B*fe)),w[2]=L*(re*Ge-ne*Te)-Z*(D*Ge-B*Te)+Ce*(D*ne-B*re),w[3]=-(L*(re*_e-ne*fe)-Z*(D*_e-B*fe)+le*(D*ne-B*re)),w[4]=-(q*(fe*Ge-_e*Te)-te*(re*Ge-ne*Te)+Me*(re*_e-ne*fe)),w[5]=N*(fe*Ge-_e*Te)-te*(D*Ge-B*Te)+Me*(D*_e-B*fe),w[6]=-(N*(re*Ge-ne*Te)-q*(D*Ge-B*Te)+Me*(D*ne-B*re)),w[7]=N*(re*_e-ne*fe)-q*(D*_e-B*fe)+te*(D*ne-B*re),w[8]=q*(le*Ge-_e*Ce)-te*(Z*Ge-ne*Ce)+Me*(Z*_e-ne*le),w[9]=-(N*(le*Ge-_e*Ce)-te*(L*Ge-B*Ce)+Me*(L*_e-B*le)),w[10]=N*(Z*Ge-ne*Ce)-q*(L*Ge-B*Ce)+Me*(L*ne-B*Z),w[11]=-(N*(Z*_e-ne*le)-q*(L*_e-B*le)+te*(L*ne-B*Z)),w[12]=-(q*(le*Te-fe*Ce)-te*(Z*Te-re*Ce)+Me*(Z*fe-re*le)),w[13]=N*(le*Te-fe*Ce)-te*(L*Te-D*Ce)+Me*(L*fe-D*le),w[14]=-(N*(Z*Te-re*Ce)-q*(L*Te-D*Ce)+Me*(L*re-D*Z)),w[15]=N*(Z*fe-re*le)-q*(L*fe-D*le)+te*(L*re-D*Z),w},ye.determinant=function(w){var P=w[0],N=w[1],L=w[2],D=w[3],B=w[4],q=w[5],Z=w[6],re=w[7],ne=w[8],te=w[9],le=w[10],fe=w[11],_e=w[12],Me=w[13],Ce=w[14],Te=w[15];return(P*q-N*B)*(le*Te-fe*Ce)-(P*Z-L*B)*(te*Te-fe*Me)+(P*re-D*B)*(te*Ce-le*Me)+(N*Z-L*q)*(ne*Te-fe*_e)-(N*re-D*q)*(ne*Ce-le*_e)+(L*re-D*Z)*(ne*Me-te*_e)},ye.multiply=m,ye.translate=function(w,P,N){var L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce=N[0],Te=N[1],Ge=N[2];return P===w?(w[12]=P[0]*Ce+P[4]*Te+P[8]*Ge+P[12],w[13]=P[1]*Ce+P[5]*Te+P[9]*Ge+P[13],w[14]=P[2]*Ce+P[6]*Te+P[10]*Ge+P[14],w[15]=P[3]*Ce+P[7]*Te+P[11]*Ge+P[15]):(D=P[1],B=P[2],q=P[3],Z=P[4],re=P[5],ne=P[6],te=P[7],le=P[8],fe=P[9],_e=P[10],Me=P[11],w[0]=L=P[0],w[1]=D,w[2]=B,w[3]=q,w[4]=Z,w[5]=re,w[6]=ne,w[7]=te,w[8]=le,w[9]=fe,w[10]=_e,w[11]=Me,w[12]=L*Ce+Z*Te+le*Ge+P[12],w[13]=D*Ce+re*Te+fe*Ge+P[13],w[14]=B*Ce+ne*Te+_e*Ge+P[14],w[15]=q*Ce+te*Te+Me*Ge+P[15]),w},ye.scale=function(w,P,N){var L=N[0],D=N[1],B=N[2];return w[0]=P[0]*L,w[1]=P[1]*L,w[2]=P[2]*L,w[3]=P[3]*L,w[4]=P[4]*D,w[5]=P[5]*D,w[6]=P[6]*D,w[7]=P[7]*D,w[8]=P[8]*B,w[9]=P[9]*B,w[10]=P[10]*B,w[11]=P[11]*B,w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15],w},ye.rotate=function(w,P,N,L){var D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe,Je,st,rt,dt,lt,pt,kt,Nt=L[0],hn=L[1],qt=L[2],Jt=Math.hypot(Nt,hn,qt);return Jt<o.EPSILON?null:(Nt*=Jt=1/Jt,hn*=Jt,qt*=Jt,D=Math.sin(N),B=Math.cos(N),re=P[1],ne=P[2],te=P[3],fe=P[5],_e=P[6],Me=P[7],Te=P[9],Ge=P[10],Ae=P[11],He=Nt*Nt*(q=1-B)+B,st=Nt*hn*q-qt*D,rt=hn*hn*q+B,dt=qt*hn*q+Nt*D,lt=Nt*qt*q+hn*D,pt=hn*qt*q-Nt*D,kt=qt*qt*q+B,w[0]=(Z=P[0])*He+(le=P[4])*(Qe=hn*Nt*q+qt*D)+(Ce=P[8])*(Je=qt*Nt*q-hn*D),w[1]=re*He+fe*Qe+Te*Je,w[2]=ne*He+_e*Qe+Ge*Je,w[3]=te*He+Me*Qe+Ae*Je,w[4]=Z*st+le*rt+Ce*dt,w[5]=re*st+fe*rt+Te*dt,w[6]=ne*st+_e*rt+Ge*dt,w[7]=te*st+Me*rt+Ae*dt,w[8]=Z*lt+le*pt+Ce*kt,w[9]=re*lt+fe*pt+Te*kt,w[10]=ne*lt+_e*pt+Ge*kt,w[11]=te*lt+Me*pt+Ae*kt,P!==w&&(w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15]),w)},ye.rotateX=function(w,P,N){var L=Math.sin(N),D=Math.cos(N),B=P[4],q=P[5],Z=P[6],re=P[7],ne=P[8],te=P[9],le=P[10],fe=P[11];return P!==w&&(w[0]=P[0],w[1]=P[1],w[2]=P[2],w[3]=P[3],w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15]),w[4]=B*D+ne*L,w[5]=q*D+te*L,w[6]=Z*D+le*L,w[7]=re*D+fe*L,w[8]=ne*D-B*L,w[9]=te*D-q*L,w[10]=le*D-Z*L,w[11]=fe*D-re*L,w},ye.rotateY=function(w,P,N){var L=Math.sin(N),D=Math.cos(N),B=P[0],q=P[1],Z=P[2],re=P[3],ne=P[8],te=P[9],le=P[10],fe=P[11];return P!==w&&(w[4]=P[4],w[5]=P[5],w[6]=P[6],w[7]=P[7],w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15]),w[0]=B*D-ne*L,w[1]=q*D-te*L,w[2]=Z*D-le*L,w[3]=re*D-fe*L,w[8]=B*L+ne*D,w[9]=q*L+te*D,w[10]=Z*L+le*D,w[11]=re*L+fe*D,w},ye.rotateZ=function(w,P,N){var L=Math.sin(N),D=Math.cos(N),B=P[0],q=P[1],Z=P[2],re=P[3],ne=P[4],te=P[5],le=P[6],fe=P[7];return P!==w&&(w[8]=P[8],w[9]=P[9],w[10]=P[10],w[11]=P[11],w[12]=P[12],w[13]=P[13],w[14]=P[14],w[15]=P[15]),w[0]=B*D+ne*L,w[1]=q*D+te*L,w[2]=Z*D+le*L,w[3]=re*D+fe*L,w[4]=ne*D-B*L,w[5]=te*D-q*L,w[6]=le*D-Z*L,w[7]=fe*D-re*L,w},ye.fromTranslation=function(w,P){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=P[0],w[13]=P[1],w[14]=P[2],w[15]=1,w},ye.fromScaling=function(w,P){return w[0]=P[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=P[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=P[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ye.fromRotation=function(w,P,N){var L,D,B,q=N[0],Z=N[1],re=N[2],ne=Math.hypot(q,Z,re);return ne<o.EPSILON?null:(q*=ne=1/ne,Z*=ne,re*=ne,L=Math.sin(P),D=Math.cos(P),w[0]=q*q*(B=1-D)+D,w[1]=Z*q*B+re*L,w[2]=re*q*B-Z*L,w[3]=0,w[4]=q*Z*B-re*L,w[5]=Z*Z*B+D,w[6]=re*Z*B+q*L,w[7]=0,w[8]=q*re*B+Z*L,w[9]=Z*re*B-q*L,w[10]=re*re*B+D,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)},ye.fromXRotation=function(w,P){var N=Math.sin(P),L=Math.cos(P);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=L,w[6]=N,w[7]=0,w[8]=0,w[9]=-N,w[10]=L,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ye.fromYRotation=function(w,P){var N=Math.sin(P),L=Math.cos(P);return w[0]=L,w[1]=0,w[2]=-N,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=N,w[9]=0,w[10]=L,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ye.fromZRotation=function(w,P){var N=Math.sin(P),L=Math.cos(P);return w[0]=L,w[1]=N,w[2]=0,w[3]=0,w[4]=-N,w[5]=L,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ye.fromRotationTranslation=f,ye.fromQuat2=function(w,P){var N=new o.ARRAY_TYPE(3),L=-P[0],D=-P[1],B=-P[2],q=P[3],Z=P[4],re=P[5],ne=P[6],te=P[7],le=L*L+D*D+B*B+q*q;return le>0?(N[0]=2*(Z*q+te*L+re*B-ne*D)/le,N[1]=2*(re*q+te*D+ne*L-Z*B)/le,N[2]=2*(ne*q+te*B+Z*D-re*L)/le):(N[0]=2*(Z*q+te*L+re*B-ne*D),N[1]=2*(re*q+te*D+ne*L-Z*B),N[2]=2*(ne*q+te*B+Z*D-re*L)),f(w,P,N),w},ye.getTranslation=function(w,P){return w[0]=P[12],w[1]=P[13],w[2]=P[14],w},ye.getScaling=y,ye.getRotation=function(w,P){var N=new o.ARRAY_TYPE(3);y(N,P);var L=1/N[0],D=1/N[1],B=1/N[2],q=P[0]*L,Z=P[1]*D,re=P[2]*B,ne=P[4]*L,te=P[5]*D,le=P[6]*B,fe=P[8]*L,_e=P[9]*D,Me=P[10]*B,Ce=q+te+Me,Te=0;return Ce>0?(Te=2*Math.sqrt(Ce+1),w[3]=.25*Te,w[0]=(le-_e)/Te,w[1]=(fe-re)/Te,w[2]=(Z-ne)/Te):q>te&&q>Me?(Te=2*Math.sqrt(1+q-te-Me),w[3]=(le-_e)/Te,w[0]=.25*Te,w[1]=(Z+ne)/Te,w[2]=(fe+re)/Te):te>Me?(Te=2*Math.sqrt(1+te-q-Me),w[3]=(fe-re)/Te,w[0]=(Z+ne)/Te,w[1]=.25*Te,w[2]=(le+_e)/Te):(Te=2*Math.sqrt(1+Me-q-te),w[3]=(Z-ne)/Te,w[0]=(fe+re)/Te,w[1]=(le+_e)/Te,w[2]=.25*Te),w},ye.fromRotationTranslationScale=function(w,P,N,L){var D=P[0],B=P[1],q=P[2],Z=P[3],re=D+D,ne=B+B,te=q+q,le=D*re,fe=D*ne,_e=D*te,Me=B*ne,Ce=B*te,Te=q*te,Ge=Z*re,Ae=Z*ne,He=Z*te,Qe=L[0],Je=L[1],st=L[2];return w[0]=(1-(Me+Te))*Qe,w[1]=(fe+He)*Qe,w[2]=(_e-Ae)*Qe,w[3]=0,w[4]=(fe-He)*Je,w[5]=(1-(le+Te))*Je,w[6]=(Ce+Ge)*Je,w[7]=0,w[8]=(_e+Ae)*st,w[9]=(Ce-Ge)*st,w[10]=(1-(le+Me))*st,w[11]=0,w[12]=N[0],w[13]=N[1],w[14]=N[2],w[15]=1,w},ye.fromRotationTranslationScaleOrigin=function(w,P,N,L,D){var B=P[0],q=P[1],Z=P[2],re=P[3],ne=B+B,te=q+q,le=Z+Z,fe=B*ne,_e=B*te,Me=B*le,Ce=q*te,Te=q*le,Ge=Z*le,Ae=re*ne,He=re*te,Qe=re*le,Je=L[0],st=L[1],rt=L[2],dt=D[0],lt=D[1],pt=D[2],kt=(1-(Ce+Ge))*Je,Nt=(_e+Qe)*Je,hn=(Me-He)*Je,qt=(_e-Qe)*st,Jt=(1-(fe+Ge))*st,Bt=(Te+Ae)*st,An=(Me+He)*rt,un=(Te-Ae)*rt,_n=(1-(fe+Ce))*rt;return w[0]=kt,w[1]=Nt,w[2]=hn,w[3]=0,w[4]=qt,w[5]=Jt,w[6]=Bt,w[7]=0,w[8]=An,w[9]=un,w[10]=_n,w[11]=0,w[12]=N[0]+dt-(kt*dt+qt*lt+An*pt),w[13]=N[1]+lt-(Nt*dt+Jt*lt+un*pt),w[14]=N[2]+pt-(hn*dt+Bt*lt+_n*pt),w[15]=1,w},ye.fromQuat=function(w,P){var N=P[0],L=P[1],D=P[2],B=P[3],q=N+N,Z=L+L,re=D+D,ne=N*q,te=L*q,le=L*Z,fe=D*q,_e=D*Z,Me=D*re,Ce=B*q,Te=B*Z,Ge=B*re;return w[0]=1-le-Me,w[1]=te+Ge,w[2]=fe-Te,w[3]=0,w[4]=te-Ge,w[5]=1-ne-Me,w[6]=_e+Ce,w[7]=0,w[8]=fe+Te,w[9]=_e-Ce,w[10]=1-ne-le,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ye.frustum=function(w,P,N,L,D,B,q){var Z=1/(N-P),re=1/(D-L),ne=1/(B-q);return w[0]=2*B*Z,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*B*re,w[6]=0,w[7]=0,w[8]=(N+P)*Z,w[9]=(D+L)*re,w[10]=(q+B)*ne,w[11]=-1,w[12]=0,w[13]=0,w[14]=q*B*2*ne,w[15]=0,w},ye.perspectiveNO=T,ye.perspectiveZO=function(w,P,N,L,D){var B,q=1/Math.tan(P/2);return w[0]=q/N,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=q,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,D!=null&&D!==1/0?(w[10]=D*(B=1/(L-D)),w[14]=D*L*B):(w[10]=-1,w[14]=-L),w},ye.perspectiveFromFieldOfView=function(w,P,N,L){var D=Math.tan(P.upDegrees*Math.PI/180),B=Math.tan(P.downDegrees*Math.PI/180),q=Math.tan(P.leftDegrees*Math.PI/180),Z=Math.tan(P.rightDegrees*Math.PI/180),re=2/(q+Z),ne=2/(D+B);return w[0]=re,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=ne,w[6]=0,w[7]=0,w[8]=-(q-Z)*re*.5,w[9]=(D-B)*ne*.5,w[10]=L/(N-L),w[11]=-1,w[12]=0,w[13]=0,w[14]=L*N/(N-L),w[15]=0,w},ye.orthoNO=M,ye.orthoZO=function(w,P,N,L,D,B,q){var Z=1/(P-N),re=1/(L-D),ne=1/(B-q);return w[0]=-2*Z,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*re,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=ne,w[11]=0,w[12]=(P+N)*Z,w[13]=(D+L)*re,w[14]=B*ne,w[15]=1,w},ye.lookAt=function(w,P,N,L){var D,B,q,Z,re,ne,te,le,fe,_e,Me=P[0],Ce=P[1],Te=P[2],Ge=L[0],Ae=L[1],He=L[2],Qe=N[0],Je=N[1],st=N[2];return Math.abs(Me-Qe)<o.EPSILON&&Math.abs(Ce-Je)<o.EPSILON&&Math.abs(Te-st)<o.EPSILON?d(w):(te=Me-Qe,le=Ce-Je,fe=Te-st,D=Ae*(fe*=_e=1/Math.hypot(te,le,fe))-He*(le*=_e),B=He*(te*=_e)-Ge*fe,q=Ge*le-Ae*te,(_e=Math.hypot(D,B,q))?(D*=_e=1/_e,B*=_e,q*=_e):(D=0,B=0,q=0),Z=le*q-fe*B,re=fe*D-te*q,ne=te*B-le*D,(_e=Math.hypot(Z,re,ne))?(Z*=_e=1/_e,re*=_e,ne*=_e):(Z=0,re=0,ne=0),w[0]=D,w[1]=Z,w[2]=te,w[3]=0,w[4]=B,w[5]=re,w[6]=le,w[7]=0,w[8]=q,w[9]=ne,w[10]=fe,w[11]=0,w[12]=-(D*Me+B*Ce+q*Te),w[13]=-(Z*Me+re*Ce+ne*Te),w[14]=-(te*Me+le*Ce+fe*Te),w[15]=1,w)},ye.targetTo=function(w,P,N,L){var D=P[0],B=P[1],q=P[2],Z=L[0],re=L[1],ne=L[2],te=D-N[0],le=B-N[1],fe=q-N[2],_e=te*te+le*le+fe*fe;_e>0&&(te*=_e=1/Math.sqrt(_e),le*=_e,fe*=_e);var Me=re*fe-ne*le,Ce=ne*te-Z*fe,Te=Z*le-re*te;return(_e=Me*Me+Ce*Ce+Te*Te)>0&&(Me*=_e=1/Math.sqrt(_e),Ce*=_e,Te*=_e),w[0]=Me,w[1]=Ce,w[2]=Te,w[3]=0,w[4]=le*Te-fe*Ce,w[5]=fe*Me-te*Te,w[6]=te*Ce-le*Me,w[7]=0,w[8]=te,w[9]=le,w[10]=fe,w[11]=0,w[12]=D,w[13]=B,w[14]=q,w[15]=1,w},ye.str=function(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"},ye.frob=function(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])},ye.add=function(w,P,N){return w[0]=P[0]+N[0],w[1]=P[1]+N[1],w[2]=P[2]+N[2],w[3]=P[3]+N[3],w[4]=P[4]+N[4],w[5]=P[5]+N[5],w[6]=P[6]+N[6],w[7]=P[7]+N[7],w[8]=P[8]+N[8],w[9]=P[9]+N[9],w[10]=P[10]+N[10],w[11]=P[11]+N[11],w[12]=P[12]+N[12],w[13]=P[13]+N[13],w[14]=P[14]+N[14],w[15]=P[15]+N[15],w},ye.subtract=O,ye.multiplyScalar=function(w,P,N){return w[0]=P[0]*N,w[1]=P[1]*N,w[2]=P[2]*N,w[3]=P[3]*N,w[4]=P[4]*N,w[5]=P[5]*N,w[6]=P[6]*N,w[7]=P[7]*N,w[8]=P[8]*N,w[9]=P[9]*N,w[10]=P[10]*N,w[11]=P[11]*N,w[12]=P[12]*N,w[13]=P[13]*N,w[14]=P[14]*N,w[15]=P[15]*N,w},ye.multiplyScalarAndAdd=function(w,P,N,L){return w[0]=P[0]+N[0]*L,w[1]=P[1]+N[1]*L,w[2]=P[2]+N[2]*L,w[3]=P[3]+N[3]*L,w[4]=P[4]+N[4]*L,w[5]=P[5]+N[5]*L,w[6]=P[6]+N[6]*L,w[7]=P[7]+N[7]*L,w[8]=P[8]+N[8]*L,w[9]=P[9]+N[9]*L,w[10]=P[10]+N[10]*L,w[11]=P[11]+N[11]*L,w[12]=P[12]+N[12]*L,w[13]=P[13]+N[13]*L,w[14]=P[14]+N[14]*L,w[15]=P[15]+N[15]*L,w},ye.exactEquals=function(w,P){return w[0]===P[0]&&w[1]===P[1]&&w[2]===P[2]&&w[3]===P[3]&&w[4]===P[4]&&w[5]===P[5]&&w[6]===P[6]&&w[7]===P[7]&&w[8]===P[8]&&w[9]===P[9]&&w[10]===P[10]&&w[11]===P[11]&&w[12]===P[12]&&w[13]===P[13]&&w[14]===P[14]&&w[15]===P[15]},ye.equals=function(w,P){var N=w[0],L=w[1],D=w[2],B=w[3],q=w[4],Z=w[5],re=w[6],ne=w[7],te=w[8],le=w[9],fe=w[10],_e=w[11],Me=w[12],Ce=w[13],Te=w[14],Ge=w[15],Ae=P[0],He=P[1],Qe=P[2],Je=P[3],st=P[4],rt=P[5],dt=P[6],lt=P[7],pt=P[8],kt=P[9],Nt=P[10],hn=P[11],qt=P[12],Jt=P[13],Bt=P[14],An=P[15];return Math.abs(N-Ae)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ae))&&Math.abs(L-He)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(He))&&Math.abs(D-Qe)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(Qe))&&Math.abs(B-Je)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(Je))&&Math.abs(q-st)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(st))&&Math.abs(Z-rt)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(rt))&&Math.abs(re-dt)<=o.EPSILON*Math.max(1,Math.abs(re),Math.abs(dt))&&Math.abs(ne-lt)<=o.EPSILON*Math.max(1,Math.abs(ne),Math.abs(lt))&&Math.abs(te-pt)<=o.EPSILON*Math.max(1,Math.abs(te),Math.abs(pt))&&Math.abs(le-kt)<=o.EPSILON*Math.max(1,Math.abs(le),Math.abs(kt))&&Math.abs(fe-Nt)<=o.EPSILON*Math.max(1,Math.abs(fe),Math.abs(Nt))&&Math.abs(_e-hn)<=o.EPSILON*Math.max(1,Math.abs(_e),Math.abs(hn))&&Math.abs(Me-qt)<=o.EPSILON*Math.max(1,Math.abs(Me),Math.abs(qt))&&Math.abs(Ce-Jt)<=o.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(Jt))&&Math.abs(Te-Bt)<=o.EPSILON*Math.max(1,Math.abs(Te),Math.abs(Bt))&&Math.abs(Ge-An)<=o.EPSILON*Math.max(1,Math.abs(Ge),Math.abs(An))},ye.sub=ye.mul=ye.ortho=ye.perspective=void 0;var o=function(w,P){if(w&&w.__esModule)return w;if(w===null||h(w)!=="object"&&typeof w!="function")return{default:w};var N=l(void 0);if(N&&N.has(w))return N.get(w);var L={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var q=D?Object.getOwnPropertyDescriptor(w,B):null;q&&(q.get||q.set)?Object.defineProperty(L,B,q):L[B]=w[B]}return L.default=w,N&&N.set(w,L),L}(z());function l(w){if(typeof WeakMap!="function")return null;var P=new WeakMap,N=new WeakMap;return(l=function(L){return L?N:P})(w)}function d(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function m(w,P,N){var L=P[0],D=P[1],B=P[2],q=P[3],Z=P[4],re=P[5],ne=P[6],te=P[7],le=P[8],fe=P[9],_e=P[10],Me=P[11],Ce=P[12],Te=P[13],Ge=P[14],Ae=P[15],He=N[0],Qe=N[1],Je=N[2],st=N[3];return w[0]=He*L+Qe*Z+Je*le+st*Ce,w[1]=He*D+Qe*re+Je*fe+st*Te,w[2]=He*B+Qe*ne+Je*_e+st*Ge,w[3]=He*q+Qe*te+Je*Me+st*Ae,w[4]=(He=N[4])*L+(Qe=N[5])*Z+(Je=N[6])*le+(st=N[7])*Ce,w[5]=He*D+Qe*re+Je*fe+st*Te,w[6]=He*B+Qe*ne+Je*_e+st*Ge,w[7]=He*q+Qe*te+Je*Me+st*Ae,w[8]=(He=N[8])*L+(Qe=N[9])*Z+(Je=N[10])*le+(st=N[11])*Ce,w[9]=He*D+Qe*re+Je*fe+st*Te,w[10]=He*B+Qe*ne+Je*_e+st*Ge,w[11]=He*q+Qe*te+Je*Me+st*Ae,w[12]=(He=N[12])*L+(Qe=N[13])*Z+(Je=N[14])*le+(st=N[15])*Ce,w[13]=He*D+Qe*re+Je*fe+st*Te,w[14]=He*B+Qe*ne+Je*_e+st*Ge,w[15]=He*q+Qe*te+Je*Me+st*Ae,w}function f(w,P,N){var L=P[0],D=P[1],B=P[2],q=P[3],Z=L+L,re=D+D,ne=B+B,te=L*Z,le=L*re,fe=L*ne,_e=D*re,Me=D*ne,Ce=B*ne,Te=q*Z,Ge=q*re,Ae=q*ne;return w[0]=1-(_e+Ce),w[1]=le+Ae,w[2]=fe-Ge,w[3]=0,w[4]=le-Ae,w[5]=1-(te+Ce),w[6]=Me+Te,w[7]=0,w[8]=fe+Ge,w[9]=Me-Te,w[10]=1-(te+_e),w[11]=0,w[12]=N[0],w[13]=N[1],w[14]=N[2],w[15]=1,w}function y(w,P){var N=P[4],L=P[5],D=P[6],B=P[8],q=P[9],Z=P[10];return w[0]=Math.hypot(P[0],P[1],P[2]),w[1]=Math.hypot(N,L,D),w[2]=Math.hypot(B,q,Z),w}function T(w,P,N,L,D){var B,q=1/Math.tan(P/2);return w[0]=q/N,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=q,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,D!=null&&D!==1/0?(w[10]=(D+L)*(B=1/(L-D)),w[14]=2*D*L*B):(w[10]=-1,w[14]=-2*L),w}function M(w,P,N,L,D,B,q){var Z=1/(P-N),re=1/(L-D),ne=1/(B-q);return w[0]=-2*Z,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*re,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*ne,w[11]=0,w[12]=(P+N)*Z,w[13]=(D+L)*re,w[14]=(q+B)*ne,w[15]=1,w}function O(w,P,N){return w[0]=P[0]-N[0],w[1]=P[1]-N[1],w[2]=P[2]-N[2],w[3]=P[3]-N[3],w[4]=P[4]-N[4],w[5]=P[5]-N[5],w[6]=P[6]-N[6],w[7]=P[7]-N[7],w[8]=P[8]-N[8],w[9]=P[9]-N[9],w[10]=P[10]-N[10],w[11]=P[11]-N[11],w[12]=P[12]-N[12],w[13]=P[13]-N[13],w[14]=P[14]-N[14],w[15]=P[15]-N[15],w}return ye.perspective=T,ye.ortho=M,ye.mul=m,ye.sub=O,ye}var je,Re={},De={};function at(){if(je)return De;function h(D){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},h(D)}je=1,Object.defineProperty(De,"__esModule",{value:!0}),De.create=d,De.clone=function(D){var B=new o.ARRAY_TYPE(3);return B[0]=D[0],B[1]=D[1],B[2]=D[2],B},De.length=m,De.fromValues=function(D,B,q){var Z=new o.ARRAY_TYPE(3);return Z[0]=D,Z[1]=B,Z[2]=q,Z},De.copy=function(D,B){return D[0]=B[0],D[1]=B[1],D[2]=B[2],D},De.set=function(D,B,q,Z){return D[0]=B,D[1]=q,D[2]=Z,D},De.add=function(D,B,q){return D[0]=B[0]+q[0],D[1]=B[1]+q[1],D[2]=B[2]+q[2],D},De.subtract=f,De.multiply=y,De.divide=T,De.ceil=function(D,B){return D[0]=Math.ceil(B[0]),D[1]=Math.ceil(B[1]),D[2]=Math.ceil(B[2]),D},De.floor=function(D,B){return D[0]=Math.floor(B[0]),D[1]=Math.floor(B[1]),D[2]=Math.floor(B[2]),D},De.min=function(D,B,q){return D[0]=Math.min(B[0],q[0]),D[1]=Math.min(B[1],q[1]),D[2]=Math.min(B[2],q[2]),D},De.max=function(D,B,q){return D[0]=Math.max(B[0],q[0]),D[1]=Math.max(B[1],q[1]),D[2]=Math.max(B[2],q[2]),D},De.round=function(D,B){return D[0]=Math.round(B[0]),D[1]=Math.round(B[1]),D[2]=Math.round(B[2]),D},De.scale=function(D,B,q){return D[0]=B[0]*q,D[1]=B[1]*q,D[2]=B[2]*q,D},De.scaleAndAdd=function(D,B,q,Z){return D[0]=B[0]+q[0]*Z,D[1]=B[1]+q[1]*Z,D[2]=B[2]+q[2]*Z,D},De.distance=M,De.squaredDistance=O,De.squaredLength=w,De.negate=function(D,B){return D[0]=-B[0],D[1]=-B[1],D[2]=-B[2],D},De.inverse=function(D,B){return D[0]=1/B[0],D[1]=1/B[1],D[2]=1/B[2],D},De.normalize=function(D,B){var q=B[0],Z=B[1],re=B[2],ne=q*q+Z*Z+re*re;return ne>0&&(ne=1/Math.sqrt(ne)),D[0]=B[0]*ne,D[1]=B[1]*ne,D[2]=B[2]*ne,D},De.dot=P,De.cross=function(D,B,q){var Z=B[0],re=B[1],ne=B[2],te=q[0],le=q[1],fe=q[2];return D[0]=re*fe-ne*le,D[1]=ne*te-Z*fe,D[2]=Z*le-re*te,D},De.lerp=function(D,B,q,Z){var re=B[0],ne=B[1],te=B[2];return D[0]=re+Z*(q[0]-re),D[1]=ne+Z*(q[1]-ne),D[2]=te+Z*(q[2]-te),D},De.hermite=function(D,B,q,Z,re,ne){var te=ne*ne,le=te*(2*ne-3)+1,fe=te*(ne-2)+ne,_e=te*(ne-1),Me=te*(3-2*ne);return D[0]=B[0]*le+q[0]*fe+Z[0]*_e+re[0]*Me,D[1]=B[1]*le+q[1]*fe+Z[1]*_e+re[1]*Me,D[2]=B[2]*le+q[2]*fe+Z[2]*_e+re[2]*Me,D},De.bezier=function(D,B,q,Z,re,ne){var te=1-ne,le=te*te,fe=ne*ne,_e=le*te,Me=3*ne*le,Ce=3*fe*te,Te=fe*ne;return D[0]=B[0]*_e+q[0]*Me+Z[0]*Ce+re[0]*Te,D[1]=B[1]*_e+q[1]*Me+Z[1]*Ce+re[1]*Te,D[2]=B[2]*_e+q[2]*Me+Z[2]*Ce+re[2]*Te,D},De.random=function(D,B){B=B||1;var q=2*o.RANDOM()*Math.PI,Z=2*o.RANDOM()-1,re=Math.sqrt(1-Z*Z)*B;return D[0]=Math.cos(q)*re,D[1]=Math.sin(q)*re,D[2]=Z*B,D},De.transformMat4=function(D,B,q){var Z=B[0],re=B[1],ne=B[2],te=q[3]*Z+q[7]*re+q[11]*ne+q[15];return D[0]=(q[0]*Z+q[4]*re+q[8]*ne+q[12])/(te=te||1),D[1]=(q[1]*Z+q[5]*re+q[9]*ne+q[13])/te,D[2]=(q[2]*Z+q[6]*re+q[10]*ne+q[14])/te,D},De.transformMat3=function(D,B,q){var Z=B[0],re=B[1],ne=B[2];return D[0]=Z*q[0]+re*q[3]+ne*q[6],D[1]=Z*q[1]+re*q[4]+ne*q[7],D[2]=Z*q[2]+re*q[5]+ne*q[8],D},De.transformQuat=function(D,B,q){var Z=q[0],re=q[1],ne=q[2],te=B[0],le=B[1],fe=B[2],_e=re*fe-ne*le,Me=ne*te-Z*fe,Ce=Z*le-re*te,Te=re*Ce-ne*Me,Ge=ne*_e-Z*Ce,Ae=Z*Me-re*_e,He=2*q[3];return Me*=He,Ce*=He,Ge*=2,Ae*=2,D[0]=te+(_e*=He)+(Te*=2),D[1]=le+Me+Ge,D[2]=fe+Ce+Ae,D},De.rotateX=function(D,B,q,Z){var re=[],ne=[];return re[0]=B[0]-q[0],re[1]=B[1]-q[1],re[2]=B[2]-q[2],ne[0]=re[0],ne[1]=re[1]*Math.cos(Z)-re[2]*Math.sin(Z),ne[2]=re[1]*Math.sin(Z)+re[2]*Math.cos(Z),D[0]=ne[0]+q[0],D[1]=ne[1]+q[1],D[2]=ne[2]+q[2],D},De.rotateY=function(D,B,q,Z){var re=[],ne=[];return re[0]=B[0]-q[0],re[1]=B[1]-q[1],re[2]=B[2]-q[2],ne[0]=re[2]*Math.sin(Z)+re[0]*Math.cos(Z),ne[1]=re[1],ne[2]=re[2]*Math.cos(Z)-re[0]*Math.sin(Z),D[0]=ne[0]+q[0],D[1]=ne[1]+q[1],D[2]=ne[2]+q[2],D},De.rotateZ=function(D,B,q,Z){var re=[],ne=[];return re[0]=B[0]-q[0],re[1]=B[1]-q[1],re[2]=B[2]-q[2],ne[0]=re[0]*Math.cos(Z)-re[1]*Math.sin(Z),ne[1]=re[0]*Math.sin(Z)+re[1]*Math.cos(Z),ne[2]=re[2],D[0]=ne[0]+q[0],D[1]=ne[1]+q[1],D[2]=ne[2]+q[2],D},De.angle=function(D,B){var q=D[0],Z=D[1],re=D[2],ne=B[0],te=B[1],le=B[2],fe=Math.sqrt(q*q+Z*Z+re*re)*Math.sqrt(ne*ne+te*te+le*le),_e=fe&&P(D,B)/fe;return Math.acos(Math.min(Math.max(_e,-1),1))},De.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D},De.str=function(D){return"vec3("+D[0]+", "+D[1]+", "+D[2]+")"},De.exactEquals=function(D,B){return D[0]===B[0]&&D[1]===B[1]&&D[2]===B[2]},De.equals=function(D,B){var q=D[0],Z=D[1],re=D[2],ne=B[0],te=B[1],le=B[2];return Math.abs(q-ne)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs(Z-te)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(te))&&Math.abs(re-le)<=o.EPSILON*Math.max(1,Math.abs(re),Math.abs(le))},De.forEach=De.sqrLen=De.len=De.sqrDist=De.dist=De.div=De.mul=De.sub=void 0;var o=function(D,B){if(D&&D.__esModule)return D;if(D===null||h(D)!=="object"&&typeof D!="function")return{default:D};var q=l(void 0);if(q&&q.has(D))return q.get(D);var Z={},re=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ne in D)if(ne!=="default"&&Object.prototype.hasOwnProperty.call(D,ne)){var te=re?Object.getOwnPropertyDescriptor(D,ne):null;te&&(te.get||te.set)?Object.defineProperty(Z,ne,te):Z[ne]=D[ne]}return Z.default=D,q&&q.set(D,Z),Z}(z());function l(D){if(typeof WeakMap!="function")return null;var B=new WeakMap,q=new WeakMap;return(l=function(Z){return Z?q:B})(D)}function d(){var D=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0),D}function m(D){return Math.hypot(D[0],D[1],D[2])}function f(D,B,q){return D[0]=B[0]-q[0],D[1]=B[1]-q[1],D[2]=B[2]-q[2],D}function y(D,B,q){return D[0]=B[0]*q[0],D[1]=B[1]*q[1],D[2]=B[2]*q[2],D}function T(D,B,q){return D[0]=B[0]/q[0],D[1]=B[1]/q[1],D[2]=B[2]/q[2],D}function M(D,B){return Math.hypot(B[0]-D[0],B[1]-D[1],B[2]-D[2])}function O(D,B){var q=B[0]-D[0],Z=B[1]-D[1],re=B[2]-D[2];return q*q+Z*Z+re*re}function w(D){var B=D[0],q=D[1],Z=D[2];return B*B+q*q+Z*Z}function P(D,B){return D[0]*B[0]+D[1]*B[1]+D[2]*B[2]}De.sub=f,De.mul=y,De.div=T,De.dist=M,De.sqrDist=O,De.len=m,De.sqrLen=w;var N,L=(N=d(),function(D,B,q,Z,re,ne){var te,le;for(B||(B=3),q||(q=0),le=Z?Math.min(Z*B+q,D.length):D.length,te=q;te<le;te+=B)N[0]=D[te],N[1]=D[te+1],N[2]=D[te+2],re(N,N,ne),D[te]=N[0],D[te+1]=N[1],D[te+2]=N[2];return D});return De.forEach=L,De}var ot,Fe,Ze={};function Ve(){if(ot)return Ze;function h(L){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},h(L)}ot=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=d,Ze.clone=function(L){var D=new o.ARRAY_TYPE(4);return D[0]=L[0],D[1]=L[1],D[2]=L[2],D[3]=L[3],D},Ze.fromValues=function(L,D,B,q){var Z=new o.ARRAY_TYPE(4);return Z[0]=L,Z[1]=D,Z[2]=B,Z[3]=q,Z},Ze.copy=function(L,D){return L[0]=D[0],L[1]=D[1],L[2]=D[2],L[3]=D[3],L},Ze.set=function(L,D,B,q,Z){return L[0]=D,L[1]=B,L[2]=q,L[3]=Z,L},Ze.add=function(L,D,B){return L[0]=D[0]+B[0],L[1]=D[1]+B[1],L[2]=D[2]+B[2],L[3]=D[3]+B[3],L},Ze.subtract=m,Ze.multiply=f,Ze.divide=y,Ze.ceil=function(L,D){return L[0]=Math.ceil(D[0]),L[1]=Math.ceil(D[1]),L[2]=Math.ceil(D[2]),L[3]=Math.ceil(D[3]),L},Ze.floor=function(L,D){return L[0]=Math.floor(D[0]),L[1]=Math.floor(D[1]),L[2]=Math.floor(D[2]),L[3]=Math.floor(D[3]),L},Ze.min=function(L,D,B){return L[0]=Math.min(D[0],B[0]),L[1]=Math.min(D[1],B[1]),L[2]=Math.min(D[2],B[2]),L[3]=Math.min(D[3],B[3]),L},Ze.max=function(L,D,B){return L[0]=Math.max(D[0],B[0]),L[1]=Math.max(D[1],B[1]),L[2]=Math.max(D[2],B[2]),L[3]=Math.max(D[3],B[3]),L},Ze.round=function(L,D){return L[0]=Math.round(D[0]),L[1]=Math.round(D[1]),L[2]=Math.round(D[2]),L[3]=Math.round(D[3]),L},Ze.scale=function(L,D,B){return L[0]=D[0]*B,L[1]=D[1]*B,L[2]=D[2]*B,L[3]=D[3]*B,L},Ze.scaleAndAdd=function(L,D,B,q){return L[0]=D[0]+B[0]*q,L[1]=D[1]+B[1]*q,L[2]=D[2]+B[2]*q,L[3]=D[3]+B[3]*q,L},Ze.distance=T,Ze.squaredDistance=M,Ze.length=O,Ze.squaredLength=w,Ze.negate=function(L,D){return L[0]=-D[0],L[1]=-D[1],L[2]=-D[2],L[3]=-D[3],L},Ze.inverse=function(L,D){return L[0]=1/D[0],L[1]=1/D[1],L[2]=1/D[2],L[3]=1/D[3],L},Ze.normalize=function(L,D){var B=D[0],q=D[1],Z=D[2],re=D[3],ne=B*B+q*q+Z*Z+re*re;return ne>0&&(ne=1/Math.sqrt(ne)),L[0]=B*ne,L[1]=q*ne,L[2]=Z*ne,L[3]=re*ne,L},Ze.dot=function(L,D){return L[0]*D[0]+L[1]*D[1]+L[2]*D[2]+L[3]*D[3]},Ze.cross=function(L,D,B,q){var Z=B[0]*q[1]-B[1]*q[0],re=B[0]*q[2]-B[2]*q[0],ne=B[0]*q[3]-B[3]*q[0],te=B[1]*q[2]-B[2]*q[1],le=B[1]*q[3]-B[3]*q[1],fe=B[2]*q[3]-B[3]*q[2],_e=D[0],Me=D[1],Ce=D[2],Te=D[3];return L[0]=Me*fe-Ce*le+Te*te,L[1]=-_e*fe+Ce*ne-Te*re,L[2]=_e*le-Me*ne+Te*Z,L[3]=-_e*te+Me*re-Ce*Z,L},Ze.lerp=function(L,D,B,q){var Z=D[0],re=D[1],ne=D[2],te=D[3];return L[0]=Z+q*(B[0]-Z),L[1]=re+q*(B[1]-re),L[2]=ne+q*(B[2]-ne),L[3]=te+q*(B[3]-te),L},Ze.random=function(L,D){var B,q,Z,re,ne,te;D=D||1;do ne=(B=2*o.RANDOM()-1)*B+(q=2*o.RANDOM()-1)*q;while(ne>=1);do te=(Z=2*o.RANDOM()-1)*Z+(re=2*o.RANDOM()-1)*re;while(te>=1);var le=Math.sqrt((1-ne)/te);return L[0]=D*B,L[1]=D*q,L[2]=D*Z*le,L[3]=D*re*le,L},Ze.transformMat4=function(L,D,B){var q=D[0],Z=D[1],re=D[2],ne=D[3];return L[0]=B[0]*q+B[4]*Z+B[8]*re+B[12]*ne,L[1]=B[1]*q+B[5]*Z+B[9]*re+B[13]*ne,L[2]=B[2]*q+B[6]*Z+B[10]*re+B[14]*ne,L[3]=B[3]*q+B[7]*Z+B[11]*re+B[15]*ne,L},Ze.transformQuat=function(L,D,B){var q=D[0],Z=D[1],re=D[2],ne=B[0],te=B[1],le=B[2],fe=B[3],_e=fe*q+te*re-le*Z,Me=fe*Z+le*q-ne*re,Ce=fe*re+ne*Z-te*q,Te=-ne*q-te*Z-le*re;return L[0]=_e*fe+Te*-ne+Me*-le-Ce*-te,L[1]=Me*fe+Te*-te+Ce*-ne-_e*-le,L[2]=Ce*fe+Te*-le+_e*-te-Me*-ne,L[3]=D[3],L},Ze.zero=function(L){return L[0]=0,L[1]=0,L[2]=0,L[3]=0,L},Ze.str=function(L){return"vec4("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+")"},Ze.exactEquals=function(L,D){return L[0]===D[0]&&L[1]===D[1]&&L[2]===D[2]&&L[3]===D[3]},Ze.equals=function(L,D){var B=L[0],q=L[1],Z=L[2],re=L[3],ne=D[0],te=D[1],le=D[2],fe=D[3];return Math.abs(B-ne)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(ne))&&Math.abs(q-te)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(te))&&Math.abs(Z-le)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(le))&&Math.abs(re-fe)<=o.EPSILON*Math.max(1,Math.abs(re),Math.abs(fe))},Ze.forEach=Ze.sqrLen=Ze.len=Ze.sqrDist=Ze.dist=Ze.div=Ze.mul=Ze.sub=void 0;var o=function(L,D){if(L&&L.__esModule)return L;if(L===null||h(L)!=="object"&&typeof L!="function")return{default:L};var B=l(void 0);if(B&&B.has(L))return B.get(L);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var re in L)if(re!=="default"&&Object.prototype.hasOwnProperty.call(L,re)){var ne=Z?Object.getOwnPropertyDescriptor(L,re):null;ne&&(ne.get||ne.set)?Object.defineProperty(q,re,ne):q[re]=L[re]}return q.default=L,B&&B.set(L,q),q}(z());function l(L){if(typeof WeakMap!="function")return null;var D=new WeakMap,B=new WeakMap;return(l=function(q){return q?B:D})(L)}function d(){var L=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(L[0]=0,L[1]=0,L[2]=0,L[3]=0),L}function m(L,D,B){return L[0]=D[0]-B[0],L[1]=D[1]-B[1],L[2]=D[2]-B[2],L[3]=D[3]-B[3],L}function f(L,D,B){return L[0]=D[0]*B[0],L[1]=D[1]*B[1],L[2]=D[2]*B[2],L[3]=D[3]*B[3],L}function y(L,D,B){return L[0]=D[0]/B[0],L[1]=D[1]/B[1],L[2]=D[2]/B[2],L[3]=D[3]/B[3],L}function T(L,D){return Math.hypot(D[0]-L[0],D[1]-L[1],D[2]-L[2],D[3]-L[3])}function M(L,D){var B=D[0]-L[0],q=D[1]-L[1],Z=D[2]-L[2],re=D[3]-L[3];return B*B+q*q+Z*Z+re*re}function O(L){return Math.hypot(L[0],L[1],L[2],L[3])}function w(L){var D=L[0],B=L[1],q=L[2],Z=L[3];return D*D+B*B+q*q+Z*Z}Ze.sub=m,Ze.mul=f,Ze.div=y,Ze.dist=T,Ze.sqrDist=M,Ze.len=O,Ze.sqrLen=w;var P,N=(P=d(),function(L,D,B,q,Z,re){var ne,te;for(D||(D=4),B||(B=0),te=q?Math.min(q*D+B,L.length):L.length,ne=B;ne<te;ne+=D)P[0]=L[ne],P[1]=L[ne+1],P[2]=L[ne+2],P[3]=L[ne+3],Z(P,P,re),L[ne]=P[0],L[ne+1]=P[1],L[ne+2]=P[2],L[ne+3]=P[3];return L});return Ze.forEach=N,Ze}function mt(){if(Fe)return Re;function h(Ae){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(He){return typeof He}:function(He){return He&&typeof Symbol=="function"&&He.constructor===Symbol&&He!==Symbol.prototype?"symbol":typeof He},h(Ae)}Fe=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.create=T,Re.identity=function(Ae){return Ae[0]=0,Ae[1]=0,Ae[2]=0,Ae[3]=1,Ae},Re.setAxisAngle=M,Re.getAxisAngle=function(Ae,He){var Qe=2*Math.acos(He[3]),Je=Math.sin(Qe/2);return Je>o.EPSILON?(Ae[0]=He[0]/Je,Ae[1]=He[1]/Je,Ae[2]=He[2]/Je):(Ae[0]=1,Ae[1]=0,Ae[2]=0),Qe},Re.getAngle=function(Ae,He){var Qe=B(Ae,He);return Math.acos(2*Qe*Qe-1)},Re.multiply=O,Re.rotateX=function(Ae,He,Qe){Qe*=.5;var Je=He[0],st=He[1],rt=He[2],dt=He[3],lt=Math.sin(Qe),pt=Math.cos(Qe);return Ae[0]=Je*pt+dt*lt,Ae[1]=st*pt+rt*lt,Ae[2]=rt*pt-st*lt,Ae[3]=dt*pt-Je*lt,Ae},Re.rotateY=function(Ae,He,Qe){Qe*=.5;var Je=He[0],st=He[1],rt=He[2],dt=He[3],lt=Math.sin(Qe),pt=Math.cos(Qe);return Ae[0]=Je*pt-rt*lt,Ae[1]=st*pt+dt*lt,Ae[2]=rt*pt+Je*lt,Ae[3]=dt*pt-st*lt,Ae},Re.rotateZ=function(Ae,He,Qe){Qe*=.5;var Je=He[0],st=He[1],rt=He[2],dt=He[3],lt=Math.sin(Qe),pt=Math.cos(Qe);return Ae[0]=Je*pt+st*lt,Ae[1]=st*pt-Je*lt,Ae[2]=rt*pt+dt*lt,Ae[3]=dt*pt-rt*lt,Ae},Re.calculateW=function(Ae,He){var Qe=He[0],Je=He[1],st=He[2];return Ae[0]=Qe,Ae[1]=Je,Ae[2]=st,Ae[3]=Math.sqrt(Math.abs(1-Qe*Qe-Je*Je-st*st)),Ae},Re.exp=w,Re.ln=P,Re.pow=function(Ae,He,Qe){return P(Ae,He),D(Ae,Ae,Qe),w(Ae,Ae),Ae},Re.slerp=N,Re.random=function(Ae){var He=o.RANDOM(),Qe=o.RANDOM(),Je=o.RANDOM(),st=Math.sqrt(1-He),rt=Math.sqrt(He);return Ae[0]=st*Math.sin(2*Math.PI*Qe),Ae[1]=st*Math.cos(2*Math.PI*Qe),Ae[2]=rt*Math.sin(2*Math.PI*Je),Ae[3]=rt*Math.cos(2*Math.PI*Je),Ae},Re.invert=function(Ae,He){var Qe=He[0],Je=He[1],st=He[2],rt=He[3],dt=Qe*Qe+Je*Je+st*st+rt*rt,lt=dt?1/dt:0;return Ae[0]=-Qe*lt,Ae[1]=-Je*lt,Ae[2]=-st*lt,Ae[3]=rt*lt,Ae},Re.conjugate=function(Ae,He){return Ae[0]=-He[0],Ae[1]=-He[1],Ae[2]=-He[2],Ae[3]=He[3],Ae},Re.fromMat3=L,Re.fromEuler=function(Ae,He,Qe,Je){var st=.5*Math.PI/180;He*=st,Qe*=st,Je*=st;var rt=Math.sin(He),dt=Math.cos(He),lt=Math.sin(Qe),pt=Math.cos(Qe),kt=Math.sin(Je),Nt=Math.cos(Je);return Ae[0]=rt*pt*Nt-dt*lt*kt,Ae[1]=dt*lt*Nt+rt*pt*kt,Ae[2]=dt*pt*kt-rt*lt*Nt,Ae[3]=dt*pt*Nt+rt*lt*kt,Ae},Re.str=function(Ae){return"quat("+Ae[0]+", "+Ae[1]+", "+Ae[2]+", "+Ae[3]+")"},Re.setAxes=Re.sqlerp=Re.rotationTo=Re.equals=Re.exactEquals=Re.normalize=Re.sqrLen=Re.squaredLength=Re.len=Re.length=Re.lerp=Re.dot=Re.scale=Re.mul=Re.add=Re.set=Re.copy=Re.fromValues=Re.clone=void 0;var o=y(z()),l=y(he()),d=y(at()),m=y(Ve());function f(Ae){if(typeof WeakMap!="function")return null;var He=new WeakMap,Qe=new WeakMap;return(f=function(Je){return Je?Qe:He})(Ae)}function y(Ae,He){if(Ae&&Ae.__esModule)return Ae;if(Ae===null||h(Ae)!=="object"&&typeof Ae!="function")return{default:Ae};var Qe=f(He);if(Qe&&Qe.has(Ae))return Qe.get(Ae);var Je={},st=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var rt in Ae)if(rt!=="default"&&Object.prototype.hasOwnProperty.call(Ae,rt)){var dt=st?Object.getOwnPropertyDescriptor(Ae,rt):null;dt&&(dt.get||dt.set)?Object.defineProperty(Je,rt,dt):Je[rt]=Ae[rt]}return Je.default=Ae,Qe&&Qe.set(Ae,Je),Je}function T(){var Ae=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(Ae[0]=0,Ae[1]=0,Ae[2]=0),Ae[3]=1,Ae}function M(Ae,He,Qe){Qe*=.5;var Je=Math.sin(Qe);return Ae[0]=Je*He[0],Ae[1]=Je*He[1],Ae[2]=Je*He[2],Ae[3]=Math.cos(Qe),Ae}function O(Ae,He,Qe){var Je=He[0],st=He[1],rt=He[2],dt=He[3],lt=Qe[0],pt=Qe[1],kt=Qe[2],Nt=Qe[3];return Ae[0]=Je*Nt+dt*lt+st*kt-rt*pt,Ae[1]=st*Nt+dt*pt+rt*lt-Je*kt,Ae[2]=rt*Nt+dt*kt+Je*pt-st*lt,Ae[3]=dt*Nt-Je*lt-st*pt-rt*kt,Ae}function w(Ae,He){var Qe=He[0],Je=He[1],st=He[2],rt=He[3],dt=Math.sqrt(Qe*Qe+Je*Je+st*st),lt=Math.exp(rt),pt=dt>0?lt*Math.sin(dt)/dt:0;return Ae[0]=Qe*pt,Ae[1]=Je*pt,Ae[2]=st*pt,Ae[3]=lt*Math.cos(dt),Ae}function P(Ae,He){var Qe=He[0],Je=He[1],st=He[2],rt=He[3],dt=Math.sqrt(Qe*Qe+Je*Je+st*st),lt=dt>0?Math.atan2(dt,rt)/dt:0;return Ae[0]=Qe*lt,Ae[1]=Je*lt,Ae[2]=st*lt,Ae[3]=.5*Math.log(Qe*Qe+Je*Je+st*st+rt*rt),Ae}function N(Ae,He,Qe,Je){var st,rt,dt,lt,pt,kt=He[0],Nt=He[1],hn=He[2],qt=He[3],Jt=Qe[0],Bt=Qe[1],An=Qe[2],un=Qe[3];return(rt=kt*Jt+Nt*Bt+hn*An+qt*un)<0&&(rt=-rt,Jt=-Jt,Bt=-Bt,An=-An,un=-un),1-rt>o.EPSILON?(st=Math.acos(rt),dt=Math.sin(st),lt=Math.sin((1-Je)*st)/dt,pt=Math.sin(Je*st)/dt):(lt=1-Je,pt=Je),Ae[0]=lt*kt+pt*Jt,Ae[1]=lt*Nt+pt*Bt,Ae[2]=lt*hn+pt*An,Ae[3]=lt*qt+pt*un,Ae}function L(Ae,He){var Qe,Je=He[0]+He[4]+He[8];if(Je>0)Qe=Math.sqrt(Je+1),Ae[3]=.5*Qe,Ae[0]=(He[5]-He[7])*(Qe=.5/Qe),Ae[1]=(He[6]-He[2])*Qe,Ae[2]=(He[1]-He[3])*Qe;else{var st=0;He[4]>He[0]&&(st=1),He[8]>He[3*st+st]&&(st=2);var rt=(st+1)%3,dt=(st+2)%3;Qe=Math.sqrt(He[3*st+st]-He[3*rt+rt]-He[3*dt+dt]+1),Ae[st]=.5*Qe,Ae[3]=(He[3*rt+dt]-He[3*dt+rt])*(Qe=.5/Qe),Ae[rt]=(He[3*rt+st]+He[3*st+rt])*Qe,Ae[dt]=(He[3*dt+st]+He[3*st+dt])*Qe}return Ae}Re.clone=m.clone,Re.fromValues=m.fromValues,Re.copy=m.copy,Re.set=m.set,Re.add=m.add,Re.mul=O;var D=m.scale;Re.scale=D;var B=m.dot;Re.dot=B,Re.lerp=m.lerp;var q=m.length;Re.length=q,Re.len=q;var Z=m.squaredLength;Re.squaredLength=Z,Re.sqrLen=Z;var re=m.normalize;Re.normalize=re,Re.exactEquals=m.exactEquals,Re.equals=m.equals;var ne,te,le,fe=(ne=d.create(),te=d.fromValues(1,0,0),le=d.fromValues(0,1,0),function(Ae,He,Qe){var Je=d.dot(He,Qe);return Je<-.999999?(d.cross(ne,te,He),d.len(ne)<1e-6&&d.cross(ne,le,He),d.normalize(ne,ne),M(Ae,ne,Math.PI),Ae):Je>.999999?(Ae[0]=0,Ae[1]=0,Ae[2]=0,Ae[3]=1,Ae):(d.cross(ne,He,Qe),Ae[0]=ne[0],Ae[1]=ne[1],Ae[2]=ne[2],Ae[3]=1+Je,re(Ae,Ae))});Re.rotationTo=fe;var _e,Me,Ce=(_e=T(),Me=T(),function(Ae,He,Qe,Je,st,rt){return N(_e,He,st,rt),N(Me,Qe,Je,rt),N(Ae,_e,Me,2*rt*(1-rt)),Ae});Re.sqlerp=Ce;var Te,Ge=(Te=l.create(),function(Ae,He,Qe,Je){return Te[0]=Qe[0],Te[3]=Qe[1],Te[6]=Qe[2],Te[1]=Je[0],Te[4]=Je[1],Te[7]=Je[2],Te[2]=-He[0],Te[5]=-He[1],Te[8]=-He[2],re(Ae,L(Ae,Te))});return Re.setAxes=Ge,Re}var We,tt={};function Dt(){if(We)return tt;function h(N){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},h(N)}We=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var N=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0,N[4]=0,N[5]=0,N[6]=0,N[7]=0),N[3]=1,N},tt.clone=function(N){var L=new o.ARRAY_TYPE(8);return L[0]=N[0],L[1]=N[1],L[2]=N[2],L[3]=N[3],L[4]=N[4],L[5]=N[5],L[6]=N[6],L[7]=N[7],L},tt.fromValues=function(N,L,D,B,q,Z,re,ne){var te=new o.ARRAY_TYPE(8);return te[0]=N,te[1]=L,te[2]=D,te[3]=B,te[4]=q,te[5]=Z,te[6]=re,te[7]=ne,te},tt.fromRotationTranslationValues=function(N,L,D,B,q,Z,re){var ne=new o.ARRAY_TYPE(8);ne[0]=N,ne[1]=L,ne[2]=D,ne[3]=B;var te=.5*q,le=.5*Z,fe=.5*re;return ne[4]=te*B+le*D-fe*L,ne[5]=le*B+fe*N-te*D,ne[6]=fe*B+te*L-le*N,ne[7]=-te*N-le*L-fe*D,ne},tt.fromRotationTranslation=y,tt.fromTranslation=function(N,L){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=.5*L[0],N[5]=.5*L[1],N[6]=.5*L[2],N[7]=0,N},tt.fromRotation=function(N,L){return N[0]=L[0],N[1]=L[1],N[2]=L[2],N[3]=L[3],N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},tt.fromMat4=function(N,L){var D=l.create();d.getRotation(D,L);var B=new o.ARRAY_TYPE(3);return d.getTranslation(B,L),y(N,D,B),N},tt.copy=T,tt.identity=function(N){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},tt.set=function(N,L,D,B,q,Z,re,ne,te){return N[0]=L,N[1]=D,N[2]=B,N[3]=q,N[4]=Z,N[5]=re,N[6]=ne,N[7]=te,N},tt.getDual=function(N,L){return N[0]=L[4],N[1]=L[5],N[2]=L[6],N[3]=L[7],N},tt.setDual=function(N,L){return N[4]=L[0],N[5]=L[1],N[6]=L[2],N[7]=L[3],N},tt.getTranslation=function(N,L){var D=L[4],B=L[5],q=L[6],Z=L[7],re=-L[0],ne=-L[1],te=-L[2],le=L[3];return N[0]=2*(D*le+Z*re+B*te-q*ne),N[1]=2*(B*le+Z*ne+q*re-D*te),N[2]=2*(q*le+Z*te+D*ne-B*re),N},tt.translate=function(N,L,D){var B=L[0],q=L[1],Z=L[2],re=L[3],ne=.5*D[0],te=.5*D[1],le=.5*D[2],fe=L[4],_e=L[5],Me=L[6],Ce=L[7];return N[0]=B,N[1]=q,N[2]=Z,N[3]=re,N[4]=re*ne+q*le-Z*te+fe,N[5]=re*te+Z*ne-B*le+_e,N[6]=re*le+B*te-q*ne+Me,N[7]=-B*ne-q*te-Z*le+Ce,N},tt.rotateX=function(N,L,D){var B=-L[0],q=-L[1],Z=-L[2],re=L[3],ne=L[4],te=L[5],le=L[6],fe=L[7],_e=ne*re+fe*B+te*Z-le*q,Me=te*re+fe*q+le*B-ne*Z,Ce=le*re+fe*Z+ne*q-te*B,Te=fe*re-ne*B-te*q-le*Z;return l.rotateX(N,L,D),N[4]=_e*(re=N[3])+Te*(B=N[0])+Me*(Z=N[2])-Ce*(q=N[1]),N[5]=Me*re+Te*q+Ce*B-_e*Z,N[6]=Ce*re+Te*Z+_e*q-Me*B,N[7]=Te*re-_e*B-Me*q-Ce*Z,N},tt.rotateY=function(N,L,D){var B=-L[0],q=-L[1],Z=-L[2],re=L[3],ne=L[4],te=L[5],le=L[6],fe=L[7],_e=ne*re+fe*B+te*Z-le*q,Me=te*re+fe*q+le*B-ne*Z,Ce=le*re+fe*Z+ne*q-te*B,Te=fe*re-ne*B-te*q-le*Z;return l.rotateY(N,L,D),N[4]=_e*(re=N[3])+Te*(B=N[0])+Me*(Z=N[2])-Ce*(q=N[1]),N[5]=Me*re+Te*q+Ce*B-_e*Z,N[6]=Ce*re+Te*Z+_e*q-Me*B,N[7]=Te*re-_e*B-Me*q-Ce*Z,N},tt.rotateZ=function(N,L,D){var B=-L[0],q=-L[1],Z=-L[2],re=L[3],ne=L[4],te=L[5],le=L[6],fe=L[7],_e=ne*re+fe*B+te*Z-le*q,Me=te*re+fe*q+le*B-ne*Z,Ce=le*re+fe*Z+ne*q-te*B,Te=fe*re-ne*B-te*q-le*Z;return l.rotateZ(N,L,D),N[4]=_e*(re=N[3])+Te*(B=N[0])+Me*(Z=N[2])-Ce*(q=N[1]),N[5]=Me*re+Te*q+Ce*B-_e*Z,N[6]=Ce*re+Te*Z+_e*q-Me*B,N[7]=Te*re-_e*B-Me*q-Ce*Z,N},tt.rotateByQuatAppend=function(N,L,D){var B=D[0],q=D[1],Z=D[2],re=D[3],ne=L[0],te=L[1],le=L[2],fe=L[3];return N[0]=ne*re+fe*B+te*Z-le*q,N[1]=te*re+fe*q+le*B-ne*Z,N[2]=le*re+fe*Z+ne*q-te*B,N[3]=fe*re-ne*B-te*q-le*Z,N[4]=(ne=L[4])*re+(fe=L[7])*B+(te=L[5])*Z-(le=L[6])*q,N[5]=te*re+fe*q+le*B-ne*Z,N[6]=le*re+fe*Z+ne*q-te*B,N[7]=fe*re-ne*B-te*q-le*Z,N},tt.rotateByQuatPrepend=function(N,L,D){var B=L[0],q=L[1],Z=L[2],re=L[3],ne=D[0],te=D[1],le=D[2],fe=D[3];return N[0]=B*fe+re*ne+q*le-Z*te,N[1]=q*fe+re*te+Z*ne-B*le,N[2]=Z*fe+re*le+B*te-q*ne,N[3]=re*fe-B*ne-q*te-Z*le,N[4]=B*(fe=D[7])+re*(ne=D[4])+q*(le=D[6])-Z*(te=D[5]),N[5]=q*fe+re*te+Z*ne-B*le,N[6]=Z*fe+re*le+B*te-q*ne,N[7]=re*fe-B*ne-q*te-Z*le,N},tt.rotateAroundAxis=function(N,L,D,B){if(Math.abs(B)<o.EPSILON)return T(N,L);var q=Math.hypot(D[0],D[1],D[2]);B*=.5;var Z=Math.sin(B),re=Z*D[0]/q,ne=Z*D[1]/q,te=Z*D[2]/q,le=Math.cos(B),fe=L[0],_e=L[1],Me=L[2],Ce=L[3];N[0]=fe*le+Ce*re+_e*te-Me*ne,N[1]=_e*le+Ce*ne+Me*re-fe*te,N[2]=Me*le+Ce*te+fe*ne-_e*re,N[3]=Ce*le-fe*re-_e*ne-Me*te;var Te=L[4],Ge=L[5],Ae=L[6],He=L[7];return N[4]=Te*le+He*re+Ge*te-Ae*ne,N[5]=Ge*le+He*ne+Ae*re-Te*te,N[6]=Ae*le+He*te+Te*ne-Ge*re,N[7]=He*le-Te*re-Ge*ne-Ae*te,N},tt.add=function(N,L,D){return N[0]=L[0]+D[0],N[1]=L[1]+D[1],N[2]=L[2]+D[2],N[3]=L[3]+D[3],N[4]=L[4]+D[4],N[5]=L[5]+D[5],N[6]=L[6]+D[6],N[7]=L[7]+D[7],N},tt.multiply=M,tt.scale=function(N,L,D){return N[0]=L[0]*D,N[1]=L[1]*D,N[2]=L[2]*D,N[3]=L[3]*D,N[4]=L[4]*D,N[5]=L[5]*D,N[6]=L[6]*D,N[7]=L[7]*D,N},tt.lerp=function(N,L,D,B){var q=1-B;return O(L,D)<0&&(B=-B),N[0]=L[0]*q+D[0]*B,N[1]=L[1]*q+D[1]*B,N[2]=L[2]*q+D[2]*B,N[3]=L[3]*q+D[3]*B,N[4]=L[4]*q+D[4]*B,N[5]=L[5]*q+D[5]*B,N[6]=L[6]*q+D[6]*B,N[7]=L[7]*q+D[7]*B,N},tt.invert=function(N,L){var D=P(L);return N[0]=-L[0]/D,N[1]=-L[1]/D,N[2]=-L[2]/D,N[3]=L[3]/D,N[4]=-L[4]/D,N[5]=-L[5]/D,N[6]=-L[6]/D,N[7]=L[7]/D,N},tt.conjugate=function(N,L){return N[0]=-L[0],N[1]=-L[1],N[2]=-L[2],N[3]=L[3],N[4]=-L[4],N[5]=-L[5],N[6]=-L[6],N[7]=L[7],N},tt.normalize=function(N,L){var D=P(L);if(D>0){D=Math.sqrt(D);var B=L[0]/D,q=L[1]/D,Z=L[2]/D,re=L[3]/D,ne=L[4],te=L[5],le=L[6],fe=L[7],_e=B*ne+q*te+Z*le+re*fe;N[0]=B,N[1]=q,N[2]=Z,N[3]=re,N[4]=(ne-B*_e)/D,N[5]=(te-q*_e)/D,N[6]=(le-Z*_e)/D,N[7]=(fe-re*_e)/D}return N},tt.str=function(N){return"quat2("+N[0]+", "+N[1]+", "+N[2]+", "+N[3]+", "+N[4]+", "+N[5]+", "+N[6]+", "+N[7]+")"},tt.exactEquals=function(N,L){return N[0]===L[0]&&N[1]===L[1]&&N[2]===L[2]&&N[3]===L[3]&&N[4]===L[4]&&N[5]===L[5]&&N[6]===L[6]&&N[7]===L[7]},tt.equals=function(N,L){var D=N[0],B=N[1],q=N[2],Z=N[3],re=N[4],ne=N[5],te=N[6],le=N[7],fe=L[0],_e=L[1],Me=L[2],Ce=L[3],Te=L[4],Ge=L[5],Ae=L[6],He=L[7];return Math.abs(D-fe)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(fe))&&Math.abs(B-_e)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(_e))&&Math.abs(q-Me)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(Me))&&Math.abs(Z-Ce)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ce))&&Math.abs(re-Te)<=o.EPSILON*Math.max(1,Math.abs(re),Math.abs(Te))&&Math.abs(ne-Ge)<=o.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ge))&&Math.abs(te-Ae)<=o.EPSILON*Math.max(1,Math.abs(te),Math.abs(Ae))&&Math.abs(le-He)<=o.EPSILON*Math.max(1,Math.abs(le),Math.abs(He))},tt.sqrLen=tt.squaredLength=tt.len=tt.length=tt.dot=tt.mul=tt.setReal=tt.getReal=void 0;var o=f(z()),l=f(mt()),d=f(Se());function m(N){if(typeof WeakMap!="function")return null;var L=new WeakMap,D=new WeakMap;return(m=function(B){return B?D:L})(N)}function f(N,L){if(N&&N.__esModule)return N;if(N===null||h(N)!=="object"&&typeof N!="function")return{default:N};var D=m(L);if(D&&D.has(N))return D.get(N);var B={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in N)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(N,Z)){var re=q?Object.getOwnPropertyDescriptor(N,Z):null;re&&(re.get||re.set)?Object.defineProperty(B,Z,re):B[Z]=N[Z]}return B.default=N,D&&D.set(N,B),B}function y(N,L,D){var B=.5*D[0],q=.5*D[1],Z=.5*D[2],re=L[0],ne=L[1],te=L[2],le=L[3];return N[0]=re,N[1]=ne,N[2]=te,N[3]=le,N[4]=B*le+q*te-Z*ne,N[5]=q*le+Z*re-B*te,N[6]=Z*le+B*ne-q*re,N[7]=-B*re-q*ne-Z*te,N}function T(N,L){return N[0]=L[0],N[1]=L[1],N[2]=L[2],N[3]=L[3],N[4]=L[4],N[5]=L[5],N[6]=L[6],N[7]=L[7],N}function M(N,L,D){var B=L[0],q=L[1],Z=L[2],re=L[3],ne=D[4],te=D[5],le=D[6],fe=D[7],_e=L[4],Me=L[5],Ce=L[6],Te=L[7],Ge=D[0],Ae=D[1],He=D[2],Qe=D[3];return N[0]=B*Qe+re*Ge+q*He-Z*Ae,N[1]=q*Qe+re*Ae+Z*Ge-B*He,N[2]=Z*Qe+re*He+B*Ae-q*Ge,N[3]=re*Qe-B*Ge-q*Ae-Z*He,N[4]=B*fe+re*ne+q*le-Z*te+_e*Qe+Te*Ge+Me*He-Ce*Ae,N[5]=q*fe+re*te+Z*ne-B*le+Me*Qe+Te*Ae+Ce*Ge-_e*He,N[6]=Z*fe+re*le+B*te-q*ne+Ce*Qe+Te*He+_e*Ae-Me*Ge,N[7]=re*fe-B*ne-q*te-Z*le+Te*Qe-_e*Ge-Me*Ae-Ce*He,N}tt.getReal=l.copy,tt.setReal=l.copy,tt.mul=M;var O=l.dot;tt.dot=O;var w=l.length;tt.length=w,tt.len=w;var P=l.squaredLength;return tt.squaredLength=P,tt.sqrLen=P,tt}var $e,Ke,gt={};function Yt(){if($e)return gt;function h(L){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},h(L)}$e=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=d,gt.clone=function(L){var D=new o.ARRAY_TYPE(2);return D[0]=L[0],D[1]=L[1],D},gt.fromValues=function(L,D){var B=new o.ARRAY_TYPE(2);return B[0]=L,B[1]=D,B},gt.copy=function(L,D){return L[0]=D[0],L[1]=D[1],L},gt.set=function(L,D,B){return L[0]=D,L[1]=B,L},gt.add=function(L,D,B){return L[0]=D[0]+B[0],L[1]=D[1]+B[1],L},gt.subtract=m,gt.multiply=f,gt.divide=y,gt.ceil=function(L,D){return L[0]=Math.ceil(D[0]),L[1]=Math.ceil(D[1]),L},gt.floor=function(L,D){return L[0]=Math.floor(D[0]),L[1]=Math.floor(D[1]),L},gt.min=function(L,D,B){return L[0]=Math.min(D[0],B[0]),L[1]=Math.min(D[1],B[1]),L},gt.max=function(L,D,B){return L[0]=Math.max(D[0],B[0]),L[1]=Math.max(D[1],B[1]),L},gt.round=function(L,D){return L[0]=Math.round(D[0]),L[1]=Math.round(D[1]),L},gt.scale=function(L,D,B){return L[0]=D[0]*B,L[1]=D[1]*B,L},gt.scaleAndAdd=function(L,D,B,q){return L[0]=D[0]+B[0]*q,L[1]=D[1]+B[1]*q,L},gt.distance=T,gt.squaredDistance=M,gt.length=O,gt.squaredLength=w,gt.negate=function(L,D){return L[0]=-D[0],L[1]=-D[1],L},gt.inverse=function(L,D){return L[0]=1/D[0],L[1]=1/D[1],L},gt.normalize=function(L,D){var B=D[0],q=D[1],Z=B*B+q*q;return Z>0&&(Z=1/Math.sqrt(Z)),L[0]=D[0]*Z,L[1]=D[1]*Z,L},gt.dot=function(L,D){return L[0]*D[0]+L[1]*D[1]},gt.cross=function(L,D,B){var q=D[0]*B[1]-D[1]*B[0];return L[0]=L[1]=0,L[2]=q,L},gt.lerp=function(L,D,B,q){var Z=D[0],re=D[1];return L[0]=Z+q*(B[0]-Z),L[1]=re+q*(B[1]-re),L},gt.random=function(L,D){D=D||1;var B=2*o.RANDOM()*Math.PI;return L[0]=Math.cos(B)*D,L[1]=Math.sin(B)*D,L},gt.transformMat2=function(L,D,B){var q=D[0],Z=D[1];return L[0]=B[0]*q+B[2]*Z,L[1]=B[1]*q+B[3]*Z,L},gt.transformMat2d=function(L,D,B){var q=D[0],Z=D[1];return L[0]=B[0]*q+B[2]*Z+B[4],L[1]=B[1]*q+B[3]*Z+B[5],L},gt.transformMat3=function(L,D,B){var q=D[0],Z=D[1];return L[0]=B[0]*q+B[3]*Z+B[6],L[1]=B[1]*q+B[4]*Z+B[7],L},gt.transformMat4=function(L,D,B){var q=D[0],Z=D[1];return L[0]=B[0]*q+B[4]*Z+B[12],L[1]=B[1]*q+B[5]*Z+B[13],L},gt.rotate=function(L,D,B,q){var Z=D[0]-B[0],re=D[1]-B[1],ne=Math.sin(q),te=Math.cos(q);return L[0]=Z*te-re*ne+B[0],L[1]=Z*ne+re*te+B[1],L},gt.angle=function(L,D){var B=L[0],q=L[1],Z=D[0],re=D[1],ne=Math.sqrt(B*B+q*q)*Math.sqrt(Z*Z+re*re);return Math.acos(Math.min(Math.max(ne&&(B*Z+q*re)/ne,-1),1))},gt.zero=function(L){return L[0]=0,L[1]=0,L},gt.str=function(L){return"vec2("+L[0]+", "+L[1]+")"},gt.exactEquals=function(L,D){return L[0]===D[0]&&L[1]===D[1]},gt.equals=function(L,D){var B=L[0],q=L[1],Z=D[0],re=D[1];return Math.abs(B-Z)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(Z))&&Math.abs(q-re)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(re))},gt.forEach=gt.sqrLen=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=gt.len=void 0;var o=function(L,D){if(L&&L.__esModule)return L;if(L===null||h(L)!=="object"&&typeof L!="function")return{default:L};var B=l(void 0);if(B&&B.has(L))return B.get(L);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var re in L)if(re!=="default"&&Object.prototype.hasOwnProperty.call(L,re)){var ne=Z?Object.getOwnPropertyDescriptor(L,re):null;ne&&(ne.get||ne.set)?Object.defineProperty(q,re,ne):q[re]=L[re]}return q.default=L,B&&B.set(L,q),q}(z());function l(L){if(typeof WeakMap!="function")return null;var D=new WeakMap,B=new WeakMap;return(l=function(q){return q?B:D})(L)}function d(){var L=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(L[0]=0,L[1]=0),L}function m(L,D,B){return L[0]=D[0]-B[0],L[1]=D[1]-B[1],L}function f(L,D,B){return L[0]=D[0]*B[0],L[1]=D[1]*B[1],L}function y(L,D,B){return L[0]=D[0]/B[0],L[1]=D[1]/B[1],L}function T(L,D){return Math.hypot(D[0]-L[0],D[1]-L[1])}function M(L,D){var B=D[0]-L[0],q=D[1]-L[1];return B*B+q*q}function O(L){return Math.hypot(L[0],L[1])}function w(L){var D=L[0],B=L[1];return D*D+B*B}gt.len=O,gt.sub=m,gt.mul=f,gt.div=y,gt.dist=T,gt.sqrDist=M,gt.sqrLen=w;var P,N=(P=d(),function(L,D,B,q,Z,re){var ne,te;for(D||(D=2),B||(B=0),te=q?Math.min(q*D+B,L.length):L.length,ne=B;ne<te;ne+=D)P[0]=L[ne],P[1]=L[ne+1],Z(P,P,re),L[ne]=P[0],L[ne+1]=P[1];return L});return gt.forEach=N,gt}function Kt(){if(Ke)return A;function h(L){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},h(L)}Ke=1,Object.defineProperty(A,"__esModule",{value:!0}),A.vec4=A.vec3=A.vec2=A.quat2=A.quat=A.mat4=A.mat3=A.mat2d=A.mat2=A.glMatrix=void 0;var o=N(z());A.glMatrix=o;var l=N(X());A.mat2=l;var d=N(K());A.mat2d=d;var m=N(he());A.mat3=m;var f=N(Se());A.mat4=f;var y=N(mt());A.quat=y;var T=N(Dt());A.quat2=T;var M=N(Yt());A.vec2=M;var O=N(at());A.vec3=O;var w=N(Ve());function P(L){if(typeof WeakMap!="function")return null;var D=new WeakMap,B=new WeakMap;return(P=function(q){return q?B:D})(L)}function N(L,D){if(L&&L.__esModule)return L;if(L===null||h(L)!=="object"&&typeof L!="function")return{default:L};var B=P(D);if(B&&B.has(L))return B.get(L);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var re in L)if(re!=="default"&&Object.prototype.hasOwnProperty.call(L,re)){var ne=Z?Object.getOwnPropertyDescriptor(L,re):null;ne&&(ne.get||ne.set)?Object.defineProperty(q,re,ne):q[re]=L[re]}return q.default=L,B&&B.set(L,q),q}return A.vec4=w,A}var nn,Ut,wn,Pn,we=Kt(),Rr=function(){if(Ut)return nn;function h(o,l,d,m){this.cx=3*o,this.bx=3*(d-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=d,this.p2y=m}return Ut=1,nn=h,h.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,l){if(l===void 0&&(l=1e-6),o<0)return 0;if(o>1)return 1;for(var d=o,m=0;m<8;m++){var f=this.sampleCurveX(d)-o;if(Math.abs(f)<l)return d;var y=this.sampleCurveDerivativeX(d);if(Math.abs(y)<1e-6)break;d-=f/y}var T=0,M=1;for(d=o,m=0;m<20&&(f=this.sampleCurveX(d),!(Math.abs(f-o)<l));m++)o>f?T=d:M=d,d=.5*(M-T)+T;return d},solve:function(o,l){return this.sampleCurveY(this.solveCurveX(o,l))}},nn}(),Mr=b(Rr);function yi(){if(Pn)return wn;function h(o,l){this.x=o,this.y=l}return Pn=1,wn=h,h.prototype={clone:function(){return new h(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,l){return this.clone()._rotateAround(o,l)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var l=o.x-this.x,d=o.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,l){return Math.atan2(this.x*l-this.y*o,this.x*o+this.y*l)},_matMult:function(o){var l=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=l,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var l=Math.cos(o),d=Math.sin(o),m=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=m,this},_rotateAround:function(o,l){var d=Math.cos(o),m=Math.sin(o),f=l.y+m*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-m*(this.y-l.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(o){return o instanceof h?o:Array.isArray(o)?new h(o[0],o[1]):o},wn}var Gt=b(yi());function Io(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let l=0;l<h.length;l++)if(!Io(h[l],o[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const l in h)if(!Io(h[l],o[l]))return!1;return!0}return h===o}const qi=Math.PI/180,Ji=180/Math.PI;function cr(h){return h*qi}function Yr(h){return h*Ji}const Bs=[[0,0],[1,0],[1,1],[0,1]];function Ia(h){if(h<=0)return 0;if(h>=1)return 1;const o=h*h,l=o*h;return 4*(h<.5?l:3*(h-o)+l-.75)}function so(h,o,l,d){const m=new Mr(h,o,l,d);return function(f){return m.solve(f)}}const Ma=so(.25,.1,.25,1);function er(h,o,l){return Math.min(l,Math.max(o,h))}function _s(h,o,l){return(l=er((l-h)/(o-h),0,1))*l*(3-2*l)}function Pa(h,o,l){const d=l-o,m=((h-o)%d+d)%d+o;return m===o?l:m}function Kl(h,o,l){if(!h.length)return l(null,[]);let d=h.length;const m=new Array(h.length);let f=null;h.forEach((y,T)=>{o(y,(M,O)=>{M&&(f=M),m[T]=O,--d==0&&l(f,m)})})}function Mo(h,...o){for(const l of o)for(const d in l)h[d]=l[d];return h}let Aa=1;function jo(){return Aa++}function xl(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function bl(h,o){h.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Du(h,o,l){const d={};for(const m in h)d[m]=o.call(this,h[m],m,h);return d}function Nu(h,o,l){const d={};for(const m in h)o.call(this,h[m],m,h)&&(d[m]=h[m]);return d}function js(h){return Array.isArray(h)?h.map(js):typeof h=="object"&&h?Du(h,js):h}const Jl={};function vi(h){Jl[h]||(typeof console<"u"&&console.warn(h),Jl[h]=!0)}function Hr(h,o,l){return(l.y-h.y)*(o.x-h.x)>(o.y-h.y)*(l.x-h.x)}function Vs(h){let o=0;for(let l,d,m=0,f=h.length,y=f-1;m<f;y=m++)l=h[m],d=h[y],o+=(d.x-l.x)*(l.y+d.y);return o}function ku([h,o,l]){const d=cr(o+90),m=cr(l);return{x:h*Math.cos(d)*Math.sin(m),y:h*Math.sin(d)*Math.sin(m),z:h*Math.cos(m),azimuthal:o,polar:l}}function Po(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function sa(h){const o={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,m,f)=>{const y=m||f;return o[d]=!y||y.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let yc=null;function Lr(h,o){return[h[4*o],h[4*o+1],h[4*o+2],h[4*o+3]]}function fo(h,o,l,d){for(;o<l;){const m=o+l>>1;h[m]<d?o=m+1:l=m}return o}function Ao(h,o,l,d){for(;o<l;){const m=o+l>>1;h[m]<=d?o=m+1:l=m}return o}function Xo(h){return h>0?1/(1.001-h):1+h}function wt(h){return h>0?1-1/(1.001-h):-h}const ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ge.API_URL)return null;try{const h=new URL(ge.API_URL);return h.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":h.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function be(h){return ge.API_URL_REGEX.test(h)}function ke(h){return ge.API_SPRITE_REGEX.test(h)}let qe,Xe,et,_t,it,bt;function Ct(){return qe==null&&(qe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),qe}const Et={now:()=>_t!==void 0?_t:performance.now(),setNow(h){_t=h},restoreNow(){_t=void 0},frame(h){const o=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(h,o=0){const{width:l,height:d}=h;it||(it=document.createElement("canvas"));const m=it.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>it.width||d>it.height)&&(it.width=l,it.height=d),m.clearRect(-o,-o,l+2*o,d+2*o),m.drawImage(h,0,0,l,d),m.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:h=>(Xe||(Xe=document.createElement("a")),Xe.href=h,Xe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(et==null&&(et=window.matchMedia("(prefers-reduced-motion: reduce)")),et.matches)},hasCanvasFingerprintNoise(){if(bt!==void 0)return bt;if(!Ct())return bt=!1,!1;const h=new OffscreenCanvas(85,1),o=h.getContext("2d",{willReadFrequently:!0});let l=0;for(let m=0;m<h.width;++m)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(m,0,1,1);const d=o.getImageData(0,0,h.width,h.height);l=0;for(let m=0;m<d.data.length;++m)if(m%4!=3&&l++!==d.data[m])return bt=!0,!0;return bt=!1,!1}};function Wt(h,o){const l=h.indexOf("?");if(l<0)return`${h}?${new URLSearchParams(o).toString()}`;const d=new URLSearchParams(h.slice(l));for(const m in o)d.set(m,o[m]);return`${h.slice(0,l)}?${d.toString()}`}function sn(h,o={persistentParams:[]}){const l=h.indexOf("?");if(l<0)return h;const d=new URLSearchParams,m=new URLSearchParams(h.slice(l));for(const y of o.persistentParams){const T=m.get(y);T&&d.set(y,T)}const f=d.toString();return`${h.slice(0,l)}${f.length>0?`?${f}`:""}`}const cn="mapbox-tiles";let Gn=500,Zn=50;const Wn=["language","worldview","jobid"];let Jn,ai;function Ai(){try{return caches}catch{}}function mr(){const h=Ai();h&&Jn==null&&(Jn=h.open(cn))}let Zr=1/0;const Yn={supported:!1,testSupport:function(h){!Vo&&Vi&&(Zo?Es(h):Kr=h)}};let Kr,Vi,Vo=!1,Zo=!1;const wl=typeof self<"u"?self:{};function Es(h){const o=h.createTexture();h.bindTexture(h.TEXTURE_2D,o);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Vi),h.isContextLost())return;Yn.supported=!0}catch{}h.deleteTexture(o),Vo=!0}wl.document&&(Vi=wl.document.createElement("img"),Vi.onload=function(){Kr&&Es(Kr),Kr=null,Zo=!0},Vi.onerror=function(){Vo=!0,Kr=null},Vi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(mo);class Ui extends Error{constructor(o,l,d){l===401&&be(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cf=Po()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ro=function(h,o){if(!(/^file:/.test(l=h.url)||/^file:/.test(Cf())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,m){const f=new AbortController,y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Cf(),referrerPolicy:d.referrerPolicy,signal:f.signal});let T=!1,M=!1;const O=(w=y.url).indexOf("sku=")>0&&be(w);var w;d.type==="json"&&y.headers.set("Accept","application/json");const P=(L,D,B)=>{if(M)return;if(L&&L.message!=="SecurityError"&&vi(L.toString()),D&&B)return N(D);const q=Date.now();fetch(y).then(Z=>{if(Z.ok){const re=O?Z.clone():null;return N(Z,re,q)}return m(new Ui(Z.statusText,Z.status,d.url))}).catch(Z=>{Z.name!=="AbortError"&&m(new Error(`${Z.message} ${d.url}`))})},N=(L,D,B)=>{(d.type==="arrayBuffer"?L.arrayBuffer():d.type==="json"?L.json():L.text()).then(q=>{M||(D&&B&&function(Z,re,ne){if(mr(),Jn==null)return;const te=sa(re.headers.get("Cache-Control")||"");if(te["no-store"])return;const le={status:re.status,statusText:re.statusText,headers:new Headers};re.headers.forEach((Me,Ce)=>le.headers.set(Ce,Me)),te["max-age"]&&le.headers.set("Expires",new Date(ne+1e3*te["max-age"]).toUTCString());const fe=le.headers.get("Expires");if(!fe||new Date(fe).getTime()-ne<42e4)return;let _e=sn(Z.url,{persistentParams:Wn});if(re.status===206){const Me=Z.headers.get("Range");if(!Me)return;le.status=200,_e=Wt(_e,{range:Me})}(function(Me,Ce){if(ai===void 0)try{new Response(new ReadableStream),ai=!0}catch{ai=!1}ai?Ce(Me.body):Me.blob().then(Ce)})(re,Me=>{const Ce=new Response((Te=re.status)!==200&&Te!==404&&[101,103,204,205,304].includes(Te)?null:Me,le);var Te;mr(),Jn!=null&&Jn.then(Ge=>Ge.put(_e,Ce)).catch(Ge=>vi(Ge.message))})}(y,D,B),T=!0,m(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{M||m(new Error(q.message))})};return O?function(L,D){if(mr(),Jn==null)return D(null);Jn.then(B=>{let q=sn(L.url,{persistentParams:Wn});const Z=L.headers.get("Range");Z&&(q=Wt(q,{range:Z})),B.match(q).then(re=>{const ne=function(te){if(!te)return!1;const le=new Date(te.headers.get("Expires")||0),fe=sa(te.headers.get("Cache-Control")||"");return le>Date.now()&&!fe["no-cache"]}(re);B.delete(q),ne&&B.put(q,re.clone()),D(null,re,ne)}).catch(D)}).catch(D)}(y,P):P(null,null),{cancel:()=>{M=!0,T||f.abort()}}}(h,o);if(Po()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,o,void 0,!0)}var l;return function(d,m){const f=new XMLHttpRequest;f.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const y in d.headers)f.setRequestHeader(y,d.headers[y]);return d.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=d.credentials==="include",f.onerror=()=>{m(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let y=f.response;if(d.type==="json")try{y=JSON.parse(f.response)}catch(T){return m(T)}m(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else m(new Ui(f.statusText,f.status,d.url))},f.send(d.body),{cancel:()=>f.abort()}}(h,o)},Fu=function(h,o){return Ro(Mo(h,{type:"arrayBuffer"}),o)};function X_(h){const o=document.createElement("a");return o.href=h,o.protocol===location.protocol&&o.host===location.host}const dg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sh,vc;sh=[],vc=0;const gd=function(h,o){if(Yn.supported&&(h.headers||(h.headers={}),h.headers.accept="image/webp,*/*"),vc>=ge.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:h,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return sh.push(f),f}vc++;let l=!1;const d=()=>{if(!l)for(l=!0,vc--;sh.length&&vc<ge.MAX_PARALLEL_IMAGE_REQUESTS;){const f=sh.shift(),{requestParameters:y,callback:T,cancelled:M}=f;M||(f.cancel=gd(y,T).cancel)}},m=Fu(h,(f,y,T,M)=>{d(),f?o(f):y&&(self.createImageBitmap?function(O,w){const P=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(P).then(N=>{w(null,N)}).catch(N=>{w(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(O,w)=>o(O,w,T,M)):function(O,w){const P=new Image;P.onload=()=>{w(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=dg})},P.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(O)],{type:"image/png"});P.src=O.byteLength?URL.createObjectURL(N):dg}(y,(O,w)=>o(O,w,T,M)))});return{cancel:()=>{m.cancel(),d()}}};var $p,yv,Z_,ah={exports:{}},Ra={exports:{}},Qa={exports:{}},Sl=function(){if(Z_)return ah.exports;Z_=1;var h=($p||($p=1,Ra.exports=function(l,d){var m,f,y,T,M,O,w,P;for(f=l.length-(m=3&l.length),y=d,M=3432918353,O=461845907,P=0;P<f;)w=255&l.charCodeAt(P)|(255&l.charCodeAt(++P))<<8|(255&l.charCodeAt(++P))<<16|(255&l.charCodeAt(++P))<<24,++P,y=27492+(65535&(T=5*(65535&(y=(y^=w=(65535&(w=(w=(65535&w)*M+(((w>>>16)*M&65535)<<16)&4294967295)<<15|w>>>17))*O+(((w>>>16)*O&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(w=0,m){case 3:w^=(255&l.charCodeAt(P+2))<<16;case 2:w^=(255&l.charCodeAt(P+1))<<8;case 1:y^=w=(65535&(w=(w=(65535&(w^=255&l.charCodeAt(P)))*M+(((w>>>16)*M&65535)<<16)&4294967295)<<15|w>>>17))*O+(((w>>>16)*O&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Ra.exports),o=(yv||(yv=1,Qa.exports=function(l,d){for(var m,f=l.length,y=d^f,T=0;f>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(T)|(255&l.charCodeAt(++T))<<8|(255&l.charCodeAt(++T))<<16|(255&l.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),f-=4,++T;switch(f){case 3:y^=(255&l.charCodeAt(T+2))<<16;case 2:y^=(255&l.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Qa.exports);return ah.exports=h,ah.exports.murmur3=h,ah.exports.murmur2=o,ah.exports}(),el=b(Sl);class Us{constructor(o,...l){Mo(this,l[0]||{}),this.type=o}}class mi extends Us{constructor(o,l={}){super("error",Mo({error:o},l))}}function fg(h,o,l){l[h]&&l[h].indexOf(o)!==-1||(l[h]=l[h]||[],l[h].push(o))}function qp(h,o,l){if(l&&l[h]){const d=l[h].indexOf(o);d!==-1&&l[h].splice(d,1)}}class tl{on(o,l){return this._listeners=this._listeners||{},fg(o,l,this._listeners),this}off(o,l){return qp(o,l,this._listeners),qp(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},fg(o,l,this._oneTimeListeners),this):new Promise(d=>{this.once(o,d)})}fire(o,l){const d=typeof o=="string"?new Us(o,l):o,m=d.type;if(this.listens(m)){d.target=this;const f=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of f)M.call(this,d);const y=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of y)qp(m,M,this._oneTimeListeners),M.call(this,d);const T=this._eventedParent;T&&(Mo(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(d))}else d instanceof mi&&console.error(d.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}class Gs{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new Gs(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[l,d]=o.split("");return new Gs({name:l,iconsetId:d})}static isEqual(o,l){return o.name===l.name&&o.iconsetId===l.iconsetId}toString(){return Gs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Y_,pg={},La=function(){if(Y_)return pg;Y_=1;var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return o(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function d(f){return(y=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:y>1?1:y;var y}function m(f,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?f+(y-f)*T*6:2*T<1?y:3*T<2?f+(y-f)*(2/3-T)*6:f}try{pg.parseCSSColor=function(f){var y,T=f.replace(/ /g,"").toLowerCase();if(T in h)return h[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var M=T.indexOf("("),O=T.indexOf(")");if(M!==-1&&O+1===T.length){var w=T.substr(0,M),P=T.substr(M+1,O-(M+1)).split(","),N=1;switch(w){case"rgba":if(P.length!==4)return null;N=d(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),N];case"hsla":if(P.length!==4)return null;N=d(P.pop());case"hsl":if(P.length!==3)return null;var L=(parseFloat(P[0])%360+360)%360/360,D=d(P[1]),B=d(P[2]),q=B<=.5?B*(D+1):B+D-B*D,Z=2*B-q;return[o(255*m(Z,q,L+1/3)),o(255*m(Z,q,L)),o(255*m(Z,q,L-1/3)),N];default:return null}}return null}}catch{}return pg}();class Fr{constructor(o,l,d,m=1){this.r=o,this.g=l,this.b=d,this.a=m}static parse(o){if(!o)return;if(o instanceof Fr)return o;if(typeof o!="string")return;const l=La.parseCSSColor(o);return l?new Fr(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toStringPremultipliedAlpha(){const[o,l,d,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${m})`}toString(){const[o,l,d,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*l)},${Math.round(255*d)},${m})`}toRenderColor(o){const{r:l,g:d,b:m,a:f}=this;return new zu(o,l,d,m,f)}clone(){return new Fr(this.r,this.g,this.b,this.a)}}class zu{constructor(o,l,d,m,f){if(o){const y=o.image.height,T=y*y;l=f===0?0:l/f*(y-1),d=f===0?0:d/f*(y-1),m=f===0?0:m/f*(y-1);const M=Math.floor(l),O=Math.floor(d),w=Math.floor(m),P=Math.ceil(l),N=Math.ceil(d),L=Math.ceil(m),D=l-M,B=d-O,q=m-w,Z=o.image.data,re=4*(M+O*T+w*y),ne=4*(M+O*T+L*y),te=4*(M+N*T+w*y),le=4*(M+N*T+L*y),fe=4*(P+O*T+w*y),_e=4*(P+O*T+L*y),Me=4*(P+N*T+w*y),Ce=4*(P+N*T+L*y);if(re<0||Ce>=Z.length)throw new Error("out of range");this.r=Sn(Sn(Sn(Z[re],Z[ne],q),Sn(Z[te],Z[le],q),B),Sn(Sn(Z[fe],Z[_e],q),Sn(Z[Me],Z[Ce],q),B),D)/255*f,this.g=Sn(Sn(Sn(Z[re+1],Z[ne+1],q),Sn(Z[te+1],Z[le+1],q),B),Sn(Sn(Z[fe+1],Z[_e+1],q),Sn(Z[Me+1],Z[Ce+1],q),B),D)/255*f,this.b=Sn(Sn(Sn(Z[re+2],Z[ne+2],q),Sn(Z[te+2],Z[le+2],q),B),Sn(Sn(Z[fe+2],Z[_e+2],q),Sn(Z[Me+2],Z[Ce+2],q),B),D)/255*f,this.a=f}else this.r=l,this.g=d,this.b=m,this.a=f}toArray(){const{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[255*o/m,255*l/m,255*d/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:o,g:l,b:d,a:m}=this,f=Math.min(Math.max(o/m,0),1),y=Math.min(Math.max(l/m,0),1),T=Math.min(Math.max(d/m,0),1),M=Math.min(f,y,T),O=Math.max(f,y,T),w=(M+O)/2;if(M===O)return[0,0,100*w,m];const P=O-M,N=w>.5?P/(2-O-M):P/(O+M);let L=0;return O===f?L=(y-T)/P+(y<T?6:0):O===y?L=(T-f)/P+2:O===T&&(L=(f-y)/P+4),L*=60,[Math.min(Math.max(L,0),360),Math.min(Math.max(100*N,0),100),Math.min(Math.max(100*w,0),100),m]}toArray01(){const{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[o/m,l/m,d/m,m]}toArray01Scaled(o){const{r:l,g:d,b:m,a:f}=this;return f===0?[0,0,0]:[l/f*o,d/f*o,m/f*o]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:d,a:m}=this;return[o,l,d,m]}toArray01Linear(){const{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(o/m,2.2),Math.pow(l/m,2.2),Math.pow(d/m,2.2),m]}}function Sn(h,o,l){return h*(1-l)+o*l}function xc(h,o,l){return h.map((d,m)=>Sn(d,o[m],l))}function Tf(h){return h*h*h*h*h}Fr.black=new Fr(0,0,0,1),Fr.white=new Fr(1,1,1,1),Fr.transparent=new Fr(0,0,0,0),Fr.red=new Fr(1,0,0,1),Fr.blue=new Fr(0,0,1,1);var bc=Object.freeze({__proto__:null,array:xc,color:function(h,o,l){return new Fr(Sn(h.r,o.r,l),Sn(h.g,o.g,l),Sn(h.b,o.b,l),Sn(h.a,o.a,l))},easeIn:Tf,number:Sn});function fr(h,...o){for(const l of o)for(const d in l)h[d]=l[d];return h}class El extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class Hp{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[d,m]of l)this.bindings[d]=m}concat(o){return new Hp(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Bu={kind:"null"},gn={kind:"number"},Gr={kind:"string"},Er={kind:"boolean"},ys={kind:"color"},If={kind:"object"},Cr={kind:"value"},nl={kind:"collator"},ju={kind:"formatted"},Cl={kind:"resolvedImage"};function vs(h,o){return{kind:"array",itemType:h,N:o}}function Qi(h){if(h.kind==="array"){const o=Qi(h.itemType);return typeof h.N=="number"?`array<${o}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${o}>`}return h.kind}const rl=[Bu,gn,Gr,Er,ys,ju,If,vs(Cr),Cl];function wc(h,o){if(o.kind==="error")return null;if(h.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!wc(h.itemType,o.itemType))&&(typeof h.N!="number"||h.N===o.N))return null}else{if(h.kind===o.kind)return null;if(h.kind==="value"){for(const l of rl)if(!wc(l,o))return null}}return`Expected ${Qi(h)} but found ${Qi(o)} instead.`}function Wp(h,o){return o.some(l=>l.kind===h.kind)}function _d(h,o){return o.some(l=>l==="null"?h===null:l==="array"?Array.isArray(h):l==="object"?h&&!Array.isArray(h)&&typeof h=="object":l===typeof h)}class Ql{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yd{constructor(o,l,d,m,f){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=m,this.textColor=f}}class Yo{constructor(o){this.sections=o}static fromString(o){return new Yo([new yd(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Yo?o:Yo.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){const m=l.image.getPrimary().id.toString();o.push(["image",m]);continue}o.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(d)}return o}}class eu{constructor(o,l={}){if(this.id=Gs.from(o),this.options=Object.assign({},l),l.transform){const{a:d,b:m,c:f,d:y,e:T,f:M}=l.transform;this.options.transform=new DOMMatrix([d,m,f,y,T,M])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:o,b:l,c:d,d:m,e:f,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:o,b:l,c:d,d:m,e:f,f:y}})}static parse(o){let l,d,m,f;try{({name:l,iconsetId:d,params:m,transform:f}=JSON.parse(o)||{})}catch{return null}if(!l)return null;const{a:y,b:T,c:M,d:O,e:w,f:P}=f||{};return new eu({name:l,iconsetId:d},{params:m,transform:new DOMMatrix([y,T,M,O,w,P])})}scaleSelf(o){return this.options.transform.scaleSelf(o),this}}class Ko{constructor(o,l,d,m,f=!1){this.primaryId=Gs.from(o),this.primaryOptions=l,d&&(this.secondaryId=Gs.from(d)),this.secondaryOptions=m,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new eu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new eu(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?Ko.build({name:o}):o}static build(o,l,d,m){return!o||typeof o=="object"&&!("name"in o)?null:new Ko(o,d,l,m)}}function lh(h,o,l,d){return typeof h=="number"&&h>=0&&h<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[h,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[h,o,l,d]:[h,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tl(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Fr||h instanceof Ql||h instanceof Yo||h instanceof Ko)return!0;if(Array.isArray(h)){for(const o of h)if(!Tl(o))return!1;return!0}if(typeof h=="object"){for(const o in h)if(!Tl(h[o]))return!1;return!0}return!1}function di(h){if(h===null)return Bu;if(typeof h=="string")return Gr;if(typeof h=="boolean")return Er;if(typeof h=="number")return gn;if(h instanceof Fr)return ys;if(h instanceof Ql)return nl;if(h instanceof Yo)return ju;if(h instanceof Ko)return Cl;if(Array.isArray(h)){const o=h.length;let l;for(const d of h){const m=di(d);if(l){if(l===m)continue;l=Cr;break}l=m}return vs(l||Cr,o)}return If}function ao(h){const o=typeof h;return h===null?"":o==="string"||o==="number"||o==="boolean"?String(h):h instanceof Fr?h.toStringPremultipliedAlpha():h instanceof Yo||h instanceof Ko?h.toString():JSON.stringify(h)}class tu{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(o.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Tl(o[1]))return l.error("invalid value");const d=o[1];let m=di(d);const f=l.expectedType;return m.kind!=="array"||m.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(m=f),new tu(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Yo?this.value.serialize():this.value}}class Fi{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const K_={string:Gr,number:gn,boolean:Er,object:If};class aa{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,m=1;const f=o[0];if(f==="array"){let T,M;if(o.length>2){const O=o[1];if(typeof O!="string"||!(O in K_)||O==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=K_[O],m++}else T=Cr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=o[2],m++}d=vs(T,M)}else d=K_[f];const y=[];for(;m<o.length;m++){const T=l.parse(o[m],m,Cr);if(!T)return null;y.push(T)}return new aa(d,y)}evaluate(o){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(o);if(!wc(this.type,di(d)))return d;if(l===this.args.length-1)throw new Fi(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Qi(di(d))} but was expected to be of type ${Qi(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if(o.kind==="array"){const d=o.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){l.push(d.kind);const m=o.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(d=>d.serialize()))}}class uh{constructor(o){this.type=ju,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const m=[];let f=!1;for(let y=1;y<=o.length-1;++y){const T=o[y];if(f&&typeof T=="object"&&!Array.isArray(T)){f=!1;let M=null;if(T["font-scale"]&&(M=l.parseObjectValue(T["font-scale"],y,"font-scale",gn),!M))return null;let O=null;if(T["text-font"]&&(O=l.parseObjectValue(T["text-font"],y,"text-font",vs(Gr)),!O))return null;let w=null;if(T["text-color"]&&(w=l.parseObjectValue(T["text-color"],y,"text-color",ys),!w))return null;const P=m[m.length-1];P.scale=M,P.font=O,P.textColor=w}else{const M=l.parse(o[y],y,Cr);if(!M)return null;const O=M.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new uh(m)}evaluate(o){return new Yo(this.sections.map(l=>{const d=l.content.evaluate(o);return di(d)===Cl?new yd("",d,null,null,null):new yd(ao(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class Il{constructor(o,l,d,m){this._imageWarnHistory={},this.type=Cl,this.namePrimary=o,this.nameSecondary=l,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");let d=1;const m=[];function f(){if(d<o.length){const T=l.parse(o[d],d++,Gr);return T?(m.push({image:T,options:{}}),!0):(l.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(d<o.length){const M=o[d];if((T=M)===null||typeof T!="object"||Array.isArray(T))return!0;const O=M.params,w=M.iconset,P=l.concat(d);if(!O&&!w)return d++,!0;if(O){if(typeof O!="object"||O.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const N={},L=P.concat(void 0,"params");for(const D in O){if(!D)return L.error("Image parameter name should be non-empty"),!1;const B=L.concat(void 0,D).parse(O[D],void 0,ys,void 0,{typeAnnotation:"coerce"});if(!B)return!1;N[D]=B}m[m.length-1].options.params=N}if(w){if(typeof w!="object"||w.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!w.id)return P.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=w}return d++,!0}var T;return!0}for(let T=0;T<2;T++)if(!f()||!y())return;return new Il(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(o,l){const d={};if(l){for(const m in l)if(l[m])try{d[m]=l[m].evaluate(o)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(o){const l={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,m=Ko.build(l,d,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(m&&o.availableImages){const f=m.getPrimary().id;if(m.available=o.availableImages.some(y=>Gs.isEqual(y,f)),m.available){const y=m.getSecondary()?m.getSecondary().id:null;y&&(m.available=o.availableImages.some(T=>Gs.isEqual(T,y)))}}return m}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&o(this.paramsPrimary[l]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&o(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(o,l){const d={};if(l&&(d.iconset={id:l}),o){d.params={};for(const m in o)o[m]&&(d.params[m]=o[m].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&o.push(l)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&o.push(l)}return o}}function Ml(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}const vv={"to-boolean":Er,"to-color":ys,"to-number":gn,"to-string":Gr};class Sc{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[0],m=[];let f=Bu;if(d==="to-array"){if(!Array.isArray(o[1]))return null;const y=o[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);f=vs(l.expectedType.itemType,y)}else{if(!(y>0&&Tl(o[1][0])))return null;f=vs(di(o[1][0]),y)}for(let T=0;T<y;T++){const M=o[1][T];let O;if(Ml(M)==="array")O=l.parse(M,void 0,f.itemType);else{const w=Ml(M);if(w!==f.itemType.kind)return l.error(`Expected ${f.itemType.kind} but found ${w}.`);O=l.registry.literal.parse(["literal",M===void 0?null:M],l)}if(!O)return null;m.push(O)}}else{if((d==="to-boolean"||d==="to-string")&&o.length!==2)return l.error("Expected one argument.");f=vv[d];for(let y=1;y<o.length;y++){const T=l.parse(o[y],y,Cr);if(!T)return null;m.push(T)}}return new Sc(f,m)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let l,d;for(const m of this.args){if(l=m.evaluate(o),d=null,l instanceof Fr)return l;if(typeof l=="string"){const f=o.parseColor(l);if(f)return f}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:lh(l[0],l[1],l[2],l[3]),!d))return new Fr(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Fi(d||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const d of this.args){if(l=d.evaluate(o),l===null)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Fi(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Yo.fromString(ao(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ko.build(ao(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(l=>l.evaluate(o)):ao(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new uh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Il(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Px=["Unknown","Point","LineString","Polygon"];class mg{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Px[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:d,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*l-o[0])+this.featureDistanceData.bearing[1]*(m*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=Fr.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class xs{constructor(o,l,d,m,f){this.name=o,this.type=l,this._evaluate=d,this.args=m,this._overloadIndex=f}evaluate(o){if(!this._evaluate){const l=xs.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const d=o[0],m=xs.definitions[d];if(!m)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(m)?m[0]:m.type,y=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=[];let M=null,O=-1;for(const[w,P]of y){if(Array.isArray(w)&&w.length!==o.length-1)continue;T.push(w),O++,M=new Cg(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const N=[];let L=!1;for(let D=1;D<o.length;D++){const B=o[D],q=Array.isArray(w)?w[D-1]:w.type,Z=M.parse(B,1+N.length,q);if(!Z){L=!0;break}N.push(Z)}if(!L)if(Array.isArray(w)&&w.length!==N.length)M.error(`Expected ${w.length} arguments, but found ${N.length} instead.`);else{for(let D=0;D<N.length;D++){const B=Array.isArray(w)?w[D]:w.type,q=N[D];M.concat(D+1).checkSubtype(B,q.type)}if(M.errors.length===0)return new xs(d,f,P,N,O)}}if(T.length===1)l.errors.push(...M.errors);else{const w=(T.length?T:y.map(([N])=>N)).map(Ax).join(" | "),P=[];for(let N=1;N<o.length;N++){const L=l.parse(o[N],1+P.length);if(!L)return null;P.push(Qi(L.type))}l.error(`Expected arguments of type ${w}, but found (${P.join(", ")}) instead.`)}return null}static register(o,l){xs.definitions=l;for(const d in l)o[d]=xs}}function Ax(h){return Array.isArray(h)?`(${h.map(Qi).join(", ")})`:`(${Qi(h.type)}...)`}class vd{constructor(o,l,d){this.type=nl,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(o.length!==2)return l.error("Expected one argument.");const d=o[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const m=d["case-sensitive"]===void 0?l.parse(!1,1,Er):l.parseObjectValue(d["case-sensitive"],1,"case-sensitive",Er);if(!m)return null;const f=d["diacritic-sensitive"]===void 0?l.parse(!1,1,Er):l.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",Er);if(!f)return null;let y=null;return d.locale&&(y=l.parseObjectValue(d.locale,1,"locale",Gr),!y)?null:new vd(m,f,y)}evaluate(o){return new Ql(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function xv(h,o,l=0,d=h.length-1,m=Rx){for(;d>l;){if(d-l>600){const M=d-l+1,O=o-l+1,w=Math.log(M),P=.5*Math.exp(2*w/3),N=.5*Math.sqrt(w*P*(M-P)/M)*(O-M/2<0?-1:1);xv(h,o,Math.max(l,Math.floor(o-O*P/M+N)),Math.min(d,Math.floor(o+(M-O)*P/M+N)),m)}const f=h[o];let y=l,T=d;for(Xp(h,l,o),m(h[d],f)>0&&Xp(h,l,d);y<T;){for(Xp(h,y,T),y++,T--;m(h[y],f)<0;)y++;for(;m(h[T],f)>0;)T--}m(h[l],f)===0?Xp(h,l,T):(T++,Xp(h,T,d)),T<=o&&(l=T+1),o<=T&&(d=T-1)}}function Xp(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}function Rx(h,o){return h<o?-1:h>o?1:0}function bv(h){let o=0;for(let l,d,m=0,f=h.length,y=f-1;m<f;y=m++)l=h[m],d=h[y],o+=(d.x-l.x)*(l.y+d.y);return o}function Zp(h,o){h[0]=Math.min(h[0],o[0]),h[1]=Math.min(h[1],o[1]),h[2]=Math.max(h[2],o[0]),h[3]=Math.max(h[3],o[1])}function Yp(h,o){return!(h[0]<=o[0]||h[2]>=o[2]||h[1]<=o[1]||h[3]>=o[3])}function Lx(h,o,l){const d=h[0]-o[0],m=h[1]-o[1],f=h[0]-l[0],y=h[1]-l[1];return d*y-f*m==0&&d*f<=0&&m*y<=0}function xd(h,o,l=!1){let d=!1;for(let T=0,M=o.length;T<M;T++){const O=o[T];for(let w=0,P=O.length,N=P-1;w<P;N=w++){const L=O[N],D=O[w];if(Lx(h,L,D))return l;(f=L)[1]>(m=h)[1]!=(y=D)[1]>m[1]&&m[0]<(y[0]-f[0])*(m[1]-f[1])/(y[1]-f[1])+f[0]&&(d=!d)}}var m,f,y;return d}function Ec(h,o,l,d){const m=d[0]-l[0],f=d[1]-l[1],y=(h[0]-l[0])*f-m*(h[1]-l[1]),T=(o[0]-l[0])*f-m*(o[1]-l[1]);return y>0&&T<0||y<0&&T>0}function gg(h,o,l,d){return(m=[d[0]-l[0],d[1]-l[1]])[0]*(f=[o[0]-h[0],o[1]-h[1]])[1]-m[1]*f[0]!=0&&!(!Ec(h,o,l,d)||!Ec(l,d,h,o));var m,f}const ch=8192;function J_(h,o){const l=(180+h[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(l*m*ch),Math.round(d*m*ch)]}function wv(h,o){for(let l=0;l<o.length;l++)if(xd(h,o[l]))return!0;return!1}function Ox(h,o,l){for(const d of l)for(let m=0,f=d.length,y=f-1;m<f;y=m++)if(gg(h,o,d[y],d[m]))return!0;return!1}function Sv(h,o){for(let l=0;l<h.length;++l)if(!xd(h[l],o))return!1;for(let l=0;l<h.length-1;++l)if(Ox(h[l],h[l+1],o))return!1;return!0}function Dx(h,o){for(let l=0;l<o.length;l++)if(Sv(h,o[l]))return!0;return!1}function hh(h,o,l){const d=[];for(let m=0;m<h.length;m++){const f=[];for(let y=0;y<h[m].length;y++){const T=J_(h[m][y],l);Zp(o,T),f.push(T)}d.push(f)}return d}function pr(h,o,l){const d=[];for(let m=0;m<h.length;m++){const f=hh(h[m],o,l);d.push(f)}return d}function En(h,o,l,d){if(h[0]<l[0]||h[0]>l[2]){const m=.5*d;let f=h[0]-l[0]>m?-d:l[0]-h[0]>m?d:0;f===0&&(f=h[0]-l[2]>m?-d:l[2]-h[0]>m?d:0),h[0]+=f}Zp(o,h)}function _g(h,o,l,d){const m=Math.pow(2,d.z)*ch,f=[d.x*ch,d.y*ch],y=[];if(!h)return y;for(const T of h)for(const M of T){const O=[M.x+f[0],M.y+f[1]];En(O,o,l,m),y.push(O)}return y}function Vn(h,o,l,d){const m=Math.pow(2,d.z)*ch,f=[d.x*ch,d.y*ch],y=[];if(!h)return y;for(const M of h){const O=[];for(const w of M){const P=[w.x+f[0],w.y+f[1]];Zp(o,P),O.push(P)}y.push(O)}if(o[2]-o[0]<=m/2){(T=o)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const M of y)for(const O of M)En(O,o,l,m)}var T;return y}class il{constructor(o,l){this.type=Er,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Tl(o[1])){const d=o[1];if(d.type==="FeatureCollection")for(let m=0;m<d.features.length;++m){const f=d.features[m].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new il(d,d.features[m].geometry)}else if(d.type==="Feature"){const m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new il(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new il(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(l,d){const m=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=hh(d.coordinates,f,y),M=_g(l.geometry(),m,f,y);if(!Yp(m,f))return!1;for(const O of M)if(!xd(O,T))return!1}if(d.type==="MultiPolygon"){const T=pr(d.coordinates,f,y),M=_g(l.geometry(),m,f,y);if(!Yp(m,f))return!1;for(const O of M)if(!wv(O,T))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(l,d){const m=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=hh(d.coordinates,f,y),M=Vn(l.geometry(),m,f,y);if(!Yp(m,f))return!1;for(const O of M)if(!Sv(O,T))return!1}if(d.type==="MultiPolygon"){const T=pr(d.coordinates,f,y),M=Vn(l.geometry(),m,f,y);if(!Yp(m,f))return!1;for(const O of M)if(!Dx(O,T))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Mf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Fn=1/298.257223563,yg=Fn*(2-Fn),dh=Math.PI/180;class bd{static fromTile(o,l,d){const m=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),f=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/dh;return new bd(f,d)}static get units(){return Mf}constructor(o,l){if(o===void 0)throw new Error("No latitude given.");if(l&&!Mf[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Mf).join(", ")}`);const d=6378.137*dh*(l?Mf[l]:1),m=Math.cos(o*dh),f=1/(1-yg*(1-m*m)),y=Math.sqrt(f);this.kx=d*y*m,this.ky=d*y*f*(1-yg)}distance(o,l){const d=Hi(o[0]-l[0])*this.kx,m=(o[1]-l[1])*this.ky;return Math.sqrt(d*d+m*m)}bearing(o,l){const d=Hi(l[0]-o[0])*this.kx;return Math.atan2(d,(l[1]-o[1])*this.ky)/dh}destination(o,l,d){const m=d*dh;return this.offset(o,Math.sin(m)*l,Math.cos(m)*l)}offset(o,l,d){return[o[0]+l/this.kx,o[1]+d/this.ky]}lineDistance(o){let l=0;for(let d=0;d<o.length-1;d++)l+=this.distance(o[d],o[d+1]);return l}area(o){let l=0;for(let d=0;d<o.length;d++){const m=o[d];for(let f=0,y=m.length,T=y-1;f<y;T=f++)l+=Hi(m[f][0]-m[T][0])*(m[f][1]+m[T][1])*(d?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let d=0;if(l<=0)return o[0];for(let m=0;m<o.length-1;m++){const f=o[m],y=o[m+1],T=this.distance(f,y);if(d+=T,d>l)return nu(f,y,(l-(d-T))/T)}return o[o.length-1]}pointToSegmentDistance(o,l,d){let[m,f]=l,y=Hi(d[0]-m)*this.kx,T=(d[1]-f)*this.ky;if(y!==0||T!==0){const M=(Hi(o[0]-m)*this.kx*y+(o[1]-f)*this.ky*T)/(y*y+T*T);M>1?(m=d[0],f=d[1]):M>0&&(m+=y/this.kx*M,f+=T/this.ky*M)}return y=Hi(o[0]-m)*this.kx,T=(o[1]-f)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(o,l){let d=1/0,m=o[0][0],f=o[0][1],y=0,T=0;for(let M=0;M<o.length-1;M++){let O=o[M][0],w=o[M][1],P=Hi(o[M+1][0]-O)*this.kx,N=(o[M+1][1]-w)*this.ky,L=0;P===0&&N===0||(L=(Hi(l[0]-O)*this.kx*P+(l[1]-w)*this.ky*N)/(P*P+N*N),L>1?(O=o[M+1][0],w=o[M+1][1]):L>0&&(O+=P/this.kx*L,w+=N/this.ky*L)),P=Hi(l[0]-O)*this.kx,N=(l[1]-w)*this.ky;const D=P*P+N*N;D<d&&(d=D,m=O,f=w,y=M,T=L)}return{point:[m,f],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(o,l,d){let m=this.pointOnLine(d,o),f=this.pointOnLine(d,l);if(m.index>f.index||m.index===f.index&&m.t>f.t){const O=m;m=f,f=O}const y=[m.point],T=m.index+1,M=f.index;!vg(d[T],y[0])&&T<=M&&y.push(d[T]);for(let O=T+1;O<=M;O++)y.push(d[O]);return vg(d[M],f.point)||y.push(f.point),y}lineSliceAlong(o,l,d){let m=0;const f=[];for(let y=0;y<d.length-1;y++){const T=d[y],M=d[y+1],O=this.distance(T,M);if(m+=O,m>o&&f.length===0&&f.push(nu(T,M,(o-(m-O))/O)),m>=l)return f.push(nu(T,M,(l-(m-O))/O)),f;m>o&&f.push(M)}return f}bufferPoint(o,l){const d=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-d,o[0]+m,o[1]+d]}bufferBBox(o,l){const d=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-d,o[2]+m,o[3]+d]}insideBBox(o,l){return Hi(o[0]-l[0])>=0&&Hi(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function vg(h,o){return h[0]===o[0]&&h[1]===o[1]}function nu(h,o,l){const d=Hi(o[0]-h[0]);return[h[0]+d*l,h[1]+(o[1]-h[1])*l]}function Hi(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}class Kp{constructor(o=[],l=(d,m)=>d<m?-1:d>m?1:0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:d}=this,m=l[o];for(;o>0;){const f=o-1>>1,y=l[f];if(d(m,y)>=0)break;l[o]=y,o=f}l[o]=m}_down(o){const{data:l,compare:d}=this,m=this.length>>1,f=l[o];for(;o<m;){let y=1+(o<<1);const T=y+1;if(T<this.length&&d(l[T],l[y])<0&&(y=T),d(l[y],f)>=0)break;l[o]=l[y],o=y}l[o]=f}}var Qt=8192;function Jp(h,o){return o.dist-h.dist}const Vu=100,Lo=50;function Pf(h){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==h.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==h[l])return!1;return!0}function xg(h){return h[1]-h[0]+1}function Pl(h,o){const l=h[1]>=h[0]&&h[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function Af(h,o){if(h[0]>h[1])return[null,null];const l=xg(h);if(o){if(l===2)return[h,null];const d=Math.floor(l/2);return[[h[0],h[0]+d],[h[0]+d,h[1]]]}{if(l===1)return[h,null];const d=Math.floor(l/2)-1;return[[h[0],h[0]+d],[h[0]+d+1,h[1]]]}}function Cc(h,o){const l=[1/0,1/0,-1/0,-1/0];if(!Pl(o,h.length))return l;for(let d=o[0];d<=o[1];++d)Zp(l,h[d]);return l}function fh(h){const o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<h.length;++l)for(let d=0;d<h[l].length;++d)Zp(o,h[l][d]);return o}function ph(h,o,l){if(Pf(h)||Pf(o))return NaN;let d=0,m=0;return h[2]<o[0]&&(d=o[0]-h[2]),h[0]>o[2]&&(d=h[0]-o[2]),h[1]>o[3]&&(m=h[1]-o[3]),h[3]<o[1]&&(m=o[1]-h[3]),l.distance([0,0],[d,m])}function Ev(h){return 360*h-180}function Cv(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function bg(h,o){const l=Math.pow(2,o.z),d=(h.y/Qt+o.y)/l;return[Ev((h.x/Qt+o.x)/l),Cv(d)]}function Tv(h,o){const l=[];for(let d=0;d<h.length;++d)l.push(bg(h[d],o));return l}function Iv(h,o,l){const d=l.pointOnLine(o,h).point;return l.distance(h,d)}function Mv(h,o,l,d,m){const f=l.slice(d[0],d[1]+1);let y=1/0;for(let T=o[0];T<=o[1];++T)if((y=Math.min(y,Iv(h[T],f,m)))===0)return 0;return y}function wg(h,o,l,d,m){const f=Math.min(m.pointToSegmentDistance(h,l,d),m.pointToSegmentDistance(o,l,d)),y=Math.min(m.pointToSegmentDistance(l,h,o),m.pointToSegmentDistance(d,h,o));return Math.min(f,y)}function Nx(h,o,l,d,m){if(!Pl(o,h.length)||!Pl(d,l.length))return NaN;let f=1/0;for(let y=o[0];y<o[1];++y)for(let T=d[0];T<d[1];++T){if(gg(h[y],h[y+1],l[T],l[T+1]))return 0;f=Math.min(f,wg(h[y],h[y+1],l[T],l[T+1],m))}return f}function Cs(h,o,l,d,m){if(!Pl(o,h.length)||!Pl(d,l.length))return NaN;let f=1/0;for(let y=o[0];y<=o[1];++y)for(let T=d[0];T<=d[1];++T)if((f=Math.min(f,m.distance(h[y],l[T])))===0)return f;return f}function Qp(h,o,l){if(xd(h,o,!0))return 0;let d=1/0;for(const m of o){const f=m.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[f-1]&&(d=Math.min(d,l.pointToSegmentDistance(h,m[f-1],m[0])))===0||(d=Math.min(d,Iv(h,m,l)))===0)return d}return d}function Pv(h,o,l,d){if(!Pl(o,h.length))return NaN;for(let f=o[0];f<=o[1];++f)if(xd(h[f],l,!0))return 0;let m=1/0;for(let f=o[0];f<o[1];++f)for(const y of l)for(let T=0,M=y.length,O=M-1;T<M;O=T++){if(gg(h[f],h[f+1],y[O],y[T]))return 0;m=Math.min(m,wg(h[f],h[f+1],y[O],y[T],d))}return m}function em(h,o){for(const l of h)for(let d=0;d<=l.length-1;++d)if(xd(l[d],o,!0))return!0;return!1}function Q_(h,o,l,d=1/0){const m=fh(h),f=fh(o);if(d!==1/0&&ph(m,f,l)>=d)return d;if(Yp(m,f)){if(em(h,o))return 0}else if(em(o,h))return 0;let y=d;for(const T of h)for(let M=0,O=T.length,w=O-1;M<O;w=M++)for(const P of o)for(let N=0,L=P.length,D=L-1;N<L;D=N++){if(gg(T[w],T[M],P[D],P[N]))return 0;y=Math.min(y,wg(T[w],T[M],P[D],P[N],l))}return y}function Rf(h,o,l,d,m,f,y){if(f===null||y===null)return;const T=ph(Cc(d,f),Cc(m,y),l);T<o&&h.push({dist:T,range1:f,range2:y})}function ol(h,o,l,d,m=1/0){let f=Math.min(d.distance(h[0],l[0][0]),m);if(f===0)return f;const y=new Kp([{dist:0,range1:[0,h.length-1],range2:[0,0]}],Jp),T=o?Lo:Vu,M=fh(l);for(;y.length;){const O=y.pop();if(O.dist>=f)continue;const w=O.range1;if(xg(w)<=T){if(!Pl(w,h.length))return NaN;if(o){const P=Pv(h,w,l,d);if((f=Math.min(f,P))===0)return f}else for(let P=w[0];P<=w[1];++P){const N=Qp(h[P],l,d);if((f=Math.min(f,N))===0)return f}}else{const P=Af(w,o);if(P[0]!==null){const N=ph(Cc(h,P[0]),M,d);N<f&&y.push({dist:N,range1:P[0],range2:[0,0]})}if(P[1]!==null){const N=ph(Cc(h,P[1]),M,d);N<f&&y.push({dist:N,range1:P[1],range2:[0,0]})}}}return f}function ey(h,o,l,d,m,f=1/0){let y=Math.min(f,m.distance(h[0],l[0]));if(y===0)return y;const T=new Kp([{dist:0,range1:[0,h.length-1],range2:[0,l.length-1]}],Jp),M=o?Lo:Vu,O=d?Lo:Vu;for(;T.length;){const w=T.pop();if(w.dist>=y)continue;const P=w.range1,N=w.range2;if(xg(P)<=M&&xg(N)<=O){if(!Pl(P,h.length)||!Pl(N,l.length))return NaN;if(o&&d?y=Math.min(y,Nx(h,P,l,N,m)):o||d?o&&!d?y=Math.min(y,Mv(l,N,h,P,m)):!o&&d&&(y=Math.min(y,Mv(h,P,l,N,m))):y=Math.min(y,Cs(h,P,l,N,m)),y===0)return y}else{const L=Af(P,o),D=Af(N,d);Rf(T,y,m,h,l,L[0],D[0]),Rf(T,y,m,h,l,L[0],D[1]),Rf(T,y,m,h,l,L[1],D[0]),Rf(T,y,m,h,l,L[1],D[1])}}return y}function Sg(h,o,l,d,m=1/0){let f=m;const y=Cc(h,[0,h.length-1]);for(const T of l)if(!(f!==1/0&&ph(y,Cc(T,[0,T.length-1]),d)>=f)&&(f=Math.min(f,ey(h,o,T,!0,d,f)),f===0))return f;return f}function Uu(h,o,l,d,m=1/0){let f=m;const y=Cc(h,[0,h.length-1]);for(const T of l){if(f!==1/0&&ph(y,fh(T),d)>=f)continue;const M=ol(h,o,T,d,f);if(isNaN(M))return M;if((f=Math.min(f,M))===0)return f}return f}function Lf(h){return h==="Point"||h==="MultiPoint"||h==="LineString"||h==="MultiLineString"||h==="Polygon"||h==="MultiPolygon"}class Al{constructor(o,l){this.type=gn,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Tl(o[1])){const d=o[1];if(d.type==="FeatureCollection"){for(let m=0;m<d.features.length;++m)if(Lf(d.features[m].geometry.type))return new Al(d,d.features[m].geometry)}else if(d.type==="Feature"){if(Lf(d.geometry.type))return new Al(d,d.geometry)}else if(Lf(d.type))return new Al(d,d)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const l=o.geometry(),d=o.canonicalID();if(l!=null&&d!=null){if(o.geometryType()==="Point")return function(m,f,y){const T=[];for(const O of m)for(const w of O)T.push(bg(w,f));const M=new bd(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?ey(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",M):y.type==="MultiLineString"?Sg(T,!1,y.coordinates,M):y.type==="Polygon"||y.type==="MultiPolygon"?Uu(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,M):null}(l,d,this.geometries);if(o.geometryType()==="LineString")return function(m,f,y){const T=[];for(const O of m){const w=[];for(const P of O)w.push(bg(P,f));T.push(w)}const M=new bd(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Sg(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,M);if(y.type==="MultiLineString"){let O=1/0;for(let w=0;w<y.coordinates.length;w++){const P=Sg(y.coordinates[w],!0,T,M,O);if(isNaN(P))return P;if((O=Math.min(O,P))===0)return O}return O}if(y.type==="Polygon"||y.type==="MultiPolygon"){let O=1/0;for(let w=0;w<T.length;w++){const P=Uu(T[w],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,M,O);if(isNaN(P))return P;if((O=Math.min(O,P))===0)return O}return O}return null}(l,d,this.geometries);if(o.geometryType()==="Polygon")return function(m,f,y){const T=[];for(const O of function(w,P){const N=w.length;if(N<=1)return[w];const L=[];let D,B;for(let q=0;q<N;q++){const Z=bv(w[q]);Z!==0&&(w[q].area=Math.abs(Z),B===void 0&&(B=Z<0),B===Z<0?(D&&L.push(D),D=[w[q]]):D.push(w[q]))}return D&&L.push(D),L}(m)){const w=[];for(let P=0;P<O.length;++P)w.push(Tv(O[P],f));T.push(w)}const M=new bd(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Uu(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,M);if(y.type==="MultiLineString"){let O=1/0;for(let w=0;w<y.coordinates.length;w++){const P=Uu(y.coordinates[w],!0,T,M,O);if(isNaN(P))return P;if((O=Math.min(O,P))===0)return O}return O}return y.type==="Polygon"||y.type==="MultiPolygon"?function(O,w,P){let N=1/0;for(const L of O)for(const D of w){const B=Q_(L,D,P,N);if(isNaN(B))return B;if((N=Math.min(N,B))===0)return N}return N}(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,M):null}(l,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Of(h,o){switch(h){case"string":return ao(o);case"number":return+o;case"boolean":return!!o;case"color":return Fr.parse(o);case"formatted":return Yo.fromString(ao(o));case"resolvedImage":return Ko.build(ao(o))}return o}function Eg(h,o,l,d){return d!==void 0&&(h=d*Math.round(h/d)),o!==void 0&&h<o&&(h=o),l!==void 0&&h>l&&(h=l),h}class Gu{constructor(o,l,d){this.type=o,this.key=l,this.scope=d}static parse(o,l){let d=l.expectedType;if(d==null&&(d=Cr),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");const m=l.parse(o[1],1);if(!(m instanceof tu))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const f=l.parse(o[2],2);return f instanceof tu?new Gu(d,ao(m.value),ao(f.value)):l.error("Scope of 'config' expression must be a string literal.")}return new Gu(d,ao(m.value))}evaluate(o){const l=[this.key,this.scope,o.scope].filter(Boolean).join(""),d=o.getConfig(l);if(!d)return null;const{type:m,value:f,values:y,minValue:T,maxValue:M,stepValue:O}=d,w=d.default.evaluate(o);let P=w;if(f){const N=o.scope;o.scope=(N||"").split("").slice(1).join(""),P=f.evaluate(o),o.scope=N}return m&&(P=Of(m,P)),P===void 0||T===void 0&&M===void 0&&O===void 0||(typeof P=="number"?P=Eg(P,T,M,O):Array.isArray(P)&&(P=P.map(N=>typeof N=="number"?Eg(N,T,M,O):N))),f!==void 0&&P!==void 0&&y&&!y.includes(P)&&(P=w,m&&(P=Of(m,P))),(m&&m!==this.type||P!==void 0&&di(P)!==this.type)&&(P=Of(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function ru(h){if(h instanceof xs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof il||h instanceof Al)return!1;let o=!0;return h.eachChild(l=>{o&&!ru(l)&&(o=!1)}),o}function wd(h){if(h instanceof xs&&h.name==="feature-state")return!1;let o=!0;return h.eachChild(l=>{o&&!wd(l)&&(o=!1)}),o}function Df(h){if(h instanceof Gu)return new Set([h.key]);let o=new Set;return h.eachChild(l=>{o=new Set([...o,...Df(l)])}),o}function Rl(h,o){if(h instanceof xs&&o.indexOf(h.name)>=0)return!1;let l=!0;return h.eachChild(d=>{l&&!Rl(d,o)&&(l=!1)}),l}class mh{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(o.length!==2||typeof o[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=o[1];return l.scope.has(d)?new mh(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Sd{constructor(o,l=[],d,m=new Hp,f=[],y,T){this.registry=o,this.path=l,this.key=l.map(M=>typeof M=="string"?`['${M}']`:`[${M}]`).join(""),this.scope=m,this.errors=f,this.expectedType=d,this._scope=y,this.options=T}parse(o,l,d,m,f={}){return l||d?this.concat(l,null,d,m)._parse(o,f):this._parse(o,f)}parseObjectValue(o,l,d,m,f,y={}){return this.concat(l,d,m,f)._parse(o,y)}_parse(o,l){function d(m,f,y){return y==="assert"?new aa(f,[m]):y==="coerce"?new Sc(f,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(m){let f=m.parse(o,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,T=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else f=d(f,y,l.typeAnnotation||"coerce");else f=d(f,y,l.typeAnnotation||"assert")}if(!(f instanceof tu)&&f.type.kind!=="resolvedImage"&&tm(f)){const y=new mg(this._scope,this.options);try{f=new tu(f.type,f.evaluate(y))}catch(T){return this.error(T.message),null}}return f}return Sc.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d,m){let f=typeof o=="number"?this.path.concat(o):this.path;f=typeof l=="string"?f.concat(l):f;const y=m?this.scope.concat(m):this.scope;return new Sd(this.registry,f,d||null,y,this.errors,this._scope,this.options)}error(o,...l){const d=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new El(d,o))}checkSubtype(o,l){const d=wc(o,l);return d&&this.error(d),d}}var Cg=Sd;function tm(h){if(h instanceof mh)return tm(h.boundExpression);if(h instanceof xs&&h.name==="error"||h instanceof vd||h instanceof il||h instanceof Al||h instanceof Gu)return!1;const o=h instanceof Sc||h instanceof aa;let l=!0;return h.eachChild(d=>{l=o?l&&tm(d):l&&d instanceof tu}),!!l&&ru(h)&&Rl(h,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Nf(h,o){const l=h.length-1;let d,m,f=0,y=l,T=0;for(;f<=y;)if(T=Math.floor((f+y)/2),d=h[T],m=h[T+1],d<=o){if(T===l||o<m)return T;f=T+1}else{if(!(d>o))throw new Fi("Input is not a number.");y=T-1}return 0}class iu{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[m,f]of d)this.labels.push(m),this.outputs.push(f)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(o[1],1,gn);if(!d)return null;const m=[];let f=null;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);for(let y=1;y<o.length;y+=2){const T=y===1?-1/0:o[y],M=o[y+1],O=y,w=y+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(m.length&&m[m.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const P=l.parse(M,w,f);if(!P)return null;f=f||P.type,m.push([T,P])}return new iu(f,d,m)}evaluate(o){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);const m=this.input.evaluate(o);if(m<=l[0])return d[0].evaluate(o);const f=l.length;return m>=l[f-1]?d[f-1].evaluate(o):d[Nf(l,m)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}const hr=.95047,Tg=1.08883,Ig=4/29,kf=6/29,ty=3*kf*kf,nm=kf*kf*kf,Ti=Math.PI/180,Av=180/Math.PI;function Mg(h){return h>nm?Math.pow(h,1/3):h/ty+Ig}function Wi(h){return h>kf?h*h*h:ty*(h-Ig)}function rm(h){return 255*(h<=.0031308?12.92*h:1.055*Math.pow(h,1/2.4)-.055)}function Ff(h){return(h/=255)<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function zf(h){const o=Ff(h.r),l=Ff(h.g),d=Ff(h.b),m=Mg((.4124564*o+.3575761*l+.1804375*d)/hr),f=Mg((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*f-16,a:500*(m-f),b:200*(f-Mg((.0193339*o+.119192*l+.9503041*d)/Tg)),alpha:h.a}}function ny(h){let o=(h.l+16)/116,l=isNaN(h.a)?o:o+h.a/500,d=isNaN(h.b)?o:o-h.b/200;return o=1*Wi(o),l=hr*Wi(l),d=Tg*Wi(d),new Fr(rm(3.2404542*l-1.5371385*o-.4985314*d),rm(-.969266*l+1.8760108*o+.041556*d),rm(.0556434*l-.2040259*o+1.0572252*d),h.alpha)}function ry(h,o,l){const d=o-h;return h+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const Tc={forward:zf,reverse:ny,interpolate:function(h,o,l){return{l:Sn(h.l,o.l,l),a:Sn(h.a,o.a,l),b:Sn(h.b,o.b,l),alpha:Sn(h.alpha,o.alpha,l)}}},gh={forward:function(h){const{l:o,a:l,b:d}=zf(h),m=Math.atan2(d,l)*Av;return{h:m<0?m+360:m,c:Math.sqrt(l*l+d*d),l:o,alpha:h.a}},reverse:function(h){const o=h.h*Ti,l=h.c;return ny({l:h.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:h.alpha})},interpolate:function(h,o,l){return{h:ry(h.h,o.h,l),c:Sn(h.c,o.c,l),l:Sn(h.l,o.l,l),alpha:Sn(h.alpha,o.alpha,l)}}};var Ed=Object.freeze({__proto__:null,hcl:gh,lab:Tc});class Oa{constructor(o,l,d,m,f){this.type=o,this.operator=l,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(const[y,T]of f)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(o,l,d,m){let f=0;if(o.name==="exponential")f=iy(l,o.base,d,m);else if(o.name==="linear")f=iy(l,1,d,m);else if(o.name==="cubic-bezier"){const y=o.controlPoints;f=new Mr(y[0],y[1],y[2],y[3]).solve(iy(l,1,d,m))}return f}static parse(o,l){let[d,m,f,...y]=o;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const O=m[1];if(typeof O!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:O}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const O=m.slice(1);if(O.length!==4||O.some(w=>typeof w!="number"||w<0||w>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:O}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(f=l.parse(f,2,gn),!f)return null;const T=[];let M=null;d==="interpolate-hcl"||d==="interpolate-lab"?M=ys:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let O=0;O<y.length;O+=2){const w=y[O],P=y[O+1],N=O+3,L=O+4;if(typeof w!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(T.length&&T[T.length-1][0]>=w)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const D=l.parse(P,L,M);if(!D)return null;M=M||D.type,T.push([w,D])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Oa(M,d,m,f,T):l.error(`Type ${Qi(M)} is not interpolatable.`)}evaluate(o){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);const m=this.input.evaluate(o);if(m<=l[0])return d[0].evaluate(o);const f=l.length;if(m>=l[f-1])return d[f-1].evaluate(o);const y=Nf(l,m),T=Oa.interpolationFactor(this.interpolation,m,l[y],l[y+1]),M=d[y].evaluate(o),O=d[y+1].evaluate(o);return this.operator==="interpolate"?bc[this.type.kind.toLowerCase()](M,O,T):this.operator==="interpolate-hcl"?gh.reverse(gh.interpolate(gh.forward(M),gh.forward(O),T)):Tc.reverse(Tc.interpolate(Tc.forward(M),Tc.forward(O),T))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function iy(h,o,l,d){const m=d-l,f=h-l;return m===0?0:o===1?f/m:(Math.pow(o,f)-1)/(Math.pow(o,m)-1)}class Pg{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null;const m=l.expectedType;m&&m.kind!=="value"&&(d=m);const f=[];for(const T of o.slice(1)){const M=l.parse(T,1+f.length,d,void 0,{typeAnnotation:"omit"});if(!M)return null;d=d||M.type,f.push(M)}const y=m&&f.some(T=>wc(m,T.type));return new Pg(y?Cr:d,f)}evaluate(o){let l,d=null,m=0;for(const f of this.args){if(m++,d=f.evaluate(o),d&&d instanceof Ko&&!d.available&&(l||(l=d),d=null,m===this.args.length))return l;if(d!==null)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class im{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let f=1;f<o.length-1;f+=2){const y=o[f];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",f);const T=l.parse(o[f+1],f+1);if(!T)return null;d.push([y,T])}const m=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return m?new im(d,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}class Bf{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,gn),m=l.parse(o[2],2,vs(l.expectedType||Cr));return d&&m?new Bf(m.type.itemType,d,m):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Fi(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Fi(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Fi(`Array index must be an integer, but found ${l} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class jf{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,gn),m=l.parse(o[2],2,vs(l.expectedType||Cr));return d&&m?new jf(m.type.itemType,d,m):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Fi(`Array index out of bounds: ${l} < 0.`);if(l>d.length-1)throw new Fi(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l===Math.floor(l))return d[l];const m=Math.floor(l),f=Math.ceil(l),y=d[m],T=d[f];if(typeof y!="number"||typeof T!="number")throw new Fi(`Cannot interpolate between non-number values at index ${l}.`);const M=l-m;return y*(1-M)+T*M}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class om{constructor(o,l){this.type=Er,this.needle=o,this.haystack=l}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Cr),m=l.parse(o[2],2,Cr);return d&&m?Wp(d.type,[Er,Gr,gn,Bu,Cr])?new om(d,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(d.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(d==null)return!1;if(!_d(l,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(di(l))} instead.`);if(!_d(d,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Qi(di(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Vf{constructor(o,l,d){this.type=gn,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Cr),m=l.parse(o[2],2,Cr);if(!d||!m)return null;if(!Wp(d.type,[Er,Gr,gn,Bu,Cr]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(d.type)} instead`);if(o.length===4){const f=l.parse(o[3],3,gn);return f?new Vf(d,m,f):null}return new Vf(d,m)}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!_d(l,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(di(l))} instead.`);if(!_d(d,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Qi(di(d))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return d.indexOf(l,m)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class sm{constructor(o,l,d,m,f,y){this.inputType=o,this.type=l,this.input=d,this.cases=m,this.outputs=f,this.otherwise=y}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);const f={},y=[];for(let O=2;O<o.length-1;O+=2){let w=o[O];const P=o[O+1];Array.isArray(w)||(w=[w]);const N=l.concat(O);if(w.length===0)return N.error("Expected at least one branch label.");for(const D of w){if(typeof D!="number"&&typeof D!="string")return N.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,di(D)))return null}else d=di(D);if(f[String(D)]!==void 0)return N.error("Branch labels must be unique.");f[String(D)]=y.length}const L=l.parse(P,O,m);if(!L)return null;m=m||L.type,y.push(L)}const T=l.parse(o[1],1,Cr);if(!T)return null;const M=l.parse(o[o.length-1],o.length-1,m);return M?T.type.kind!=="value"&&l.concat(1).checkSubtype(d,T.type)?null:new sm(d,m,T,f,y,M):null}evaluate(o){const l=this.input.evaluate(o);return(di(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],m={};for(const y of l){const T=m[this.cases[y]];T===void 0?(m[this.cases[y]]=d.length,d.push([this.cases[y],[y]])):d[T][1].push(y)}const f=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of d)o.push(T.length===1?f(T[0]):T.map(f)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}class am{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const m=[];for(let y=1;y<o.length-1;y+=2){const T=l.parse(o[y],y,Er);if(!T)return null;const M=l.parse(o[y+1],y+1,d);if(!M)return null;m.push([T,M]),d=d||M.type}const f=l.parse(o[o.length-1],o.length-1,d);return f?new am(d,m,f):null}evaluate(o){for(const[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class Ag{constructor(o,l,d,m){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=m}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,Cr),m=l.parse(o[2],2,gn);if(!d||!m)return null;if(!Wp(d.type,[vs(Cr),Gr,Cr]))return l.error(`Expected first argument to be of type array or string, but found ${Qi(d.type)} instead`);if(o.length===4){const f=l.parse(o[3],3,gn);return f?new Ag(d.type,d,m,f):null}return new Ag(d.type,d,m)}evaluate(o){const l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!_d(l,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${Qi(di(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return l.slice(d,m)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function oy(h,o){return h==="=="||h==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Rv(h,o,l,d){return d.compare(o,l)===0}function Uf(h,o,l){const d=h!=="=="&&h!=="!=";return class IV{constructor(f,y,T){this.type=Er,this.lhs=f,this.rhs=y,this.collator=T,this.hasUntypedArgument=f.type.kind==="value"||y.type.kind==="value"}static parse(f,y){if(f.length!==3&&f.length!==4)return y.error("Expected two or three arguments.");const T=f[0];let M=y.parse(f[1],1,Cr);if(!M)return null;if(!oy(T,M.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Qi(M.type)}'.`);let O=y.parse(f[2],2,Cr);if(!O)return null;if(!oy(T,O.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Qi(O.type)}'.`);if(M.type.kind!==O.type.kind&&M.type.kind!=="value"&&O.type.kind!=="value")return y.error(`Cannot compare types '${Qi(M.type)}' and '${Qi(O.type)}'.`);d&&(M.type.kind==="value"&&O.type.kind!=="value"?M=new aa(O.type,[M]):M.type.kind!=="value"&&O.type.kind==="value"&&(O=new aa(M.type,[O])));let w=null;if(f.length===4){if(M.type.kind!=="string"&&O.type.kind!=="string"&&M.type.kind!=="value"&&O.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(w=y.parse(f[3],3,nl),!w)return null}return new IV(M,O,w)}evaluate(f){const y=this.lhs.evaluate(f),T=this.rhs.evaluate(f);if(d&&this.hasUntypedArgument){const M=di(y),O=di(T);if(M.kind!==O.kind||M.kind!=="string"&&M.kind!=="number")throw new Fi(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${M.kind}, ${O.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const M=di(y),O=di(T);if(M.kind!=="string"||O.kind!=="string")return o(f,y,T)}return this.collator?l(f,y,T,this.collator.evaluate(f)):o(f,y,T)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[h];return this.eachChild(y=>{f.push(y.serialize())}),f}}}const sy=Uf("==",function(h,o,l){return o===l},Rv),_h=Uf("!=",function(h,o,l){return o!==l},function(h,o,l,d){return!Rv(0,o,l,d)}),Lv=Uf("<",function(h,o,l){return o<l},function(h,o,l,d){return d.compare(o,l)<0}),Gf=Uf(">",function(h,o,l){return o>l},function(h,o,l,d){return d.compare(o,l)>0}),$u=Uf("<=",function(h,o,l){return o<=l},function(h,o,l,d){return d.compare(o,l)<=0}),lm=Uf(">=",function(h,o,l){return o>=l},function(h,o,l,d){return d.compare(o,l)>=0});class sl{constructor(o,l,d,m,f,y){this.type=Gr,this.number=o,this.locale=l,this.currency=d,this.unit=m,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(o,l){if(o.length!==3)return l.error("Expected two arguments.");const d=l.parse(o[1],1,gn);if(!d)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let f=null;if(m.locale&&(f=l.parseObjectValue(m.locale,2,"locale",Gr),!f))return null;let y=null;if(m.currency&&(y=l.parseObjectValue(m.currency,2,"currency",Gr),!y))return null;let T=null;if(m.unit&&(T=l.parseObjectValue(m.unit,2,"unit",Gr),!T))return null;let M=null;if(m["min-fraction-digits"]&&(M=l.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",gn),!M))return null;let O=null;return m["max-fraction-digits"]&&(O=l.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",gn),!O)?null:new sl(d,f,y,T,M,O)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class um{constructor(o){this.type=gn,this.input=o}static parse(o,l){if(o.length!==2)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=l.parse(o[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Qi(d.type)} instead.`):new um(d):null}evaluate(o){const l=this.input.evaluate(o);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Fi(`Expected value to be of type string or array, but found ${Qi(di(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function ay(h){return function(){h=1831565813+(h|=0)|0;let o=Math.imul(h^h>>>15,1|h);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const $f={"==":sy,"!=":_h,">":Gf,"<":Lv,">=":lm,"<=":$u,array:aa,at:Bf,"at-interpolated":jf,boolean:aa,case:am,coalesce:Pg,collator:vd,format:uh,image:Il,in:om,"index-of":Vf,interpolate:Oa,"interpolate-hcl":Oa,"interpolate-lab":Oa,length:um,let:im,literal:tu,match:sm,number:aa,"number-format":sl,object:aa,slice:Ag,step:iu,string:aa,"to-boolean":Sc,"to-color":Sc,"to-number":Sc,"to-string":Sc,var:mh,within:il,distance:Al,config:Gu};function yh(h,[o,l,d,m]){o=o.evaluate(h),l=l.evaluate(h),d=d.evaluate(h);const f=m?m.evaluate(h):1,y=lh(o,l,d,f);if(y)throw new Fi(y);return new Fr(o/255*f,l/255*f,d/255*f,f)}function qf(h,[o,l,d,m]){o=o.evaluate(h),l=l.evaluate(h),d=d.evaluate(h);const f=m?m.evaluate(h):1,y=function(O,w,P,N){return typeof O=="number"&&O>=0&&O<=360?typeof w=="number"&&w>=0&&w<=100&&typeof P=="number"&&P>=0&&P<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[O,w,P,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[O,w,P,N]:[O,w,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[O,w,P,N]:[O,w,P]).join(", ")}]: 'h' must be between 0 and 360.`}(o,l,d,f);if(y)throw new Fi(y);const T=`hsla(${o}, ${l}%, ${d}%, ${f})`,M=Fr.parse(T);if(!M)throw new Fi(`Failed to parse HSLA color: ${T}`);return M}function vh(h,o){return h in o}function Cd(h,o){const l=o[h];return l===void 0?null:l}function Da(h){return{type:h}}function xh(h){return{result:"success",value:h}}function $s(h){return{result:"error",value:h}}function Xi(h,o){return!!h&&!!h.parameters&&h.parameters.indexOf(o)>-1}function Ri(h){return h["property-type"]==="data-driven"}function ou(h){return Xi(h.expression,"measure-light")}function Ts(h){return Xi(h.expression,"zoom")}function qs(h){return!!h.expression&&h.expression.interpolated}function qu(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function Td(h){return h}function la(h,o){const l=o.type==="color",d=h.stops&&typeof h.stops[0][0]=="object",m=d||!(d||h.property!==void 0),f=h.type||(qs(o)?"exponential":"interval");if(l&&((h=fr({},h)).stops&&(h.stops=h.stops.map(O=>[O[0],Fr.parse(O[1])])),h.default=Fr.parse(h.default?h.default:o.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!Ed[h.colorSpace])throw new Error(`Unknown color space: ${h.colorSpace}`);let y,T,M;if(f==="exponential")y=Hf;else if(f==="interval")y=ly;else if(f==="categorical"){y=Ov,T=Object.create(null);for(const O of h.stops)T[O[0]]=O[1];M=typeof h.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=cm}if(d){const O={},w=[];for(let L=0;L<h.stops.length;L++){const D=h.stops[L],B=D[0].zoom;O[B]===void 0&&(O[B]={zoom:B,type:h.type,property:h.property,default:h.default,stops:[]},w.push(B)),O[B].stops.push([D[0].value,D[1]])}const P=[];for(const L of w)P.push([O[L].zoom,la(O[L],o)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Oa.interpolationFactor.bind(void 0,N),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},D)=>Hf({stops:P,base:h.base},o,L).evaluate(L,D)}}if(m){const O=f==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Oa.interpolationFactor.bind(void 0,O),zoomStops:h.stops.map(w=>w[0]),evaluate:({zoom:w})=>y(h,o,w,T,M)}}return{kind:"source",evaluate(O,w){const P=w&&w.properties?w.properties[h.property]:void 0;return P===void 0?bh(h.default,o.default):y(h,o,P,T,M)}}}function bh(h,o,l){return h!==void 0?h:o!==void 0?o:l!==void 0?l:void 0}function Ov(h,o,l,d,m){return bh(typeof l===m?d[l]:void 0,h.default,o.default)}function ly(h,o,l){if(Ml(l)!=="number")return bh(h.default,o.default);const d=h.stops.length;if(d===1||l<=h.stops[0][0])return h.stops[0][1];if(l>=h.stops[d-1][0])return h.stops[d-1][1];const m=Nf(h.stops.map(f=>f[0]),l);return h.stops[m][1]}function Hf(h,o,l){const d=h.base!==void 0?h.base:1;if(Ml(l)!=="number")return bh(h.default,o.default);const m=h.stops.length;if(m===1||l<=h.stops[0][0])return h.stops[0][1];if(l>=h.stops[m-1][0])return h.stops[m-1][1];const f=Nf(h.stops.map(w=>w[0]),l),y=function(w,P,N,L){const D=L-N,B=w-N;return D===0?0:P===1?B/D:(Math.pow(P,B)-1)/(Math.pow(P,D)-1)}(l,d,h.stops[f][0],h.stops[f+1][0]),T=h.stops[f][1],M=h.stops[f+1][1];let O=bc[o.type]||Td;if(h.colorSpace&&h.colorSpace!=="rgb"){const w=Ed[h.colorSpace];O=(P,N)=>w.reverse(w.interpolate(w.forward(P),w.forward(N),y))}return typeof T.evaluate=="function"?{evaluate(...w){const P=T.evaluate.apply(void 0,w),N=M.evaluate.apply(void 0,w);if(P!==void 0&&N!==void 0)return O(P,N,y)}}:O(T,M,y)}function cm(h,o,l){return o.type==="color"?l=Fr.parse(l):o.type==="formatted"?l=Yo.fromString(l.toString()):o.type==="resolvedImage"?l=Ko.build(l.toString()):Ml(l)===o.type||o.type==="enum"&&o.values[l]||(l=void 0),bh(l,h.default,o.default)}xs.register($f,{error:[{kind:"error"},[Gr],(h,[o])=>{throw new Fi(o.evaluate(h))}],typeof:[Gr,[Cr],(h,[o])=>Qi(di(o.evaluate(h)))],"to-rgba":[vs(gn,4),[ys],(h,[o])=>o.evaluate(h).toRenderColor(null).toArray()],"to-hsla":[vs(gn,4),[ys],(h,[o])=>o.evaluate(h).toRenderColor(null).toHslaArray()],rgb:[ys,[gn,gn,gn],yh],rgba:[ys,[gn,gn,gn,gn],yh],hsl:[ys,[gn,gn,gn],qf],hsla:[ys,[gn,gn,gn,gn],qf],has:{type:Er,overloads:[[[Gr],(h,[o])=>vh(o.evaluate(h),h.properties())],[[Gr,If],(h,[o,l])=>vh(o.evaluate(h),l.evaluate(h))]]},get:{type:Cr,overloads:[[[Gr],(h,[o])=>Cd(o.evaluate(h),h.properties())],[[Gr,If],(h,[o,l])=>Cd(o.evaluate(h),l.evaluate(h))]]},"feature-state":[Cr,[Gr],(h,[o])=>Cd(o.evaluate(h),h.featureState||{})],properties:[If,[],h=>h.properties()],"geometry-type":[Gr,[],h=>h.geometryType()],id:[Cr,[],h=>h.id()],zoom:[gn,[],h=>h.globals.zoom],pitch:[gn,[],h=>h.globals.pitch||0],"distance-from-center":[gn,[],h=>h.distanceFromCenter()],"measure-light":[gn,[Gr],(h,[o])=>h.measureLight(o.evaluate(h))],"heatmap-density":[gn,[],h=>h.globals.heatmapDensity||0],"line-progress":[gn,[],h=>h.globals.lineProgress||0],"raster-value":[gn,[],h=>h.globals.rasterValue||0],"raster-particle-speed":[gn,[],h=>h.globals.rasterParticleSpeed||0],"sky-radial-progress":[gn,[],h=>h.globals.skyRadialProgress||0],accumulated:[Cr,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[gn,Da(gn),(h,o)=>{let l=0;for(const d of o)l+=d.evaluate(h);return l}],"*":[gn,Da(gn),(h,o)=>{let l=1;for(const d of o)l*=d.evaluate(h);return l}],"-":{type:gn,overloads:[[[gn,gn],(h,[o,l])=>o.evaluate(h)-l.evaluate(h)],[[gn],(h,[o])=>-o.evaluate(h)]]},"/":[gn,[gn,gn],(h,[o,l])=>o.evaluate(h)/l.evaluate(h)],"%":[gn,[gn,gn],(h,[o,l])=>o.evaluate(h)%l.evaluate(h)],ln2:[gn,[],()=>Math.LN2],pi:[gn,[],()=>Math.PI],e:[gn,[],()=>Math.E],"^":[gn,[gn,gn],(h,[o,l])=>Math.pow(o.evaluate(h),l.evaluate(h))],sqrt:[gn,[gn],(h,[o])=>Math.sqrt(o.evaluate(h))],log10:[gn,[gn],(h,[o])=>Math.log(o.evaluate(h))/Math.LN10],ln:[gn,[gn],(h,[o])=>Math.log(o.evaluate(h))],log2:[gn,[gn],(h,[o])=>Math.log(o.evaluate(h))/Math.LN2],sin:[gn,[gn],(h,[o])=>Math.sin(o.evaluate(h))],cos:[gn,[gn],(h,[o])=>Math.cos(o.evaluate(h))],tan:[gn,[gn],(h,[o])=>Math.tan(o.evaluate(h))],asin:[gn,[gn],(h,[o])=>Math.asin(o.evaluate(h))],acos:[gn,[gn],(h,[o])=>Math.acos(o.evaluate(h))],atan:[gn,[gn],(h,[o])=>Math.atan(o.evaluate(h))],min:[gn,Da(gn),(h,o)=>Math.min(...o.map(l=>l.evaluate(h)))],max:[gn,Da(gn),(h,o)=>Math.max(...o.map(l=>l.evaluate(h)))],abs:[gn,[gn],(h,[o])=>Math.abs(o.evaluate(h))],round:[gn,[gn],(h,[o])=>{const l=o.evaluate(h);return l<0?-Math.round(-l):Math.round(l)}],floor:[gn,[gn],(h,[o])=>Math.floor(o.evaluate(h))],ceil:[gn,[gn],(h,[o])=>Math.ceil(o.evaluate(h))],"filter-==":[Er,[Gr,Cr],(h,[o,l])=>h.properties()[o.value]===l.value],"filter-id-==":[Er,[Cr],(h,[o])=>h.id()===o.value],"filter-type-==":[Er,[Gr],(h,[o])=>h.geometryType()===o.value],"filter-<":[Er,[Gr,Cr],(h,[o,l])=>{const d=h.properties()[o.value],m=l.value;return typeof d==typeof m&&d<m}],"filter-id-<":[Er,[Cr],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[Er,[Gr,Cr],(h,[o,l])=>{const d=h.properties()[o.value],m=l.value;return typeof d==typeof m&&d>m}],"filter-id->":[Er,[Cr],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[Er,[Gr,Cr],(h,[o,l])=>{const d=h.properties()[o.value],m=l.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[Er,[Cr],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[Er,[Gr,Cr],(h,[o,l])=>{const d=h.properties()[o.value],m=l.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[Er,[Cr],(h,[o])=>{const l=h.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[Er,[Cr],(h,[o])=>o.value in h.properties()],"filter-has-id":[Er,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Er,[vs(Gr)],(h,[o])=>o.value.indexOf(h.geometryType())>=0],"filter-id-in":[Er,[vs(Cr)],(h,[o])=>o.value.indexOf(h.id())>=0],"filter-in-small":[Er,[Gr,vs(Cr)],(h,[o,l])=>l.value.indexOf(h.properties()[o.value])>=0],"filter-in-large":[Er,[Gr,vs(Cr)],(h,[o,l])=>function(d,m,f,y){for(;f<=y;){const T=f+y>>1;if(m[T]===d)return!0;m[T]>d?y=T-1:f=T+1}return!1}(h.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Er,overloads:[[[Er,Er],(h,[o,l])=>o.evaluate(h)&&l.evaluate(h)],[Da(Er),(h,o)=>{for(const l of o)if(!l.evaluate(h))return!1;return!0}]]},any:{type:Er,overloads:[[[Er,Er],(h,[o,l])=>o.evaluate(h)||l.evaluate(h)],[Da(Er),(h,o)=>{for(const l of o)if(l.evaluate(h))return!0;return!1}]]},"!":[Er,[Er],(h,[o])=>!o.evaluate(h)],"is-supported-script":[Er,[Gr],(h,[o])=>{const l=h.globals&&h.globals.isSupportedScript;return!l||l(o.evaluate(h))}],upcase:[Gr,[Gr],(h,[o])=>o.evaluate(h).toUpperCase()],downcase:[Gr,[Gr],(h,[o])=>o.evaluate(h).toLowerCase()],concat:[Gr,Da(Cr),(h,o)=>o.map(l=>ao(l.evaluate(h))).join("")],"resolved-locale":[Gr,[nl],(h,[o])=>o.evaluate(h).resolvedLocale()],random:[gn,[gn,gn,Cr],(h,o)=>{const[l,d,m]=o.map(y=>y.evaluate(h));if(l>d||l===d)return l;let f;if(typeof m=="string")f=function(y){let T=0;if(y.length===0)return T;for(let M=0;M<y.length;M++)T=(T<<5)-T+y.charCodeAt(M),T|=0;return T}(m);else{if(typeof m!="number")throw new Fi(`Invalid seed input: ${m}`);f=m}return l+ay(f)()*(d-l)}]});class su{constructor(o,l,d,m){this.expression=o,this._warningHistory={},this._evaluator=new mg(d,m),this._defaultValue=l?function(f){return f.type==="color"&&(qu(f.default)||Array.isArray(f.default))?new Fr(0,0,0,0):f.type==="color"?Fr.parse(f.default)||null:f.default===void 0?null:f.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=Df(o)}evaluateWithoutErrorHandling(o,l,d,m,f,y,T,M){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=m||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,m,f,y,T,M){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function Id(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in $f}function wh(h,o,l,d){const m=new Cg($f,[],o?function(y){const T={color:ys,string:Gr,number:gn,enum:Gr,boolean:Er,formatted:ju,resolvedImage:Cl};return y.type==="array"?vs(T[y.value]||Cr,y.length):T[y.type]}(o):void 0,void 0,void 0,l,d),f=m.parse(h,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?xh(new su(f,o,l,d)):$s(m.errors)}class Rg{constructor(o,l,d,m){this.kind=o,this._styleExpression=l,this.isLightConstant=d,this.isLineProgressConstant=m,this.isStateDependent=o!=="constant"&&!wd(l.expression),this.configDependencies=Df(l.expression)}evaluateWithoutErrorHandling(o,l,d,m,f,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,m,f,y)}evaluate(o,l,d,m,f,y){return this._styleExpression.evaluate(o,l,d,m,f,y)}}class Wf{constructor(o,l,d,m,f,y){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=o!=="camera"&&!wd(l.expression),this.isLightConstant=f,this.isLineProgressConstant=y,this.configDependencies=Df(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,l,d,m,f,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,m,f,y)}evaluate(o,l,d,m,f,y){return this._styleExpression.evaluate(o,l,d,m,f,y)}interpolationFactor(o,l,d){return this.interpolationType?Oa.interpolationFactor(this.interpolationType,o,l,d):0}}function Hu(h,o,l,d){if((h=wh(h,o,l,d)).result==="error")return h;const m=h.value.expression,f=ru(m);if(!f&&!Ri(o))return $s([new El("","data expressions not supported")]);const y=Rl(m,["zoom","pitch","distance-from-center"]);if(!y&&!Ts(o))return $s([new El("","zoom expressions not supported")]);const T=Rl(m,["measure-light"]);if(!T&&!ou(o))return $s([new El("","measure-light expression not supported")]);const M=Rl(m,["line-progress"]);if(!M&&!function(P){return Xi(P.expression,"line-progress")}(o))return $s([new El("","line-progress expression not supported")]);const O=o.expression&&o.expression.relaxZoomRestriction,w=Mc(m);return w||y||O?w instanceof El?$s([w]):w instanceof Oa&&!qs(o)?$s([new El("",'"interpolate" expressions cannot be used with this property')]):xh(w?new Wf(f&&M?"camera":"composite",h.value,w.labels,w instanceof Oa?w.interpolation:void 0,T,M):new Rg(f&&M?"constant":"source",h.value,T,M)):$s([new El("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ic{constructor(o,l){this._parameters=o,this._specification=l,fr(this,la(this._parameters,this._specification))}static deserialize(o){return new Ic(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Mc(h){let o=null;if(h instanceof im)o=Mc(h.result);else if(h instanceof Pg){for(const l of h.args)if(o=Mc(l),o)break}else(h instanceof iu||h instanceof Oa)&&h.input instanceof xs&&h.input.name==="zoom"&&(o=h);return o instanceof El||h.eachChild(l=>{const d=Mc(l);d instanceof El?o=d:o&&d&&o!==d&&(o=new El("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Sh,hm,al=function(){if(hm)return Sh;hm=1,Sh=o;var h=3;function o(l,d,m){var f=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var y=new Int32Array(this.arrayBuffer);l=y[0],this.d=(d=y[1])+2*(m=y[2]);for(var T=0;T<this.d*this.d;T++){var M=y[h+T],O=y[h+T+1];f.push(M===O?null:y.subarray(M,O))}var w=y[h+f.length+1];this.keys=y.subarray(y[h+f.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=d+2*m;for(var P=0;P<this.d*this.d;P++)f.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=m,this.scale=d/l,this.uid=0;var N=m/d*l;this.min=-N,this.max=l+N}return o.prototype.insert=function(l,d,m,f,y){this._forEachCell(d,m,f,y,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(f),this.bboxes.push(y)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(l,d,m,f,y,T){this.cells[y].push(T)},o.prototype.query=function(l,d,m,f,y){var T=this.min,M=this.max;if(l<=T&&d<=T&&M<=m&&M<=f&&!y)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(l,d,m,f,this._queryCell,O,{},y),O},o.prototype._queryCell=function(l,d,m,f,y,T,M,O){var w=this.cells[y];if(w!==null)for(var P=this.keys,N=this.bboxes,L=0;L<w.length;L++){var D=w[L];if(M[D]===void 0){var B=4*D;(O?O(N[B+0],N[B+1],N[B+2],N[B+3]):l<=N[B+2]&&d<=N[B+3]&&m>=N[B+0]&&f>=N[B+1])?(M[D]=!0,T.push(P[D])):M[D]=!1}}},o.prototype._forEachCell=function(l,d,m,f,y,T,M,O){for(var w=this._convertToCellCoord(l),P=this._convertToCellCoord(d),N=this._convertToCellCoord(m),L=this._convertToCellCoord(f),D=w;D<=N;D++)for(var B=P;B<=L;B++){var q=this.d*B+D;if((!O||O(this._convertFromCellCoord(D),this._convertFromCellCoord(B),this._convertFromCellCoord(D+1),this._convertFromCellCoord(B+1)))&&y.call(this,l,d,m,f,q,T,M,O))return}},o.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},o.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,d=h+this.cells.length+1+1,m=0,f=0;f<this.cells.length;f++)m+=this.cells[f].length;var y=new Int32Array(d+m+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=d,M=0;M<l.length;M++){var O=l[M];y[h+M]=T,y.set(O,T),T+=O.length}return y[h+l.length]=T,y.set(this.keys,T),y[h+l.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Sh}(),Is=b(al);const Wu={};function on(h,o,l={}){Object.defineProperty(h,"_classRegistryKey",{value:o,writable:!1}),Wu[o]={klass:h,omit:l.omit||[]}}on(Object,"Object"),Is.serialize=function(h,o){const l=h.toArrayBuffer();return o&&o.add(l),{buffer:l}},Is.deserialize=function(h){return new Is(h.buffer)},Object.defineProperty(Is,"name",{value:"Grid"}),on(Is,"Grid"),typeof DOMMatrix<"u"&&on(DOMMatrix,"DOMMatrix"),on(Fr,"Color"),on(Error,"Error"),on(Yo,"Formatted"),on(yd,"FormattedSection"),on(Ui,"AJAXError"),on(Ko,"ResolvedImage"),on(Ic,"StylePropertyFunction"),on(su,"StyleExpression",{omit:["_evaluator"]}),on(Gs,"ImageId"),on(eu,"ImageVariant"),on(Wf,"ZoomDependentExpression"),on(Rg,"ZoomConstantExpression"),on(xs,"CompoundExpression",{omit:["_evaluate"]});for(const h in $f)Wu[$f[h]._classRegistryKey]||on($f[h],`Expression${h}`);function au(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Pc(h){return self.ImageBitmap&&h instanceof ImageBitmap}function Ac(h,o){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp)return h;if(au(h)||Pc(h))return o&&o.add(h),h;if(ArrayBuffer.isView(h))return o&&o.add(h.buffer),h;if(h instanceof ImageData)return o&&o.add(h.data.buffer),h;if(Array.isArray(h)){const l=[];for(const d of h)l.push(Ac(d,o));return l}if(h instanceof Map){const l={$name:"Map",entries:[]};for(const[d,m]of h.entries())l.entries.push(Ac(d),Ac(m));return l}if(h instanceof Set){const l={$name:"Set"};let d=0;for(const m of h.values())l[++d]=Ac(m);return l}if(h instanceof DOMMatrix){const l={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of d)l[m]=h[m];return l}if(typeof h=="bigint")return{$name:"BigInt",value:h.toString()};if(typeof h=="object"){const l=h.constructor,d=l._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const m=l.serialize?l.serialize(h,o):{};if(!l.serialize){for(const f in h)h.hasOwnProperty(f)&&(Wu[d].omit.indexOf(f)>=0||(m[f]=Ac(h[f],o)));h instanceof Error&&(m.message=h.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(m.$name=d),m}throw new Error("can't serialize object of type "+typeof h)}function ua(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||au(h)||Pc(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(ua);if(typeof h=="object"){const o=h.$name||"Object";if(o==="Map"){const m=h.entries||[],f=new Map;for(let y=0;y<m.length;y+=2)f.set(ua(m[y]),ua(m[y+1]));return f}if(o==="Set"){const m=new Set;for(const f of Object.keys(h))f!=="$name"&&m.add(ua(h[f]));return m}if(o==="DOMMatrix"){let m;return m=h.is2D?[h.a,h.b,h.c,h.d,h.e,h.f]:[h.m11,h.m12,h.m13,h.m14,h.m21,h.m22,h.m23,h.m24,h.m31,h.m32,h.m33,h.m34,h.m41,h.m42,h.m43,h.m44],new DOMMatrix(m)}if(o==="BigInt")return BigInt(h.value);const{klass:l}=Wu[o];if(!l)throw new Error(`Can't deserialize unregistered class "${o}".`);if(l.deserialize)return l.deserialize(h);const d=Object.create(l.prototype);for(const m of Object.keys(h))m!=="$name"&&(d[m]=ua(h[m]));return d}throw new Error("can't deserialize object of type "+typeof h)}const Cn={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519,Osage:h=>h>=66736&&h<=66815,"CJK Unified Ideographs Extension B":h=>h>=131072&&h<=173791};function ca(h){for(const o of h)if(Na(o.charCodeAt(0)))return!0;return!1}function ll(h){for(const o of h)if(!lo(o.charCodeAt(0)))return!1;return!0}function lo(h){return!(Cn.Arabic(h)||Cn["Arabic Supplement"](h)||Cn["Arabic Extended-A"](h)||Cn["Arabic Presentation Forms-A"](h)||Cn["Arabic Presentation Forms-B"](h))}function Na(h){return!(h!==746&&h!==747&&(h<4352||!(Cn["Bopomofo Extended"](h)||Cn.Bopomofo(h)||Cn["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Cn["CJK Compatibility Ideographs"](h)||Cn["CJK Compatibility"](h)||Cn["CJK Radicals Supplement"](h)||Cn["CJK Strokes"](h)||!(!Cn["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Cn["CJK Unified Ideographs Extension A"](h)||Cn["CJK Unified Ideographs"](h)||Cn["Enclosed CJK Letters and Months"](h)||Cn["Hangul Compatibility Jamo"](h)||Cn["Hangul Jamo Extended-A"](h)||Cn["Hangul Jamo Extended-B"](h)||Cn["Hangul Jamo"](h)||Cn["Hangul Syllables"](h)||Cn.Hiragana(h)||Cn["Ideographic Description Characters"](h)||Cn.Kanbun(h)||Cn["Kangxi Radicals"](h)||Cn["Katakana Phonetic Extensions"](h)||Cn.Katakana(h)&&h!==12540||!(!Cn["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Cn["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Cn["Unified Canadian Aboriginal Syllabics"](h)||Cn["Unified Canadian Aboriginal Syllabics Extended"](h)||Cn["Vertical Forms"](h)||Cn["Yijing Hexagram Symbols"](h)||Cn["Yi Syllables"](h)||Cn["Yi Radicals"](h))))}function Lg(h){return!(Na(h)||function(o){return!!(Cn["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Cn["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Cn["Letterlike Symbols"](o)||Cn["Number Forms"](o)||Cn["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Cn["Control Pictures"](o)&&o!==9251||Cn["Optical Character Recognition"](o)||Cn["Enclosed Alphanumerics"](o)||Cn["Geometric Shapes"](o)||Cn["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Cn["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Cn["CJK Symbols and Punctuation"](o)||Cn.Katakana(o)||Cn["Private Use Area"](o)||Cn["CJK Compatibility Forms"](o)||Cn["Small Form Variants"](o)||Cn["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(h))}function uy(h){return Cn.Arabic(h)||Cn["Arabic Supplement"](h)||Cn["Arabic Extended-A"](h)||Cn["Arabic Presentation Forms-A"](h)||Cn["Arabic Presentation Forms-B"](h)}function Xf(h){return h>=1424&&h<=2303||Cn["Arabic Presentation Forms-A"](h)||Cn["Arabic Presentation Forms-B"](h)}function dm(h,o){return!(!o&&Xf(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Cn.Khmer(h))}function cy(h){for(const o of h)if(Xf(o.charCodeAt(0)))return!0;return!1}const Zf="deferred",lu="loading",Eh="loaded";let fm=null,ha="unavailable",Ll=null;const Ch=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(ha="error"),fm&&fm(h)};function pm(){Md.fire(new Us("pluginStateChange",{pluginStatus:ha,pluginURL:Ll}))}const Md=new tl,Rc=function(){return ha},hy=function(){if(ha!==Zf||!Ll)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ha=lu,pm(),Ll&&Fu({url:Ll},h=>{h?Ch(h):(ha=Eh,pm())})},da={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ha===Eh||da.applyArabicShaping!=null,isLoading:()=>ha===lu,setState(h){ha=h.pluginStatus,Ll=h.pluginURL},isParsed:()=>da.applyArabicShaping!=null&&da.processBidirectionalText!=null&&da.processStyledBidirectionalText!=null,getPluginURL:()=>Ll};class ei{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,d){for(const m of l)if(!dm(m.charCodeAt(0),d))return!1;return!0}(o,da.isLoaded())}}class uu{constructor(o,l,d,m){this.property=o,this.value=l,this.expression=function(f,y,T,M){if(qu(f))return new Ic(f,y);if(Id(f)||Array.isArray(f)&&f.length>0){const O=Hu(f,y,T,M);if(O.result==="error")throw new Error(O.value.map(w=>`${w.key}: ${w.message}`).join(", "));return O.value}{let O=f;return typeof f=="string"&&y.type==="color"&&(O=Fr.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>O}}}(l===void 0?o.specification.default:l,o.specification,d,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class mm{constructor(o,l,d){this.property=o,this.value=new uu(o,void 0,l,d)}transitioned(o,l){return new Yf(this.property,this.value,l,Mo({},o.transition,this.transition),o.now)}untransitioned(){return new Yf(this.property,this.value,null,{},0)}}class gm{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return js(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new mm(this._values[o].property,this._scope,this._options)),this._values[o].value=new uu(this._values[o].property,l===null?void 0:js(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);const d=this._properties.properties;if(o)for(const m in o){const f=o[m];if(m.endsWith("-transition")){const y=m.slice(0,-11);d[y]&&this.setTransition(y,f)}else d.hasOwnProperty(m)&&this.setValue(m,f)}}getTransition(o){return js(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new mm(this._values[o].property)),this._values[o].transition=js(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(o[l]=d);const m=this.getTransition(l);m!==void 0&&(o[`${l}-transition`]=m)}return o}transitioned(o,l){const d=new Pd(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].transitioned(o,l._values[m]);return d}untransitioned(){const o=new Pd(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Yf{constructor(o,l,d,m,f){const y=m.delay||0,T=m.duration||0;f=f||0,this.property=o,this.value=l,this.begin=f+y,this.end=this.begin+T,o.specification.transition&&(m.delay||m.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){const m=o.now||0,f=this.value.possiblyEvaluate(o,l,d),y=this.prior;if(y){if(m>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(m<this.begin)return y.possiblyEvaluate(o,l,d);{const T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,l,d),f,Ia(T))}}return f}}class Pd{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){const m=new Ol(this._properties);for(const f of Object.keys(this._values))m._values[f]=this._values[f].possiblyEvaluate(o,l,d);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class cu{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return js(this._values[o].value)}setValue(o,l){this._values[o]=new uu(this._values[o].property,l===null?void 0:js(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){const m=new Ol(this._properties);for(const f of Object.keys(this._values))m._values[f]=this._values[f].possiblyEvaluate(o,l,d);return m}}class Ms{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,l,d,m){return this.property.evaluate(this.value,this.parameters,o,l,d,m)}}class Ol{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Xt{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){const m=bc[this.specification.type];return m?m(o,l,d):o}}class ln{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,m){return new Ms(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(l,null,{},d,m)}:o.expression,l)}interpolate(o,l,d){if(o.value.kind!=="constant"||l.value.kind!=="constant")return o;if(o.value.value===void 0||l.value.value===void 0)return new Ms(this,{kind:"constant",value:void 0},o.parameters);const m=bc[this.specification.type];return m?new Ms(this,{kind:"constant",value:m(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,m,f,y){return o.kind==="constant"?o.value:o.evaluate(l,d,m,f,y)}}class ka{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,m){return!!o.expression.evaluate(l,null,{},d,m)}interpolate(){return!1}}class li{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new ei(0,{});for(const d in o){const m=o[d];m.specification.overridable&&this.overridableProperties.push(d);const f=this.defaultPropertyValues[d]=new uu(m,void 0),y=this.defaultTransitionablePropertyValues[d]=new mm(m);this.defaultTransitioningPropertyValues[d]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=f.possiblyEvaluate(l)}}}on(ln,"DataDrivenProperty"),on(Xt,"DataConstantProperty"),on(ka,"ColorRampProperty");var ft=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function dy(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Dl(h){if(Array.isArray(h))return h.map(Dl);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const o={};for(const l in h)o[l]=Dl(h[l]);return o}return dy(h)}function Xu(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const o of h.slice(1))if(!Xu(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function Kf(h,o="",l=null,d="fill"){if(h==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xu(h)||(h=Th(h));const m=h;let f=!0;try{f=function(w){if(!Ad(w))return w;let P=Dl(w);return _m(P),P=fy(P),P}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let y=null,T=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){T=ft[`filter_${d}`];const w=wh(f,T,o,l);if(w.result==="error")throw new Error(w.value.map(P=>`${P.key}: ${P.message}`).join(", "));y=(P,N,L)=>w.value.evaluate(P,N,{},L)}let M=null,O=null;if(f!==m){const w=wh(m,T,o,l);if(w.result==="error")throw new Error(w.value.map(P=>`${P.key}: ${P.message}`).join(", "));M=(P,N,L,D,B)=>w.value.evaluate(P,N,{},L,void 0,void 0,D,B),O=!ru(w.value.expression)}return{filter:y,dynamicFilter:M||void 0,needGeometry:Jf(f),needFeature:!!O}}function fy(h){if(!Array.isArray(h))return h;const o=function(l){if(ym.has(l[0])){for(let d=1;d<l.length;d++)if(Ad(l[d]))return!0}return l}(h);return o===!0?o:o.map(l=>fy(l))}function _m(h){let o=!1;const l=[];if(h[0]==="case"){for(let d=1;d<h.length-1;d+=2)o=o||Ad(h[d]),l.push(h[d+1]);l.push(h[h.length-1])}else if(h[0]==="match"){o=o||Ad(h[1]);for(let d=2;d<h.length-1;d+=2)l.push(h[d+1]);l.push(h[h.length-1])}else if(h[0]==="step"){o=o||Ad(h[1]);for(let d=1;d<h.length-1;d+=2)l.push(h[d+1])}o&&(h.length=0,h.push("any",...l));for(let d=1;d<h.length;d++)_m(h[d])}function Ad(h){if(!Array.isArray(h))return!1;if((o=h[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let l=1;l<h.length;l++)if(Ad(h[l]))return!0;return!1}const ym=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zu(h,o){return h<o?-1:h>o?1:0}function Jf(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let o=1;o<h.length;o++)if(Jf(h[o]))return!0;return!1}function Th(h){if(!h)return!0;const o=h[0];return h.length<=1?o!=="any":o==="=="?Fa(h[1],h[2],"=="):o==="!="?Mh(Fa(h[1],h[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Fa(h[1],h[2],o):o==="any"?(l=h.slice(1),["any"].concat(l.map(Th))):o==="all"?["all"].concat(h.slice(1).map(Th)):o==="none"?["all"].concat(h.slice(1).map(Th).map(Mh)):o==="in"?vm(h[1],h.slice(2)):o==="!in"?Mh(vm(h[1],h.slice(2))):o==="has"?Ih(h[1]):o!=="!has"||Mh(Ih(h[1]));var l}function Fa(h,o,l){switch(h){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,h,o]}}function vm(h,o){if(o.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",h,["literal",o.sort(Zu)]]:["filter-in-small",h,["literal",o]]}}function Ih(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Mh(h){return["!",h]}const Qf="";function Gi(h,o){return o?`${h}${Qf}${o}`:h}const Nl="-transition",Og=new Set(["fill","line","background","hillshade","raster"]);class Oo extends tl{constructor(o,l,d,m,f){if(super(),this.id=o.id,this.fqid=Gi(this.id,d),this.type=o.type,this.scope=d,this.lut=m,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const y=wh(this.filter,ft[`filter_${o.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new cu(l.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new gm(l.paint,this.scope,f);for(const y in o.paint)this.setPaintProperty(y,o.paint[y]);for(const y in o.layout)this.setLayoutProperty(y,o.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ol(l.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&Og.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if(this.type==="custom"&&o==="visibility")return void(this.visibility=l);const d=this._unevaluatedLayout;d._properties.properties[o]&&(d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),o==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(Nl)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){const d=this._transitionablePaint,m=d._properties.properties;if(o.endsWith(Nl)){const P=o.slice(0,-11);return m[P]&&d.setTransition(P,l||void 0),!1}if(!m[o])return!1;const f=d._values[o],y=f.value.isDataDriven(),T=f.value;d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const M=d._values[o].value,O=M.isDataDriven(),w=o.endsWith("pattern")||o==="line-dasharray";return O||y||w||this._handleOverridablePaintPropertyUpdate(o,T,M)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,d){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return Nu({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}is3D(o){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof Ms&&Ri(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=Kf(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,d,m,f,y,T,M,O){}}const Dg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rd{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qn(h,o=1){let l=0,d=0;return{members:h.map(m=>{const f=Dg[m.type].BYTES_PER_ELEMENT,y=l=Jo(l,Math.max(o,f)),T=m.components||1;return d=Math.max(d,f),l+=f*T,{name:m.name,type:m.type,components:T,offset:y}}),size:Jo(l,Math.max(d,o)),alignment:o}}function Jo(h,o){return Math.ceil(h/o)*o}class eo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const m=2*o;return this.int16[m+0]=l,this.int16[m+1]=d,o}}eo.prototype.bytesPerElement=4,on(eo,"StructArrayLayout2i4");class Lc extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){const f=3*o;return this.int16[f+0]=l,this.int16[f+1]=d,this.int16[f+2]=m,o}}Lc.prototype.bytesPerElement=6,on(Lc,"StructArrayLayout3i6");class ul extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d,m)}emplace(o,l,d,m,f){const y=4*o;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=m,this.int16[y+3]=f,o}}ul.prototype.bytesPerElement=8,on(ul,"StructArrayLayout4i8");class hu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}hu.prototype.bytesPerElement=4,on(hu,"StructArrayLayout1f4");class xm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){const f=4*o,y=2*o;return this.int16[f+0]=l,this.int16[f+1]=d,this.float32[y+1]=m,o}}xm.prototype.bytesPerElement=8,on(xm,"StructArrayLayout2i1f8");class bs extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){const f=4*o;return this.int16[f+0]=l,this.int16[f+1]=d,this.int16[f+2]=m,o}}bs.prototype.bytesPerElement=8,on(bs,"StructArrayLayout3i8");class za extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m,f)}emplace(o,l,d,m,f,y){const T=5*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=m,this.int16[T+3]=f,this.int16[T+4]=y,o}}za.prototype.bytesPerElement=10,on(za,"StructArrayLayout5i10");class bm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,d,m,f,y,T)}emplace(o,l,d,m,f,y,T,M){const O=6*o,w=12*o,P=3*o;return this.int16[O+0]=l,this.int16[O+1]=d,this.uint8[w+4]=m,this.uint8[w+5]=f,this.uint8[w+6]=y,this.uint8[w+7]=T,this.float32[P+2]=M,o}}bm.prototype.bytesPerElement=12,on(bm,"StructArrayLayout2i4ub1f12");class cl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){const f=3*o;return this.float32[f+0]=l,this.float32[f+1]=d,this.float32[f+2]=m,o}}cl.prototype.bytesPerElement=12,on(cl,"StructArrayLayout3f12");class Ps extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m,f)}emplace(o,l,d,m,f,y){const T=6*o,M=3*o;return this.uint16[T+0]=l,this.uint16[T+1]=d,this.uint16[T+2]=m,this.uint16[T+3]=f,this.float32[M+2]=y,o}}Ps.prototype.bytesPerElement=12,on(Ps,"StructArrayLayout4ui1f12");class fa extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d,m)}emplace(o,l,d,m,f){const y=4*o;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=m,this.uint16[y+3]=f,o}}fa.prototype.bytesPerElement=8,on(fa,"StructArrayLayout4ui8");class Ph extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,f,y)}emplace(o,l,d,m,f,y,T){const M=6*o;return this.int16[M+0]=l,this.int16[M+1]=d,this.int16[M+2]=m,this.int16[M+3]=f,this.int16[M+4]=y,this.int16[M+5]=T,o}}Ph.prototype.bytesPerElement=12,on(Ph,"StructArrayLayout6i12");class wm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P,N){const L=this.length;return this.resize(L+1),this.emplace(L,o,l,d,m,f,y,T,M,O,w,P,N)}emplace(o,l,d,m,f,y,T,M,O,w,P,N,L){const D=12*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.int16[D+2]=m,this.int16[D+3]=f,this.uint16[D+4]=y,this.uint16[D+5]=T,this.uint16[D+6]=M,this.uint16[D+7]=O,this.int16[D+8]=w,this.int16[D+9]=P,this.int16[D+10]=N,this.int16[D+11]=L,o}}wm.prototype.bytesPerElement=24,on(wm,"StructArrayLayout4i4ui4i24");class Sm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,f,y)}emplace(o,l,d,m,f,y,T){const M=10*o,O=5*o;return this.int16[M+0]=l,this.int16[M+1]=d,this.int16[M+2]=m,this.float32[O+2]=f,this.float32[O+3]=y,this.float32[O+4]=T,o}}Sm.prototype.bytesPerElement=20,on(Sm,"StructArrayLayout3i3f20");class Ah extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d,m)}emplace(o,l,d,m,f){const y=4*o;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=m,this.float32[y+3]=f,o}}Ah.prototype.bytesPerElement=16,on(Ah,"StructArrayLayout4f16");class Ng extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Ng.prototype.bytesPerElement=4,on(Ng,"StructArrayLayout1ul4");class Oc extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const m=2*o;return this.uint16[m+0]=l,this.uint16[m+1]=d,o}}Oc.prototype.bytesPerElement=4,on(Oc,"StructArrayLayout2ui4");class kg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P,N,L){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,d,m,f,y,T,M,O,w,P,N,L)}emplace(o,l,d,m,f,y,T,M,O,w,P,N,L,D){const B=20*o,q=10*o;return this.int16[B+0]=l,this.int16[B+1]=d,this.int16[B+2]=m,this.int16[B+3]=f,this.int16[B+4]=y,this.float32[q+3]=T,this.float32[q+4]=M,this.float32[q+5]=O,this.float32[q+6]=w,this.int16[B+14]=P,this.uint32[q+8]=N,this.uint16[B+18]=L,this.uint16[B+19]=D,o}}kg.prototype.bytesPerElement=40,on(kg,"StructArrayLayout5i4f1i1ul2ui40");class ep extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,d,m,f,y,T)}emplace(o,l,d,m,f,y,T,M){const O=8*o;return this.int16[O+0]=l,this.int16[O+1]=d,this.int16[O+2]=m,this.int16[O+4]=f,this.int16[O+5]=y,this.int16[O+6]=T,this.int16[O+7]=M,o}}ep.prototype.bytesPerElement=16,on(ep,"StructArrayLayout3i2i2i16");class Fg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m,f)}emplace(o,l,d,m,f,y){const T=4*o,M=8*o;return this.float32[T+0]=l,this.float32[T+1]=d,this.float32[T+2]=m,this.int16[M+6]=f,this.int16[M+7]=y,o}}Fg.prototype.bytesPerElement=16,on(Fg,"StructArrayLayout2f1f2i16");class zg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,f,y)}emplace(o,l,d,m,f,y,T){const M=20*o,O=5*o;return this.uint8[M+0]=l,this.uint8[M+1]=d,this.float32[O+1]=m,this.float32[O+2]=f,this.float32[O+3]=y,this.float32[O+4]=T,o}}zg.prototype.bytesPerElement=20,on(zg,"StructArrayLayout2ub4f20");class Qo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){const f=3*o;return this.uint16[f+0]=l,this.uint16[f+1]=d,this.uint16[f+2]=m,o}}Qo.prototype.bytesPerElement=6,on(Qo,"StructArrayLayout3ui6");class Rh extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le){const fe=this.length;return this.resize(fe+1),this.emplace(fe,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le)}emplace(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le,fe){const _e=30*o,Me=15*o,Ce=60*o;return this.int16[_e+0]=l,this.int16[_e+1]=d,this.int16[_e+2]=m,this.float32[Me+2]=f,this.float32[Me+3]=y,this.uint16[_e+8]=T,this.uint16[_e+9]=M,this.uint32[Me+5]=O,this.uint32[Me+6]=w,this.uint32[Me+7]=P,this.uint16[_e+16]=N,this.uint16[_e+17]=L,this.uint16[_e+18]=D,this.float32[Me+10]=B,this.float32[Me+11]=q,this.uint8[Ce+48]=Z,this.uint8[Ce+49]=re,this.uint8[Ce+50]=ne,this.uint32[Me+13]=te,this.int16[_e+28]=le,this.uint8[Ce+58]=fe,o}}Rh.prototype.bytesPerElement=60,on(Rh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Em extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe,Je,st,rt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe,Je,st,rt)}emplace(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne,te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe,Je,st,rt,dt){const lt=20*o,pt=40*o,kt=80*o;return this.float32[lt+0]=l,this.float32[lt+1]=d,this.int16[pt+4]=m,this.int16[pt+5]=f,this.int16[pt+6]=y,this.int16[pt+7]=T,this.int16[pt+8]=M,this.int16[pt+9]=O,this.int16[pt+10]=w,this.int16[pt+11]=P,this.int16[pt+12]=N,this.uint16[pt+13]=L,this.uint16[pt+14]=D,this.uint16[pt+15]=B,this.uint16[pt+16]=q,this.uint16[pt+17]=Z,this.uint16[pt+18]=re,this.uint16[pt+19]=ne,this.uint16[pt+20]=te,this.uint16[pt+21]=le,this.uint16[pt+22]=fe,this.uint16[pt+23]=_e,this.uint16[pt+24]=Me,this.uint16[pt+25]=Ce,this.uint16[pt+26]=Te,this.uint16[pt+27]=Ge,this.uint32[lt+14]=Ae,this.float32[lt+15]=He,this.float32[lt+16]=Qe,this.float32[lt+17]=Je,this.float32[lt+18]=st,this.uint8[kt+76]=rt,this.uint16[pt+39]=dt,o}}Em.prototype.bytesPerElement=80,on(Em,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class As extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m,f)}emplace(o,l,d,m,f,y){const T=5*o;return this.float32[T+0]=l,this.float32[T+1]=d,this.float32[T+2]=m,this.float32[T+3]=f,this.float32[T+4]=y,o}}As.prototype.bytesPerElement=20,on(As,"StructArrayLayout5f20");class Ld extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,d,m,f,y,T)}emplace(o,l,d,m,f,y,T,M){const O=7*o;return this.float32[O+0]=l,this.float32[O+1]=d,this.float32[O+2]=m,this.float32[O+3]=f,this.float32[O+4]=y,this.float32[O+5]=T,this.float32[O+6]=M,o}}Ld.prototype.bytesPerElement=28,on(Ld,"StructArrayLayout7f28");class Bg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P){const N=this.length;return this.resize(N+1),this.emplace(N,o,l,d,m,f,y,T,M,O,w,P)}emplace(o,l,d,m,f,y,T,M,O,w,P,N){const L=11*o;return this.float32[L+0]=l,this.float32[L+1]=d,this.float32[L+2]=m,this.float32[L+3]=f,this.float32[L+4]=y,this.float32[L+5]=T,this.float32[L+6]=M,this.float32[L+7]=O,this.float32[L+8]=w,this.float32[L+9]=P,this.float32[L+10]=N,o}}Bg.prototype.bytesPerElement=44,on(Bg,"StructArrayLayout11f44");class Cm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,d,m,f,y,T,M,O)}emplace(o,l,d,m,f,y,T,M,O,w){const P=9*o;return this.float32[P+0]=l,this.float32[P+1]=d,this.float32[P+2]=m,this.float32[P+3]=f,this.float32[P+4]=y,this.float32[P+5]=T,this.float32[P+6]=M,this.float32[P+7]=O,this.float32[P+8]=w,o}}Cm.prototype.bytesPerElement=36,on(Cm,"StructArrayLayout9f36");class Od extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const m=2*o;return this.float32[m+0]=l,this.float32[m+1]=d,o}}Od.prototype.bytesPerElement=8,on(Od,"StructArrayLayout2f8");class tp extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d,m)}emplace(o,l,d,m,f){const y=6*o;return this.uint32[3*o+0]=l,this.uint16[y+2]=d,this.uint16[y+3]=m,this.uint16[y+4]=f,o}}tp.prototype.bytesPerElement=12,on(tp,"StructArrayLayout1ul3ui12");class Tm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Tm.prototype.bytesPerElement=2,on(Tm,"StructArrayLayout1ui2");class Im extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q)}emplace(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z){const re=16*o;return this.float32[re+0]=l,this.float32[re+1]=d,this.float32[re+2]=m,this.float32[re+3]=f,this.float32[re+4]=y,this.float32[re+5]=T,this.float32[re+6]=M,this.float32[re+7]=O,this.float32[re+8]=w,this.float32[re+9]=P,this.float32[re+10]=N,this.float32[re+11]=L,this.float32[re+12]=D,this.float32[re+13]=B,this.float32[re+14]=q,this.float32[re+15]=Z,o}}Im.prototype.bytesPerElement=64,on(Im,"StructArrayLayout16f64");class np extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,f,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,d,m,f,y,T)}emplace(o,l,d,m,f,y,T,M){const O=10*o,w=5*o;return this.uint16[O+0]=l,this.uint16[O+1]=d,this.uint16[O+2]=m,this.uint16[O+3]=f,this.float32[w+2]=y,this.float32[w+3]=T,this.float32[w+4]=M,o}}np.prototype.bytesPerElement=20,on(np,"StructArrayLayout4ui3f20");class Mm extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}Mm.prototype.bytesPerElement=2,on(Mm,"StructArrayLayout1i2");class jg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}jg.prototype.bytesPerElement=1,on(jg,"StructArrayLayout1ub1");class Vg extends Rd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Vg.prototype.size=40;class Pm extends kg{get(o){return new Vg(this,o)}}on(Pm,"CollisionBoxArray");class py extends Rd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}py.prototype.size=60;class Dv extends Rh{get(o){return new py(this,o)}}on(Dv,"PlacedSymbolArray");class Nv extends Rd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Nv.prototype.size=80;class my extends Em{get(o){return new Nv(this,o)}}on(my,"SymbolInstanceArray");class gy extends hu{getoffsetX(o){return this.float32[1*o+0]}}on(gy,"GlyphOffsetArray");class rp extends eo{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}on(rp,"SymbolLineVertexArray");class Lh extends Rd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lh.prototype.size=12;class Ba extends tp{get(o){return new Lh(this,o)}}on(Ba,"FeatureIndexArray");class Am extends Oc{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}on(Am,"FillExtrusionCentroidArray");class kv extends Rd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}kv.prototype.size=6;class kl extends Lc{get(o){return new kv(this,o)}}on(kl,"FillExtrusionWallArray");const _y=qn([{name:"a_pos",components:2,type:"Int16"}],4),Ug=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xi{constructor(o=[]){this.segments=o}_prepareSegment(o,l,d,m){let f=this.segments[this.segments.length-1];return o>xi.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!f||f.vertexLength+o>xi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==m)&&(f={vertexOffset:l,primitiveOffset:d,vertexLength:0,primitiveLength:0},m!==void 0&&(f.sortKey=m),this.segments.push(f)),f}prepareSegment(o,l,d,m){return this._prepareSegment(o,l.length,d.length,m)}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,m){return new xi([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:m,vaos:{},sortKey:0}])}}function yy(h,o){return 256*(h=er(Math.floor(h),0,255))+er(Math.floor(o),0,255)}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,on(xi,"SegmentVector");const Gg=qn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vy=qn([{name:"a_dash",components:4,type:"Uint16"}]);class Yu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,d,m){this.ids.push(Rm(o)),this.positions.push(l,d,m)}eachPosition(o,l){const d=Rm(o);let m=0,f=this.ids.length-1;for(;m<f;){const y=m+f>>1;this.ids[y]>=d?f=y:m=y+1}for(;this.ids[m]===d;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(o,l){const d=new Float64Array(o.ids),m=new Uint32Array(o.positions);return Dd(d,m,0,d.length-1),l&&(l.add(d.buffer),l.add(m.buffer)),{ids:d,positions:m}}static deserialize(o){const l=new Yu;let d;l.ids=o.ids,l.positions=o.positions;for(const m of l.ids)m!==d&&l.uniqueIds.push(m),d=m;return l.indexed=!0,l}}function Rm(h){const o=+h;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:el(String(h))}function Dd(h,o,l,d){for(;l<d;){const m=h[l+d>>1];let f=l-1,y=d+1;for(;;){do f++;while(h[f]<m);do y--;while(h[y]>m);if(f>=y)break;$g(h,f,y),$g(o,3*f,3*y),$g(o,3*f+1,3*y+1),$g(o,3*f+2,3*y+2)}y-l<d-y?(Dd(h,o,l,y),l=y+1):(Dd(h,o,y+1,d),d=y)}}function $g(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}on(Yu,"FeaturePositionMap");class du{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ip extends du{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class to extends du{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class hl extends du{constructor(o){super(o),this.current=[0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Nd extends du{constructor(o){super(o),this.current=[0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class Lm extends du{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class pa extends du{constructor(o){super(o),this.current=Fr.transparent.toRenderColor(null)}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const Hs=new Float32Array(16);class op extends du{constructor(o){super(o),this.current=Hs}set(o,l,d){if(this.fetchUniformLocation(o,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let m=1;m<16;m++)if(d[m]!==this.current[m]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const qg=new Float32Array(9),Fv=new Float32Array(4);class Hg extends du{constructor(o){super(o),this.current=Fv}set(o,l,d){if(this.fetchUniformLocation(o,l)){for(let m=0;m<4;m++)if(d[m]!==this.current[m]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function Wg(h){return[yy(255*h.r,255*h.g),yy(255*h.b,255*h.a)]}class kd{constructor(o,l,d,m){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=d,this.context=m}setUniform(o,l,d,m,f){const y=m.constantOr(this.value);l.set(o,f,y instanceof Fr?y.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(o,l){return this.type==="color"?new pa(o):new to(o)}}class Oh{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,d,m,f){const y=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;y&&l.set(o,f,y)}getBinding(o,l){return l==="u_pattern"||l==="u_dash"?new Lm(o):new to(o)}}class fu{constructor(o,l,d,m){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(f=>({name:`a_${f}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,l,d,m,f,y,T){const M=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ei(0,{brightness:y}),l,{},f,m,T):this.expression.kind==="constant"&&this.expression.value,w=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ei(0,{brightness:y}),l,{},f,m,T):this.lutExpression.value)==="none";this.paintVertexArray.resize(o),this._setPaintValue(M,o,O,w?null:this.context.lut)}updatePaintArray(o,l,d,m,f,y,T){const M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T},d,m,void 0,f):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ei(0,{brightness:T}),d,m,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(o,l,M,O?null:this.context.lut)}_setPaintValue(o,l,d,m){if(this.type==="color"){const f=Wg(d.toRenderColor(m));for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(o,l,d,m,f,y){this.expression=o,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=m,this.context=f,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,l,d,m,f,y,T){const M=this.expression.evaluate(new ei(this.context.zoom,{brightness:y}),l,{},f,m,T),O=this.expression.evaluate(new ei(this.context.zoom+1,{brightness:y}),l,{},f,m,T),w=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ei(0,{brightness:y}),l,{},f,m,T):this.lutExpression.value)==="none",P=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(P,o,M,O,w?null:this.context.lut)}updatePaintArray(o,l,d,m,f,y,T){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:T},d,m,void 0,f),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},d,m,void 0,f),w=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ei(0,{brightness:T}),d,m,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(o,l,M,O,w?null:this.context.lut)}_setPaintValue(o,l,d,m,f){if(this.type==="color"){const y=Wg(d.toRenderColor(f)),T=Wg(d.toRenderColor(f));for(let M=o;M<l;M++)this.paintVertexArray.emplace(M,y[0],y[1],T[0],T[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,d,m);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,m,f){const y=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,T=er(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);l.set(o,f,T)}getBinding(o,l){return new to(o)}}class Dc{constructor(o,l,d,m,f){this.expression=o,this.layerId=f,this.paintVertexAttributes=(d==="array"?vy:Gg).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new m}populatePaintArray(o,l,d,m){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,m,f,y,T){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(o,l,d,m){if(!m||!d)return;const f=m[d];if(!f)return;const{tl:y,br:T,pixelRatio:M}=f;for(let O=o;O<l;O++)this.paintVertexArray.emplace(O,y[0],y[1],T[0],T[1],M)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nc{constructor(o,l,d=()=>!0){this.binders={},this._buffers=[],this.context=l;const m=[];for(const f in o.paint._values){const y=o.paint.get(f);if(f.endsWith("-use-theme")||!d(f)||!(y instanceof Ms&&Ri(y.property.specification)))continue;const T=xy(f,o.type),M=y.value,O=y.property.specification.type,w=!!y.property.useIntegerZoom,P=f==="line-dasharray"||f.endsWith("pattern"),N=o.paint.get(`${f}-use-theme`),L=f==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(M.kind!=="constant"||L)if(M.kind==="source"||L||P){const D=by(f,O,"source");this.binders[f]=P?new Dc(M,T,O,D,o.id):new fu(M,T,O,D),m.push(`/a_${f}`)}else{const D=by(f,O,"composite");this.binders[f]=new Fl(M,T,O,w,l,D),m.push(`/z_${f}`)}else this.binders[f]=P?new Oh(M.value,T):new kd(M.value,T,O,l),m.push(`/u_${f}`);N&&(this.binders[f].lutExpression=N.value)}this.cacheKey=m.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof fu||l instanceof Fl?l.maxValue:0}populatePaintArrays(o,l,d,m,f,y,T){for(const M in this.binders){const O=this.binders[M];O.context=this.context,(O instanceof fu||O instanceof Fl||O instanceof Dc)&&O.populatePaintArray(o,l,d,m,f,y,T)}}setConstantPatternPositions(o){for(const l in this.binders){const d=this.binders[l];d instanceof Oh&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,l,d,m,f,y,T,M,O){let w=!1;const P=Object.keys(o),N=P.length!==0&&!M,L=N?P:l.uniqueIds;this.context.lut=f.lut;for(const D in this.binders){const B=this.binders[D];if(B.context=this.context,(B instanceof fu||B instanceof Fl||B instanceof Dc)&&B.expression&&B.expression.kind&&B.expression.kind!=="constant"&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const q=f.paint.get(D);B.expression=q.value;for(const Z of L){const re=o[Z.toString()];l.eachPosition(Z,(ne,te,le)=>{const fe=m.feature(ne);B.updatePaintArray(te,le,fe,re,y,T,O)})}if(!N)for(const Z of d.uniqueIds){const re=o[Z.toString()];d.eachPosition(Z,(ne,te,le)=>{const fe=m.feature(ne);B.updatePaintArray(te,le,fe,re,y,T,O)})}w=!0}}return w}defines(){const o=[];for(const l in this.binders){const d=this.binders[l];(d instanceof kd||d instanceof Oh)&&o.push(...d.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof fu||d instanceof Fl||d instanceof Dc)for(let m=0;m<d.paintVertexAttributes.length;m++)o.push(d.paintVertexAttributes[m].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof kd||d instanceof Oh||d instanceof Fl)for(const m of d.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof kd||m instanceof Oh||m instanceof Fl)for(const f of m.uniformNames)l.push({name:f,property:d,binding:m.getBinding(o,f)})}return l}setUniforms(o,l,d,m,f){for(const{name:y,property:T,binding:M}of d)this.binders[T].setUniform(o,M,f,m.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof fu||l instanceof Fl||l instanceof Dc)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const d=this.binders[l];(d instanceof fu||d instanceof Fl||d instanceof Dc)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof fu||l instanceof Fl||l instanceof Dc)&&l.destroy()}}}class Ku{constructor(o,l,d=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new Nc(m,l,d);this.needsUpload=!1,this._featureMap=new Yu,this._featureMapWithoutIds=new Yu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,d,m,f,y,T,M){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(o,l,m,f,y,T,M);l.id!==void 0?this._featureMap.add(l.id,d,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,m,f,y,T){for(const M of d)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,M,m,f,y,T||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const zv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function xy(h,o){return zv[h]||[h.replace(`${o}-`,"").replace(/-/g,"_")]}const Xg={"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps},"line-dasharray":{source:fa,composite:fa}},Zg={color:{source:Od,composite:Ah},number:{source:hu,composite:Od}};function by(h,o,l){const d=Xg[h];return d&&d[l]||Zg[o][l]}on(kd,"ConstantBinder"),on(Oh,"PatternConstantBinder"),on(fu,"SourceExpressionBinder"),on(Dc,"PatternCompositeBinder"),on(Fl,"CompositeExpressionBinder"),on(Nc,"ProgramConfiguration",{omit:["_buffers"]}),on(Ku,"ProgramConfigurationSet");const ws=Qt/Math.PI/2,Fd=5,Om=6,Ju=16383,sp=64,Dm=[sp,32,16],ma=-ws,ja=ws;function zd(h,o,l,d=ws){return l=cr(l),[h*Math.sin(l)*d,-o*d,h*Math.cos(l)*d]}function pu(h,o,l){return zd(Math.cos(cr(h)),Math.sin(cr(h)),o,l)}const Do=63710088e-1,wy=2*Math.PI*Do;class zr{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zr(Pa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,d=this.lat*l,m=o.lat*l,f=Math.sin(d)*Math.sin(m)+Math.cos(d)*Math.cos(m)*Math.cos((o.lng-this.lng)*l);return Do*Math.acos(Math.min(f,1))}toBounds(o=0){const l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new mu({lng:this.lng-d,lat:this.lat-l},{lng:this.lng+d,lat:this.lat+l})}toEcef(o){return pu(this.lat,this.lng,ws+o*ws/Do)}static convert(o){if(o instanceof zr)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new zr(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new zr(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class mu{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(o.length===4){const d=o;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=o;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(o){return this._ne=o instanceof zr?new zr(o.lng,o.lat):zr.convert(o),this}setSouthWest(o){return this._sw=o instanceof zr?new zr(o.lng,o.lat):zr.convert(o),this}extend(o){const l=this._sw,d=this._ne;let m,f;if(o instanceof zr)m=o,f=o;else{if(!(o instanceof mu))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(mu.convert(o)):this.extend(zr.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(zr.convert(o)):this;if(m=o._sw,f=o._ne,!m||!f)return this}return l||d?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),d.lng=Math.max(f.lng,d.lng),d.lat=Math.max(f.lat,d.lat)):(this._sw=new zr(m.lng,m.lat),this._ne=new zr(f.lng,f.lat)),this}getCenter(){return new zr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new zr(this.getWest(),this.getNorth())}getSouthEast(){return new zr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:d}=zr.convert(o);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(o){if(o)return o instanceof mu?o:new mu(o)}}const Ws=0,kx=25.5;function $n(h){return wy*Math.cos(h*Math.PI/180)}function ga(h){return(180+h)/360}function es(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function us(h,o){return h/$n(o)}function Va(h){return 360*h-180}function go(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function ap(h,o){return h*$n(go(o))}const Rs=85.051129;function Sy(h){return Math.cos(cr(er(h,-85.051129,Rs)))}function kc(h,o){const l=er(o,Ws,kx),d=Math.pow(2,l);return Sy(h)*wy/(512*d)}function Bv(h){return 1/Math.cos(h*Math.PI/180)}function _(h,o=0){const l=Math.exp(Math.PI*(1-(h.y+o/Qt)/(1<<h.z)*2));return 80150034*l/(l*l+1)/Qt/(1<<h.z)}class s{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){const d=zr.convert(o);return new s(ga(d.lng),es(d.lat),us(l,d.lat))}toLngLat(){return new zr(Va(this.x),go(this.y))}toAltitude(){return ap(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wy*Bv(go(this.y))}}function c(h,o,l,d,m,f,y,T,M){const O=(o+d)/2,w=(l+m)/2,P=new Gt(O,w);T(P),function(N,L,D,B,q,Z){const re=D-q,ne=B-Z;return Math.abs((B-L)*re-(D-N)*ne)/Math.hypot(re,ne)}(P.x,P.y,f.x,f.y,y.x,y.y)>=M?(c(h,o,l,O,w,f,P,T,M),c(h,O,w,d,m,P,y,T,M)):h.push(y)}function g(h,o,l){let d=h[0],m=d.x,f=d.y;o(d);const y=[d];for(let T=1;T<h.length;T++){const M=h[T],{x:O,y:w}=M;o(M),c(y,m,f,O,w,d,M,o,l),m=O,f=w,d=M}return y}function x(h,o,l,d){if(d(o,l)){const m=o.add(l)._mult(.5);x(h,o,m,d),x(h,m,l,d)}else h.push(l)}function E(h,o){let l=h[0];const d=[l];for(let m=1;m<h.length;m++){const f=h[m];x(d,l,f,o),l=f}return d}const I=Math.pow(2,14)-1,k=-I-1;function j(h,o){const l=Math.round(h.x*o),d=Math.round(h.y*o);return h.x=er(l,k,I),h.y=er(d,k,I),(l<h.x||l>h.x+1||d<h.y||d>h.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),h}function U(h,o,l){const d=h.loadGeometry(),m=h.extent,f=Qt/m;if(o&&l&&l.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:T,x:M,y:O,projection:w}=l,P=N=>{const L=Va((o.x+N.x/m)/y),D=go((o.y+N.y/m)/y),B=w.project(L,D);N.x=(B.x*T-M)*m,N.y=(B.y*T-O)*m};for(let N=0;N<d.length;N++)if(h.type!==1)d[N]=g(d[N],P,1);else{const L=[];for(const D of d[N])D.x<0||D.x>=m||D.y<0||D.y>=m||(P(D),L.push(D));d[N]=L}}for(const y of d)for(const T of y)j(T,f);return d}function $(h,o){return{type:h.type,id:h.id,properties:h.properties,geometry:o?U(h):[]}}function Q(h,o,l,d,m){h.emplaceBack(2*o+(d+1)/2,2*l+(m+1)/2)}function J(h,o,l){h.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class oe{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new eo,this.indexArray=new Qo,this.segments=new xi,this.programConfigurations=new Ku(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,d,m){const f=this.layers[0],y=[];let T=null;f.type==="circle"&&(T=f.layout.get("circle-sort-key"));for(const{feature:O,id:w,index:P,sourceLayerIndex:N}of o){const L=this.layers[0]._featureFilter.needGeometry,D=$(O,L);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),D,d))continue;const B=T?T.evaluate(D,{},d):void 0,q={id:w,properties:O.properties,type:O.type,sourceLayerIndex:N,index:P,geometry:L?D.geometry:U(O,d,m),patterns:{},sortKey:B};y.push(q)}T&&y.sort((O,w)=>O.sortKey-w.sortKey);let M=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Ph,M=m.projection);for(const O of y){const{geometry:w,index:P,sourceLayerIndex:N}=O,L=o[P].feature;this.addFeature(O,w,P,l.availableImages,d,M,l.brightness),l.featureIndex.insert(L,w,P,N,this.index)}}update(o,l,d,m,f,y,T){this.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_y.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Ug.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,m,f,y,T){for(const M of l)for(const O of M){const w=O.x,P=O.y;if(w<0||w>=Qt||P<0||P>=Qt)continue;if(y){const D=y.projectTilePoint(w,P,f),B=y.upVector(f,w,P),q=this.globeExtVertexArray;J(q,D,B),J(q,D,B),J(q,D,B),J(q,D,B)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=N.vertexLength;Q(this.layoutVertexArray,w,P,-1,-1),Q(this.layoutVertexArray,w,P,1,-1),Q(this.layoutVertexArray,w,P,1,1),Q(this.layoutVertexArray,w,P,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},m,f,T)}}function pe(h,o){for(let l=0;l<h.length;l++)if(Ne(o,h[l]))return!0;for(let l=0;l<o.length;l++)if(Ne(h,o[l]))return!0;return!!Ee(h,o)}function ce(h,o,l){return!!Ne(h,o)||!!Ie(o,h,l)}function me(h,o){if(h.length===1)return Oe(o,h[0]);for(let l=0;l<o.length;l++){const d=o[l];for(let m=0;m<d.length;m++)if(Ne(h,d[m]))return!0}for(let l=0;l<h.length;l++)if(Oe(o,h[l]))return!0;for(let l=0;l<o.length;l++)if(Ee(h,o[l]))return!0;return!1}function ve(h,o,l){if(h.length>1){if(Ee(h,o))return!0;for(let d=0;d<o.length;d++)if(Ie(o[d],h,l))return!0}for(let d=0;d<h.length;d++)if(Ie(h[d],o,l))return!0;return!1}function Ee(h,o){if(h.length===0||o.length===0)return!1;for(let l=0;l<h.length-1;l++){const d=h[l],m=h[l+1];for(let f=0;f<o.length-1;f++)if(Pe(d,m,o[f],o[f+1]))return!0}return!1}function Pe(h,o,l,d){return Hr(h,l,d)!==Hr(o,l,d)&&Hr(h,o,l)!==Hr(h,o,d)}function Ie(h,o,l){const d=l*l;if(o.length===1)return h.distSqr(o[0])<d;for(let m=1;m<o.length;m++)if(Be(h,o[m-1],o[m])<d)return!0;return!1}function Be(h,o,l){const d=o.distSqr(l);if(d===0)return h.distSqr(o);const m=((h.x-o.x)*(l.x-o.x)+(h.y-o.y)*(l.y-o.y))/d;return h.distSqr(m<0?o:m>1?l:l.sub(o)._mult(m)._add(o))}function Oe(h,o){let l,d,m,f=!1;for(let y=0;y<h.length;y++){l=h[y];for(let T=0,M=l.length-1;T<l.length;M=T++)d=l[T],m=l[M],d.y>o.y!=m.y>o.y&&o.x<(m.x-d.x)*(o.y-d.y)/(m.y-d.y)+d.x&&(f=!f)}return f}function Ne(h,o){let l=!1;for(let d=0,m=h.length-1;d<h.length;m=d++){const f=h[d],y=h[m];f.y>o.y!=y.y>o.y&&o.x<(y.x-f.x)*(o.y-f.y)/(y.y-f.y)+f.x&&(l=!l)}return l}function ze(h,o,l,d,m){for(const y of h)if(o<=y.x&&l<=y.y&&d>=y.x&&m>=y.y)return!0;const f=[new Gt(o,l),new Gt(o,m),new Gt(d,m),new Gt(d,l)];if(h.length>2){for(const y of f)if(Ne(h,y))return!0}for(let y=0;y<h.length-1;y++)if(Ue(h[y],h[y+1],f))return!0;return!1}function Ue(h,o,l){const d=l[0],m=l[2];if(h.x<d.x&&o.x<d.x||h.x>m.x&&o.x>m.x||h.y<d.y&&o.y<d.y||h.y>m.y&&o.y>m.y)return!1;const f=Hr(h,o,l[0]);return f!==Hr(h,o,l[1])||f!==Hr(h,o,l[2])||f!==Hr(h,o,l[3])}function Ye(h,o,l,d,m,f){let y=o.y-h.y,T=h.x-o.x;if(f=f||0){const M=y*y+T*T;if(M===0)return!0;const O=Math.sqrt(M);y/=O,T/=O}return!((l.x-h.x)*y+(l.y-h.y)*T-f<0||(d.x-h.x)*y+(d.y-h.y)*T-f<0||(m.x-h.x)*y+(m.y-h.y)*T-f<0)}function vt(h,o,l,d,m,f,y){return!(Ye(h,o,d,m,f,y)||Ye(o,l,d,m,f,y)||Ye(l,h,d,m,f,y)||Ye(d,m,h,o,l,y)||Ye(m,f,h,o,l,y)||Ye(f,d,h,o,l,y))}function ct(h,o,l){const d=o.paint.get(h).value;return d.kind==="constant"?d.value:l.programConfigurations.get(o.id).getMaxValue(h)}function Pt(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function At(h,o,l,d,m){if(!o[0]&&!o[1])return h;const f=Gt.convert(o)._mult(m);l==="viewport"&&f._rotate(-d);const y=[];for(let T=0;T<h.length;T++)y.push(h[T].sub(f));return y}function jt(h,o,l,d){const m=Gt.convert(h)._mult(d);return o==="viewport"&&m._rotate(-l),m}let ut,It;on(oe,"CircleBucket",{omit:["layers"]});var nt,Mt={exports:{}},St=(nt||(nt=1,function(h,o){(function(l){function d(f,y,T){var M=m(256*f,256*(y=Math.pow(2,T)-y-1),T),O=m(256*(f+1),256*(y+1),T);return M[0]+","+M[1]+","+O[0]+","+O[1]}function m(f,y,T){var M=2*Math.PI*6378137/256/Math.pow(2,T);return[f*M-2*Math.PI*6378137/2,y*M-2*Math.PI*6378137/2]}l.getURL=function(f,y,T,M,O,w){return w=w||{},f+"?"+["bbox="+d(T,M,O),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+y].join("&")},l.getTileBBox=d,l.getMercCoords=m,Object.defineProperty(l,"__esModule",{value:!0})})(o)}(0,Mt.exports)),Mt.exports);class Rt{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=en(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const d=St.getTileBBox(this.x,this.y,this.z),m=function(f,y,T){let M,O="";for(let w=f;w>0;w--)M=1<<w-1,O+=(y&M?1:0)+(T&M?2:0);return O}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xt{constructor(o,l){this.wrap=o,this.canonical=l,this.key=en(o,l.z,l.z,l.x,l.y)}}class Lt{constructor(o,l,d,m,f){this.overscaledZ=o,this.wrap=l,this.canonical=new Rt(d,+m,+f),this.key=l===0&&o===d?this.canonical.key:en(l,o,d,m,f)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Lt(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lt(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return en(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return en(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Lt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y;return[new Lt(l,this.wrap,l,d,m),new Lt(l,this.wrap,l,d+1,m),new Lt(l,this.wrap,l,d,m+1),new Lt(l,this.wrap,l,d+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Lt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Lt(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function en(h,o,l,d,m){const f=1<<Math.min(l,22);let y=f*(m%f)+d%f;return h&&l<22&&(y+=f*f*((h<0?-2*h-1:2*h)%(1<<2*(22-l)))),16*(32*y+l)+(o-l)}const tn=[h=>{let o=h.canonical.x-1,l=h.wrap;return o<0&&(o=(1<<h.canonical.z)-1,l--),new Lt(h.overscaledZ,l,h.canonical.z,o,h.canonical.y)},h=>{let o=h.canonical.x+1,l=h.wrap;return o===1<<h.canonical.z&&(o=0,l++),new Lt(h.overscaledZ,l,h.canonical.z,o,h.canonical.y)},h=>new Lt(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,(h.canonical.y===0?1<<h.canonical.z:h.canonical.y)-1),h=>new Lt(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y===(1<<h.canonical.z)-1?0:h.canonical.y+1)];on(Rt,"CanonicalTileID"),on(Lt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const rn=qn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fn}=rn,kn=qn([{name:"a_pos_3",components:3,type:"Int16"}]);var vn=qn([{name:"a_pos",type:"Int16",components:2}]);class Ln{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const m=we.vec2.dot(l,this.dir);if(Math.abs(m)<1e-6)return!1;const f=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1])/m;return d[0]=this.pos[0]+this.dir[0]*f,d[1]=this.pos[1]+this.dir[1]*f,!0}}class Mn{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const m=we.vec3.dot(l,this.dir);if(Math.abs(m)<1e-6)return!1;const f=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/m;return d[0]=this.pos[0]+this.dir[0]*f,d[1]=this.pos[1]+this.dir[1]*f,d[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(o,l,d){if(we.vec3.equals(this.pos,o)||l===0)return d[0]=d[1]=d[2]=0,!1;const[m,f,y]=this.dir,T=this.pos[0]-o[0],M=this.pos[1]-o[1],O=this.pos[2]-o[2],w=m*m+f*f+y*y,P=2*(T*m+M*f+O*y),N=P*P-4*w*(T*T+M*M+O*O-l*l);if(N<0){const L=Math.max(-P/2,0),D=T+m*L,B=M+f*L,q=O+y*L,Z=Math.hypot(D,B,q);return d[0]=D*l/Z,d[1]=B*l/Z,d[2]=q*l/Z,!1}{const L=(-P-Math.sqrt(N))/(2*w);if(L<0){const D=Math.hypot(T,M,O);return d[0]=T*l/D,d[1]=M*l/D,d[2]=O*l/D,!1}return d[0]=T+m*L,d[1]=M+f*L,d[2]=O+y*L,!0}}}class Hn{constructor(o,l,d,m,f){this.TL=o,this.TR=l,this.BR=d,this.BL=m,this.horizon=f}static fromInvProjectionMatrix(o,l,d){const m=[-1,1,1],f=[1,1,1],y=[1,-1,1],T=[-1,-1,1],M=we.vec3.transformMat4(m,m,o),O=we.vec3.transformMat4(f,f,o),w=we.vec3.transformMat4(y,y,o),P=we.vec3.transformMat4(T,T,o);return new Hn(M,O,w,P,l/d)}}function Nr(h,o,l){let d=1/0,m=-1/0;const f=[];for(const y of h){we.vec3.sub(f,y,o);const T=we.vec3.dot(f,l);d=Math.min(d,T),m=Math.max(m,T)}return[d,m]}function ii(h,o){let l=!0;for(let d=0;d<h.planes.length;d++){const m=h.planes[d];let f=0;for(let y=0;y<o.length;y++)f+=we.vec3.dot(m,o[y])+m[3]>=0;if(f===0)return 0;f!==o.length&&(l=!1)}return l?2:1}function ir(h,o){for(const l of h.projections){const d=Nr(o,h.points[0],l.axis);if(l.projection[1]<d[0]||l.projection[0]>d[1])return 0}return 1}function Ii(h,o){let l=0;const d=[0,0,0,0];for(let m=0;m<h.length;m++)d[0]=h[m][0],d[1]=h[m][1],d[2]=h[m][2],d[3]=1,we.vec4.dot(d,o)>=0&&l++;return l}class Nn{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=mn.fromPoints(this.points),this.projections=[],this.frustumEdges=[we.vec3.sub([],this.points[2],this.points[3]),we.vec3.sub([],this.points[0],this.points[3]),we.vec3.sub([],this.points[4],this.points[0]),we.vec3.sub([],this.points[5],this.points[1]),we.vec3.sub([],this.points[6],this.points[2]),we.vec3.sub([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const m=[0,-d[2],d[1]],f=[d[2],0,-d[0]];this.projections.push({axis:m,projection:Nr(this.points,this.points[0],m)}),this.projections.push({axis:f,projection:Nr(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(o,l,d,m){const f=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const w=we.vec4.transformMat4([],O,o),P=1/w[3]/l*f;return we.vec4.mul(w,w,[P,P,m?1/w[3]:P,P])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const w=we.vec3.sub([],y[O[0]],y[O[1]]),P=we.vec3.sub([],y[O[2]],y[O[1]]),N=we.vec3.normalize([],we.vec3.cross([],w,P)),L=-we.vec3.dot(N,y[O[1]]);return N.concat(L)}),M=[];for(let O=0;O<y.length;O++)M.push([y[O][0],y[O][1],y[O][2]]);return new Nn(M,T)}intersectsPrecise(o,l,d){for(let m=0;m<l.length;m++)if(!Ii(o,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!Ii(o,this.planes[m]))return 0;for(const m of d)for(const f of this.frustumEdges){const y=we.vec3.cross([],m,f),T=we.vec3.length(y);if(T===0)continue;we.vec3.scale(y,y,1/T);const M=Nr(this.points,this.points[0],y),O=Nr(o,this.points[0],y);if(M[0]>O[1]||O[0]>M[1])return 0}return 1}containsPoint(o){for(const l of this.planes){const d=l[3];if(we.vec3.dot([l[0],l[1],l[2]],o)+d<0)return!1}return!0}}class mn{static fromPoints(o){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const m of o)we.vec3.min(l,l,m),we.vec3.max(d,d,m);return new mn(l,d)}static fromTileIdAndHeight(o,l,d){const m=1<<o.canonical.z,f=o.canonical.x,y=o.canonical.y;return new mn([f/m,y/m,l],[(f+1)/m,(y+1)/m,d])}static applyTransform(o,l){const d=o.getCorners();for(let m=0;m<d.length;++m)we.vec3.transformMat4(d[m],d[m],l);return mn.fromPoints(d)}static applyTransformFast(o,l){const d=[l[12],l[13],l[14]],m=[...d];for(let f=0;f<3;f++)for(let y=0;y<3;y++){const T=l[4*y+f],M=T*o.min[y],O=T*o.max[y];d[f]+=Math.min(M,O),m[f]+=Math.max(M,O)}return new mn(d,m)}static projectAabbCorners(o,l){const d=o.getCorners();for(let m=0;m<d.length;++m)we.vec3.transformMat4(d[m],d[m],l);return d}constructor(o,l){this.min=o,this.max=l,this.center=we.vec3.scale([],we.vec3.add([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],d=we.vec3.clone(this.min),m=we.vec3.clone(this.max);for(let f=0;f<l.length;f++)d[f]=l[f]?this.min[f]:this.center[f],m[f]=l[f]?this.center[f]:this.max[f];return m[2]=this.max[2],new mn(d,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?ii(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?ii(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?ir(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?ir(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function _r(h){return h*ws/Do}on(mn,"Aabb");const Pr=[new mn([ma,ma,ma],[ja,ja,ja]),new mn([ma,ma,ma],[0,0,ja]),new mn([0,ma,ma],[ja,0,ja]),new mn([ma,0,ma],[0,ja,ja]),new mn([0,0,ma],[ja,ja,ja])];function Ar(h,o,l,d=!0){const m=we.vec3.scale([],h._camera.position,h.worldSize),f=[o,l,1,1];we.vec4.transformMat4(f,f,h.pixelMatrixInverse),we.vec4.scale(f,f,1/f[3]);const y=we.vec3.sub([],f,m),T=we.vec3.normalize([],y),M=h.globeMatrix,O=[M[12],M[13],M[14]],w=we.vec3.sub([],O,m),P=we.vec3.length(w),N=we.vec3.normalize([],w),L=h.worldSize/(2*Math.PI),D=we.vec3.dot(N,T),B=Math.asin(L/P);if(B<Math.acos(D)){if(!d)return null;const Ge=[],Ae=[];we.vec3.scale(Ge,T,P/D),we.vec3.normalize(Ae,we.vec3.sub(Ae,Ge,w)),we.vec3.normalize(T,we.vec3.add(T,w,we.vec3.scale(T,Ae,Math.tan(B)*P)))}const q=[];new Mn(m,T).closestPointOnSphere(O,L,q);const Z=we.vec3.normalize([],Lr(M,0)),re=we.vec3.normalize([],Lr(M,1)),ne=we.vec3.normalize([],Lr(M,2)),te=we.vec3.dot(Z,q),le=we.vec3.dot(re,q),fe=we.vec3.dot(ne,q),_e=Yr(Math.asin(-le/L));let Me=Yr(Math.atan2(te,fe));Me=h.center.lng+function(Ge,Ae){const He=(Ae-Ge+180)%360-180;return He<-180?He+360:He}(h.center.lng,Me);const Ce=ga(Me),Te=er(es(_e),0,1);return new s(Ce,Te)}class gi{constructor(o,l,d){this.a=we.vec3.sub([],o,d),this.b=we.vec3.sub([],l,d),this.center=d;const m=we.vec3.normalize([],this.a),f=we.vec3.normalize([],this.b);this.angle=Math.acos(we.vec3.dot(m,f))}}function uo(h,o){if(h.angle===0)return null;let l;return l=h.a[o]===0?1/h.angle*.5*Math.PI:1/h.angle*Math.atan(h.b[o]/h.a[o]/Math.sin(h.angle)-1/Math.tan(h.angle)),l<0||l>1?null:function(d,m,f,y){const T=Math.sin(f);return d*(Math.sin((1-y)*f)/T)+m*(Math.sin(y*f)/T)}(h.a[o],h.b[o],h.angle,er(l,0,1))+h.center[o]}function _o(h){if(h.z<=1)return Pr[h.z+2*h.y+h.x];const o=bi(Or(h));return mn.fromPoints(o)}function yo(h,o,l){return we.vec3.scale(h,h,1-l),we.vec3.scaleAndAdd(h,h,o,l)}function Xs(h,o,l){for(const d of h)we.vec3.transformMat4(d,d,o),we.vec3.scale(d,d,l)}function Ls(h,o,l,d){const m=o/h.worldSize,f=h.globeMatrix;if(l.z<=1){const Ce=_o(l).getCorners();return Xs(Ce,f,m),mn.fromPoints(Ce)}const y=Or(l,d),T=bi(y,ws+_r(h._tileCoverLift));Xs(T,f,m);const M=Number.MAX_VALUE,O=[-M,-M,-M],w=[M,M,M];if(y.contains(h.center)){for(const Ge of T)we.vec3.min(w,w,Ge),we.vec3.max(O,O,Ge);O[2]=0;const Ce=h.point,Te=[Ce.x*m,Ce.y*m,0];return we.vec3.min(w,w,Te),we.vec3.max(O,O,Te),new mn(w,O)}if(h._tileCoverLift>0){for(const Ce of T)we.vec3.min(w,w,Ce),we.vec3.max(O,O,Ce);return new mn(w,O)}const P=[f[12]*m,f[13]*m,f[14]*m],N=y.getCenter(),L=er(h.center.lat,-85.051129,Rs),D=er(N.lat,-85.051129,Rs),B=ga(h.center.lng),q=es(L);let Z=B-ga(N.lng);const re=q-es(D);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ne=0;if(Math.abs(Z)>Math.abs(re))ne=Z>=0?1:3;else{ne=re>=0?0:2;const Ce=[f[4]*m,f[5]*m,f[6]*m],Te=-Math.sin(cr(re>=0?y.getSouth():y.getNorth()))*ws;we.vec3.scaleAndAdd(P,P,Ce,Te)}const te=T[ne],le=T[(ne+1)%4],fe=new gi(te,le,P),_e=[uo(fe,0)||te[0],uo(fe,1)||te[1],uo(fe,2)||te[2]],Me=_a(h.zoom);if(Me>0){const Ce=function({x:Ge,y:Ae,z:He},Qe,Je,st,rt){const dt=1/(1<<He);let lt=Ge*dt,pt=lt+dt,kt=Ae*dt,Nt=kt+dt,hn=0;const qt=(lt+pt)/2-st;return qt>.5?hn=-1:qt<-.5&&(hn=1),lt=((lt+hn)*Qe-(st*=Qe))*Je+st,pt=((pt+hn)*Qe-st)*Je+st,kt=(kt*Qe-(rt*=Qe))*Je+rt,Nt=(Nt*Qe-rt)*Je+rt,[[lt,Nt,0],[pt,Nt,0],[pt,kt,0],[lt,kt,0]]}(l,o,h._pixelsPerMercatorPixel,B,q);for(let Ge=0;Ge<T.length;Ge++)yo(T[Ge],Ce[Ge],Me);const Te=we.vec3.add([],Ce[ne],Ce[(ne+1)%4]);we.vec3.scale(Te,Te,.5),yo(_e,Te,Me)}for(const Ce of T)we.vec3.min(w,w,Ce),we.vec3.max(O,O,Ce);return w[2]=Math.min(te[2],le[2]),we.vec3.min(w,w,_e),we.vec3.max(O,O,_e),new mn(w,O)}function Or({x:h,y:o,z:l},d=!1){const m=1/(1<<l),f=new zr(Va(h*m),o===(1<<l)-1&&d?-90:go((o+1)*m)),y=new zr(Va((h+1)*m),o===0&&d?90:go(o*m));return new mu(f,y)}function bi(h,o=ws){const l=cr(h.getNorth()),d=cr(h.getSouth()),m=Math.cos(l),f=Math.cos(d),y=Math.sin(l),T=Math.sin(d),M=h.getWest(),O=h.getEast();return[zd(f,T,M,o),zd(f,T,O,o),zd(m,y,O,o),zd(m,y,M,o)]}function kr(h,o,l,d){const m=1<<l.z,f=(h/Qt+l.x)/m;return pu(go((o/Qt+l.y)/m),Va(f),d)}function Wr({min:h,max:o}){return Ju/Math.max(o[0]-h[0],o[1]-h[1],o[2]-h[2])}const cs=new Float64Array(16);function oi(h){const o=Wr(h),l=we.mat4.fromScaling(cs,[o,o,o]);return we.mat4.translate(l,l,we.vec3.negate([],h.min))}function vo(h){const o=we.mat4.fromTranslation(cs,h.min),l=1/Wr(h);return we.mat4.scale(o,o,[l,l,l])}function Li(h){const o=Qt/(2*Math.PI);return h/(2*Math.PI)/o}function Ua(h,o){return Qt/(512*Math.pow(2,h))*Wr(_o(o))}function dl(h,o,l,d,m){const f=Li(l),y=[h,o,-l/(2*Math.PI)],T=we.mat4.identity(new Float64Array(16));return we.mat4.translate(T,T,y),we.mat4.scale(T,T,[f,f,f]),we.mat4.rotateX(T,T,cr(-m)),we.mat4.rotateY(T,T,cr(-d)),T}function _a(h){return _s(Fd,Om,h)}function zl(h,o){const l=pu(o.lat,o.lng),d=function(f){const y=pu(f._center.lat,f._center.lng),T=we.vec3.fromValues(0,1,0);let M=we.vec3.cross([],T,y);const O=we.mat4.fromRotation([],-f.angle,y);M=we.vec3.transformMat4(M,M,O),we.mat4.fromRotation(O,-f._pitch,M);const w=we.vec3.normalize([],y);return we.vec3.scale(w,w,_r(f.cameraToCenterDistance/f.pixelsPerMeter)),we.vec3.transformMat4(w,w,O),we.vec3.add([],y,w)}(h),m=we.vec3.subtract([],d,l);return we.vec3.angle(m,l)}function ya(h,o){return zl(h,o)>Math.PI/2*1.01}const Qu=cr(85),ec=Math.cos(Qu),ts=Math.sin(Qu),Nm=we.mat4.create(),lp=h=>{const o=[];return h.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function gu(h,o,l,d,m,f,y,T,M){if(f&&h.queryGeometry.isAboveHorizon)return!1;f&&(M*=h.pixelToTileUnitsFactor);const O=h.tileID.canonical,w=l.projection.upVectorScale(O,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const N of P){const L=N.add(T),D=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(L.x,L.y,!0):0,B=l.projection.projectTilePoint(L.x,L.y,O);if(D>0){const ne=l.projection.upVector(O,L.x,L.y);B.x+=ne[0]*w*D,B.y+=ne[1]*w*D,B.z+=ne[2]*w*D}const q=f?L:up(B.x,B.y,B.z,d),Z=f?h.tilespaceRays.map(ne=>Fx(ne,D)):h.queryGeometry.screenGeometry,re=we.vec4.transformMat4([],[B.x,B.y,B.z,1],d);if(!y&&f?M*=re[3]/l.cameraToCenterDistance:y&&!f&&(M*=l.cameraToCenterDistance/re[3]),f){const ne=go((N.y/Qt+O.y)/(1<<O.z));M/=l.projection.pixelsPerMeter(ne,1)/us(1,ne)}if(ce(Z,q,M))return!0}return!1}function up(h,o,l,d){const m=we.vec4.transformMat4([],[h,o,l,1],d);return new Gt(m[0]/m[3],m[1]/m[3])}const cp=we.vec3.fromValues(0,0,0),jv=we.vec3.fromValues(0,0,1);function Fx(h,o){const l=we.vec3.create();return cp[2]=o,h.intersectsPlane(cp,jv,l),new Gt(l[0],l[1])}class Vv extends oe{}let Jb,Uv,Qb,zx;function Bx(h,{width:o,height:l},d,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*l*d)throw new RangeError("mismatched image size")}else m=new Uint8Array(o*l*d);return h.width=o,h.height=l,h.data=m,h}function Ey(h,o,l){const{width:d,height:m}=o;d===h.width&&m===h.height||(Yg(h,o,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,d),height:Math.min(h.height,m)},l,null),h.width=d,h.height=m,h.data=o.data)}function Yg(h,o,l,d,m,f,y,T){if(m.width===0||m.height===0)return o;if(m.width>h.width||m.height>h.height||l.x>h.width-m.width||l.y>h.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||d.x>o.width-m.width||d.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const M=h.data,O=o.data,w=f===4&&T;for(let P=0;P<m.height;P++){const N=((l.y+P)*h.width+l.x)*f,L=((d.y+P)*o.width+d.x)*f;if(w)for(let D=0;D<m.width;D++){const B=N+D*f+3,q=L+D*f;O[q+0]=255,O[q+1]=255,O[q+2]=255,O[q+3]=M[B]}else if(y)for(let D=0;D<m.width;D++){const B=N+D*f,q=L+D*f,Z=M[B+3],re=new Fr(M[B+0]/255*Z,M[B+1]/255*Z,M[B+2]/255*Z,Z).toRenderColor(y).toArray();O[q+0]=re[0],O[q+1]=re[1],O[q+2]=re[2],O[q+3]=re[3]}else for(let D=0;D<m.width*f;D++)O[L+D]=M[N+D]}return o}on(Vv,"HeatmapBucket",{omit:["layers"]});class Bd{constructor(o,l){Bx(this,o,1,l)}resize(o){Ey(this,new Bd(o),1)}clone(){return new Bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,m,f){Yg(o,l,d,m,f,1,null)}}class ns{constructor(o,l){Bx(this,o,4,l)}resize(o){Ey(this,new ns(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,m,f,y,T){Yg(o,l,d,m,f,4,y,T)}}class ew{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function Kg(h){const o={},l=h.resolution||256,d=h.clips?h.clips.length:1,m=h.image||new ns({width:l,height:d}),f=(y,T,M)=>{o[h.evaluationKey]=M;const O=h.expression.evaluate(o);O&&(m.data[y+T+0]=Math.floor(255*O.r/O.a),m.data[y+T+1]=Math.floor(255*O.g/O.a),m.data[y+T+2]=Math.floor(255*O.b/O.a),m.data[y+T+3]=Math.floor(255*O.a))};if(h.clips)for(let y=0,T=0;y<d;++y,T+=4*l)for(let M=0,O=0;M<l;M++,O+=4){const w=M/(l-1),{start:P,end:N}=h.clips[y];f(T,O,P*(1-w)+N*w)}else for(let y=0,T=0;y<l;y++,T+=4)f(0,T,y/(l-1));return m}on(Bd,"AlphaImage"),on(ns,"RGBAImage");const jx=qn([{name:"a_pos",components:2,type:"Int16"}],4),Gv=qn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Vx=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),$v=qn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Jg(h,o,l=2){const d=o&&o.length,m=d?o[0]*l:h.length;let f=tw(h,0,m,l,!0);const y=[];if(!f||f.next===f.prev)return y;let T,M,O;if(d&&(f=function(w,P,N,L){const D=[];for(let B=0,q=P.length;B<q;B++){const Z=tw(w,P[B]*L,B<q-1?P[B+1]*L:w.length,L,!1);Z===Z.next&&(Z.steiner=!0),D.push(de(Z))}D.sort(S);for(let B=0;B<D.length;B++)N=F(D[B],N);return N}(h,o,f,l)),h.length>80*l){T=1/0,M=1/0;let w=-1/0,P=-1/0;for(let N=l;N<m;N+=l){const L=h[N],D=h[N+1];L<T&&(T=L),D<M&&(M=D),L>w&&(w=L),D>P&&(P=D)}O=Math.max(w-T,P-M),O=O!==0?32767/O:0}return Cy(f,y,l,T,M,O,0),y}function tw(h,o,l,d,m){let f;if(m===function(y,T,M,O){let w=0;for(let P=T,N=M-O;P<M;P+=O)w+=(y[N]-y[P])*(y[P+1]+y[N+1]),N=P;return w}(h,o,l,d)>0)for(let y=o;y<l;y+=d)f=tr(y/d|0,h[y],h[y+1],f);else for(let y=l-d;y>=o;y-=d)f=tr(y/d|0,h[y],h[y+1],f);return f&&$t(f,f.next)&&(xo(f),f=f.next),f}function Dh(h,o){if(!h)return h;o||(o=h);let l,d=h;do if(l=!1,d.steiner||!$t(d,d.next)&&yt(d.prev,d,d.next)!==0)d=d.next;else{if(xo(d),d=o=d.prev,d===d.next)break;l=!0}while(l||d!==o);return o}function Cy(h,o,l,d,m,f,y){if(!h)return;!y&&f&&function(M,O,w,P){let N=M;do N.z===0&&(N.z=se(N.x,N.y,O,w,P)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==M);N.prevZ.nextZ=null,N.prevZ=null,function(L){let D,B=1;do{let q,Z=L;L=null;let re=null;for(D=0;Z;){D++;let ne=Z,te=0;for(let fe=0;fe<B&&(te++,ne=ne.nextZ,ne);fe++);let le=B;for(;te>0||le>0&&ne;)te!==0&&(le===0||!ne||Z.z<=ne.z)?(q=Z,Z=Z.nextZ,te--):(q=ne,ne=ne.nextZ,le--),re?re.nextZ=q:L=q,q.prevZ=re,re=q;Z=ne}re.nextZ=null,B*=2}while(D>1)}(N)}(h,d,m,f);let T=h;for(;h.prev!==h.next;){const M=h.prev,O=h.next;if(f?bC(h,d,m,f):Ty(h))o.push(M.i,h.i,O.i),xo(h),h=O.next,T=O.next;else if((h=O)===T){y?y===1?Cy(h=qv(Dh(h),o),o,l,d,m,f,2):y===2&&v(h,o,l,d,m,f):Cy(Dh(h),o,l,d,m,f,1);break}}}function Ty(h){const o=h.prev,l=h,d=h.next;if(yt(o,l,d)>=0)return!1;const m=o.x,f=l.x,y=d.x,T=o.y,M=l.y,O=d.y,w=m<f?m<y?m:y:f<y?f:y,P=T<M?T<O?T:O:M<O?M:O,N=m>f?m>y?m:y:f>y?f:y,L=T>M?T>O?T:O:M>O?M:O;let D=d.next;for(;D!==o;){if(D.x>=w&&D.x<=N&&D.y>=P&&D.y<=L&&Le(m,T,f,M,y,O,D.x,D.y)&&yt(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function bC(h,o,l,d){const m=h.prev,f=h,y=h.next;if(yt(m,f,y)>=0)return!1;const T=m.x,M=f.x,O=y.x,w=m.y,P=f.y,N=y.y,L=T<M?T<O?T:O:M<O?M:O,D=w<P?w<N?w:N:P<N?P:N,B=T>M?T>O?T:O:M>O?M:O,q=w>P?w>N?w:N:P>N?P:N,Z=se(L,D,o,l,d),re=se(B,q,o,l,d);let ne=h.prevZ,te=h.nextZ;for(;ne&&ne.z>=Z&&te&&te.z<=re;){if(ne.x>=L&&ne.x<=B&&ne.y>=D&&ne.y<=q&&ne!==m&&ne!==y&&Le(T,w,M,P,O,N,ne.x,ne.y)&&yt(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,te.x>=L&&te.x<=B&&te.y>=D&&te.y<=q&&te!==m&&te!==y&&Le(T,w,M,P,O,N,te.x,te.y)&&yt(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;ne&&ne.z>=Z;){if(ne.x>=L&&ne.x<=B&&ne.y>=D&&ne.y<=q&&ne!==m&&ne!==y&&Le(T,w,M,P,O,N,ne.x,ne.y)&&yt(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;te&&te.z<=re;){if(te.x>=L&&te.x<=B&&te.y>=D&&te.y<=q&&te!==m&&te!==y&&Le(T,w,M,P,O,N,te.x,te.y)&&yt(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function qv(h,o){let l=h;do{const d=l.prev,m=l.next.next;!$t(d,m)&&yn(d,l,l.next,m)&&Bn(d,m)&&Bn(m,d)&&(o.push(d.i,l.i,m.i),xo(l),xo(l.next),l=h=m),l=l.next}while(l!==h);return Dh(l)}function v(h,o,l,d,m,f){let y=h;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&ht(y,T)){let M=Kn(y,T);return y=Dh(y,y.next),M=Dh(M,M.next),Cy(y,o,l,d,m,f,0),void Cy(M,o,l,d,m,f,0)}T=T.next}y=y.next}while(y!==h)}function S(h,o){return h.x-o.x}function F(h,o){const l=function(m,f){let y=f;const T=m.x,M=m.y;let O,w=-1/0;do{if(M<=y.y&&M>=y.next.y&&y.next.y!==y.y){const B=y.x+(M-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(B<=T&&B>w&&(w=B,O=y.x<y.next.x?y:y.next,B===T))return O}y=y.next}while(y!==f);if(!O)return null;const P=O,N=O.x,L=O.y;let D=1/0;y=O;do{if(T>=y.x&&y.x>=N&&T!==y.x&&Le(M<L?T:w,M,N,L,M<L?w:T,M,y.x,y.y)){const B=Math.abs(M-y.y)/(T-y.x);Bn(y,m)&&(B<D||B===D&&(y.x>O.x||y.x===O.x&&H(O,y)))&&(O=y,D=B)}y=y.next}while(y!==P);return O}(h,o);if(!l)return o;const d=Kn(l,h);return Dh(d,d.next),Dh(l,l.next)}function H(h,o){return yt(h.prev,h,o.prev)<0&&yt(o.next,h,h.next)<0}function se(h,o,l,d,m){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-l)*m|0)|h<<8))|h<<4))|h<<2))|h<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function de(h){let o=h,l=h;do(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next;while(o!==h);return l}function Le(h,o,l,d,m,f,y,T){return(m-y)*(o-T)>=(h-y)*(f-T)&&(h-y)*(d-T)>=(l-y)*(o-T)&&(l-y)*(f-T)>=(m-y)*(d-T)}function ht(h,o){return h.next.i!==o.i&&h.prev.i!==o.i&&!function(l,d){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==d.i&&m.next.i!==d.i&&yn(m,m.next,l,d))return!0;m=m.next}while(m!==l);return!1}(h,o)&&(Bn(h,o)&&Bn(o,h)&&function(l,d){let m=l,f=!1;const y=(l.x+d.x)/2,T=(l.y+d.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&y<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(f=!f),m=m.next;while(m!==l);return f}(h,o)&&(yt(h.prev,h,o.prev)||yt(h,o.prev,o))||$t(h,o)&&yt(h.prev,h,h.next)>0&&yt(o.prev,o,o.next)>0)}function yt(h,o,l){return(o.y-h.y)*(l.x-o.x)-(o.x-h.x)*(l.y-o.y)}function $t(h,o){return h.x===o.x&&h.y===o.y}function yn(h,o,l,d){const m=pn(yt(h,o,l)),f=pn(yt(h,o,d)),y=pn(yt(l,d,h)),T=pn(yt(l,d,o));return m!==f&&y!==T||!(m!==0||!xn(h,l,o))||!(f!==0||!xn(h,d,o))||!(y!==0||!xn(l,h,d))||!(T!==0||!xn(l,o,d))}function xn(h,o,l){return o.x<=Math.max(h.x,l.x)&&o.x>=Math.min(h.x,l.x)&&o.y<=Math.max(h.y,l.y)&&o.y>=Math.min(h.y,l.y)}function pn(h){return h>0?1:h<0?-1:0}function Bn(h,o){return yt(h.prev,h,h.next)<0?yt(h,o,h.next)>=0&&yt(h,h.prev,o)>=0:yt(h,o,h.prev)<0||yt(h,h.next,o)<0}function Kn(h,o){const l=Ft(h.i,h.x,h.y),d=Ft(o.i,o.x,o.y),m=h.next,f=o.prev;return h.next=o,o.prev=h,l.next=m,m.prev=l,d.next=l,l.prev=d,f.next=d,d.prev=f,d}function tr(h,o,l,d){const m=Ft(h,o,l);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function xo(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function Ft(h,o,l){return{i:h,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Tt(h,o){const l=h.length;if(l<=1)return[h];const d=[];let m,f;for(let y=0;y<l;y++){const T=Vs(h[y]);T!==0&&(h[y].area=Math.abs(T),f===void 0&&(f=T<0),f===T<0?(m&&d.push(m),m=[h[y]]):m.push(h[y]))}if(m&&d.push(m),o>1)for(let y=0;y<d.length;y++)d[y].length<=o||(xv(d[y],o,1,d[y].length-1,Vt),d[y]=d[y].slice(0,o));return d}function Vt(h,o){return o.area-h.area}function Tn(h,o,l=1){if(!h)return null;const d=typeof h=="string"?Ko.from(h).getPrimary():h.getPrimary(),m=d.id.toString();return o.has(m)||o.set(m,[]),d.scaleSelf(l),o.get(m).push(d),d.toString()}function or(h,o,l,d){const m=d.patternDependencies;let f=!1;for(const y of o){const T=y.paint.get(`${h}-pattern`);T.isConstant()||(f=!0),Tn(T.constantOr(null),m,l)&&(f=!0)}return f}function br(h,o,l,d,m,f){const y=f.patternDependencies;for(const T of o){const M=T.paint.get(`${h}-pattern`).value;if(M.kind!=="constant"){let O=M.evaluate({zoom:d},l,{},f.availableImages);O=O&&O.name?O.name:O;const w=Tn(O,y,m);w&&(l.patterns[T.id]=w)}}return l}var wr,Br,Ss,Oi,Nh,nw,WP,rw={};function XP(){if(Br)return wr;Br=1;var h=yi();function o(m,f,y,T,M){this.properties={},this.extent=y,this.type=0,this._pbf=m,this._geometry=-1,this._keys=T,this._values=M,m.readFields(l,this,f)}function l(m,f,y){m==1?f.id=y.readVarint():m==2?function(T,M){for(var O=T.readVarint()+T.pos;T.pos<O;){var w=M._keys[T.readVarint()],P=M._values[T.readVarint()];M.properties[w]=P}}(y,f):m==3?f.type=y.readVarint():m==4&&(f._geometry=y.pos)}function d(m){for(var f,y,T=0,M=0,O=m.length,w=O-1;M<O;w=M++)T+=((y=m[w]).x-(f=m[M]).x)*(f.y+y.y);return T}return wr=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var f,y=m.readVarint()+m.pos,T=1,M=0,O=0,w=0,P=[];m.pos<y;){if(M<=0){var N=m.readVarint();T=7&N,M=N>>3}if(M--,T===1||T===2)O+=m.readSVarint(),w+=m.readSVarint(),T===1&&(f&&P.push(f),f=[]),f.push(new h(O,w));else{if(T!==7)throw new Error("unknown command "+T);f&&f.push(f[0].clone())}}return f&&P.push(f),P},o.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var f=m.readVarint()+m.pos,y=1,T=0,M=0,O=0,w=1/0,P=-1/0,N=1/0,L=-1/0;m.pos<f;){if(T<=0){var D=m.readVarint();y=7&D,T=D>>3}if(T--,y===1||y===2)(M+=m.readSVarint())<w&&(w=M),M>P&&(P=M),(O+=m.readSVarint())<N&&(N=O),O>L&&(L=O);else if(y!==7)throw new Error("unknown command "+y)}return[w,N,P,L]},o.prototype.toGeoJSON=function(m,f,y){var T,M,O=this.extent*Math.pow(2,y),w=this.extent*m,P=this.extent*f,N=this.loadGeometry(),L=o.types[this.type];function D(Z){for(var re=0;re<Z.length;re++){var ne=Z[re];Z[re]=[360*(ne.x+w)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+P)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(T=0;T<N.length;T++)B[T]=N[T][0];D(N=B);break;case 2:for(T=0;T<N.length;T++)D(N[T]);break;case 3:for(N=function(Z){var re=Z.length;if(re<=1)return[Z];for(var ne,te,le=[],fe=0;fe<re;fe++){var _e=d(Z[fe]);_e!==0&&(te===void 0&&(te=_e<0),te===_e<0?(ne&&le.push(ne),ne=[Z[fe]]):ne.push(Z[fe]))}return ne&&le.push(ne),le}(N),T=0;T<N.length;T++)for(M=0;M<N[T].length;M++)D(N[T][M])}N.length===1?N=N[0]:L="Multi"+L;var q={type:"Feature",geometry:{type:L,coordinates:N},properties:this.properties};return"id"in this&&(q.id=this.id),q},wr}function ZP(){if(Oi)return Ss;Oi=1;var h=XP();function o(d,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(l,this,m),this.length=this._features.length}function l(d,m,f){d===15?m.version=f.readVarint():d===1?m.name=f.readString():d===5?m.extent=f.readVarint():d===2?m._features.push(f.pos):d===3?m._keys.push(f.readString()):d===4&&m._values.push(function(y){for(var T=null,M=y.readVarint()+y.pos;y.pos<M;){var O=y.readVarint()>>3;T=O===1?y.readString():O===2?y.readFloat():O===3?y.readDouble():O===4?y.readVarint64():O===5?y.readVarint():O===6?y.readSVarint():O===7?y.readBoolean():null}return T}(f))}return Ss=o,o.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var m=this._pbf.readVarint()+this._pbf.pos;return new h(this._pbf,m,this.extent,this._keys,this._values)},Ss}function YP(){return WP||(WP=1,rw.VectorTile=function(){if(nw)return Nh;nw=1;var h=ZP();function o(l,d,m){if(l===3){var f=new h(m,m.readVarint()+m.pos);f.length&&(d[f.name]=f)}}return Nh=function(l,d){this.layers=l.readFields(o,{},d)},Nh}(),rw.VectorTileFeature=XP(),rw.VectorTileLayer=ZP()),rw}var Qg=YP();const Iy="3d_elevation_id",KP="level";class lU{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,l){return this._valid&&o(l(this._geometry)),this}require(o,l,d){return this.get(o,!0,l,d)}optional(o,l,d){return this.get(o,!1,l,d)}success(){return this._valid}get(o,l,d,m){const f=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&f!==void 0?d(m?m(f):f):l&&(this._valid=!1),this}}class JP{constructor(o,l){this.featureFunc=o,this.vertexFunc=l}parseFeature(o,l,d){return this.featureFunc(o,l,d)}parseVertex(o,l,d){return this.vertexFunc(o,l,d)}}const uU=new JP((h,o,l)=>h.reset(o).require(Iy,d=>{l.id=d}).optional("fixed_height_relative",d=>{l.constantHeight=d},km.decodeRelativeHeight).geometry(d=>{l.bounds=d},km.computeBounds).success(),(h,o,l)=>h.reset(o).require(Iy,d=>{l.id=d}).require("elevation_idx",d=>{l.idx=d}).require("extent",d=>{l.extent=d}).require("height_relative",d=>{l.height=d},km.decodeRelativeHeight).geometry(d=>{l.position=d},km.getPoint).success()),cU=new JP((h,o,l)=>h.reset(o).require(Iy,d=>{l.id=d}).optional("fixed_height",d=>{l.constantHeight=d},km.decodeMetricHeight).geometry(d=>{l.bounds=d},km.computeBounds).success(),(h,o,l)=>h.reset(o).require(Iy,d=>{l.id=d}).require("elevation_idx",d=>{l.idx=d}).require("extent",d=>{l.extent=d}).require("height",d=>{l.height=d},km.decodeMetricHeight).geometry(d=>{l.position=d},km.getPoint).success());class km{static computeBounds(o){const l=new Gt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=new Gt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const m of o[0])l.x>m.x&&(l.x=m.x),l.y>m.y&&(l.y=m.y),d.x<m.x&&(d.x=m.x),d.y<m.y&&(d.y=m.y);return{min:l,max:d}}static getPoint(o){return we.vec2.fromValues(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static parse(o){const l=[],d=[],m=o.length,f=new lU;for(let T=0;T<m;T++){const M=o.feature(T),O=M.properties.hasOwnProperty("version")?String(M.properties.version):void 0,w=(y=O)?y==="1.0.1"?cU:void 0:uU;if(w===void 0){vi(`Unknown elevation feature version number ${O||"(unknown)"}`);continue}const P=M.properties.hasOwnProperty("type")?M.properties.type:void 0;if(P){if(Qg.VectorTileFeature.types[M.type]==="Point"&&P==="curve_point"){const N={};w.parseVertex(f,M,N)&&l.push(N)}else if(Qg.VectorTileFeature.types[M.type]==="Polygon"&&P==="curve_meta"){const N={};w.parseFeature(f,M,N)&&d.push(N)}}}var y;return{vertices:l,features:d}}}class wC{constructor(o,l,d,m,f,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=o,this.heightRange={min:d,max:d},this.safeArea=l,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=f,this.edges=this.edges.filter(T=>T.a<this.vertices.length&&T.b<this.vertices.length&&!we.vec2.exactEquals(this.vertices[T.a].position,this.vertices[T.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:we.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const M=this.vertices[T.a].position,O=this.vertices[T.b].position,w=we.vec2.subtract(we.vec2.create(),O,M),P=we.vec2.length(w),N=we.vec2.scale(we.vec2.create(),w,1/P);this.edgeProps.push({vec:w,dir:N,len:P});const L=this.vertexProps[T.a].dir,D=this.vertexProps[T.b].dir;we.vec2.add(L,L,N),we.vec2.add(D,D,N)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||we.vec2.normalize(T.dir,T.dir);this.tessellate(y)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(o);if(l==null)return 0;const[d,m]=l;return((f,y,T)=>(1-T)*f+T*y)(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,m)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let l=0,d=Number.POSITIVE_INFINITY,m=0;const f=we.vec2.fromValues(o.x,o.y);for(let y=0;y<this.edges.length;y++){const T=this.edges[y],M=this.edgeProps[y].dir,O=new Ln(f,this.edgeProps[y].dir),w=this.vertices[T.a].position,P=this.vertices[T.b].position,N=we.vec2.create(),L=we.vec2.create(),D=O.intersectsPlane(w,this.vertexProps[T.a].dir,N),B=O.intersectsPlane(P,this.vertexProps[T.b].dir,L);if(!D||!B)continue;const q=we.vec2.subtract(we.vec2.create(),L,N),Z=we.vec2.subtract(we.vec2.create(),f,N),re=we.vec2.dot(q,q),ne=re>0?we.vec2.dot(Z,q)/re:0,te=er(ne,0,1),le=Math.abs((ne-te)*this.edgeProps[y].len),fe=we.vec2.subtract(we.vec2.create(),f,w),_e=le+Math.abs(we.vec2.dot(fe,we.vec2.fromValues(M[1],-M[0])));_e<d&&(l=y,d=_e,m=te)}return[l,m]}tessellate(o){for(let l=this.edges.length-1;l>=0;--l){const d=this.edges[l].a,m=this.edges[l].b,{position:f,height:y,extent:T}=this.vertices[d],{position:M,height:O,extent:w}=this.vertices[m],P=this.vertexProps[d].dir,N=this.vertexProps[m].dir,L=we.vec3.fromValues(f[0]/o,f[1]/o,y),D=we.vec3.fromValues(M[0]/o,M[1]/o,O),B=we.vec3.fromValues(P[1],-P[0],0);we.vec3.scale(B,B,T);const q=we.vec3.fromValues(N[1],-N[0],0);if(we.vec3.scale(q,q,w),this.distSqLines(we.vec3.fromValues(L[0]+.5*B[0],L[1]+.5*B[1],L[2]+.5*B[2]),we.vec3.fromValues(D[0]-.5*q[0],D[1]-.5*q[1],D[2]-.5*q[2]),we.vec3.fromValues(L[0]-.5*B[0],L[1]-.5*B[1],L[2]-.5*B[2]),we.vec3.fromValues(D[0]+.5*q[0],D[1]+.5*q[1],D[2]+.5*q[2]))<=.05*.05)continue;const Z=this.vertices.length,re=we.vec2.add(we.vec2.create(),f,M);this.vertices.push({position:we.vec2.scale(re,re,.5),height:.5*(y+O),extent:.5*(T+w)});const ne=we.vec2.add(we.vec2.create(),P,N);this.vertexProps.push({dir:we.vec2.normalize(ne,ne)}),this.edges.splice(l,1),this.edgeProps.splice(l,1),this.edges.push({a:d,b:Z}),this.edges.push({a:Z,b:m});const te=we.vec2.subtract(we.vec2.create(),this.vertices[Z].position,f),le=we.vec2.length(te),fe={vec:te,dir:we.vec2.scale(we.vec2.create(),te,1/le),len:le};this.edgeProps.push(fe),this.edgeProps.push(fe)}}distSqLines(o,l,d,m){const f=we.vec3.subtract(we.vec3.create(),l,o),y=we.vec3.subtract(we.vec3.create(),m,d),T=we.vec3.subtract(we.vec3.create(),o,d),M=we.vec3.dot(f,f),O=we.vec3.dot(f,y),w=we.vec3.dot(f,T),P=we.vec3.dot(y,y),N=we.vec3.dot(y,T),L=M*P-O*O;if(L===0){const re=we.vec3.dot(T,y)/we.vec3.dot(y,y),ne=we.vec3.lerp(we.vec3.create(),d,m,re);return we.vec3.squaredDistance(ne,o)}const D=(O*N-w*P)/L,B=(M*N-O*w)/L,q=we.vec3.lerp(we.vec3.create(),o,l,D),Z=we.vec3.lerp(we.vec3.create(),d,m,B);return we.vec3.squaredDistance(q,Z)}}class hU{constructor(o,l){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(l)||(this.zScale=Math.pow(2,l.z-o.z),this.xOffset=(o.x*this.zScale-l.x)*Qt,this.yOffset=(o.y*this.zScale-l.y)*Qt)}constantElevation(o,l){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,l)}pointElevation(o,l,d){const m=this.constantElevation(l,d);return m??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(o),d))}computeBiasedHeight(o,l){return l<=0?o:o+l*_s(0,l,o>=0?o:Math.abs(.5*o))}}on(wC,"ElevationFeature");class QP{constructor(){this.polygons=new Map}add(o,...l){this.polygons.has(o)?this.polygons.get(o).push(...l):this.polygons.set(o,l)}merge(o){for(const[l,d]of o.polygons)this.add(l,...d)}}class My{constructor(){this.portals=[]}static evaluate(o){if(o.length===0)return new My;let l=[];for(const O of o)l.push(...O.portals);if(l.length===0)return new My;const d=(O,w)=>O<=0&&w<=0||O>=Qt&&w>=Qt;for(const O of l){const w=O.va,P=O.vb;(d(w.x,P.x)||d(w.y,P.y))&&(O.type="border")}const m=l.filter(O=>O.type!=="unevaluated"),f=l.filter(O=>O.type==="unevaluated");if(f.length===0)return new My;f.sort((O,w)=>O.hash===w.hash?O.isTunnel===w.isTunnel?0:O.isTunnel?-1:1:O.hash<w.hash?1:-1),l=m.concat(f);let y=m.length,T=y,M=y;do if(T++,T===l.length||l[y].hash!==l[T].hash){if(T-y==2){M<y&&(l[M]=l[y],l[y]=null);const O=l[M],w=l[T-1];O.type=O.isTunnel!==w.isTunnel?"tunnel":"polygon",O.connection={a:O.connection.a,b:w.connection.a},M++}y=T}while(y!==l.length);return l.splice(M),l.sort((O,w)=>O.hash<w.hash?1:-1),{portals:l}}}on(My,"ElevationPortalGraph"),on(QP,"ElevationPolygons");class dU{constructor(o,l,d){this.outPositions=o,this.outNormals=l,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(o,l,d){let m=o[2];d!=null&&(m*=d);const f=this.getVec3Bits(o)<<96n|this.getVec3Bits(l),y=this.vertexLookup.get(f);if(y!=null)return y;const T=this.outPositions.length;this.vertexLookup.set(f,T);const M=Math.trunc(16384*l[0]),O=Math.trunc(16384*l[1]),w=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(o[0],o[1],m),this.outNormals.emplaceBack(M,O,w),T}addVertices(o,l,...d){const m=[];for(const f of d){const y=this.addVertex(f,o,l);m.push(y)}return m}addTriangles(o,l,d){if(l&&d){const m=d.length===1,f=we.vec3.fromValues(0,0,0);for(let y=0;y<o.length;y+=3){const T=l[o[y+0]],M=l[o[y+1]],O=l[o[y+2]],w=m?d[0]:d[o[y+1]],P=m?d[0]:d[o[y+2]],N=this.addVertex(we.vec3.fromValues(T.x,T.y,m?d[0]:d[o[y+0]]),f),L=this.addVertex(we.vec3.fromValues(M.x,M.y,w),f),D=this.addVertex(we.vec3.fromValues(O.x,O.y,P),f);this.outIndices.emplaceBack(N,L,D)}}else for(let m=0;m<o.length;m+=3)this.outIndices.emplaceBack(o[m+0],o[m+1],o[m+2])}addQuad(o,l){const d=this.addVertices(l,void 0,...o.map(M=>we.vec3.fromValues(M.coord.x,M.coord.y,M.height))),[m,f,y,T]=d;this.addTriangles([m,f,y,y,T,m])}getBits(o){return this.view.setFloat32(0,o),BigInt(this.view.getUint32(0))}getVec3Bits(o){return this.getBits(o[0])<<64n|this.getBits(o[1])<<32n|this.getBits(o[2])}}class jd{constructor(o){this.unevaluatedPortals=new My,this.portalPolygons=new QP,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new xm,this.vertexNormals=new bs,this.indexArray=new Qo,this.tileToMeters=_(o)}addVertices(o,l){const d=this.unevalVertices.length;for(let m=0;m<o.length;m++)this.unevalVertices.push(o[m]),this.unevalHeights.push(l[m]);return d}addTriangles(o,l,d){const m=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of o)m.push(f+l)}addRenderableRing(o,l,d,m,f){const y=[new Gt(f.min.x,f.min.y),new Gt(f.max.x,f.min.y),new Gt(f.max.x,f.max.y),new Gt(f.min.x,f.max.y)];for(let T=0;T<d-1;T++){const M=l+T,O=M+1,w=this.unevalVertices[M],P=this.unevalVertices[O];if(!(w.x>=f.min.x&&w.x<=f.max.x&&w.y>=f.min.y&&w.y<=f.max.y||P.x>=f.min.x&&P.x<=f.max.x&&P.y>=f.min.y&&P.y<=f.max.y||Ue(w,P,y))||this.isOnBorder(w.x,P.x)||this.isOnBorder(w.y,P.y))continue;const N=jd.computeEdgeHash(this.unevalVertices[M],this.unevalVertices[O]);let L,D=this.vertexHashLookup.get(jd.computePosHash(w));D!=null?L=D.next:(D=this.vertexHashLookup.get(jd.computePosHash(P)),L=D!=null?D.prev:N),this.unevalEdges.push({polygonIdx:o,a:M,b:O,hash:N,portalHash:L,isTunnel:m,type:"unevaluated"})}}addPortalCandidates(o,l,d,m,f){if(l.length===0)return;this.portalPolygons.add(o,{geometry:l,zLevel:f});const y=l[0];this.vertexHashLookup.clear();let T=jd.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let M=0;M<y.length-1;M++){const O=y[M+0],w=y[M+1],P=we.vec2.fromValues(w.x-O.x,w.y-O.y),N=we.vec2.length(P);if(N===0)continue;let L="unevaluated";const D=m.pointElevation(O),B=m.pointElevation(w);Math.abs(D)<.01&&Math.abs(B)<.01?L="entrance":(this.isOnBorder(O.x,w.x)||this.isOnBorder(O.y,w.y))&&(L="border");const q=jd.computeEdgeHash(O,w);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:O,vb:w,vab:P,length:N,hash:q,isTunnel:d,type:L});const Z=jd.computePosHash(O);this.vertexHashLookup.set(Z,{prev:T,next:q}),T=q}}construct(o){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},m=new dU(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const f=l(),y=l(),T=l(),M=(P,N)=>{P.sort((D,B)=>D.type===N&&B.type!==N?-1:D.type!==N&&B.type===N?1:0);const L=P.findIndex(D=>D.type!==N);return L>=0?L:P.length};let O=0;this.unevalEdges.length>0&&(O=M(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:O},this.tileToMeters));const w=l();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(O),N=M(P,"tunnel")+O;this.unevalEdges.push(...P),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:O},{min:O,max:N})}d(T),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(w),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(y),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(f),this.maskSegments=xi.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.depthSegments=xi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableSegments=xi.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.shadowCasterSegments=xi.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,Vx.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,$v.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(o,l,d,m){const f=new Map;for(let y=d;y<m;y++){const T=l[y],M=T.a,O=T.b;f.has(M)||f.set(M,{}),f.has(O)||f.set(O,{});const w=f.get(M),P=f.get(O);o[O]>0&&(w.to=O),o[M]>0&&(P.from=M)}return f}constructBridgeStructures(o,l,d,m,f,y){const T=this.computeVertexConnections(d,m,f.min,f.max),M=1/y,O=.5*M,w=N=>we.vec3.fromValues(l[N].x,l[N].y,d[N]*M),P=N=>{const L=T.get(N),D=L.from,B=L.to;if(!D||!B)return;const q=w(D),Z=w(N),re=w(B),ne=we.vec3.fromValues(0,0,0);if(!we.vec3.exactEquals(q,Z)){const le=we.vec3.sub(we.vec3.create(),Z,q);we.vec3.add(ne,ne,we.vec3.normalize(le,le))}if(!we.vec3.exactEquals(re,Z)){const le=we.vec3.sub(we.vec3.create(),re,Z);we.vec3.add(ne,ne,we.vec3.normalize(le,le))}const te=we.vec3.len(ne);return te>0?we.vec3.scale(ne,ne,1/te):void 0};for(let N=f.min;N<f.max;N++){const L=m[N],D=this.prepareEdgePoints(l,d,L,(Bt,An)=>Bt>=An);if(D==null)continue;const B=D[0],q=D[1],Z=we.vec3.fromValues(B.coord.x,B.coord.y,M*B.height),re=we.vec3.fromValues(q.coord.x,q.coord.y,M*q.height);if(we.vec3.exactEquals(Z,re))continue;const ne=we.vec3.sub(we.vec3.create(),re,Z);we.vec3.normalize(ne,ne);const te=Bt=>we.vec3.normalize(Bt,Bt),le=P(L.a)||ne,fe=P(L.b)||ne,_e=te(we.vec3.fromValues(le[1],-le[0],0)),Me=te(we.vec3.fromValues(fe[1],-fe[0],0)),Ce=te(we.vec3.cross(we.vec3.create(),_e,le)),Te=te(we.vec3.cross(we.vec3.create(),Me,fe)),Ge=we.vec3.create(),Ae=[we.vec3.add(we.vec3.create(),Z,we.vec3.scale(Ge,we.vec3.sub(Ge,_e,Ce),O)),we.vec3.add(we.vec3.create(),Z,we.vec3.scale(Ge,we.vec3.add(Ge,_e,Ce),O)),we.vec3.add(we.vec3.create(),Z,we.vec3.scale(Ge,Ce,O)),Z],He=[we.vec3.add(we.vec3.create(),re,we.vec3.scale(Ge,we.vec3.sub(Ge,Me,Te),O)),we.vec3.add(we.vec3.create(),re,we.vec3.scale(Ge,we.vec3.add(Ge,Me,Te),O)),we.vec3.add(we.vec3.create(),re,we.vec3.scale(Ge,Te,O)),re],[Qe,Je]=o.addVertices(_e,y,Ae[0],Ae[1]),[st,rt]=o.addVertices(Me,y,He[0],He[1]);o.addTriangles([Qe,Je,st,Je,rt,st]);const[dt,lt]=o.addVertices(Ce,y,Ae[1],Ae[2]),[pt,kt]=o.addVertices(Te,y,He[1],He[2]);o.addTriangles([dt,lt,pt,lt,kt,pt]);const[Nt,hn]=o.addVertices(we.vec3.negate(_e,_e),y,Ae[2],Ae[3]),[qt,Jt]=o.addVertices(we.vec3.negate(Me,Me),y,He[2],He[3]);o.addTriangles([Nt,hn,qt,hn,Jt,qt])}}constructTunnelStructures(o,l,d,m,f,y){const T=M=>we.vec3.normalize(M,M);for(let M=f.min;M<f.max;M++){const O=this.prepareEdgePoints(l,d,m[M],(L,D)=>L<=D);if(O==null)continue;const[w,P]=O,N=T(we.vec3.fromValues(P.coord.y-w.coord.y,-(P.coord.x-w.coord.x),0));o.addQuad([w,P,{coord:P.coord,height:m[M].isTunnel?-.1:0},{coord:w.coord,height:m[M].isTunnel?-.1:0}],N)}for(let M=y.min;M<y.max;M++){const O=m[M],w=l[O.a],P=l[O.b],N=T(we.vec3.fromValues(P.y-w.y,-(P.x-w.x),0));o.addQuad([{coord:P,height:0},{coord:w,height:0},{coord:w,height:d[O.a]+4},{coord:P,height:d[O.b]+4}],N),o.addQuad([{coord:w,height:0},{coord:P,height:0},{coord:P,height:d[O.b]+4},{coord:w,height:d[O.a]+4}],N)}}prepareEdgePoints(o,l,d,m){const f=o[d.a],y=o[d.b];let T=l[d.a],M=l[d.b];if(!(T!==0&&m(T,0)||M!==0&&m(M,0)))return;const O=f.clone(),w=y.clone();if(m(T,0)){if(!m(M,0)){const P=M/(M-T);w.x=Sn(w.x,O.x,P),w.y=Sn(w.y,O.y,P),M=Sn(M,T,P)}}else{const P=T/(T-M);O.x=Sn(O.x,w.x,P),O.y=Sn(O.y,w.y,P),T=Sn(T,M,P)}return[{coord:O,height:T},{coord:w,height:M}]}prepareEdges(o,l){if(l.length===0)return;l.sort((T,M)=>T.hash===M.hash?M.polygonIdx-T.polygonIdx:M.hash>T.hash?1:-1);let d=0,m=0,f=0,y=l[d].polygonIdx;do m++,(m===l.length||l[d].hash!==l[m].hash)&&((m-d==1||l[m-1].polygonIdx!==y)&&(f<d&&(l[f]=l[d],l[d]=null),l[f].type="none",f++),d=m,d!==l.length&&(y=l[d].polygonIdx));while(d!==l.length);if(l.splice(f),l.length!==0&&o.length!==0){l.sort((O,w)=>O.hash<w.hash?1:-1);let T=0,M=0;for(;T!==l.length&&M!==o.length;){const O=l[T],w=o[M];O.portalHash>w.hash?T++:w.hash>O.portalHash?M++:(O.type=w.type,T++)}}}isOnBorder(o,l){return o<=0&&l<=0||o>=Qt&&l>=Qt}static computeEdgeHash(o,l){return(o.y===l.y&&o.x>l.x||o.y>l.y)&&([o,l]=[l,o]),BigInt(jd.computePosHash(o))<<32n|BigInt(jd.computePosHash(l))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}class SC{constructor(o,l){this.layoutVertexArray=new eo,this.indexArray=new Qo,this.lineIndexArray=new Oc,this.triangleSegments=new xi,this.lineSegments=new xi,this.programConfigurations=new Ku(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new hu)}update(o,l,d,m,f,y,T){this.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jx.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,Gv.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,l,d,m,f,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,l,d,m,f,y)}}class EC{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new SC(o,!1),this.elevationBufferData=new SC(o,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(o,l){}populate(o,l,d,m){this.hasPattern=or("fill",this.layers,this.pixelRatio,l);const f=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:M,index:O,sourceLayerIndex:w}of o){const P=this.layers[0]._featureFilter.needGeometry,N=$(T,P);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),N,d))continue;const L=f?f.evaluate(N,{},d,l.availableImages):void 0,D={id:M,properties:T.properties,type:T.type,sourceLayerIndex:w,index:O,geometry:P?N.geometry:U(T,d,m),patterns:{},sortKey:L};y.push(D)}f&&y.sort((T,M)=>T.sortKey-M.sortKey);for(const T of y){const{geometry:M,index:O,sourceLayerIndex:w}=T;if(this.hasPattern){const P=br("fill",this.layers,T,this.zoom,this.pixelRatio,l);this.patternFeatures.push(P)}else this.addFeature(T,M,O,d,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(o[O].feature,M,O,w,this.index)}}update(o,l,d,m,f,y,T){this.bufferData.update(o,l,d,m,f,y,T),this.elevationBufferData.update(o,l,d,m,f,y,T)}addFeatures(o,l,d,m,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,l,d,m,y,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,l,d,m,f,y=[],T,M){const O=Tt(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,O,m,d,M):this.addGeometry(O,this.bufferData),this.bufferData.populatePaintArrays(o,d,f,y,m,T),this.elevationBufferData.populatePaintArrays(o,d,f,y,m,T)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o){this.elevatedStructures&&this.elevatedStructures.construct(o)}addElevatedRoadFeature(o,l,d,m,f){const y=new Array,T=this.getElevationFeature(o,f);if(T){y.push({polygons:l,elevationFeature:T,elevationTileID:d});for(const M of y)if(M.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new jd(M.elevationTileID));const w=M.elevationFeature.isTunnel();let P=0;o.properties.hasOwnProperty(KP)&&(P=+o.properties[KP]);for(const N of M.polygons)this.elevatedStructures.addPortalCandidates(M.elevationFeature.id,N,w,M.elevationFeature,P)}const O=new hU(d,M.elevationTileID);this.addElevatedGeometry(M.polygons,O,M.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m)}}else this.addGeometry(l,this.bufferData)}addElevatedGeometry(o,l,d,m,f){const y={elevation:d,elevationSampler:l,bias:m,index:f},[T,M]=this.addGeometry(o,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:M}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,M))}addGeometry(o,l,d){let m=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,y=null;d&&(y=d.elevationSampler.constantElevation(d.elevation,d.bias),y!=null&&(m=y,f=y));const T=(M,O,w)=>{if(d!=null)if(O.push(M),y!=null)l.elevatedLayoutVertexArray.emplaceBack(y),w.push(y);else{const P=d.elevationSampler.pointElevation(M,d.elevation,d.bias);l.elevatedLayoutVertexArray.emplaceBack(P),w.push(P),m=Math.min(m,P),f=Math.max(f,P)}};for(const M of o){let O=0;for(const ne of M)O+=ne.length;const w=l.triangleSegments.prepareSegment(O,l.layoutVertexArray,l.indexArray),P=w.vertexLength,N=[],L=[],D=[],B=[],q=[],Z=l.layoutVertexArray.length;for(const ne of M){if(ne.length===0)continue;ne!==M[0]&&L.push(N.length/2);const te=l.lineSegments.prepareSegment(ne.length,l.layoutVertexArray,l.lineIndexArray),le=te.vertexLength;d&&q.push(l.layoutVertexArray.length-Z),T(ne[0],D,B),l.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),l.lineIndexArray.emplaceBack(le+ne.length-1,le),N.push(ne[0].x),N.push(ne[0].y);for(let fe=1;fe<ne.length;fe++)T(ne[fe],D,B),l.layoutVertexArray.emplaceBack(ne[fe].x,ne[fe].y),l.lineIndexArray.emplaceBack(le+fe-1,le+fe),N.push(ne[fe].x),N.push(ne[fe].y);te.vertexLength+=ne.length,te.primitiveLength+=ne.length}const re=Jg(N,L);for(let ne=0;ne<re.length;ne+=3)l.indexArray.emplaceBack(P+re[ne],P+re[ne+1],P+re[ne+2]);if(d&&this.elevationMode==="hd-road-base"){const ne=d.elevation.isTunnel(),te=d.elevation.safeArea,le=this.elevatedStructures.addVertices(D,B);this.elevatedStructures.addTriangles(re,le,ne);const fe=q.length;if(fe>0){for(let _e=0;_e<fe-1;_e++)this.elevatedStructures.addRenderableRing(d.index,q[_e]+le,q[_e+1]-q[_e],ne,te);this.elevatedStructures.addRenderableRing(d.index,q[fe-1]+le,D.length-q[fe-1],ne,te)}}w.vertexLength+=O,w.primitiveLength+=re.length/3}return[m,f]}getElevationFeature(o,l){if(!l)return;const d=+o.properties[Iy];return d!=null?l.find(m=>m.id===d):void 0}}let eA,tA,nA,rA;on(EC,"FillBucket",{omit:["layers","patternFeatures"]}),on(SC,"FillBufferData"),on(jd,"ElevatedStructures");class CC{constructor(o,l,d,m){if(this.triangleCount=l.length/3,this.min=new Gt(0,0),this.max=new Gt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[f,y]=[o[0].clone(),o[0].clone()];for(let P=1;P<o.length;++P){const N=o[P];f.x=Math.min(f.x,N.x),f.y=Math.min(f.y,N.y),y.x=Math.max(y.x,N.x),y.y=Math.max(y.y,N.y)}if(m){const P=Math.ceil(Math.max(y.x-f.x,y.y-f.y)/m);d=Math.max(d,P)}if(d===0)return;this.min=f,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const M=Math.max(T.x,T.y)/d;this.cellsX=Math.max(1,Math.ceil(T.x/M)),this.cellsY=Math.max(1,Math.ceil(T.y/M)),this.xScale=1/M,this.yScale=1/M;const O=[];for(let P=0;P<this.triangleCount;P++){const N=o[l[3*P+0]].sub(this.min),L=o[l[3*P+1]].sub(this.min),D=o[l[3*P+2]].sub(this.min),B=hp(Math.floor(Math.min(N.x,L.x,D.x)),this.xScale,this.cellsX),q=hp(Math.floor(Math.max(N.x,L.x,D.x)),this.xScale,this.cellsX),Z=hp(Math.floor(Math.min(N.y,L.y,D.y)),this.yScale,this.cellsY),re=hp(Math.floor(Math.max(N.y,L.y,D.y)),this.yScale,this.cellsY),ne=new Gt(0,0),te=new Gt(0,0),le=new Gt(0,0),fe=new Gt(0,0);for(let _e=Z;_e<=re;++_e){ne.y=te.y=_e*M,le.y=fe.y=(_e+1)*M;for(let Me=B;Me<=q;++Me)ne.x=le.x=Me*M,te.x=fe.x=(Me+1)*M,(vt(N,L,D,ne,te,fe)||vt(N,L,D,ne,fe,le))&&O.push({cellIdx:_e*this.cellsX+Me,triIdx:P})}}if(O.length===0)return;O.sort((P,N)=>P.cellIdx-N.cellIdx||P.triIdx-N.triIdx);let w=0;for(;w<O.length;){const P=O[w].cellIdx,N={start:this.payload.length,len:0};for(;w<O.length&&O[w].cellIdx===P;)++N.len,this.payload.push(O[w++].triIdx);this.cells[P]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const d=hp(o.x-this.min.x,this.xScale,this.cellsX),m=hp(o.y-this.min.y,this.yScale,this.cellsY),f=this.cells[m*this.cellsX+d];if(f){this._lazyInitLookup();for(let y=0;y<f.len;y++){const T=this.payload[f.start+y],M=Math.floor(T/8),O=1<<T%8;if(!(this.lookup[M]&O)&&(this.lookup[M]|=O,l.push(T),l.length===this.triangleCount))return}}}query(o,l,d){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const m=hp(o.x-this.min.x,this.xScale,this.cellsX),f=hp(l.x-this.min.x,this.xScale,this.cellsX),y=hp(o.y-this.min.y,this.yScale,this.cellsY),T=hp(l.y-this.min.y,this.yScale,this.cellsY);for(let M=y;M<=T;M++)for(let O=m;O<=f;O++){const w=this.cells[M*this.cellsX+O];if(w)for(let P=0;P<w.len;P++){const N=this.payload[w.start+P],L=Math.floor(N/8),D=1<<N%8;if(!(this.lookup[L]&D)&&(this.lookup[L]|=D,d.push(N),d.length===this.triangleCount))return}}}}function hp(h,o,l){return Math.max(0,Math.min(l-1,Math.floor(h*o)))}on(CC,"TriangleGridIndex");class iA{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(const d of this.footprints)l.push({footprint:d,id:o})}populate(o,l,d,m){const f=[];for(const{feature:y,id:T,index:M,sourceLayerIndex:O}of o){const w=this.layers[0]._featureFilter.needGeometry,P=$(y,w);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),P,d))continue;const N={id:T,properties:y.properties,type:y.type,sourceLayerIndex:O,index:M,geometry:w?P.geometry:U(y,d,m),patterns:{}};f.push(N)}for(const y of f){const{geometry:T,index:M,sourceLayerIndex:O}=y;this.addFeature(y,T,M,d,{},l.availableImages,l.brightness),l.featureIndex.insert(o[M].feature,T,M,O,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,l,d,m,f,y,T){}destroy(){}addFeature(o,l,d,m,f,y=[],T){for(const M of Tt(l,2)){const O=[],w=[],P=[],N=new Gt(1/0,1/0),L=new Gt(-1/0,-1/0);for(const q of M)if(q.length!==0){q!==M[0]&&P.push(w.length/2);for(let Z=0;Z<q.length;Z++)w.push(q[Z].x),w.push(q[Z].y),O.push(q[Z]),N.x=Math.min(N.x,q[Z].x),N.y=Math.min(N.y,q[Z].y),L.x=Math.max(L.x,q[Z].x),L.y=Math.max(L.y,q[Z].y)}const D=Jg(w,P),B=new CC(O,D,8,256);this.footprints.push({vertices:O,indices:D,grid:B,min:N,max:L})}}}on(iA,"ClipBucket",{omit:["layers"]});const fU=qn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pU=qn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),mU=qn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),gU=qn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),_U=qn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yU=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vU}=fU;class Py extends Gt{constructor(o,l,d){super(o,l),this.z=d}}class oA extends Py{constructor(o,l,d,m){super(o,l,d),this.w=m}}function iw(h,o,l,d){const m=[],f=d===0?(y,T,M,O,w,P)=>{y.push(new Gt(P,M+(P-T)/(O-T)*(w-M)))}:(y,T,M,O,w,P)=>{y.push(new Gt(T+(P-M)/(w-M)*(O-T),P))};for(const y of h){const T=[];for(const M of y){if(M.length<=2)continue;const O=[];for(let N=0;N<M.length-1;N++){const L=M[N].x,D=M[N].y,B=M[N+1].x,q=M[N+1].y,Z=d===0?L:D,re=d===0?B:q;Z<o?re>o&&f(O,L,D,B,q,o):Z>l?re<l&&f(O,L,D,B,q,l):O.push(M[N]),re<o&&Z>=o&&f(O,L,D,B,q,o),re>l&&Z<=l&&f(O,L,D,B,q,l)}let w=M[M.length-1];const P=d===0?w.x:w.y;P>=o&&P<=l&&O.push(w),O.length&&(w=O[O.length-1],O[0].x===w.x&&O[0].y===w.y||O.push(O[0]),T.push(O))}T.length&&m.push(T)}return m}function sA(h,o,l,d){const m=l==="x"?"y":"x",f=(d-h[l])/(o[l]-h[l]);h[m]=h[m]+(o[m]-h[m])*f,h[l]=d,h.hasOwnProperty("z")&&(h.z=Sn(h.z,o.z,f)),h.hasOwnProperty("w")&&(h.w=Sn(h.w,o.w,f))}function aA(h,o,l,d){const m=l,f=d;for(const y of["x","y"]){let T=h,M=o;T[y]>=M[y]&&(T=o,M=h),T[y]<m&&M[y]>m&&sA(T,M,y,m),T[y]<f&&M[y]>f&&sA(M,T,y,f)}}const ow=Number.MAX_SAFE_INTEGER;function lA(h,o,l,d){return h.order<o||h.order===ow||!(h.clipMask&l)||function(m,f){return f.length!==0&&f.find(y=>y===m)===void 0}(d,h.clipScope)}function sw(h,o){return h.x-o.x||h.y-o.y}function uA(h,o){return sw(h.min,o.min)===0&&sw(h.max,o.max)===0}function TC(h,o){return!(h.min.x>o.max.x||h.max.x<o.min.x||h.min.y>o.max.y||h.max.y<o.min.y)}function IC(h,o){if(h.length!==o.length)return!1;for(let l=0;l<h.length;l++)if(h[l].sourceId!==o[l].sourceId||!uA(h[l],o[l])||h[l].order!==o[l].order||h[l].clipMask!==o[l].clipMask||!Io(h[l].clipScope,o[l].clipScope))return!1;return!0}function cA(h,o,l){const d=1/Qt,m=1/(1<<l.canonical.z),f=(o.x*d+l.canonical.x)*m+l.wrap,y=(o.y*d+l.canonical.y)*m;return{min:new Gt((h.x*d+l.canonical.x)*m+l.wrap,(h.y*d+l.canonical.y)*m),max:new Gt(f,y)}}function xU(h,o,l){const d=1<<l.canonical.z,m=((o.x-l.wrap)*d-l.canonical.x)*Qt,f=(o.y*d-l.canonical.y)*Qt;return{min:new Gt(((h.x-l.wrap)*d-l.canonical.x)*Qt,(h.y*d-l.canonical.y)*Qt),max:new Gt(m,f)}}function hA(h,o,l,d,m,f,y){const T=h.indices,M=h.vertices,O=[];for(let w=d;w<d+m;w+=3){const P=o[l[w+0]+f],N=o[l[w+1]+f],L=o[l[w+2]+f],D=Math.min(P.x,N.x,L.x),B=Math.max(P.x,N.x,L.x),q=Math.min(P.y,N.y,L.y),Z=Math.max(P.y,N.y,L.y);O.length=0,h.grid.query(new Gt(D,q),new Gt(B,Z),O);for(let re=0;re<O.length;re++){const ne=O[re];if(vt(M[T[3*ne+0]],M[T[3*ne+1]],M[T[3*ne+2]],P,N,L,y))return!0}}return!1}function dA(h,o,l,d){if(!h||!l)return!1;let m=h.vertices;if(!o.canonical.equals(d.canonical)||o.wrap!==d.wrap){if(l.vertices.length<h.vertices.length)return dA(l,d,h,o);const f=o.canonical,y=d.canonical,T=Math.pow(2,y.z-f.z);m=h.vertices.map(M=>new Gt((M.x+f.x*Qt)*T-y.x*Qt,(M.y+f.y*Qt)*T-y.y*Qt))}return hA(l,m,h.indices,0,h.indices.length,0,0)}function fA(h,o,l,d){const m=Math.pow(2,d.z-l.z);return new Gt((h+l.x*Qt)*m-d.x*Qt,(o+l.y*Qt)*m-d.y*Qt)}function pA(h,o){const l=[];o.grid.queryPoint(h,l);const d=o.indices,m=o.vertices;for(let f=0;f<l.length;f++){const y=l[f];if(Ne([m[d[3*y+0]],m[d[3*y+1]],m[d[3*y+2]]],h))return!0}return!1}const MC=[new Gt(0,0),new Gt(Qt,0),new Gt(Qt,Qt),new Gt(0,Qt)];function mA(h,o){const l=[];let d=[];if(!o||h.length<2)return[h];if(h.length===2)return Ue(h[0],h[1],MC)?[h]:[];for(let m=0;m<h.length+2;m++){const f=h[m%h.length],y=h[(m+1)%h.length],T=Ue(m===0?h[h.length-1]:h[(m-1)%h.length],f,MC),M=Ue(f,y,MC),O=T||M;O&&d.push(f),O&&M||d.length>0&&(d.length>1&&l.push(d),d=[])}return d.length>1&&l.push(d),l}const PC=Qg.VectorTileFeature.types,bU=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wU=["fill-extrusion-flood-light-ground-radius"],SU=Math.pow(2,13),EU=Math.pow(2,15)-1,gA=new Gt(0,1),e_=2147483648;function Ux(h,o,l,d,m,f,y,T){h.emplaceBack((o<<1)+y,(l<<1)+f,(Math.floor(d*SU)<<1)+m,Math.round(T))}function Gx(h,o,l){h.emplaceBack(o.x*Qt,o.y*Qt,l?1:0)}function aw(h,o,l,d,m,f){h.emplaceBack(o.x,o.y,(l.x<<1)+d,(l.y<<1)+m,f)}function $x(h,o,l){h.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class _A{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yA{constructor(){this.centroidXY=new Gt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Gt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Gt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Gt(this.max.x-this.min.x,this.max.y-this.min.y)}}class vA{constructor(){this.acc=new Gt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,d){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<o.min.x?(o.min.x=l.x,m=!0):l.x>o.max.x&&(o.max.x=l.x,m=!0),l.y<o.min.y?(o.min.y=l.y,m=!0):l.y>o.max.y&&(o.max.y=l.y,m=!0),((l.x===0||l.x===Qt)&&l.x===d.x)!=((l.y===0||l.y===Qt)&&l.y===d.y)&&this.processBorderOverlap(l,d),m&&this.checkBorderIntersection(l,d)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,Sn(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Qt!=o.x>Qt&&this.addBorderIntersection(1,Sn(l.y,o.y,(Qt-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Sn(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Qt!=o.y>Qt&&this.addBorderIntersection(3,Sn(l.x,o.x,(Qt-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const d=o.x===0?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{const d=o.y===0?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){return this.accCount===0?new Gt(0,0):new Gt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function xA(h,o){const l=h.add(o)._unit(),d=er(h.x*l.x+h.y*l.y,-1,1);var m,f,y;return y=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(y)))/4*EU*((m=h).x*(f=o).y-m.y*f.x<0?-1:1)}const CU=[h=>h.x<0,h=>h.x>Qt,h=>h.y<0,h=>h.y>Qt];function TU(h,o,l,d){const m=[4];if(d===0)return m;l._mult(d);const f=h.sub(l),y=o.sub(l),T=[h,o,f,y];for(let M=0;M<4;M++)for(const O of T)if(CU[M](O)){m.push(M);break}return m}class bA{constructor(o){this.vertexArray=new za,this.indexArray=new Qo,this.programConfigurations=new Ku(o.layers,{zoom:o.zoom,lut:o.lut},l=>wU.includes(l)),this._segments=new xi,this.hiddenByLandmarkVertexArray=new jg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,l,d,m=!1){const f=o.length;if(f>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let M;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const O=o[0],w=o[1];M=xA(O.sub(o[f-1])._perp()._unit(),w.sub(O)._perp()._unit())}for(let O=0;O<f;O++){const w=O===f-1?0:O+1,P=o[O],N=o[w],L=o[w===f-1?0:w+1],D=N.sub(P)._perp()._unit(),B=xA(D,L.sub(N)._perp()._unit()),q=M,Z=B;if(AC(P,N,l)||m&&EA(P,l)&&EA(N,l)){M=B;continue}const re=T.vertexLength;aw(this.vertexArray,P,N,1,1,q),aw(this.vertexArray,P,N,1,0,q),aw(this.vertexArray,P,N,0,1,Z),aw(this.vertexArray,P,N,0,0,Z),T.vertexLength+=4;const ne=TU(P,N,D,d);for(const te of ne)this._segmentToGroundQuads[y].push({id:re,region:te}),this._segmentToRegionTriCounts[y][te]+=2,T.primitiveLength+=2;M=B}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),l=o.length;for(let d=0;d<l;d++)this._segmentToGroundQuads[d].sort((m,f)=>m.region-f.region);for(let d=0;d<l;d++){const m=this._segmentToGroundQuads[d],f=o[d],y=this._segmentToRegionTriCounts[d];y.reduce((M,O)=>M+O,0);let T=0;for(let M=0;M<=4;M++){const O=y[M];if(O!==0){let w=this.regionSegments[M];w||(w=this.regionSegments[M]=new xi);const P={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+T,vertexLength:f.vertexLength,primitiveLength:O};w.get().push(P)}T+=O}for(let M=0;M<m.length;M++){const O=m[M].id;this.indexArray.emplaceBack(O,O+1,O+3),this.indexArray.emplaceBack(O,O+3,O+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,d,m,f,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,d,m,f,y)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,pU.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,d,m,f,y,T){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,d,m,f,y,T)}updateHiddenByLandmark(o){if(!this.hasData())return;const l=o.groundVertexCount+o.groundVertexArrayOffset;if(o.groundVertexCount===0)return;const d=o.flags&e_?1:0;for(let m=o.groundVertexArrayOffset;m<l;++m)this.hiddenByLandmarkVertexArray.emplace(m,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,_U.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const l=this.regionSegments[o];l&&l.destroy()}}}}class lw{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qo,this.footprintVertices=new eo,this.footprintSegments=[],this.layoutVertexArray=new ul,this.centroidVertexArray=new Am,this.wallVertexArray=new kl,this.indexArray=new Qo,this.programConfigurations=new Ku(o.layers,{zoom:o.zoom,lut:o.lut},l=>bU.includes(l)),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new bA(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,d,m){this.features=[],this.hasPattern=or("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=_(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:y,index:T,sourceLayerIndex:M}of o){const O=this.layers[0]._featureFilter.needGeometry,w=$(f,O);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),w,d))continue;const P={id:y,sourceLayerIndex:M,index:T,geometry:O?w.geometry:U(f,d,m),properties:f.properties,type:f.type,patterns:{}},N=this.layoutVertexArray.length,L=PC[P.type]==="Polygon";if(this.hasPattern)this.features.push(br("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,l));else if(this.wallMode)for(const D of P.geometry)for(const B of mA(D,L))this.addFeature(P,[B],T,d,{},l.availableImages,m,l.brightness);else this.addFeature(P,P.geometry,T,d,{},l.availableImages,m,l.brightness);l.featureIndex.insert(f,P.geometry,T,M,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,d,m,f,y){for(const T of this.features){const M=PC[T.type]==="Polygon",{geometry:O}=T;if(this.wallMode)for(const w of O)for(const P of mA(w,M))this.addFeature(T,[P],T.index,l,d,m,f,y);else this.addFeature(T,O,T.index,l,d,m,f,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,l,d,m,f,y,T){this.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T),this.groundEffect.update(o,l,f,d,m,y,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,vU),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,gU.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,yU.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,mU.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,m,f,y,T,M){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,w=[new Gt(0,0),new Gt(Qt,Qt)],P=T.projection,N=P.name==="globe",L=this.wallMode||PC[o.type]==="Polygon",D=new vA;D.centroidDataIndex=this.centroidData.length;const B=new yA,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},m)<=0,Z=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},m);let re;if(B.height=Z,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ph),this.wallMode){if(N)return void vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;re=function(Te){const Ge=Te[0].x===Te[Te.length-1].x&&Te[0].y===Te[Te.length-1].y;(function(Jt){let Bt=0;const An=Jt.length;for(let un=0;un<An;un++)Bt+=(Jt[(un+1)%An].x-Jt[un].x)*(Jt[(un+1)%An].y+Jt[un].y);return Bt>=0})(Te)||(Te=Te.reverse());const He={geometry:[],joinNormals:[],indices:[]},Qe=[],Je=[],st=[];let rt=Te.length;for(;rt>=2&&Te[rt-1].equals(Te[rt-2]);)rt--;if(rt<(Ge?3:2))return He;let dt,lt,pt,kt,Nt,hn=0;for(;hn<rt-1&&Te[hn].equals(Te[hn+1]);)hn++;Ge&&(dt=Te[rt-2],Nt=Te[hn].sub(dt)._unit()._perp());for(let Jt=hn;Jt<rt;Jt++){if(pt=Jt===rt-1?Ge?Te[hn+1]:void 0:Te[Jt+1],pt&&Te[Jt].equals(pt))continue;Nt&&(kt=Nt),dt&&(lt=dt),dt=Te[Jt],Nt=pt?pt.sub(dt)._unit()._perp():kt,kt=kt||Nt;let Bt=kt.add(Nt);Bt.x===0&&Bt.y===0||Bt._unit();const An=Bt.x*Nt.x+Bt.y*Nt.y,un=An!==0?1/An:1/0,_n=kt.x*Nt.y-kt.y*Nt.x>0;let zn="miter";const sr=2;zn==="miter"&&un>sr&&(zn="bevel"),zn==="bevel"&&(un>100&&(zn="flipbevel"),un<sr&&(zn="miter"));const Un=(gr,nr,vr,$r)=>{const fi=new Gt(gr.x,gr.y),jn=new Gt(gr.x,gr.y);fi.x+=nr.x*$r,fi.y+=nr.y*$r,jn.x-=nr.x*Math.max(vr,1),jn.y-=nr.y*Math.max(vr,1),st.push(nr),Qe.push(fi),Je.push(jn)};if(zn==="miter")Bt._mult(un),Un(dt,Bt,0,0);else if(zn==="flipbevel")Bt=Nt.mult(-1),Un(dt,Bt,0,0),Un(dt,Bt.mult(-1),0,0);else{const gr=-Math.sqrt(un*un-1),nr=_n?gr:0,vr=_n?0:gr;lt&&Un(dt,kt,nr,vr),pt&&Un(dt,Nt,nr,vr)}}He.geometry=[...Qe,...Je.reverse(),Qe[0]],He.joinNormals=[...st,...st.reverse(),st[st.length-1]];const qt=He.geometry.length-1;for(let Jt=0;Jt<qt/2;Jt++)if(Jt+1<qt/2){let Bt=Jt,An=Jt+1,un=qt-1-Jt,_n=qt-2-Jt;Bt=Bt===0?qt-1:Bt-1,An=An===0?qt-1:An-1,un=un===0?qt-1:un-1,_n=_n===0?qt-1:_n-1,He.indices.push(un),He.indices.push(An),He.indices.push(Bt),He.indices.push(un),He.indices.push(_n),He.indices.push(An)}return He}(l[0]),l=[re.geometry]}const ne=(Te,Ge)=>Te<(Ge.length-1)/2||Te===Ge.length-1,te=this.wallMode?[l]:Tt(l,500);for(let Te=te.length-1;Te>=0;Te--){const Ge=te[Te];(Ge.length===0||(le=Ge[0]).every(Ae=>Ae.x<=0)||le.every(Ae=>Ae.x>=Qt)||le.every(Ae=>Ae.y<=0)||le.every(Ae=>Ae.y>=Qt))&&te.splice(Te,1)}var le;let fe;if(N)fe=MA(te,w,m);else{fe=[];for(const Te of te)fe.push({polygon:Te,bounds:w})}const _e=L?this.edgeRadius:0,Me=_e>0&&this.zoom<17,Ce=(Te,Ge)=>{if(Te.length===0)return!1;const Ae=Te[Te.length-1];return Ge.x===Ae.x&&Ge.y===Ae.y};for(const{polygon:Te,bounds:Ge}of fe){let Ae=0,He=0;for(const rt of Te)L&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),He+=L?rt.length-1:rt.length;const Qe=this.segments.prepareSegment((L?5:4)*He,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const Je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},st=new _A;if(st.vertexOffset=this.footprintVertices.length,st.indexOffset=3*this.footprintIndices.length,st.ringIndices=[],L){const rt=[],dt=[];Ae=Qe.vertexLength;for(let pt=0;pt<Te.length;pt++){const kt=Te[pt];kt.length&&pt!==0&&dt.push(rt.length/2);const Nt=[];let hn,qt;hn=kt[1].sub(kt[0])._perp()._unit(),st.ringIndices.push(kt.length-1);for(let Jt=1;Jt<kt.length;Jt++){const Bt=kt[Jt],An=kt[Jt===kt.length-1?1:Jt+1],un=Bt.clone();if(_e){qt=An.sub(Bt)._perp()._unit();const _n=hn.add(qt)._unit(),zn=_e*Math.min(4,1/(hn.x*_n.x+hn.y*_n.y));un.x+=zn*_n.x,un.y+=zn*_n.y,un.x=Math.round(un.x),un.y=Math.round(un.y),hn=qt}if(!q||_e!==0&&!Me||Ce(Nt,un)||Nt.push(un),Ux(this.layoutVertexArray,un.x,un.y,0,0,1,1,0),this.wallMode){const _n=ne(Jt,kt);Gx(this.wallVertexArray,re.joinNormals[Jt],!_n)}Qe.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),rt.push(Bt.x,Bt.y),N&&$x(this.layoutVertexExtArray,P.projectTilePoint(un.x,un.y,m),P.upVector(m,un.x,un.y))}q&&(_e===0||Me)&&(Nt.length!==0&&Ce(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,Ge,O))}const lt=this.wallMode?re.indices:Jg(rt,dt);for(let pt=0;pt<lt.length;pt+=3)this.footprintIndices.emplaceBack(st.vertexOffset+lt[pt+0],st.vertexOffset+lt[pt+1],st.vertexOffset+lt[pt+2]),this.indexArray.emplaceBack(Ae+lt[pt],Ae+lt[pt+2],Ae+lt[pt+1]),Qe.primitiveLength++;st.indexCount+=lt.length,st.vertexCount+=this.footprintVertices.length-st.vertexOffset}for(let rt=0;rt<Te.length;rt++){const dt=Te[rt];D.startRing(B,dt[0]);let lt=dt.length>4&&CA(dt[dt.length-2],dt[0],dt[1]),pt=_e?IU(dt[dt.length-2],dt[0],dt[1],_e):0;const kt=[];let Nt,hn,qt;hn=dt[1].sub(dt[0])._perp()._unit();let Jt=!0;for(let Bt=1,An=0;Bt<dt.length;Bt++){let un=dt[Bt-1],_n=dt[Bt];const zn=dt[Bt===dt.length-1?1:Bt+1];if(D.appendEdge(B,_n,un),AC(_n,un,Ge)){_e&&(hn=zn.sub(_n)._perp()._unit(),Jt=!Jt);continue}const sr=_n.sub(un)._perp(),Un=sr.x/(Math.abs(sr.x)+Math.abs(sr.y)),gr=sr.y>0?1:0,nr=un.dist(_n);if(An+nr>32768&&(An=0),_e){qt=zn.sub(_n)._perp()._unit();let jn=SA(un,_n,zn,wA(hn,qt),_e);isNaN(jn)&&(jn=0);const Tr=_n.sub(un)._unit();un=un.add(Tr.mult(pt))._round(),_n=_n.add(Tr.mult(-jn))._round(),pt=jn,hn=qt,q&&this.zoom>=17&&(Ce(kt,un)||kt.push(un),Ce(kt,_n)||kt.push(_n))}const vr=Qe.vertexLength,$r=dt.length>4&&CA(un,_n,zn);let fi=TA(An,lt,Jt);if(Ux(this.layoutVertexArray,un.x,un.y,Un,gr,0,0,fi),Ux(this.layoutVertexArray,un.x,un.y,Un,gr,0,1,fi),this.wallMode){const jn=ne(Bt-1,dt),Tr=re.joinNormals[Bt-1];Gx(this.wallVertexArray,Tr,jn),Gx(this.wallVertexArray,Tr,jn)}if(An+=nr,fi=TA(An,$r,!Jt),lt=$r,Ux(this.layoutVertexArray,_n.x,_n.y,Un,gr,0,0,fi),Ux(this.layoutVertexArray,_n.x,_n.y,Un,gr,0,1,fi),this.wallMode){const jn=ne(Bt,dt),Tr=re.joinNormals[Bt];Gx(this.wallVertexArray,Tr,jn),Gx(this.wallVertexArray,Tr,jn)}if(Qe.vertexLength+=4,this.indexArray.emplaceBack(vr+0,vr+1,vr+2),this.indexArray.emplaceBack(vr+1,vr+3,vr+2),Qe.primitiveLength+=2,_e){const jn=Ae+(Bt===1?dt.length-2:Bt-2),Tr=Bt===1?Ae:jn+1;if(this.indexArray.emplaceBack(vr+1,jn,vr+3),this.indexArray.emplaceBack(jn,Tr,vr+3),Qe.primitiveLength+=2,Nt===void 0&&(Nt=vr),!AC(zn,dt[Bt],Ge)){const Di=Bt===dt.length-1?Nt:Qe.vertexLength;this.indexArray.emplaceBack(vr+2,vr+3,Di),this.indexArray.emplaceBack(vr+3,Di+1,Di),this.indexArray.emplaceBack(vr+3,Tr,Di+1),Qe.primitiveLength+=3}Jt=!Jt}if(N){const jn=this.layoutVertexExtArray,Tr=P.projectTilePoint(un.x,un.y,m),Di=P.projectTilePoint(_n.x,_n.y,m),zi=P.upVector(m,un.x,un.y),Zi=P.upVector(m,_n.x,_n.y);$x(jn,Tr,zi),$x(jn,Tr,zi),$x(jn,Di,Zi),$x(jn,Di,Zi)}}L&&(Ae+=dt.length-1),q&&_e&&this.zoom>=17&&(kt.length!==0&&Ce(kt,kt[0])&&kt.pop(),this.groundEffect.addData(kt,Ge,O,_e>0))}this.footprintSegments.push(st),Je.triangleCount=this.indexArray.length-Je.triangleArrayOffset,this.polygonSegments.push(Je),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=D.borders?gA:this.encodeCentroid(D,B),this.centroidData.push(B),D.borders){this.featuresOnBorder.push(D);const Te=this.featuresOnBorder.length-1;for(let Ge=0;Ge<D.borders.length;Ge++)D.borders[Ge][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ge].push(Te)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,f,y,m,M),this.groundEffect.addPaintPropertiesData(o,d,f,y,m,M),this.maxHeight=Math.max(this.maxHeight,Z)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}splitToSubtiles(){const o=[];for(let T=0;T<this.centroidData.length;T++){const M=this.centroidData[T],O=+(M.min.y+M.max.y>Qt),w=2*O+(+(M.min.x+M.max.x>Qt)^O);for(let P=0;P<M.polygonSegLen;P++){const N=M.polygonSegIdx+P;o.push({centroidIdx:T,subtile:w,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const l=new Qo;o.sort((T,M)=>T.triangleSegmentIdx===M.triangleSegmentIdx?T.subtile-M.subtile:T.triangleSegmentIdx-M.triangleSegmentIdx);let d=0,m=0,f=0;for(const T of o){if(T.triangleSegmentIdx!==d)break;f++}const y=o.length;for(;m!==o.length;){d=o[m].triangleSegmentIdx;let T=0,M=m,O=m;for(let w=M;w<f&&o[w].subtile===T;w++)O++;for(;M!==f;){const w=o[M];T=w.subtile;const P=this.centroidData[w.centroidIdx].min.clone(),N=this.centroidData[w.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=M;D<O;D++){const B=o[D],q=this.polygonSegments[B.polygonSegmentIdx],Z=this.centroidData[B.centroidIdx].min,re=this.centroidData[B.centroidIdx].max,ne=this.indexArray.uint16;for(let te=q.triangleArrayOffset;te<q.triangleArrayOffset+q.triangleCount;te++)l.emplaceBack(ne[3*te],ne[3*te+1],ne[3*te+2]);L.primitiveLength+=q.triangleCount,P.x=Math.min(P.x,Z.x),P.y=Math.min(P.y,Z.y),N.x=Math.max(N.x,re.x),N.y=Math.max(N.y,re.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:P,max:N}),M=O;for(let D=M;D<f&&o[D].subtile===o[M].subtile;D++)O++}m=f;for(let w=m;w<y&&o[w].triangleSegmentIdx===o[m].triangleSegmentIdx;w++)f++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,d){const m=new xi;if(this.wallMode){for(const B of this.triangleSubSegments)m.segments.push(B.segment);return m}let f=0,y=0;const T=1<<o.canonical.z;if(l){const B=l.getMinMaxForTile(o);B&&(f=B.min,y=B.max)}y+=this.maxHeight;const M=o.toUnwrapped();let O;const w=[M.canonical.x/T+M.wrap,M.canonical.y/T],P=[(M.canonical.x+1)/T+M.wrap,(M.canonical.y+1)/T],N=(B,q,Z)=>[B[0]*(1-Z[0])+q[0]*Z[0],B[1]*(1-Z[1])+q[1]*Z[1]],L=[],D=[];for(const B of this.triangleSubSegments){L[0]=B.min.x/Qt,L[1]=B.min.y/Qt,D[0]=B.max.x/Qt,D[1]=B.max.y/Qt;const q=N(w,P,L),Z=N(w,P,D);if(new mn([q[0],q[1],f],[Z[0],Z[1],y]).intersectsPrecise(d)===0){O&&(m.segments.push(O),O=void 0);continue}const re=B.segment;O&&O.vertexOffset!==re.vertexOffset&&(m.segments.push(O),O=void 0),O?(O.vertexLength+=re.vertexLength,O.primitiveLength+=re.primitiveLength):O={vertexOffset:re.vertexOffset,primitiveLength:re.primitiveLength,vertexLength:re.vertexLength,primitiveOffset:re.primitiveOffset,sortKey:void 0,vaos:{}}}return O&&m.segments.push(O),m}encodeCentroid(o,l){const d=o.centroid(),m=l.span(),f=Math.min(7,Math.round(m.x*this.tileToMeter/10)),y=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new Gt(er(d.x,1,Qt-1)<<3|f,er(d.y,1,Qt-1)<<3|y)}encodeBorderCentroid(o){if(!o.borders)return new Gt(0,0);const l=o.borders,d=Number.MAX_VALUE;if(l[0][0]!==d||l[1][0]!==d){const m=l[0][0]!==d?0:1;return new Gt(6|(l[0][0]!==d?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{const m=l[2][0]!==d?2:3;return new Gt((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==d?0:65528))}}showCentroid(o){const l=this.centroidData[o.centroidDataIndex];l.flags&=e_,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const l=o.vertexArrayOffset,d=o.vertexCount+o.vertexArrayOffset,m=o.flags&e_?gA:o.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||f!==m.x){for(let y=l;y<d;++y)this.centroidVertexArray.emplace(y,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,d){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(o.toUnwrapped());if(IC(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const f=[];for(const y of this.activeReplacements){if(y.order<d)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-o.canonical.z));for(const M of this.centroidData)if(!(M.flags&e_||y.min.x>M.max.x||M.min.x>y.max.x||y.min.y>M.max.y||M.min.y>y.max.y))for(let O=0;O<M.footprintSegLen;O++){const w=this.footprintSegments[M.footprintSegIdx+O];if(f.length=0,MU(this.footprintVertices,w.vertexOffset,w.vertexCount,y.footprintTileId.canonical,o.canonical,f),hA(y.footprint,f,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-T)){M.flags|=e_;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,d){let m=!1;for(let f=0;f<d.footprintSegLen;f++){const y=this.footprintSegments[d.footprintSegIdx+f];let T=0;for(const M of y.ringIndices){for(let O=T,w=M+T-1;O<M+T;w=O++){const P=this.footprintVertices.int16[2*(O+y.vertexOffset)+0],N=this.footprintVertices.int16[2*(O+y.vertexOffset)+1],L=this.footprintVertices.int16[2*(w+y.vertexOffset)+1];N>l!=L>l&&o<(this.footprintVertices.int16[2*(w+y.vertexOffset)+0]-P)*(l-N)/(L-N)+P&&(m=!m)}T=M}}return m}getHeightAtTileCoord(o,l){let d=Number.NEGATIVE_INFINITY,m=!0;const f=4*(o+Qt)*Qt+(l+Qt);if(this.partLookup.hasOwnProperty(f)){const y=this.partLookup[f];return y?{height:y.height,hidden:!!(y.flags&e_)}:void 0}for(const y of this.centroidData)o>y.max.x||y.min.x>o||l>y.max.y||y.min.y>l||this.footprintContainsPoint(o,l,y)&&y&&y.height>d&&(d=y.height,this.partLookup[f]=y,m=!!(y.flags&e_));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:m};this.partLookup[f]=void 0}}function wA(h,o){const l=h.add(o)._unit();return h.x*l.x+h.y*l.y}function IU(h,o,l,d){const m=o.sub(h)._perp()._unit(),f=l.sub(o)._perp()._unit();return SA(h,o,l,wA(m,f),d)}function SA(h,o,l,d,m){const f=Math.sqrt(1-d*d);return Math.min(h.dist(o)/3,o.dist(l)/3,m*f/d)}function AC(h,o,l){return h.x<l[0].x&&o.x<l[0].x||h.x>l[1].x&&o.x>l[1].x||h.y<l[0].y&&o.y<l[0].y||h.y>l[1].y&&o.y>l[1].y}function EA(h,o){return h.x<o[0].x||h.x>o[1].x||h.y<o[0].y||h.y>o[1].y}function CA(h,o,l){if(h.x<0||h.x>=Qt||o.x<0||o.x>=Qt||l.x<0||l.x>=Qt)return!1;const d=l.sub(o),m=d.perp(),f=h.sub(o);return(d.x*f.x+d.y*f.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(f.x*f.x+f.y*f.y))>-.866&&m.x*f.x+m.y*f.y<0}function TA(h,o,l){const d=o?2|h:-3&h;return l?1|d:-2&d}function IA(){const h=Math.PI/32,o=Math.tan(h),l=Do;return l*Math.sqrt(1+2*o*o)-l}function MA(h,o,l){const d=1<<l.z,m=Va(l.x/d),f=Va((l.x+1)/d),y=go(l.y/d),T=go((l.y+1)/d);return function(M,O,w,P,N=0,L){const D=[];if(!M.length||!w||!P)return D;const B=(fe,_e)=>{for(const Me of fe)D.push({polygon:Me,bounds:_e})},q=Math.ceil(Math.log2(w)),Z=Math.ceil(Math.log2(P)),re=q-Z,ne=[];for(let fe=0;fe<Math.abs(re);fe++)ne.push(re>0?0:1);for(let fe=0;fe<Math.min(q,Z);fe++)ne.push(0),ne.push(1);let te=M;if(te=iw(te,O[0].y-N,O[1].y+N,1),te=iw(te,O[0].x-N,O[1].x+N,0),!te.length)return D;const le=[];for(ne.length?le.push({polygons:te,bounds:O,depth:0}):B(te,O);le.length;){const fe=le.pop(),_e=fe.depth,Me=ne[_e],Ce=fe.bounds[0],Te=fe.bounds[1],Ge=Me===0?Ce.x:Ce.y,Ae=Me===0?Te.x:Te.y,He=L?L(Me,Ge,Ae):.5*(Ge+Ae),Qe=iw(fe.polygons,Ge-N,He+N,Me),Je=iw(fe.polygons,He-N,Ae+N,Me);if(Qe.length){const st=[Ce,new Gt(Me===0?He:Te.x,Me===1?He:Te.y)];ne.length>_e+1?le.push({polygons:Qe,bounds:st,depth:_e+1}):B(Qe,st)}if(Je.length){const st=[new Gt(Me===0?He:Ce.x,Me===1?He:Ce.y),Te];ne.length>_e+1?le.push({polygons:Je,bounds:st,depth:_e+1}):B(Je,st)}}return D}(h,o,Math.ceil((f-m)/11.25),Math.ceil((y-T)/11.25),1,(M,O,w)=>{if(M===0)return .5*(O+w);{const P=go((l.y+O/Qt)/d);return(es(.5*(go((l.y+w/Qt)/d)+P))*d-l.y)*Qt}})}function MU(h,o,l,d,m,f){const y=Math.pow(2,d.z-m.z);for(let T=0;T<l;T++){let M=h.int16[2*(T+o)+0],O=h.int16[2*(T+o)+1];M=(M+m.x*Qt)*y-d.x*Qt,O=(O+m.y*Qt)*y-d.y*Qt,f.push(new Gt(M,O))}}let PA,AA;function qx(h,o){return h.x*o.x+h.y*o.y}function RA(h,o){if(h.length===1){let l=0;const d=o[l++];let m;for(;!m||d.equals(m);)if(m=o[l++],!m)return 1/0;for(;l<o.length;l++){const f=o[l],y=h[0],T=m.sub(d),M=f.sub(d),O=y.sub(d),w=qx(T,T),P=qx(T,M),N=qx(M,M),L=qx(O,T),D=qx(O,M),B=w*N-P*P,q=(N*L-P*D)/B,Z=(w*D-P*L)/B,re=d.z*(1-q-Z)+m.z*q+f.z*Z;if(isFinite(re))return re}return 1/0}{let l=1/0;for(const d of o)l=Math.min(l,d.z);return l}}function LA(h,o,l,d,m,f,y,T){const M=y*m.getElevationAt(h,o,!0,!0),O=f[0]!==0,w=O?f[1]===0?y*(f[0]/7-450):y*function(P,N,L){const D=Math.floor(N[0]/8),B=Math.floor(N[1]/8),q=10*(N[0]-8*D),Z=10*(N[1]-8*B),re=P.getElevationAt(D,B,!0,!0),ne=P.getMeterToDEM(L),te=Math.floor(.5*(q*ne-1)),le=Math.floor(.5*(Z*ne-1)),fe=P.tileCoordToPixel(D,B),_e=2*te+1,Me=2*le+1,Ce=function(Je,st,rt,dt,lt){return[Je.getElevationAtPixel(st,rt,!0),Je.getElevationAtPixel(st+lt,rt,!0),Je.getElevationAtPixel(st,rt+lt,!0),Je.getElevationAtPixel(st+dt,rt+lt,!0)]}(P,fe.x-te,fe.y-le,_e,Me),Te=Math.abs(Ce[0]-Ce[1]),Ge=Math.abs(Ce[2]-Ce[3]),Ae=Math.abs(Ce[0]-Ce[2])+Math.abs(Ce[1]-Ce[3]),He=Math.min(.25,.5*ne*(Te+Ge)/_e),Qe=Math.min(.25,.5*ne*Ae/Me);return re+Math.max(He*q,Qe*Z)}(m,f,T):M;return{base:M+(l===0?-1:l),top:O?Math.max(w+d,M+l+2):M+d}}on(lw,"FillExtrusionBucket",{omit:["layers","features"]}),on(yA,"PartData"),on(_A,"FootprintSegment"),on(vA,"BorderCentroidData"),on(bA,"GroundEffect");const PU=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),AU=qn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:RU}=PU,LU=qn([{name:"a_packed",components:3,type:"Float32"}]),{members:OU}=LU,DU=qn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:NU}=DU;class OA{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Bd({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const d=this.getKey(o,l);return this.positions[d]}trim(){const o=this.width,l=this.height=xl(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){const m=[];let f=o.length%2==1?-o[o.length-1]*d:0,y=o[0]*d,T=!0;m.push({left:f,right:y,isDash:T,zeroLength:o[0]===0});let M=o[0];for(let O=1;O<o.length;O++){T=!T;const w=o[O];f=M*d,M+=w,y=M*d,m.push({left:f,right:y,isDash:T,zeroLength:w===0})}return m}addRoundDash(o,l,d){const m=l/2;for(let f=-d;f<=d;f++){const y=this.width*(this.nextRow+d+f);let T=0,M=o[T];for(let O=0;O<this.width;O++){O/M.right>1&&(M=o[++T]);const w=Math.abs(O-M.left),P=Math.abs(O-M.right),N=Math.min(w,P);let L;const D=f/d*(m+1);if(M.isDash){const B=m-Math.abs(D);L=Math.sqrt(N*N+B*B)}else L=m-Math.sqrt(N*N+D*D);this.image.data[y+O]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(o,l){for(let M=o.length-1;M>=0;--M){const O=o[M],w=o[M+1];O.zeroLength?o.splice(M,1):w&&w.isDash===O.isDash&&(w.left=O.left,o.splice(M,1))}const d=o[0],m=o[o.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const f=this.width*this.nextRow;let y=0,T=o[y];for(let M=0;M<this.width;M++){M/T.right>1&&(T=o[++y]);const O=Math.abs(M-T.left),w=Math.abs(M-T.right),P=Math.min(O,w);this.image.data[f+M]=Math.max(0,Math.min(255,(T.isDash?P:-P)+l+128))}}addDash(o,l){const d=this.getKey(o,l);if(this.positions[d])return this.positions[d];const m=l==="round",f=m?7:0,y=2*f+1;if(this.nextRow+y>this.height)return vi("LineAtlas out of space"),null;o.length===0&&o.push(1);let T=0;for(let w=0;w<o.length;w++)o[w]<0&&(vi("Negative value is found in line dasharray, replacing values with 0"),o[w]=0),T+=o[w];if(T!==0){const w=this.width/T,P=this.getDashRanges(o,this.width,w);m?this.addRoundDash(P,w,f):this.addRegularDash(P,l==="square"?.5*w:0)}const M=this.nextRow+f;this.nextRow+=y;const O={tl:[M,f],br:[T,0]};return this.positions[d]=O,O}}on(OA,"LineAtlas");const kU=Qg.VectorTileFeature.types,FU=Math.cos(Math.PI/180*37.5),zU=Math.cos(Math.PI/180*5);class RC{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new bm,this.layoutVertexArray2=new cl,this.patternVertexArray=new cl,this.indexArray=new Qo,this.programConfigurations=new Ku(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new xi,this.maxLineLength=0,this.zOffsetVertexArray=new cl,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:Qt/64}updateFootprints(o,l){}populate(o,l,d,m){this.hasPattern=or("line",this.layers,this.pixelRatio,l);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=_(d);const y=this.layers[0].layout.get("line-z-offset"),T=y.isConstant()&&!y.constantOr(0),M=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=M==="sea"||M==="ground"||!T&&M==="none",this.hasZOffset&&M==="none"&&vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const O=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&O!==void 0;const w=[];for(const{feature:D,id:B,index:q,sourceLayerIndex:Z}of o){const re=this.layers[0]._featureFilter.needGeometry,ne=$(D,re);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),ne,d))continue;const te=f?f.evaluate(ne,{},d):void 0,le={id:B,properties:D.properties,type:D.type,sourceLayerIndex:Z,index:q,geometry:re?ne.geometry:U(D,d,m),patterns:{},sortKey:te};w.push(le)}f&&w.sort((D,B)=>D.sortKey-B.sortKey);const{lineAtlas:P,featureIndex:N}=l,L=this.addConstantDashes(P);for(const D of w){const{geometry:B,index:q,sourceLayerIndex:Z}=D;if(L&&this.addFeatureDashes(D,P),this.hasPattern){const re=br("line",this.layers,D,this.zoom,this.pixelRatio,l);this.patternFeatures.push(re)}else this.addFeature(D,B,q,d,P.positions,l.availableImages,l.brightness);N.insert(o[q].feature,B,q,Z,this.index)}}addConstantDashes(o){let l=!1;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,f=d.layout.get("line-cap").value;if(m.kind!=="constant"||f.kind!=="constant")l=!0;else{const y=f.value,T=m.value;if(!T)continue;o.addDash(T,y)}}return l}addFeatureDashes(o,l){const d=this.zoom;for(const m of this.layers){const f=m.paint.get("line-dasharray").value,y=m.layout.get("line-cap").value;if(f.kind==="constant"&&y.kind==="constant")continue;let T,M;if(f.kind==="constant"){if(T=f.value,!T)continue}else T=f.evaluate({zoom:d},o);M=y.kind==="constant"?y.value:y.evaluate({zoom:d},o),l.addDash(T,M),o.patterns[m.id]=l.getKey(T,M)}}update(o,l,d,m,f,y,T){this.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T)}addFeatures(o,l,d,m,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,l,d,m,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,OU)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,NU)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,AU.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,RU),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,m,f,y,T){const M=this.layers[0].layout,O=M.get("line-join").evaluate(o,{}),w=M.get("line-cap").evaluate(o,{}),P=M.get("line-miter-limit"),N=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=M.get("line-z-offset").value;const L=this.layers[0].paint.get("line-width").value;L.kind!=="constant"&&L.isLineProgressConstant===!1&&(this.variableWidthValue=L);for(const D of l)this.addLine(D,o,m,O,w,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,f,y,m,T)}addLine(o,l,d,m,f,y,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const M=m==="none";if(this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<o.length-1;ne++)this.totalDistance+=o[ne].dist(o[ne+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=kU[l.type]==="Polygon";let w=o.length;for(;w>=2&&o[w-1].equals(o[w-2]);)w--;let P=0;for(;P<w-1&&o[P].equals(o[P+1]);)P++;if(w<(O?3:2))return;m==="bevel"&&(y=1.05);const N=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let L,D,B,q,Z,re;this.e1=this.e2=-1,O&&(L=o[w-2],Z=o[P].sub(L)._unit()._perp());for(let ne=P;ne<w;ne++){if(B=ne===w-1?O?o[P+1]:void 0:o[ne+1],B&&o[ne].equals(B))continue;Z&&(q=Z),L&&(D=L),L=o[ne],re=this.evaluateLineProgressFeatures(D?D.dist(L):0),Z=B?B.sub(L)._unit()._perp():q,q=q||Z;const te=D&&B;let le=te?m:O||M?"butt":f;const fe=q.x*Z.x+q.y*Z.y;if(M){const Qe=function(Je){if(Je.patternJoinNone){const st=Je.segmentPoints.length/2,rt=Je.lineSoFar-Je.segmentStart;for(let dt=0;dt<st;++dt){const lt=Je.segmentPoints[2*dt+1],pt=Math.round(Je.segmentPoints[2*dt])+.5+.25*lt;Je.patternVertexArray.emplaceBack(pt,rt,Je.segmentStart),Je.patternVertexArray.emplaceBack(pt,rt,Je.segmentStart)}Je.segmentPoints.length=0}Je.e1=Je.e2=-1};if(te&&fe<zU){this.updateDistance(D,L),this.addCurrentVertex(L,q,1,1,N,re),Qe(this),this.addCurrentVertex(L,Z,-1,-1,N,re);continue}if(D){if(!B){this.updateDistance(D,L),this.addCurrentVertex(L,q,1,1,N,re),Qe(this);continue}le="miter"}}let _e=q.add(Z);_e.x===0&&_e.y===0||_e._unit();const Me=_e.x*Z.x+_e.y*Z.y,Ce=Me!==0?1/Me:1/0,Te=2*Math.sqrt(2-2*Me),Ge=Me<FU&&D&&B,Ae=q.x*Z.y-q.y*Z.x>0,He=this.overscaling<=16?15*Qt/(512*this.overscaling):0;if(te&&le==="round"){if(Ce<T)le="miter";else if(Ce<=2){const Qe=LC(L,-10,Qt+10);le=this.hasZOffset&&(Qe||this.hasCrossSlope)?"miter":"fakeround"}}if(le==="miter"&&Ce>y&&(le="bevel"),le==="bevel"&&(Ce>2&&(le="flipbevel"),Ce<y&&(le="miter")),D&&!(le==="miter"&&Ge)&&this.updateDistance(D,L),le==="miter")if(Ge){const Qe=L.dist(D);if(Qe>2*He){const st=L.sub(L.sub(D)._mult(He/Qe)._round());this.updateDistance(D,st),this.addCurrentVertex(st,q,0,0,N,re),D=st}this.updateDistance(D,L),_e._mult(Ce),this.addCurrentVertex(L,_e,0,0,N,re);const Je=L.dist(B);if(Je>2*He){const st=L.add(B.sub(L)._mult(He/Je)._round());this.updateDistance(L,st),this.addCurrentVertex(st,Z,0,0,N,re),L=st}}else _e._mult(Ce),this.addCurrentVertex(L,_e,0,0,N,re);else if(le==="flipbevel"){if(Ce>100)_e=Z.mult(-1);else{const Qe=Ce*q.add(Z).mag()/q.sub(Z).mag();_e._perp()._mult(Qe*(Ae?-1:1))}this.addCurrentVertex(L,_e,0,0,N,re),this.addCurrentVertex(L,_e.mult(-1),0,0,N,re)}else if(le==="bevel"||le==="fakeround"){re!=null&&D&&this.addCurrentVertex(L,q,-1,-1,N,re);const Qe=L.dist(D)<=2*He&&le!=="bevel",Je=_e.mult(Ae?1:-1);Je._mult(Ce);const st=Z.mult(Ae?-1:1),rt=q.mult(Ae?-1:1),dt=this.evaluateLineProgressFeatures(this.distance);if(re==null&&(this.addHalfVertex(L,Je.x,Je.y,!1,!Ae,0,N,dt),Qe||this.addHalfVertex(L,Je.x+2*rt.x,Je.y+2*rt.y,!1,Ae,0,N,dt)),le==="fakeround"){const lt=Math.round(180*Te/Math.PI/20);this.addHalfVertex(L,rt.x,rt.y,!1,Ae,0,N,dt);for(let pt=0;pt<lt;pt++){let kt=pt/lt;if(kt!==.5){const hn=kt-.5;kt+=kt*hn*(kt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*hn*hn+(.848013+fe*(.215638*fe-1.06021)))}const Nt=st.sub(rt)._mult(kt)._add(rt)._unit();this.addHalfVertex(L,Nt.x,Nt.y,!1,Ae,0,N,dt)}this.addHalfVertex(L,st.x,st.y,!1,Ae,0,N,dt)}Qe||re!=null||this.addHalfVertex(L,Je.x+2*st.x,Je.y+2*st.y,!1,Ae,0,N,dt),re!=null&&B&&this.addCurrentVertex(L,Z,1,1,N,re)}else le==="butt"?this.addCurrentVertex(L,_e,0,0,N,re):le==="square"?(D||this.addCurrentVertex(L,_e,-1,-1,N,re),this.addCurrentVertex(L,_e,0,0,N,re),D&&this.addCurrentVertex(L,_e,1,1,N,re)):le==="round"&&(D&&(this.addCurrentVertex(L,q,0,0,N,re),this.addCurrentVertex(L,q,1,1,N,re,!0)),B&&(this.addCurrentVertex(L,Z,-1,-1,N,re,!0),this.addCurrentVertex(L,Z,0,0,N,re)))}}addVerticesTo(o,l,d,m,f,y,T,M,O,w){const P=(l.w-o.w)/this.tessellationStep|0;let N=0;const L=this.scaledDistance;if(P>1){this.lineSoFar=o.w;const B=(l.x-o.x)/P,q=(l.y-o.y)/P,Z=(l.z-o.z)/P,re=(l.w-o.w)/P;for(let ne=1;ne<P;++ne){o.x+=B,o.y+=q,o.z+=Z,this.lineSoFar+=re,N+=re;const te=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(o,d,m,w,!1,T,O,te),this.addHalfVertex(o,f,y,w,!0,-M,O,te)}}this.lineSoFar=l.w,this.scaledDistance=L;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,d,m,w,!1,T,O,D),this.addHalfVertex(l,f,y,w,!0,-M,O,D)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):vi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}:{zOffset:0,variableWidth:l}}addCurrentVertex(o,l,d,m,f,y,T=!1){const M=l.x+l.y*d,O=l.y-l.x*d,w=l.y*m-l.x,P=-l.y-l.x*m;if(y!=null){const N=this.hasZOffset,L=-10,D=Qt+10,B=y.zOffset,q=new oA(o.x,o.y,B,this.lineSoFar),Z=!!N&&LC(o,L,D),re=this.lineSoFar,ne=this.distance;if(this.currentVertex)if(Z){const te=this.currentVertexIsOutside,le=this.currentVertex,fe=new oA(o.x,o.y,B,this.lineSoFar);if(aA(le,fe,L,D),!LC(fe,L,D)){if(te){this.e1=this.e2=-1,this.distance-=le.dist(q),this.lineSoFar=le.w;const _e=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,M,O,T,!1,d,f,_e),this.addHalfVertex(le,w,P,T,!0,-m,f,_e),this.prevDistance=this.distance}this.distance=this.prevDistance+le.dist(fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(le,fe,M,O,w,P,d,m,f,T),this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}}else{const te=this.currentVertex;if(this.currentVertexIsOutside){aA(te,q,L,D),this.e1=this.e2=-1,this.distance-=te.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;const le=this.evaluateLineProgressFeatures(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,M,O,T,!1,d,f,le),this.addHalfVertex(te,w,P,T,!0,-m,f,le),this.prevDistance=this.distance,this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,q,M,O,w,P,d,m,f,T)}else Z||(this.addHalfVertex(o,M,O,T,!1,d,f,y),this.addHalfVertex(o,w,P,T,!0,-m,f,y));this.currentVertex=q,this.currentVertexIsOutside=Z,this.lineSoFar=re}else this.addHalfVertex(o,M,O,T,!1,d,f,y),this.addHalfVertex(o,w,P,T,!0,-m,f,y)}addHalfVertex({x:o,y:l},d,m,f,y,T,M,O){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((o<<1)+(f?1:0),(l<<1)+(y?1:0),Math.round(63*d)+128,Math.round(63*m)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Sn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const w=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),M.primitiveLength++),y?this.e2=w:this.e1=w,O!=null&&this.zOffsetVertexArray.emplaceBack(O.zOffset,O.variableWidth,O.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,l){this.prevDistance=this.distance,this.distance+=o.dist(l),this.updateScaledDistance()}}function LC(h,o,l){return h.x<o||h.x>l||h.y<o||h.y>l}let DA,NA;function kA(h,o,l){return o*(Qt/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}on(RC,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const FA=(h,o,l)=>(1-l)*h+l*o;function zA(h,o){return 1/kA(h,1,o.tileZoom)}function BA(h,o,l,d){return h.translatePosMatrix(d||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const jA=h=>{const o=[];VA(h)&&o.push("RENDER_LINE_DASH"),h.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const l=h.paint.get("line-trim-offset");l[0]===0&&l[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),h.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const d=h.layout.get("line-join").constantOr("miter")==="none",m=!!h.paint.get("line-pattern").constantOr(1);return d&&m&&o.push("LINE_JOIN_NONE"),o};function VA(h){const o=h.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}let OC;const UA=()=>OC||(OC={layout:DA||(DA=new li({"line-cap":new ln(ft.layout_line["line-cap"]),"line-join":new ln(ft.layout_line["line-join"]),"line-miter-limit":new Xt(ft.layout_line["line-miter-limit"]),"line-round-limit":new Xt(ft.layout_line["line-round-limit"]),"line-sort-key":new ln(ft.layout_line["line-sort-key"]),"line-z-offset":new ln(ft.layout_line["line-z-offset"]),"line-elevation-reference":new Xt(ft.layout_line["line-elevation-reference"]),"line-cross-slope":new Xt(ft.layout_line["line-cross-slope"]),visibility:new Xt(ft.layout_line.visibility),"line-width-unit":new Xt(ft.layout_line["line-width-unit"])})),paint:NA||(NA=new li({"line-opacity":new ln(ft.paint_line["line-opacity"]),"line-color":new ln(ft.paint_line["line-color"]),"line-translate":new Xt(ft.paint_line["line-translate"]),"line-translate-anchor":new Xt(ft.paint_line["line-translate-anchor"]),"line-width":new ln(ft.paint_line["line-width"]),"line-gap-width":new ln(ft.paint_line["line-gap-width"]),"line-offset":new ln(ft.paint_line["line-offset"]),"line-blur":new ln(ft.paint_line["line-blur"]),"line-dasharray":new ln(ft.paint_line["line-dasharray"]),"line-pattern":new ln(ft.paint_line["line-pattern"]),"line-gradient":new ka(ft.paint_line["line-gradient"]),"line-trim-offset":new Xt(ft.paint_line["line-trim-offset"]),"line-trim-fade-range":new Xt(ft.paint_line["line-trim-fade-range"]),"line-trim-color":new Xt(ft.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(ft.paint_line["line-emissive-strength"]),"line-border-width":new ln(ft.paint_line["line-border-width"]),"line-border-color":new ln(ft.paint_line["line-border-color"]),"line-occlusion-opacity":new Xt(ft.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},OC);class BU extends ln{possiblyEvaluate(o,l){return l=new ei(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,d,m){return l=Mo({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,d,m)}}let Hx;function GA(h,o){return o>0?o+2*h:h}const jU=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VU=qn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UU=qn([{name:"a_projected_pos",components:4,type:"Float32"}],4);qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const GU=qn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),$U=qn([{name:"a_texb",components:2,type:"Uint16"}]),qU=qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),HU=qn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $A=qn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WU=qn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Zs=24;const Vd=128;function qA(h,o,l,d,m){if(h.kind==="camera")return h.maxSize;if(h.kind==="composite"){const f=o.possiblyEvaluate(new ei(h.maxZoom),l).evaluate(m,{},l),y=o.possiblyEvaluate(new ei(h.minZoom),l).evaluate(m,{},l);return Math.max(f,y)}return o.possiblyEvaluate(new ei(d)).evaluate(m,{},l)}function DC(h,o){const{expression:l}=o;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ei(h+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:m}=l;let f=0;for(;f<d.length&&d[f]<=h;)f++;f=Math.max(0,f-1);let y=f;for(;y<d.length&&d[y]<h+1;)y++;y=Math.min(d.length-1,y);const T=d[f],M=d[y];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:M,minSize:l.evaluate(new ei(T)),maxSize:l.evaluate(new ei(M)),interpolationType:m}}}function uw(h,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:m}){return h.kind==="source"?d/Vd:h.kind==="composite"?Sn(d/Vd,m/Vd,l):o}function Hv(h,o,l=1){let d=0,m=0;if(h.kind==="constant")m=h.layoutSize*l;else if(h.kind!=="source"){const{interpolationType:f,minZoom:y,maxZoom:T}=h,M=f?er(Oa.interpolationFactor(f,o,y,T),0,1):0;h.kind==="camera"?m=Sn(h.minSize,h.maxSize,M)*l:d=M*l}return{uSizeT:d,uSize:m}}var XU=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Vd,evaluateSizeForFeature:uw,evaluateSizeForZoom:Hv,getRasterizedIconSize:qA,getSizeData:DC});function ZU(h,o,l){return h.sections.forEach(d=>{d.text=function(m,f,y){const T=f.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),da.applyArabicShaping&&(m=da.applyArabicShaping(m)),m}(d.text,o,l)}),h}const Wx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function YU(h){return h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""}function KU(h){return h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""||h===""}var HA,NC,WA,kC={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function JU(){return HA||(HA=1,kC.read=function(h,o,l,d,m){var f,y,T=8*m-d-1,M=(1<<T)-1,O=M>>1,w=-7,P=l?m-1:0,N=l?-1:1,L=h[o+P];for(P+=N,f=L&(1<<-w)-1,L>>=-w,w+=T;w>0;f=256*f+h[o+P],P+=N,w-=8);for(y=f&(1<<-w)-1,f>>=-w,w+=d;w>0;y=256*y+h[o+P],P+=N,w-=8);if(f===0)f=1-O;else{if(f===M)return y?NaN:1/0*(L?-1:1);y+=Math.pow(2,d),f-=O}return(L?-1:1)*y*Math.pow(2,f-d)},kC.write=function(h,o,l,d,m,f){var y,T,M,O=8*f-m-1,w=(1<<O)-1,P=w>>1,N=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=d?0:f-1,D=d?1:-1,B=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(T=isNaN(o)?1:0,y=w):(y=Math.floor(Math.log(o)/Math.LN2),o*(M=Math.pow(2,-y))<1&&(y--,M*=2),(o+=y+P>=1?N/M:N*Math.pow(2,1-P))*M>=2&&(y++,M/=2),y+P>=w?(T=0,y=w):y+P>=1?(T=(o*M-1)*Math.pow(2,m),y+=P):(T=o*Math.pow(2,P-1)*Math.pow(2,m),y=0));m>=8;h[l+L]=255&T,L+=D,T/=256,m-=8);for(y=y<<m|T,O+=m;O>0;h[l+L]=255&y,L+=D,y/=256,O-=8);h[l+L-D]|=128*B}),kC}function XA(){if(WA)return NC;WA=1,NC=o;var h=JU();function o(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var l=4294967296,d=1/l,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(te){return te.type===o.Bytes?te.readVarint()+te.pos:te.pos+1}function y(te,le,fe){return fe?4294967296*le+(te>>>0):4294967296*(le>>>0)+(te>>>0)}function T(te,le,fe){var _e=le<=16383?1:le<=2097151?2:le<=268435455?3:Math.floor(Math.log(le)/(7*Math.LN2));fe.realloc(_e);for(var Me=fe.pos-1;Me>=te;Me--)fe.buf[Me+_e]=fe.buf[Me]}function M(te,le){for(var fe=0;fe<te.length;fe++)le.writeVarint(te[fe])}function O(te,le){for(var fe=0;fe<te.length;fe++)le.writeSVarint(te[fe])}function w(te,le){for(var fe=0;fe<te.length;fe++)le.writeFloat(te[fe])}function P(te,le){for(var fe=0;fe<te.length;fe++)le.writeDouble(te[fe])}function N(te,le){for(var fe=0;fe<te.length;fe++)le.writeBoolean(te[fe])}function L(te,le){for(var fe=0;fe<te.length;fe++)le.writeFixed32(te[fe])}function D(te,le){for(var fe=0;fe<te.length;fe++)le.writeSFixed32(te[fe])}function B(te,le){for(var fe=0;fe<te.length;fe++)le.writeFixed64(te[fe])}function q(te,le){for(var fe=0;fe<te.length;fe++)le.writeSFixed64(te[fe])}function Z(te,le){return(te[le]|te[le+1]<<8|te[le+2]<<16)+16777216*te[le+3]}function re(te,le,fe){te[fe]=le,te[fe+1]=le>>>8,te[fe+2]=le>>>16,te[fe+3]=le>>>24}function ne(te,le){return(te[le]|te[le+1]<<8|te[le+2]<<16)+(te[le+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(te,le,fe){for(fe=fe||this.length;this.pos<fe;){var _e=this.readVarint(),Me=_e>>3,Ce=this.pos;this.type=7&_e,te(Me,le,this),this.pos===Ce&&this.skip(_e)}return le},readMessage:function(te,le){return this.readFields(te,le,this.readVarint()+this.pos)},readFixed32:function(){var te=Z(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=ne(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=Z(this.buf,this.pos)+Z(this.buf,this.pos+4)*l;return this.pos+=8,te},readSFixed64:function(){var te=Z(this.buf,this.pos)+ne(this.buf,this.pos+4)*l;return this.pos+=8,te},readFloat:function(){var te=h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var le,fe,_e=this.buf;return le=127&(fe=_e[this.pos++]),fe<128?le:(le|=(127&(fe=_e[this.pos++]))<<7,fe<128?le:(le|=(127&(fe=_e[this.pos++]))<<14,fe<128?le:(le|=(127&(fe=_e[this.pos++]))<<21,fe<128?le:function(Me,Ce,Te){var Ge,Ae,He=Te.buf;if(Ge=(112&(Ae=He[Te.pos++]))>>4,Ae<128||(Ge|=(127&(Ae=He[Te.pos++]))<<3,Ae<128)||(Ge|=(127&(Ae=He[Te.pos++]))<<10,Ae<128)||(Ge|=(127&(Ae=He[Te.pos++]))<<17,Ae<128)||(Ge|=(127&(Ae=He[Te.pos++]))<<24,Ae<128)||(Ge|=(1&(Ae=He[Te.pos++]))<<31,Ae<128))return y(Me,Ge,Ce);throw new Error("Expected varint not more than 10 bytes")}(le|=(15&(fe=_e[this.pos]))<<28,te,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2==1?(te+1)/-2:te/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var te=this.readVarint()+this.pos,le=this.pos;return this.pos=te,te-le>=12&&m?function(fe,_e,Me){return m.decode(fe.subarray(_e,Me))}(this.buf,le,te):function(fe,_e,Me){for(var Ce="",Te=_e;Te<Me;){var Ge,Ae,He,Qe=fe[Te],Je=null,st=Qe>239?4:Qe>223?3:Qe>191?2:1;if(Te+st>Me)break;st===1?Qe<128&&(Je=Qe):st===2?(192&(Ge=fe[Te+1]))==128&&(Je=(31&Qe)<<6|63&Ge)<=127&&(Je=null):st===3?(Ae=fe[Te+2],(192&(Ge=fe[Te+1]))==128&&(192&Ae)==128&&((Je=(15&Qe)<<12|(63&Ge)<<6|63&Ae)<=2047||Je>=55296&&Je<=57343)&&(Je=null)):st===4&&(Ae=fe[Te+2],He=fe[Te+3],(192&(Ge=fe[Te+1]))==128&&(192&Ae)==128&&(192&He)==128&&((Je=(15&Qe)<<18|(63&Ge)<<12|(63&Ae)<<6|63&He)<=65535||Je>=1114112)&&(Je=null)),Je===null?(Je=65533,st=1):Je>65535&&(Je-=65536,Ce+=String.fromCharCode(Je>>>10&1023|55296),Je=56320|1023&Je),Ce+=String.fromCharCode(Je),Te+=st}return Ce}(this.buf,le,te)},readBytes:function(){var te=this.readVarint()+this.pos,le=this.buf.subarray(this.pos,te);return this.pos=te,le},readPackedVarint:function(te,le){if(this.type!==o.Bytes)return te.push(this.readVarint(le));var fe=f(this);for(te=te||[];this.pos<fe;)te.push(this.readVarint(le));return te},readPackedSVarint:function(te){if(this.type!==o.Bytes)return te.push(this.readSVarint());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==o.Bytes)return te.push(this.readBoolean());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==o.Bytes)return te.push(this.readFloat());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==o.Bytes)return te.push(this.readDouble());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==o.Bytes)return te.push(this.readFixed32());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==o.Bytes)return te.push(this.readSFixed32());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==o.Bytes)return te.push(this.readFixed64());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==o.Bytes)return te.push(this.readSFixed64());var le=f(this);for(te=te||[];this.pos<le;)te.push(this.readSFixed64());return te},skip:function(te){var le=7&te;if(le===o.Varint)for(;this.buf[this.pos++]>127;);else if(le===o.Bytes)this.pos=this.readVarint()+this.pos;else if(le===o.Fixed32)this.pos+=4;else{if(le!==o.Fixed64)throw new Error("Unimplemented type: "+le);this.pos+=8}},writeTag:function(te,le){this.writeVarint(te<<3|le)},realloc:function(te){for(var le=this.length||16;le<this.pos+te;)le*=2;if(le!==this.length){var fe=new Uint8Array(le);fe.set(this.buf),this.buf=fe,this.length=le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),re(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),re(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),re(this.buf,-1&te,this.pos),re(this.buf,Math.floor(te*d),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),re(this.buf,-1&te,this.pos),re(this.buf,Math.floor(te*d),this.pos+4),this.pos+=8},writeVarint:function(te){(te=+te||0)>268435455||te<0?function(le,fe){var _e,Me;if(le>=0?(_e=le%4294967296|0,Me=le/4294967296|0):(Me=~(-le/4294967296),4294967295^(_e=~(-le%4294967296))?_e=_e+1|0:(_e=0,Me=Me+1|0)),le>=18446744073709552e3||le<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");fe.realloc(10),function(Ce,Te,Ge){Ge.buf[Ge.pos++]=127&Ce|128,Ce>>>=7,Ge.buf[Ge.pos++]=127&Ce|128,Ce>>>=7,Ge.buf[Ge.pos++]=127&Ce|128,Ce>>>=7,Ge.buf[Ge.pos++]=127&Ce|128,Ge.buf[Ge.pos]=127&(Ce>>>=7)}(_e,0,fe),function(Ce,Te){var Ge=(7&Ce)<<4;Te.buf[Te.pos++]|=Ge|((Ce>>>=3)?128:0),Ce&&(Te.buf[Te.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Te.buf[Te.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Te.buf[Te.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Te.buf[Te.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Te.buf[Te.pos++]=127&Ce)))))}(Me,fe)}(te,this):(this.realloc(4),this.buf[this.pos++]=127&te|(te>127?128:0),te<=127||(this.buf[this.pos++]=127&(te>>>=7)|(te>127?128:0),te<=127||(this.buf[this.pos++]=127&(te>>>=7)|(te>127?128:0),te<=127||(this.buf[this.pos++]=te>>>7&127))))},writeSVarint:function(te){this.writeVarint(te<0?2*-te-1:2*te)},writeBoolean:function(te){this.writeVarint(!!te)},writeString:function(te){te=String(te),this.realloc(4*te.length),this.pos++;var le=this.pos;this.pos=function(_e,Me,Ce){for(var Te,Ge,Ae=0;Ae<Me.length;Ae++){if((Te=Me.charCodeAt(Ae))>55295&&Te<57344){if(!Ge){Te>56319||Ae+1===Me.length?(_e[Ce++]=239,_e[Ce++]=191,_e[Ce++]=189):Ge=Te;continue}if(Te<56320){_e[Ce++]=239,_e[Ce++]=191,_e[Ce++]=189,Ge=Te;continue}Te=Ge-55296<<10|Te-56320|65536,Ge=null}else Ge&&(_e[Ce++]=239,_e[Ce++]=191,_e[Ce++]=189,Ge=null);Te<128?_e[Ce++]=Te:(Te<2048?_e[Ce++]=Te>>6|192:(Te<65536?_e[Ce++]=Te>>12|224:(_e[Ce++]=Te>>18|240,_e[Ce++]=Te>>12&63|128),_e[Ce++]=Te>>6&63|128),_e[Ce++]=63&Te|128)}return Ce}(this.buf,te,this.pos);var fe=this.pos-le;fe>=128&&T(le,fe,this),this.pos=le-1,this.writeVarint(fe),this.pos+=fe},writeFloat:function(te){this.realloc(4),h.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),h.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var le=te.length;this.writeVarint(le),this.realloc(le);for(var fe=0;fe<le;fe++)this.buf[this.pos++]=te[fe]},writeRawMessage:function(te,le){this.pos++;var fe=this.pos;te(le,this);var _e=this.pos-fe;_e>=128&&T(fe,_e,this),this.pos=fe-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(te,le,fe){this.writeTag(te,o.Bytes),this.writeRawMessage(le,fe)},writePackedVarint:function(te,le){le.length&&this.writeMessage(te,M,le)},writePackedSVarint:function(te,le){le.length&&this.writeMessage(te,O,le)},writePackedBoolean:function(te,le){le.length&&this.writeMessage(te,N,le)},writePackedFloat:function(te,le){le.length&&this.writeMessage(te,w,le)},writePackedDouble:function(te,le){le.length&&this.writeMessage(te,P,le)},writePackedFixed32:function(te,le){le.length&&this.writeMessage(te,L,le)},writePackedSFixed32:function(te,le){le.length&&this.writeMessage(te,D,le)},writePackedFixed64:function(te,le){le.length&&this.writeMessage(te,B,le)},writePackedSFixed64:function(te,le){le.length&&this.writeMessage(te,q,le)},writeBytesField:function(te,le){this.writeTag(te,o.Bytes),this.writeBytes(le)},writeFixed32Field:function(te,le){this.writeTag(te,o.Fixed32),this.writeFixed32(le)},writeSFixed32Field:function(te,le){this.writeTag(te,o.Fixed32),this.writeSFixed32(le)},writeFixed64Field:function(te,le){this.writeTag(te,o.Fixed64),this.writeFixed64(le)},writeSFixed64Field:function(te,le){this.writeTag(te,o.Fixed64),this.writeSFixed64(le)},writeVarintField:function(te,le){this.writeTag(te,o.Varint),this.writeVarint(le)},writeSVarintField:function(te,le){this.writeTag(te,o.Varint),this.writeSVarint(le)},writeStringField:function(te,le){this.writeTag(te,o.Bytes),this.writeString(le)},writeFloatField:function(te,le){this.writeTag(te,o.Fixed32),this.writeFloat(le)},writeDoubleField:function(te,le){this.writeTag(te,o.Fixed64),this.writeDouble(le)},writeBooleanField:function(te,le){this.writeVarintField(te,!!le)}},NC}var cw=b(XA());const FC=3;function QU(h,o,l){o.glyphs=[],h===1&&l.readMessage(e6,o)}function e6(h,o,l){if(h===3){const{id:d,bitmap:m,width:f,height:y,left:T,top:M,advance:O}=l.readMessage(t6,{});o.glyphs.push({id:d,bitmap:new Bd({width:f+2*FC,height:y+2*FC},m),metrics:{width:f,height:y,left:T,top:M,advance:O}})}else h===4?o.ascender=l.readSVarint():h===5&&(o.descender=l.readSVarint())}function t6(h,o,l){h===1?o.id=l.readVarint():h===2?o.bitmap=l.readBytes():h===3?o.width=l.readVarint():h===4?o.height=l.readVarint():h===5?o.left=l.readSVarint():h===6?o.top=l.readSVarint():h===7&&(o.advance=l.readVarint())}const n6=FC,_u={horizontal:1,vertical:2,horizontalOnly:3};class Xx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,l){const d=new Xx;return d.scale=o||1,d.fontStack=l,d}static forImage(o){const l=new Xx;return l.image=o,l}}class Wv{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l,d){const m=new Wv;for(let f=0;f<o.sections.length;f++){const y=o.sections[f];y.image?m.addImageSection(y,d):m.addTextSection(y,l)}return m}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,d){let m="";for(let f=0;f<l.length;f++){const y=l.charCodeAt(f+1)||null,T=l.charCodeAt(f-1)||null;m+=!d&&(y&&Lg(y)&&!Wx[l[f+1]]||T&&Lg(T)&&!Wx[l[f-1]])||!Wx[l[f]]?l[f]:Wx[l[f]]}return m}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&hw[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&hw[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const d=new Wv;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(Xx.forText(o.scale,o.fontStack||l));const d=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(d)}addImageSection(o,l){const d=o.image?o.image.getPrimary():null;if(!d)return void vi("Can't add FormattedSection with an empty image.");d.scaleSelf(l);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(Xx.forImage(d)),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zC(h,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B=1){const q=Wv.fromFeature(h,m,B);P===_u.vertical&&q.verticalizePunctuation(N);let Z=[];const re=function(_e,Me,Ce,Te,Ge,Ae){if(!_e)return[];const He=[],Qe=function(dt,lt,pt,kt,Nt,hn){let qt=0;for(let Jt=0;Jt<dt.length();Jt++){const Bt=dt.getSection(Jt);qt+=ZA(dt.getCodePoint(Jt),Bt,kt,Nt,lt,hn)}return qt/Math.max(1,Math.ceil(qt/pt))}(_e,Me,Ce,Te,Ge,Ae),Je=_e.text.indexOf("")>=0;let st=0;for(let dt=0;dt<_e.length();dt++){const lt=_e.getSection(dt),pt=_e.getCodePoint(dt);if(hw[pt]||(st+=ZA(pt,lt,Te,Ge,Me,Ae)),dt<_e.length()-1){const kt=!((rt=pt)<11904||!(Cn["Bopomofo Extended"](rt)||Cn.Bopomofo(rt)||Cn["CJK Compatibility Forms"](rt)||Cn["CJK Compatibility Ideographs"](rt)||Cn["CJK Compatibility"](rt)||Cn["CJK Radicals Supplement"](rt)||Cn["CJK Strokes"](rt)||Cn["CJK Symbols and Punctuation"](rt)||Cn["CJK Unified Ideographs Extension A"](rt)||Cn["CJK Unified Ideographs"](rt)||Cn["Enclosed CJK Letters and Months"](rt)||Cn["Halfwidth and Fullwidth Forms"](rt)||Cn.Hiragana(rt)||Cn["Ideographic Description Characters"](rt)||Cn["Kangxi Radicals"](rt)||Cn["Katakana Phonetic Extensions"](rt)||Cn.Katakana(rt)||Cn["Vertical Forms"](rt)||Cn["Yi Radicals"](rt)||Cn["Yi Syllables"](rt)));(r6[pt]||kt||lt.image)&&He.push(KA(dt+1,st,Qe,He,i6(pt,_e.getCodePoint(dt+1),kt&&Je),!1))}}var rt;return JA(KA(_e.length(),st,Qe,He,0,!0))}(q,O,f,o,d,L),{processBidirectionalText:ne,processStyledBidirectionalText:te}=da;if(ne&&q.sections.length===1){const _e=ne(q.toString(),re);for(const Me of _e){const Ce=new Wv;Ce.text=Me,Ce.sections=q.sections;for(let Te=0;Te<Me.length;Te++)Ce.sectionIndex.push(0);Z.push(Ce)}}else if(te){const _e=te(q.text,q.sectionIndex,re);for(const Me of _e){const Ce=new Wv;Ce.text=Me[0],Ce.sectionIndex=Me[1],Ce.sections=q.sections,Z.push(Ce)}}else Z=function(_e,Me){const Ce=[],Te=_e.text;let Ge=0;for(const Ae of Me)Ce.push(_e.substring(Ge,Ae)),Ge=Ae;return Ge<Te.length&&Ce.push(_e.substring(Ge,Te.length)),Ce}(q,re);const le=[],fe={positionedLines:le,text:q.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(_e,Me,Ce,Te,Ge,Ae,He,Qe,Je,st,rt,dt){let lt=0,pt=0,kt=0;const Nt=Qe==="right"?1:Qe==="left"?0:.5;let hn=!1;for(const _n of Ge){const zn=_n.getSections();for(const sr of zn){if(sr.image)continue;const Un=Me[sr.fontStack];if(Un&&(hn=Un.ascender!==void 0&&Un.descender!==void 0,!hn))break}if(!hn)break}let qt=0;for(const _n of Ge){_n.trim();const zn=_n.getMaxScale(),sr=(zn-1)*Zs,Un={positionedGlyphs:[],lineOffset:0};_e.positionedLines[qt]=Un;const gr=Un.positionedGlyphs;let nr=0;if(!_n.length()){pt+=Ae,++qt;continue}let vr=0,$r=0;for(let jn=0;jn<_n.length();jn++){const Tr=_n.getSection(jn),Di=_n.getSectionIndex(jn),zi=_n.getCodePoint(jn);let Zi=Tr.scale,no=null,ui=null,hs=null,fl=Zs,No=0;Je===_u.vertical&&((Jt=zi)===12312||Jt===12313||Jt===12316||Jt===12540||Jt===12448)&&(Je=_u.horizontal);const Go=!(Je===_u.horizontal||!rt&&!Na(zi)||rt&&(hw[zi]||uy(zi)));if(Tr.image){const va=Te.get(Tr.image.toString());if(!va)continue;hs=Tr.image,_e.iconsInText=_e.iconsInText||!0,ui=va.paddedRect;const Os=va.displaySize;Zi=Zi*Zs/dt,no={width:Os[0],height:Os[1],left:0,top:-3,advance:Go?Os[1]:Os[0],localGlyph:!1},No=hn?-no.height*Zi:zn*Zs-17-Os[1]*Zi,fl=no.advance;const zc=(Go?Os[0]:Os[1])*Zi-Zs*zn;zc>0&&zc>nr&&(nr=zc)}else{const va=Ce[Tr.fontStack];if(!va)continue;va[zi]&&(ui=va[zi]);const Os=Me[Tr.fontStack];if(!Os)continue;const zc=Os.glyphs[zi];if(!zc)continue;if(no=zc.metrics,fl=zi!==8203?Zs:0,hn){const o_=Os.ascender!==void 0?Math.abs(Os.ascender):0,Fh=Os.descender!==void 0?Math.abs(Os.descender):0,Hd=(o_+Fh)*Zi;vr<Hd&&(vr=Hd,$r=(o_-Fh)/2*Zi),No=-o_*Zi}else No=(zn-Zi)*Zs-17}Go?(_e.verticalizable=!0,gr.push({glyph:zi,image:hs,x:lt,y:pt+No,vertical:Go,scale:Zi,localGlyph:no.localGlyph,fontStack:Tr.fontStack,sectionIndex:Di,metrics:no,rect:ui}),lt+=fl*Zi+st):(gr.push({glyph:zi,image:hs,x:lt,y:pt+No,vertical:Go,scale:Zi,localGlyph:no.localGlyph,fontStack:Tr.fontStack,sectionIndex:Di,metrics:no,rect:ui}),lt+=no.advance*Zi+st)}gr.length!==0&&(kt=Math.max(lt-st,kt),hn?QA(gr,Nt,nr,$r,Ae*zn/2):QA(gr,Nt,nr,0,Ae/2)),lt=0;const fi=Ae*zn+nr;Un.lineOffset=Math.max(nr,sr),pt+=fi,++qt}var Jt;const Bt=pt,{horizontalAlign:An,verticalAlign:un}=BC(He);(function(_n,zn,sr,Un,gr,nr){const vr=(zn-sr)*gr,$r=-nr*Un;for(const fi of _n)for(const jn of fi.positionedGlyphs)jn.x+=vr,jn.y+=$r})(_e.positionedLines,Nt,An,un,kt,Bt),_e.top+=-un*Bt,_e.bottom=_e.top+Bt,_e.left+=-An*kt,_e.right=_e.left+kt,_e.hasBaseline=hn}(fe,o,l,d,Z,y,T,M,P,O,N,D),!function(_e){for(const Me of _e)if(Me.positionedGlyphs.length!==0)return!1;return!0}(le))return fe}const hw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},r6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ZA(h,o,l,d,m,f){if(o.image){const y=d.get(o.image.toString());return y?y.displaySize[0]*o.scale*Zs/f+m:0}{const y=l[o.fontStack],T=y&&y.glyphs[h];return T?T.metrics.advance*o.scale+m:0}}function YA(h,o,l,d){const m=Math.pow(h-o,2);return d?h<o?m/2:2*m:m+Math.abs(l)*l}function i6(h,o,l){let d=0;return h===10&&(d-=1e4),l&&(d+=150),h!==40&&h!==65288||(d+=50),o!==41&&o!==65289||(d+=50),d}function KA(h,o,l,d,m,f){let y=null,T=YA(o,l,m,f);for(const M of d){const O=YA(o-M.x,l,m,f)+M.badness;O<=T&&(y=M,T=O)}return{index:h,x:o,priorBreak:y,badness:T}}function JA(h){return h?JA(h.priorBreak).concat(h.index):[]}function BC(h){let o=.5,l=.5;switch(h){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function QA(h,o,l,d,m){if(!(o||l||d||m))return;const f=h.length-1,y=h[f],T=(y.x+y.metrics.advance*y.scale)*o;for(let M=0;M<=f;M++)h[M].x-=T,h[M].y+=l+d+m}function o6(h,o,l,d){const{horizontalAlign:m,verticalAlign:f}=BC(d),y=l[0]-h.displaySize[0]*m,T=l[1]-h.displaySize[1]*f;return{imagePrimary:h,imageSecondary:o,top:T,bottom:T+h.displaySize[1],left:y,right:y+h.displaySize[0]}}function eR(h,o,l,d,m,f){const y=h.imagePrimary;let T;if(y.content){const q=y.content,Z=y.pixelRatio||1;T=[q[0]/Z,q[1]/Z,y.displaySize[0]-q[2]/Z,y.displaySize[1]-q[3]/Z]}const M=o.left*f,O=o.right*f;let w,P,N,L;l==="width"||l==="both"?(L=m[0]+M-d[3],P=m[0]+O+d[1]):(L=m[0]+(M+O-y.displaySize[0])/2,P=L+y.displaySize[0]);const D=o.top*f,B=o.bottom*f;return l==="height"||l==="both"?(w=m[1]+D-d[0],N=m[1]+B+d[2]):(w=m[1]+(D+B-y.displaySize[1])/2,N=w+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:w,right:P,bottom:N,left:L,collisionPadding:T}}class Fm extends Gt{constructor(o,l,d,m,f){super(o,l),this.angle=m,this.z=d,f!==void 0&&(this.segment=f)}clone(){return new Fm(this.x,this.y,this.z,this.angle,this.segment)}}function tR(h,o,l,d,m){if(o.segment===void 0)return!0;let f=o,y=o.segment+1,T=0;for(;T>-l/2;){if(y--,y<0)return!1;T-=h[y].dist(f),f=h[y]}T+=h[y].dist(h[y+1]),y++;const M=[];let O=0;for(;T<l/2;){const w=h[y],P=h[y+1];if(!P)return!1;let N=h[y-1].angleTo(w)-w.angleTo(P);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:T,angleDelta:N}),O+=N;T-M[0].distance>d;)O-=M.shift().angleDelta;if(O>m)return!1;y++,T+=w.dist(P)}return!0}function nR(h){let o=0;for(let l=0;l<h.length-1;l++)o+=h[l].dist(h[l+1]);return o}function rR(h,o,l){return h?.6*o*l:0}function iR(h,o){return Math.max(h?h.right-h.left:0,o?o.right-o.left:0)}function s6(h,o,l,d,m,f){const y=rR(l,m,f),T=iR(l,d)*f;let M=0;const O=nR(h)/2;for(let w=0;w<h.length-1;w++){const P=h[w],N=h[w+1],L=P.dist(N);if(M+L>O){const D=(O-M)/L,B=Sn(P.x,N.x,D),q=Sn(P.y,N.y,D),Z=new Fm(B,q,0,N.angleTo(P),w);return!y||tR(h,Z,T,y,o)?Z:void 0}M+=L}}function a6(h,o,l,d,m,f,y,T,M){const O=rR(d,f,y),w=iR(d,m),P=w*y,N=h[0].x===0||h[0].x===M||h[0].y===0||h[0].y===M;return o-P<o/4&&(o=P+o/4),oR(h,N?o/2*T%o:(w/2+2*f)*y*T%o,o,O,l,P,N,!1,M)}function oR(h,o,l,d,m,f,y,T,M){const O=f/2,w=nR(h);let P=0,N=o-l,L=[];for(let D=0;D<h.length-1;D++){const B=h[D],q=h[D+1],Z=B.dist(q),re=q.angleTo(B);for(;N+l<P+Z;){N+=l;const ne=(N-P)/Z,te=Sn(B.x,q.x,ne),le=Sn(B.y,q.y,ne);if(te>=0&&te<M&&le>=0&&le<M&&N-O>=0&&N+O<=w){const fe=new Fm(te,le,0,re,D);d&&!tR(h,fe,f,d,m)||L.push(fe)}}P+=Z}return T||L.length||y||(L=oR(h,P/2,l,d,m,f,y,!0,M)),L}function sR(h,o,l,d,m){const f=[];for(let y=0;y<h.length;y++){const T=h[y];let M;for(let O=0;O<T.length-1;O++){let w=T[O],P=T[O+1];w.x<o&&P.x<o||(w.x<o?w=new Gt(o,w.y+(o-w.x)/(P.x-w.x)*(P.y-w.y))._round():P.x<o&&(P=new Gt(o,w.y+(o-w.x)/(P.x-w.x)*(P.y-w.y))._round()),w.y<l&&P.y<l||(w.y<l?w=new Gt(w.x+(l-w.y)/(P.y-w.y)*(P.x-w.x),l)._round():P.y<l&&(P=new Gt(w.x+(l-w.y)/(P.y-w.y)*(P.x-w.x),l)._round()),w.x>=d&&P.x>=d||(w.x>=d?w=new Gt(d,w.y+(d-w.x)/(P.x-w.x)*(P.y-w.y))._round():P.x>=d&&(P=new Gt(d,w.y+(d-w.x)/(P.x-w.x)*(P.y-w.y))._round()),w.y>=m&&P.y>=m||(w.y>=m?w=new Gt(w.x+(m-w.y)/(P.y-w.y)*(P.x-w.x),m)._round():P.y>=m&&(P=new Gt(w.x+(m-w.y)/(P.y-w.y)*(P.x-w.x),m)._round()),M&&w.equals(M[M.length-1])||(M=[w],f.push(M)),M.push(P)))))}}return f}function aR(h){let o=0,l=0;for(const y of h)o+=y.w*y.h,l=Math.max(l,y.w);h.sort((y,T)=>T.h-y.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let m=0,f=0;for(const y of h)for(let T=d.length-1;T>=0;T--){const M=d[T];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,f=Math.max(f,y.y+y.h),m=Math.max(m,y.x+y.w),y.w===M.w&&y.h===M.h){const O=d.pop();T<d.length&&(d[T]=O)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(d.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:m,h:f,fill:o/(m*f)||0}}on(Fm,"Anchor");const Xv=1;class Zx{static getImagePositionScale(o,l,d){if(l&&o&&o.options&&o.options.transform){const m=o.options.transform;return{x:m.a,y:m.d}}return{x:d,y:d}}constructor(o,l,d,m){this.paddedRect=o;const{pixelRatio:f,version:y,stretchX:T,stretchY:M,content:O,sdf:w,usvg:P}=l;this.pixelRatio=f,this.stretchX=T,this.stretchY=M,this.content=O,this.version=y,this.padding=d,this.sdf=w,this.scale=Zx.getImagePositionScale(m,P,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function lR(h,o,l){const d=eu.parse(h),m=function(f,y,T=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*T[0])+2*y,h:(f.data?f.data.height:f.height*T[1])+2*y}}(o,l,[d.options.transform.a,d.options.transform.d]);return{bin:m,imagePosition:new Zx(m,o,l,d),imageVariant:d}}class uR{constructor(o,l,d){const m=new Map,f=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(o,m,Xv,y),this.addImages(l,f,2,y);const{w:T,h:M}=aR(y),O=new ns({width:T||1,height:M||1});for(const[w,P]of o.entries()){const N=m.get(w).paddedRect;ns.copy(P.data,O,{x:0,y:0},{x:N.x+Xv,y:N.y+Xv},P.data,d,P.sdf)}for(const[w,P]of l.entries()){const N=f.get(w),L=N.paddedRect;let D=N.padding;const B=L.x+D,q=L.y+D,Z=P.data.width,re=P.data.height;D=D>1?D-1:D,ns.copy(P.data,O,{x:0,y:0},{x:B,y:q},P.data,d),ns.copy(P.data,O,{x:0,y:re-D},{x:B,y:q-D},{width:Z,height:D},d),ns.copy(P.data,O,{x:0,y:0},{x:B,y:q+re},{width:Z,height:D},d),ns.copy(P.data,O,{x:Z-D,y:0},{x:B-D,y:q},{width:D,height:re},d),ns.copy(P.data,O,{x:0,y:0},{x:B+Z,y:q},{width:D,height:re},d),ns.copy(P.data,O,{x:Z-D,y:re-D},{x:B-D,y:q-D},{width:D,height:D},d),ns.copy(P.data,O,{x:0,y:re-D},{x:B+Z,y:q-D},{width:D,height:D},d),ns.copy(P.data,O,{x:0,y:0},{x:B+Z,y:q+re},{width:D,height:D},d),ns.copy(P.data,O,{x:Z-D,y:0},{x:B-D,y:q+re},{width:D,height:D},d)}this.lut=d,this.image=O,this.iconPositions=m,this.patternPositions=f}addImages(o,l,d,m){for(const[f,y]of o.entries()){const{bin:T,imagePosition:M,imageVariant:O}=lR(f,y,d);l.set(f,M),m.push(T),y.hasRenderCallback&&this.haveRenderCallbacks.push(O.id)}}patchUpdatedImages(o,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>o.hasImage(m,d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const m of o.getUpdatedImages(d)){for(const f of this.iconPositions.keys()){const y=eu.parse(f);if(Gs.isEqual(y.id,m)){const T=o.getImage(m,d);this.patchUpdatedImage(this.iconPositions.get(f),T,l)}}for(const f of this.patternPositions.keys()){const y=eu.parse(f);if(Gs.isEqual(y.id,m)){const T=o.getImage(m,d);this.patchUpdatedImage(this.patternPositions.get(f),T,l)}}}}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;const[m,f]=o.tl,y=o.sdf;if(this.lut||y){const T={width:l.data.width,height:l.data.height},M=new ns(T);ns.copy(l.data,M,{x:0,y:0},{x:0,y:0},T,this.lut,y),d.update(M,{position:{x:m,y:f}})}else d.update(l.data,{position:{x:m,y:f}})}}on(Zx,"ImagePosition"),on(uR,"ImageAtlas");const dw=1e20;function cR(h,o,l,d,m,f,y,T,M){for(let O=o;O<o+d;O++)hR(h,l*f+O,f,m,y,T,M);for(let O=l;O<l+m;O++)hR(h,O*f+o,1,d,y,T,M)}function hR(h,o,l,d,m,f,y){f[0]=0,y[0]=-1e20,y[1]=dw,m[0]=h[o];for(let T=1,M=0,O=0;T<d;T++){m[T]=h[o+T*l];const w=T*T;do{const P=f[M];O=(m[T]-m[P]+w-P*P)/(T-P)/2}while(O<=y[M]&&--M>-1);M++,f[M]=T,y[M]=O,y[M+1]=dw}for(let T=0,M=0;T<d;T++){for(;y[M+1]<T;)M++;const O=f[M],w=T-O;h[o+T*l]=m[O]+w*w}}const Ud=2,jC={none:0,ideographs:1,all:2};class Zv{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,d){const m=[],f=this.urls[l]||ge.GLYPHS_URL;for(const y in o)for(const T of o[y])m.push({stack:y,id:T});Kl(m,({stack:y,id:T},M)=>{let O=this.entries[y];O||(O=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=O.glyphs[T];if(w!==void 0)return void M(null,{stack:y,id:T,glyph:w});if(w=this._tinySDF(O,y,T),w)return O.glyphs[T]=w,void M(null,{stack:y,id:T,glyph:w});const P=Math.floor(T/256);if(256*P>65535)return vi("glyphs > 65535 not supported"),void M(null,{stack:y,id:T,glyph:w});if(O.ranges[P])return void M(null,{stack:y,id:T,glyph:w});let N=O.requests[P];N||(N=O.requests[P]=[],Zv.loadGlyphRange(y,P,f,this.requestManager,(L,D)=>{if(D){O.ascender=D.ascender,O.descender=D.descender;for(const B in D.glyphs)this._doesCharSupportLocalGlyph(+B)||(O.glyphs[+B]=D.glyphs[+B]);O.ranges[P]=!0}for(const B of N)B(L,D);delete O.requests[P]})),N.push((L,D)=>{L?M(L):D&&M(null,{stack:y,id:T,glyph:D.glyphs[T]||null})})},(y,T)=>{if(y)d(y);else if(T){const M={};for(const{stack:O,id:w,glyph:P}of T)M[O]===void 0&&(M[O]={}),M[O].glyphs===void 0&&(M[O].glyphs={}),M[O].glyphs[w]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},M[O].ascender=this.entries[O].ascender,M[O].descender=this.entries[O].descender;d(null,M)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==jC.none&&(this.localGlyphMode===jC.all?!!this.localFontFamily:!!this.localFontFamily&&(Cn["CJK Unified Ideographs"](o)||Cn["Hangul Syllables"](o)||Cn.Hiragana(o)||Cn.Katakana(o)||Cn["CJK Symbols and Punctuation"](o)||Cn["CJK Unified Ideographs Extension A"](o)||Cn["CJK Unified Ideographs Extension B"](o)||Cn.Osage(o)))}_tinySDF(o,l,d){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let f=o.tinySDF;if(!f){let B="400";/bold/i.test(l)?B="900":/medium/i.test(l)?B="500":/light/i.test(l)&&(B="200"),f=o.tinySDF=new Zv.TinySDF({fontFamily:m,fontWeight:B,fontSize:24*Ud,buffer:3*Ud,radius:8*Ud}),f.fontWeight=B}if(this.localGlyphs[f.fontWeight][d])return this.localGlyphs[f.fontWeight][d];const y=String.fromCodePoint(d),{data:T,width:M,height:O,glyphWidth:w,glyphHeight:P,glyphLeft:N,glyphTop:L,glyphAdvance:D}=f.draw(y);return this.localGlyphs[f.fontWeight][d]={id:d,bitmap:new Bd({width:M,height:O},T),metrics:{width:w/Ud,height:P/Ud,left:N/Ud,top:L/Ud-27,advance:D/Ud,localGlyph:!0}}}}Zv.loadGlyphRange=function(h,o,l,d,m){const f=256*o,y=f+255,T=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",h).replace("{range}",`${f}-${y}`),mo.Glyphs);Fu(T,(M,O)=>{if(M)m(M);else if(O){const w={},P=function(N){return new cw(N).readFields(QU,{})}(O);for(const N of P.glyphs)w[N.id]=N;m(null,{glyphs:w,ascender:P.ascender,descender:P.descender})}})},Zv.TinySDF=class{constructor({fontSize:h=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;const T=this.size=h+4*o,M=this._createCanvas(T),O=this.ctx=M.getContext("2d",{willReadFrequently:!0});O.font=`${y} ${f} ${h}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(h){const o=document.createElement("canvas");return o.width=o.height=h,o}draw(h){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:f}=this.ctx.measureText(h),y=Math.ceil(l),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-m))),M=Math.min(this.size-this.buffer,y+Math.ceil(d)),O=T+2*this.buffer,w=M+2*this.buffer,P=Math.max(O*w,0),N=new Uint8ClampedArray(P),L={data:N,width:O,height:w,glyphWidth:T,glyphHeight:M,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(T===0||M===0)return L;const{ctx:D,buffer:B,gridInner:q,gridOuter:Z}=this;D.clearRect(B,B,T,M),D.fillText(h,B,B+y);const re=D.getImageData(B,B,T,M);Z.fill(dw,0,P),q.fill(0,0,P);for(let ne=0;ne<M;ne++)for(let te=0;te<T;te++){const le=re.data[4*(ne*T+te)+3]/255;if(le===0)continue;const fe=(ne+B)*O+te+B;if(le===1)Z[fe]=0,q[fe]=dw;else{const _e=.5-le;Z[fe]=_e>0?_e*_e:0,q[fe]=_e<0?_e*_e:0}}cR(Z,0,0,O,w,O,this.f,this.v,this.z),cR(q,B,B,T,M,O,this.f,this.v,this.z);for(let ne=0;ne<P;ne++){const te=Math.sqrt(Z[ne])-Math.sqrt(q[ne]);N[ne]=Math.round(255-255*(te/this.radius+this.cutoff))}return L}};const Ay=Xv;function dR(h,o){return h+o[1]-o[0]}function fR(h,o,l,d,m=1){const f=[],y=h.imagePrimary,T=y.pixelRatio,M=y.paddedRect.w-2*Ay,O=y.paddedRect.h-2*Ay,w=(h.right-h.left)*m,P=(h.bottom-h.top)*m,N=y.stretchX||[[0,M]],L=y.stretchY||[[0,O]],D=N.reduce(dR,0),B=L.reduce(dR,0),q=M-D,Z=O-B;let re=0,ne=D,te=0,le=B,fe=0,_e=q,Me=0,Ce=Z;if(y.content&&d){const Ge=y.content;re=fw(N,0,Ge[0]),te=fw(L,0,Ge[1]),ne=fw(N,Ge[0],Ge[2]),le=fw(L,Ge[1],Ge[3]),fe=Ge[0]-re,Me=Ge[1]-te,_e=Ge[2]-Ge[0]-ne,Ce=Ge[3]-Ge[1]-le}const Te=(Ge,Ae,He,Qe)=>{const Je=pw(Ge.stretch-re,ne,w,h.left*m),st=mw(Ge.fixed-fe,_e,Ge.stretch,D),rt=pw(Ae.stretch-te,le,P,h.top*m),dt=mw(Ae.fixed-Me,Ce,Ae.stretch,B),lt=pw(He.stretch-re,ne,w,h.left*m),pt=mw(He.fixed-fe,_e,He.stretch,D),kt=pw(Qe.stretch-te,le,P,h.top*m),Nt=mw(Qe.fixed-Me,Ce,Qe.stretch,B),hn=new Gt(Je,rt),qt=new Gt(lt,rt),Jt=new Gt(lt,kt),Bt=new Gt(Je,kt),An=new Gt(st/T,dt/T),un=new Gt(pt/T,Nt/T),_n=o*Math.PI/180;if(_n){const vr=Math.sin(_n),$r=Math.cos(_n),fi=[$r,-vr,vr,$r];hn._matMult(fi),qt._matMult(fi),Bt._matMult(fi),Jt._matMult(fi)}const zn=Ge.stretch+Ge.fixed,sr=He.stretch+He.fixed,Un=Ae.stretch+Ae.fixed,gr=Qe.stretch+Qe.fixed,nr=h.imageSecondary;return{tl:hn,tr:qt,bl:Bt,br:Jt,texPrimary:{x:y.paddedRect.x+Ay+zn,y:y.paddedRect.y+Ay+Un,w:sr-zn,h:gr-Un},texSecondary:nr?{x:nr.paddedRect.x+Ay+zn,y:nr.paddedRect.y+Ay+Un,w:sr-zn,h:gr-Un}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:An,pixelOffsetBR:un,minFontScaleX:_e/T/w,minFontScaleY:Ce/T/P,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){const Ge=pR(N,q,D),Ae=pR(L,Z,B);for(let He=0;He<Ge.length-1;He++){const Qe=Ge[He],Je=Ge[He+1];for(let st=0;st<Ae.length-1;st++)f.push(Te(Qe,Ae[st],Je,Ae[st+1]))}}else f.push(Te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:O+1}));return f}function fw(h,o,l){let d=0;for(const m of h)d+=Math.max(o,Math.min(l,m[1]))-Math.max(o,Math.min(l,m[0]));return d}function pR(h,o,l){const d=[{fixed:-1,stretch:0}];for(const[m,f]of h){const y=d[d.length-1];d.push({fixed:m-y.stretch,stretch:y.stretch}),d.push({fixed:m-y.stretch,stretch:y.stretch+(f-m)})}return d.push({fixed:o+Ay,stretch:l}),d}function pw(h,o,l,d){return h/o*l+d}function mw(h,o,l,d){return h-o*l/d}function l6(h,o,l,d){const m=o+h.positionedLines[d].lineOffset;return d===0?l+m/2:l+(m+(o+h.positionedLines[d-1].lineOffset))/2}function u6(h,o=1,l=!1){let d=1/0,m=1/0,f=-1/0,y=-1/0;const T=h[0];for(let L=0;L<T.length;L++){const D=T[L];(!L||D.x<d)&&(d=D.x),(!L||D.y<m)&&(m=D.y),(!L||D.x>f)&&(f=D.x),(!L||D.y>y)&&(y=D.y)}const M=Math.min(f-d,y-m);let O=M/2;const w=new Kp([],c6);if(M===0)return new Gt(d,m);for(let L=d;L<f;L+=M)for(let D=m;D<y;D+=M)w.push(new Yv(L+O,D+O,O,h));let P=function(L){let D=0,B=0,q=0;const Z=L[0];for(let re=0,ne=Z.length,te=ne-1;re<ne;te=re++){const le=Z[re],fe=Z[te],_e=le.x*fe.y-fe.x*le.y;B+=(le.x+fe.x)*_e,q+=(le.y+fe.y)*_e,D+=3*_e}return new Yv(B/D,q/D,0,L)}(h),N=w.length;for(;w.length;){const L=w.pop();(L.d>P.d||!P.d)&&(P=L,l&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,N)),L.max-P.d<=o||(O=L.h/2,w.push(new Yv(L.p.x-O,L.p.y-O,O,h)),w.push(new Yv(L.p.x+O,L.p.y-O,O,h)),w.push(new Yv(L.p.x-O,L.p.y+O,O,h)),w.push(new Yv(L.p.x+O,L.p.y+O,O,h)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${P.d}`)),P.p}function c6(h,o){return o.max-h.max}class Yv{constructor(o,l,d,m){this.p=new Gt(o,l),this.h=d,this.d=function(f,y){let T=!1,M=1/0;for(let O=0;O<y.length;O++){const w=y[O];for(let P=0,N=w.length,L=N-1;P<N;L=P++){const D=w[P],B=w[L];D.y>f.y!=B.y>f.y&&f.x<(B.x-D.x)*(f.y-D.y)/(B.y-D.y)+D.x&&(T=!T),M=Math.min(M,Be(f,D,B))}}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const VC=Number.POSITIVE_INFINITY,h6=Math.sqrt(2);function mR(h,[o,l]){let d=0,m=0;if(l===VC){o<0&&(o=0);const f=o/h6;switch(h){case"top-right":case"top-left":m=f-7;break;case"bottom-right":case"bottom-left":m=7-f;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(h){case"top-right":case"bottom-right":d=-f;break;case"top-left":case"bottom-left":d=f;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),h){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(h){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,m]}function gR(h,o,l,d,m,f,y,T){if(!h)return;const M=qA(o,l,d,m,f);return h.scaleSelf(M*T*y)}function _R(h,o,l,d,m,f,y,T){return{iconPrimary:gR(h.getPrimary(),o,l,d,m,f,y,T),iconSecondary:gR(h.getSecondary(),o,l,d,m,f,y,T)}}function yR(h,o,l,d){if(!h)return;const m=o.get(l.toString());if(h.imagePrimary=m,d){const f=o.get(d.toString());h.imageSecondary=f}}function d6(h,o){for(const l in h.horizontal)vR(h.horizontal[l],o);vR(h.vertical,o)}function vR(h,o){if(h){for(const l of h.positionedLines)for(const d of l.positionedGlyphs)if(d.image!==null){const m=d.image.toString();d.rect=o.get(m).paddedRect}}}function UC(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function f6(h,o,l,d,m,f,y,T,M){const O=GC(f.horizontal)||f.vertical,w=l.get("icon-text-fit-padding").evaluate(d,{},m);let P,N=o;return o&&M!=="none"&&(h.allowVerticalPlacement&&f.vertical&&(P=eR(o,f.vertical,M,w,T,y)),O&&(N=eR(o,O,M,w,T,y))),{defaultShapedIcon:N,verticallyShapedIcon:P}}function p6(h,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z,re,ne){let te=y.textMaxSize.evaluate(o,{},N);te===void 0?te=T*y.textScaleFactor:te*=y.textScaleFactor;const le=h.layers[0].layout,fe=GC(l.horizontal)||l.vertical,_e=L.name==="globe",Me=Zs,Ce=h.tilePixelRatio*te/Me,Te=(st=h.overscaling,h.zoom>18&&st>2&&(st>>=1),Math.max(Qt/(512*st),1)*le.get("symbol-spacing")),Ge=le.get("text-padding")*h.tilePixelRatio,Ae=le.get("icon-padding")*h.tilePixelRatio,He=cr(le.get("text-max-angle")),Qe=le.get("icon-rotation-alignment")==="map"&&ne!=="point",Je=Te/2;var st;h.hasAnyIconTextFit===!1&&q!=="none"&&(h.hasAnyIconTextFit=!0);const rt=o.properties?+o.properties[Iy]:null,dt=rt&&h.elevationFeatureIdToIndex?h.elevationFeatureIdToIndex.get(rt):65535,lt=(pt,kt,Nt)=>{if(kt.x<0||kt.x>=Qt||kt.y<0||kt.y>=Qt)return;let hn=null;if(_e){const{x:qt,y:Jt,z:Bt}=L.projectTilePoint(kt.x,kt.y,Nt);hn={anchor:new Fm(qt,Jt,Bt,0,void 0),up:L.upVector(Nt,kt.x,kt.y)}}(function(qt,Jt,Bt,An,un,_n,zn,sr,Un,gr,nr,vr,$r,fi,jn,Tr,Di,zi,Zi,no,ui,hs,fl,No,Go,va,Os,zc,o_){const Fh=qt.addToLineVertexArray(Jt,An);let Hd,s_,a_,Ny,tO,nO,rO,iO=0,oO=0,sO=0,aO=0,wT=-1,ST=-1;const dp={};let lO=el("");const ky=Bt?Bt.anchor:Jt,ET=zc!=="none";let CT=0,TT=0;if(Un._unevaluatedLayout.getValue("text-radial-offset")===void 0?[CT,TT]=Un.layout.get("text-offset").evaluate(ui,{},Go).map(Bc=>Bc*Zs):(CT=Un.layout.get("text-radial-offset").evaluate(ui,{},Go)*Zs,TT=VC),qt.allowVerticalPlacement&&un.vertical){const Bc=un.vertical;if(jn)nO=$C(Bc),sr&&(rO=$C(sr));else{const yu=Un.layout.get("text-rotate").evaluate(ui,{},Go)+90;a_=gw(gr,ky,Jt,nr,vr,$r,Bc,fi,yu,Tr),sr&&(Ny=gw(gr,ky,Jt,nr,vr,$r,sr,zi,yu))}}if(_n){const Bc=qt.iconSizeData,yu=Un.layout.get("icon-rotate").evaluate(ui,{},Go),p1=fR(_n,yu,fl,ET,hs.iconScaleFactor),MT=sr?fR(sr,yu,fl,ET,hs.iconScaleFactor):void 0;s_=gw(gr,ky,Jt,nr,vr,$r,_n,zi,yu,null),iO=4*p1.length;let Fy=null;Bc.kind==="source"?(Fy=[Vd*Un.layout.get("icon-size").evaluate(ui,{},Go)*hs.iconScaleFactor],Fy[0]>t_&&vi(`${qt.layerIds[0]}: Value for "icon-size" is >= ${Yx}. Reduce your "icon-size".`)):Bc.kind==="composite"&&(Fy=[Vd*hs.compositeIconSizes[0].evaluate(ui,{},Go)*hs.iconScaleFactor,Vd*hs.compositeIconSizes[1].evaluate(ui,{},Go)*hs.iconScaleFactor],(Fy[0]>t_||Fy[1]>t_)&&vi(`${qt.layerIds[0]}: Value for "icon-size" is >= ${Yx}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,p1,Fy,no,Zi,ui,!1,Bt,Jt,Fh.lineStartIndex,Fh.lineLength,-1,No,Go,va,Os),wT=qt.icon.placedSymbolArray.length-1,MT&&(oO=4*MT.length,qt.addSymbols(qt.icon,MT,Fy,no,Zi,ui,_u.vertical,Bt,Jt,Fh.lineStartIndex,Fh.lineLength,-1,No,Go,va,Os),ST=qt.icon.placedSymbolArray.length-1)}for(const Bc in un.horizontal){const yu=un.horizontal[Bc];Hd||(lO=el(yu.text),jn?tO=$C(yu):Hd=gw(gr,ky,Jt,nr,vr,$r,yu,fi,Un.layout.get("text-rotate").evaluate(ui,{},Go),Tr));const p1=yu.positionedLines.length===1;if(sO+=xR(qt,Bt,Jt,yu,zn,Un,jn,ui,Tr,Fh,un.vertical?_u.horizontal:_u.horizontalOnly,p1?Object.keys(un.horizontal):[Bc],dp,wT,hs,No,Go,va),p1)break}un.vertical&&(aO+=xR(qt,Bt,Jt,un.vertical,zn,Un,jn,ui,Tr,Fh,_u.vertical,["vertical"],dp,ST,hs,No,Go,va));let l_=-1;const IT=(Bc,yu)=>Bc?Math.max(Bc,yu):yu;l_=IT(tO,l_),l_=IT(nO,l_),l_=IT(rO,l_);const HG=l_>-1?1:0;qt.glyphOffsetArray.length>=65535&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,ui.sortKey),qt.symbolInstances.emplaceBack(Jt.x,Jt.y,ky.x,ky.y,ky.z,dp.right>=0?dp.right:-1,dp.center>=0?dp.center:-1,dp.left>=0?dp.left:-1,dp.vertical>=0?dp.vertical:-1,wT,ST,lO,Hd!==void 0?Hd:qt.collisionBoxArray.length,Hd!==void 0?Hd+1:qt.collisionBoxArray.length,a_!==void 0?a_:qt.collisionBoxArray.length,a_!==void 0?a_+1:qt.collisionBoxArray.length,s_!==void 0?s_:qt.collisionBoxArray.length,s_!==void 0?s_+1:qt.collisionBoxArray.length,Ny||qt.collisionBoxArray.length,Ny?Ny+1:qt.collisionBoxArray.length,nr,sO,aO,iO,oO,HG,0,CT,TT,l_,0,ET?1:0,o_)})(h,kt,hn,pt,l,d,f,m,h.layers[0],h.collisionBoxArray,o.index,o.sourceLayerIndex,h.index,Ge,re,O,0,Ae,Qe,Z,o,y,w,P,N,D,B,q,dt)};if(ne==="line")for(const pt of sR(o.geometry,0,0,Qt,Qt)){const kt=a6(pt,Te,He,l.vertical||fe,d,Me,Ce,h.overscaling,Qt);for(const Nt of kt)fe&&m6(h,fe.text,Je,Nt)||lt(pt,Nt,N)}else if(ne==="line-center"){for(const pt of o.geometry)if(pt.length>1){const kt=s6(pt,He,l.vertical||fe,d,Me,Ce);kt&&lt(pt,kt,N)}}else if(o.type==="Polygon")for(const pt of Tt(o.geometry,0)){const kt=u6(pt,16);lt(pt[0],new Fm(kt.x,kt.y,0,0,void 0),N)}else if(o.type==="LineString")for(const pt of o.geometry)lt(pt,new Fm(pt[0].x,pt[0].y,0,0,void 0),N);else if(o.type==="Point")for(const pt of o.geometry)for(const kt of pt)lt([kt],new Fm(kt.x,kt.y,0,0,void 0),N)}const Yx=255,t_=Yx*Vd;function xR(h,o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q,Z){const re=function(le,fe,_e,Me,Ce,Te,Ge,Ae){const He=[];if(fe.positionedLines.length===0)return He;const Qe=Me.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Je=function(pt){const kt=pt[0],Nt=pt[1],hn=kt*Nt;return hn>0?[kt,-Nt]:hn<0?[-kt,Nt]:kt===0?[Nt,kt]:[Nt,-kt]}(_e);let st=Math.abs(fe.top-fe.bottom);for(const pt of fe.positionedLines)st-=pt.lineOffset;const rt=fe.positionedLines.length,dt=st/rt;let lt=fe.top-_e[1];for(let pt=0;pt<rt;++pt){const kt=fe.positionedLines[pt];lt=l6(fe,dt,lt,pt);for(const Nt of kt.positionedGlyphs){if(!Nt.rect)continue;const hn=Nt.rect||{};let qt=n6+1,Jt=!0,Bt=1,An=0;if(Nt.image){const ui=Ge.get(Nt.image.toString());if(!ui)continue;if(ui.sdf){vi("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,Bt=ui.pixelRatio,qt=Xv/Bt}const un=(Ce||Ae)&&Nt.vertical,_n=Nt.metrics.advance*Nt.scale/2,zn=Nt.metrics,sr=Nt.rect;if(sr===null)continue;Ae&&fe.verticalizable&&(An=Nt.image?_n-Nt.metrics.width*Nt.scale/2:0);const Un=Ce?[Nt.x+_n,Nt.y]:[0,0];let gr=[0,0],nr=[0,0],vr=!1;Ce||(un?(nr=[Nt.x+_n+Je[0],Nt.y+Je[1]-An],vr=!0):gr=[Nt.x+_n+_e[0],Nt.y+_e[1]-An]);const $r=sr.w*Nt.scale/(Bt*(Nt.localGlyph?Ud:1)),fi=sr.h*Nt.scale/(Bt*(Nt.localGlyph?Ud:1));let jn,Tr,Di,zi;if(un){const ui=Nt.y-lt,hs=new Gt(-_n,_n-ui),fl=-Math.PI/2,No=new Gt(...nr);jn=new Gt(-_n+gr[0],gr[1]),jn._rotateAround(fl,hs)._add(No),jn.x+=-ui+_n,jn.y-=(zn.left-qt)*Nt.scale;const Go=Nt.image?zn.advance*Nt.scale:Zs*Nt.scale,va=String.fromCodePoint(Nt.glyph);YU(va)?jn.x+=(1-qt)*Nt.scale:KU(va)?jn.x+=Go-zn.height*Nt.scale+(-qt-1)*Nt.scale:jn.x+=Nt.image||zn.width+2*qt===sr.w&&zn.height+2*qt===sr.h?(Go-fi)/2:(Go-(zn.height+2*qt)*Nt.scale)/2,Tr=new Gt(jn.x,jn.y-$r),Di=new Gt(jn.x+fi,jn.y),zi=new Gt(jn.x+fi,jn.y-$r)}else{const ui=(zn.left-qt)*Nt.scale-_n+gr[0],hs=(-zn.top-qt)*Nt.scale+gr[1],fl=ui+$r,No=hs+fi;jn=new Gt(ui,hs),Tr=new Gt(fl,hs),Di=new Gt(ui,No),zi=new Gt(fl,No)}if(Qe){let ui;ui=Ce?new Gt(0,0):vr?new Gt(Je[0],Je[1]):new Gt(_e[0],_e[1]),jn._rotateAround(Qe,ui),Tr._rotateAround(Qe,ui),Di._rotateAround(Qe,ui),zi._rotateAround(Qe,ui)}const Zi=new Gt(0,0),no=new Gt(0,0);He.push({tl:jn,tr:Tr,bl:Di,br:zi,texPrimary:hn,texSecondary:void 0,writingMode:fe.writingMode,glyphOffset:Un,sectionIndex:Nt.sectionIndex,isSDF:Jt,pixelOffsetTL:Zi,pixelOffsetBR:no,minFontScaleX:0,minFontScaleY:0})}}return He}(0,d,M,f,y,T,m,h.allowVerticalPlacement),ne=h.textSizeData;let te=null;ne.kind==="source"?(te=[Vd*f.layout.get("text-size").evaluate(T,{},q)*D.textScaleFactor],te[0]>t_&&vi(`${h.layerIds[0]}: Value for "text-size" is >= ${Yx}. Reduce your "text-size".`)):ne.kind==="composite"&&(te=[Vd*D.compositeTextSizes[0].evaluate(T,{},q)*D.textScaleFactor,Vd*D.compositeTextSizes[1].evaluate(T,{},q)*D.textScaleFactor],(te[0]>t_||te[1]>t_)&&vi(`${h.layerIds[0]}: Value for "text-size" is >= ${Yx}. Reduce your "text-size".`)),h.addSymbols(h.text,re,te,M,y,T,w,o,l,O.lineStartIndex,O.lineLength,L,B,q,Z,!1);for(const le of P)N[le]=h.text.placedSymbolArray.length-1;return 4*re.length}function GC(h){for(const o in h)return h[o];return null}function gw(h,o,l,d,m,f,y,T,M,O){let w=y.top,P=y.bottom,N=y.left,L=y.right;const D=y.collisionPadding;if(D&&(N-=D[0],w-=D[1],L+=D[2],P+=D[3]),M){const B=new Gt(N,w),q=new Gt(L,w),Z=new Gt(N,P),re=new Gt(L,P),ne=cr(M);let te=new Gt(0,0);O&&(te=new Gt(O[0],O[1])),B._rotateAround(ne,te),q._rotateAround(ne,te),Z._rotateAround(ne,te),re._rotateAround(ne,te),N=Math.min(B.x,q.x,Z.x,re.x),L=Math.max(B.x,q.x,Z.x,re.x),w=Math.min(B.y,q.y,Z.y,re.y),P=Math.max(B.y,q.y,Z.y,re.y)}return h.emplaceBack(o.x,o.y,o.z,l.x,l.y,N,w,L,P,T,d,m,f),h.length-1}function $C(h){h.collisionPadding&&(h.top-=h.collisionPadding[1],h.bottom+=h.collisionPadding[3]);const o=h.bottom-h.top;return o>0?Math.max(10,o):null}function m6(h,o,l,d){const m=h.compareText;if(o in m){const f=m[o];for(let y=f.length-1;y>=0;y--)if(d.dist(f[y])<l)return!0}else m[o]=[];return m[o].push(d),!1}function bR(h,o){const l=h.fovAboveCenter,d=h.elevation?h.elevation.getMinElevationBelowMSL()*o:0,m=(h._camera.position[2]*h.worldSize-d)/Math.cos(h._pitch),f=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-h._pitch-l,.01));let y=Math.sin(h._pitch)*f+m;const T=m*(1/h._horizonShift);if(!h.elevation||h.elevation.exaggeration()===0){let M=Math.max(h.zoom-17,0);h.isOrthographic&&(M/=10),y*=1+M}return Math.min(1.01*y,T)}function Kx(h,o){if(!o.isReprojectedInTileSpace)return{scale:1<<h.z,x:h.x,y:h.y,x2:h.x+1,y2:h.y+1,projection:o};const l=Math.pow(2,-h.z),d=h.x*l,m=(h.x+1)*l,f=h.y*l,y=(h.y+1)*l,T=Va(d),M=Va(m),O=go(f),w=go(y),P=o.project(T,O),N=o.project(M,O),L=o.project(M,w),D=o.project(T,w);let B=Math.min(P.x,N.x,L.x,D.x),q=Math.min(P.y,N.y,L.y,D.y),Z=Math.max(P.x,N.x,L.x,D.x),re=Math.max(P.y,N.y,L.y,D.y);const ne=l/16;function te(fe,_e,Me,Ce,Te,Ge){const Ae=(Me+Te)/2,He=(Ce+Ge)/2,Qe=o.project(Va(Ae),go(He)),Je=Math.max(0,B-Qe.x,q-Qe.y,Qe.x-Z,Qe.y-re);B=Math.min(B,Qe.x),Z=Math.max(Z,Qe.x),q=Math.min(q,Qe.y),re=Math.max(re,Qe.y),Je>ne&&(te(fe,Qe,Me,Ce,Ae,He),te(Qe,_e,Ae,He,Te,Ge))}te(P,N,d,f,m,f),te(N,L,m,f,m,y),te(L,D,m,y,d,y),te(D,P,d,y,d,f),B-=ne,q-=ne,Z+=ne,re+=ne;const le=1/Math.max(Z-B,re-q);return{scale:le,x:B*le,y:q*le,x2:Z*le,y2:re*le,projection:o}}function wR(h,{x:o,y:l},d=0){return new Gt(((o-d)*h.scale-h.x)*Qt,(l*h.scale-h.y)*Qt)}const g6=we.mat4.identity(new Float32Array(16));class n_{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new zr(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d,m=!0){return o._coordinatePoint(o.locationCoordinate(l,d),m)}pixelsPerMeter(o,l){return us(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return bR(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,m){const f=o.horizonLineFromTop(!1),y=new Gt(l,Math.max(f,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,m))}pointCoordinate3D(o,l,d){const m=new Gt(l,d);if(o.elevation)return o.elevation.pointCoordinate(m);{const f=this.pointCoordinate(o,m.x,m.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);const d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return g6}createTileMatrix(o,l,d){let m,f,y;const T=d.canonical,M=we.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const O=Kx(T,this);m=1,f=O.x+d.wrap*O.scale,y=O.y,we.mat4.scale(M,M,[m/O.scale,m/O.scale,o.pixelsPerMeter/l])}else m=l/o.zoomScale(T.z),f=(T.x+Math.pow(2,T.z)*d.wrap)*m,y=T.y*m;return we.mat4.translate(M,M,[f,y,0]),we.mat4.scale(M,M,[m/Qt,m/Qt,1]),M}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class _6 extends n_{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,d]=this.parallels=o.parallels||[29.5,45.5],m=Math.sin(cr(l));this.n=(m+Math.sin(cr(d)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:d,c:m,r0:f}=this,y=cr(o-this.center[0]),T=cr(l),M=Math.sqrt(m-2*d*Math.sin(T))/d;return{x:M*Math.sin(y*d),y:M*Math.cos(y*d)-f,z:0}}unproject(o,l){const{n:d,c:m,r0:f}=this,y=f+l;let T=Math.atan2(o,Math.abs(y))*Math.sign(y);y*d<0&&(T-=Math.PI*Math.sign(o)*Math.sign(y));const M=cr(this.center[0])*d;T=Pa(T,-Math.PI-M,Math.PI-M);const O=er(Yr(T/d)+this.center[0],-180,180),w=Math.asin(er((m-(o*o+y*y)*d*d)/(2*d),-1,1)),P=er(Yr(w),-85.051129,Rs);return new zr(O,P)}}const Jx=1.340264,Qx=-.081106,e1=893e-6,t1=.003796,_w=Math.sqrt(3)/2;class y6 extends n_{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(_w*Math.sin(l)),m=d*d,f=m*m*m;return{x:.5*(o*Math.cos(d)/(_w*(Jx+3*Qx*m+f*(7*e1+9*t1*m)))/Math.PI+.5),y:1-.5*(d*(Jx+Qx*m+f*(e1+t1*m))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=d*d,f=m*m*m;for(let w,P,N,L=0;L<12&&(P=d*(Jx+Qx*m+f*(e1+t1*m))-l,N=Jx+3*Qx*m+f*(7*e1+9*t1*m),w=P/N,d=er(d-w,-Math.PI/3,Math.PI/3),m=d*d,f=m*m*m,!(Math.abs(w)<1e-12));++L);const y=_w*o*(Jx+3*Qx*m+f*(7*e1+9*t1*m))/Math.cos(d),T=Math.asin(Math.sin(d)/_w),M=er(180*y/Math.PI,-180,180),O=er(180*T/Math.PI,-85.051129,Rs);return new zr(M,O)}}class v6 extends n_{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const d=360*(o-.5),m=er(360*(.5-l),-85.051129,Rs);return new zr(d,m)}}const Kv=Math.PI/2;function yw(h){return Math.tan((Kv+h)/2)}class x6 extends n_{constructor(o){super(o),this.center=o.center||[0,30];const[l,d]=this.parallels=o.parallels||[30,30];let m=cr(l),f=cr(d);this.southernCenter=m+f<0,this.southernCenter&&(m=-m,f=-f);const y=Math.cos(m),T=yw(m);this.n=m===f?Math.sin(m):Math.log(y/Math.cos(f))/Math.log(yw(f)/T),this.f=y*Math.pow(yw(m),this.n)/this.n}project(o,l){l=cr(l),this.southernCenter&&(l=-l),o=cr(o-this.center[0]);const d=1e-6,{n:m,f}=this;f>0?l<-Kv+d&&(l=-Kv+d):l>Kv-d&&(l=Kv-d);const y=f/Math.pow(yw(l),m);let T=y*Math.sin(m*o),M=f-y*Math.cos(m*o);return T=.5*(T/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:T,y:this.southernCenter?M:1-M,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f:m}=this,f=m-l,y=Math.sign(f),T=Math.sign(d)*Math.sqrt(o*o+f*f);let M=Math.atan2(o,Math.abs(f))*y;f*d<0&&(M-=Math.PI*Math.sign(o)*y);const O=er(Yr(M/d)+this.center[0],-180,180),w=er(Yr(2*Math.atan(Math.pow(m/T,1/d))-Kv),-85.051129,Rs);return new zr(O,this.southernCenter?-w:w)}}class SR extends n_{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:ga(o),y:es(l),z:0}}unproject(o,l){const d=Va(o),m=go(l);return new zr(d,m)}}const ER=cr(Rs);class b6 extends n_{project(o,l){const d=(l=cr(l))*l,m=d*d;return{x:.5*((o=cr(o))*(.8707-.131979*d+m*(m*(.003971*d-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+m*(.028874*d-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=25,f=0,y=d*d;do{y=d*d;const O=y*y;f=(d*(1.007226+y*(.015085+O*(.028874*y-.044475-.005916*O)))-l)/(1.007226+y*(.045255+O*(.259866*y-.311325-.005916*11*O))),d=er(d-f,-ER,ER)}while(Math.abs(f)>1e-6&&--m>0);y=d*d;const T=er(Yr(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),M=Yr(d);return new zr(T,M)}}const CR=cr(Rs);class w6 extends n_{project(o,l){l=cr(l),o=cr(o);const d=Math.cos(l),m=2/Math.PI,f=Math.acos(d*Math.cos(o/2)),y=Math.sin(f)/f,T=.5*(o*m+2*d*Math.sin(o/2)/y)||0,M=.5*(l+Math.sin(l)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,f=25;const y=1e-6;let T=0,M=0;do{const O=Math.cos(m),w=Math.sin(m),P=2*w*O,N=w*w,L=O*O,D=Math.cos(d/2),B=Math.sin(d/2),q=2*D*B,Z=B*B,re=1-L*D*D,ne=re?1/re:0,te=re?Math.acos(O*D)*Math.sqrt(1/re):0,le=.5*(2*te*O*B+2*d/Math.PI)-o,fe=.5*(te*w+m)-l,_e=.5*ne*(L*Z+te*O*D*N)+1/Math.PI,Me=ne*(q*P/4-te*w*B),Ce=.125*ne*(P*B-te*w*L*q),Te=.5*ne*(N*D+te*Z*O)+.5,Ge=Me*Ce-Te*_e;T=(fe*Me-le*Te)/Ge,M=(le*Ce-fe*_e)/Ge,d=er(d-T,-Math.PI,Math.PI),m=er(m-M,-CR,CR)}while((Math.abs(T)>y||Math.abs(M)>y)&&--f>0);return new zr(Yr(d),Yr(m))}}class TR extends n_{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(cr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:d,cosPhi:m}=this;return{x:cr(o)*m*d+.5,y:-Math.sin(cr(l))/m*d+.5,z:0}}unproject(o,l){const{scale:d,cosPhi:m}=this,f=-(l-.5)/d,y=er(Yr((o-.5)/d)/m,-180,180),T=Math.asin(er(f*m,-1,1)),M=er(Yr(T),-85.051129,Rs);return new zr(y,M)}}class S6 extends SR{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){const m=kr(o,l,d),f=oi(_o(d));return we.vec3.transformMat4(m,m,f),{x:m[0],y:m[1],z:m[2]}}locationPoint(o,l,d){const m=pu(l.lat,l.lng),f=we.vec3.normalize([],m),y=d?o._centerAltitude+d:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude,T=us(1,0)*Qt*y;we.vec3.scaleAndAdd(m,m,f,T);const M=we.mat4.identity(new Float64Array(16));return we.mat4.multiply(M,o.pixelMatrix,o.globeMatrix),we.vec3.transformMat4(m,m,M),new Gt(m[0],m[1])}pixelsPerMeter(o,l){return us(1,0)*l}pixelSpaceConversion(o,l,d){const m=us(1,o)*l,f=Sn(us(1,45)*l,m,d);return this.pixelsPerMeter(o,l)/f}createTileMatrix(o,l,d){const m=vo(_o(d.canonical));return we.mat4.multiply(new Float64Array(16),o.globeMatrix,m)}createInversionMatrix(o,l){const{center:d}=o,m=oi(_o(l));return we.mat4.rotateY(m,m,cr(d.lng)),we.mat4.rotateX(m,m,cr(d.lat)),we.mat4.scale(m,m,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(o,l,d,m){return Ar(o,l,d,!0)||new s(0,0)}pointCoordinate3D(o,l,d){const m=this.pointCoordinate(o,l,d,0);return[m.x,m.y,m.z]}isPointAboveHorizon(o,l){return!Ar(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(m,f){const y=m.cameraToCenterDistance,T=m._centerAltitude*f,M=m._camera,O=m._camera.forward(),w=we.vec3.add([],we.vec3.scale([],O,-y),[0,0,T]),P=m.worldSize/(2*Math.PI),N=[0,0,-P],L=m.width/m.height,D=Math.tan(m.fovAboveCenter),B=we.vec3.scale([],M.up(),D),q=we.vec3.scale([],M.right(),D*L),Z=we.vec3.normalize([],we.vec3.add([],we.vec3.add([],O,B),q)),re=[];let ne;if(new Mn(w,Z).closestPointOnSphere(N,P,re)){const te=we.vec3.add([],re,N),le=we.vec3.sub([],te,w);ne=Math.cos(m.fovAboveCenter)*we.vec3.length(le)}else{const te=we.vec3.sub([],w,N),le=we.vec3.sub([],N,w);we.vec3.normalize(le,le);const fe=we.vec3.length(te)-P;ne=Math.sqrt(fe*(fe+2*P));const _e=Math.acos(ne/(P+fe))-Math.acos(we.vec3.dot(O,le));ne*=Math.cos(_e)}return 1.01*ne}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=_a(o.zoom);if(d>0){const m=bR(o,us(1,o.center.lat)*o.worldSize),f=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Sn(l,m+f*(1-Math.cos(y)),Math.pow(d,10))}return l}upVector(o,l,d){return kr(l,d,o,1)}upVectorScale(o){return{metersToTile:_r(Wr(_o(o)))}}}function IR(h){const o=h.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(h.name){case"mercator":return new SR(h);case"equirectangular":return new v6(h);case"naturalEarth":return new b6(h);case"equalEarth":return new y6(h);case"winkelTripel":return new w6(h);case"albers":return l?new TR(h):new _6(h);case"lambertConformalConic":return l?new TR(h):new x6(h);case"globe":return new S6(h)}throw new Error(`Invalid projection name: ${h.name}`)}const E6=Qg.VectorTileFeature.types,C6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vw(h,o,l,d,m,f,y,T,M,O,w,P,N){const L=T?Math.min(t_,Math.round(T[0])):0,D=T?Math.min(t_,Math.round(T[1])):0;h.emplaceBack(o,l,Math.round(32*d),Math.round(32*m),f,y,(L<<1)+(M?1:0),D,16*O,16*w,256*P,256*N)}function xw(h,o,l){h.emplaceBack(o,l)}function bw(h,o,l,d,m,f,y){h.emplaceBack(o,l,d,m,f,y)}function ww(h,o,l,d,m){h.emplaceBack(o,l,d,m),h.emplaceBack(o,l,d,m),h.emplaceBack(o,l,d,m),h.emplaceBack(o,l,d,m)}function T6(h){for(const o of h.sections)if(cy(o.text))return!0;return!1}class qC{constructor(o){this.layoutVertexArray=new wm,this.indexArray=new Qo,this.programConfigurations=o,this.segments=new xi,this.dynamicLayoutVertexArray=new Ah,this.opacityVertexArray=new Ng,this.placedSymbolArray=new Dv,this.iconTransitioningVertexArray=new Oc,this.globeExtVertexArray=new Sm,this.zOffsetVertexArray=new hu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(o,l,d,m,f){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jU.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,UU.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,C6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,$U.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,VU.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,GU.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}on(qC,"SymbolBuffers");class HC{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new xi,this.collisionVertexArray=new zg,this.collisionVertexArrayExt=new Ah}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,qU.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,HU.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}on(HC,"CollisionBuffers");class Sw{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=we.mat4.identity([]),this.placementViewportMatrix=we.mat4.identity([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=DC(this.zoom,l["text-size"]),this.iconSizeData=DC(this.zoom,l["icon-size"]);const d=this.layers[0].layout,m=d.get("symbol-sort-key"),f=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(y=>_u[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new qC(new Ku(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new qC(new Ku(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new gy,this.lineVertexArray=new rp,this.symbolInstances=new my}calculateGlyphDependencies(o,l,d,m,f){for(const y of o){const T=y.codePointAt(0);if(T===void 0)break;if(l[T]=!0,m&&f&&T<=65535){const M=Wx[y];M&&(l[M.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const d=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!IC(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(o,l,d,m){const f=this.layers[0],y=f.layout,T=this.projection.name==="globe",M=y.get("text-font"),O=y.get("text-field"),w=y.get("icon-image"),[P,N]=y.get("icon-size-scale-range"),L=er(l.scaleFactor||1,P,N),D=(O.value.kind!=="constant"||O.value.value instanceof Yo&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),B=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,q=y.get("symbol-sort-key");if(this.features=[],!D&&!B)return;const Z=l.iconDependencies,re=l.glyphDependencies,ne=l.availableImages,te=new ei(this.zoom);for(const{feature:le,id:fe,index:_e,sourceLayerIndex:Me}of o){const Ce=f._featureFilter.needGeometry,Te=$(le,Ce);if(!f._featureFilter.filter(te,Te,d))continue;if(Ce||(Te.geometry=U(le,d,m)),T&&le.type!==1&&d.z<=5){const Je=Te.geometry,st=.98078528056,rt=(dt,lt)=>{const pt=kr(dt.x,dt.y,d,1),kt=kr(lt.x,lt.y,d,1);return we.vec3.dot(pt,kt)<st};for(let dt=0;dt<Je.length;dt++)Je[dt]=E(Je[dt],rt)}let Ge,Ae;if(D){const Je=f.getValueAndResolveTokens("text-field",Te,d,ne),st=Yo.factory(Je);T6(st)&&(this.hasRTLText=!0),(!this.hasRTLText||Rc()==="unavailable"||this.hasRTLText&&da.isParsed())&&(Ge=ZU(st,f,Te))}if(B){const Je=f.getValueAndResolveTokens("icon-image",Te,d,ne);Ae=Je instanceof Ko?Je:Ko.build(Je)}if(!Ge&&!Ae)continue;const He=this.sortFeaturesByKey?q.evaluate(Te,{},d):void 0,Qe={id:fe,text:Ge,icon:Ae,index:_e,sourceLayerIndex:Me,geometry:Te.geometry,properties:le.properties,type:E6[le.type],sortKey:He};if(this.features.push(Qe),Ae){const Je=this.layers[0]._unevaluatedLayout._values,{iconPrimary:st,iconSecondary:rt}=_R(Ae,this.iconSizeData,Je["icon-size"],d,this.zoom,Qe,this.pixelRatio,L),dt=st.id.toString();if(Z.has(dt)?Z.get(dt).push(st):Z.set(dt,[st]),rt){const lt=rt.id.toString();Z.has(lt)?Z.get(lt).push(rt):Z.set(lt,[rt])}}if(Ge){const Je=M.evaluate(Te,{},d).join(","),st=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_u.vertical)>=0;for(const rt of Ge.sections)if(rt.image){const dt=rt.image.getPrimary().scaleSelf(this.pixelRatio),lt=dt.id.toString(),pt=Z.get(lt)||[];pt.push(dt),Z.set(lt,pt)}else{const dt=ca(Ge.toString()),lt=rt.fontStack||Je,pt=re[lt]=re[lt]||{};this.calculateGlyphDependencies(rt.text,pt,st,this.allowVerticalPlacement,dt)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(le){const fe={},_e={},Me=[];let Ce=0;function Te(Qe){Me.push(le[Qe]),Ce++}function Ge(Qe,Je,st){const rt=_e[Qe];return delete _e[Qe],_e[Je]=rt,Me[rt].geometry[0].pop(),Me[rt].geometry[0]=Me[rt].geometry[0].concat(st[0]),rt}function Ae(Qe,Je,st){const rt=fe[Je];return delete fe[Je],fe[Qe]=rt,Me[rt].geometry[0].shift(),Me[rt].geometry[0]=st[0].concat(Me[rt].geometry[0]),rt}function He(Qe,Je,st){const rt=st?Je[0][Je[0].length-1]:Je[0][0];return`${Qe}:${rt.x}:${rt.y}`}for(let Qe=0;Qe<le.length;Qe++){const Je=le[Qe],st=Je.geometry,rt=Je.text?Je.text.toString():null;if(!rt){Te(Qe);continue}const dt=He(rt,st),lt=He(rt,st,!0);if(dt in _e&&lt in fe&&_e[dt]!==fe[lt]){const pt=Ae(dt,lt,st),kt=Ge(dt,lt,Me[pt].geometry);delete fe[dt],delete _e[lt],_e[He(rt,Me[kt].geometry,!0)]=kt,Me[pt].geometry=null}else dt in _e?Ge(dt,lt,st):lt in fe?Ae(dt,lt,st):(Te(Qe),fe[dt]=Ce-1,_e[lt]=Ce-1)}return Me.filter(Qe=>Qe.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const le of l.elevationFeatures)this.elevationFeatureIdToIndex.set(le.id,this.elevationFeatures.length),this.elevationFeatures.push(le)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((le,fe)=>le.sortKey-fe.sortKey)}update(o,l,d,m,f,y,T){this.text.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T),this.icon.programConfigurations.updatePaintArrays(o,l,f,d,m,y,T)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);if(d.elevationFeatureIndex===65535)continue;const m=this.elevationFeatures[d.elevationFeatureIndex];if(m){const f=.05+m.pointElevation(new Gt(d.tileAnchorX,d.tileAnchorY));d.zOffset!==f&&(o=!0,d.zOffset=f)}}o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(f,y,T)=>{d+=y,d>f.length&&f.resize(d);for(let M=-y;M<0;M++)f.emplace(M+d,T)},l=(f,y,T)=>{m+=y,m>f.length&&f.resize(m);for(let M=-y;M<0;M++)f.emplace(M+m,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,m=0;for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:M,numIconVertices:O}=y,w=y.zOffset,P=O>0;if((T>0||M>0)&&(o(this.text.zOffsetVertexArray,T,w),o(this.text.zOffsetVertexArray,M,w)),P){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:L}=y;N>=0&&l(this.icon.zOffsetVertexArray,O,w),L>=0&&l(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=IR(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const d=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:m,y:f}of l)this.lineVertexArray.emplaceBack(m,f);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,m,f,y,T,M,O,w,P,N,L,D,B,q){const Z=o.indexArray,re=o.layoutVertexArray,ne=o.globeExtVertexArray,te=o.segments.prepareSegment(4*l.length,re,Z,this.canOverlap?y.sortKey:void 0),le=this.glyphOffsetArray.length,fe=te.vertexLength,_e=this.allowVerticalPlacement&&T===_u.vertical?Math.PI/2:0,Me=y.text&&y.text.sections;for(let Te=0;Te<l.length;Te++){const{tl:Ge,tr:Ae,bl:He,br:Qe,texPrimary:Je,texSecondary:st,pixelOffsetTL:rt,pixelOffsetBR:dt,minFontScaleX:lt,minFontScaleY:pt,glyphOffset:kt,isSDF:Nt,sectionIndex:hn}=l[Te],qt=te.vertexLength,Jt=kt[1];if(vw(re,O.x,O.y,Ge.x,Jt+Ge.y,Je.x,Je.y,d,Nt,rt.x,rt.y,lt,pt),vw(re,O.x,O.y,Ae.x,Jt+Ae.y,Je.x+Je.w,Je.y,d,Nt,dt.x,rt.y,lt,pt),vw(re,O.x,O.y,He.x,Jt+He.y,Je.x,Je.y+Je.h,d,Nt,rt.x,dt.y,lt,pt),vw(re,O.x,O.y,Qe.x,Jt+Qe.y,Je.x+Je.w,Je.y+Je.h,d,Nt,dt.x,dt.y,lt,pt),M){const{x:Bt,y:An,z:un}=M.anchor,[_n,zn,sr]=M.up;bw(ne,Bt,An,un,_n,zn,sr),bw(ne,Bt,An,un,_n,zn,sr),bw(ne,Bt,An,un,_n,zn,sr),bw(ne,Bt,An,un,_n,zn,sr),ww(o.dynamicLayoutVertexArray,Bt,An,un,_e)}else ww(o.dynamicLayoutVertexArray,O.x,O.y,O.z,_e);if(q){const Bt=st||Je;xw(o.iconTransitioningVertexArray,Bt.x,Bt.y),xw(o.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y),xw(o.iconTransitioningVertexArray,Bt.x,Bt.y+Bt.h),xw(o.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y+Bt.h)}Z.emplaceBack(qt,qt+1,qt+2),Z.emplaceBack(qt+1,qt+2,qt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Te!==l.length-1&&hn===l[Te+1].sectionIndex||o.programConfigurations.populatePaintArrays(re.length,y,y.index,{},L,D,B,Me&&Me[hn])}const Ce=M?M.anchor:O;o.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,O.x,O.y,le,this.glyphOffsetArray.length-le,fe,w,P,O.segment,d?d[0]:0,d?d[1]:0,m[0],m[1],T,0,!1,0,N,0)}_commitLayoutVertex(o,l,d,m,f,y,T){o.emplaceBack(l,d,m,f,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(o,l,d,m,f,y,T){const M=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),O=M.vertexLength,w=T.tileAnchorX,P=T.tileAnchorY;for(let L=0;L<4;L++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,l,o.padding,T.zOffset),this._commitLayoutVertex(d.layoutVertexArray,m,f,y,w,P,new Gt(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,f,y,w,P,new Gt(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,f,y,w,P,new Gt(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,m,f,y,w,P,new Gt(o.x1,o.y2)),M.vertexLength+=4;const N=d.indexArray;N.emplaceBack(O,O+1),N.emplaceBack(O+1,O+2),N.emplaceBack(O+2,O+3),N.emplaceBack(O+3,O),M.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,m,f,y){for(let T=m;T<f;T++){const M=d.get(T),O=this.getSymbolInstanceTextSize(o,y,l,T);this._addCollisionDebugVertices(M,O,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,l,d,m,f,y){for(let T=m;T<f;T++){const M=d.get(T),O=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(M,O,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,l,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new HC(ep,$A.members,Oc),this.iconCollisionBox=new HC(ep,$A.members,Oc);const m=Hv(this.iconSizeData,o),f=Hv(this.textSizeData,o,d);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(f,o,l,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(f,o,l,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(m,o,l,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(m,o,l,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(o,l,d,m){const f=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),y=uw(this.textSizeData,o,f)/Zs;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,l,d){const m=this.icon.placedSymbolArray.get(d),f=uw(this.iconSizeData,o,m);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(o,l,d,m){o.emplaceBack(l,-d,-d,m),o.emplaceBack(l,d,-d,m),o.emplaceBack(l,d,d,m),o.emplaceBack(l,-d,d,m)}_updateTextDebugCollisionBoxes(o,l,d,m,f,y,T){for(let M=m;M<f;M++){const O=d.get(M),w=this.getSymbolInstanceTextSize(o,y,l,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,O.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(o,l,d,m,f,y,T){for(let M=m;M<f;M++){const O=d.get(M),w=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,O.padding,y.zOffset)}}updateCollisionDebugBuffers(o,l,d,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=Hv(this.iconSizeData,o,m),y=Hv(this.textSizeData,o,d);for(let T=0;T<this.symbolInstances.length;T++){const M=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(y,o,l,M.textBoxStartIndex,M.textBoxEndIndex,M,d),this._updateTextDebugCollisionBoxes(y,o,l,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M,d),this._updateIconDebugCollisionBoxes(f,o,l,M.iconBoxStartIndex,M.iconBoxEndIndex,M,m),this._updateIconDebugCollisionBoxes(f,o,l,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,m,f,y,T,M,O){const w={};if(l<d){const{x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te,featureIndex:le}=o.get(l);w.textBox={x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te},w.textFeatureIndex=le}if(m<f){const{x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te,featureIndex:le}=o.get(m);w.verticalTextBox={x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te},w.verticalTextFeatureIndex=le}if(y<T){const{x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te,featureIndex:le}=o.get(y);w.iconBox={x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te},w.iconFeatureIndex=le}if(M<O){const{x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te,featureIndex:le}=o.get(M);w.verticalIconBox={x1:P,y1:N,x2:L,y2:D,padding:B,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:re,tileAnchorX:ne,tileAnchorY:te},w.verticalIconFeatureIndex=le}return w}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){const d=o.placedSymbolArray.get(l),m=d.vertexStartIndex+4*d.numGlyphs;for(let f=d.vertexStartIndex;f<m;f+=4)o.indexArray.emplaceBack(f,f+1,f+2),o.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(o),d=Math.cos(o),m=[],f=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const M=this.symbolInstances.get(T);m.push(0|Math.round(l*M.tileAnchorX+d*M.tileAnchorY)),f.push(M.featureIndex)}return y.sort((T,M)=>m[T]-m[M]||f[M]-f[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:O}=d;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),f>=0&&f!==m&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let MR,PR,WC;on(Sw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sw.addDynamicAttributes=ww;class AR{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Bu,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}on(AR,"FormatSectionOverride",{omit:["defaultValue"]});const XC=()=>WC||(WC={layout:MR||(MR=new li({"symbol-placement":new Xt(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ln(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(ft.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xt(ft.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Xt(ft.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Xt(ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xt(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new ln(ft.layout_symbol["icon-size"]),"icon-size-scale-range":new Xt(ft.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ln(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ln(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new ln(ft.layout_symbol["icon-image"]),"icon-rotate":new ln(ft.layout_symbol["icon-rotate"]),"icon-padding":new Xt(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new ln(ft.layout_symbol["icon-offset"]),"icon-anchor":new ln(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(ft.layout_symbol["text-rotation-alignment"]),"text-field":new ln(ft.layout_symbol["text-field"]),"text-font":new ln(ft.layout_symbol["text-font"]),"text-size":new ln(ft.layout_symbol["text-size"]),"text-size-scale-range":new Xt(ft.layout_symbol["text-size-scale-range"]),"text-max-width":new ln(ft.layout_symbol["text-max-width"]),"text-line-height":new ln(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new ln(ft.layout_symbol["text-letter-spacing"]),"text-justify":new ln(ft.layout_symbol["text-justify"]),"text-radial-offset":new ln(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(ft.layout_symbol["text-variable-anchor"]),"text-anchor":new ln(ft.layout_symbol["text-anchor"]),"text-max-angle":new Xt(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(ft.layout_symbol["text-writing-mode"]),"text-rotate":new ln(ft.layout_symbol["text-rotate"]),"text-padding":new Xt(ft.layout_symbol["text-padding"]),"text-keep-upright":new Xt(ft.layout_symbol["text-keep-upright"]),"text-transform":new ln(ft.layout_symbol["text-transform"]),"text-offset":new ln(ft.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xt(ft.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(ft.layout_symbol["text-optional"]),visibility:new Xt(ft.layout_symbol.visibility)})),paint:PR||(PR=new li({"icon-opacity":new ln(ft.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ln(ft.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ln(ft.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ln(ft.paint_symbol["text-emissive-strength"]),"icon-color":new ln(ft.paint_symbol["icon-color"]),"icon-halo-color":new ln(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new ln(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ln(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(ft.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ln(ft.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ln(ft.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ln(ft.paint_symbol["text-occlusion-opacity"]),"text-color":new ln(ft.paint_symbol["text-color"],{runtimeType:ys,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new ln(ft.paint_symbol["text-halo-color"]),"text-halo-width":new ln(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new ln(ft.paint_symbol["text-halo-blur"]),"text-translate":new Xt(ft.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(ft.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xt(ft.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xt(ft.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xt(ft.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xt(ft.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ln(ft.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},WC);class Ew extends Oo{constructor(o,l,d,m){super(o,XC(),l,d,m),this._colorAdjustmentMatrix=we.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const m=[];for(const f of d)m.indexOf(f)<0&&m.push(f);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,d,m){return this._saturation===o&&this._contrast===l&&this._brightnessMin===d&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(f,y,T,M){f=wt(f),y=Xo(y);const O=we.mat4.create(),w=f/3,P=1-2*w,N=[P,w,w,0,w,P,w,0,w,w,P,0,0,0,0,1],L=.5-.5*y,D=M-T;return we.mat4.multiply(O,[D,0,0,0,0,D,0,0,0,0,D,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,L,L,L,1]),we.mat4.multiply(O,O,N),O}(o,l,d,m),this._saturation=o,this._contrast=l,this._brightnessMin=d,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,d,m){const f=this.layout.get(o).evaluate(l,{},d,m),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||Id(y.value)||!f?f:function(T,M){return M.replace(/{([^{}]+)}/g,(O,w)=>w in T?String(T[w]):"")}(l.properties,f)}createBucket(o){return new Sw(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of XC().paint.overridableProperties){if(!Ew.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),d=new AR(l),m=new su(d,l.property.specification,this.scope,this.options);let f=null;f=l.value.kind==="constant"||l.value.kind==="source"?new Rg("source",m):new Wf("composite",m,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new Ms(l.property,f,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&Ew.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const d=o.get("text-field"),m=XC().paint.properties[l];let f=!1;const y=T=>{for(const M of T)if(m.overrides&&m.overrides.hasOverride(M))return void(f=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Yo)y(d.value.value.sections);else if(d.value.kind==="source"){const T=O=>{f||(O instanceof tu&&di(O.value)===ju?y(O.value.sections):O instanceof uh?y(O.sections):O.eachChild(T))},M=d.value;M._styleExpression&&T(M._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,l,d){return{config:new Nc(this,{zoom:l,lut:d}),overrideFog:!1}}}let RR,LR,OR,DR;var ZC=qn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function YC(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function KC(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class JC{constructor(o,l,d,m){this.context=o,this.format=d,this.useMipmap=m&&m.useMipmap,this.texture=o.gl.createTexture(),this.update(l,{premultiply:m&&m.premultiply})}update(o,l){const d=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,m=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:f}=this,{gl:y}=f,{x:T,y:M}=l&&l.position?l.position:{x:0,y:0},O=T+d,w=M+m;!this.size||this.size[0]===O&&this.size[1]===w||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!l||l.premultiply!==!1));const P=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&O>0&&w>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(O,w)))+1:1;y.texStorage2D(y.TEXTURE_2D,N,this.format,O,w),this.size=[O,w]}if(this.size)if(P)y.texSubImage2D(y.TEXTURE_2D,0,T,M,YC(this.format),KC(this.format),o);else{const N=o.data;N&&y.texSubImage2D(y.TEXTURE_2D,0,T,M,d,m,YC(this.format),KC(this.format),N)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(o,l,d=!1){const{context:m}=this,{gl:f}=m;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!d?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,d,m){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),l!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),d!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),this.wrapS=d),m!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class Cw{constructor(o,l){this.context=o,this.texture=l}bind(o,l){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}function Tw(h,o,l,d,m,f,y,T){const M=[h,o,1,l,d,1,m,f,1],O=[y,T,1],w=we.mat3.adjoint([],M),[P,N,L]=we.vec3.transformMat3(O,O,w);return we.mat3.multiply(M,M,[P,0,0,0,N,0,0,0,L])}function NR(h,o,l,d,m,f,y,T){const M=function(O,w,P,N,L,D,B,q){const Z=Tw(0,0,1,0,1,1,0,1),re=Tw(O,w,P,N,L,D,B,q),ne=we.mat3.adjoint([],Z);return we.mat3.multiply(re,re,ne)}(h,o,l,d,m,f,y,T);return[M[2]/M[8]/Qt,M[5]/M[8]/Qt]}function Iw(h){return[h[0],Math.min(Math.max(h[1],-85.051129),Rs)]}class kR extends tl{constructor(o,l,d,m){super(),this.id=o,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new Us("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=gd(this.map._requestManager.transformRequest(this.url,mo.Image),(d,m)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new mi(d)):m&&(this.image=m instanceof HTMLImageElement?Et.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Cw(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Us("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Cw||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],d=o[0][1];for(const f of o)f[1]>d&&(d=f[1]),f[1]<l&&(l=f[1]);const m=(d+l)/2;if(m>Rs?this.onNorthPole=!0:m<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=o.map(s.fromLngLat);this.tileID=function(y){let T=1/0,M=1/0,O=-1/0,w=-1/0;for(const B of y)T=Math.min(T,B.x),M=Math.min(M,B.y),O=Math.max(O,B.x),w=Math.max(w,B.y);const P=Math.max(O-T,w-M),N=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,N);let D=Math.floor((T+O)/2*L);return D>1&&(D-=1),new Rt(N,D,Math.floor((M+w)/2*L))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Us("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const Z in this.tiles){const re=this.tiles[Z];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=Kx(new Rt(0,0,0),this.map.transform.projection),d=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Z){const re=Z[1].x-Z[0].x,ne=Z[1].y-Z[0].y,te=Z[2].x-Z[1].x,le=Z[2].y-Z[1].y,fe=Z[3].x-Z[2].x,_e=Z[3].y-Z[2].y,Me=Z[0].x-Z[3].x,Ce=Z[0].y-Z[3].y,Te=re*le-te*ne,Ge=te*_e-fe*le,Ae=fe*Ce-Me*_e,He=Me*ne-re*Ce;return Te>0&&Ge>0&&Ae>0&&He>0||Te<0&&Ge<0&&Ae<0&&He<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=Kx(this.tileID,this.map.transform.projection),[f,y,T,M]=this.coordinates.map(Z=>{const re=m.projection.project(Z[0],Z[1]);return wR(m,re)._round()});this.perspectiveTransform=NR(f.x,f.y,y.x,y.y,T.x,T.y,M.x,M.y);const O=this._boundsArray=new ul;O.emplaceBack(f.x,f.y,0,0),O.emplaceBack(y.x,y.y,Qt,0),O.emplaceBack(M.x,M.y,0,Qt),O.emplaceBack(T.x,T.y,Qt,Qt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(O,ZC.members),this.boundsSegments=xi.simpleSegment(0,0,4,2);const w=[],P=[Iw((N=this.coordinates)[0]),Iw(N[1]),Iw(N[2]),Iw(N[3])];var N;const[L,D,B,q]=function(Z){let re=Z[0][0],ne=re,te=Z[0][1],le=te;for(let fe=1;fe<Z.length;fe++)Z[fe][0]<re?re=Z[fe][0]:Z[fe][0]>ne&&(ne=Z[fe][0]),Z[fe][1]<te?te=Z[fe][1]:Z[fe][1]>le&&(le=Z[fe][1]);return[re,te,ne-re,le-te]}(P);{const Z=new ul,[re,ne,te,le]=function(rt){let dt=rt[0].x,lt=dt,pt=rt[0].y,kt=pt;for(let Nt=1;Nt<rt.length;Nt++)rt[Nt].x<dt?dt=rt[Nt].x:rt[Nt].x>lt&&(lt=rt[Nt].x),rt[Nt].y<pt?pt=rt[Nt].y:rt[Nt].y>kt&&(kt=rt[Nt].y);return[dt,pt,lt-dt,kt-pt]}(d),fe=rt=>[(rt.x-re)/te,(rt.y-ne)/le],[_e,Me,Ce,Te]=d.map(fe),Ge=function(rt,dt,lt,pt,kt,Nt,hn,qt){const Jt=Tw(0,0,1,0,1,1,0,1),Bt=Tw(rt,dt,lt,pt,kt,Nt,hn,qt),An=we.mat3.adjoint([],Bt);return we.mat3.multiply(Jt,Jt,An)}(_e[0],_e[1],Me[0],Me[1],Ce[0],Ce[1],Te[0],Te[1]);this.elevatedGlobePerspectiveTransform=NR(_e[0],_e[1],Me[0],Me[1],Ce[0],Ce[1],Te[0],Te[1]);const Ae=(rt,dt)=>{w.push(rt.lng);const lt=Math.round((rt.lng-L)/B*Qt),pt=Math.round((rt.lat-D)/q*Qt),kt=fe(dt),Nt=we.vec3.transformMat3([],[kt[0],kt[1],1],Ge),hn=Math.round(Nt[0]/Nt[2]*Qt),qt=Math.round(Nt[1]/Nt[2]*Qt);Z.emplaceBack(lt,pt,hn,qt)},He=d[3].x-d[0].x,Qe=d[3].y-d[0].y,Je=d[2].x-d[1].x,st=d[2].y-d[1].y;for(let rt=0;rt<65;rt++){const dt=rt/64,lt=[d[0].x+dt*He,d[0].y+dt*Qe],pt=[d[1].x+dt*Je,d[1].y+dt*st],kt=pt[0]-lt[0],Nt=pt[1]-lt[1];for(let hn=0;hn<65;hn++){const qt=hn/64,Jt={x:lt[0]+kt*qt,y:lt[1]+Nt*qt};Ae(l.projection.unproject(Jt.x,Jt.y),Jt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(Z,ZC.members)}{this.maxLongitudeTriangleSize=0;let Z=[],re=new Qo;const ne=(te,le,fe)=>{re.emplaceBack(te,le,fe);const _e=w[te],Me=w[le],Ce=w[fe],Te=Math.min(Math.min(_e,Me),Ce),Ge=Math.max(Math.max(_e,Me),Ce)-Te;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),Z.push(Te+Ge/2)};for(let te=0;te<64;te++)for(let le=0;le<64;le++){const fe=65*te+le,_e=fe+1,Me=fe+65,Ce=Me+1;ne(fe,Me,_e),ne(_e,Me,Ce)}[Z,re]=function(te,le){const fe=Array.from({length:te.length},(Ce,Te)=>Te);fe.sort((Ce,Te)=>te[Ce]-te[Te]);const _e=[],Me=new Qo;for(let Ce=0;Ce<fe.length;Ce++){const Te=fe[Ce];_e.push(te[Te]);const Ge=3*Te,Ae=Ge+1;Me.emplaceBack(le.uint16[Ge],le.uint16[Ae],le.uint16[Ae+1])}return[_e,Me]}(Z,re),this.elevatedGlobeTrianglesCenterLongitudes=Z,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(re)}this.elevatedGlobeSegments=xi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/Qt,0,q/Qt,0,0,D,L,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const l=this.map.painter.context,d=l.gl;!this._dirty||this.texture instanceof Cw||(this.texture?this.texture.update(this.image):(this.texture=new JC(l,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let m=(f=o+180)+360*Math.round((d[0]-f)/360);var f;const y=new xi,T=(P,N)=>{y.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:l.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},M=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-m)<=M){const P=Ao(d,0,d.length,m+M);return P===d.length||T(P,fo(d,P+1,d.length,m+360-M)-P),y}m<d[0]&&(m+=360);const O=fo(d,0,d.length,m-M);if(O===d.length)return T(0,d.length),y;T(0,O-0);const w=Ao(d,O+1,d.length,m+M);return w!==d.length&&T(w,d.length-w),y}}const I6=(Math.pow(256,2)-1)/16907520;class FR extends Oo{constructor(o,l,d,m){super(o,{layout:OR||(OR=new li({visibility:new Xt(ft.layout_raster.visibility)})),paint:DR||(DR=new li({"raster-opacity":new Xt(ft.paint_raster["raster-opacity"]),"raster-color":new ka(ft.paint_raster["raster-color"]),"raster-color-mix":new Xt(ft.paint_raster["raster-color-mix"]),"raster-color-range":new Xt(ft.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xt(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(ft.paint_raster["raster-saturation"]),"raster-contrast":new Xt(ft.paint_raster["raster-contrast"]),"raster-resampling":new Xt(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(ft.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xt(ft.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xt(ft.paint_raster["raster-array-band"]),"raster-elevation":new Xt(ft.paint_raster["raster-elevation"]),"raster-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},l,d,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof kR&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[d,m]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(m)||d===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Kg({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,m])}}let zR,BR,jR,VR,UR;class GR extends Oo{constructor(o,l,d,m){super(o,{layout:zR||(zR=new li({visibility:new Xt(ft["layout_raster-particle"].visibility)})),paint:BR||(BR=new li({"raster-particle-array-band":new Xt(ft["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xt(ft["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ka(ft["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xt(ft["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xt(ft["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xt(ft["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xt(ft["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Xt(ft["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},l,d,m),this._updateColorRamp(),this.lastInvalidatedAt=Et.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Kg({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Et.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class M6 extends Oo{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function QC(h,o,l){const d=[0,0,1],m=we.quat.identity([]);return we.quat.rotateY(m,m,l?-cr(h)+Math.PI:cr(h)),we.quat.rotateX(m,m,-cr(o)),we.vec3.transformQuat(d,d,m),we.vec3.normalize(d,d)}function $R(h,o){const l=Mw(h.projection,h.zoom,h.width,h.height),d=function(f,y,T,M,O){const w=new zr(T.lng-180*r_,T.lat),P=new zr(T.lng+180*r_,T.lat),N=f.project(w.lng,w.lat),L=f.project(P.lng,P.lat),D=-Math.atan2(L.y-N.y,L.x-N.x),B=s.fromLngLat(T);B.y=er(B.y,-1+r_,1-r_);const q=B.toLngLat(),Z=f.project(q.lng,q.lat),re=s.fromLngLat(q);re.x+=r_;const ne=re.toLngLat(),te=f.project(ne.lng,ne.lat),le=HR(te.x-Z.x,te.y-Z.y,D),fe=s.fromLngLat(q);fe.y+=r_;const _e=fe.toLngLat(),Me=f.project(_e.lng,_e.lat),Ce=HR(Me.x-Z.x,Me.y-Z.y,D),Te=Math.abs(le.x)/Math.abs(Ce.y),Ge=we.mat4.identity([]);we.mat4.rotateZ(Ge,Ge,-D*(1-(O?0:M)));const Ae=we.mat4.identity([]);return we.mat4.scale(Ae,Ae,[1,1-(1-Te)*M,1]),Ae[4]=-Ce.x/Ce.y*M,we.mat4.rotateZ(Ae,Ae,D),we.mat4.multiply(Ae,Ge,Ae),Ae}(h.projection,0,h.center,l,o),m=qR(h);return we.mat4.scale(d,d,[m,m,1]),d}function qR(h){const o=h.projection,l=Mw(h.projection,h.zoom,h.width,h.height),d=eT(o,h.center),m=eT(o,zr.convert(o.center));return Math.pow(2,d*l+(1-l)*m)}function Mw(h,o,l,d,m=1/0){const f=h.range;if(!f)return 0;const y=Math.min(m,Math.max(l,d)),T=Math.log(y/1024)/Math.LN2;return _s(f[0]+T,f[1]+T,o)}const r_=1/4e4;function eT(h,o){const l=er(o.lat,-85.051129,Rs),d=new zr(o.lng-180*r_,l),m=new zr(o.lng+180*r_,l),f=h.project(d.lng,l),y=h.project(m.lng,l),T=s.fromLngLat(d),M=s.fromLngLat(m),O=y.x-f.x,w=y.y-f.y,P=M.x-T.x,N=M.y-T.y,L=Math.sqrt((P*P+N*N)/(O*O+w*w));return Math.log(L)/Math.LN2}function HR(h,o,l){const d=Math.cos(l),m=Math.sin(l);return{x:h*d-o*m,y:h*m+o*d}}function WR(h,o,l){we.mat4.identity(h),we.mat4.rotateZ(h,h,cr(o[2])),we.mat4.rotateX(h,h,cr(o[0])),we.mat4.rotateY(h,h,cr(o[1])),we.mat4.scale(h,h,l),we.mat4.multiply(h,h,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Pw(h,o,l,d,m,f,y,T){const M=[l[0]-o[0],l[1]-o[1],0],O=[d[0]-o[0],d[1]-o[1],0];if(we.vec3.length(M)<1e-12||we.vec3.length(O)<1e-12)return we.quat.identity(h);const w=we.vec3.cross([],M,O);we.vec3.normalize(w,w),we.vec3.subtract(O,d,o),M[2]=(f-m)*T,O[2]=(y-m)*T;const P=M;return we.vec3.cross(P,M,O),we.vec3.normalize(P,P),we.quat.rotationTo(h,w,P)}function tT(h,o,l=!1){const d=_a(o.zoom),m=function(f,y,T){const M=y.worldSize,O=[f[12],f[13],f[14]],w=go(O[1]/M),P=Va(O[0]/M),N=we.mat4.identity([]),L=us(1,w)*M,D=us(1,0)*M*kc(w,y.zoom),B=1/Li(M);let q=D*B;if(T){const te=Mw(y.projection,y.zoom,y.width,y.height,1024);q=B*y.projection.pixelSpaceConversion(y.center.lat,M,te)}const Z=pu(w,P);we.vec3.add(Z,Z,we.vec3.scale([],we.vec3.normalize([],Z),L*q*O[2]));const re=function(te){const le=[te[0],te[1],te[2]];let fe=[0,1,0];const _e=we.vec3.cross([],fe,le);return we.vec3.cross(fe,le,_e),we.vec3.squaredLength(fe)===0&&(fe=[0,1,0],we.vec3.cross(_e,le,fe)),we.vec3.normalize(_e,_e),we.vec3.normalize(fe,fe),we.vec3.normalize(le,le),[_e[0],_e[1],_e[2],0,fe[0],fe[1],fe[2],0,le[0],le[1],le[2],0,te[0],te[1],te[2],1]}(Z);we.mat4.scale(N,N,[q,q,q*L]),we.mat4.translate(N,N,[-O[0],-O[1],-O[2]]);const ne=we.mat4.multiply([],y.globeMatrix,re);return we.mat4.multiply(ne,ne,N),we.mat4.multiply(ne,ne,f),ne}(h,o,l);if(d>0){const f=function(y,T){const M=T.worldSize,O=us(1,0)*M*kc(T.center.lat,T.zoom)/Li(M),w=us(1,T.center.lat)*M,P=we.mat4.identity([]);return we.mat4.rotateY(P,P,cr(T.center.lng)),we.mat4.rotateX(P,P,cr(T.center.lat)),we.mat4.translate(P,P,[0,0,ws]),we.mat4.scale(P,P,[O,O,O*w]),we.mat4.translate(P,P,[T.point.x-.5*M,T.point.y-.5*M,0]),we.mat4.multiply(P,P,y),we.mat4.multiply(P,T.globeMatrix,P)}(h,o);return function(y,T,M){const O=(D,B,q)=>{const Z=we.vec3.length(D),re=we.vec3.length(B),ne=yo(D,B,q);return we.vec3.scale(ne,ne,1/we.vec3.length(ne)*Sn(Z,re,q))},w=O([y[0],y[1],y[2]],[T[0],T[1],T[2]],M),P=O([y[4],y[5],y[6]],[T[4],T[5],T[6]],M),N=O([y[8],y[9],y[10]],[T[8],T[9],T[10]],M),L=yo([y[12],y[13],y[14]],[T[12],T[13],T[14]],M);return[w[0],w[1],w[2],0,P[0],P[1],P[2],0,N[0],N[1],N[2],0,L[0],L[1],L[2],1]}(m,f,d)}return m}function XR(h,o,l,d){const m=mn.projectAabbCorners(d,l);let f=Number.MAX_VALUE,y=-1;for(let O=0;O<m.length;++O){const w=m[O];w[0]=(.5*w[0]+.5)*o.width,w[1]=(.5-.5*w[1])*o.height,w[2]<f&&(y=O,f=w[2])}const T=O=>new Gt(m[O][0],m[O][1]);let M;switch(y){case 0:case 6:M=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:M=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:M=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:M=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(pe(h,M))return f}const P6=qn([{name:"a_pos_3f",components:3,type:"Float32"}]),A6=qn([{name:"a_color_3f",components:3,type:"Float32"}]),R6=qn([{name:"a_color_4f",components:4,type:"Float32"}]),L6=qn([{name:"a_uv_2f",components:2,type:"Float32"}]),O6=qn([{name:"a_normal_3f",components:3,type:"Float32"}]),D6=qn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),N6=qn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),ZR={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Aw{constructor(o,l,d,m){this.message=(o?`${o}: `:"")+d,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function YR(h,o){const l=h.indexOf("://")===-1;try{return new URL(h,l&&o?"http://example.com":void 0),!0}catch{return!1}}class KR{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class JR{constructor(){this.instancedDataArray=new Im,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class nT{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,l){}populate(o,l,d,m){this.tileToMeter=_(d);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:M,sourceLayerIndex:O}of o){const w=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),P=$(y,f);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),P,d))continue;const N={id:w,sourceLayerIndex:O,index:M,geometry:f?P.geometry:U(y,d,m),properties:y.properties,type:y.type,patterns:{}},L=this.addFeature(N,N.geometry,P);L&&l.featureIndex.insert(y,N.geometry,M,O,this.index,this.instancesPerModel[L].instancedDataArray.length,Qt/32)}this.lookup=null}update(o,l,d,m){for(const f in this.instancesPerModel){const y=this.instancesPerModel[f];for(const T in o)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],o[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const m of d.features){const f=this.layers[0],y=m.feature,T=this.canonical,M=f.paint.get("model-rotation").evaluate(y,{},T),O=f.paint.get("model-scale").evaluate(y,{},T),w=f.paint.get("model-translation").evaluate(y,{},T);we.vec3.exactEquals(m.rotation,M)&&we.vec3.exactEquals(m.scale,O)&&we.vec3.exactEquals(m.translation,w)||(this.evaluate(m,m.featureStates,d,!0),o=!0)}}return o}updateReplacement(o,l,d,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const f=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(IC(this.activeReplacements,f))return!1;this.activeReplacements=f;let y=!1;for(const T in this.instancesPerModel){const M=this.instancesPerModel[T],O=M.instancedDataArray;for(const w of M.features){const P=w.instancedDataOffset,N=w.instancedDataCount;for(let L=0;L<N;L++){const D=16*(L+P);let B=O.float32[D+0];const q=B>Qt;B=q?B-Qt:B;const Z=Math.floor(B),re=O.float32[D+1];let ne=!1;for(const te of this.activeReplacements)if(!lA(te,d,ZR.Model,m)&&!(te.min.x>Z||Z>te.max.x||te.min.y>re||re>te.max.y)&&(ne=pA(fA(Z,re,o.canonical,te.footprintTileId.canonical),te.footprint),ne))break;O.float32[D]=ne?B+Qt:B,y=y||ne!==q}}}return y}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=o.createVertexBuffer(d.instancedDataArray,D6.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris)for(const l of this.modelUris)o.removeModel(l,"")}addFeature(o,l,d){const m=this.layers[0],f=m.layout.get("model-id").evaluate(d,{},this.canonical);if(!f)return vi(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),f;YR(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new JR);const y=this.instancesPerModel[f],T=y.instancedDataArray,M=new KR(d,T.length);for(const O of l)for(const w of O){if(w.x<0||w.x>=Qt||w.y<0||w.y>=Qt)continue;const P=(this.lookupDim-1)/Qt,N=this.lookupDim*(w.y*P|0)+w.x*P|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}this.instanceCount++;const L=T.length;T.resize(L+1),y.instancesEvaluatedElevation.push(0),T.float32[16*L]=w.x,T.float32[16*L+1]=w.y}return M.instancedDataCount=y.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(o.id&&(y.idToFeaturesIndex[o.id]=y.features.length),y.features.push(M),this.evaluate(M,{},y,!1)),f}getModelUris(){return this.modelUris}evaluate(o,l,d,m){const f=this.layers[0],y=o.feature,T=this.canonical,M=o.rotation=f.paint.get("model-rotation").evaluate(y,l,T),O=o.scale=f.paint.get("model-scale").evaluate(y,l,T),w=o.translation=f.paint.get("model-translation").evaluate(y,l,T),P=f.paint.get("model-color").evaluate(y,l,T);P.a=f.paint.get("model-color-mix-intensity").evaluate(y,l,T);const N=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,O[0]),Math.max(O[1],O[2])),WR(N,M,O);const L=Math.round(100*P.a)+P.b/1.05;for(let D=0;D<o.instancedDataCount;++D){const B=o.instancedDataOffset+D,q=16*B,Z=d.instancedDataArray.float32;let re=0;m&&(re=Z[q+6]-d.instancesEvaluatedElevation[B]);const ne=0|Z[q+1];Z[q]=(0|Z[q])+P.r/1.05,Z[q+1]=ne+P.g/1.05,Z[q+2]=L,Z[q+3]=1/(T.z>10?this.tileToMeter:_(T,ne)),Z[q+4]=w[0],Z[q+5]=w[1],Z[q+6]=w[2]+re,Z[q+7]=N[0],Z[q+8]=N[1],Z[q+9]=N[2],Z[q+10]=N[4],Z[q+11]=N[5],Z[q+12]=N[6],Z[q+13]=N[8],Z[q+14]=N[9],Z[q+15]=N[10],d.instancesEvaluatedElevation[B]=w[2]}}}let QR,eL;on(nT,"ModelBucket",{omit:["layers"]}),on(JR,"PerModelAttributes"),on(KR,"ModelFeature");const Ry=64,Jv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function tL(h,o,l,d,m,f,y,T,M,O=!1){const w=l.zoom,P=l.project(d),N=kc(d.lat,w),L=1/N;we.mat4.identity(h),we.mat4.translate(h,h,[P.x+y[0]*L,P.y+y[1]*L,y[2]]);let D=1,B=1;const q=l.worldSize;if(O){if(l.projection.name==="mercator"){let te=0;l.elevation&&(te=l.elevation.getAtPointOrZero(new s(P.x/q,P.y/q),0));const le=we.vec4.transformMat4([],[P.x,P.y,te,1],l.projMatrix)[3]/l.cameraToCenterDistance;D=le,B=le*kc(l.center.lat,w)}else if(l.projection.name==="globe"){const te=tT(h,l),le=we.mat4.multiply([],l.projMatrix,te),fe=[0,0,0,1];we.vec4.transformMat4(fe,fe,le);const _e=fe[3]/l.cameraToCenterDistance,Me=_a(w),Ce=l.projection.pixelsPerMeter(d.lat,q)*kc(d.lat,w),Te=l.projection.pixelsPerMeter(l.center.lat,q)*kc(l.center.lat,w);D=_e/Sn(Ce,Sy(l.center.lat),Me),B=_e*N/Ce,D*=Te,B*=Te}}else D=L;we.mat4.scale(h,h,[D,D,B]);const Z=[...h],re=o.orientation,ne=[];if(WR(ne,[re[0]+m[0],re[1]+m[1],re[2]+m[2]],f),we.mat4.multiply(h,Z,ne),T&&l.elevation){let te=0;const le=[];if(M&&l.elevation){te=function(Me,Ce,Te,Ge,Ae){const He=Ce.elevation;if(!He)return 0;const Qe=mn.projectAabbCorners(Te,Ge),Je=us(1,Ae.lat)*Ce.worldSize,st=function(An,un){const _n=[0,0,1],zn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const sr of zn){const Un=An[sr.corners[0]],gr=An[sr.corners[1]],nr=An[sr.corners[2]],vr=[gr[0]-Un[0],gr[1]-Un[1],un*(gr[2]-Un[2])],$r=we.vec3.cross(vr,vr,[nr[0]-Un[0],nr[1]-Un[1],un*(nr[2]-Un[2])]);we.vec3.normalize($r,$r),sr.dotProductWithUp=we.vec3.dot($r,_n)}return zn.sort((sr,Un)=>sr.dotProductWithUp-Un.dotProductWithUp),zn[0].corners}(Qe,Je),rt=Qe[st[0]],dt=Qe[st[1]],lt=Qe[st[2]],pt=Qe[st[3]],kt=He.getAtPointOrZero(new s(rt[0]/Ce.worldSize,rt[1]/Ce.worldSize),0),Nt=He.getAtPointOrZero(new s(dt[0]/Ce.worldSize,dt[1]/Ce.worldSize),0),hn=He.getAtPointOrZero(new s(lt[0]/Ce.worldSize,lt[1]/Ce.worldSize),0),qt=He.getAtPointOrZero(new s(pt[0]/Ce.worldSize,pt[1]/Ce.worldSize),0),Jt=(kt+qt)/2,Bt=(Nt+hn)/2;return Jt>Bt?Nt<hn?Pw(Me,dt,pt,rt,Nt,qt,kt,Je):Pw(Me,lt,rt,pt,hn,kt,qt,Je):kt<qt?Pw(Me,rt,dt,lt,kt,Nt,hn,Je):Pw(Me,pt,lt,dt,qt,hn,Nt,Je),Math.max(Jt,Bt)}(le,l,o.aabb,h,d);const fe=we.mat4.fromQuat([],le),_e=we.mat4.multiply([],fe,ne);we.mat4.multiply(h,Z,_e)}else te=l.elevation.getAtPointOrZero(new s(P.x/q,P.y/q),0);te!==0&&(h[14]+=te)}}function n1(h,o,l=!1){h.uploaded||(h.gfxTexture=new JC(o,h.image,l?o.gl.R8:o.gl.RGBA8,{useMipmap:h.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),h.uploaded=!0,h.image=null)}function k6(h,o,l){h.indexBuffer=o.createIndexBuffer(h.indexArray,!1,!0),h.vertexBuffer=o.createVertexBuffer(h.vertexArray,P6.members,!1,!0),h.normalArray&&(h.normalBuffer=o.createVertexBuffer(h.normalArray,O6.members,!1,!0)),h.texcoordArray&&(h.texcoordBuffer=o.createVertexBuffer(h.texcoordArray,L6.members,!1,!0)),h.colorArray&&(h.colorBuffer=o.createVertexBuffer(h.colorArray,(h.colorArray.bytesPerElement===12?A6:R6).members,!1,!0)),h.featureArray&&(h.pbrBuffer=o.createVertexBuffer(h.featureArray,N6.members,!0)),h.segments=xi.simpleSegment(0,0,h.vertexArray.length,h.indexArray.length);const d=h.material;d.pbrMetallicRoughness.baseColorTexture&&n1(d.pbrMetallicRoughness.baseColorTexture,o),d.pbrMetallicRoughness.metallicRoughnessTexture&&n1(d.pbrMetallicRoughness.metallicRoughnessTexture,o),d.normalTexture&&n1(d.normalTexture,o),d.occlusionTexture&&n1(d.occlusionTexture,o,l),d.emissionTexture&&n1(d.emissionTexture,o)}function rT(h,o,l){if(h.meshes)for(const d of h.meshes)k6(d,o,l);if(h.children)for(const d of h.children)rT(d,o,l)}function Rw(h){if(h.meshes)for(const o of h.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(h.children)for(const o of h.children)Rw(o)}function iT(h){if(h.meshes)for(const l of h.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(h.children)for(const l of h.children)iT(l)}class Qv{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){const m=d||o.findDEMTileFor(l);if(!m||!m.dem)return;const f=m.dem,y=m.tileID,T=1<<l.canonical.z-y.canonical.z;return new Qv(m,f.dim/Qt/T,[(l.canonical.x/T-y.canonical.x)*f.dim,(l.canonical.y/T-y.canonical.y)*f.dim])}tileCoordToPixel(o,l){const d=l*this._scale+this._offset[1],m=Math.floor(o*this._scale+this._offset[0]),f=Math.floor(d);return new Gt(m,f)}getElevationAt(o,l,d,m){const f=o*this._scale+this._offset[0],y=l*this._scale+this._offset[1],T=Math.floor(f),M=Math.floor(y),O=this._dem;return m=!!m,d?Sn(Sn(O.get(T,M,m),O.get(T,M+1,m),y-M),Sn(O.get(T+1,M,m),O.get(T+1,M+1,m),y-M),f-T):O.get(T,M,m)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*us(1,o)*this._dem.stride}}const oT=new Float32Array(262144),Ly=new Uint8Array(262144);function nL(h){let o=0;if(h.meshes)for(const l of h.meshes)o=Math.max(o,l.aabb.max[2]);if(h.children)for(const l of h.children)o=Math.max(o,nL(l));return o}function rL(h,o,l){if(h.meshes)for(const d of h.meshes){if(d.aabb.min[0]===1/0)continue;const m=mn.applyTransform(d.aabb,h.matrix);l.insert(o,m.min[0],m.min[1],m.max[0],m.max[1])}if(h.children)for(const d of h.children)rL(d,o,l)}const iL=["","wall","door","roof","window","lamp","logo"];class oL{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:nL(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const l=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==o&&(d.transformedAabb=mn.applyTransformFast(d.aabb,this.node.matrix),l.encapsulate(d.transformedAabb)),o++;this.aabb=l}return this.aabb}}class Lw{constructor(o,l,d,m,f,y,T){this.id=d,this.layers=o,this.layerIds=this.layers.map(M=>M.fqid),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.modelTraits|=Jv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=Jv.HasMapboxMeshFeatures),f&&(this.modelTraits|=Jv.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const M of l)this.nodesInfo.push(new oL(M)),rL(M,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(o,l){for(const d of this.getNodesInfo()){const m=d.node;m.footprint&&l.push({footprint:m.footprint,id:o})}}update(o){const l=Object.keys(o).length!==0;if(l&&!this.stateDependentLayers.length)return;const d=l?this.stateDependentLayers:this.layers;if(!Io(o,this.states))for(const m of d)this.evaluate(m,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const d of l){const m=d.node;this.uploaded?this.updatePbrBuffer(m):rT(m,o,!0)}for(const d of l)Rw(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(const d of o.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),l=!0);return l}needsReEvaluation(o,l,d){const m=o.transform.projectionOptions,f=o.style.getBrightness(),y=this.brightness!==f;if(!this.uploaded||this.dirty||m.name!==this.projection.name||r1(d.paint.get("model-color").value,y)||r1(d.paint.get("model-color-mix-intensity").value,y)||r1(d.paint.get("model-roughness").value,y)||r1(d.paint.get("model-emissive-strength").value,y)||r1(d.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=m,this.brightness=f;const T=this.getNodesInfo();for(const M of T)M.state=null;return!0}return!1}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const d=this.getNodesInfo(),m=this.id.canonical;for(const f of d){const y=f.feature;f.evaluatedScale=l.paint.get("model-scale").evaluate(y,{},m)}}evaluate(o,l){const d=this.getNodesInfo();for(const m of d){if(!m.node.meshes)continue;const f=m.feature,y=l&&l[f.id];if(Io(y,m.state))continue;m.state=structuredClone(y);const T=m.node.meshes&&m.node.meshes[0].featureData,M=m.evaluatedColor[2],O=m.evaluatedRMEA[2],w=this.id.canonical;if(m.hasTranslucentParts=!1,T){for(let P=0;P<iL.length;P++){const N=iL[P];N.length&&(f.properties.part=N);const L=o.paint.get("model-color").evaluate(f,y,w).toRenderColor(null),D=o.paint.get("model-color-mix-intensity").evaluate(f,y,w);m.evaluatedColor[P]=[L.r,L.g,L.b,D],m.evaluatedRMEA[P][0]=o.paint.get("model-roughness").evaluate(f,y,w),m.evaluatedRMEA[P][2]=o.paint.get("model-emissive-strength").evaluate(f,y,w),m.evaluatedRMEA[P][3]=L.a,m.emissionHeightBasedParams[P]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,y,w),!m.hasTranslucentParts&&L.a<1&&(m.hasTranslucentParts=!0)}delete f.properties.part,z6(m,M!==m.evaluatedColor[2]||O!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(f,y,w);m.evaluatedScale=o.paint.get("model-scale").evaluate(f,y,w),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,d,m){const f=o.findDEMTileFor(d);if(f&&(f.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const y=Qv.create(o,d,f);if(!y)return;this.modelTraits&Jv.HasMapboxMeshFeatures&&this.updateDEM(o,y,d,m);for(const T of this.getNodesInfo()){const M=T.node;if(!M.footprint||!M.footprint.vertices||!M.footprint.vertices.length)continue;const O=M.footprint.vertices;let w=y.getElevationAt(O[0].x,O[0].y,!0,!0);for(let P=1;P<O.length;P++)w=Math.min(w,y.getElevationAt(O[P].x,O[P].y,!0,!0));M.elevation=w}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,d,m){let f=l._dem._modifiedForSources[m];if(f===void 0&&(l._dem._modifiedForSources[m]=[],f=l._dem._modifiedForSources[m]),f.includes(d.canonical))return;const y=l._dem.dim;f.push(d.canonical);let T=!1;for(const M of this.getNodesInfo()){const O=M.node;if(!O.footprint||!O.footprint.grid)continue;const w=O.footprint.grid,P=l.tileCoordToPixel(w.min.x,w.min.y),N=l.tileCoordToPixel(w.max.x,w.max.y),L=Math.min(Math.min(y-N.y,P.x),Math.min(P.y,y-N.x));if(L<0)continue;const D=er(L,2,5);let B=Math.max(0,P.x-D),q=Math.max(0,P.y-D),Z=Math.min(N.x+D,y-1),re=Math.min(N.y+D,y-1);for(let fe=q;fe<=re;++fe)for(let _e=B;_e<=Z;++_e)Ly[fe*y+_e]=255;let ne=0,te=0;for(let fe=0;fe<w.cellsY;++fe)for(let _e=0;_e<w.cellsX;++_e){if(!w.cells[fe*w.cellsX+_e])continue;const Me=l.tileCoordToPixel(w.min.x+_e/w.xScale,w.min.y+fe/w.yScale),Ce=l.tileCoordToPixel(w.min.x+(_e+1)/w.xScale,w.min.y+(fe+1)/w.yScale);for(let Te=Me.y;Te<=Math.min(Ce.y+1,y-1);++Te)for(let Ge=Me.x;Ge<=Math.min(Ce.x+1,y-1);++Ge)Ly[Te*y+Ge]===255&&(Ly[Te*y+Ge]=0,ne+=l.getElevationAtPixel(Ge,Te),te++)}const le=ne/te;B=Math.max(1,P.x-D),q=Math.max(1,P.y-D),Z=Math.min(N.x+D,y-2),re=Math.min(N.y+D,y-2),T=!0;for(let fe=q;fe<=re;++fe)for(let _e=B;_e<=Z;++_e)Ly[fe*y+_e]===0&&(oT[fe*y+_e]=l._dem.set(_e,fe,le));for(let fe=1;fe<D;++fe){B=Math.max(1,P.x-fe),q=Math.max(1,P.y-fe),Z=Math.min(N.x+fe,y-2),re=Math.min(N.y+fe,y-2);for(let _e=q;_e<=re;++_e)for(let Me=B;Me<=Z;++Me){const Ce=_e*y+Me;if(Ly[Ce]===255){let Te=0,Ge=0,Ae=-1,He=-1;for(let Qe=-1;Qe<=1;++Qe)for(let Je=-1;Je<=1;++Je){const st=(_e+Qe)*y+Me+Je;if(Ly[st]>=fe)continue;const rt=oT[st],dt=Math.abs(rt);dt>Ge&&(Te=rt,Ge=dt,Ae=Je,He=Qe)}if(Ge>.1){const Qe=1-(fe+.5*Math.abs(Ae*He))/D;let Je=l._dem.get(Me,_e)+Te*Qe;const st=l._dem.get(Me+Ae,_e+He),rt=l._dem.get(Me-Ae,_e-He,!0);(Je-st)*(Je-rt)>0&&(Je=(st+rt)/2),oT[Ce]=l._dem.set(Me,_e,Je),Ly[Ce]=fe}}}}}T&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=Et.now())}setFilter(o){this.filter=o?Kf(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new ei(this.id.overscaledZ),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const l of o)Rw(l.node),iT(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const d=l.getReplacementRegionsForTile(o.toUnwrapped()),m=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const y=m[f].node;m[f].hiddenByReplacement=!!y.footprint&&!d.find(T=>T.footprint===y.footprint)}}getHeightAtTileCoord(o,l){const d=this.getNodesInfo(),m=[],f=[0,0,0],y=we.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const M=d[T],O=M.node.meshes[0],w=O.transformedAabb;if(o<w.min[0]||l<w.min[1]||o>w.max[0]||l>w.max[1])continue;if(M.node.hidden===!0)return{height:1/0,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};we.mat4.invert(y,M.node.matrix),f[0]=o,f[1]=l,we.vec3.transformMat4(f,f,y);const P=(f[0]-O.aabb.min[0])/(O.aabb.max[0]-O.aabb.min[0])*Ry|0,N=Math.min(63,(f[1]-O.aabb.min[1])/(O.aabb.max[1]-O.aabb.min[1])*Ry|0)*Ry+Math.min(63,P),L=O.heightmap[N];if(!(L<0&&M.node.footprint))return M.hiddenByReplacement?void 0:{height:L,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};if(M.node.footprint.grid.query(new Gt(o,l),new Gt(o,l),m),m.length>0)return{height:void 0,maxHeight:M.feature.properties.height,hidden:M.hiddenByReplacement,verticalScale:M.evaluatedScale[2]}}}}function r1(h,o){return!h.isLightConstant&&o}function F6(h,o,l,d,m,f,y,T){let M=(61440&o|(61440&o)>>4)>>8,O=(3840&o|(3840&o)>>4)>>4,w=240&o|(240&o)>>4;l[3]>0&&(M=Sn(M,255*l[0],l[3]),O=Sn(O,255*l[1],l[3]),w=Sn(w,255*l[2],l[3]));const P=M<<8|O,N=w<<8|Math.floor(255*d[3]),L=function(fe){const _e=er(fe,0,2);return Math.min(Math.round(.5*_e*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],D=er(m[0],0,1),B=er(m[1],0,1),q=er(m[2],0,1),Z=er(m[3],0,1);let re,ne,te,le;if(D!==B&&y!==f&&B!==D){const fe=y-f;ne=1/(fe*(B-D)),te=-(f+fe*D)/(fe*(B-D));const _e=er(m[4],-1,1);le=Math.pow(10,_e),re=255*q<<8|255*Z}else re=65535,ne=0,te=1,le=1;if(h.emplaceBack(P,N,L,re,ne,te,le),T){const fe=T.length;T.clear();for(let _e=0;_e<fe;_e++)T.emplaceBack(P,N,L,re,ne,te,le)}}function z6(h,o,l){const d=h.node;let m=0;const f=l&Jv.HasMeshoptCompression;for(const y of d.meshes){if(d.lights&&d.lightMeshIndex===m||!y.featureData)continue;y.featureArray=new np,y.featureArray.reserve(y.featureData.length);let T=o;for(const M of y.featureData){const O=f?65535&M:M>>16&65535,w=f?M>>16&65535:65535&M,P=(15&w)<8?15&w:0,N=h.evaluatedRMEA[P],L=h.evaluatedColor[P],D=h.emissionHeightBasedParams[P];let B;if(T&&P===2&&d.lights&&(B=new np,B.resize(10*d.lights.length)),F6(y.featureArray,O,L,N,D,y.aabb.min[2],y.aabb.max[2],B),B&&T){T=!1;const q=d.meshes[d.lightMeshIndex];q.featureArray=B,q.featureArray._trim()}}y.featureArray._trim(),m++}}function sL(h,o,l,d){const m=1<<h.z;o.lat=go((d/Qt+h.y)/m),o.lng=Va((l/Qt+h.x)/m)}on(Lw,"Tiled3dModelBucket",{omit:["layers"]}),on(oL,"Tiled3dModelFeature");const B6={circle:class extends Oo{constructor(h,o,l,d){super(h,{layout:ut||(ut=new li({"circle-sort-key":new ln(ft.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Xt(ft.layout_circle["circle-elevation-reference"]),visibility:new Xt(ft.layout_circle.visibility)})),paint:It||(It=new li({"circle-radius":new ln(ft.paint_circle["circle-radius"]),"circle-color":new ln(ft.paint_circle["circle-color"]),"circle-blur":new ln(ft.paint_circle["circle-blur"]),"circle-opacity":new ln(ft.paint_circle["circle-opacity"]),"circle-translate":new Xt(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ln(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ln(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ln(ft.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xt(ft.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}createBucket(h){return new oe(h)}queryRadius(h){const o=h;return ct("circle-radius",this,o)+ct("circle-stroke-width",this,o)+Pt(this.paint.get("circle-translate"))}queryIntersectsFeature(h,o,l,d,m,f,y,T){const M=jt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,h.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return gu(h,d,f,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,O)}getProgramIds(){return["circle"]}getDefaultProgramParams(h,o,l){const d=lp(this);return{config:new Nc(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}},heatmap:class extends Oo{createBucket(h){return new Vv(h)}constructor(h,o,l,d){super(h,{layout:Jb||(Jb=new li({visibility:new Xt(ft.layout_heatmap.visibility)})),paint:Uv||(Uv=new li({"heatmap-radius":new ln(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ln(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ka(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(ft.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(h){return ct("heatmap-radius",this,h)}queryIntersectsFeature(h,o,l,d,m,f,y,T){const M=this.paint.get("heatmap-radius").evaluate(o,l);return gu(h,d,f,y,T,!0,!0,new Gt(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(h,o,l){return h==="heatmap"?{config:new Nc(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends Oo{constructor(h,o,l,d){super(h,{layout:Qb||(Qb=new li({visibility:new Xt(ft.layout_hillshade.visibility)})),paint:zx||(zx=new li({"hillshade-illumination-direction":new Xt(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(ft.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xt(ft.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(h,o,l){return{overrideFog:!1}}},fill:class extends Oo{constructor(h,o,l,d){super(h,{layout:eA||(eA=new li({"fill-sort-key":new ln(ft.layout_fill["fill-sort-key"]),visibility:new Xt(ft.layout_fill.visibility),"fill-elevation-reference":new Xt(ft.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ln(ft.layout_fill["fill-construct-bridge-guard-rail"])})),paint:tA||(tA=new li({"fill-antialias":new Xt(ft.paint_fill["fill-antialias"]),"fill-opacity":new ln(ft.paint_fill["fill-opacity"]),"fill-color":new ln(ft.paint_fill["fill-color"]),"fill-outline-color":new ln(ft.paint_fill["fill-outline-color"]),"fill-translate":new Xt(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new ln(ft.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xt(ft.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ln(ft.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ln(ft.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ln(ft.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}getProgramIds(){const h=this.paint.get("fill-pattern"),o=h&&h.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(h,o,l){return{config:new Nc(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(h,o){super.recalculate(h,o);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(h){return new EC(h)}queryRadius(){return Pt(this.paint.get("fill-translate"))}queryIntersectsFeature(h,o,l,d,m,f){return!h.queryGeometry.isAboveHorizon&&me(At(h.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,h.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(h){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return h!=null?o&&!h:o}},"fill-extrusion":class extends Oo{constructor(h,o,l,d){super(h,{layout:PA||(PA=new li({visibility:new Xt(ft["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xt(ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:AA||(AA=new li({"fill-extrusion-opacity":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ln(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ln(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ln(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ln(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ln(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ln(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ln(ft["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ln(ft["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Xt(ft["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new lw(h)}queryRadius(){return Pt(this.paint.get("fill-extrusion-translate"))}is3D(h){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(h,o,l,d,m,f,y,T,M){const O=jt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,h.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),N=[0,0],L=T&&f.elevation,D=f.elevation?f.elevation.exaggeration():1,B=h.tile.getBucket(this);if(L&&B instanceof lw){const te=B.centroidVertexArray,le=M+1;le<te.length&&(N[0]=te.geta_centroid_pos0(le),N[1]=te.geta_centroid_pos1(le))}if(N[0]===0&&N[1]===1)return!1;f.projection.name==="globe"&&(d=MA([d],[new Gt(0,0),new Gt(Qt,Qt)],h.tileID.canonical).map(te=>te.polygon).flat());const q=L?T:null,[Z,re]=function(te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe){return te.projection.name==="globe"?function(Je,st,rt,dt,lt,pt,kt,Nt,hn,qt,Jt){const Bt=[],An=[],un=Je.projection.upVectorScale(Jt,Je.center.lat,Je.worldSize).metersToTile,_n=[0,0,0,1],zn=[0,0,0,1],sr=(gr,nr,vr,$r)=>{gr[0]=nr,gr[1]=vr,gr[2]=$r,gr[3]=1},Un=IA();rt>0&&(rt+=Un),dt+=Un;for(const gr of st){const nr=[],vr=[];for(const $r of gr){const fi=$r.x+lt.x,jn=$r.y+lt.y,Tr=Je.projection.projectTilePoint(fi,jn,Jt),Di=Je.projection.upVector(Jt,$r.x,$r.y);let zi=rt,Zi=dt;if(kt){const no=LA(fi,jn,rt,dt,kt,Nt,hn,qt);zi+=no.base,Zi+=no.top}rt!==0?sr(_n,Tr.x+Di[0]*un*zi,Tr.y+Di[1]*un*zi,Tr.z+Di[2]*un*zi):sr(_n,Tr.x,Tr.y,Tr.z),sr(zn,Tr.x+Di[0]*un*Zi,Tr.y+Di[1]*un*Zi,Tr.z+Di[2]*un*Zi),we.vec3.transformMat4(_n,_n,pt),we.vec3.transformMat4(zn,zn,pt),nr.push(new Py(_n[0],_n[1],_n[2])),vr.push(new Py(zn[0],zn[1],zn[2]))}Bt.push(nr),An.push(vr)}return[Bt,An]}(te,le,fe,_e,Me,Ce,Te,Ge,Ae,He,Qe):Te?function(Je,st,rt,dt,lt,pt,kt,Nt,hn){const qt=[],Jt=[],Bt=[0,0,0,1];for(const An of Je){const un=[],_n=[];for(const zn of An){const sr=zn.x+dt.x,Un=zn.y+dt.y,gr=LA(sr,Un,st,rt,pt,kt,Nt,hn);Bt[0]=sr,Bt[1]=Un,Bt[2]=gr.base,Bt[3]=1,we.vec4.transformMat4(Bt,Bt,lt),Bt[3]=Math.max(Bt[3],1e-5);const nr=new Py(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=sr,Bt[1]=Un,Bt[2]=gr.top,Bt[3]=1,we.vec4.transformMat4(Bt,Bt,lt),Bt[3]=Math.max(Bt[3],1e-5);const vr=new Py(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);un.push(nr),_n.push(vr)}qt.push(un),Jt.push(_n)}return[qt,Jt]}(le,fe,_e,Me,Ce,Te,Ge,Ae,He):function(Je,st,rt,dt,lt){const pt=[],kt=[],Nt=lt[8]*st,hn=lt[9]*st,qt=lt[10]*st,Jt=lt[11]*st,Bt=lt[8]*rt,An=lt[9]*rt,un=lt[10]*rt,_n=lt[11]*rt;for(const zn of Je){const sr=[],Un=[];for(const gr of zn){const nr=gr.x+dt.x,vr=gr.y+dt.y,$r=lt[0]*nr+lt[4]*vr+lt[12],fi=lt[1]*nr+lt[5]*vr+lt[13],jn=lt[2]*nr+lt[6]*vr+lt[14],Tr=lt[3]*nr+lt[7]*vr+lt[15],Di=$r+Nt,zi=fi+hn,Zi=jn+qt,no=Math.max(Tr+Jt,1e-5),ui=$r+Bt,hs=fi+An,fl=jn+un,No=Math.max(Tr+_n,1e-5);sr.push(new Py(Di/no,zi/no,Zi/no)),Un.push(new Py(ui/No,hs/No,fl/No))}pt.push(sr),kt.push(Un)}return[pt,kt]}(le,fe,_e,Me,Ce)}(f,d,P,w,O,y,q,N,D,f.center.lat,h.tileID.canonical),ne=h.queryGeometry;return function(te,le,fe){let _e=1/0;me(fe,le)&&(_e=RA(fe,le[0]));for(let Me=0;Me<le.length;Me++){const Ce=le[Me],Te=te[Me];for(let Ge=0;Ge<Ce.length-1;Ge++){const Ae=Ce[Ge],He=[Ae,Ce[Ge+1],Te[Ge+1],Te[Ge],Ae];pe(fe,He)&&(_e=Math.min(_e,RA(fe,He)))}}return _e!==1/0&&_e}(Z,re,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Oo{constructor(h,o,l,d){const m=UA();super(h,m,o,l,d),m.layout&&(this.layout=new Ol(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(h){if(h==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof iu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(h,o){super.recalculate(h,o),this.paint._values["line-floorwidth"]=(()=>{if(Hx)return Hx;const l=UA();return Hx=new BU(l.paint.properties["line-width"].specification),Hx.useIntegerZoom=!0,Hx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)}createBucket(h){return new RC(h)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(h,o,l){const d=jA(this);return{config:new Nc(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}queryRadius(h){const o=h,l=GA(ct("line-width",this,o),ct("line-gap-width",this,o)),d=ct("line-offset",this,o);return l/2+Math.abs(d)+Pt(this.paint.get("line-translate"))}queryIntersectsFeature(h,o,l,d,m,f){if(h.queryGeometry.isAboveHorizon)return!1;const y=At(h.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,h.pixelToTileUnitsFactor),T=h.pixelToTileUnitsFactor/2*GA(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),M=this.paint.get("line-offset").evaluate(o,l);return M&&(d=function(O,w){const P=[],N=new Gt(0,0);for(let L=0;L<O.length;L++){const D=O[L],B=[];for(let q=0;q<D.length;q++){const Z=D[q],re=D[q+1],ne=q===0?N:Z.sub(D[q-1])._unit()._perp(),te=q===D.length-1?N:re.sub(Z)._unit()._perp(),le=ne._add(te)._unit();le._mult(1/(le.x*te.x+le.y*te.y)),B.push(le._mult(w)._add(Z))}P.push(B)}return P}(d,M*h.pixelToTileUnitsFactor)),function(O,w,P){for(let N=0;N<w.length;N++){const L=w[N];if(O.length>=3){for(let D=0;D<L.length;D++)if(Ne(O,L[D]))return!0}if(ve(O,L,P))return!0}return!1}(y,d,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(h){return!this.hasElevatedBuckets}},symbol:Ew,background:class extends Oo{constructor(h,o,l,d){super(h,{layout:RR||(RR=new li({visibility:new Xt(ft.layout_background.visibility)})),paint:LR||(LR=new li({"background-pitch-alignment":new Xt(ft.paint_background["background-pitch-alignment"]),"background-color":new Xt(ft.paint_background["background-color"]),"background-pattern":new Xt(ft.paint_background["background-pattern"]),"background-opacity":new Xt(ft.paint_background["background-opacity"]),"background-emissive-strength":new Xt(ft.paint_background["background-emissive-strength"]),"background-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(h,o,l){return{overrideFog:!1}}is3D(h){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:FR,"raster-particle":GR,sky:class extends Oo{constructor(h,o,l,d){super(h,{layout:jR||(jR=new li({visibility:new Xt(ft.layout_sky.visibility)})),paint:VR||(VR=new li({"sky-type":new Xt(ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xt(ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xt(ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xt(ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xt(ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new ka(ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xt(ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xt(ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xt(ft.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="sky-gradient"?this._updateColorRamp():h!=="sky-atmosphere-sun"&&h!=="sky-atmosphere-halo-color"&&h!=="sky-atmosphere-color"&&h!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(h){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=h.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(h,o){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),m=!d,f=h.style.light,y=f.properties.get("position");return m&&f.properties.get("anchor")==="viewport"&&vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?QC(y.azimuthal,90-y.polar,o):QC(d[0],90-d[1],o)}const l=this.paint.get("sky-gradient-center");return QC(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(h){this._skyboxInvalidated=!1,this._lightPosition=h.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const h=this.paint.get("sky-type");return h==="atmosphere"?["skyboxCapture","skybox"]:h==="gradient"?["skyboxGradient"]:null}},slot:class extends Oo{constructor(h,o,l,d){super(h,{paint:UR||(UR=new li({}))},o,null)}},model:class extends Oo{constructor(h,o,l,d){super(h,{layout:QR||(QR=new li({visibility:new Xt(ft.layout_model.visibility),"model-id":new ln(ft.layout_model["model-id"])})),paint:eL||(eL=new li({"model-opacity":new ln(ft.paint_model["model-opacity"]),"model-rotation":new ln(ft.paint_model["model-rotation"]),"model-scale":new ln(ft.paint_model["model-scale"]),"model-translation":new ln(ft.paint_model["model-translation"]),"model-color":new ln(ft.paint_model["model-color"]),"model-color-mix-intensity":new ln(ft.paint_model["model-color-mix-intensity"]),"model-type":new Xt(ft.paint_model["model-type"]),"model-cast-shadows":new Xt(ft.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xt(ft.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xt(ft.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ln(ft.paint_model["model-emissive-strength"]),"model-roughness":new ln(ft.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ln(ft.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xt(ft.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xt(ft.paint_model["model-front-cutoff"]),"model-color-use-theme":new ln({type:"string",default:"default","property-type":"data-driven"})}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new nT(h)}getProgramIds(){return["model"]}is3D(h){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(h){return h instanceof Lw?Qt-1:0}queryIntersectsFeature(h,o,l,d,m,f){if(!this.modelManager)return!1;const y=this.modelManager,T=h.tile.getBucket(this);if(!(T&&T instanceof nT))return!1;for(const M in T.instancesPerModel){const O=T.instancesPerModel[M],w=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(O.idToFeaturesIndex.hasOwnProperty(w)){const P=O.features[O.idToFeaturesIndex[w]],N=y.getModel(M,this.scope);if(!N)return!1;let L=we.mat4.create();const D=new zr(0,0),B=T.canonical;let q=Number.MAX_VALUE;for(let Z=0;Z<P.instancedDataCount;++Z){const re=16*(P.instancedDataOffset+Z),ne=O.instancedDataArray.float32,te=[ne[re+4],ne[re+5],ne[re+6]];sL(B,D,ne[re],0|ne[re+1]),tL(L,N,f,D,P.rotation,P.scale,te,!1,!1,!1),f.projection.name==="globe"&&(L=tT(L,f));const le=we.mat4.multiply([],f.projMatrix,L),fe=h.queryGeometry,_e=XR(fe.isPointQuery()?fe.screenBounds:fe.screenGeometry,f,le,N.aabb);_e!=null&&(q=Math.min(_e,q))}return q!==Number.MAX_VALUE&&q}}return!1}_handleOverridablePaintPropertyUpdate(h,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||h!=="model-color"&&h!=="model-color-mix-intensity"&&h!=="model-rotation"&&h!=="model-scale"&&h!=="model-translation"&&h!=="model-emissive-strength")}_isPropertyZoomDependent(h){const o=this._transitionablePaint._values[h];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof Wf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Oo{constructor(h,o,l,d){super(h,{layout:nA||(nA=new li({"clip-layer-types":new Xt(ft.layout_clip["clip-layer-types"]),"clip-layer-scope":new Xt(ft.layout_clip["clip-layer-scope"])})),paint:rA||(rA=new li({}))},o,l,d)}recalculate(h,o){super.recalculate(h,o)}createBucket(h){return new iA(h)}is3D(h){return!0}}};class j6{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class V6{constructor(){this.tasks={},this.taskQueue=[],bl(["process"],this),this.invoker=new j6(this.process),this.nextId=0}add(o,l){const d=this.nextId++,m=function({type:f,isSymbolTile:y,zoom:T}){return T=T||0,f==="message"?0:f!=="maybePrepare"||y?f!=="parseTile"||y?f==="parseTile"&&y?300-T:f==="maybePrepare"&&y?400-T:500:200-T:100-T}(l);if(m===0){try{o()}finally{}return null}return this.tasks[d]={fn:o,metadata:l,priority:m,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const f=this.tasks[this.taskQueue[m]];f.priority<l&&(l=f.priority,o=m)}if(o===null)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class aL{constructor(o,l,d){this.target=o,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},bl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new V6}send(o,l,d,m,f=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=y,this.callbacks[T]=d);const M=new Set;return this.target.postMessage({id:T,type:o,hasCallback:!!d,targetMapId:m,mustQueue:f,sourceMapId:this.mapId,data:Ac(l,M)},M),{cancel:()=>{d&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(o){const l=o.data;if(!l)return;const d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const m=this.cancelCallbacks[d];delete this.cancelCallbacks[d],m&&m.cancel()}else if(l.mustQueue||Po()){const m=this.callbacks[d],f=this.scheduler.add(()=>this.processTask(d,l),m&&m.metadata||{type:"message"});f&&(this.cancelCallbacks[d]=f)}else this.processTask(d,l)}processTask(o,l){if(delete this.cancelCallbacks[o],l.type==="<response>"){const d=this.callbacks[o];delete this.callbacks[o],d&&(l.error?d(ua(l.error)):d(null,ua(l.data)))}else{const d=new Set,m=l.hasCallback?(y,T)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:y?Ac(y):null,data:Ac(T,d)},d)}:()=>{},f=ua(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,f,m);else if(this.parent.getWorkerSource){const y=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,y[0],f.source,f.scope)[y[1]](f,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var i1={workerUrl:"",workerClass:null,workerParams:void 0};const sT="mapboxgl_preloaded_worker_pool";class Oy{constructor(){this.active={}}acquire(o,l=Oy.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;)this.workers.push(i1.workerClass!=null?new i1.workerClass:new self.Worker(i1.workerUrl,i1.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sT]}numActive(){return Object.keys(this.active).length}}Oy.workerCount=2;class e0{constructor(o,l,d="Worker",m=Oy.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=jo();const f=this.workerPool.acquire(this.id,m);for(let y=0;y<f.length;y++){const T=new e0.Actor(f[y],l,this.id);T.name=`${d} ${y}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,l,d){Kl(this.actors,(m,f)=>{m.send(o,l,f)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let o1,aT;function Ow(){return o1||(o1=new Oy),o1}e0.Actor=aL;const lT=new Fr(0,0,0);var uT=(h=>(h[h.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",h[h.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",h[h.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",h))(uT||{}),Dw=(h=>(h[h.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",h[h.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",h[h.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",h[h.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",h))(Dw||{}),s1=(h=>(h[h.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",h[h.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",h[h.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",h[h.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",h[h.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",h))(s1||{}),lL=(h=>(h[h.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",h[h.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",h[h.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",h))(lL||{}),t0=(h=>(h[h.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",h[h.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",h[h.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",h[h.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",h[h.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",h[h.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",h))(t0||{}),uL=(h=>(h[h.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",h[h.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",h[h.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",h))(uL||{});function U6(h,o,l){h===1&&o.icons.push(function(d,m){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:y}=f;if(y.content_area){const{content_area:T}=y;T.top==null&&(T.top=T.left),T.width==null&&(T.width=f.usvg_tree.width),T.height==null&&(T.height=T.width)}return y.stretch_x&&y.stretch_x.length&&cL(y,"x"),y.stretch_y&&y.stretch_y.length&&cL(y,"y"),f}(d.readFields(G6,{name:void 0},m))}(l,l.readVarint()+l.pos))}function cL(h,o){const l=[],d=h[`stretch_${o}`];let m=null;for(let f=0;f<d.length;f++)m===null?m=l.length===0?d[0]:l[l.length-1][1]+d[f]:(l.push([m,m+d[f]]),m=null);h[`stretch_${o}_areas`]=l}function G6(h,o,l){h===1?o.name=l.readString():h===2?o.metadata=function(d,m){return d.readFields($6,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(l,l.readVarint()+l.pos):h===3&&(o.usvg_tree=function(d,m){return d.readFields(W6,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(l,l.readVarint()+l.pos),o.data="usvg_tree")}function $6(h,o,l){h===1?o.stretch_x=l.readPackedVarint():h===2?o.stretch_y=l.readPackedVarint():h===3?o.content_area=function(d,m){return d.readFields(q6,{left:0},m)}(l,l.readVarint()+l.pos):h===4&&o.variables.push(function(d,m){return d.readFields(H6,{name:void 0},m)}(l,l.readVarint()+l.pos))}function q6(h,o,l){h===1?o.left=l.readVarint():h===2?o.width=l.readVarint():h===3?o.top=l.readVarint():h===4&&(o.height=l.readVarint())}function H6(h,o,l){h===1?o.name=l.readString():h===2&&(o.rgb_color=Fw(l.readVarint()),o.value="rgb_color")}function W6(h,o,l){h===1?o.width=o.height=l.readVarint():h===2?o.height=l.readVarint():h===3?o.children.push(Nw(l,l.readVarint()+l.pos)):h===4?o.linear_gradients.push(function(d,m){return d.readFields(eG,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(l,l.readVarint()+l.pos)):h===5?o.radial_gradients.push(function(d,m){return d.readFields(nG,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(l,l.readVarint()+l.pos)):h===7?o.clip_paths.push(function(d,m){return d.readFields(rG,{children:[]},m)}(l,l.readVarint()+l.pos)):h===8&&o.masks.push(function(d,m){const f=d.readFields(iG,{left:0,width:20,mask_type:1,children:[]},m);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(l,l.readVarint()+l.pos))}function Nw(h,o){return h.readFields(X6,{},o)}function X6(h,o,l){h===1?(o.group=function(d,m){return d.readFields(Z6,{opacity:255,children:[]},m)}(l,l.readVarint()+l.pos),o.node="group"):h===2&&(o.path=function(d,m){return d.readFields(K6,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(l,l.readVarint()+l.pos),o.node="path")}function Z6(h,o,l){h===1?o.transform=kw(l,l.readVarint()+l.pos):h===2?o.opacity=l.readVarint():h===5?o.clip_path_idx=l.readVarint():h===6?o.mask_idx=l.readVarint():h===7&&o.children.push(Nw(l,l.readVarint()+l.pos))}function kw(h,o){return h.readFields(Y6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function Y6(h,o,l){h===1?o.sx=l.readFloat():h===2?o.ky=l.readFloat():h===3?o.kx=l.readFloat():h===4?o.sy=l.readFloat():h===5?o.tx=l.readFloat():h===6&&(o.ty=l.readFloat())}function K6(h,o,l){h===1?o.fill=function(d,m){return d.readFields(J6,{rgb_color:lT,paint:"rgb_color",opacity:255},m)}(l,l.readVarint()+l.pos):h===2?o.stroke=function(d,m){return d.readFields(Q6,{rgb_color:lT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(l,l.readVarint()+l.pos):h===3?o.paint_order=l.readVarint():h===5?l.readPackedVarint(o.commands):h===6?o.step=l.readFloat():h===7?l.readPackedSVarint(o.diffs):h===8&&(o.rule=l.readVarint())}function J6(h,o,l){h===1?(o.rgb_color=Fw(l.readVarint()),o.paint="rgb_color"):h===2?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):h===3?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):h===5&&(o.opacity=l.readVarint())}function Fw(h){return new Fr((h>>16&255)/255,(h>>8&255)/255,(255&h)/255,1)}function Q6(h,o,l){h===1?(o.rgb_color=Fw(l.readVarint()),o.paint="rgb_color"):h===2?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):h===3?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):h===5?l.readPackedFloat(o.dasharray):h===6?o.dashoffset=l.readFloat():h===7?o.miterlimit=l.readFloat():h===8?o.opacity=l.readVarint():h===9?o.width=l.readFloat():h===10?o.linecap=l.readVarint():h===11&&(o.linejoin=l.readVarint())}function eG(h,o,l){h===1?o.transform=kw(l,l.readVarint()+l.pos):h===2?o.spread_method=l.readVarint():h===3?o.stops.push(hL(l,l.readVarint()+l.pos)):h===4?o.x1=l.readFloat():h===5?o.y1=l.readFloat():h===6?o.x2=l.readFloat():h===7&&(o.y2=l.readFloat())}function hL(h,o){return h.readFields(tG,{offset:0,opacity:255,rgb_color:lT},o)}function tG(h,o,l){h===1?o.offset=l.readFloat():h===2?o.opacity=l.readVarint():h===3&&(o.rgb_color=Fw(l.readVarint()))}function nG(h,o,l){h===1?o.transform=kw(l,l.readVarint()+l.pos):h===2?o.spread_method=l.readVarint():h===3?o.stops.push(hL(l,l.readVarint()+l.pos)):h===4?o.cx=l.readFloat():h===5?o.cy=l.readFloat():h===6?o.r=l.readFloat():h===7?o.fx=l.readFloat():h===8?o.fy=l.readFloat():h===9&&(o.fr=l.readFloat())}function rG(h,o,l){h===1?o.transform=kw(l,l.readVarint()+l.pos):h===2?o.clip_path_idx=l.readVarint():h===3&&o.children.push(Nw(l,l.readVarint()+l.pos))}function iG(h,o,l){h===1?o.left=o.top=l.readFloat():h===2?o.width=o.height=l.readFloat():h===3?o.top=l.readFloat():h===4?o.height=l.readFloat():h===5?o.mask_type=l.readVarint():h===6?o.mask_idx=l.readVarint():h===7&&o.children.push(Nw(l,l.readVarint()+l.pos))}class oG{static calculate(o={},l=[]){const d=new Map,m=new Map;if(Object.keys(o).length===0)return d;l.forEach(f=>{m.set(f.name,f.rgb_color||new Fr(0,0,0))});for(const[f,y]of Object.entries(o))m.has(f)?d.set(m.get(f).toStringPremultipliedAlpha(),y):console.warn(`Ignoring unknown image variable "${f}"`);return d}}function n0(h,o=255,l){const d=o/255,m=h.toStringPremultipliedAlpha(),f=l.has(m)?l.get(m).clone():h.clone();return f.a*=d,f.toString()}function a1(h,o){if(!Ct()){const l=document.createElement("canvas");return l.width=h,l.height=o,l}return new OffscreenCanvas(h,o)}function sG(h,o){const l=oG.calculate(o.params,h.metadata?h.metadata.variables:[]),d=h.usvg_tree,m=d.width,f=d.height,y=o.transform?o.transform:new DOMMatrix,T=Math.max(1,Math.round(m*y.a)),M=Math.max(1,Math.round(f*y.d)),O=new DOMMatrix([T/m,0,0,M/f,0,0]),w=a1(T,M).getContext("2d");return cT(w,O,d,d,l),w.getImageData(0,0,T,M)}function cT(h,o,l,d,m){for(const f of d.children)dL(h,o,l,f,m)}function dL(h,o,l,d,m){d.group?(h.save(),function(f,y,T,M,O){const w=M.mask_idx!=null?T.masks[M.mask_idx]:null,P=M.clip_path_idx!=null?T.clip_paths[M.clip_path_idx]:null;if(M.transform&&(y=zw(M.transform).preMultiplySelf(y)),!function(D,B,q){return D.opacity!==255||B||q}(M,P!=null,w!=null))return void cT(f,y,T,M,O);const N=a1(f.canvas.width,f.canvas.height),L=N.getContext("2d");cT(L,y,T,M,O),P&&vL(L,y,T,P),w&&xL(L,y,T,w,O),f.globalAlpha=M.opacity/255,f.drawImage(N,0,0)}(h,o,l,d.group,m),h.restore()):d.path&&(h.save(),function(f,y,T,M,O){const w=bL(M);f.setTransform(y),M.paint_order===lL.PAINT_ORDER_FILL_AND_STROKE?(fL(f,T,M,w,O),mL(f,T,M,w,O)):(mL(f,T,M,w,O),fL(f,T,M,w,O))}(h,o,l,d.path,m),h.restore())}function fL(h,o,l,d,m){const f=l.fill;if(!f)return;const y=f.opacity/255;switch(f.paint){case"rgb_color":h.fillStyle=n0(f.rgb_color,f.opacity,m);break;case"linear_gradient_idx":h.fillStyle=gL(h,o.linear_gradients[f.linear_gradient_idx],y,m);break;case"radial_gradient_idx":h.fillStyle=_L(h,o.radial_gradients[f.radial_gradient_idx],y,m)}h.fill(d,pL(l))}function pL(h){return h.rule===uT.PATH_RULE_NON_ZERO?"nonzero":h.rule===uT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function mL(h,o,l,d,m){const f=l.stroke;if(!f)return;h.lineWidth=f.width,h.miterLimit=f.miterlimit,h.setLineDash(f.dasharray),h.lineDashOffset=f.dashoffset;const y=f.opacity/255;switch(f.paint){case"rgb_color":h.strokeStyle=n0(f.rgb_color,f.opacity,m);break;case"linear_gradient_idx":h.strokeStyle=gL(h,o.linear_gradients[f.linear_gradient_idx],y,m);break;case"radial_gradient_idx":h.strokeStyle=_L(h,o.radial_gradients[f.radial_gradient_idx],y,m)}switch(f.linejoin){case s1.LINE_JOIN_MITER_CLIP:case s1.LINE_JOIN_MITER:h.lineJoin="miter";break;case s1.LINE_JOIN_ROUND:h.lineJoin="round";break;case s1.LINE_JOIN_BEVEL:h.lineJoin="bevel"}switch(f.linecap){case Dw.LINE_CAP_BUTT:h.lineCap="butt";break;case Dw.LINE_CAP_ROUND:h.lineCap="round";break;case Dw.LINE_CAP_SQUARE:h.lineCap="square"}h.stroke(d)}function gL(h,o,l,d){if(o.stops.length===1){const N=o.stops[0];return n0(N.rgb_color,N.opacity*l,d)}const m=zw(o.transform),{x1:f,y1:y,x2:T,y2:M}=o,O=m.transformPoint(new DOMPoint(f,y)),w=m.transformPoint(new DOMPoint(T,M)),P=h.createLinearGradient(O.x,O.y,w.x,w.y);for(const N of o.stops)P.addColorStop(N.offset,n0(N.rgb_color,N.opacity*l,d));return P}function _L(h,o,l,d){if(o.stops.length===1){const N=o.stops[0];return n0(N.rgb_color,N.opacity*l,d)}const m=zw(o.transform),{fx:f,fy:y,cx:T,cy:M}=o,O=m.transformPoint(new DOMPoint(f,y)),w=m.transformPoint(new DOMPoint(T,M)),P=h.createRadialGradient(O.x,O.y,0,w.x,w.y,o.r*((m.a+m.d)/2));for(const N of o.stops)P.addColorStop(N.offset,n0(N.rgb_color,N.opacity*l,d));return P}function yL(h,o,l,d){const m=d.transform?zw(d.transform).preMultiplySelf(o):o,f=a1(h.canvas.width,h.canvas.height),y=f.getContext("2d");for(const M of d.children)if(M.group)yL(y,m,l,M.group);else if(M.path){const O=M.path,w=new Path2D;w.addPath(bL(O),m),y.fill(w,pL(O))}const T=d.clip_path_idx!=null?l.clip_paths[d.clip_path_idx]:null;T&&vL(y,m,l,T),h.globalCompositeOperation="source-over",h.drawImage(f,0,0)}function vL(h,o,l,d){const m=a1(h.canvas.width,h.canvas.height);yL(m.getContext("2d"),o,l,d),h.globalCompositeOperation="destination-in",h.drawImage(m,0,0)}function xL(h,o,l,d,m){if(d.children.length===0)return;const f=d.mask_idx!=null?l.masks[d.mask_idx]:null;f&&xL(h,o,l,f,m);const y=h.canvas.width,T=h.canvas.height,M=a1(y,T),O=M.getContext("2d"),w=d.width,P=d.height,N=d.left,L=d.top,D=new Path2D,B=new Path2D;B.rect(N,L,w,P),D.addPath(B,o),O.clip(D);for(const re of d.children)dL(O,o,l,re,m);const q=O.getImageData(0,0,y,T),Z=q.data;if(d.mask_type===uL.MASK_TYPE_LUMINANCE)for(let re=0;re<Z.length;re+=4)Z[re+3]=Z[re+3]/255*(.2126*Z[re]+.7152*Z[re+1]+.0722*Z[re+2]);O.putImageData(q,0,0),h.globalCompositeOperation="destination-in",h.drawImage(M,0,0)}function zw(h){return h?new DOMMatrix([h.sx,h.ky,h.kx,h.sy,h.tx,h.ty]):new DOMMatrix}function bL(h){const o=new Path2D,l=h.step;let d=h.diffs[0]*l,m=h.diffs[1]*l;o.moveTo(d,m);for(let f=0,y=2;f<h.commands.length;f++)switch(h.commands[f]){case t0.PATH_COMMAND_MOVE:d+=h.diffs[y++]*l,m+=h.diffs[y++]*l,o.moveTo(d,m);break;case t0.PATH_COMMAND_LINE:d+=h.diffs[y++]*l,m+=h.diffs[y++]*l,o.lineTo(d,m);break;case t0.PATH_COMMAND_QUAD:{const T=d+h.diffs[y++]*l,M=m+h.diffs[y++]*l;d=T+h.diffs[y++]*l,m=M+h.diffs[y++]*l,o.quadraticCurveTo(T,M,d,m);break}case t0.PATH_COMMAND_CUBIC:{const T=d+h.diffs[y++]*l,M=m+h.diffs[y++]*l,O=T+h.diffs[y++]*l,w=M+h.diffs[y++]*l;d=O+h.diffs[y++]*l,m=w+h.diffs[y++]*l,o.bezierCurveTo(T,M,O,w,d,m);break}case t0.PATH_COMMAND_CLOSE:o.closePath()}return o}class Bw{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}delete(o){this.cache.delete(o)}}on(Bw,"LRUCache");class hT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new ns(o,o.data)}getFromCache(o,l,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new Bw(150)),this.cacheMap.get(d).get(Gi(o.toString(),l))}setInCache(o,l,d,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new Bw(150));const f=this.cacheDependenciesMap.get(m),y=Gi(o.id.toString(),d);f.get(y)||f.set(y,new Set);const T=this.cacheMap.get(m),M=o.toString();f.get(y).add(M),T.put(Gi(o.toString(),d),l)}removeImagesFromCacheByIds(o,l,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const m=this.cacheMap.get(d),f=this.cacheDependenciesMap.get(d);for(const y of o){const T=Gi(y.toString(),l);if(f.has(T)){for(const M of f.get(T))m.delete(M);f.delete(T)}}}rasterize(o,l,d,m,f=sG){const y=this.getFromCache(o,d,m);if(y)return y.clone();const T=f(l.icon,o.options),M=hT._getImage(T);return this.setInCache(o,M,d,m),M.clone()}}class wL{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function SL(h,o,l,d){let m=0,f=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(d[y])<1e-15){if(l[y]<h[y]||l[y]>o[y])return null}else{const T=1/d[y];let M=(h[y]-l[y])*T,O=(o[y]-l[y])*T;if(M>O){const w=M;M=O,O=w}if(M>m&&(m=M),O<f&&(f=O),m>f)return null}return m}function EL(h,o,l,d,m,f,y,T,M,O,w){const P=d-h,N=m-o,L=f-l,D=y-h,B=T-o,q=M-l,Z=w[1]*q-w[2]*B,re=w[2]*D-w[0]*q,ne=w[0]*B-w[1]*D,te=P*Z+N*re+L*ne;if(Math.abs(te)<1e-15)return null;const le=1/te,fe=O[0]-h,_e=O[1]-o,Me=O[2]-l,Ce=(fe*Z+_e*re+Me*ne)*le;if(Ce<0||Ce>1)return null;const Te=_e*L-Me*N,Ge=Me*P-fe*L,Ae=fe*N-_e*P,He=(w[0]*Te+w[1]*Ge+w[2]*Ae)*le;return He<0||Ce+He>1?null:(D*Te+B*Ge+q*Ae)*le}function CL(h,o,l){return(h-o)/(l-o)}function TL(h,o,l,d,m,f,y,T,M){const O=1<<l,w=f-d,P=y-m,N=(h+1)/O*w+d,L=(o+0)/O*P+m,D=(o+1)/O*P+m;T[0]=(h+0)/O*w+d,T[1]=L,M[0]=N,M[1]=D}class IL{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(f){const y=Math.ceil(Math.log2(f.dim/8)),T=[];let M=Math.ceil(Math.pow(2,y));const O=1/M,w=(L,D,B,q,Z)=>{const re=q?1:0,ne=(L+1)*B-re,te=D*B,le=(D+1)*B-re;Z[0]=L*B,Z[1]=te,Z[2]=ne,Z[3]=le};let P=new wL(M);const N=[];for(let L=0;L<M*M;L++){w(L%M,Math.floor(L/M),O,!1,N);const D=i_(N[0],N[1],f),B=i_(N[2],N[1],f),q=i_(N[2],N[3],f),Z=i_(N[0],N[3],f);P.minimums.push(Math.min(D,B,q,Z)),P.maximums.push(Math.max(D,B,q,Z)),P.leaves.push(1)}for(T.push(P),M/=2;M>=1;M/=2){const L=T[T.length-1];P=new wL(M);for(let D=0;D<M*M;D++){w(D%M,Math.floor(D/M),2,!0,N);const B=L.getElevation(N[0],N[1]),q=L.getElevation(N[2],N[1]),Z=L.getElevation(N[2],N[3]),re=L.getElevation(N[0],N[3]),ne=L.isLeaf(N[0],N[1]),te=L.isLeaf(N[2],N[1]),le=L.isLeaf(N[2],N[3]),fe=L.isLeaf(N[0],N[3]),_e=Math.min(B.min,q.min,Z.min,re.min),Me=Math.max(B.max,q.max,Z.max,re.max),Ce=ne&&te&&le&&fe;P.maximums.push(Me),P.minimums.push(_e),P.leaves.push(Me-_e<=5&&Ce?1:0)}T.push(P)}return T}(this.dem),d=l.length-1,m=l[d];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,m,f,y,T=1){return SL([o,l,-100],[d,m,this.maximums[0]*T],f,y)}raycast(o,l,d,m,f,y,T=1){if(!this.nodeCount)return null;const M=this.raycastRoot(o,l,d,m,f,y,T);if(M==null)return null;const O=[],w=[],P=[],N=[],L=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:D,t:B,nodex:q,nodey:Z,depth:re}=L.pop();if(this.leaves[D]){TL(q,Z,re,o,l,d,m,P,N);const te=1<<re,le=(q+0)/te,fe=(q+1)/te,_e=(Z+0)/te,Me=(Z+1)/te,Ce=i_(le,_e,this.dem)*T,Te=i_(fe,_e,this.dem)*T,Ge=i_(fe,Me,this.dem)*T,Ae=i_(le,Me,this.dem)*T,He=EL(P[0],P[1],Ce,N[0],P[1],Te,N[0],N[1],Ge,f,y),Qe=EL(N[0],N[1],Ge,P[0],N[1],Ae,P[0],P[1],Ce,f,y),Je=Math.min(He!==null?He:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const st=we.vec3.scaleAndAdd([],f,y,B);if(ML(Ce,Te,Ae,Ge,CL(st[0],P[0],N[0]),CL(st[1],P[1],N[1]))>=st[2])return B}continue}let ne=0;for(let te=0;te<this._siblingOffset.length;te++){TL((q<<1)+this._siblingOffset[te][0],(Z<<1)+this._siblingOffset[te][1],re+1,o,l,d,m,P,N),P[2]=-100,N[2]=this.maximums[this.childOffsets[D]+te]*T;const le=SL(P,N,f,y);if(le!=null){const fe=le;O[te]=fe;let _e=!1;for(let Me=0;Me<ne&&!_e;Me++)fe>=O[w[Me]]&&(w.splice(Me,0,te),_e=!0);_e||(w[ne]=te),ne++}}for(let te=0;te<ne;te++){const le=w[te];L.push({idx:this.childOffsets[D]+le,t:O[le],nodex:(q<<1)+this._siblingOffset[le][0],nodey:(Z<<1)+this._siblingOffset[le][1],depth:re+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,m,f){if(o[m].isLeaf(l,d)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const y=m-1,T=o[y];let M=0,O=0;for(let w=0;w<this._siblingOffset.length;w++){const P=2*l+this._siblingOffset[w][0],N=2*d+this._siblingOffset[w][1],L=T.getElevation(P,N),D=T.isLeaf(P,N),B=this._addNode(L.min,L.max,D);D&&(M|=1<<w),O||(O=B)}for(let w=0;w<this._siblingOffset.length;w++)M&1<<w||this._construct(o,2*l+this._siblingOffset[w][0],2*d+this._siblingOffset[w][1],y,O+w)}}function ML(h,o,l,d,m,f){return Sn(Sn(h,l,f),Sn(o,d,f),m)}function i_(h,o,l){const d=l.dim,m=er(h*d-.5,0,d-1),f=er(o*d-.5,0,d-1),y=Math.floor(m),T=Math.floor(f),M=Math.min(y+1,d-1),O=Math.min(T+1,d-1);return ML(l.get(y,T),l.get(M,T),l.get(y,O),l.get(M,O),m-y,f-T)}const aG={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lG(h,o,l){return(256*h*256+256*o+l)/10-1e4}function uG(h,o,l){return 256*h+o+l/256-32768}class jw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,m=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void vi(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const f=this.dim=l.height-2,y=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let M=0;M<f;M++)y[this._idx(-1,M)]=y[this._idx(0,M)],y[this._idx(f,M)]=y[this._idx(f-1,M)],y[this._idx(M,-1)]=y[this._idx(M,0)],y[this._idx(M,f)]=y[this._idx(M,f-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(f,-1)]=y[this._idx(f-1,0)],y[this._idx(-1,f)]=y[this._idx(0,f-1)],y[this._idx(f,f)]=y[this._idx(f-1,f-1)]}const T=d==="terrarium"?uG:lG;for(let M=0;M<y.length;++M){const O=4*M;this.floatView[M]=T(this.pixels[O],this.pixels[O+1],this.pixels[O+2])}this._timestamp=Et.now()}_buildQuadTree(){this._tree=new IL(this)}get(o,l,d=!1){d&&(o=er(o,-1,this.dim),l=er(l,-1,this.dim));const m=this._idx(o,l);return this.floatView[m]}set(o,l,d){const m=this._idx(o,l),f=this.floatView[m];return this.floatView[m]=d,d-f}static getUnpackVector(o){return aG[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const d=[0,0,0,0],m=jw.getUnpackVector(l);let f=Math.floor((o+m[3])/m[2]);return d[2]=f%256,f=Math.floor(f/256),d[1]=f%256,f=Math.floor(f/256),d[0]=f,d}getPixels(){return new ew({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,f=l*this.dim+this.dim,y=d*this.dim,T=d*this.dim+this.dim;switch(l){case-1:m=f-1;break;case 1:f=m+1}switch(d){case-1:y=T-1;break;case 1:T=y+1}const M=-l*this.dim,O=-d*this.dim;for(let w=y;w<T;w++)for(let P=m;P<f;P++){const N=4*this._idx(P,w),L=4*this._idx(P+M,w+O);this.pixels[N+0]=o.pixels[L+0],this.pixels[N+1]=o.pixels[L+1],this.pixels[N+2]=o.pixels[L+2],this.pixels[N+3]=o.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function cG(h,o,l){h===1?o.headerLength=l.readFixed32():h===2?o.x=l.readVarint():h===3?o.y=l.readVarint():h===4?o.z=l.readVarint():h===5&&o.layers.push(function(d,m){return d.readFields(mG,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(l,l.readVarint()+l.pos))}function hG(h,o,l){h===1?(o.delta_filter=function(d,m){return d.readFields(dG,{blockSize:0},m)}(l,l.readVarint()+l.pos),o.filter="delta_filter"):h===2?(l.readVarint(),o.filter="zigzag_filter"):h===3?(l.readVarint(),o.filter="bitshuffle_filter"):h===4&&(l.readVarint(),o.filter="byteshuffle_filter")}function dG(h,o,l){h===1&&(o.blockSize=l.readVarint())}function fG(h,o,l){h===1?(l.readVarint(),o.codec="gzip_data"):h===2?(l.readVarint(),o.codec="jpeg_image"):h===3?(l.readVarint(),o.codec="webp_image"):h===4&&(l.readVarint(),o.codec="png_image")}function pG(h,o,l){let d=0,m=0;h===1?o.firstByte=l.readFixed64():h===2?o.lastByte=l.readFixed64():h===3?o.filters.push(function(f,y){return f.readFields(hG,{},y)}(l,l.readVarint()+l.pos)):h===4?o.codec=function(f,y){return f.readFields(fG,{},y)}(l,l.readVarint()+l.pos):h===5?m=l.readFloat():h===6?d=l.readFloat():h===7?o.bands.push(l.readString()):h===8?o.offset=l.readDouble():h===9&&(o.scale=l.readDouble()),o.offset===0&&(o.offset=m),o.scale===0&&(o.scale=d)}function mG(h,o,l){h===1?o.version=l.readVarint():h===2?o.name=l.readString():h===3?o.units=l.readString():h===4?o.tileSize=l.readVarint():h===5?o.buffer=l.readVarint():h===6?o.pixelFormat=l.readVarint():h===7&&o.dataIndex.push(function(d,m){return d.readFields(pG,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(l,l.readVarint()+l.pos))}function gG(h,o,l){if(h===2)(function(d,m,f){d.readFields(_G,f,m)})(l,l.readVarint()+l.pos,o);else if(h===3)throw new Error("Not implemented")}function _G(h,o,l){if(h===1){let d=0;const m=l.readVarint()+l.pos;for(;l.pos<m;)o[d++]=l.readVarint()}}function yG(h,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let d=2;d>=1;d--){const m=d===1?1:0,f=d===2?1:0;for(let y=0;y<o[0];y++){const T=o[1]*y;for(let M=m;M<o[1];M++){const O=o[2]*(M+T);for(let w=f;w<o[2];w++){const P=o[3]*(w+O);for(let N=0;N<o[3];N++){const L=P+N;h[L]+=h[L-l]}}}}l*=o[d]}return h}function vG(h){for(let o=0,l=h.length;o<l;o++)h[o]=h[o]>>>1^-(1&h[o]);return h}function xG(h,o){switch(o){case"uint32":return h;case"uint16":for(let l=0;l<h.length;l+=2){const d=h[l],m=h[l+1];h[l]=(240&d)>>4|(61440&d)>>8|(240&m)<<4|61440&m,h[l+1]=15&d|(3840&d)>>4|(15&m)<<8|(3840&m)<<4}return h;case"uint8":for(let l=0;l<h.length;l+=4){const d=h[l],m=h[l+1],f=h[l+2],y=h[l+3];h[l+0]=(192&d)>>6|(192&m)>>4|(192&f)>>2|192&y,h[l+1]=(48&d)>>4|(48&m)>>2|48&f|(48&y)<<2,h[l+2]=(12&d)>>2|12&m|(12&f)<<2|(12&y)<<4,h[l+3]=3&d|(3&m)<<2|(3&f)<<4|(3&y)<<6}return h;default:throw new Error(`Invalid pixel format, "${o}"`)}}on(jw,"DEMData"),on(IL,"DemMinMaxQuadTree",{omit:["dem"]});var Fc=Uint8Array,l1=Uint16Array,bG=Int32Array,PL=new Fc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),AL=new Fc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wG=new Fc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),RL=function(h,o){for(var l=new l1(31),d=0;d<31;++d)l[d]=o+=1<<h[d-1];var m=new bG(l[30]);for(d=1;d<30;++d)for(var f=l[d];f<l[d+1];++f)m[f]=f-l[d]<<5|d;return{b:l,r:m}},LL=RL(PL,2),OL=LL.b,SG=LL.r;OL[28]=258,SG[258]=28;for(var EG=RL(AL,0).b,DL=new l1(32768),Uo=0;Uo<32768;++Uo){var r0=(43690&Uo)>>1|(21845&Uo)<<1;DL[Uo]=((65280&(r0=(61680&(r0=(52428&r0)>>2|(13107&r0)<<2))>>4|(3855&r0)<<4))>>8|(255&r0)<<8)>>1}var u1=function(h,o,l){for(var d=h.length,m=0,f=new l1(o);m<d;++m)h[m]&&++f[h[m]-1];var y,T=new l1(o);for(m=1;m<o;++m)T[m]=T[m-1]+f[m-1]<<1;y=new l1(1<<o);var M=15-o;for(m=0;m<d;++m)if(h[m])for(var O=m<<4|h[m],w=o-h[m],P=T[h[m]-1]++<<w,N=P|(1<<w)-1;P<=N;++P)y[DL[P]>>M]=O;return y},c1=new Fc(288);for(Uo=0;Uo<144;++Uo)c1[Uo]=8;for(Uo=144;Uo<256;++Uo)c1[Uo]=9;for(Uo=256;Uo<280;++Uo)c1[Uo]=7;for(Uo=280;Uo<288;++Uo)c1[Uo]=8;var NL=new Fc(32);for(Uo=0;Uo<32;++Uo)NL[Uo]=5;var CG=u1(c1,9),TG=u1(NL,5),dT=function(h){for(var o=h[0],l=1;l<h.length;++l)h[l]>o&&(o=h[l]);return o},Gd=function(h,o,l){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&l},fT=function(h,o){var l=o/8|0;return(h[l]|h[l+1]<<8|h[l+2]<<16)>>(7&o)},IG=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$d=function(h,o,l){var d=new Error(o||IG[h]);if(d.code=h,Error.captureStackTrace&&Error.captureStackTrace(d,$d),!l)throw d;return d},MG=new Fc(0),PG=typeof TextDecoder<"u"&&new TextDecoder;try{PG.decode(MG,{stream:!0})}catch{}const AG={gzip_data:"gzip"};class kh extends Error{constructor(o){super(o),this.name="MRTError"}}const RG={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},kL={uint32:1,uint16:2,uint8:4},LG={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let pT;class Vw{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const l=this.layers[o];if(!l)throw new kh(`Layer '${o}' not found`);return l}getHeaderLength(o){const l=new Uint8Array(o),d=new DataView(o);if(l[0]!==13)throw new kh("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(o){const l=new Uint8Array(o),d=this.getHeaderLength(o);if(l.length<d)throw new kh(`Expected header with length >= ${d} but got buffer of length ${l.length}`);const m=function(f,y){return f.readFields(cG,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new pT(l.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new kh(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const f of m.layers)this.layers[f.name]=new FL(f,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const l=[],d=this.getLayer(o.layerName);for(let m of o.blockIndices){const f=d.dataIndex[m],y=f.firstByte-o.firstByte,T=f.lastByte-o.firstByte;if(d._blocksInProgress.has(m))continue;const M={layerName:d.name,firstByte:y,lastByte:T,pixelFormat:d.pixelFormat,blockIndex:m,blockShape:[f.bands.length].concat(d.bandShape),buffer:d.buffer,codec:f.codec.codec,filters:f.filters.map(O=>O.filter)};d._blocksInProgress.add(m),l.push(M)}return new zL(l,()=>{l.forEach(m=>d._blocksInProgress.delete(m.blockIndex))},(m,f)=>{if(l.forEach(y=>d._blocksInProgress.delete(y.blockIndex)),m)throw m;f.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class FL{constructor({version:o,name:l,units:d,tileSize:m,pixelFormat:f,buffer:y,dataIndex:T},M){if(this.version=o,this.version!==1)throw new kh(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=d,this.tileSize=m,this.buffer=y,this.pixelFormat=RG[f],this.dataIndex=T,this.bandShape=[m+2*y,m+2*y,kL[this.pixelFormat]],this._decodedBlocks=new Bw(M?M.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return kL[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(const[d,m]of this.dataIndex.entries()){for(const[f,y]of m.bands.entries())if(y===o)return{bandIndex:l+f,blockIndex:d,blockBandIndex:f};l+=m.bands.length}break;case"number":for(const[d,m]of this.dataIndex.entries()){if(o>=l&&o<l+m.bands.length)return{bandIndex:o,blockIndex:d,blockBandIndex:o-l};l+=m.bands.length}break;default:throw new kh(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let l=1/0,d=-1/0;const m=[],f=new Set;for(const y of o){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new kh(`Invalid band: ${JSON.stringify(y)}`);const M=this.dataIndex[T];m.includes(T)||m.push(T),f.add(T),l=Math.min(l,M.firstByte),d=Math.max(d,M.lastByte)}if(f.size>this.cacheSize)throw new kh(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:d,blockIndices:m}}hasBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){const{blockIndex:l,blockBandIndex:d}=this.getBlockForBand(o);if(l<0)throw new kh(`Band not found: ${JSON.stringify(o)}`);const m=this._decodedBlocks.get(l.toString());if(!m)throw new kh(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[l],y=this.bandShape.reduce((O,w)=>O*w,1),T=d*y,M=m.subarray(T,T+y);return{data:M,bytes:new Uint8Array(M.buffer).subarray(M.byteOffset,M.byteOffset+M.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}Vw.setPbf=function(h){pT=h};class zL{constructor(o,l,d){this.tasks=o,this._onCancel=l,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}Vw.performDecoding=function(h,o){const l=new Uint8Array(h);return Promise.all(o.tasks.map(d=>{const{layerName:m,firstByte:f,lastByte:y,pixelFormat:T,blockShape:M,blockIndex:O,filters:w,codec:P}=d,N=l.subarray(f,y+1),L=new Uint32Array(M[0]*M[1]*M[2]);let D;if(P!=="gzip_data")throw new kh(`Unhandled codec: ${P}`);return D=function(B,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((te=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||$d(6,"invalid gzip data");var Me=_e[3],Ce=10;4&Me&&(Ce+=2+(_e[10]|_e[11]<<8));for(var Te=(Me>>3&1)+(Me>>4&1);Te>0;Te-=!_e[Ce++]);return Ce+(2&Me)}(ne=B))+8>ne.length&&$d(6,"invalid gzip data"),function(_e,Me,Ce,Te){var Ge=_e.length;if(!Ge||Me.f&&!Me.l)return Ce||new Fc(0);var Ae=!Ce,He=Ae||Me.i!=2,Qe=Me.i;Ae&&(Ce=new Fc(3*Ge));var Je,st,rt=function(s_){var a_=Ce.length;if(s_>a_){var Ny=new Fc(Math.max(2*a_,s_));Ny.set(Ce),Ce=Ny}},dt=Me.f||0,lt=Me.p||0,pt=Me.b||0,kt=Me.l,Nt=Me.d,hn=Me.m,qt=Me.n,Jt=8*Ge;do{if(!kt){dt=Gd(_e,lt,1);var Bt=Gd(_e,lt+1,3);if(lt+=3,!Bt){var An=_e[(jn=4+((lt+7)/8|0))-4]|_e[jn-3]<<8,un=jn+An;if(un>Ge){Qe&&$d(0);break}He&&rt(pt+An),Ce.set(_e.subarray(jn,un),pt),Me.b=pt+=An,Me.p=lt=8*un,Me.f=dt;continue}if(Bt==1)kt=CG,Nt=TG,hn=9,qt=5;else if(Bt==2){var _n=Gd(_e,lt,31)+257,zn=Gd(_e,lt+10,15)+4,sr=_n+Gd(_e,lt+5,31)+1;lt+=14;for(var Un=new Fc(sr),gr=new Fc(19),nr=0;nr<zn;++nr)gr[wG[nr]]=Gd(_e,lt+3*nr,7);lt+=3*zn;var vr=dT(gr),$r=(1<<vr)-1,fi=u1(gr,vr);for(nr=0;nr<sr;){var jn,Tr=fi[Gd(_e,lt,$r)];if(lt+=15&Tr,(jn=Tr>>4)<16)Un[nr++]=jn;else{var Di=0,zi=0;for(jn==16?(zi=3+Gd(_e,lt,3),lt+=2,Di=Un[nr-1]):jn==17?(zi=3+Gd(_e,lt,7),lt+=3):jn==18&&(zi=11+Gd(_e,lt,127),lt+=7);zi--;)Un[nr++]=Di}}var Zi=Un.subarray(0,_n),no=Un.subarray(_n);hn=dT(Zi),qt=dT(no),kt=u1(Zi,hn),Nt=u1(no,qt)}else $d(1);if(lt>Jt){Qe&&$d(0);break}}He&&rt(pt+131072);for(var ui=(1<<hn)-1,hs=(1<<qt)-1,fl=lt;;fl=lt){var No=(Di=kt[fT(_e,lt)&ui])>>4;if((lt+=15&Di)>Jt){Qe&&$d(0);break}if(Di||$d(2),No<256)Ce[pt++]=No;else{if(No==256){fl=lt,kt=null;break}var Go=No-254;No>264&&(Go=Gd(_e,lt,(1<<(zc=PL[nr=No-257]))-1)+OL[nr],lt+=zc);var va=Nt[fT(_e,lt)&hs],Os=va>>4;if(va||$d(3),lt+=15&va,no=EG[Os],Os>3){var zc=AL[Os];no+=fT(_e,lt)&(1<<zc)-1,lt+=zc}if(lt>Jt){Qe&&$d(0);break}He&&rt(pt+131072);var o_=pt+Go;if(pt<no){var Fh=0-no,Hd=Math.min(no,o_);for(Fh+pt<0&&$d(3);pt<Hd;++pt)Ce[pt]=(void 0)[Fh+pt]}for(;pt<o_;++pt)Ce[pt]=Ce[pt-no]}}Me.l=kt,Me.p=fl,Me.b=pt,Me.f=dt,kt&&(dt=1,Me.m=hn,Me.d=Nt,Me.n=qt)}while(!dt);return pt!=Ce.length&&Ae?(Je=Ce,((st=pt)==null||st>Je.length)&&(st=Je.length),new Fc(Je.subarray(0,st))):Ce.subarray(0,pt)}(ne.subarray(te,-8),{i:2},new Fc(((Z=ne)[(re=Z.length)-4]|Z[re-3]<<8|Z[re-2]<<16|Z[re-1]<<24)>>>0))));var Z,re,ne,te;const le=AG[q];if(!le)throw new Error(`Unhandled codec: ${q}`);const fe=new globalThis.DecompressionStream(le);return new Response(new Blob([B]).stream().pipeThrough(fe)).arrayBuffer().then(_e=>new Uint8Array(_e))}(N,P).then(B=>(function(q,Z){q.readFields(gG,Z)}(new pT(B),L),new LG[T](L.buffer))),D.then(B=>{for(let q=w.length-1;q>=0;q--)switch(w[q]){case"delta_filter":yG(B,M);break;case"zigzag_filter":vG(B);break;case"bitshuffle_filter":xG(B,T);break;default:throw new kh(`Unhandled filter "${w[q]}"`)}return{layerName:m,blockIndex:O,data:B}}).catch(B=>{throw B})}))},on(zL,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),on(Vw,"MapboxRasterTile"),on(FL,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let h1,mT,qd,i0,gT,o0=null;function BL(){return Po()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:mT||ge.DRACO_URL}function jL(){if(Po()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(i0)return i0;const h=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return i0=WebAssembly.validate(h)?ge.MESHOPT_SIMD_URL:ge.MESHOPT_URL,i0}const Uw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OG={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},d1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function VL(h,o,l){const d=l.json.bufferViews.length,m=l.buffers.length;o.bufferView=d,l.json.bufferViews[d]={buffer:m,byteLength:h.byteLength},l.buffers[m]=h}const _T="KHR_draco_mesh_compression";function DG(h,o){const l=h.extensions&&h.extensions[_T];if(!l)return;const d=new qd.Decoder,m=qL(o,l.bufferView),f=new qd.Mesh;if(!d.DecodeArrayToMesh(m,m.byteLength,f))throw new Error("Failed to decode Draco mesh");const y=o.json.accessors[h.indices],T=Uw[y.componentType],M=y.count*T.BYTES_PER_ELEMENT,O=qd._malloc(M);T===Uint16Array?d.GetTrianglesUInt16Array(f,M,O):d.GetTrianglesUInt32Array(f,M,O),VL(qd.memory.buffer.slice(O,O+M),y,o),qd._free(O);for(const w of Object.keys(l.attributes)){const P=d.GetAttributeByUniqueId(f,l.attributes[w]),N=o.json.accessors[h.attributes[w]],L=OG[N.componentType],D=N.count*d1[N.type]*Uw[N.componentType].BYTES_PER_ELEMENT,B=qd._malloc(D);d.GetAttributeDataArrayForAllPoints(f,P,qd[L],D,B),VL(qd.memory.buffer.slice(B,B+D),N,o),qd._free(B)}d.destroy(),f.destroy(),delete h.extensions[_T]}const Gw="EXT_meshopt_compression";function NG(h,o){if(!h.extensions||!h.extensions[Gw])return;const l=h.extensions[Gw],d=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);gT.decodeGltfBuffer(m,l.count,l.byteStride,d,l.mode,l.filter),h.buffer=o.buffers.length,h.byteOffset=0,o.buffers[h.buffer]=m.buffer,delete h.extensions[Gw]}const UL=1179937895,GL=new TextDecoder("utf8");function $L(h,o){return new URL(h,o).href}function kG(h,o,l,d){return fetch($L(h.uri,d)).then(m=>m.arrayBuffer()).then(m=>{o.buffers[l]=m})}function qL(h,o){const l=h.json.bufferViews[o];return new Uint8Array(h.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function FG(h,o,l,d){if(h.uri){const m=$L(h.uri,d);return fetch(m).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{o.images[l]=f})}if(h.bufferView!==void 0){const m=qL(o,h.bufferView),f=new Blob([m],{type:h.mimeType});return createImageBitmap(f).then(y=>{o.images[l]=y})}}function HL(h,o=0,l){const d={json:null,images:[],buffers:[]};if(new Uint32Array(h,o,1)[0]===UL){const w=new Uint32Array(h,o);let P=2;const N=(w[P++]>>2)-3,L=w[P++]>>2;if(P++,d.json=JSON.parse(GL.decode(w.subarray(P,P+L))),P+=L,P<N){const D=w[P++];P++;const B=o+(P<<2);d.buffers[0]=h.slice(B,B+D)}}else d.json=JSON.parse(GL.decode(new Uint8Array(h,o)));const{buffers:m,images:f,meshes:y,extensionsUsed:T,bufferViews:M}=d.json;let O=Promise.resolve();if(m){const w=[];for(let P=0;P<m.length;P++){const N=m[P];N.uri?w.push(kG(N,d,P,l)):d.buffers[P]||(d.buffers[P]=null)}O=Promise.all(w)}return O.then(()=>{const w=[],P=T&&T.includes(_T),N=T&&T.includes(Gw);if(P&&w.push(function(){if(!qd)return h1??(h1=function(L){let D,B=null;function q(){D=new Uint8Array(B.buffer)}function Z(){throw new Error("Unexpected Draco error.")}const re={a:{a:Z,d:function(ne,te,le){return D.copyWithin(ne,te,te+le)},c:function(ne){const te=D.length,le=Math.max(ne>>>0,Math.ceil(1.2*te)),fe=Math.ceil((le-te)/65536);try{return B.grow(fe),q(),!0}catch{return!1}},b:Z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,re):L.then(ne=>ne.arrayBuffer()).then(ne=>WebAssembly.instantiate(ne,re))).then(ne=>{const{Rb:te,Qb:le,P:fe,T:_e,X:Me,Ja:Ce,La:Te,Qa:Ge,Va:Ae,Wa:He,eb:Qe,jb:Je,f:st,e:rt,yb:dt,zb:lt,Ab:pt,Bb:kt,Db:Nt,Gb:hn}=ne.instance.exports;B=rt;const qt=(()=>{let Jt=0,Bt=0,An=0,un=0;return _n=>{An&&(te(un),te(Jt),Bt+=An,An=Jt=0),Jt||(Bt+=128,Jt=le(Bt));const zn=_n.length+7&-8;let sr=Jt;zn>=Bt&&(An=zn,sr=un=le(zn));for(let Un=0;Un<_n.length;Un++)D[sr+Un]=_n[Un];return sr}})();return q(),st(),{memory:rt,_free:te,_malloc:le,Mesh:class{constructor(){this.ptr=fe()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Ce()}destroy(){Je(this.ptr)}DecodeArrayToMesh(Jt,Bt,An){const un=qt(Jt),_n=Te(this.ptr,un,Bt,An.ptr);return!!Me(_n)}GetAttributeByUniqueId(Jt,Bt){return{ptr:Ge(this.ptr,Jt.ptr,Bt)}}GetTrianglesUInt16Array(Jt,Bt,An){Ae(this.ptr,Jt.ptr,Bt,An)}GetTrianglesUInt32Array(Jt,Bt,An){He(this.ptr,Jt.ptr,Bt,An)}GetAttributeDataArrayForAllPoints(Jt,Bt,An,un,_n){Qe(this.ptr,Jt.ptr,Bt.ptr,An,un,_n)}},DT_INT8:dt(),DT_UINT8:lt(),DT_INT16:pt(),DT_UINT16:kt(),DT_UINT32:Nt(),DT_FLOAT32:hn()}})}(fetch(BL())),h1.then(L=>{qd=L,h1=void 0}))}()),N&&w.push(function(){if(gT)return;const L=function(D){let B;const q=WebAssembly.instantiateStreaming(D,{}).then(ne=>{B=ne.instance,B.exports.__wasm_call_ctors()}),Z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},re={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(ne,te,le,fe,_e,Me){(function(Ce,Te,Ge,Ae,He,Qe,Je){const st=Ce.exports.sbrk,rt=Ae+3&-4,dt=st(rt*He),lt=st(Qe.length),pt=new Uint8Array(Ce.exports.memory.buffer);pt.set(Qe,lt);const kt=Te(dt,Ae,He,lt,Qe.length);if(kt===0&&Je&&Je(dt,rt,He),Ge.set(pt.subarray(dt,dt+Ae*He)),st(dt-st(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(B,B.exports[re[_e]],ne,te,le,fe,B.exports[Z[Me]])}}}(fetch(jL()));return L.ready.then(()=>{gT=L})}()),f)for(let L=0;L<f.length;L++)w.push(FG(f[L],d,L,l));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(P&&y)for(const{primitives:L}of y)for(const D of L)DG(D,d);if(N&&y&&M)for(const L of M)NG(L,d);return d})})}function Dy(h,o){const l=h.json.bufferViews[o.bufferView],d=Uw[o.componentType];return new d(h.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==d1[o.type]*d.BYTES_PER_ELEMENT?l.byteStride/d.BYTES_PER_ELEMENT:d1[o.type]))}function yT(h,o,l,d){const m=Uw[o.componentType],f=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),y=h.json.bufferViews[o.bufferView],T=y.byteStride?y.byteStride/m.BYTES_PER_ELEMENT:d1[o.type],M=l.float32,O=M.length/l.capacity;for(let w=0,P=0;w<o.count*T;w+=T,P+=O)for(let N=0;N<O;N++)M[P+N]=d[w+N]*f;l._trim()}function zG(h,o,l){const d=h.indices,m=h.attributes,f={};f.indexArray=new Qo;const y=o.json.accessors[d],T=y.count/3;f.indexArray.reserve(T);const M=Dy(o,y);for(let N=0;N<T;N++)f.indexArray.emplaceBack(M[3*N],M[3*N+1],M[3*N+2]);f.indexArray._trim(),f.vertexArray=new cl;const O=o.json.accessors[m.POSITION];f.vertexArray.reserve(O.count);const w=Dy(o,O);for(let N=0;N<O.count;N++)f.vertexArray.emplaceBack(w[3*N],w[3*N+1],w[3*N+2]);if(f.vertexArray._trim(),f.aabb=new mn(O.min,O.max),f.centroid=function(N,L){const D=[0,0,0],B=N.length;if(B>0){for(let q=0;q<B;q++){const Z=3*N[q];D[0]+=L[Z],D[1]+=L[Z+1],D[2]+=L[Z+2]}D[0]/=B,D[1]/=B,D[2]/=B}return D}(M,w),m.COLOR_0!==void 0){const N=o.json.accessors[m.COLOR_0],L=d1[N.type],D=Dy(o,N);f.colorArray=L===3?new cl:new Ah,f.colorArray.resize(N.count),yT(o,N,f.colorArray,D)}if(m.NORMAL!==void 0){f.normalArray=new cl;const N=o.json.accessors[m.NORMAL];f.normalArray.resize(N.count);const L=Dy(o,N);yT(o,N,f.normalArray,L)}if(m.TEXCOORD_0!==void 0&&l.length>0){f.texcoordArray=new Od;const N=o.json.accessors[m.TEXCOORD_0];f.texcoordArray.resize(N.count);const L=Dy(o,N);yT(o,N,f.texcoordArray,L)}if(m._FEATURE_ID_RGBA4444!==void 0){const N=o.json.accessors[m._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Dy(o,N))}m._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Dy(o,o.json.accessors[m._FEATURE_RGBA4444]).buffer));const P=h.material;return f.material=function(N,L){const{emissiveFactor:D=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:q=.5,normalTexture:Z,occlusionTexture:re,emissiveTexture:ne,doubleSided:te}=N,{baseColorFactor:le=[1,1,1,1],metallicFactor:fe=1,roughnessFactor:_e=1,baseColorTexture:Me,metallicRoughnessTexture:Ce}=N.pbrMetallicRoughness||{},Te=re?L[re.index]:void 0;if(re&&re.extensions&&re.extensions.KHR_texture_transform&&Te){const Ge=re.extensions.KHR_texture_transform;Te.offsetScale=[Ge.offset[0],Ge.offset[1],Ge.scale[0],Ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Fr(...le),metallicFactor:fe,roughnessFactor:_e,baseColorTexture:Me?L[Me.index]:void 0,metallicRoughnessTexture:Ce?L[Ce.index]:void 0},doubleSided:te,emissiveFactor:D,alphaMode:B,alphaCutoff:q,normalTexture:Z?L[Z.index]:void 0,occlusionTexture:Te,emissionTexture:ne?L[ne.index]:void 0,defined:N.defined===void 0}}(P!==void 0?o.json.materials[P]:{defined:!1},l),f}function WL(h,o,l){const{matrix:d,rotation:m,translation:f,scale:y,mesh:T,extras:M,children:O}=h,w={};if(w.matrix=d||we.mat4.fromRotationTranslationScale([],m||[0,0,0,1],f||[0,0,0],y||[1,1,1]),T!==void 0){w.meshes=l[T];const P=w.anchor=[0,0];for(const N of w.meshes){const{min:L,max:D}=N.aabb;P[0]+=L[0]+D[0],P[1]+=L[1]+D[1]}P[0]=Math.floor(P[0]/w.meshes.length/2),P[1]=Math.floor(P[1]/w.meshes.length/2)}if(M&&(M.id&&(w.id=M.id),M.lights&&(w.lights=function(P){if(!P.length)return[];const N=function(Z){const re=atob(Z),ne=new Uint8Array(re.length);for(let te=0;te<re.length;te++)ne[te]=re.codePointAt(te);return ne}(P),L=[],D=N.length/24,B=new Uint16Array(N.buffer),q=new Float32Array(N.buffer);for(let Z=0;Z<D;Z++){const re=B[2*Z*6]/30,ne=B[2*Z*6+1]/30,te=B[2*Z*6+10]/100,le=q[6*Z+1],fe=q[6*Z+2],_e=q[6*Z+3],Me=q[6*Z+4],Ce=_e-le,Te=Me-fe,Ge=Math.hypot(Ce,Te);L.push({pos:[le+.5*Ce,fe+.5*Te,ne],normal:[Te/Ge,-Ce/Ge,0],width:Ge,height:re,depth:te,points:[le,fe,_e,Me]})}return L}(M.lights))),O){const P=[];for(const N of O)P.push(WL(o.json.nodes[N],o,l));w.children=P}return w}function BG(h){if(h.vertices.length===0||h.indices.length===0)return null;const o=new CC(h.vertices,h.indices,8,256),[l,d]=[o.min.clone(),o.max.clone()];return{vertices:h.vertices,indices:h.indices,grid:o,min:l,max:d}}function jG(h){if(!h.extras||!h.extras.ground)return null;const o=h.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const l=o[0];if(!l||!Array.isArray(l)||l.length===0)return null;const d=[];for(const y of l){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],M=y[1];typeof T=="number"&&typeof M=="number"&&d.push(new Gt(T,M))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let m=0;for(let y=0;y<d.length;y++){const T=d[y],M=d[(y+1)%d.length],O=d[(y+2)%d.length];m+=(T.x-M.x)*(O.y-M.y)-(O.x-M.x)*(T.y-M.y)}m>0&&d.reverse();const f=Jg(d.flatMap(y=>[y.x,y.y]),[]);return f.length===0?null:{vertices:d,indices:f}}function VG(h,o){const l=[],d=[];let m=0;const f=[];for(const y of h){m=l.length;const T=y.vertexArray.float32,M=y.indexArray.uint16;for(let O=0;O<y.vertexArray.length;O++)f[0]=T[3*O+0],f[1]=T[3*O+1],f[2]=T[3*O+2],we.vec3.transformMat4(f,f,o),l.push(new Gt(f[0],f[1]));for(let O=0;O<3*y.indexArray.length;O++)d.push(M[O]+m)}if(d.length%3!=0)return null;for(let y=0;y<d.length;y+=3){const T=l[d[y+0]],M=l[d[y+1]],O=l[d[y+2]];(T.x-M.x)*(O.y-M.y)-(O.x-M.x)*(T.y-M.y)>0&&([d[y+1],d[y+2]]=[d[y+2],d[y+1]])}return{vertices:l,indices:d}}function XL(h){const o=function(M,O){const w=[],P=WebGL2RenderingContext;if(M.json.textures)for(const N of M.json.textures){const L={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};N.sampler!==void 0&&Object.assign(L,M.json.samplers[N.sampler]),w.push({image:O[N.source],sampler:L,uploaded:!1})}return w}(h,h.images),l=function(M,O){const w=[];for(const P of M.json.meshes){const N=[];for(const L of P.primitives)N.push(zG(L,M,O));w.push(N)}return w}(h,o),{scenes:d,scene:m,nodes:f}=h.json,y=d?d[m||0].nodes:f,T=[];for(const M of y)T.push(WL(f[M],h,l));return function(M,O,w){const P={},N=new Set;for(let L=0;L<M.length;L++){const D=w[O[L]];if(!D.extras)continue;const B=D.extras["mapbox:footprint:version"],q=D.extras["mapbox:footprint:id"];(B||q)&&N.add(L),B==="1.0.0"&&q&&(P[q]=L)}for(let L=0;L<M.length;L++){if(N.has(L))continue;const D=M[L],B=w[O[L]];if(!B.extras)continue;let q=null;D.id in P&&(q=VG(M[P[D.id]].meshes,D.matrix)),q||(q=jG(B)),q&&(D.footprint=BG(q))}if(N.size>0){const L=Array.from(N.values()).sort((D,B)=>D-B);for(let D=L.length-1;D>=0;D--)M.splice(L[D],1)}}(T,y,h.json.nodes),T}function UG(h){h.heightmap=new Float32Array(4096),h.heightmap.fill(-1);const o=h.vertexArray.float32,l=h.aabb.min[0]-1,d=h.aabb.min[1]-1,m=Ry/(h.aabb.max[0]-l+2),f=Ry/(h.aabb.max[1]-d+2);for(let y=0;y<o.length;y+=3){const T=o[y+2],M=(o[y+0]-l)*m|0,O=(o[y+1]-d)*f|0;T>h.heightmap[O*Ry+M]&&(h.heightmap[O*Ry+M]=T)}}function GG(h,o){const l={};l.indexArray=new Qo,l.indexArray.reserve(4*h.length),l.vertexArray=new cl,l.vertexArray.reserve(10*h.length),l.colorArray=new Ah,l.vertexArray.reserve(10*h.length);let d=0;for(const y of h){const T=Math.min(10,Math.max(4,1.3*y.height))*o,M=[-y.normal[1],y.normal[0],0],O=Math.min(.29,.1*y.width/y.depth),w=y.width-2*y.depth*o*(O+.01),P=we.vec3.scaleAndAdd([],y.pos,M,w/2),N=we.vec3.scaleAndAdd([],y.pos,M,-w/2),L=[P[0],P[1],P[2]+y.height],D=[N[0],N[1],N[2]+y.height],B=we.vec3.scaleAndAdd([],y.normal,M,O);we.vec3.scale(B,B,T);const q=we.vec3.scaleAndAdd([],y.normal,M,-O);we.vec3.scale(q,q,T),we.vec3.add(B,P,B),we.vec3.add(q,N,q),P[2]+=.1,N[2]+=.1,l.vertexArray.emplaceBack(B[0],B[1],B[2]),l.vertexArray.emplaceBack(q[0],q[1],q[2]),l.vertexArray.emplaceBack(P[0],P[1],P[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(L[0],L[1],L[2]),l.vertexArray.emplaceBack(D[0],D[1],D[2]),l.vertexArray.emplaceBack(P[0],P[1],P[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(B[0],B[1],B[2]),l.vertexArray.emplaceBack(q[0],q[1],q[2]);const Z=w/T/2;l.colorArray.emplaceBack(-Z-O,-1,Z,.8),l.colorArray.emplaceBack(Z+O,-1,Z,.8),l.colorArray.emplaceBack(-Z,0,Z,1.3),l.colorArray.emplaceBack(Z,0,Z,1.3),l.colorArray.emplaceBack(Z+O,-.8,Z,.7),l.colorArray.emplaceBack(Z+O,-.8,Z,.7),l.colorArray.emplaceBack(0,0,Z,1.3),l.colorArray.emplaceBack(0,0,Z,1.3),l.colorArray.emplaceBack(Z+O,-1.2,Z,.8),l.colorArray.emplaceBack(Z+O,-1.2,Z,.8),l.indexArray.emplaceBack(6+d,4+d,8+d),l.indexArray.emplaceBack(7+d,9+d,5+d),l.indexArray.emplaceBack(0+d,1+d,2+d),l.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const m={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Fr.white,m.pbrMetallicRoughness=f,l.material=m,l.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class ZL{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const $G=["id","tile","layer","source","sourceLayer","state"];class s0{constructor(o,l,d,m,f){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=m,this.properties=o.properties,this.id=f}clone(){const o=new s0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of $G)this[l]!==void 0&&(o[l]=this[l]);return o}}class YL{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Is(Qt,16,0),this.featureIndexArray=new Ba,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,l,d,m,f,y=0,T=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,m,f,y);const O=this.grid;for(let w=0;w<l.length;w++){const P=l[w],N=[1/0,1/0,-1/0,-1/0];for(let L=0;L<P.length;L++){const D=P[L];N[0]=Math.min(N[0],D.x),N[1]=Math.min(N[1],D.y),N[2]=Math.max(N[2],D.x),N[3]=Math.max(N[3],D.y)}T!==0&&(N[0]-=T,N[1]-=T,N[2]+=T,N[3]+=T),N[0]<Qt&&N[1]<Qt&&N[2]>=0&&N[3]>=0&&O.insert(M,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qg.VectorTile(new cw(this.rawTileData)).layers,this.sourceLayerCoder=new ZL(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l){const{tilespaceGeometry:d,transform:m,tileTransform:f,pixelPosMatrix:y,availableImages:T}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const M=d.bufferedTilespaceBounds,O=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(L,D,B,q)=>ze(d.bufferedTilespaceGeometry,L,D,B,q));O.sort(qG);let w=null;m.elevation&&O.length>0&&(w=Qv.create(m.elevation,this.tileID));const P={};let N;for(let L=0;L<O.length;L++){const D=O[L];if(D===N)continue;N=D;const B=this.featureIndexArray.get(D);let q=null;this.is3DTile?this.loadMatchingModelFeature(P,B,o,d,m):this.loadMatchingFeature(P,B,o,T,(Z,re,ne,te=0)=>(q||(q=U(Z,this.tileID.canonical,f)),re.queryIntersectsFeature(d,Z,ne,q,this.z,m,y,w,te)))}return P}loadMatchingFeature(o,l,d,m,f){const{featureIndex:y,bucketIndex:T,sourceLayerIndex:M,layoutVertexArrayOffset:O}=l,w=this.bucketLayerIDs[T],P=d.layers,N=Object.keys(P);if(N.length&&!function(Z,re){for(let ne=0;ne<Z.length;ne++)if(re.indexOf(Z[ne])>=0)return!0;return!1}(N,w))return;const L=d.sourceCache,D=this.sourceLayerCoder.decode(M),B=this.vtLayers[D].feature(y),q=this.getId(B,D);for(let Z=0;Z<w.length;Z++){const re=w[Z];if(!P[re])continue;const{styleLayer:ne,targets:te}=P[re];let le={};q!==void 0&&(le=L.getFeatureState(ne.sourceLayer,q));const fe=!f||f(B,ne,le,O);if(!fe)continue;const _e=new s0(B,this.z,this.x,this.y,q);_e.tile=this.tileID.canonical,_e.state=le;let Me=this.serializedLayersCache.get(re);Me||(Me=ne.serialize(),Me.id=re,this.serializedLayersCache.set(re,Me)),_e.source=Me.source,_e.sourceLayer=Me["source-layer"],_e.layer=Mo({},Me),_e.layer.paint=KL(Me.paint,ne.paint,B,le,m),_e.layer.layout=KL(Me.layout,ne.layout,B,le,m);let Ce=!1;for(const Te of te){this.updateFeatureProperties(_e,Te);const{filter:Ge}=Te;if(Ge){if(B.properties=_e.properties,Ge.needGeometry){const Ae=$(B,!0);if(!Ge.filter(new ei(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!Ge.filter(new ei(this.tileID.overscaledZ),B))continue}Ce=!0,Te.targetId&&this.addFeatureVariant(_e,Te)}Ce&&this.appendToResult(o,re,y,_e,fe)}}loadMatchingModelFeature(o,l,d,m,f){const y=this.bucketLayerIDs[0][0],T=d.layers;if(!T[y])return;const{styleLayer:M,targets:O}=T[y];if(M.type!=="model")return;const w=m.tile,P=l.featureIndex,N=w.getBucket(M);if(!(N&&N instanceof Lw))return;const L=function(Me,Ce,Te,Ge){const Ae=Me.getNodesInfo()[Ce];if(Ae.hiddenByReplacement||!Ae.node.meshes)return;let He=Number.MAX_VALUE;const Qe=Ae.node,Je=Te.tile,st=Ge.calculatePosMatrix(Je.tileID.toUnwrapped(),Ge.worldSize),rt=Ae.evaluatedScale;let dt=0;Ge.elevation&&Qe.elevation&&(dt=Qe.elevation*Ge.elevation.exaggeration()),we.mat4.translate(st,st,[(Qe.anchor?Qe.anchor[0]:0)*(rt[0]-1),(Qe.anchor?Qe.anchor[1]:0)*(rt[1]-1),dt]),we.mat4.scale(st,st,rt);const lt=Te.queryGeometry,pt=lt.isPointQuery()?lt.screenBounds:lt.screenGeometry,kt=function(hn){const qt=we.mat4.multiply([],st,hn.matrix);we.mat4.multiply(qt,Ge.expandedFarZProjMatrix,qt);for(let Jt=0;Jt<hn.meshes.length;++Jt){const Bt=hn.meshes[Jt];if(Jt===hn.lightMeshIndex)continue;const An=XR(pt,Ge,qt,Bt.aabb);An!=null&&(He=Math.min(An,He))}if(hn.children)for(const Jt of hn.children)kt(Jt)};if(kt(Qe),He===Number.MAX_VALUE)return;const Nt=new zr(0,0);return sL(Je.tileID.canonical,Nt,Ae.node.anchor[0],Ae.node.anchor[1]),{intersectionZ:He,position:Nt,feature:Ae.feature}}(N,P,m,f);if(!L)return;const{z:D,x:B,y:q}=w.tileID.canonical,{feature:Z,intersectionZ:re,position:ne}=L;let te={};Z.id!==void 0&&(te=d.sourceCache.getFeatureState(M.sourceLayer,Z.id));const le=new s0({},D,B,q,Z.id);le.tile=this.tileID.canonical,le.state=te,le.properties=Z.properties,le.geometry={type:"Point",coordinates:[ne.lng,ne.lat]};let fe=this.serializedLayersCache.get(y);fe||(fe=M.serialize(),fe.id=y,this.serializedLayersCache.set(y,fe)),le.source=fe.source,le.sourceLayer=fe["source-layer"],le.layer=Mo({},fe);let _e=!1;for(const Me of O){this.updateFeatureProperties(le,Me);const{filter:Ce}=Me;if(Ce){if(Z.properties=le.properties,Ce.needGeometry){if(!Ce.filter(new ei(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!Ce.filter(new ei(this.tileID.overscaledZ),Z))continue}_e=!0,Me.targetId&&this.addFeatureVariant(le,Me)}_e&&this.appendToResult(o,y,P,le,re)}updateFeatureProperties(o,l,d){if(l.properties){const m={};for(const f in l.properties){const y=l.properties[f].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,d);y!=null&&(m[f]=y)}o.properties=m}}addFeatureVariant(o,l,d){const m={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(m.properties=o.properties),o.variants=o.variants||{},o.variants[l.targetId]=o.variants[l.targetId]||[],o.variants[l.targetId].push(m)}appendToResult(o,l,d,m,f){let y=o[l];y===void 0&&(y=o[l]=[]),y.push({featureIndex:d,feature:m,intersectionZ:f})}lookupSymbolFeatures(o,l,d,m,f){const y={};this.loadVTLayers();for(const T of o)this.loadMatchingFeature(y,{bucketIndex:l,sourceLayerIndex:d,featureIndex:T,layoutVertexArrayOffset:0},m,f);return y}loadFeature(o){const{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();const m=this.sourceLayerCoder.decode(d),f=this.vtFeatures[m];if(f[l])return f[l];const y=this.vtLayers[m].feature(l);return f[l]=y,y}hasLayer(o){for(const l of this.bucketLayerIDs)for(const d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const f=wh(m);if(f.result!=="success"){const y=f.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void vi(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new mg),d=this.promoteIdExpression.evaluate({zoom:0},o)}else d=o.properties[m];typeof d=="boolean"&&(d=Number(d))}return d}}function KL(h,o,l,d,m){return Du(h,(f,y)=>{const T=o instanceof Ol?o.get(y):null;return T&&T.evaluate?T.evaluate(l,d,m):T})}function qG(h,o){return o-h}on(YL,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const JL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vT{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(o,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=d>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const f=JL[15&d];if(!f)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(o,2,1),[T]=new Uint32Array(o,4,1);return new vT(T,y,f,o)}constructor(o,l=64,d=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const f=JL.indexOf(this.ArrayType),y=2*o*this.ArrayType.BYTES_PER_ELEMENT,T=o*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-T%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${d}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+M,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+M),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+M,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return xT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:T}=this,M=[0,f.length-1,0],O=[];for(;M.length;){const w=M.pop()||0,P=M.pop()||0,N=M.pop()||0;if(P-N<=T){for(let q=N;q<=P;q++){const Z=y[2*q],re=y[2*q+1];Z>=o&&Z<=d&&re>=l&&re<=m&&O.push(f[q])}continue}const L=N+P>>1,D=y[2*L],B=y[2*L+1];D>=o&&D<=d&&B>=l&&B<=m&&O.push(f[L]),(w===0?o<=D:l<=B)&&(M.push(N),M.push(L-1),M.push(1-w)),(w===0?d>=D:m>=B)&&(M.push(L+1),M.push(P),M.push(1-w))}return O}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:f,nodeSize:y}=this,T=[0,m.length-1,0],M=[],O=d*d;for(;T.length;){const w=T.pop()||0,P=T.pop()||0,N=T.pop()||0;if(P-N<=y){for(let q=N;q<=P;q++)eO(f[2*q],f[2*q+1],o,l)<=O&&M.push(m[q]);continue}const L=N+P>>1,D=f[2*L],B=f[2*L+1];eO(D,B,o,l)<=O&&M.push(m[L]),(w===0?o-d<=D:l-d<=B)&&(T.push(N),T.push(L-1),T.push(1-w)),(w===0?o+d>=D:l+d>=B)&&(T.push(L+1),T.push(P),T.push(1-w))}return M}}function xT(h,o,l,d,m,f){if(m-d<=l)return;const y=d+m>>1;QL(h,o,y,d,m,f),xT(h,o,l,d,y-1,1-f),xT(h,o,l,y+1,m,1-f)}function QL(h,o,l,d,m,f){for(;m>d;){if(m-d>600){const O=m-d+1,w=l-d+1,P=Math.log(O),N=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*N*(O-N)/O)*(w-O/2<0?-1:1);QL(h,o,l,Math.max(d,Math.floor(l-w*N/O+L)),Math.min(m,Math.floor(l+(O-w)*N/O+L)),f)}const y=o[2*l+f];let T=d,M=m;for(f1(h,o,d,l),o[2*m+f]>y&&f1(h,o,d,m);T<M;){for(f1(h,o,T,M),T++,M--;o[2*T+f]<y;)T++;for(;o[2*M+f]>y;)M--}o[2*d+f]===y?f1(h,o,d,M):(M++,f1(h,o,M,m)),M<=l&&(d=M+1),l<=M&&(m=M-1)}}function f1(h,o,l,d){bT(h,l,d),bT(o,2*l,2*d),bT(o,2*l+1,2*d+1)}function bT(h,o,l){const d=h[o];h[o]=h[l],h[l]=d}function eO(h,o,l,d){const m=h-l,f=o-d;return m*m+f*f}i.$=xs,i.A=Us,i.B=eu,i.C=Gi,i.D=e0,i.E=tl,i.F=2,i.G=Zx,i.H=aR,i.I=Gs,i.J=class extends Aw{},i.K=Ml,i.L=fr,i.M=dy,i.N=qs,i.O=Ri,i.P=Gt,i.Q=Ts,i.R=mo,i.S=Id,i.T=JC,i.U=Dl,i.V=Aw,i.W=Hu,i.X=wh,i.Y=wd,i.Z=Rl,i._=ru,i.a=function(h){return ge.API_CDN_URL_REGEX.test(h)},i.a$=$,i.a0=La,i.a1=Xu,i.a2=qu,i.a3=ou,i.a4=function(h){const o=h.value;let l=[];if(!o)return l;const d=Ml(o);return d!=="string"?(l=l.concat([new Aw(h.key,o,`string expected, "${d}" found`)]),l):(YR(o,!0)||(l=l.concat([new Aw(h.key,o,`invalid url "${o}"`)])),l)},i.a5=ft,i.a6=gm,i.a7=li,i.a8=Xt,i.a9=class{constructor(h){this.specification=h}possiblyEvaluate(h,o){return ku(h.expression.evaluate(o))}interpolate(h,o,l){return{x:Sn(h.x,o.x,l),y:Sn(h.y,o.y,l),z:Sn(h.z,o.z,l),azimuthal:Sn(h.azimuthal,o.azimuthal,l),polar:Sn(h.polar,o.polar,l)}}},i.aA=function(h,o){const l={};for(let d=0;d<o.length;d++){const m=o[d];m in h&&(l[m]=h[m])}return l},i.aB=mu,i.aC=es,i.aD=class{constructor(h){this.entries={},this.scheduler=h}request(h,o,l,d){const m=this.entries[h]=this.entries[h]||{callbacks:[]};if(m.result){const[f,y]=m.result;return this.scheduler?this.scheduler.add(()=>{d(f,y)},o):d(f,y),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=l((f,y)=>{m.result=[f,y];for(const T of m.callbacks)this.scheduler?this.scheduler.add(()=>{T(f,y)},o):T(f,y);setTimeout(()=>delete this.entries[h],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(f=>f!==d),m.callbacks.length||(m.cancel(),delete this.entries[h]))}}},i.aE=function(h,o,l){const d=JSON.stringify(h.request);return h.data&&(this.deduped.entries[d]={result:[null,h.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:h.isSymbolTile,zoom:h.tileZoom},m=>{const f=Fu(h.request,(y,T,M,O)=>{y?m(y):T&&m(null,{vectorTile:l?void 0:new Qg.VectorTile(new cw(T)),rawData:T,cacheControl:M,expires:O})});return()=>{f.cancel(),m()}},o)},i.aF=function(h){Zr++,Zr>Zn&&(h.getActor().send("enforceCacheSizeLimit",Gn),Zr=0)},i.aG=function(h){return h<=1?1:Math.pow(2,Math.floor(Math.log(h)/Math.LN2))},i.aH=Lt,i.aI=FR,i.aJ=GR,i.aK=kR,i.aL=function(h,o){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<h.length;d++){const m=document.createElement("source");X_(h[d])||(l.crossOrigin="Anonymous"),m.src=h[d],l.appendChild(m)}return{cancel:()=>{}}},i.aM=Cw,i.aN=function(h){return fetch(h).then(o=>o.arrayBuffer()).then(o=>HL(o,0,h))},i.aO=XL,i.aP=class{constructor(h,o,l,d){this.id=h,this.position=o!=null?new zr(o[0],o[1]):new zr(0,0),this.orientation=l??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(h,o){if(we.mat4.multiply(h.matrix,o,h.matrix),h.meshes)for(const l of h.meshes){const d=mn.applyTransformFast(l.aabb,h.matrix);this.aabb.encapsulate(d)}if(h.children)for(const l of h.children)this._applyTransformations(l,h.matrix)}computeBoundsAndApplyParent(){const h=we.mat4.identity([]);for(const o of this.nodes)this._applyTransformations(o,h)}computeModelMatrix(h,o,l,d,m,f,y=!1){tL(this.matrix,this,h.transform,this.position,o,l,d,m,f,y)}upload(h){if(!this.uploaded){for(const o of this.nodes)rT(o,h);for(const o of this.nodes)Rw(o);this.uploaded=!0}}destroy(){for(const h of this.nodes)iT(h)}},i.aQ=bl,i.aR=Kx,i.aS=Va,i.aT=go,i.aU=ul,i.aV=Qo,i.aW=jo,i.aX=Pm,i.aY=Sw,i.aZ=function(){da.isLoading()||da.isLoaded()||Rc()!=="deferred"||hy()},i.a_=Kf,i.aa=ei,i.ab=Wf,i.ac=s,i.ad=we,i.ae=_s,i.af=Ol,i.ag=_a,i.ah=Sn,i.ai=Qt,i.aj=xc,i.ak=cr,i.al=Fr,i.am=class{constructor(h){this.specification=h}possiblyEvaluate(h,o){return function([l,d]){const m=ku([1,l,d]);return{x:m.x,y:m.y,z:m.z}}(h.expression.evaluate(o))}interpolate(h,o,l){return{x:Sn(h.x,o.x,l),y:Sn(h.y,o.y,l),z:Sn(h.z,o.z,l)}}},i.an=function(h,o,l=0,d=!0){const m=new Gt(l,l),f=h.sub(m),y=o.add(m),T=[f,new Gt(y.x,f.y),y,new Gt(f.x,y.y)];return d&&T.push(f.clone()),T},i.ao=function(h,o){const l=[];for(let d=0;d<h.length;d++){const m=Pa(d-1,-1,h.length-1),f=Pa(d+1,-1,h.length-1),y=h[d],T=h[f],M=h[m].sub(y).unit(),O=T.sub(y).unit(),w=O.angleWithSep(M.x,M.y),P=M.add(O).unit().mult(-1*o/Math.sin(w/2));l.push(y.add(P))}return l},i.ap=wR,i.aq=ze,i.ar=function(h,o,l=0){return we.vec3.fromValues(((o.x-l)*h.scale-h.x)*Qt,(o.y*h.scale-h.y)*Qt,ap(o.z,o.y))},i.as=Mn,i.at=kA,i.au=function(h){let o=1/0,l=1/0,d=-1/0,m=-1/0;for(const f of h)o=Math.min(o,f.x),l=Math.min(l,f.y),d=Math.max(d,f.x),m=Math.max(m,f.y);return{min:new Gt(o,l),max:new Gt(d,m)}},i.av=ga,i.aw=Ne,i.ax=g,i.ay=er,i.az=ws,i.b=function(h){return ge.API_FONTS_REGEX.test(h)},i.b$=Mw,i.b0=s0,i.b1=sa,i.b2=RC,i.b3=EC,i.b4=U,i.b5=eo,i.b6=Tm,i.b7=vn,i.b8=xi,i.b9=Jg,i.bA=pA,i.bB=UC,i.bC=mR,i.bD=BC,i.bE=vT,i.bF=Pa,i.bG=Lr,i.bH=us,i.bI=function(h,o,l){h[4*o+0]=l[0],h[4*o+1]=l[1],h[4*o+2]=l[2],h[4*o+3]=l[3]},i.bJ=op,i.bK=hl,i.bL=Nd,i.bM=to,i.bN=ip,i.bO=zr,i.bP=IR,i.bQ=xt,i.bR=Nn,i.bS=qR,i.bT=Rt,i.bU=Ls,i.bV=function(h,o,l,d,m,f,y,T,M){if(M.name==="globe")return Ls(h,o,new Rt(l,d,m),!1);const O=Kx({z:l,x:d,y:m},M);return new mn([(f+O.x/O.scale)*o,o*(O.y/O.scale),y],[(f+O.x2/O.scale)*o,o*(O.y2/O.scale),T])},i.bW=function(h,o,l){let d=0;for(let m=0;m<2;++m)h[m]>0&&(d+=(h[m]-0)*(h[m]-0)),o[m]<0&&(d+=(0-o[m])*(0-o[m]));return d},i.bX=Rs,i.bY=Om,i.bZ=function(h){const o=we.mat4.identity(new Float64Array(16));we.mat4.multiply(o,h.pixelMatrix,h.globeMatrix);const l=[0,ma,0],d=[0,ja,0];return we.vec3.transformMat4(l,l,o),we.vec3.transformMat4(d,d,o),[l[0]>0&&l[0]<=h.width&&l[1]>0&&l[1]<=h.height&&!ya(h,new zr(h.center.lat,90)),d[0]>0&&d[0]<=h.width&&d[1]>0&&d[1]<=h.height&&!ya(h,new zr(h.center.lat,-90))]},i.b_=function(h,o){const{scale:l}=h.tileTransform,d=l*Qt/(h.tileSize*Math.pow(2,o.zoom-h.tileID.overscaledZ+h.tileID.canonical.z));return we.mat2.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[d,d])},i.ba=ZC,i.bb=function(h,o){const l=_a(o.zoom);if(l===0)return _o(h);const d=Or(h),m=bi(d),f=ga(d.getWest())*o.worldSize,y=ga(d.getEast())*o.worldSize,T=es(d.getNorth())*o.worldSize,M=es(d.getSouth())*o.worldSize,O=[f,T,0],w=[y,T,0],P=[f,M,0],N=[y,M,0],L=we.mat4.invert([],o.globeMatrix);return we.vec3.transformMat4(O,O,L),we.vec3.transformMat4(w,w,L),we.vec3.transformMat4(P,P,L),we.vec3.transformMat4(N,N,L),m[0]=yo(m[0],P,l),m[1]=yo(m[1],N,l),m[2]=yo(m[2],w,l),m[3]=yo(m[3],O,l),mn.fromPoints(m)},i.bc=oi,i.bd=kr,i.be=yo,i.bf=Lc,i.bg=kn,i.bh=Vw,i.bi=cw,i.bj=Fu,i.bk=function(h,o){const l=[];for(const d in h)d in o||l.push(d);return l},i.bl=Kl,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=Io,i.bo=function(h,o){const{x:l,y:d}=h.point,m=dl(l,d,h.worldSize/h._pixelsPerMercatorPixel,0,0);return we.mat4.multiply(m,m,vo(_o(o)))},i.bp=Hv,i.bq=_u,i.br=uw,i.bs=function(h,o,l,d,m){const f=5*o+2;h.float32[f+0]=l,h.float32[f+1]=d,h.float32[f+2]=m},i.bt=ww,i.bu=sR,i.bv=pe,i.bw=Zs,i.bx=lA,i.by=ZR,i.bz=fA,i.c=ke,i.c$=jA,i.c0=$R,i.c1=function(h){const o=$R(h,!0);return we.mat2.invert([],[o[0],o[1],o[4],o[5]])},i.c2=Hn,i.c3=function(h){const{x:o,y:l}=h.point,{lng:d,lat:m}=h._center;return dl(o,l,h.worldSize,d,m)},i.c4=Yr,i.c5=en,i.c6=Fd,i.c7=function(h){const o=Math.round((h+45+360)%360/90)%4;return Bs[o]},i.c8=45,i.c9=Tf,i.cA=pa,i.cB=class extends du{constructor(h){super(h),this.current=qg}set(h,o,l){if(this.fetchUniformLocation(h,o)){for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},i.cC=Ia,i.cD=function(h,o,l){const d=_a(l.zoom),m=h.style.map._antialias,f=h.terrain&&h.terrain.exaggeration()>0;return d===0&&!m&&!f},i.cE=function(h){const o=h.pixelsPerMeter,l=o/us(1,h.center.lat),d=we.mat4.identity(new Float64Array(16));return we.mat4.translate(d,d,[h.point.x,h.point.y,0]),we.mat4.scale(d,d,[l,l,o]),Float32Array.from(d)},i.cF=Or,i.cG=function(h){const o=Rs-5;h=er(h,-80.051129,o)/o*90;const l=Math.pow(Math.abs(Math.sin(cr(h))),3);return Math.round(l*(Dm.length-1))},i.cH=function(h,o,l,d){const m=o.getNorth(),f=o.getSouth(),y=o.getWest(),T=o.getEast(),M=1<<h.z,O=T-y,w=m-f,P=O/sp,N=-w/Dm[l],L=[0,P,0,N,0,0,m,y,0];if(h.z>0){const D=180/d;we.mat3.multiply(L,L,[D/O+1,0,0,0,D/w+1,0,-.5*D/P,.5*D/N,1])}return L[2]=M,L[5]=h.x,L[8]=h.y,L},i.cI=_o,i.cJ=function(h,o,l){const d=we.mat4.identity(new Float64Array(16)),m=(o/(1<<h)-.5)*Math.PI*2;return we.mat4.rotateY(d,l.globeMatrix,m),Float32Array.from(d)},i.cK=class{isDataAvailableAtPoint(h){const o=this._source();if(this.isUsingMockSource()||!o||h.y<0||h.y>1)return!1;const l=o.getSource().maxzoom,d=1<<l,m=Math.floor(h.x),f=Math.floor((h.x-m)*d),y=Math.floor(h.y*d),T=this.findDEMTileFor(new Lt(l,m,l,f,y));return!(!T||!T.dem)}getAtPointOrZero(h,o=0){return this.getAtPoint(h,o)||0}getAtPoint(h,o,l=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const d=this._source();if(!d||h.y<0||h.y>1)return o;const m=d.getSource().maxzoom,f=1<<m,y=Math.floor(h.x),T=h.x-y,M=new Lt(m,y,m,Math.floor(T*f),Math.floor(h.y*f)),O=this.findDEMTileFor(M);if(!O||!O.dem)return o;const w=O.dem,P=1<<O.tileID.canonical.z,N=(T*P-O.tileID.canonical.x)*w.dim,L=(h.y*P-O.tileID.canonical.y)*w.dim,D=Math.floor(N),B=Math.floor(L);return(l?this.exaggeration():1)*Sn(Sn(w.get(D,B),w.get(D,B+1),L-B),Sn(w.get(D+1,B),w.get(D+1,B+1),L-B),N-D)}getAtTileOffset(h,o,l){const d=1<<h.canonical.z;return this.getAtPointOrZero(new s(h.wrap+(h.canonical.x+o/Qt)/d,(h.canonical.y+l/Qt)/d))}getAtTileOffsetFunc(h,o,l,d){return m=>{const f=this.getAtTileOffset(h,m.x,m.y),y=d.upVector(h.canonical,m.x,m.y),T=d.upVectorScale(h.canonical,o,l).metersToTile;return we.vec3.scale(y,y,f*T),y}}getForTilePoints(h,o,l,d){if(this.isUsingMockSource())return!1;const m=Qv.create(this,h,d);return!!m&&(o.forEach(f=>{f[2]=this.exaggeration()*m.getElevationAt(f[0],f[1],l)}),!0)}getMinMaxForTile(h){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(h);if(!o||!o.dem)return null;const l=o.dem.tree,d=o.tileID,m=1<<h.canonical.z-d.canonical.z;let f=h.canonical.x/m-d.canonical.x,y=h.canonical.y/m-d.canonical.y,T=0;for(let M=0;M<h.canonical.z-d.canonical.z&&!l.leaves[T];M++){f*=2,y*=2;const O=2*Math.floor(y)+Math.floor(f);T=l.childOffsets[T]+O,f%=1,y%=1}return{min:this.exaggeration()*l.minimums[T],max:this.exaggeration()*l.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(h,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(h){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(h){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const h=this.visibleDemTiles;if(h.length===0)return null;let o=!1,l=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const m of h){const f=this.getMinMaxForTile(m.tileID);f&&(l=Math.min(l,f.min),d=Math.max(d,f.max),o=!0)}return o?{min:l,max:d}:null}},i.cL=ew,i.cM=_r,i.cN=function(h,o){return[Math.pow(h[0],2.2)*o,Math.pow(h[1],2.2)*o,Math.pow(h[2],2.2)*o]},i.cO=Ua,i.cP=wt,i.cQ=Xo,i.cR=256,i.cS=function(h,o){const l=[0,0,0],d=oi(_o(o.canonical));return we.vec3.transformMat4(l,l,d),we.vec3.transformMat4(l,l,h),l},i.cT=h=>({u_camera_to_center_distance:new to(h),u_extrude_scale:new Hg(h),u_device_pixel_ratio:new to(h),u_matrix:new op(h),u_inv_rot_matrix:new op(h),u_merc_center:new hl(h),u_tile_id:new Nd(h),u_zoom_transition:new to(h),u_up_dir:new Nd(h),u_emissive_strength:new to(h)}),i.cU=h=>({u_matrix:new op(h),u_pixels_to_tile_units:new Hg(h),u_device_pixel_ratio:new to(h),u_width_scale:new to(h),u_floor_width_scale:new to(h),u_units_to_pixels:new hl(h),u_dash_image:new ip(h),u_gradient_image:new ip(h),u_image_height:new to(h),u_texsize:new hl(h),u_tile_units_to_pixels:new to(h),u_alpha_discard_threshold:new to(h),u_trim_offset:new hl(h),u_trim_fade_range:new hl(h),u_trim_color:new Lm(h),u_emissive_strength:new to(h),u_zbias_factor:new to(h),u_tile_to_meter:new to(h)}),i.cV=h=>({u_matrix:new op(h),u_texsize:new hl(h),u_pixels_to_tile_units:new Hg(h),u_device_pixel_ratio:new to(h),u_width_scale:new to(h),u_floor_width_scale:new to(h),u_image:new ip(h),u_units_to_pixels:new hl(h),u_tile_units_to_pixels:new to(h),u_alpha_discard_threshold:new to(h),u_trim_offset:new hl(h),u_trim_fade_range:new hl(h),u_trim_color:new Lm(h),u_emissive_strength:new to(h),u_zbias_factor:new to(h),u_tile_to_meter:new to(h)}),i.cW=Fg,i.cX=WU,i.cY=XU,i.cZ=lp,i.c_=(h,o,l,d,m,f)=>{const y=h.transform,T=y.projection.name==="globe";let M;if(f.paint.get("circle-pitch-alignment")==="map")if(T){const w=Ua(y.zoom,o.canonical)*y._pixelsPerMercatorPixel;M=Float32Array.from([w,0,0,w])}else M=y.calculatePixelsToTileUnitsMatrix(l);else M=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:h.transform.getCameraToCenterDistance(y.projection),u_matrix:h.translatePosMatrix(o.projMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Et.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:Nm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(T){O.u_inv_rot_matrix=d,O.u_merc_center=m,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=_a(y.zoom);const w=m[0]*Qt,P=m[1]*Qt;O.u_up_dir=y.projection.upVector(new Rt(0,0,0),w,P)}return O},i.ca=$n,i.cb=Lm,i.cc=function(h,o,l){const d=Math.sqrt(h*h+o*o+l*l),m=d>0?Math.acos(l/d)*Ji:0;let f=h!==0||o!==0?Math.atan2(-o,-h)*Ji+90:0;return f<0&&(f+=360),[d,f,m]},i.cd=_,i.ce=mn,i.cf=ku,i.cg=function(h){return[Math.pow(h[0],1/2.2),Math.pow(h[1],1/2.2),Math.pow(h[2],1/2.2)]},i.ch=function(h,o){return h.readFields(U6,{icons:[]},o)},i.ci=function(h){return h({pluginStatus:ha,pluginURL:Ll}),Md.on("pluginStateChange",h),h},i.cj=Ow,i.ck=Zv,i.cl=jC,i.cm=Cf,i.cn=Ch,i.co=sn,i.cp=el,i.cq=js,i.cr=function(h){const o=h.indexOf(Qf);return o>=0?h.slice(0,o):h},i.cs=function(h){return h.indexOf(Qf)>=0},i.ct=function(h){const o=h.indexOf(Qf);return o>=0?h.slice(o+1):""},i.cu=function(h){const o=[],l=h.id;return l===void 0&&o.push({message:`layers.${l}: missing required property "id"`}),h.render===void 0&&o.push({message:`layers.${l}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},i.cv=function(h,o,l,d){return h.type==="custom"?new M6(h,o):new B6[h.type](h,o,l,d)},i.cw=Nu,i.cx=class extends s0{constructor(h,o){super(h._vectorTileFeature,h._z,h._x,h._y,h.id),h.state&&(this.state=Object.assign({},h.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=h.source,this.sourceLayer=h.sourceLayer,this.layer=h.layer)}toJSON(){const h=super.toJSON();return h.target=this.target,h.namespace=this.namespace,h}},i.cy=Md,i.cz=Ro,i.d=function(h){return ge.API_TILEJSON_REGEX.test(h)},i.d$=ZL,i.d0=Ko,i.d1=(h,o,l,d,m,f,y,T)=>{const M=h.transform,O=M.pitch<15?FA(.07,.7,er((14-M.zoom)/5,0,1)):.07,w=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:BA(h,o,l,d),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:m,u_width_scale:f,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:zA(o,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(w?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:_(o.tileID.canonical,0)}},i.d2=(h,o,l,d,m,f,y,T,M)=>{const O=h.transform,w=O.calculatePixelsToTileUnitsMatrix(o),P=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=O.pitch<15?FA(.07,.7,er((14-O.zoom)/5,0,1)):.07;return{u_matrix:BA(h,o,l,d),u_pixels_to_tile_units:w,u_device_pixel_ratio:f,u_width_scale:y,u_floor_width_scale:T,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:VA(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zA(o,h.transform),u_alpha_discard_threshold:0,u_trim_offset:M,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(P?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:_(o.tileID.canonical,0)}},i.d3=xl,i.d4=Kg,i.d5=ap,i.d6=IA,i.d7=tn,i.d8=lw,i.d9=e_,i.dA=ow,i.dB=so,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=Ma,i.dE=Bv,i.dF=pu,i.dG=function([h,o,l]){const d=Math.hypot(h,o,l),m=Math.atan2(h,l),f=.5*Math.PI-Math.acos(-o/d);return new zr(Yr(m),Yr(f))},i.dH=eT,i.dI=function(h){const o=h.navigator?h.navigator.userAgent:null;return!!function(l){if(yc==null){const d=l.navigator?l.navigator.userAgent:null;yc=!!l.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return yc}(h)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(h,o){Gn=h,Zn=o},i.dK=ya,i.dL=zl,i.dM=function(h){const o=[0,0,0],l=we.mat4.identity(new Float64Array(16));return we.mat4.multiply(l,h.pixelMatrix,h.globeMatrix),we.vec3.transformMat4(o,o,l),new Gt(o[0],o[1])},i.dN=function(h,o,l=!1){if(ha===Zf||ha===lu||ha===Eh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ll=Et.resolveURL(h),ha=Zf,fm=o,pm(),l||hy()},i.dO=Rc,i.dP=function(){Ow().acquire(sT)},i.dQ=function(){const h=o1;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(sT),o1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=Oy,i.dS=function(h){const o=Ai();if(!o)return;const l=o.delete(cn);h&&l.catch(h).then(()=>h())},i.dT=i1,i.dU=BL,i.dV=function(h){mT=Et.resolveURL(h),o0||(o0=new e0(Ow(),new tl)),o0.broadcast("setDracoUrl",mT)},i.dW=jL,i.dX=function(h){i0=Et.resolveURL(h),o0||(o0=new e0(Ow(),new tl)),o0.broadcast("setMeshoptUrl",i0)},i.dY=on,i.dZ=Bd,i.d_=Ud,i.da=450,i.db=7,i.dc=I6,i.dd=qn,i.de=Mm,i.df=256,i.dg=vo,i.dh=cl,i.di=As,i.dj=Ld,i.dk=function(h,o,l,d,m){return er((h-o)/(l-o)*(m-d)+d,d,m)},i.dl=ay,i.dm=kc,i.dn=class{constructor(h,o,l,d){this.context=h,this.format=d,this.size=l,this.texture=h.gl.createTexture();const[m,f,y]=this.size,{gl:T}=h;T.bindTexture(T.TEXTURE_3D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,m,f,y,0,YC(this.format),KC(this.format),o.data)}bind(h,o){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_3D,this.texture),h!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,h),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,h),this.minFilter=h),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}},i.dp=tT,i.dq=[1,1,1],i.dr=Qv,i.ds=Jv,i.dt=Oc,i.du=Od,i.dv=Do,i.dw=Cm,i.dx=Bg,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Gt(1/0,1/0),max:new Gt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(h,o=!1){const l=cA(new Gt(0,0),new Gt(Qt,Qt),h),d=[];if(o&&!TC(l,this._globalClipBounds))return d;for(const m of this._activeRegions){if(m.hiddenByOverlap||!TC(l,m))continue;const f=xU(m.min,m.max,h);d.push({min:f.min,max:f.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return d}setSources(h){this._setSources(h.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const l=[];for(const d of o.cache.getVisibleCoordinates()){const m=o.cache.getTile(d).buckets[o.layer];m&&m.updateFootprints(d.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(h){const o=h.getFootprints();if(o.length===0)return;const l=h.getOrder(),d=h.getClipMask(),m=h.getClipScope();for(const f of o){if(!f.footprint)continue;const y=cA(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:l,clipMask:d,clipScope:m})}this._sourceIds.push(h.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||sw(o.min,l.min)||sw(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(d,m){const f=(y,T)=>y+T;return d.length-m.length||d.reduce(f,"").localeCompare(m.reduce(f,""))}(o.clipScope,l.clipScope));let h=this._activeRegions.length!==this._prevRegions.length;if(!h){let o=0;for(;!h&&o!==this._activeRegions.length;){const l=this._activeRegions[o],d=this._prevRegions[o];h=l.priority!==d.priority||!uA(l,d)||l.order!==d.order||l.clipMask!==d.clipMask||!Io(l.clipScope,d.clipScope),++o}}if(h){++this._updateTime;for(const l of this._activeRegions)l.order!==ow&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const o=l=>{const d=this._activeRegions;if(l>=d.length)return l;const m=d[l].priority;for(;l<d.length&&d[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,d=o(l);for(;l!==d;){let m=l;const f=l;for(;m!==d;){const y=this._activeRegions[m];y.hiddenByOverlap=!1;for(let T=0;T<f;T++){const M=this._activeRegions[T];if(!M.hiddenByOverlap&&y.order===ow&&TC(y,M)&&(y.hiddenByOverlap=dA(y.footprint,y.tileId,M.footprint,M.tileId),y.hiddenByOverlap))break}++m}l=d,d=o(l)}}}}_setSources(h){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=h.length-1;o>=0;o--)this._addSource(h[o]);this._computeReplacement()}},i.dz=class{constructor(h){this._createGrid(h),this._createPoles(h)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const h of this._poleSegments)h.destroy();for(const h of this._gridSegments)h.withSkirts.destroy(),h.withoutSkirts.destroy()}_fillGridMeshWithLods(h,o){const l=new eo,d=new Qo,m=[],f=h+1+2,y=o[0]+1,T=o[0]+1+(1+o.length),M=(O,w,P)=>{let N=O===f-1?O-2:O===0?O:O-1;return N+=P?24575:0,[N,w]};for(let O=0;O<f;++O)l.emplaceBack(...M(O,0,!0));for(let O=0;O<y;++O)for(let w=0;w<f;++w)l.emplaceBack(...M(w,O,(w===0||w===f-1)&&!0));for(let O=0;O<o.length;++O){const w=o[O];for(let P=0;P<f;++P)l.emplaceBack(...M(P,w,!0))}for(let O=0;O<o.length;++O){const w=d.length,P=o[O]+1+2,N=new Qo;for(let B=0;B<P-1;B++){const q=B===P-2,Z=q?f*(T-o.length+O-B):f;for(let re=0;re<f-1;re++){const ne=B*f+re;B===0||q||re===0||re===f-2?(N.emplaceBack(ne+1,ne,ne+Z),N.emplaceBack(ne+Z,ne+Z+1,ne+1)):(d.emplaceBack(ne+1,ne,ne+Z),d.emplaceBack(ne+Z,ne+Z+1,ne+1))}}const L=xi.simpleSegment(0,w,l.length,d.length-w);for(let B=0;B<N.uint16.length;B+=3)d.emplaceBack(N.uint16[B],N.uint16[B+1],N.uint16[B+2]);const D=xi.simpleSegment(0,w,l.length,d.length-w);m.push({withoutSkirts:L,withSkirts:D})}return{vertices:l,indices:d,segments:m}}_createGrid(h){const o=this._fillGridMeshWithLods(sp,Dm);this._gridSegments=o.segments,this._gridBuffer=h.createVertexBuffer(o.vertices,vn.members),this._gridIndexBuffer=h.createIndexBuffer(o.indices,!0)}_createPoles(h){const o=new Qo;for(let y=0;y<=sp;y++)o.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=h.createIndexBuffer(o,!0);const l=new As,d=new As,m=new As,f=new As;this._poleSegments=[];for(let y=0,T=0;y<Fd;y++){const M=360/(1<<y);l.emplaceBack(0,-ws,0,.5,0),d.emplaceBack(0,-ws,0,.5,1),m.emplaceBack(0,-ws,0,.5,.5),f.emplaceBack(0,-ws,0,.5,.5);for(let O=0;O<=sp;O++){let w=O/sp,P=0;const N=Sn(0,M,w),[L,D,B]=zd(ec,ts,N,ws);l.emplaceBack(L,D,B,w,P),d.emplaceBack(L,D,B,w,1-P);const q=cr(N);w=.5+.5*Math.sin(q),P=.5+.5*Math.cos(q),m.emplaceBack(L,D,B,w,P),f.emplaceBack(L,D,B,w,1-P)}this._poleSegments.push(xi.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=h.createVertexBuffer(l,fn,!1),this._poleSouthVertexBuffer=h.createVertexBuffer(d,fn,!1),this._texturedPoleNorthVertexBuffer=h.createVertexBuffer(m,fn,!1),this._texturedPoleSouthVertexBuffer=h.createVertexBuffer(f,fn,!1)}getGridBuffers(h,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[h].withSkirts:this._gridSegments[h].withoutSkirts]}getPoleBuffers(h,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[h]]}},i.e=ge,i.e0=YL,i.e1=OA,i.e2=Iy,i.e3="hd_road_elevation",i.e4=class{static parseFrom(h,o){const l=km.parse(h);if(!l)return[];let{vertices:d,features:m}=l;const f=1/_(o);m.sort((O,w)=>O.id-w.id),d.sort((O,w)=>O.id-w.id||O.idx-w.idx),d=d.filter((O,w,P)=>w===P.findIndex(N=>N.id===O.id&&N.idx===O.idx));const y=new Array;let T=0;const M=d.length;for(const O of m){if(O.constantHeight){y.push(new wC(O.id,O.bounds,O.constantHeight));continue}for(;T!==M&&d[T].id<O.id;)T++;if(T===M||d[T].id!==O.id)continue;const w=new Array,P=new Array,N=T;for(;T!==M&&d[T].id===O.id;){const L=d[T];if(w.push({position:L.position,height:L.height,extent:L.extent}),T!==N&&d[T-1].idx===L.idx-1){const D=T-N;P.push({a:D-1,b:D})}T++}y.push(new wC(O.id,O.bounds,void 0,w,P,f))}return y}},i.e5=Du,i.e6=My,i.e7=lR,i.e8=Xv,i.e9=function(h,o,l,d,m,f,y,T=1,M){h.createArrays(),h.tilePixelRatio=Qt/(512*h.overscaling),h.compareText={},h.iconsNeedLinear=!1;const O=h.layers[0].layout,w=h.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=T,P.textSizeScaleRange=O.get("text-size-scale-range"),P.iconSizeScaleRange=O.get("icon-size-scale-range");const[N,L]=P.textSizeScaleRange,[D,B]=P.iconSizeScaleRange;P.textScaleFactor=er(P.scaleFactor,N,L),P.iconScaleFactor=er(P.scaleFactor,D,B);const q=w["text-size"],Z=w["icon-size"];if(h.textSizeData.kind==="composite"){const{minZoom:_e,maxZoom:Me}=h.textSizeData;P.compositeTextSizes=[q.possiblyEvaluate(new ei(_e),f),q.possiblyEvaluate(new ei(Me),f)]}if(h.iconSizeData.kind==="composite"){const{minZoom:_e,maxZoom:Me}=h.iconSizeData;P.compositeIconSizes=[Z.possiblyEvaluate(new ei(_e),f),Z.possiblyEvaluate(new ei(Me),f)]}P.layoutTextSize=q.possiblyEvaluate(new ei(y+1),f),P.layoutIconSize=Z.possiblyEvaluate(new ei(y+1),f),P.textMaxSize=q.possiblyEvaluate(new ei(18),f);const re=O.get("symbol-placement"),ne=O.get("text-rotation-alignment")==="map"&&re!=="point",te=O.get("text-size");let le=!1;const fe=[];for(const _e of h.features){const Me=O.get("text-font").evaluate(_e,{},f).join(","),Ce=te.evaluate(_e,{},f)*P.textScaleFactor,Te=P.layoutTextSize.evaluate(_e,{},f)*P.textScaleFactor,Ge=P.layoutIconSize.evaluate(_e,{},f)*P.iconScaleFactor,Ae={horizontal:{},vertical:void 0},He=_e.text;let Qe,Je=[0,0];if(He){const Bt=He.toString(),An=O.get("text-letter-spacing").evaluate(_e,{},f)*Zs,un=O.get("text-line-height").evaluate(_e,{},f)*Zs,_n=ll(Bt)?An:0,zn=O.get("text-anchor").evaluate(_e,{},f),sr=O.get("text-variable-anchor");if(!sr){const $r=O.get("text-radial-offset").evaluate(_e,{},f);Je=$r?mR(zn,[$r*Zs,VC]):O.get("text-offset").evaluate(_e,{},f).map(fi=>fi*Zs)}let Un=ne?"center":O.get("text-justify").evaluate(_e,{},f);const gr=re==="point",nr=gr?O.get("text-max-width").evaluate(_e,{},f)*Zs:1/0,vr=$r=>{h.allowVerticalPlacement&&ca(Bt)&&(Ae.vertical=zC(He,o,l,m,Me,nr,un,zn,$r,_n,Je,_u.vertical,!0,Te,Ce,M))};if(!ne&&sr){const $r=Un==="auto"?sr.map(jn=>UC(jn)):[Un];let fi=!1;for(let jn=0;jn<$r.length;jn++){const Tr=$r[jn];if(!Ae.horizontal[Tr])if(fi)Ae.horizontal[Tr]=Ae.horizontal[0];else{const Di=zC(He,o,l,m,Me,nr,un,"center",Tr,_n,Je,_u.horizontal,!1,Te,Ce,M);Di&&(Ae.horizontal[Tr]=Di,fi=Di.positionedLines.length===1)}}vr("left")}else{if(Un==="auto"&&(Un=UC(zn)),gr||O.get("text-writing-mode").indexOf("horizontal")>=0||!ca(Bt)){const $r=zC(He,o,l,m,Me,nr,un,zn,Un,_n,Je,_u.horizontal,!1,Te,Ce,M);$r&&(Ae.horizontal[Un]=$r)}vr(gr?"left":Un)}}let st,rt,dt,lt,pt,kt=!1;if(_e.icon&&_e.icon.hasPrimary()){const Bt=_R(_e.icon,h.iconSizeData,w["icon-size"],f,h.zoom,_e,M,P.iconScaleFactor);st=Bt.iconPrimary,rt=Bt.iconSecondary;const An=st.toString(),un=d.get(An);un&&(dt=O.get("icon-offset").evaluate(_e,{},f),lt=O.get("icon-anchor").evaluate(_e,{},f),pt=O.get("icon-text-fit").evaluate(_e,{},f),Qe=o6(m.get(An),rt?m.get(rt.toString()):void 0,dt,lt),kt=un.sdf,h.sdfIcons===void 0?h.sdfIcons=un.sdf:h.sdfIcons!==un.sdf&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(un.pixelRatio!==h.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(h.iconsNeedLinear=!0))}le=le||!(!_e.icon||!_e.icon.hasSecondary());const Nt=GC(Ae.horizontal)||Ae.vertical;h.iconsInText||(h.iconsInText=!!Nt&&Nt.iconsInText);const hn=Te*P.textScaleFactor/Zs,{defaultShapedIcon:qt,verticallyShapedIcon:Jt}=f6(h,Qe,O,_e,f,Ae,hn,dt,pt);Qe=qt,fe.push({feature:_e,shapedTextOrientations:Ae,shapedText:Nt,shapedIcon:Qe,iconPrimary:st,iconSecondary:rt,iconOffset:dt,iconAnchor:lt,verticallyShapedIcon:Jt,layoutTextSize:Te,layoutIconSize:Ge,textOffset:Je,isSDFIcon:kt,iconTextFit:pt})}return{featureData:fe,sizes:P,hasAnySecondaryIcon:le,textAlongLine:ne,symbolPlacement:re}},i.ea=uR,i.eb=function(h,o,l,d,m,f,y,T,M,O){const{featureData:w,hasAnySecondaryIcon:P,sizes:N,textAlongLine:L,symbolPlacement:D}=o;for(const B of w){const{shapedIcon:q,verticallyShapedIcon:Z,feature:re,shapedTextOrientations:ne,shapedText:te,layoutTextSize:le,textOffset:fe,isSDFIcon:_e,iconPrimary:Me,iconSecondary:Ce,iconTextFit:Te,iconOffset:Ge}=B;yR(q,O.iconPositions,Me,Ce),yR(Z,O.iconPositions,Me,Ce),d6(ne,O.iconPositions),(te||q)&&p6(h,re,ne,q,Z,M,N,le,0,fe,_e,d,m,y,T,P,Te,Ge,L,D)}l&&h.generateCollisionDebugBuffers(f,h.collisionBoxArray,N.textScaleFactor)},i.ec=Qg,i.ed=jw,i.ee=yi,i.ef=YP,i.eg=XA,i.eh=b,i.ei=function(h){let o=0;if(new Uint32Array(h,0,1)[0]!==UL){const l=new Uint32Array(h,0,7),[,,d,m,f,y]=l;o=l.byteLength+m+f+y+f,(d!==h.byteLength||o>=h.byteLength)&&vi("Invalid b3dm header information.")}return HL(h,o)},i.ej=function(h,o){const l=XL(h);for(const d of l){for(const m of d.meshes)UG(m);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(GG(d.lights,o)))}return l},i.ek=Lw,i.el=aL,i.em=da,i.en=function(h){mr(),Jn!=null&&Jn.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-h;d++)o.delete(l[d])})})},i.f=function(h){return h.indexOf("mapbox:")===0},i.g=function(h,o){return Ro(Mo(h,{method:"GET"}),o)},i.h=be,i.i=function(h){return ge.API_STYLE_REGEX.test(h)&&!ke(h)},i.j=function(h){return decodeURIComponent(atob(h).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(h){return btoa(encodeURIComponent(h).replace(/%([0-9A-F]{2})/g,(o,l)=>String.fromCharCode(+("0x"+l))))},i.l=Mo,i.m=Yn,i.n=function(h,o){return Ro(Mo(h,{type:"json"}),o)},i.o=gd,i.p=function(h,o){return Ro(Mo(h,{method:"POST"}),o)},i.q=Et,i.r=ns,i.s=function(h){try{const o=self[h];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Ct,i.u=function(){return function h(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,h)}()},i.v=function(h){return!!h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)},i.w=vi,i.x=function(){return aT||(aT=new Oy),aT},i.y=hT,i.z=mi}),u(["./shared"],function(i){function b(wt){const ge=wt?wt.url.toString():void 0;return ge?performance.getEntriesByName(ge):[]}function C(wt){if(typeof wt=="number"||typeof wt=="boolean"||typeof wt=="string"||wt==null)return JSON.stringify(wt);if(Array.isArray(wt)){let be="[";for(const ke of wt)be+=`${C(ke)},`;return`${be}]`}let ge="{";for(const be of Object.keys(wt).sort())ge+=`${be}:${C(wt[be])},`;return`${ge}}`}function A(wt){let ge="";for(const be of i.bm)(wt.type!=="model"||be!=="minzoom"&&be!=="maxzoom")&&(ge+=`/${C(wt[be])}`);return ge}class R{constructor(ge){this.keyCache={},this._layers={},this._layerConfigs={},ge&&this.replace(ge)}replace(ge,be){this._layerConfigs={},this._layers={},this.update(ge,[],be)}update(ge,be,ke){this._options=ke;for(const Xe of ge)this._layerConfigs[Xe.id]=Xe,(this._layers[Xe.id]=i.cv(Xe,this.scope,null,this._options)).compileFilter(ke),this.keyCache[Xe.id]&&delete this.keyCache[Xe.id];for(const Xe of be)delete this.keyCache[Xe],delete this._layerConfigs[Xe],delete this._layers[Xe];this.familiesBySource={};const qe=function(Xe,et){const _t={};for(let bt=0;bt<Xe.length;bt++){const Ct=Xe[bt];let Et=et&&et[Ct.id];!Et&&(Et=A(Ct),Ct.type==="line"&&Ct.paint)&&function sn(cn){return typeof cn=="string"&&cn==="line-progress"||(Array.isArray(cn)?cn.some(sn):!(!cn||typeof cn!="object")&&Object.values(cn).some(sn))}(Ct.paint["line-width"])&&(Et+=`/${C(Ct.paint["line-width"])}`),et&&(et[Ct.id]=Et);let Wt=_t[Et];Wt||(Wt=_t[Et]=[]),Wt.push(Ct)}const it=[];for(const bt in _t)it.push(_t[bt]);return it}(Object.values(this._layerConfigs),this.keyCache);for(const Xe of qe){const et=Xe.map(Wt=>this._layers[Wt.id]),_t=et[0];if(_t.visibility==="none")continue;const it=_t.source||"";let bt=this.familiesBySource[it];bt||(bt=this.familiesBySource[it]={});const Ct=_t.sourceLayer||"_geojsonTileLayer";let Et=bt[Ct];Et||(Et=bt[Ct]=[]),Et.push(et)}}}const z=1*i.d_;class V{constructor(ge){const be={},ke=[];for(const _t in ge){const it=ge[_t],bt=be[_t]={};for(const Ct in it.glyphs){const Et=it.glyphs[+Ct];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const Wt=Et.metrics.localGlyph?z:1,sn={x:0,y:0,w:Et.bitmap.width+2*Wt,h:Et.bitmap.height+2*Wt};ke.push(sn),bt[Ct]=sn}}const{w:qe,h:Xe}=i.H(ke),et=new i.dZ({width:qe||1,height:Xe||1});for(const _t in ge){const it=ge[_t];for(const bt in it.glyphs){const Ct=it.glyphs[+bt];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const Et=be[_t][bt],Wt=Ct.metrics.localGlyph?z:1;i.dZ.copy(Ct.bitmap,et,{x:0,y:0},{x:Et.x+Wt,y:Et.y+Wt},Ct.bitmap)}}this.image=et,this.positions=be}}i.dY(V,"GlyphAtlas");class W{constructor(ge){this.tileID=new i.aH(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),this.tileZoom=ge.tileZoom,this.uid=ge.uid,this.zoom=ge.zoom,this.lut=ge.lut,this.canonical=ge.tileID.canonical,this.pixelRatio=ge.pixelRatio,this.tileSize=ge.tileSize,this.source=ge.source,this.scope=ge.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ge.showCollisionBoxes,this.collectResourceTiming=!!ge.request&&ge.request.collectResourceTiming,this.promoteId=ge.promoteId,this.isSymbolTile=ge.isSymbolTile,this.tileTransform=i.aR(ge.tileID.canonical,ge.projection),this.projection=ge.projection,this.worldview=ge.worldview,this.localizableLayerIds=ge.localizableLayerIds,this.brightness=ge.brightness,this.extraShadowCaster=!!ge.extraShadowCaster,this.tessellationStep=ge.tessellationStep,this.scaleFactor=ge.scaleFactor}parse(ge,be,ke,qe,Xe){this.status="parsing",this.data=ge,this.collisionBoxArray=new i.aX;const et=new i.d$(Object.keys(ge.layers).sort()),_t=new i.e0(this.tileID,this.promoteId);_t.bucketLayerIDs=[];const it={},bt=new i.e1(256,256),Ct={featureIndex:_t,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:bt,availableImages:ke,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Et=be.familiesBySource[this.source];for(const mr in Et){const Zr=ge.layers[mr];if(!Zr)continue;let Yn=!1,Kr=!1,Vi=!1;for(const Es of Et[mr])Es[0].type==="symbol"?Yn=!0:Kr=!0,Es[0].is3D()&&Es[0].type!=="model"&&(Vi=!0);if(this.extraShadowCaster&&!Vi||this.isSymbolTile===!0&&!Yn||this.isSymbolTile===!1&&!Kr)continue;Zr.version===1&&i.w(`Vector tile source "${this.source}" layer "${mr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vo=et.encode(mr),Zo=[];let wl=!1;for(let Es=0,mo=0;Es<Zr.length;Es++){const Ui=Zr.feature(Es),Cf=_t.getId(Ui,mr);if(this.localizableLayerIds&&this.localizableLayerIds.has(mr)){const Ro=Ui.properties?Ui.properties.worldview:null;if(this.worldview&&typeof Ro=="string")if(Ro==="all")Ui.properties.$localized=!0;else{if(!Ro.split(",").includes(this.worldview))continue;Ui.properties.$localized=!0,Ui.properties.worldview=this.worldview}}!wl&&Ui.properties&&Ui.properties.hasOwnProperty(i.e2)&&(wl=!0),Zo.push({feature:Ui,id:Cf,index:mo,sourceLayerIndex:Vo}),mo++}wl&&!Ct.elevationFeatures&&ge.layers.hasOwnProperty(i.e3)&&(Ct.elevationFeatures=i.e4.parseFrom(ge.layers[i.e3],this.canonical));for(const Es of Et[mr]){const mo=Es[0];(!this.extraShadowCaster||mo.is3D()&&mo.type!=="model")&&(this.isSymbolTile!==void 0&&mo.type==="symbol"!==this.isSymbolTile||mo.minzoom&&this.zoom<Math.floor(mo.minzoom)||mo.maxzoom&&this.zoom>=mo.maxzoom||mo.visibility!=="none"&&(X(Es,this.zoom,Ct.brightness,ke),(it[mo.id]=mo.createBucket({index:_t.bucketLayerIDs.length,layers:Es,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Zo,Ct,this.tileID.canonical,this.tileTransform),_t.bucketLayerIDs.push(Es.map(Ui=>i.C(Ui.id,Ui.scope)))))}}let Wt,sn,cn,Gn,Zn,Wn;bt.trim();const Jn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ai=()=>{if(Wt)return this.status="done",Xe(Wt);if(this.extraShadowCaster)this.status="done",Xe(null,{buckets:Object.values(it).filter(mr=>!mr.isEmpty()),featureIndex:_t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ct.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(sn&&cn&&Gn){const mr=new V(sn),Zr=new Map;for(const[Vi,Vo]of cn.entries()){const{imagePosition:Zo}=i.e7(Vi,Vo,i.e8);Zr.set(Vi,Zo)}const Yn={};for(const Vi in it){const Vo=it[Vi];Vo instanceof i.aY&&(X(Vo.layers,this.zoom,Ct.brightness,ke),Yn[Vi]=i.e9(Vo,sn,mr.positions,cn,Zr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const Kr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(qe,cn,Zn,()=>{Kr.iconsPending=!1,Ai(Yn,mr,Kr)}),this.rasterizeIfNeeded(qe,Gn,Wn,()=>{Kr.patternsPending=!1,Ai(Yn,mr,Kr)})}},Ai=(mr,Zr,Yn,Kr)=>{if(Yn.iconsPending||Yn.patternsPending)return;const Vi=new i.ea(cn,Gn,this.lut);for(const Vo in it){const Zo=it[Vo];if(Vo in mr)i.eb(Zo,mr[Vo],this.showCollisionBoxes,ke,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,cn,Vi);else if(Zo.hasPattern&&(Zo instanceof i.b2||Zo instanceof i.b3||Zo instanceof i.d8)){X(Zo.layers,this.zoom,Ct.brightness,ke);const wl=Object.fromEntries(Vi.patternPositions);Zo.addFeatures(Ct,this.tileID.canonical,wl,ke,this.tileTransform,this.brightness)}}this.status="done",Xe(null,{buckets:Object.values(it).filter(Vo=>!Vo.isEmpty()),featureIndex:_t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zr.image,lineAtlas:bt,imageAtlas:Vi,brightness:Ct.brightness})};if(!this.extraShadowCaster){const mr=i.e5(Ct.glyphDependencies,Kr=>Object.keys(Kr).map(Number));Object.keys(mr).length?qe.send("getGlyphs",{uid:this.uid,stacks:mr,scope:this.scope},(Kr,Vi)=>{Wt||(Wt=Kr,sn=Vi,ai())},void 0,!1,Jn):sn={};const Zr=Array.from(Ct.iconDependencies.keys()).map(Kr=>i.I.parse(Kr));Zr.length?qe.send("getImages",{images:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Kr,Vi)=>{Wt||(Wt=Kr,cn=new Map,Zn=this.updateImageMapAndGetImageTaskQueue(cn,Vi,Ct.iconDependencies),ai())},void 0,!1,Jn):(cn=new Map,Zn=new Map);const Yn=Array.from(Ct.patternDependencies.keys()).map(Kr=>i.I.parse(Kr));Yn.length?qe.send("getImages",{images:Yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Kr,Vi)=>{Wt||(Wt=Kr,Gn=new Map,Wn=this.updateImageMapAndGetImageTaskQueue(Gn,Vi,Ct.patternDependencies),ai())},void 0,!1,Jn):(Gn=new Map,Wn=new Map)}if(Ct.elevationFeatures&&Ct.elevationFeatures.length>0){const mr=[];for(const Yn of Object.values(it))if(Yn instanceof i.b3){const Kr=Yn.getUnevaluatedPortalGraph();Kr&&mr.push(Kr)}const Zr=i.e6.evaluate(mr);for(const Yn of Object.values(it))Yn instanceof i.b3&&Yn.setEvaluatedPortalGraph(Zr)}ai()}rasterizeIfNeeded(ge,be,ke,qe){Array.from(be.values()).some(Xe=>Xe.usvg)?this.rasterize(ge,be,ke,qe):qe()}updateImageMapAndGetImageTaskQueue(ge,be,ke){const qe=new Map;for(const Xe of be.keys()){const et=ke.get(Xe)||[];for(const _t of et){const it=_t.toString(),bt=be.get(_t.id.toString());bt.usvg?qe.has(it)||(qe.set(it,_t),ge.set(it,Object.assign({},bt))):ge.set(it,bt)}}return qe}rasterize(ge,be,ke,qe){this.rasterizeTask=ge.send("rasterizeImages",{scope:this.scope,tasks:ke},(Xe,et)=>{if(!Xe)for(const[_t,it]of et.entries()){const bt=Object.assign(be.get(_t),{data:it});be.set(_t,bt)}qe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function X(wt,ge,be,ke){const qe=new i.aa(ge,{brightness:be});for(const Xe of wt)Xe.recalculate(qe,ke)}class ue extends i.E{constructor(ge,be,ke,qe,Xe,et){super(),this.actor=ge,this.layerIndex=be,this.availableImages=ke,this.loadVectorData=Xe||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(ge.scheduler),this.isSpriteLoaded=qe,this.scheduler=ge.scheduler,this.brightness=et}loadTile(ge,be){const ke=ge.uid,qe=ge&&ge.request,Xe=qe&&qe.collectResourceTiming,et=this.loading[ke]=new W(ge);et.abort=this.loadVectorData(ge,(_t,it)=>{const bt=!this.loading[ke];if(delete this.loading[ke],et.cancelRasterize(),bt||_t||!it)return et.status="done",bt||(this.loaded[ke]=et),be(_t);const Ct=it.rawData,Et={};it.expires&&(Et.expires=it.expires),it.cacheControl&&(Et.cacheControl=it.cacheControl),et.vectorTile=it.vectorTile||new i.ec.VectorTile(new i.bi(Ct));const Wt=()=>{et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,(sn,cn)=>{if(sn||!cn)return be(sn);const Gn={};if(Xe){const Zn=b(qe);Zn.length>0&&(Gn.resourceTiming=JSON.parse(JSON.stringify(Zn)))}be(null,i.l({rawTileData:Ct.slice(0)},cn,Et,Gn))})};this.isSpriteLoaded?Wt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Wt,{type:"parseTile",isSymbolTile:ge.isSymbolTile,zoom:ge.tileZoom}):Wt()}),this.loaded=this.loaded||{},this.loaded[ke]=et})}reloadTile(ge,be){const ke=this.loaded,qe=ge.uid;if(ke&&ke[qe]){const Xe=ke[qe];Xe.scaleFactor=ge.scaleFactor,Xe.showCollisionBoxes=ge.showCollisionBoxes,Xe.projection=ge.projection,Xe.brightness=ge.brightness,Xe.tileTransform=i.aR(ge.tileID.canonical,ge.projection),Xe.extraShadowCaster=ge.extraShadowCaster,Xe.lut=ge.lut;const et=(_t,it)=>{const bt=Xe.reloadCallback;bt&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,bt)),be(_t,it)};Xe.status==="parsing"?Xe.reloadCallback=et:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,et):et())}else be(null,void 0)}abortTile(ge,be){const ke=ge.uid,qe=this.loading[ke];qe&&(qe.abort&&qe.abort(),delete this.loading[ke]),be()}removeTile(ge,be){const ke=this.loaded,qe=ge.uid;ke&&ke[qe]&&delete ke[qe],be()}}class ie{loadTile(ge,be){const{uid:ke,encoding:qe,rawImageData:Xe,padding:et}=ge,_t=ImageBitmap&&Xe instanceof ImageBitmap?this.getImageData(Xe,et):Xe;be(null,new i.ed(ke,_t,qe,et<1))}reloadTile(ge,be){be(null,null)}abortTile(ge,be){be()}removeTile(ge,be){be()}getImageData(ge,be){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ge.width,ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ge.width,this.offscreenCanvas.height=ge.height,this.offscreenCanvasContext.drawImage(ge,0,0,ge.width,ge.height);const ke=this.offscreenCanvasContext.getImageData(-be,-be,ge.width+2*be,ge.height+2*be);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ke}}i.bh.setPbf(i.bi);class K{constructor(ge){this._mrt=new i.bh(ge.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ge.uid,this.tileID=ge.tileID,this.source=ge.source}parse(ge,be){const ke=this._mrt;this.status="parsing",this._entireBuffer=ge;try{ke.parseHeader(ge),this._isHeaderLoaded=!0;const qe=[];for(const Xe in ke.layers){const et=ke.getLayer(Xe),_t=et.getDataRange(et.getBandList()),it=ke.createDecodingTask(_t),bt=ge.slice(_t.firstByte,_t.lastByte+1),Ct=i.bh.performDecoding(bt,it).then(Et=>it.complete(null,Et)).catch(Et=>it.complete(Et,null));qe.push(Ct)}Promise.allSettled(qe).then(()=>be(null,ke))}catch(qe){be(qe)}}}class ee{constructor(ge){this.actor=ge,this.loading={},this.loaded={}}loadTile(ge,be){const ke=ge.uid,qe=ge.request,Xe=this.loading[ke]=new K(ge),{cancel:et}=i.bj(qe,(_t,it,bt,Ct)=>{const Et=!this.loading[ke];if(delete this.loading[ke],Et||_t||!it)return Xe.status="done",Et||(this.loaded[ke]=Xe),be(_t);Xe.parse(it,(Wt,sn)=>{if(Wt||!sn)return be(Wt);be(null,sn,bt,Ct)}),this.loaded[ke]=Xe});Xe.abort=et}reloadTile(ge,be){be(null,void 0)}abortTile(ge,be){const ke=ge.uid,qe=this.loading[ke];qe&&(qe.abort&&qe.abort(),delete this.loading[ke]),be()}removeTile(ge,be){const ke=ge.uid;this.loaded[ke]&&delete this.loaded[ke],be()}decodeRasterArray({task:ge,buffer:be},ke){i.bh.performDecoding(be,ge).then(qe=>ke(null,qe)).catch(qe=>ke(qe))}}const ae=i.ec.VectorTileFeature.prototype.toGeoJSON;class he{constructor(ge){this._feature=ge,this.extent=i.ai,this.type=ge.type,this.properties=ge.tags,"id"in ge&&!isNaN(ge.id)&&(this.id=parseInt(ge.id,10))}loadGeometry(){if(this._feature.type===1){const ge=[];for(const be of this._feature.geometry)ge.push([new i.P(be[0],be[1])]);return ge}{const ge=[];for(const be of this._feature.geometry){const ke=[];for(const qe of be)ke.push(new i.P(qe[0],qe[1]));ge.push(ke)}return ge}}toGeoJSON(ge,be,ke){return ae.call(this,ge,be,ke)}}class xe{constructor(ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=ge.length,this._features=ge}feature(ge){return new he(this._features[ge])}}const ye=64/4096,Se=128;class je{constructor(){this.features=new Map}clear(){this.features.clear()}load(ge=[],be){for(const ke of ge){const qe=ke.id;if(qe==null)continue;let Xe=this.features.get(qe);Xe&&this.updateCache(Xe,be),ke.geometry?(Xe=De(ke),this.updateCache(Xe,be),this.features.set(qe,Xe)):this.features.delete(qe),this.updateCache(Xe,be)}}updateCache(ge,be){for(const{canonical:ke,uid:qe}of Object.values(be)){const{z:Xe,x:et,y:_t}=ke;Re(ge,Math.pow(2,Xe),et,_t)&&delete be[qe]}}getTile(ge,be,ke){const qe=Math.pow(2,ge),Xe=[];for(const et of this.features.values())Re(et,qe,be,ke)&&Xe.push(Ze(et,qe,be,ke));return{features:Xe}}getFeatures(){return[...this.features.values()]}}function Re({minX:wt,minY:ge,maxX:be,maxY:ke},qe,Xe,et){return wt<(Xe+1+ye)/qe&&ge<(et+1+ye)/qe&&be>(Xe-ye)/qe&&ke>(et-ye)/qe}function De(wt){const{id:ge,geometry:be,properties:ke}=wt;if(!be)return;if(be.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:qe,coordinates:Xe}=be,et={id:ge,type:1,geometry:[],tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_t=et.geometry;if(qe==="Point")at(Xe,_t,et);else if(qe==="MultiPoint")for(const it of Xe)at(it,_t,et);else if(qe==="LineString")et.type=2,ot(Xe,_t,et);else if(qe==="MultiLineString")et.type=2,Fe(Xe,_t,et);else if(qe==="Polygon")et.type=3,Fe(Xe,_t,et,!0);else{if(qe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");et.type=3;for(const it of Xe)Fe(it,_t,et,!0)}return et}function at([wt,ge],be,ke){const qe=i.av(wt);let Xe=i.aC(ge);Xe=Xe<0?0:Xe>1?1:Xe,be.push(qe,Xe),ke.minX=Math.min(ke.minX,qe),ke.minY=Math.min(ke.minY,Xe),ke.maxX=Math.max(ke.maxX,qe),ke.maxY=Math.max(ke.maxY,Xe)}function ot(wt,ge,be,ke=!1,qe=!1){const Xe=[];for(const et of wt)at(et,Xe,be);ge.push(Xe),ke&&function(et,_t){let it=0;for(let bt=0,Ct=et.length,Et=Ct-2;bt<Ct;Et=bt,bt+=2)it+=(et[bt]-et[Et])*(et[bt+1]+et[Et+1]);if(it>0===_t)for(let bt=0,Ct=et.length;bt<Ct/2;bt+=2){const Et=et[bt],Wt=et[bt+1];et[bt]=et[Ct-2-bt],et[bt+1]=et[Ct-1-bt],et[Ct-2-bt]=Et,et[Ct-1-bt]=Wt}}(Xe,qe)}function Fe(wt,ge,be,ke=!1){for(let qe=0;qe<wt.length;qe++)ot(wt[qe],ge,be,ke,qe===0)}function Ze(wt,ge,be,ke){const{id:qe,type:Xe,geometry:et,tags:_t}=wt,it=[];if(Xe===1)(function(bt,Ct,Et,Wt,sn){for(let cn=0;cn<bt.length;cn+=2){const Gn=Math.round(i.ai*(bt[cn+0]*Ct-Et)),Zn=Math.round(i.ai*(bt[cn+1]*Ct-Wt));sn.push([Gn,Zn])}})(et,ge,be,ke,it);else for(const bt of et)Ve(bt,ge,be,ke,it);return{id:qe,type:Xe,geometry:it,tags:_t}}function Ve(wt,ge,be,ke,qe){const et=i.ai+Se;let _t;for(let it=0;it<wt.length-2;it+=2){let bt=Math.round(i.ai*(wt[it+0]*ge-be)),Ct=Math.round(i.ai*(wt[it+1]*ge-ke)),Et=Math.round(i.ai*(wt[it+2]*ge-be)),Wt=Math.round(i.ai*(wt[it+3]*ge-ke));const sn=Et-bt,cn=Wt-Ct;bt<-128&&Et<-128||(bt<-128?(Ct+=Math.round(cn*((-128-bt)/sn)),bt=-128):Et<-128&&(Wt=Ct+Math.round(cn*((-128-bt)/sn)),Et=-128),Ct<-128&&Wt<-128||(Ct<-128?(bt+=Math.round(sn*((-128-Ct)/cn)),Ct=-128):Wt<-128&&(Et=bt+Math.round(sn*((-128-Ct)/cn)),Wt=-128),bt>=et&&Et>=et||(bt>=et?(Ct+=Math.round(cn*((et-bt)/sn)),bt=et):Et>=et&&(Wt=Ct+Math.round(cn*((et-bt)/sn)),Et=et),Ct>=et&&Wt>=et||(Ct>=et?(bt+=Math.round(sn*((et-Ct)/cn)),Ct=et):Wt>=et&&(Et=bt+Math.round(sn*((et-Ct)/cn)),Wt=et),_t&&bt===_t[_t.length-1][0]&&Ct===_t[_t.length-1][1]||(_t=[[bt,Ct]],qe.push(_t)),_t.push([Et,Wt])))))}}var mt,We,tt,Dt={exports:{}},$e=function(){if(tt)return Dt.exports;tt=1;var wt=i.eg(),ge=function(){if(We)return mt;We=1;var Ct=i.ee(),Et=i.ef().VectorTileFeature;function Wt(cn,Gn){this.options=Gn||{},this.features=cn,this.length=cn.length}function sn(cn,Gn){this.id=typeof cn.id=="number"?cn.id:void 0,this.type=cn.type,this.rawGeometry=cn.type===1?[cn.geometry]:cn.geometry,this.properties=cn.tags,this.extent=Gn||4096}return mt=Wt,Wt.prototype.feature=function(cn){return new sn(this.features[cn],this.options.extent)},sn.prototype.loadGeometry=function(){var cn=this.rawGeometry;this.geometry=[];for(var Gn=0;Gn<cn.length;Gn++){for(var Zn=cn[Gn],Wn=[],Jn=0;Jn<Zn.length;Jn++)Wn.push(new Ct(Zn[Jn][0],Zn[Jn][1]));this.geometry.push(Wn)}return this.geometry},sn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var cn=this.geometry,Gn=1/0,Zn=-1/0,Wn=1/0,Jn=-1/0,ai=0;ai<cn.length;ai++)for(var Ai=cn[ai],mr=0;mr<Ai.length;mr++){var Zr=Ai[mr];Gn=Math.min(Gn,Zr.x),Zn=Math.max(Zn,Zr.x),Wn=Math.min(Wn,Zr.y),Jn=Math.max(Jn,Zr.y)}return[Gn,Wn,Zn,Jn]},sn.prototype.toGeoJSON=Et.prototype.toGeoJSON,mt}();function be(Ct){var Et=new wt;return function(Wt,sn){for(var cn in Wt.layers)sn.writeMessage(3,ke,Wt.layers[cn])}(Ct,Et),Et.finish()}function ke(Ct,Et){var Wt;Et.writeVarintField(15,Ct.version||1),Et.writeStringField(1,Ct.name||""),Et.writeVarintField(5,Ct.extent||4096);var sn={keys:[],values:[],keycache:{},valuecache:{}};for(Wt=0;Wt<Ct.length;Wt++)sn.feature=Ct.feature(Wt),Et.writeMessage(2,qe,sn);var cn=sn.keys;for(Wt=0;Wt<cn.length;Wt++)Et.writeStringField(3,cn[Wt]);var Gn=sn.values;for(Wt=0;Wt<Gn.length;Wt++)Et.writeMessage(4,bt,Gn[Wt])}function qe(Ct,Et){var Wt=Ct.feature;Wt.id!==void 0&&Et.writeVarintField(1,Wt.id),Et.writeMessage(2,Xe,Ct),Et.writeVarintField(3,Wt.type),Et.writeMessage(4,it,Wt)}function Xe(Ct,Et){var Wt=Ct.feature,sn=Ct.keys,cn=Ct.values,Gn=Ct.keycache,Zn=Ct.valuecache;for(var Wn in Wt.properties){var Jn=Wt.properties[Wn],ai=Gn[Wn];if(Jn!==null){ai===void 0&&(sn.push(Wn),Gn[Wn]=ai=sn.length-1),Et.writeVarint(ai);var Ai=typeof Jn;Ai!=="string"&&Ai!=="boolean"&&Ai!=="number"&&(Jn=JSON.stringify(Jn));var mr=Ai+":"+Jn,Zr=Zn[mr];Zr===void 0&&(cn.push(Jn),Zn[mr]=Zr=cn.length-1),Et.writeVarint(Zr)}}}function et(Ct,Et){return(Et<<3)+(7&Ct)}function _t(Ct){return Ct<<1^Ct>>31}function it(Ct,Et){for(var Wt=Ct.loadGeometry(),sn=Ct.type,cn=0,Gn=0,Zn=Wt.length,Wn=0;Wn<Zn;Wn++){var Jn=Wt[Wn],ai=1;sn===1&&(ai=Jn.length),Et.writeVarint(et(1,ai));for(var Ai=sn===3?Jn.length-1:Jn.length,mr=0;mr<Ai;mr++){mr===1&&sn!==1&&Et.writeVarint(et(2,Ai-1));var Zr=Jn[mr].x-cn,Yn=Jn[mr].y-Gn;Et.writeVarint(_t(Zr)),Et.writeVarint(_t(Yn)),cn+=Zr,Gn+=Yn}sn===3&&Et.writeVarint(et(7,1))}}function bt(Ct,Et){var Wt=typeof Ct;Wt==="string"?Et.writeStringField(1,Ct):Wt==="boolean"?Et.writeBooleanField(7,Ct):Wt==="number"&&(Ct%1!=0?Et.writeDoubleField(3,Ct):Ct<0?Et.writeSVarintField(6,Ct):Et.writeVarintField(5,Ct))}return Dt.exports=be,Dt.exports.fromVectorTileJs=be,Dt.exports.fromGeojsonVt=function(Ct,Et){Et=Et||{};var Wt={};for(var sn in Ct)Wt[sn]=new ge(Ct[sn].features,Et),Wt[sn].name=sn,Wt[sn].version=Et.version,Wt[sn].extent=Et.extent;return be({layers:Wt})},Dt.exports.GeoJSONWrapper=ge,Dt.exports}(),Ke=i.eh($e);const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:wt=>wt},Yt=Math.fround||(Kt=new Float32Array(1),wt=>(Kt[0]=+wt,Kt[0]));var Kt;const nn=3,Ut=5,wn=6;class Pn{constructor(ge){this.options=Object.assign(Object.create(gt),ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ge){const{log:be,minZoom:ke,maxZoom:qe}=this.options;be&&console.time("total time");const Xe=`prepare ${ge.length} points`;be&&console.time(Xe),this.points=ge;const et=[];for(let it=0;it<ge.length;it++){const bt=ge[it];if(!bt.geometry)continue;const[Ct,Et]=bt.geometry.coordinates,Wt=Yt(Mr(Ct)),sn=Yt(yi(Et));et.push(Wt,sn,1/0,it,-1,1),this.options.reduce&&et.push(0)}let _t=this.trees[qe+1]=this._createTree(et);be&&console.timeEnd(Xe);for(let it=qe;it>=ke;it--){const bt=+Date.now();_t=this.trees[it]=this._createTree(this._cluster(_t,it)),be&&console.log("z%d: %d clusters in %dms",it,_t.numItems,+Date.now()-bt)}return be&&console.timeEnd("total time"),this}getClusters(ge,be){let ke=((ge[0]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,ge[1]));let Xe=ge[2]===180?180:((ge[2]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,ge[3]));if(ge[2]-ge[0]>=360)ke=-180,Xe=180;else if(ke>Xe){const Et=this.getClusters([ke,qe,180,et],be),Wt=this.getClusters([-180,qe,Xe,et],be);return Et.concat(Wt)}const _t=this.trees[this._limitZoom(be)],it=_t.range(Mr(ke),yi(et),Mr(Xe),yi(qe)),bt=_t.data,Ct=[];for(const Et of it){const Wt=this.stride*Et;Ct.push(bt[Wt+Ut]>1?we(bt,Wt,this.clusterProps):this.points[bt[Wt+nn]])}return Ct}getChildren(ge){const be=this._getOriginId(ge),ke=this._getOriginZoom(ge),qe="No cluster with the specified id.",Xe=this.trees[ke];if(!Xe)throw new Error(qe);const et=Xe.data;if(be*this.stride>=et.length)throw new Error(qe);const _t=this.options.radius/(this.options.extent*Math.pow(2,ke-1)),it=Xe.within(et[be*this.stride],et[be*this.stride+1],_t),bt=[];for(const Ct of it){const Et=Ct*this.stride;et[Et+4]===ge&&bt.push(et[Et+Ut]>1?we(et,Et,this.clusterProps):this.points[et[Et+nn]])}if(bt.length===0)throw new Error(qe);return bt}getLeaves(ge,be,ke){const qe=[];return this._appendLeaves(qe,ge,be=be||10,ke=ke||0,0),qe}getTile(ge,be,ke){const qe=this.trees[this._limitZoom(ge)],Xe=Math.pow(2,ge),{extent:et,radius:_t}=this.options,it=_t/et,bt=(ke-it)/Xe,Ct=(ke+1+it)/Xe,Et={features:[]};return this._addTileFeatures(qe.range((be-it)/Xe,bt,(be+1+it)/Xe,Ct),qe.data,be,ke,Xe,Et),be===0&&this._addTileFeatures(qe.range(1-it/Xe,bt,1,Ct),qe.data,Xe,ke,Xe,Et),be===Xe-1&&this._addTileFeatures(qe.range(0,bt,it/Xe,Ct),qe.data,-1,ke,Xe,Et),Et.features.length?Et:null}getClusterExpansionZoom(ge){let be=this._getOriginZoom(ge)-1;for(;be<=this.options.maxZoom;){const ke=this.getChildren(ge);if(be++,ke.length!==1)break;ge=ke[0].properties.cluster_id}return be}_appendLeaves(ge,be,ke,qe,Xe){const et=this.getChildren(be);for(const _t of et){const it=_t.properties;if(it&&it.cluster?Xe+it.point_count<=qe?Xe+=it.point_count:Xe=this._appendLeaves(ge,it.cluster_id,ke,qe,Xe):Xe<qe?Xe++:ge.push(_t),ge.length===ke)break}return Xe}_createTree(ge){const be=new i.bE(ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ke=0;ke<ge.length;ke+=this.stride)be.add(ge[ke],ge[ke+1]);return be.finish(),be.data=ge,be}_addTileFeatures(ge,be,ke,qe,Xe,et){for(const _t of ge){const it=_t*this.stride,bt=be[it+Ut]>1;let Ct,Et,Wt;if(bt)Ct=Rr(be,it,this.clusterProps),Et=be[it],Wt=be[it+1];else{const Gn=this.points[be[it+nn]];Ct=Gn.properties;const[Zn,Wn]=Gn.geometry.coordinates;Et=Mr(Zn),Wt=yi(Wn)}const sn={type:1,geometry:[[Math.round(this.options.extent*(Et*Xe-ke)),Math.round(this.options.extent*(Wt*Xe-qe))]],tags:Ct};let cn;cn=bt||this.options.generateId?be[it+nn]:this.points[be[it+nn]].id,cn!==void 0&&(sn.id=cn),et.features.push(sn)}}_limitZoom(ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+ge),this.options.maxZoom+1))}_cluster(ge,be){const{radius:ke,extent:qe,reduce:Xe,minPoints:et}=this.options,_t=ke/(qe*Math.pow(2,be)),it=ge.data,bt=[],Ct=this.stride;for(let Et=0;Et<it.length;Et+=Ct){if(it[Et+2]<=be)continue;it[Et+2]=be;const Wt=it[Et],sn=it[Et+1],cn=ge.within(it[Et],it[Et+1],_t),Gn=it[Et+Ut];let Zn=Gn;for(const Wn of cn){const Jn=Wn*Ct;it[Jn+2]>be&&(Zn+=it[Jn+Ut])}if(Zn>Gn&&Zn>=et){let Wn,Jn=Wt*Gn,ai=sn*Gn,Ai=-1;const mr=(Et/Ct<<5)+(be+1)+this.points.length;for(const Zr of cn){const Yn=Zr*Ct;if(it[Yn+2]<=be)continue;it[Yn+2]=be;const Kr=it[Yn+Ut];Jn+=it[Yn]*Kr,ai+=it[Yn+1]*Kr,it[Yn+4]=mr,Xe&&(Wn||(Wn=this._map(it,Et,!0),Ai=this.clusterProps.length,this.clusterProps.push(Wn)),Xe(Wn,this._map(it,Yn)))}it[Et+4]=mr,bt.push(Jn/Zn,ai/Zn,1/0,mr,-1,Zn),Xe&&bt.push(Ai)}else{for(let Wn=0;Wn<Ct;Wn++)bt.push(it[Et+Wn]);if(Zn>1)for(const Wn of cn){const Jn=Wn*Ct;if(!(it[Jn+2]<=be)){it[Jn+2]=be;for(let ai=0;ai<Ct;ai++)bt.push(it[Jn+ai])}}}}return bt}_getOriginId(ge){return ge-this.points.length>>5}_getOriginZoom(ge){return(ge-this.points.length)%32}_map(ge,be,ke){if(ge[be+Ut]>1){const et=this.clusterProps[ge[be+wn]];return ke?Object.assign({},et):et}const qe=this.points[ge[be+nn]].properties,Xe=this.options.map(qe);return ke&&Xe===qe?Object.assign({},Xe):Xe}}function we(wt,ge,be){return{type:"Feature",id:wt[ge+nn],properties:Rr(wt,ge,be),geometry:{type:"Point",coordinates:[(ke=wt[ge],360*(ke-.5)),Gt(wt[ge+1])]}};var ke}function Rr(wt,ge,be){const ke=wt[ge+Ut],qe=ke>=1e4?`${Math.round(ke/1e3)}k`:ke>=1e3?Math.round(ke/100)/10+"k":ke,Xe=wt[ge+wn],et=Xe===-1?{}:Object.assign({},be[Xe]);return Object.assign(et,{cluster:!0,cluster_id:wt[ge+nn],point_count:ke,point_count_abbreviated:qe})}function Mr(wt){return wt/360+.5}function yi(wt){const ge=Math.sin(wt*Math.PI/180),be=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return be<0?0:be>1?1:be}function Gt(wt){const ge=(180-360*wt)*Math.PI/180;return 360*Math.atan(Math.exp(ge))/Math.PI-90}function Io(wt,ge,be,ke){let qe=ke;const Xe=ge+(be-ge>>1);let et,_t=be-ge;const it=wt[ge],bt=wt[ge+1],Ct=wt[be],Et=wt[be+1];for(let Wt=ge+3;Wt<be;Wt+=3){const sn=qi(wt[Wt],wt[Wt+1],it,bt,Ct,Et);if(sn>qe)et=Wt,qe=sn;else if(sn===qe){const cn=Math.abs(Wt-Xe);cn<_t&&(et=Wt,_t=cn)}}qe>ke&&(et-ge>3&&Io(wt,ge,et,ke),wt[et+2]=qe,be-et>3&&Io(wt,et,be,ke))}function qi(wt,ge,be,ke,qe,Xe){let et=qe-be,_t=Xe-ke;if(et!==0||_t!==0){const it=((wt-be)*et+(ge-ke)*_t)/(et*et+_t*_t);it>1?(be=qe,ke=Xe):it>0&&(be+=et*it,ke+=_t*it)}return et=wt-be,_t=ge-ke,et*et+_t*_t}function Ji(wt,ge,be,ke){const qe={id:wt??null,type:ge,geometry:be,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")cr(qe,be);else if(ge==="Polygon")cr(qe,be[0]);else if(ge==="MultiLineString")for(const Xe of be)cr(qe,Xe);else if(ge==="MultiPolygon")for(const Xe of be)cr(qe,Xe[0]);return qe}function cr(wt,ge){for(let be=0;be<ge.length;be+=3)wt.minX=Math.min(wt.minX,ge[be]),wt.minY=Math.min(wt.minY,ge[be+1]),wt.maxX=Math.max(wt.maxX,ge[be]),wt.maxY=Math.max(wt.maxY,ge[be+1])}function Yr(wt,ge,be,ke){if(!ge.geometry)return;const qe=ge.geometry.coordinates;if(qe&&qe.length===0)return;const Xe=ge.geometry.type,et=Math.pow(be.tolerance/((1<<be.maxZoom)*be.extent),2);let _t=[],it=ge.id;if(be.promoteId?it=ge.properties[be.promoteId]:be.generateId&&(it=ke||0),Xe==="Point")Bs(qe,_t);else if(Xe==="MultiPoint")for(const bt of qe)Bs(bt,_t);else if(Xe==="LineString")Ia(qe,_t,et,!1);else if(Xe==="MultiLineString"){if(be.lineMetrics){for(const bt of qe)_t=[],Ia(bt,_t,et,!1),wt.push(Ji(it,"LineString",_t,ge.properties));return}so(qe,_t,et,!1)}else if(Xe==="Polygon")so(qe,_t,et,!0);else{if(Xe!=="MultiPolygon"){if(Xe==="GeometryCollection"){for(const bt of ge.geometry.geometries)Yr(wt,{id:it,geometry:bt,properties:ge.properties},be,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const bt of qe){const Ct=[];so(bt,Ct,et,!0),_t.push(Ct)}}wt.push(Ji(it,Xe,_t,ge.properties))}function Bs(wt,ge){ge.push(Ma(wt[0]),er(wt[1]),0)}function Ia(wt,ge,be,ke){let qe,Xe,et=0;for(let it=0;it<wt.length;it++){const bt=Ma(wt[it][0]),Ct=er(wt[it][1]);ge.push(bt,Ct,0),it>0&&(et+=ke?(qe*Ct-bt*Xe)/2:Math.sqrt(Math.pow(bt-qe,2)+Math.pow(Ct-Xe,2))),qe=bt,Xe=Ct}const _t=ge.length-3;ge[2]=1,Io(ge,0,_t,be),ge[_t+2]=1,ge.size=Math.abs(et),ge.start=0,ge.end=ge.size}function so(wt,ge,be,ke){for(let qe=0;qe<wt.length;qe++){const Xe=[];Ia(wt[qe],Xe,be,ke),ge.push(Xe)}}function Ma(wt){return wt/360+.5}function er(wt){const ge=Math.sin(wt*Math.PI/180),be=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return be<0?0:be>1?1:be}function _s(wt,ge,be,ke,qe,Xe,et,_t){if(ke/=ge,Xe>=(be/=ge)&&et<ke)return wt;if(et<be||Xe>=ke)return null;const it=[];for(const bt of wt){const Ct=bt.geometry;let Et=bt.type;const Wt=qe===0?bt.minX:bt.minY,sn=qe===0?bt.maxX:bt.maxY;if(Wt>=be&&sn<ke){it.push(bt);continue}if(sn<be||Wt>=ke)continue;let cn=[];if(Et==="Point"||Et==="MultiPoint")Pa(Ct,cn,be,ke,qe);else if(Et==="LineString")Kl(Ct,cn,be,ke,qe,!1,_t.lineMetrics);else if(Et==="MultiLineString")Aa(Ct,cn,be,ke,qe,!1);else if(Et==="Polygon")Aa(Ct,cn,be,ke,qe,!0);else if(Et==="MultiPolygon")for(const Gn of Ct){const Zn=[];Aa(Gn,Zn,be,ke,qe,!0),Zn.length&&cn.push(Zn)}if(cn.length){if(_t.lineMetrics&&Et==="LineString"){for(const Gn of cn)it.push(Ji(bt.id,Et,Gn,bt.tags));continue}Et!=="LineString"&&Et!=="MultiLineString"||(cn.length===1?(Et="LineString",cn=cn[0]):Et="MultiLineString"),Et!=="Point"&&Et!=="MultiPoint"||(Et=cn.length===3?"Point":"MultiPoint"),it.push(Ji(bt.id,Et,cn,bt.tags))}}return it.length?it:null}function Pa(wt,ge,be,ke,qe){for(let Xe=0;Xe<wt.length;Xe+=3){const et=wt[Xe+qe];et>=be&&et<=ke&&jo(ge,wt[Xe],wt[Xe+1],wt[Xe+2])}}function Kl(wt,ge,be,ke,qe,Xe,et){let _t=Mo(wt);const it=qe===0?xl:bl;let bt,Ct,Et=wt.start;for(let Zn=0;Zn<wt.length-3;Zn+=3){const Wn=wt[Zn],Jn=wt[Zn+1],ai=wt[Zn+2],Ai=wt[Zn+3],mr=wt[Zn+4],Zr=qe===0?Wn:Jn,Yn=qe===0?Ai:mr;let Kr=!1;et&&(bt=Math.sqrt(Math.pow(Wn-Ai,2)+Math.pow(Jn-mr,2))),Zr<be?Yn>be&&(Ct=it(_t,Wn,Jn,Ai,mr,be),et&&(_t.start=Et+bt*Ct)):Zr>ke?Yn<ke&&(Ct=it(_t,Wn,Jn,Ai,mr,ke),et&&(_t.start=Et+bt*Ct)):jo(_t,Wn,Jn,ai),Yn<be&&Zr>=be&&(Ct=it(_t,Wn,Jn,Ai,mr,be),Kr=!0),Yn>ke&&Zr<=ke&&(Ct=it(_t,Wn,Jn,Ai,mr,ke),Kr=!0),!Xe&&Kr&&(et&&(_t.end=Et+bt*Ct),ge.push(_t),_t=Mo(wt)),et&&(Et+=bt)}let Wt=wt.length-3;const sn=wt[Wt],cn=wt[Wt+1],Gn=qe===0?sn:cn;Gn>=be&&Gn<=ke&&jo(_t,sn,cn,wt[Wt+2]),Wt=_t.length-3,Xe&&Wt>=3&&(_t[Wt]!==_t[0]||_t[Wt+1]!==_t[1])&&jo(_t,_t[0],_t[1],_t[2]),_t.length&&ge.push(_t)}function Mo(wt){const ge=[];return ge.size=wt.size,ge.start=wt.start,ge.end=wt.end,ge}function Aa(wt,ge,be,ke,qe,Xe){for(const et of wt)Kl(et,ge,be,ke,qe,Xe,!1)}function jo(wt,ge,be,ke){wt.push(ge,be,ke)}function xl(wt,ge,be,ke,qe,Xe){const et=(Xe-ge)/(ke-ge);return jo(wt,Xe,be+(qe-be)*et,1),et}function bl(wt,ge,be,ke,qe,Xe){const et=(Xe-be)/(qe-be);return jo(wt,ge+(ke-ge)*et,Xe,1),et}function Du(wt,ge){const be=[];for(let ke=0;ke<wt.length;ke++){const qe=wt[ke],Xe=qe.type;let et;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")et=Nu(qe.geometry,ge);else if(Xe==="MultiLineString"||Xe==="Polygon"){et=[];for(const _t of qe.geometry)et.push(Nu(_t,ge))}else if(Xe==="MultiPolygon"){et=[];for(const _t of qe.geometry){const it=[];for(const bt of _t)it.push(Nu(bt,ge));et.push(it)}}be.push(Ji(qe.id,Xe,et,qe.tags))}return be}function Nu(wt,ge){const be=[];be.size=wt.size,wt.start!==void 0&&(be.start=wt.start,be.end=wt.end);for(let ke=0;ke<wt.length;ke+=3)be.push(wt[ke]+ge,wt[ke+1],wt[ke+2]);return be}function js(wt,ge){if(wt.transformed)return wt;const be=1<<wt.z,ke=wt.x,qe=wt.y;for(const Xe of wt.features){const et=Xe.geometry,_t=Xe.type;if(Xe.geometry=[],_t===1)for(let it=0;it<et.length;it+=2)Xe.geometry.push(Jl(et[it],et[it+1],ge,be,ke,qe));else for(let it=0;it<et.length;it++){const bt=[];for(let Ct=0;Ct<et[it].length;Ct+=2)bt.push(Jl(et[it][Ct],et[it][Ct+1],ge,be,ke,qe));Xe.geometry.push(bt)}}return wt.transformed=!0,wt}function Jl(wt,ge,be,ke,qe,Xe){return[Math.round(be*(wt*ke-qe)),Math.round(be*(ge*ke-Xe))]}function vi(wt,ge,be,ke,qe){const Xe=ge===qe.maxZoom?0:qe.tolerance/((1<<ge)*qe.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:wt.length,source:null,x:be,y:ke,z:ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _t of wt)Hr(et,_t,Xe,qe);return et}function Hr(wt,ge,be,ke){const qe=ge.geometry,Xe=ge.type,et=[];if(wt.minX=Math.min(wt.minX,ge.minX),wt.minY=Math.min(wt.minY,ge.minY),wt.maxX=Math.max(wt.maxX,ge.maxX),wt.maxY=Math.max(wt.maxY,ge.maxY),Xe==="Point"||Xe==="MultiPoint")for(let _t=0;_t<qe.length;_t+=3)et.push(qe[_t],qe[_t+1]),wt.numPoints++,wt.numSimplified++;else if(Xe==="LineString")Vs(et,qe,wt,be,!1,!1);else if(Xe==="MultiLineString"||Xe==="Polygon")for(let _t=0;_t<qe.length;_t++)Vs(et,qe[_t],wt,be,Xe==="Polygon",_t===0);else if(Xe==="MultiPolygon")for(let _t=0;_t<qe.length;_t++){const it=qe[_t];for(let bt=0;bt<it.length;bt++)Vs(et,it[bt],wt,be,!0,bt===0)}if(et.length){let _t=ge.tags||null;if(Xe==="LineString"&&ke.lineMetrics){_t={};for(const bt in ge.tags)_t[bt]=ge.tags[bt];_t.mapbox_clip_start=qe.start/qe.size,_t.mapbox_clip_end=qe.end/qe.size}const it={geometry:et,type:Xe==="Polygon"||Xe==="MultiPolygon"?3:Xe==="LineString"||Xe==="MultiLineString"?2:1,tags:_t};ge.id!==null&&(it.id=ge.id),wt.features.push(it)}}function Vs(wt,ge,be,ke,qe,Xe){const et=ke*ke;if(ke>0&&ge.size<(qe?et:ke))return void(be.numPoints+=ge.length/3);const _t=[];for(let it=0;it<ge.length;it+=3)(ke===0||ge[it+2]>et)&&(be.numSimplified++,_t.push(ge[it],ge[it+1])),be.numPoints++;qe&&function(it,bt){let Ct=0;for(let Et=0,Wt=it.length,sn=Wt-2;Et<Wt;sn=Et,Et+=2)Ct+=(it[Et]-it[sn])*(it[Et+1]+it[sn+1]);if(Ct>0===bt)for(let Et=0,Wt=it.length;Et<Wt/2;Et+=2){const sn=it[Et],cn=it[Et+1];it[Et]=it[Wt-2-Et],it[Et+1]=it[Wt-1-Et],it[Wt-2-Et]=sn,it[Wt-1-Et]=cn}}(_t,Xe),wt.push(_t)}const ku={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Po{constructor(ge,be){const ke=(be=this.options=function(Xe,et){for(const _t in et)Xe[_t]=et[_t];return Xe}(Object.create(ku),be)).debug;if(ke&&console.time("preprocess data"),be.maxZoom<0||be.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(be.promoteId&&be.generateId)throw new Error("promoteId and generateId cannot be used together.");let qe=function(Xe,et){const _t=[];if(Xe.type==="FeatureCollection")for(let it=0;it<Xe.features.length;it++)Yr(_t,Xe.features[it],et,it);else Yr(_t,Xe.type==="Feature"?Xe:{geometry:Xe},et);return _t}(ge,be);this.tiles={},this.tileCoords=[],ke&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",be.indexMaxZoom,be.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),qe=function(Xe,et){const _t=et.buffer/et.extent;let it=Xe;const bt=_s(Xe,1,-1-_t,_t,0,-1,2,et),Ct=_s(Xe,1,1-_t,2+_t,0,-1,2,et);return(bt||Ct)&&(it=_s(Xe,1,-_t,1+_t,0,-1,2,et)||[],bt&&(it=Du(bt,1).concat(it)),Ct&&(it=it.concat(Du(Ct,-1)))),it}(qe,be),qe.length&&this.splitTile(qe,0,0,0),ke&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ge,be,ke,qe,Xe,et,_t){const it=[ge,be,ke,qe],bt=this.options,Ct=bt.debug;for(;it.length;){qe=it.pop(),ke=it.pop(),be=it.pop(),ge=it.pop();const Et=1<<be,Wt=sa(be,ke,qe);let sn=this.tiles[Wt];if(!sn&&(Ct>1&&console.time("creation"),sn=this.tiles[Wt]=vi(ge,be,ke,qe,bt),this.tileCoords.push({z:be,x:ke,y:qe}),Ct)){Ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",be,ke,qe,sn.numFeatures,sn.numPoints,sn.numSimplified),console.timeEnd("creation"));const Kr=`z${be}`;this.stats[Kr]=(this.stats[Kr]||0)+1,this.total++}if(sn.source=ge,Xe==null){if(be===bt.indexMaxZoom||sn.numPoints<=bt.indexMaxPoints)continue}else{if(be===bt.maxZoom||be===Xe)continue;if(Xe!=null){const Kr=Xe-be;if(ke!==et>>Kr||qe!==_t>>Kr)continue}}if(sn.source=null,ge.length===0)continue;Ct>1&&console.time("clipping");const cn=.5*bt.buffer/bt.extent,Gn=.5-cn,Zn=.5+cn,Wn=1+cn;let Jn=null,ai=null,Ai=null,mr=null,Zr=_s(ge,Et,ke-cn,ke+Zn,0,sn.minX,sn.maxX,bt),Yn=_s(ge,Et,ke+Gn,ke+Wn,0,sn.minX,sn.maxX,bt);ge=null,Zr&&(Jn=_s(Zr,Et,qe-cn,qe+Zn,1,sn.minY,sn.maxY,bt),ai=_s(Zr,Et,qe+Gn,qe+Wn,1,sn.minY,sn.maxY,bt),Zr=null),Yn&&(Ai=_s(Yn,Et,qe-cn,qe+Zn,1,sn.minY,sn.maxY,bt),mr=_s(Yn,Et,qe+Gn,qe+Wn,1,sn.minY,sn.maxY,bt),Yn=null),Ct>1&&console.timeEnd("clipping"),it.push(Jn||[],be+1,2*ke,2*qe),it.push(ai||[],be+1,2*ke,2*qe+1),it.push(Ai||[],be+1,2*ke+1,2*qe),it.push(mr||[],be+1,2*ke+1,2*qe+1)}}getTile(ge,be,ke){ge=+ge,be=+be,ke=+ke;const qe=this.options,{extent:Xe,debug:et}=qe;if(ge<0||ge>24)return null;const _t=1<<ge,it=sa(ge,be=be+_t&_t-1,ke);if(this.tiles[it])return js(this.tiles[it],Xe);et>1&&console.log("drilling down to z%d-%d-%d",ge,be,ke);let bt,Ct=ge,Et=be,Wt=ke;for(;!bt&&Ct>0;)Ct--,Et>>=1,Wt>>=1,bt=this.tiles[sa(Ct,Et,Wt)];return bt&&bt.source?(et>1&&(console.log("found parent tile z%d-%d-%d",Ct,Et,Wt),console.time("drilling down")),this.splitTile(bt.source,Ct,Et,Wt,ge,be,ke),et>1&&console.timeEnd("drilling down"),this.tiles[it]?js(this.tiles[it],Xe):null):null}}function sa(wt,ge,be){return 32*((1<<wt)*be+ge)+wt}function yc(wt,ge){const be=wt.tileID.canonical;if(!this._geoJSONIndex)return void ge(null,null);const ke=this._geoJSONIndex.getTile(be.z,be.x,be.y);if(!ke)return void ge(null,null);const qe=new xe(ke.features);let Xe=Ke(qe);Xe.byteOffset===0&&Xe.byteLength===Xe.buffer.byteLength||(Xe=new Uint8Array(Xe)),ge(null,{vectorTile:qe,rawData:Xe.buffer})}class Lr extends ue{constructor(ge,be,ke,qe,Xe,et){super(ge,be,ke,qe,yc,et),Xe&&(this.loadGeoJSON=Xe),this._dynamicIndex=new je}loadData(ge,be){const ke=ge&&ge.request,qe=ke&&ke.collectResourceTiming;this.loadGeoJSON(ge,(Xe,et)=>{if(Xe||!et)return be(Xe);if(typeof et!="object")return be(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));{try{if(ge.filter){const it=i.X(ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(bt=>`${bt.key}: ${bt.message}`).join(", "));et.features=et.features.filter(bt=>it.value.evaluate({zoom:0},bt))}ge.dynamic?(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),ge.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(et.features,this.loaded),ge.cluster&&(et.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ge.cluster?new Pn(function({superclusterOptions:it,clusterProperties:bt}){if(!bt||!it)return it;const Ct={},Et={},Wt={accumulated:null,zoom:0},sn={properties:null},cn=Object.keys(bt);for(const Gn of cn){const[Zn,Wn]=bt[Gn],Jn=i.X(Wn),ai=i.X(typeof Zn=="string"?[Zn,["accumulated"],["get",Gn]]:Zn);Ct[Gn]=Jn.value,Et[Gn]=ai.value}return it.map=Gn=>{sn.properties=Gn;const Zn={};for(const Wn of cn)Zn[Wn]=Ct[Wn].evaluate(Wt,sn);return Zn},it.reduce=(Gn,Zn)=>{sn.properties=Zn;for(const Wn of cn)Wt.accumulated=Gn[Wn],Gn[Wn]=Et[Wn].evaluate(Wt,sn)},it}(ge)).load(et.features):ge.dynamic?this._dynamicIndex:function(it,bt){return new Po(it,bt)}(et,ge.geojsonVtOptions)}catch(it){return be(it)}const _t={};if(qe){const it=b(ke);it&&(_t.resourceTiming={},_t.resourceTiming[ge.source]=JSON.parse(JSON.stringify(it)))}be(null,_t)}})}reloadTile(ge,be){const ke=this.loaded;return ke&&ke[ge.uid]?ge.partial?be(null,void 0):super.reloadTile(ge,be):this.loadTile(ge,be)}loadGeoJSON(ge,be){if(ge.request)i.n(ge.request,be);else{if(typeof ge.data!="string")return be(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));try{return be(null,JSON.parse(ge.data))}catch{return be(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ge,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ge.clusterId))}catch(ke){be(ke)}}getClusterChildren(ge,be){try{be(null,this._geoJSONIndex.getChildren(ge.clusterId))}catch(ke){be(ke)}}getClusterLeaves(ge,be){try{be(null,this._geoJSONIndex.getLeaves(ge.clusterId,ge.limit,ge.offset))}catch(ke){be(ke)}}}class fo{constructor(ge,be){this.tileID=new i.aH(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),this.tileZoom=ge.tileZoom,this.uid=ge.uid,this.zoom=ge.zoom,this.canonical=ge.tileID.canonical,this.pixelRatio=ge.pixelRatio,this.tileSize=ge.tileSize,this.source=ge.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ge.projection,this.brightness=be}parse(ge,be,ke,qe){this.status="parsing";const Xe=new i.aH(ke.tileID.overscaledZ,ke.tileID.wrap,ke.tileID.canonical.z,ke.tileID.canonical.x,ke.tileID.canonical.y),et=[],_t=be.familiesBySource[ke.source],it=new i.e0(Xe,ke.promoteId);return it.bucketLayerIDs=[],it.is3DTile=!0,i.ei(ge).then(bt=>{if(!bt)return qe(new Error("Could not parse tile"));const Ct=i.ej(bt,1/i.cd(ke.tileID.canonical)),Et=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("MAPBOX_mesh_features")||bt.json.asset.extras&&bt.json.asset.extras.MAPBOX_mesh_features,Wt=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("EXT_meshopt_compression"),sn=new i.aa(this.zoom,{brightness:this.brightness});for(const cn in _t)for(const Gn of _t[cn]){const Zn=Gn[0];it.bucketLayerIDs.push(Gn.map(Jn=>i.C(Jn.id,Jn.scope))),Zn.recalculate(sn,[]);const Wn=new i.ek(Gn,Ct,Xe,Et,Wt,this.brightness,it);Et||(Wn.needsUpload=!0),et.push(Wn),Wn.evaluate(Zn)}this.status="done",qe(null,{buckets:et,featureIndex:it,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(bt=>qe(new Error(bt.message)))}}class Ao{constructor(ge,be,ke,qe,Xe,et){this.actor=ge,this.layerIndex=be,this.availableImages=ke,this.brightness=et,this.loading={},this.loaded={}}loadTile(ge,be){const ke=ge.uid,qe=this.loading[ke]=new fo(ge,this.brightness);i.bj(ge.request,(Xe,et)=>{const _t=!this.loading[ke];return delete this.loading[ke],_t||Xe?(qe.status="done",_t||(this.loaded[ke]=qe),be(Xe)):et&&et.byteLength!==0?void qe.parse(et,this.layerIndex,ge,(it,bt)=>{qe.status="done",this.loaded=this.loaded||{},this.loaded[ke]=qe,it||!bt?be(it):be(null,bt)}):(qe.status="done",this.loaded[ke]=qe,be())})}reloadTile(ge,be){const ke=this.loaded,qe=ge.uid;if(ke&&ke[qe]){const Xe=ke[qe];Xe.projection=ge.projection,Xe.brightness=ge.brightness;const et=(_t,it)=>{Xe.reloadCallback&&(delete Xe.reloadCallback,this.loadTile(ge,be)),be(_t,it)};Xe.status==="parsing"?Xe.reloadCallback=et:Xe.status==="done"&&this.loadTile(ge,be)}}abortTile(ge,be){const ke=ge.uid;this.loading[ke]&&delete this.loading[ke],be()}removeTile(ge,be){const ke=this.loaded,qe=ge.uid;ke&&ke[qe]&&delete ke[qe],be()}}class Xo{constructor(ge){this.self=ge,this.actor=new i.el(ge,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:ue,geojson:Lr,"raster-dem":ie,"raster-array":ee,"batched-model":Ao},this.workerSources={},this.self.registerWorkerSource=(be,ke)=>{if(this.workerSourceTypes[be])throw new Error(`Worker source with name "${be}" already registered.`);this.workerSourceTypes[be]=ke},this.self.registerRTLTextPlugin=be=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=be.applyArabicShaping,i.em.processBidirectionalText=be.processBidirectionalText,i.em.processStyledBidirectionalText=be.processStyledBidirectionalText}}clearCaches(ge,be,ke){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],ke()}checkIfReady(ge,be,ke){ke()}setReferrer(ge,be){this.referrer=be}spriteLoaded(ge,{scope:be,isLoaded:ke}){if(this.isSpriteLoaded[ge]||(this.isSpriteLoaded[ge]={}),this.isSpriteLoaded[ge][be]=ke,this.workerSources[ge]&&this.workerSources[ge][be])for(const qe in this.workerSources[ge][be]){const Xe=this.workerSources[ge][be][qe];for(const et in Xe){const _t=Xe[et];_t instanceof ue&&(_t.isSpriteLoaded=ke,_t.fire(new i.A("isSpriteLoaded")))}}}setImages(ge,{scope:be,images:ke},qe){if(this.availableImages[ge]||(this.availableImages[ge]={}),this.availableImages[ge][be]=ke,this.workerSources[ge]&&this.workerSources[ge][be]){for(const Xe in this.workerSources[ge][be]){const et=this.workerSources[ge][be][Xe];for(const _t in et)et[_t].availableImages=ke}qe()}else qe()}setProjection(ge,be){this.projections[ge]=i.bP(be)}setBrightness(ge,be,ke){this.brightness=be,ke()}setLayers(ge,be,ke){this.getLayerIndex(ge,be.scope).replace(be.layers,be.options),ke()}updateLayers(ge,be,ke){this.getLayerIndex(ge,be.scope).update(be.layers,be.removedIds,be.options),ke()}loadTile(ge,be,ke){be.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,be.type,be.source,be.scope).loadTile(be,ke)}decodeRasterArray(ge,be,ke){this.getWorkerSource(ge,be.type,be.source,be.scope).decodeRasterArray(be,ke)}reloadTile(ge,be,ke){be.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,be.type,be.source,be.scope).reloadTile(be,ke)}abortTile(ge,be,ke){this.getWorkerSource(ge,be.type,be.source,be.scope).abortTile(be,ke)}removeTile(ge,be,ke){this.getWorkerSource(ge,be.type,be.source,be.scope).removeTile(be,ke)}removeSource(ge,be,ke){if(!(this.workerSources[ge]&&this.workerSources[ge][be.scope]&&this.workerSources[ge][be.scope][be.type]&&this.workerSources[ge][be.scope][be.type][be.source]))return;const qe=this.workerSources[ge][be.scope][be.type][be.source];delete this.workerSources[ge][be.scope][be.type][be.source],qe.removeSource!==void 0?qe.removeSource(be,ke):ke()}loadWorkerSource(ge,be,ke){try{this.self.importScripts(be.url),ke()}catch(qe){ke(qe.toString())}}syncRTLPluginState(ge,be,ke){try{i.em.setState(be);const qe=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&qe!=null){this.self.importScripts(qe);const Xe=i.em.isParsed();ke(Xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${qe}`),Xe)}}catch(qe){ke(qe.toString())}}setDracoUrl(ge,be){this.dracoUrl=be}getAvailableImages(ge,be){this.availableImages[ge]||(this.availableImages[ge]={});let ke=this.availableImages[ge][be];return ke||(ke=[]),ke}getLayerIndex(ge,be){this.layerIndexes[ge]||(this.layerIndexes[ge]={});let ke=this.layerIndexes[ge][be];return ke||(ke=this.layerIndexes[ge][be]=new R,ke.scope=be),ke}getWorkerSource(ge,be,ke,qe){const Xe=this.workerSources;return Xe[ge]||(Xe[ge]={}),Xe[ge][qe]||(Xe[ge][qe]={}),Xe[ge][qe][be]||(Xe[ge][qe][be]={}),this.isSpriteLoaded[ge]||(this.isSpriteLoaded[ge]={}),Xe[ge][qe][be][ke]||(Xe[ge][qe][be][ke]=new this.workerSourceTypes[be]({send:(et,_t,it,bt,Ct,Et)=>{this.actor.send(et,_t,it,ge,Ct,Et)},scheduler:this.actor.scheduler},this.getLayerIndex(ge,qe),this.getAvailableImages(ge,qe),this.isSpriteLoaded[ge][qe],void 0,this.brightness)),Xe[ge][qe][be][ke]}rasterizeImages(ge,be,ke){const qe=new Map;for(const[Xe,{image:et,imageVariant:_t}]of be.tasks.entries()){const it=this.imageRasterizer.rasterize(_t,et,be.scope,ge);qe.set(Xe,it)}ke(void 0,qe)}removeRasterizedImages(ge,be,ke){this.imageRasterizer.removeImagesFromCacheByIds(be.imageIds,be.scope,ge),ke()}enforceCacheSizeLimit(ge,be){i.en(be)}getWorkerPerformanceMetrics(ge,be,ke){ke(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Xo(self)),Xo}),u(["./shared"],function(i){var b="3.11.1";const C={create:"create",load:"load",fullLoad:"fullLoad"},A={mark(_){performance.mark(_)},measure(_,s,c){performance.measure(_,s,c)}};function R(_){const s=_.name.split("?")[0];return i.a(s)&&s.includes("mapbox-gl.js")?"javascript":i.a(s)&&s.includes("mapbox-gl.css")?"css":i.b(s)?"fontRange":i.c(s)?"sprite":i.i(s)?"style":i.d(s)?"tilejson":"other"}var z,V={},W=function(){if(z)return V;function _(g){return!s(g)}function s(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,I,k=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(k);try{I=new Worker(j),E=!0}catch{E=!1}return I&&I.terminate(),URL.revokeObjectURL(j),E}()?function(){var E=document.createElement("canvas");E.width=E.height=1;var I=E.getContext("2d");if(!I)return!1;var k=I.getImageData(0,0,1,1);return k&&k.width===E.width}()?(c[x=g&&g.failIfMajorPerformanceCaveat]===void 0&&(c[x]=function(E){var I,k=function(j){var U=document.createElement("canvas"),$=Object.create(_.webGLContextAttributes);return $.failIfMajorPerformanceCaveat=j,U.getContext("webgl2",$)}(E);if(!k)return!1;try{I=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!I||k.isContextLost())&&(k.shaderSource(I,"void main() {}"),k.compileShader(I),k.getShaderParameter(I,k.COMPILE_STATUS)===!0)}(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}z=1,V.supported=_,V.notSupportedReason=s;var c={};return _.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},V}();function X(_,s,c){const g=document.createElement(_);return s!=null&&(g.className=s),c&&c.appendChild(g),g}function ue(_,s,c){const g=document.createElementNS("http://www.w3.org/2000/svg",_);for(const x of Object.keys(s))g.setAttributeNS(null,x,String(s[x]));return c&&c.appendChild(g),g}const ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,K=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ee;function ae(){ie&&K&&(ee=ie[K],ie[K]="none")}function he(){ie&&K&&(ie[K]=ee)}function xe(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",xe,!0)}function ye(){window.addEventListener("click",xe,!0),window.setTimeout(()=>{window.removeEventListener("click",xe,!0)},0)}function Se(_,s){const c=_.getBoundingClientRect();return De(_,c,s)}function je(_,s){const c=_.getBoundingClientRect(),g=[];for(let x=0;x<s.length;x++)g.push(De(_,c,s[x]));return g}function Re(_){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&_.button===2&&_.ctrlKey?0:_.button}function De(_,s,c){const g=_.offsetWidth===s.width?1:_.offsetWidth/s.width;return new i.P((c.clientX-s.left)*g,(c.clientY-s.top)*g)}const at="01",ot="NO_ACCESS_TOKEN";class Fe{constructor(s,c,g){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const s=function(){let c="";for(let g=0;g<10;g++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!i.f(s))return s;const g=Ve(s);return g.params.push(`sdk=js-${b}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!i.f(s))return s;const g=Ve(s);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeModelURL(s,c){if(!i.f(s))return s;const g=Ve(s);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeSourceURL(s,c,g,x){if(!i.f(s))return s;const E=Ve(s);return E.path=`/v4/${E.authority}.json`,E.params.push("secure"),g&&E.params.push(`language=${g}`),x&&E.params.push(`worldview=${x}`),this._makeAPIURL(E,this._customAccessToken||c)}normalizeIconsetURL(s,c){const g=Ve(s);return i.f(s)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||c)):mt(g)}normalizeSpriteURL(s,c,g,x){const E=Ve(s);return i.f(s)?(E.path=`/styles/v1${E.path}/sprite${c}${g}`,this._makeAPIURL(E,this._customAccessToken||x)):(E.path+=`${c}${g}`,mt(E))}normalizeTileURL(s,c,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!i.f(s))return s;const x=Ve(s);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||g&&x.authority!=="raster"&&g===512?"@2x":""}${i.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${i.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${i.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${i.e.TILE_URL_VERSION}${x.path}`);const E=this._customAccessToken||function(I){for(const k of I){const j=k.match(/^access_token=(.*)$/);if(j)return j[1]}return null}(x.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,E)}canonicalizeTileURL(s,c){const g=Ve(s);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return s;let x="mapbox://";g.path.match(/^\/raster\/v1\//)?x+=`raster/${g.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${g.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${g.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let E=g.params;return c&&(E=E.filter(I=>!I.match(/^access_token=/))),E.length&&(x+=`?${E.join("&")}`),x}canonicalizeTileset(s,c){const g=!!c&&i.f(c),x=[];for(const E of s.tiles||[])i.h(E)?x.push(this.canonicalizeTileURL(E,g)):x.push(E);return x}_makeAPIURL(s,c){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Ve(i.e.API_URL);if(s.protocol=x.protocol,s.authority=x.authority,s.protocol==="http"){const E=s.params.indexOf("secure");E>=0&&s.params.splice(E,1)}if(x.path!=="/"&&(s.path=`${x.path}${s.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return mt(s);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return s.params=s.params.filter(E=>E.indexOf("access_token")===-1),s.params.push(`access_token=${c||""}`),mt(s)}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ve(_){const s=_.match(Ze);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function mt(_){const s=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${s}`}const We="mapbox.eventData";function tt(_){if(!_)return null;const s=_.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(i.j(s[1]))}catch{return null}}class Dt{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=tt(i.e.ACCESS_TOKEN);let g="";return g=c&&c.u?i.k(c.u):i.e.ACCESS_TOKEN||"",s?`${We}.${s}:${g}`:`${We}:${g}`}fetchEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{const x=localStorage.getItem(c);x&&(this.eventData=JSON.parse(x));const E=localStorage.getItem(g);E&&(this.anonId=E)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.anonId;if(s&&x)try{localStorage.setItem(g,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,g,x){if(!i.e.EVENTS_URL)return;const E=Ve(i.e.EVENTS_URL);E.params.push(`access_token=${x||i.e.ACCESS_TOKEN||""}`);const I={event:this.type,created:new Date(s).toISOString()},k=c?i.l(I,c):I,j={url:mt(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=i.p(j,U=>{this.pendingRequest=null,g(U),this.saveEventData(),this.processRequests(x)})}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}const $e=new class extends Dt{constructor(_){super("appUserTurnstile"),this._customAccessToken=_}postTurnstileEvent(_,s){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(_)&&_.some(c=>i.f(c)||i.h(c))&&this.queueRequest(Date.now(),s)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=tt(i.e.ACCESS_TOKEN),c=s?s.u:i.e.ACCESS_TOKEN;let g=c!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),g=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),I=new Date(x),k=(x-this.eventData.lastSuccess)/864e5;g=g||k>=1||k<-1||E.getDate()!==I.getDate()}else g=!0;g?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:b,skuId:at,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},_):this.processRequests()}},Ke=$e.postTurnstileEvent.bind($e),gt=new class extends Dt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(_,s,c,g){this.skuToken=s,this.errorCb=g,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:_,timestamp:Date.now()},c):this.errorCb(new Error(ot)))}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:b,skuId:at,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},_))}remove(){this.errorCb=null}},Yt=gt.postMapLoadEvent.bind(gt),Kt=new class extends Dt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(_){let s=this.mapInstanceIdMap.get(_);return s||(s=i.u(),this.mapInstanceIdMap.set(_,s)),s}getEventId(_){const s=this.eventIdPerMapInstanceMap.get(_)||0;return this.eventIdPerMapInstanceMap.set(_,s+1),s}postStyleLoadEvent(_,s){const{map:c,style:g,importedStyles:x}=s;if(!i.e.EVENTS_URL||!_&&!i.e.ACCESS_TOKEN)return;const E=this.getMapInstanceId(c),I={mapInstanceId:E,eventId:this.getEventId(E),style:g};x.length&&(I.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:I},_)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,()=>{},_)}},nn=Kt.postStyleLoadEvent.bind(Kt),Ut=new class extends Dt{constructor(){super("gljs.performance")}postPerformanceEvent(_,s){i.e.EVENTS_URL&&(_||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},_)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:c}=this.queue.shift(),g=function(x){const E=performance.getEntriesByType("resource"),I=performance.getEntriesByType("mark"),k=function(oe){const pe={};if(oe){for(const ce in oe)if(ce!=="other")for(const me of oe[ce]){const ve=`${ce}ResolveRangeMin`,Ee=`${ce}ResolveRangeMax`,Pe=`${ce}RequestCount`,Ie=`${ce}RequestCachedCount`;pe[ve]=Math.min(pe[ve]||1/0,me.startTime),pe[Ee]=Math.max(pe[Ee]||-1/0,me.responseEnd);const Be=Oe=>{pe[Oe]===void 0&&(pe[Oe]=0),++pe[Oe]};me.transferSize!==void 0&&me.transferSize===0&&Be(Ie),Be(Pe)}}return pe}(function(oe,pe){const ce={};if(oe)for(const me of oe){const ve=pe(me);ce[ve]===void 0&&(ce[ve]=[]),ce[ve].push(me)}return ce}(E,R)),j=window.devicePixelRatio,U=navigator.connection||navigator.mozConnection||navigator.webkitConnection,$=U?U.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},J=(oe,pe,ce)=>{ce!=null&&oe.push({name:pe,value:ce.toString()})};for(const oe in k)J(Q.counters,oe,k[oe]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(J(Q.counters,"interactionRangeMin",x.interactionRange[0]),J(Q.counters,"interactionRangeMax",x.interactionRange[1])),I)for(const oe of Object.keys(C)){const pe=C[oe],ce=I.find(me=>me.name===pe);ce&&J(Q.counters,pe,ce.startTime)}return J(Q.counters,"visibilityHidden",x.visibilityHidden),J(Q.attributes,"style",function(oe){if(oe)for(const pe of oe){const ce=pe.name.split("?")[0];if(i.i(ce)){const me=ce.split("/").slice(-2);if(me.length===2)return`mapbox://styles/${me[0]}/${me[1]}`}}}(E)),J(Q.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),J(Q.attributes,"fogEnabled",x.fogEnabled?"true":"false"),J(Q.attributes,"projection",x.projection),J(Q.attributes,"zoom",x.zoom),J(Q.metadata,"devicePixelRatio",j),J(Q.metadata,"connectionEffectiveType",$),J(Q.metadata,"navigatorUserAgent",navigator.userAgent),J(Q.metadata,"screenWidth",window.screen.width),J(Q.metadata,"screenHeight",window.screen.height),J(Q.metadata,"windowWidth",window.innerWidth),J(Q.metadata,"windowHeight",window.innerHeight),J(Q.metadata,"mapWidth",x.width/j),J(Q.metadata,"mapHeight",x.height/j),J(Q.metadata,"webglRenderer",x.renderer),J(Q.metadata,"webglVendor",x.vendor),J(Q.metadata,"sdkVersion",b),J(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q}(c);for(const x of g.metadata);for(const x of g.counters);for(const x of g.attributes);this.postEvent(s,g,()=>{},_)}},wn=Ut.postPerformanceEvent.bind(Ut),Pn=new class extends Dt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(_,s,c,g){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const x=Ve(i.e.API_URL+i.e.SESSION_PATH);x.params.push(`sku=${s||""}`),x.params.push(`access_token=${g||i.e.ACCESS_TOKEN||""}`);const E={url:mt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(E,I=>{this.pendingRequest=null,c(I),this.saveEventData(),this.processRequests(g)})}getSessionAPI(_,s,c,g){this.skuToken=s,this.errorCb=g,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:_,timestamp:Date.now()},c):this.errorCb(new Error(ot)))}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},_)}remove(){this.errorCb=null}},we=Pn.getSessionAPI.bind(Pn),Rr=new Set;function Mr(_,s){s?Rr.add(_):Rr.delete(_)}class yi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Gt(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class Io extends i.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new i.r({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const c=this.atlasTexture.get(s);c&&(c.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(s.id,s)}removeImageProvider(s,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(s)}getPendingImageProviders(){const s=[];for(const c of this.imageProviders.values())for(const g of c.values())g.hasPendingRequests()&&s.push(g);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,c){if(this.loaded.get(c)!==s&&(this.loaded.set(c,s),s)){for(const{ids:g,callback:x}of this.requestors)this._notify(g,c,x);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images.get(c).get(s.toString())}addImage(s,c,g){this._validate(s,g)&&this.images.get(c).set(s.toString(),g)}_validate(s,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.z(new Error(`Image "${s.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.z(new Error(`Image "${s.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new i.z(new Error(`Image "${s.name}" has invalid "content" value`))),g=!1),g}_validateStretch(s,c){if(!s)return!0;let g=0;for(const x of s){if(x[0]<g||x[1]<x[0]||c<x[1])return!1;g=x[1]}return!0}_validateContent(s,c){return s?s.length!==4||!c.usvg&&(s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,c,g){const x=this.images.get(c).get(s.toString());g.version=x.version+1,this.images.get(c).set(s.toString(),g),this.updatedImages.get(c).add(s),this.removeFromImageRasterizerCache(s,c)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,c){if(this.spriteFormat!=="raster")if(i.t()){const g={imageIds:[s],scope:c};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",g)}else this.imageRasterizer.removeImagesFromCacheByIds([s],c)}removeImage(s,c){const g=this.images.get(c),x=g.get(s.toString());g.delete(s.toString()),this.patterns.get(c).delete(s.toString()),this.removeFromImageRasterizerCache(s,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(c=>i.I.from(c))}getImages(s,c,g){const x=[],E=[],I=this.imageProviders.get(c);for(const $ of s){if(!$.iconsetId){x.push($);continue}const Q=I.get($.iconsetId);Q&&(this.getImage($,c)?E.push($):Q.addPendingRequest($))}if(x.length===0)return void this._notify(E,c,g);let k=!0;const j=!!this.loaded.get(c),U=this.images.get(c);if(!j)for(const $ of x)U.has($.toString())||(k=!1);j||k?this._notify(x,c,g):this.requestors.push({ids:x,scope:c,callback:g})}rasterizeImages({scope:s,tasks:c},g){const x=new Map;for(const[E,I]of c.entries()){const k=this.getImage(I.id,s);k&&x.set(E,{image:k,imageVariant:I})}this._rasterizeImages(s,x,g)}_rasterizeImages(s,c,g){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:c,scope:s},g);else{const x=new Map;for(const[E,{image:I,imageVariant:k}]of c.entries())x.set(E,this.imageRasterizer.rasterize(k,I,s,0));g(void 0,x)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,c,g){const x=this.images.get(c),E=new Map;for(const I of s){const k=x.get(I.toString());if(!k){if(I.iconsetId)continue;i.w(`Image "${I.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:I.name}));continue}const j={data:k.usvg?null:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,usvg:k.usvg,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:!!(k.userImage&&k.userImage.render)};k.usvg&&Object.assign(j,{width:k.icon.usvg_tree.width,height:k.icon.usvg_tree.height}),E.set(i.I.toString(I),j)}g(null,E)}getPixelSize(s){const{width:c,height:g}=this.atlasImage.get(s);return{width:c,height:g}}getPattern(s,c,g){const x=s.toString(),E=this.patterns.get(c),I=E.get(x),k=this.getImage(s,c);if(!k)return null;if(I){if(I.position.version===k.version)return I.position;I.position.version=k.version}else{if(k.usvg&&!k.data){const j=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(j))return null;this.patternsInFlight.add(j);const U=new i.B(s).scaleSelf(i.q.devicePixelRatio),$=new Map([[U.toString(),{image:k,imageVariant:U}]]);return this._rasterizeImages(c,$,(Q,J)=>this.storePatternImage(U,c,k,g,J)),null}this.storePattern(s,c,k)}return this._updatePatternAtlas(c,g),E.get(x).position}getPatternInFlightId(s,c){return i.C(s,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,c,g,x,E){const I=s.toString(),k=E?E.get(I):void 0;k&&(g.data=k,this.storePattern(s.id,c,g),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),c)))}storePattern(s,c,g){const x={w:g.data.width+2*i.F,h:g.data.height+2*i.F,x:0,y:0},E=new i.G(x,g,i.F);this.patterns.get(c).set(s.toString(),{bin:x,position:E})}bind(s,c){const g=s.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new i.T(s,this.atlasImage.get(c),g.RGBA8),this.atlasTexture.set(c,x)),x.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const g=this.patterns.get(s),x=Array.from(g.values()).map(({bin:U})=>U),{w:E,h:I}=i.H(x),k=this.atlasImage.get(s);k.resize({width:E||1,height:I||1});const j=this.images.get(s);for(const[U,{bin:$,position:Q}]of g.entries()){let J=Q.padding;const oe=$.x+J,pe=$.y+J,ce=j.get(U).data,me=ce.width,ve=ce.height;J=J>1?J-1:J,i.r.copy(ce,k,{x:0,y:0},{x:oe,y:pe},{width:me,height:ve},c),i.r.copy(ce,k,{x:0,y:ve-J},{x:oe,y:pe-J},{width:me,height:J},c),i.r.copy(ce,k,{x:0,y:0},{x:oe,y:pe+ve},{width:me,height:J},c),i.r.copy(ce,k,{x:me-J,y:0},{x:oe-J,y:pe},{width:J,height:ve},c),i.r.copy(ce,k,{x:0,y:0},{x:oe+me,y:pe},{width:J,height:ve},c),i.r.copy(ce,k,{x:me-J,y:ve-J},{x:oe-J,y:pe-J},{width:J,height:J},c),i.r.copy(ce,k,{x:0,y:ve-J},{x:oe+me,y:pe-J},{width:J,height:J},c),i.r.copy(ce,k,{x:0,y:0},{x:oe+me,y:pe+ve},{width:J,height:J},c),i.r.copy(ce,k,{x:me-J,y:0},{x:oe-J,y:pe+ve},{width:J,height:J},c)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,c){const g=this.images.get(c);for(const x of s){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const E=g.get(x.toString());Gt(E)&&this.updateImage(x,c,E)}}}function qi(_){const s=_.key,c=_.value,g=_.valueSpec||{},x=_.objectElementValidators||{},E=_.style,I=_.styleSpec;let k=[];const j=i.K(c);if(j!=="object")return[new i.V(s,c,`object expected, ${j} found`)];for(const U in c){const $=U.split(".")[0];let Q;x[$]?Q=x[$]:g[$]?Q=Hr:x["*"]?Q=x["*"]:g["*"]&&(Q=Hr),Q?k=k.concat(Q({key:(s&&`${s}.`)+U,value:c[U],valueSpec:g[$]||g["*"],style:E,styleSpec:I,object:c,objectKey:U},c)):k.push(new i.J(s,c[U],`unknown property "${U}"`))}for(const U in g)x[U]||g[U].required&&g[U].default===void 0&&c[U]===void 0&&k.push(new i.V(s,c,`missing required property "${U}"`));return k}function Ji(_){const s=_.value,c=_.valueSpec,g=_.style,x=_.styleSpec,E=_.key,I=_.arrayElementValidator||Hr;if(i.K(s)!=="array")return[new i.V(E,s,`array expected, ${i.K(s)} found`)];if(c.length&&s.length!==c.length)return[new i.V(E,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new i.V(E,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let k={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(k.function=c.function),i.K(c.value)==="object"&&(k=c.value);let j=[];for(let U=0;U<s.length;U++)j=j.concat(I({array:s,arrayIndex:U,value:s[U],valueSpec:k,style:g,styleSpec:x,key:`${E}[${U}]`},!0));return j}function cr(_){const s=_.key,c=_.value,g=_.valueSpec;let x=i.K(c);if(x==="number"&&c!=c&&(x="NaN"),x!=="number")return[new i.V(s,c,`number expected, ${x} found`)];if("minimum"in g){let E=g.minimum;if(i.K(g.minimum)==="array"&&(E=g.minimum[_.arrayIndex]),c<E)return[new i.V(s,c,`${c} is less than the minimum value ${E}`)]}if("maximum"in g){let E=g.maximum;if(i.K(g.maximum)==="array"&&(E=g.maximum[_.arrayIndex]),c>E)return[new i.V(s,c,`${c} is greater than the maximum value ${E}`)]}return[]}function Yr(_){const s=_.valueSpec,c=i.M(_.value.type);let g,x,E,I={};const k=c!=="categorical"&&_.value.property===void 0,j=!k,U=i.K(_.value.stops)==="array"&&i.K(_.value.stops[0])==="array"&&i.K(_.value.stops[0][0])==="object",$=qi({key:_.key,value:_.value,valueSpec:_.styleSpec.function,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(oe){if(c==="identity")return[new i.V(oe.key,oe.value,'identity function may not have a "stops" property')];let pe=[];const ce=oe.value;return pe=pe.concat(Ji({key:oe.key,value:ce,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:Q})),i.K(ce)==="array"&&ce.length===0&&pe.push(new i.V(oe.key,ce,"array must have at least one stop")),pe},default:function(oe){return Hr({key:oe.key,value:oe.value,valueSpec:s,style:oe.style,styleSpec:oe.styleSpec})}}});return c==="identity"&&k&&$.push(new i.V(_.key,_.value,'missing required property "property"')),c==="identity"||_.value.stops||$.push(new i.V(_.key,_.value,'missing required property "stops"')),c==="exponential"&&_.valueSpec.expression&&!i.N(_.valueSpec)&&$.push(new i.V(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(j&&!i.O(_.valueSpec)?$.push(new i.V(_.key,_.value,"property functions not supported")):k&&!i.Q(_.valueSpec)&&$.push(new i.V(_.key,_.value,"zoom functions not supported"))),c!=="categorical"&&!U||_.value.property!==void 0||$.push(new i.V(_.key,_.value,'"property" property is required')),$;function Q(oe){let pe=[];const ce=oe.value,me=oe.key;if(i.K(ce)!=="array")return[new i.V(me,ce,`array expected, ${i.K(ce)} found`)];if(ce.length!==2)return[new i.V(me,ce,`array length 2 expected, length ${ce.length} found`)];if(U){if(i.K(ce[0])!=="object")return[new i.V(me,ce,`object expected, ${i.K(ce[0])} found`)];if(ce[0].zoom===void 0)return[new i.V(me,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new i.V(me,ce,"object stop key must have value")];const ve=i.M(ce[0].zoom);if(typeof ve!="number")return[new i.V(me,ce[0].zoom,"stop zoom values must be numbers")];if(E&&E>ve)return[new i.V(me,ce[0].zoom,"stop zoom values must appear in ascending order")];ve!==E&&(E=ve,x=void 0,I={}),pe=pe.concat(qi({key:`${me}[0]`,value:ce[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:cr,value:J}}))}else pe=pe.concat(J({key:`${me}[0]`,value:ce[0],style:oe.style,styleSpec:oe.styleSpec},ce));return i.S(i.U(ce[1]))?pe.concat([new i.V(`${me}[1]`,ce[1],"expressions are not allowed in function stops.")]):pe.concat(Hr({key:`${me}[1]`,value:ce[1],valueSpec:s,style:oe.style,styleSpec:oe.styleSpec}))}function J(oe,pe){const ce=i.K(oe.value),me=i.M(oe.value),ve=oe.value!==null?oe.value:pe;if(g){if(ce!==g)return[new i.V(oe.key,ve,`${ce} stop domain type must match previous stop domain type ${g}`)]}else g=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean"&&typeof me!="number"&&typeof me!="string"&&typeof me!="boolean")return[new i.V(oe.key,ve,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&c!=="categorical"){let Ee=`number expected, ${ce} found`;return i.O(s)&&c===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(oe.key,ve,Ee)]}return c!=="categorical"||ce!=="number"||typeof me=="number"&&isFinite(me)&&Math.floor(me)===me?c!=="categorical"&&ce==="number"&&typeof me=="number"&&typeof x=="number"&&x!==void 0&&me<x?[new i.V(oe.key,ve,"stop domain values must appear in ascending order")]:(x=me,c==="categorical"&&me in I?[new i.V(oe.key,ve,"stop domain values must be unique")]:(I[me]=!0,[])):[new i.V(oe.key,ve,`integer expected, found ${String(me)}`)]}}function Bs(_){const s=(_.expressionContext==="property"?i.W:i.X)(i.U(_.value),_.valueSpec);if(s.result==="error")return s.value.map(g=>new i.V(`${_.key}${g.key}`,_.value,g.message));const c=s.value.expression||s.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!i.Y(c))return[new i.V(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter")return Ia(c,_);if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!i.Z(c,["zoom","feature-state"]))return[new i.V(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!i._(c))return[new i.V(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ia(_,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const g=[];return _ instanceof i.$&&c.has(_.name)?[new i.V(s.key,s.value,`["${_.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(_.eachChild(x=>{g.push(...Ia(x,s))}),g)}function so(_){const s=_.key,c=_.value,g=_.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(i.M(c))===-1&&x.push(new i.V(s,c,`expected one of [${g.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(g.values).indexOf(i.M(c))===-1&&x.push(new i.V(s,c,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function Ma(_){return i.a1(i.U(_.value))?Bs(i.L({},_,{expressionContext:"filter",valueSpec:_.styleSpec[`filter_${_.layerType||"fill"}`]})):er(_)}function er(_){const s=_.value,c=_.key;if(i.K(s)!=="array")return[new i.V(c,s,`array expected, ${i.K(s)} found`)];const g=_.styleSpec;let x,E=[];if(s.length<1)return[new i.V(c,s,"filter array must have at least 1 element")];switch(E=E.concat(so({key:`${c}[0]`,value:s[0],valueSpec:g.filter_operator,style:_.style,styleSpec:_.styleSpec})),i.M(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.M(s[1])==="$type"&&E.push(new i.V(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&E.push(new i.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(x=i.K(s[1]),x!=="string"&&E.push(new i.V(`${c}[1]`,s[1],`string expected, ${x} found`)));for(let I=2;I<s.length;I++)x=i.K(s[I]),i.M(s[1])==="$type"?E=E.concat(so({key:`${c}[${I}]`,value:s[I],valueSpec:g.geometry_type,style:_.style,styleSpec:_.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&E.push(new i.V(`${c}[${I}]`,s[I],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let I=1;I<s.length;I++)E=E.concat(er({key:`${c}[${I}]`,value:s[I],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":x=i.K(s[1]),s.length!==2?E.push(new i.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):x!=="string"&&E.push(new i.V(`${c}[1]`,s[1],`string expected, ${x} found`))}return E}function _s(_,s){const c=_.key,g=_.style,x=_.layer,E=_.styleSpec,I=_.value,k=_.objectKey,j=E[`${s}_${_.layerType}`];if(!j)return[];const U=k.match(/^(.*)-use-theme$/);if(s==="paint"&&U&&j[U[1]])return i.S(I)?[].concat(Hr({key:_.key,value:I,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:E,expressionContext:"property",propertyType:s,propertyKey:k})):Hr({key:c,value:I,valueSpec:{type:"string"},style:g,styleSpec:E});const $=k.match(/^(.*)-transition$/);if(s==="paint"&&$&&j[$[1]]&&j[$[1]].transition)return Hr({key:c,value:I,valueSpec:E.transition,style:g,styleSpec:E});const Q=_.valueSpec||j[k];if(!Q)return[new i.J(c,I,`unknown property "${k}"`)];let J;if(i.K(I)==="string"&&i.O(Q)&&!Q.tokens&&(J=/^{([^}]+)}$/.exec(I))){const pe=`\`{ "type": "identity", "property": ${J?JSON.stringify(J[1]):'"_"'} }\``;return[new i.V(c,I,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${pe}.`)]}const oe=[];if(_.layerType==="symbol")k!=="text-field"||!g||g.glyphs||g.imports||oe.push(new i.V(c,I,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&i.a2(i.U(I))&&i.M(I.type)==="identity"&&oe.push(new i.V(c,I,'"text-font" does not support identity functions'));else if(_.layerType==="model"&&s==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&i.O(Q)&&(i.a3(Q)||i.Q(Q))){const pe=i.W(i.U(I),Q),ce=pe.value.expression||pe.value._styleExpression.expression;ce&&!i.Z(ce,["measure-light"])&&(k==="model-emissive-strength"&&i._(ce)&&i.Y(ce)||oe.push(new i.V(c,I,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return oe.concat(Hr({key:_.key,value:I,valueSpec:Q,style:g,styleSpec:E,expressionContext:"property",propertyType:s,propertyKey:k}))}function Pa(_){return _s(_,"paint")}function Kl(_){return _s(_,"layout")}function Mo(_){let s=[];const c=_.value,g=_.key,x=_.style,E=_.styleSpec;c.type||c.ref||s.push(new i.V(g,c,'either "type" or "ref" is required'));let I=i.M(c.type);const k=i.M(c.ref);if(c.id){const j=i.M(c.id);for(let U=0;U<_.arrayIndex;U++){const $=x.layers[U];i.M($.id)===j&&s.push(new i.V(g,c.id,`duplicate layer id "${c.id}", previously used at line ${$.id.__line__}`))}}if("ref"in c){let j;["type","source","source-layer","filter","layout"].forEach(U=>{U in c&&s.push(new i.V(g,c[U],`"${U}" is prohibited for ref layers`))}),x.layers.forEach(U=>{i.M(U.id)===k&&(j=U)}),j?j.ref?s.push(new i.V(g,c.ref,"ref cannot reference another ref layer")):I=i.M(j.type):typeof k=="string"&&s.push(new i.V(g,c.ref,`ref layer "${k}" not found`))}else if(I!=="background"&&I!=="sky"&&I!=="slot")if(c.source){const j=x.sources&&x.sources[c.source],U=j&&i.M(j.type);j?U==="vector"&&I==="raster"?s.push(new i.V(g,c.source,`layer "${c.id}" requires a raster source`)):U==="raster"&&I!=="raster"?s.push(new i.V(g,c.source,`layer "${c.id}" requires a vector source`)):U!=="vector"||c["source-layer"]?U==="raster-dem"&&I!=="hillshade"?s.push(new i.V(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):U!=="raster-array"||["raster","raster-particle"].includes(I)?I!=="line"||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||U==="geojson"&&j.lineMetrics?I==="raster-particle"&&U!=="raster-array"&&s.push(new i.V(g,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new i.V(g,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new i.V(g,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(g,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new i.V(g,c.source,`source "${c.source}" not found`))}else s.push(new i.V(g,c,'missing required property "source"'));return s=s.concat(qi({key:g,value:c,valueSpec:E.layer,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hr({key:`${g}.type`,value:c.type,valueSpec:E.layer.type,style:_.style,styleSpec:_.styleSpec,object:c,objectKey:"type"}),filter:j=>Ma(i.L({layerType:I},j)),layout:j=>qi({layer:c,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":U=>Kl(i.L({layerType:I},U))}}),paint:j=>qi({layer:c,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":U=>Pa(i.L({layerType:I,layer:c},U))}})}})),s}function Aa(_){const s=_.value,c=_.key,g=i.K(s);return g!=="string"?[new i.V(c,s,`string expected, ${g} found`)]:[]}const jo={promoteId:function _({key:s,value:c}){if(i.K(c)==="string")return Aa({key:s,value:c});if(Array.isArray(c)){const g=[],x=i.U(c),E=i.X(x);return E.result==="error"&&E.value.forEach(I=>{g.push(new i.V(`${s}${I.key}`,null,`${I.message}`))}),i.Z(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new i.V(`${s}`,null,"promoteId expression should be only feature dependent")),g}{const g=[];for(const x in c)g.push(..._({key:`${s}.${x}`,value:c[x]}));return g}}};function xl(_){const s=_.value,c=_.key,g=_.styleSpec,x=_.style;if(!s.type)return[new i.V(c,s,'"type" is required')];const E=i.M(s.type);let I=[];switch(["vector","raster","raster-dem","raster-array"].includes(E)&&(s.url||s.tiles||I.push(new i.J(c,s,'Either "url" or "tiles" is required.'))),E){case"vector":case"raster":case"raster-dem":case"raster-array":return I=I.concat(qi({key:c,value:s,valueSpec:g[`source_${E.replace("-","_")}`],style:_.style,styleSpec:g,objectElementValidators:jo})),I;case"geojson":if(I=qi({key:c,value:s,valueSpec:g.source_geojson,style:x,styleSpec:g,objectElementValidators:jo}),s.cluster)for(const k in s.clusterProperties){const[j,U]=s.clusterProperties[k],$=typeof j=="string"?[j,["accumulated"],["get",k]]:j;I.push(...Bs({key:`${c}.${k}.map`,value:U,expressionContext:"cluster-map"})),I.push(...Bs({key:`${c}.${k}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return I;case"video":return qi({key:c,value:s,valueSpec:g.source_video,style:x,styleSpec:g});case"image":return qi({key:c,value:s,valueSpec:g.source_image,style:x,styleSpec:g});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return so({key:`${c}.type`,value:s.type,valueSpec:{values:bl(g)}})}}function bl(_){return _.source.reduce((s,c)=>{const g=_[c];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function Du(_){const s=_.value,c=_.styleSpec,g=c.light,x=_.style;let E=[];const I=i.K(s);if(s===void 0)return E;if(I!=="object")return E=E.concat([new i.V("light",s,`object expected, ${I} found`)]),E;for(const k in s){const j=k.match(/^(.*)-transition$/),U=k.match(/^(.*)-use-theme$/);E=E.concat(U&&g[U[1]]?Hr({key:k,value:s[k],valueSpec:{type:"string"},style:x,styleSpec:c}):j&&g[j[1]]&&g[j[1]].transition?Hr({key:k,value:s[k],valueSpec:c.transition,style:x,styleSpec:c}):g[k]?Hr({key:k,value:s[k],valueSpec:g[k],style:x,styleSpec:c}):[new i.V(k,s[k],`unknown property "${k}"`)])}return E}function Nu(_){const s=_.value;let c=[];if(!s)return c;const g=i.K(s);if(g!=="object")return c=c.concat([new i.V("light-3d",s,`object expected, ${g} found`)]),c;const x=_.styleSpec,E=x["light-3d"],I=_.key,k=_.style,j=_.style.lights;for(const Q of["type","id"])if(!(Q in s))return c=c.concat([new i.V("light-3d",s,`missing property ${Q} on light`)]),c;if(s.type&&j)for(let Q=0;Q<_.arrayIndex;Q++){const J=i.M(s.type),oe=j[Q];i.M(oe.type)===J&&c.push(new i.V(I,s.id,`duplicate light type "${s.type}", previously defined at line ${oe.id.__line__}`))}const U=`properties_light_${s.type}`;if(!(U in x))return c=c.concat([new i.V("light-3d",s,`Invalid light type ${s.type}`)]),c;const $=x[U];for(const Q in s)if(Q==="properties"){const J=s[Q],oe=i.K(J);if(oe!=="object")return c=c.concat([new i.V("properties",J,`object expected, ${oe} found`)]),c;for(const pe in J)c=c.concat($[pe]?Hr({key:pe,value:J[pe],valueSpec:$[pe],style:k,styleSpec:x}):[new i.J(_.key,J[pe],`unknown property "${pe}"`)])}else{const J=Q.match(/^(.*)-transition$/),oe=Q.match(/^(.*)-use-theme$/);c=c.concat(oe&&E[oe[1]]?Hr({key:Q,value:s[Q],valueSpec:{type:"string"},style:k,styleSpec:x}):J&&E[J[1]]&&E[J[1]].transition?Hr({key:Q,value:s[Q],valueSpec:x.transition,style:k,styleSpec:x}):E[Q]?Hr({key:Q,value:s[Q],valueSpec:E[Q],style:k,styleSpec:x}):[new i.J(Q,s[Q],`unknown property "${Q}"`)])}return c}function js(_){const s=_.value,c=_.key,g=_.style,x=_.styleSpec,E=x.terrain;let I=[];const k=i.K(s);if(s===void 0||k==="null")return I;if(k!=="object")return I=I.concat([new i.V("terrain",s,`object expected, ${k} found`)]),I;for(const j in s){const U=j.match(/^(.*)-transition$/),$=j.match(/^(.*)-use-theme$/);I=I.concat($&&E[$[1]]?Hr({key:j,value:s[j],valueSpec:{type:"string"},style:g,styleSpec:x}):U&&E[U[1]]&&E[U[1]].transition?Hr({key:j,value:s[j],valueSpec:x.transition,style:g,styleSpec:x}):E[j]?Hr({key:j,value:s[j],valueSpec:E[j],style:g,styleSpec:x}):[new i.J(j,s[j],`unknown property "${j}"`)])}if(s.source){const j=g.sources&&g.sources[s.source],U=j&&i.M(j.type);j?U!=="raster-dem"&&I.push(new i.V(c,s.source,`terrain cannot be used with a source of type ${String(U)}, it only be used with a "raster-dem" source type`)):I.push(new i.V(c,s.source,`source "${s.source}" not found`))}else I.push(new i.V(c,s,'terrain is missing required property "source"'));return I}function Jl(_){const s=_.value,c=_.style,g=_.styleSpec,x=g.fog;let E=[];const I=i.K(s);if(s===void 0)return E;if(I!=="object")return E=E.concat([new i.V("fog",s,`object expected, ${I} found`)]),E;for(const k in s){const j=k.match(/^(.*)-transition$/),U=k.match(/^(.*)-use-theme$/);E=E.concat(U&&x[U[1]]?Hr({key:k,value:s[k],valueSpec:{type:"string"},style:c,styleSpec:g}):j&&x[j[1]]&&x[j[1]].transition?Hr({key:k,value:s[k],valueSpec:g.transition,style:c,styleSpec:g}):x[k]?Hr({key:k,value:s[k],valueSpec:x[k],style:c,styleSpec:g}):[new i.J(k,s[k],`unknown property "${k}"`)])}return E}const vi={"*":()=>[],array:Ji,boolean:function(_){const s=_.value,c=_.key,g=i.K(s);return g!=="boolean"?[new i.V(c,s,`boolean expected, ${g} found`)]:[]},number:cr,color:function(_){const s=_.key,c=_.value,g=i.K(c);return g!=="string"?[new i.V(s,c,`color expected, ${g} found`)]:i.a0.parseCSSColor(c)===null?[new i.V(s,c,`color expected, "${c}" found`)]:[]},enum:so,filter:Ma,function:Yr,layer:Mo,object:qi,source:xl,model:i.a4,light:Du,"light-3d":Nu,terrain:js,fog:Jl,string:Aa,formatted:function(_){return Aa(_).length===0?[]:Bs(_)},resolvedImage:function(_){return Aa(_).length===0?[]:Bs(_)},projection:function(_){const s=_.value,c=_.styleSpec,g=c.projection,x=_.style;let E=[];const I=i.K(s);if(I==="object")for(const k in s)E=E.concat(Hr({key:k,value:s[k],valueSpec:g[k],style:x,styleSpec:c}));else I!=="string"&&(E=E.concat([new i.V("projection",s,`object or string expected, ${I} found`)]));return E},import:function(_){const{value:s,styleSpec:c}=_,{data:g,...x}=s;Object.defineProperty(x,"__line__",{value:s.__line__,enumerable:!1});let E=qi(i.L({},_,{value:x,valueSpec:c.import}));return i.M(x.id)===""&&E.push(new i.V(`${_.key}.id`,x,"import id can't be an empty string")),g&&(E=E.concat(ku(g,c,{key:`${_.key}.data`}))),E},iconset:function(_){const s=_.value,c=_.key,g=_.styleSpec,x=_.style;if(!s.type)return[new i.V(c,s,'"type" is required')];const E=i.M(s.type);let I=[];if(I=I.concat(qi({key:c,value:s,valueSpec:g[`iconset_${E}`],style:x,styleSpec:g})),E==="source"&&s.source){const k=x.sources&&x.sources[s.source],j=k&&i.M(k.type);k?j!=="raster-array"&&I.push(new i.V(c,s.source,`iconset cannot be used with a source of type ${String(j)}, it only be used with a "raster-array" source type`)):I.push(new i.V(c,s.source,`source "${s.source}" not found`))}return I}};function Hr(_,s=!1){const c=_.value,g=_.valueSpec,x=_.styleSpec;if(g.expression&&i.a2(i.M(c)))return Yr(_);if(g.expression&&i.S(i.U(c)))return Bs(_);if(g.type&&vi[g.type]){const E=vi[g.type](_);return s===!0&&E.length>0&&i.K(_.value)==="array"?Bs(_):E}return qi(i.L({},_,{valueSpec:g.type?x[g.type]:g}))}function Vs(_){const s=_.value,c=_.key,g=Aa(_);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new i.V(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new i.V(c,s,'"glyphs" url must include a "{range}" token'))),g}function ku(_,s=i.a5,c={}){return Hr({key:c.key||"",value:_,valueSpec:s.$root,styleSpec:s,style:_,objectElementValidators:{glyphs:Vs,"*":()=>[]}})}function Po(_,s=i.a5){return et(ku(_,s))}const sa=_=>et(xl(_)),yc=_=>et(Du(_)),Lr=_=>et(Nu(_)),fo=_=>et(js(_)),Ao=_=>et(Jl(_)),Xo=_=>et(function(s){const c=s.value,g=s.style,x=s.styleSpec,E=x.snow;let I=[];const k=i.K(c);if(c===void 0)return I;if(k!=="object")return I=I.concat([new i.V("snow",c,`object expected, ${k} found`)]),I;for(const j in c){const U=j.match(/^(.*)-transition$/);I=I.concat(U&&E[U[1]]&&E[U[1]].transition?Hr({key:j,value:c[j],valueSpec:x.transition,style:g,styleSpec:x}):E[j]?Hr({key:j,value:c[j],valueSpec:E[j],style:g,styleSpec:x}):[new i.J(j,c[j],`unknown property "${j}"`)])}return I}(_)),wt=_=>et(function(s){const c=s.value,g=s.style,x=s.styleSpec,E=x.rain;let I=[];const k=i.K(c);if(c===void 0)return I;if(k!=="object")return I=I.concat([new i.V("rain",c,`object expected, ${k} found`)]),I;for(const j in c){const U=j.match(/^(.*)-transition$/);I=I.concat(U&&E[U[1]]&&E[U[1]].transition?Hr({key:j,value:c[j],valueSpec:x.transition,style:g,styleSpec:x}):E[j]?Hr({key:j,value:c[j],valueSpec:E[j],style:g,styleSpec:x}):[new i.J(j,c[j],`unknown property "${j}"`)])}return I}(_)),ge=_=>et(Mo(_)),be=_=>et(Ma(_)),ke=_=>et(Pa(_)),qe=_=>et(Kl(_)),Xe=_=>et(i.a4(_));function et(_){return _.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function _t(_,s){let c=!1;if(s&&s.length)for(const g of s)g instanceof i.J?i.w(g.message):(_.fire(new i.z(new Error(g.message))),c=!0);return c}let it;class bt extends i.E{constructor(s,c="flat"){super(),this._transitionable=new i.a6(it||(it=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,g={}){this._validate(yc,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||g.validate!==!1)&&_t(this,s.call(Po,i.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ct=class extends i.E{constructor(_,s,c,g){super(),this.scope=c,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),c,g),this._transitionable.setTransitionOrValue(_,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(_,s){this._transitionable.setTransitionOrValue(_,s)}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}getExaggeration(_){return this._transitioning.possiblyEvaluate(new i.aa(_)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const _=this._transitionable._values.exaggeration;if(!_)return null;const s=_.value.expression;if(!s)return null;let c=-1,g=-1,x=1;for(const E of s.zoomStops)x=s.evaluate(new i.aa(E)),x>.01?(c=E,g=-1):g=E;return x<.01&&c>0&&g>c?[c,g]:null}isZoomDependent(){const _=this._transitionable._values.exaggeration;return _!=null&&_.value!=null&&_.value.expression!=null&&_.value.expression instanceof i.ab}};const Et=45,Wt=65,sn=.05;function cn(_,s,c,g){const x=i.ae(Et,Wt,c),[E,I]=Gn(_,g);let k=1-Math.min(1,Math.exp((s-E)/(I-E)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*_.alpha}function Gn(_,s){const c=.5/Math.tan(.5*s);return[_.range[0]+c,_.range[1]+c]}function Zn(_,s,c,g,x){const E=i.ad.vec3.transformMat4([],[s,c,g],x.mercatorFogMatrix);return cn(_,i.ad.vec3.length(E),x.pitch,x._fov)}function Wn(_,s,c,g,x,E,I){const k=[[c,g,0],[x,g,0],[x,E,0],[c,E,0]];let j=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(const $ of k){const Q=i.ad.vec3.transformMat4([],$,s),J=i.ad.vec3.length(Q);j=Math.min(j,J),U=Math.max(U,J)}return[cn(_,j,I.pitch,I._fov),cn(_,U,I.pitch,I._fov)]}class Jn extends i.E{constructor(s,c,g,x){super();const E=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(E,g,new Map(x)),this.set(s,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.af(E),this.scope=g}get state(){const s=this._transform,c=s.projection.name==="globe",g=i.ag(s.zoom),x=this.properties.get("range"),E=[.5,3];return{range:c?[i.ah(E[0],x[0],g),i.ah(E[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,g={}){if(this._validate(Ao,s,g))return;const x=i.l({},s);for(const E of Object.keys(i.a5.fog))x[E]===void 0&&(x[E]=i.a5.fog[E].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(Et,Wt,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(g,x,E){const I=i.ac.fromLngLat(x),k=E.elevation?E.elevation.getAtPointOrZero(I):0;return Zn(g,I.x,I.y,k,E)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Wn(this.state,c,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(s,c,g,x,E){return this._transform.projection.supportsFog?Wn(this.state,s,c,g,x,E,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Gn(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const g of c){const x=s.points[g];let E;if(x[2]>=0)E=x;else{const I=s.points[g-4];E=i.aj(I,x,I[2]/(I[2]-x[2]))}if(Zn(this.state,E[0],E[1],0,this._transform)>=sn)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||g.validate!==!1)&&_t(this,s.call(Po,i.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let ai,Ai,mr,Zr,Yn=class extends i.E{constructor(_,s,c,g){super();const x=ai||(ai=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(x,c,new Map(g)),this.set(_,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(x),this.scope=c}get state(){const _=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),g=i.ak(c[0]),x=-Math.max(i.ak(c[1]),.01),E=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],I=this.properties.get("vignette"),k=this.properties.get("vignette-color");return k.a=I,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(s.r,s.g,s.b,s.a*_),direction:E,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:k}}get(){return this._transitionable.serialize()}set(_,s,c={}){if(this._validate(Xo,_,c))return;const g=i.l({},_);for(const x of Object.keys(i.a5.snow))g[x]===void 0&&(g[x]=i.a5.snow[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(_){this._transitionable.setTransitionOrValue(this._options,new Map(_))}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}_validate(_,s,c){return(!c||c.validate!==!1)&&_t(this,_.call(Po,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},Kr=class extends i.E{constructor(_,s,c,g){super();const x=Ai||(Ai=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(x,c,new Map(g)),this.set(_,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(x),this.scope=c}get state(){const _=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),g=i.ak(c[0]),x=-Math.max(i.ak(c[1]),.01),E=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],I=this.properties.get("vignette-color");return I.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(s.r,s.g,s.b,s.a*_),direction:E,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(_,s,c={}){if(this._validate(wt,_,c))return;const g=i.l({},_);for(const x of Object.keys(i.a5.rain))g[x]===void 0&&(g[x]=i.a5.rain[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(_){this._transitionable.setTransitionOrValue(this._options,new Map(_))}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}_validate(_,s,c){return(!c||c.validate!==!1)&&_t(this,_.call(Po,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Vi extends i.E{constructor(s,c,g,x){super(),this.scope=g,this._options=s,this.properties=new i.af(c),this._transitionable=new i.a6(c,g,new Map(x)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Vo{constructor(s,c,g,x){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(s,c){let g,x;if(s instanceof i.P||typeof s[0]=="number"){const E=i.P.convert(s);g=[E],x=c.isPointAboveHorizon(E)}else{const E=i.P.convert(s[0]),I=i.P.convert(s[1]);g=[E,I],x=i.an(E,I).every(k=>c.isPointAboveHorizon(k))}return new Vo(g,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.an(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),i.ao(x,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.an(c,g,s),E=this.cameraPoint.clone();switch(3*((E.y>c.y)+(E.y>g.y))+((E.x>c.x)+(E.x>g.x))){case 0:x[0]=E,x[4]=E.clone();break;case 1:x.splice(1,0,E);break;case 2:x[1]=E;break;case 3:x.splice(4,0,E);break;case 5:x.splice(2,0,E);break;case 6:x[3]=E;break;case 7:x.splice(3,0,E);break;case 8:x[2]=E}return x}containsTile(s,c,g,x=0){const E=s.queryPadding/c._pixelsPerMercatorPixel+1,I=g?this._bufferedCameraMercator(E,c):this._bufferedScreenMercator(E,c);let k=s.tileID.wrap+(I.unwrapped?x:0);const j=I.polygon.map(me=>i.ap(s.tileTransform,me,k));if(!i.aq(j,0,0,i.ai,i.ai))return;k=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const U=this.screenGeometryMercator.polygon.map(me=>i.ar(s.tileTransform,me,k)),$=U.map(me=>new i.P(me[0],me[1])),Q=c.getFreeCameraOptions().position||new i.ac(0,0,0),J=i.ar(s.tileTransform,Q,k),oe=U.map(me=>{const ve=i.ad.vec3.sub(me,me,J);return i.ad.vec3.normalize(ve,ve),new i.as(J,ve)}),pe=i.at(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:oe,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(ce=i.au(j),ce.min.x=i.ay(ce.min.x,0,i.ai),ce.min.y=i.ay(ce.min.y,0,i.ai),ce.max.x=i.ay(ce.max.x,0,i.ai),ce.max.y=i.ay(ce.max.y,0,i.ai),ce),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:pe};var ce}_bufferedScreenMercator(s,c){const g=Es(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(E=>c.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(s,c){const g=Es(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(E=>c.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(s,c){const g=function(E,I){const k=i.ad.mat4.multiply([],I.pixelMatrix,I.globeMatrix),j=[0,-i.az,0,1],U=[0,i.az,0,1],$=[0,0,0,1];i.ad.vec4.transformMat4(j,j,k),i.ad.vec4.transformMat4(U,U,k),i.ad.vec4.transformMat4($,$,k);const Q=new i.P(j[0]/j[3],j[1]/j[3]),J=new i.P(U[0]/U[3],U[1]/U[3]),oe=i.aw(E,Q)&&j[3]<$[3],pe=i.aw(E,J)&&U[3]<$[3];if(!oe&&!pe)return null;const ce=function(Ne,ze,Ue){for(let Ye=1;Ye<Ne.length;Ye++){const vt=wl(ze.pointCoordinate3D(Ne[Ye-1]).x),ct=wl(ze.pointCoordinate3D(Ne[Ye]).x);if(Ue<0){if(vt<ct)return{idx:Ye,t:-vt/(ct-1-vt)}}else if(ct<vt)return{idx:Ye,t:(1-vt)/(ct+1-vt)}}return null}(E,I,oe?-1:1);if(!ce)return null;const{idx:me,t:ve}=ce;let Ee=me>1?Zo(E.slice(0,me),I):[],Pe=me<E.length?Zo(E.slice(me),I):[];Ee=Ee.map(Ne=>new i.P(wl(Ne.x),Ne.y)),Pe=Pe.map(Ne=>new i.P(wl(Ne.x),Ne.y));const Ie=[...Ee];Ie.length===0&&Ie.push(Pe[Pe.length-1]);const Be=i.ah(Ie[Ie.length-1].y,(Pe.length===0?Ee[0]:Pe[0]).y,ve);let Oe;return Oe=oe?[new i.P(0,Be),new i.P(0,0),new i.P(1,0),new i.P(1,Be)]:[new i.P(1,Be),new i.P(1,1),new i.P(0,1),new i.P(0,Be)],Ie.push(...Oe),Pe.length===0?Ie.push(Ee[0]):Ie.push(...Pe),{polygon:Ie.map(Ne=>new i.ac(Ne.x,Ne.y)),unwrapped:!1}}(s,c);if(g)return g;const x=function(E,I){let k=!1,j=-1/0,U=0;for(let Q=0;Q<E.length-1;Q++)E[Q].x>j&&(j=E[Q].x,U=Q);for(let Q=0;Q<E.length-1;Q++){const J=(U+Q)%(E.length-1),oe=E[J],pe=E[J+1];Math.abs(oe.x-pe.x)>.5&&(oe.x<pe.x?(oe.x+=1,J===0&&(E[E.length-1].x+=1)):(pe.x+=1,J+1===E.length-1&&(E[0].x+=1)),k=!0)}const $=i.av(I.center.lng);return k&&$<Math.abs($-1)&&E.forEach(Q=>{Q.x-=1}),{polygon:E,unwrapped:k}}(Zo(s,c).map(E=>new i.P(wl(E.x),E.y)),c);return{polygon:x.polygon.map(E=>new i.ac(E.x,E.y)),unwrapped:x.unwrapped}}}function Zo(_,s){return i.ax(_,c=>{const g=s.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function wl(_){return _<0?1+_%1:_%1}function Es(_){return 100*_|0}function mo(_,s,c,g,x){const E=function(k,j){if(k)return x(k);if(j){if(_.url&&j.tiles&&_.tiles&&delete _.tiles,j.variants){if(!Array.isArray(j.variants))return x(new Error("variants must be an array"));for(const $ of j.variants){if($==null||typeof $!="object"||$.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray($.capabilities))return x(new Error("capabilities must be an array"));if($.capabilities.length===1&&$.capabilities[0]==="meshopt"){j=i.l(j,$);break}}}const U=i.aA(i.l({},j,_),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);U.tiles=s.canonicalizeTileset(U,_.url),x(null,U)}},I=function(k,j,U){if(!k)return null;if(!j&&!U)return k;U=U||k.worldview_default;const $=Object.values(k.language||{});if($.length===0)return null;const Q=Object.values(k.worldview||{});if(Q.length===0)return null;const J=$.every(pe=>pe===j),oe=Q.every(pe=>pe===U);return J&&oe?k:j in(k.language_options||{})||U in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(_.data,c,g);return I?i.q.frame(()=>E(null,I)):_.url?i.n(s.transformRequest(s.normalizeSourceURL(_.url,null,c,g),i.R.Source),E):i.q.frame(()=>{const{data:k,...j}=_;E(null,j)})}class Ui{constructor(s,c,g){this.bounds=i.aB.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),g=Math.floor(i.av(this.bounds.getWest())*c),x=Math.floor(i.aC(this.bounds.getNorth())*c),E=Math.ceil(i.av(this.bounds.getEast())*c),I=Math.ceil(i.aC(this.bounds.getSouth())*c);return s.x>=g&&s.x<E&&s.y>=x&&s.y<I}}class Cf extends i.E{constructor(s,c,g,x){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(c,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.aD}load(s){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=mo(this._options,this.map._requestManager,c,g,(x,E)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.z(x));else if(E){if(i.l(this,E),this.hasWorldviews=!!E.worldview_options,E.worldview_default&&(this.worldviewDefault=E.worldview_default),E.vector_layers){this.vectorLayers=E.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const I of E.vector_layers)this.vectorLayerIds.push(I.id),E.worldview&&E.worldview[I.source]&&this.localizableLayerIds.add(I.id)}E.bounds&&(this.tileBounds=new Ui(E.bounds,this.minzoom,this.maxzoom)),Ke(E.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}s&&s(x)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(s,c){const g=s.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(g),E=this.map._requestManager.transformRequest(x,i.R.Tile),I=this.map.style?this.map.style.getLut(this.scope):null,k=I?{image:I.image.clone()}:null,j={request:E,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:k,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(g)&&(j.worldview=this.map.getWorldview()||this.worldviewDefault,j.localizableLayerIds=this.localizableLayerIds),j.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",j,U.bind(this));else if(s.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",j,U.bind(this),void 0,!0);else{const $=i.aE.call({deduped:this._deduped},j,(Q,J)=>{Q||!J?U.call(this,Q):(j.data={cacheControl:J.cacheControl,expires:J.expires,rawData:J.rawData.slice(0)},s.actor&&s.actor.send("loadTile",j,U.bind(this),void 0,!0))},!0);s.request={cancel:$}}function U($,Q){return delete s.request,s.aborted?c(null):$&&$.status!==404?c($):(Q&&Q.resourceTiming&&(s.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&s.setExpiryData(Q),s.loadVectorData(Q,this.map.painter),i.aF(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ro extends i.E{constructor(s,c,g,x){super(),this.id=s,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},c),i.l(this,i.aA(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=mo(this._options,this.map._requestManager,null,null,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new i.z(c)):g&&(i.l(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),g.bounds&&(this.tileBounds=new Ui(g.bounds,this.minzoom,this.maxzoom)),Ke(g.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const g=i.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=i.o(this.map._requestManager.transformRequest(x,i.R.Tile),(E,I,k,j)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):E?(s.state="errored",c(E)):I?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:k,expires:j}),s.setTexture(I,this.map.painter),s.state="loaded",i.aF(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof i.T?(s.destroy(!0),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Fu extends Ro{constructor(s,c,g,x){super(s,c,g,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.l({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);c&&c.enabled&&g&&c._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,i.R.Tile),E={request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=x,s.actor||(s.actor=this.dispatcher.getActor());const I=(k,j,U,$)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(k)return k.name==="AbortError"?void 0:(s.state="errored",c(k));if(this.map._refreshExpiredTiles&&j&&s.setExpiryData({cacheControl:U,expires:$}),this.partial)s.state="empty";else{if(!j)return c(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=j}c(null)};s.request=this.partial?s.fetchHeader(void 0,I.bind(this)):s.actor.send("loadTile",E,I.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){const g=s.texture;g&&g instanceof i.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(c,g,(x,E)=>{if(x)return s.state="errored",this.fire(new i.z(x)),void this.triggerRepaint(s);E&&(s._isHeaderLoaded=!0,s.setTexture(E,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:E})=>E===s),g=c&&c.fields,x=g&&g.bands&&g.bands;return x?x[0]:0}getTextureDescriptor(s,c,g){if(!s)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let E=null;c instanceof i.aI?E=c.paint.get("raster-array-band"):c instanceof i.aJ&&(E=c.paint.get("raster-particle-array-band"));const I=E||this.getInitialBand(x);if(I!=null)if(s.textureDescriptor){if(!s.updateNeeded(x,I)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,x,I)}getImages(s,c){const g=new Map;for(const x of s)for(const E of c){const[I,k]=E.split("/"),j=x.getLayer(I);if(!j||!j.hasBand(k)||!j.hasDataForBand(k))continue;const{bytes:U,tileSize:$,buffer:Q}=j.getBandView(k),J=$+2*Q,oe={data:new i.r({width:J,height:J},U),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(E,oe)}return g}}const X_={vector:Cf,raster:Ro,"raster-dem":class extends Ro{constructor(_,s,c,g){super(_,s,c,g),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(_,s){const c=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,E){x&&(_.state="errored",s(x)),E&&(_.dem=E,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",s(null))}_.request=i.o(this.map._requestManager.transformRequest(c,i.R.Tile),(function(x,E,I,k){if(delete _.request,_.aborted)_.state="unloaded",s(null);else if(x)_.state="errored",s(x);else if(E){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:I,expires:k});const j=ImageBitmap&&E instanceof ImageBitmap&&i.t(),U=1-(E.width-i.aG(E.width))/2;U<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const $=j?E:i.q.getImageData(E,U),Q={uid:_.uid,tileID:_.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:$,encoding:this.encoding,padding:U};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadTile",Q,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(_){const s=_.canonical,c=Math.pow(2,s.z),g=(s.x-1+c)%c,x=s.x===0?_.wrap-1:_.wrap,E=(s.x+1+c)%c,I=s.x+1===c?_.wrap+1:_.wrap,k={};return k[new i.aH(_.overscaledZ,x,s.z,g,s.y).key]={backfilled:!1},k[new i.aH(_.overscaledZ,I,s.z,E,s.y).key]={backfilled:!1},s.y>0&&(k[new i.aH(_.overscaledZ,x,s.z,g,s.y-1).key]={backfilled:!1},k[new i.aH(_.overscaledZ,_.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new i.aH(_.overscaledZ,I,s.z,E,s.y-1).key]={backfilled:!1}),s.y+1<c&&(k[new i.aH(_.overscaledZ,x,s.z,g,s.y+1).key]={backfilled:!1},k[new i.aH(_.overscaledZ,_.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new i.aH(_.overscaledZ,I,s.z,E,s.y+1).key]={backfilled:!1}),k}},"raster-array":Fu,geojson:class extends i.E{constructor(_,s,c,g){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=s.data,this._options=i.l({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.ai,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}updateData(_){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof _!="string"&&(_.type==="Feature"&&(_={type:"FeatureCollection",features:[_]}),_.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof _!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of _.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=_;return this._updateWorkerData(!0),this}getClusterExpansionZoom(_,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id,scope:this.scope},s),this}getClusterChildren(_,s){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id,scope:this.scope},s),this}getClusterLeaves(_,s,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:_,limit:s,offset:c},g),this}_updateWorkerData(_=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const s=i.l({append:_},this.workerOptions);s.scope=this.scope;const c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(i.q.resolveURL(c),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,x)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.z(g));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E.resourceTiming=x.resourceTiming[this.id]),_&&(this._partialReload=!0),this.fire(new i.A("data",E)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(_),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const _=i.C(this.id,this.scope);this.map.style.clearSource(_),this._updateWorkerData()}loadTile(_,s){const c=_.actor?"reloadTile":"loadTile";_.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,x=g?{image:g.image.clone()}:null,E=this._partialReload,I={type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:E};_.request=this.actor.send(c,I,(k,j)=>E&&!j?(_.state="loaded",s(null)):(delete _.request,_.destroy(),_.aborted?s(null):k?s(k):(_.loadVectorData(j,this.map.painter,c==="reloadTile"),s(null))),void 0,c==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_,s){this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id,scope:this.scope}),_.destroy()}onRemove(_){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(_,s,c,g){super(_,s,c,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const s of _.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.aL(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new i.z(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const s=this.video.seekable;_<s.start(0)||_>s.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,s=_.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(_,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(_,s,c,g){super(),this.id=_,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const _=[];for(const s in this._options.models){const c=this._options.models[s],g=i.aN(this.map._requestManager.transformRequest(c.uri,i.R.Model).url).then(x=>{if(!x)return;const E=i.aO(x),I=new i.aP(s,c.position,c.orientation,E);I.computeBoundsAndApplyParent(),this.models.push(I)}).catch(x=>{this.fire(new i.z(new Error(`Could not load model ${s} from ${c.uri}: ${x.message}`)))});_.push(g)}return Promise.allSettled(_).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new i.z(new Error(`Could not load models: ${s.message}`)))})}onAdd(_){this.map=_,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(_,s){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(_,s,c,g){super(),this.type="batched-model",this.id=_,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(_){this.map=_,this.load()}reload(){this.cancelTileJSONRequest();const _=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(_))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(_){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=mo(this._options,this.map._requestManager,s,c,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.z(g))):x&&(i.l(this,x),x.bounds&&(this.tileBounds=new Ui(x.bounds,this.minzoom,this.maxzoom)),Ke(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),_&&_(g)})}hasTransition(){return!1}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}loaded(){return this._loaded}loadTile(_,s){const c=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:_.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(_.actor&&_.state!=="expired")if(_.state==="loading")_.reloadCallback=s;else{if(_.buckets){const E=Object.values(_.buckets);for(const I of E)I.dirty=!0;return void(_.state="loaded")}_.request=_.actor.send("reloadTile",g,x.bind(this))}else _.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",g,x.bind(this),void 0,!0);function x(E,I){return _.aborted?s(null):E&&E.status!==404?s(E):(this.map._refreshExpiredTiles&&I&&_.setExpiryData(I),_.loadModelData(I,this.map.painter),_.state="loaded",void s(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(_,s,c,g){super(_,s,c,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new i.z(new i.V(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${_}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${_}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(_){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!_&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends i.E{constructor(_,s,c,g){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ui(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this.map=_,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:s,y:c,z:g}=_.canonical;return this._implementation.hasTile({x:s,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,s){const{x:c,y:g,z:x}=_.tileID.canonical,E=new AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:x},{signal:E.signal})).then((function(I){return delete _.request,_.aborted?(_.state="unloaded",s(null)):I===void 0?(_.state="errored",s(null)):I===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",s(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(I)?(this.loadTileData(_,I),_.state="loaded",void s(null)):(_.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(I=>{I.name!=="AbortError"&&(_.state="errored",s(I))}),_.request.cancel=()=>E.abort()}loadTileData(_,s){_.setTexture(s,this.map.painter)}unloadTile(_,s){if(_.texture&&_.texture instanceof i.T?(_.destroy(!0),_.texture&&_.texture instanceof i.T&&this.map.painter.saveTileTexture(_.texture)):_.destroy(),this._implementation.unloadTile){const{x:c,y:g,z:x}=_.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:x})}s&&s()}abortTile(_,s){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){const _=i.C(this.id,this.scope);this.map.style.clearSource(_)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},dg=function(_,s,c,g){const x=new X_[s.type](_,s,c,g);if(x.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${x.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],x),x};function sh(_,s,c=""){return`${c}:${s.id||""}:${s.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:x,importId:E}=g;return`featureset:${x}${E?`:import:${E}`:""}`}}(_.target)}`}function vc(_,s,c,g=""){if(_.uniqueFeatureID){const x=sh(_,s,g);if(c.has(x))return!0;c.add(x)}return!1}function gd(_,s,c,g,x=!1){const E=s.sourceCache.transform,I=s.sourceCache.tilesIn(_,s.has3DLayers,x);I.sort(Z_);const k=[];for(const j of I){const U=j.tile.queryRenderedFeatures(s,j,c,g,E,x);Object.keys(U).length&&k.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:U})}return k.length===0?{}:function(j){const U={},$={};for(const Q of j){const J=Q.queryResults,oe=Q.wrappedTileID,pe=$[oe]=$[oe]||{};for(const ce in J){const me=J[ce],ve=pe[ce]=pe[ce]||{},Ee=U[ce]=U[ce]||[];for(const Pe of me)ve[Pe.featureIndex]||(ve[Pe.featureIndex]=!0,Ee.push(Pe))}}return U}(k)}function $p(_,s,c,g,x){const E={},I=g.queryRenderedSymbols(_),k=[];for(const j of Object.keys(I).map(Number))k.push(x[j]);k.sort(Z_);for(const j of k){const U=j.featureIndex.lookupSymbolFeatures(I[j.bucketInstanceId],j.bucketIndex,j.sourceLayerIndex,s,c);for(const $ in U){const Q=E[$]=E[$]||[],J=U[$];J.sort((oe,pe)=>{const ce=j.featureSortOrder;if(ce){const me=ce.indexOf(oe.featureIndex);return ce.indexOf(pe.featureIndex)-me}return pe.featureIndex-oe.featureIndex});for(const oe of J)Q.push(oe)}}return E}function yv(_,s){const c=_.getRenderableIds().map(E=>_.getTileByID(E)),g=[],x={};for(let E=0;E<c.length;E++){const I=c[E],k=I.tileID.canonical.key;x[k]||(x[k]=!0,I.querySourceFeatures(g,s))}return g}function Z_(_,s){const c=_.tileID,g=s.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function ah(_,s){const c={};if(!s)return c;for(const g of _){const x=g.layerIds.map(E=>s.getLayer(E)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(E=>x.filter(I=>I.id===E)[0]));for(const E of x)c[E.fqid]=g}}return c}const Ra=32,Qa=33,Sl=new Uint16Array(8184);for(let _=0;_<2046;_++){let s=_+2,c=0,g=0,x=0,E=0,I=0,k=0;for(1&s?x=E=I=Ra:c=g=k=Ra;(s>>=1)>1;){const U=c+x>>1,$=g+E>>1;1&s?(x=c,E=g,c=I,g=k):(c=x,g=E,x=I,E=k),I=U,k=$}const j=4*_;Sl[j+0]=c,Sl[j+1]=g,Sl[j+2]=x,Sl[j+3]=E}const el=new Uint16Array(2178),Us=new Uint8Array(1089),mi=new Uint16Array(1089);function fg(_){return _===0?-.03125:_===32?.03125:0}const qp={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class tl{constructor(s,c,g,x,E){this.tileID=s,this.uid=i.aW(),this.uses=0,this.tileSize=c,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<i.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,g){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=ah(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const E=this.buckets[x];if(E instanceof i.aY){if(this.hasSymbolBuckets=!0,!g)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const E=this.buckets[x];if(E instanceof i.aY&&E.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const x in this.buckets){const E=this.buckets[x],I=c.style.getOwnLayer(x);if(!I)continue;const k=I.queryRadius(E);this.queryPadding=Math.max(this.queryPadding,k)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,g){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,ah(s.buckets,c.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const x in this.buckets){const E=this.buckets[x];E.uploadPending()&&E.upload(s)}const c=s.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new i.T(s,g.image,c.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,g),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(s,c,g,x,E,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const k=function(j,U){const $=i.ad.mat4.fromScaling([],[.5*j.width,.5*-j.height,1]);return i.ad.mat4.translate($,$,[1,-1,0]),i.ad.mat4.multiply($,$,j.calculateProjMatrix(U.toUnwrapped())),Float32Array.from($)}(E,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:c,pixelPosMatrix:k,transform:x,availableImages:g,tileTransform:this.tileTransform})}querySourceFeatures(s,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const x=g.loadVTLayers(),E=c?c.sourceLayer:"",I=x._geojsonTileLayer||x[E];if(!I)return;const k=i.a_(c&&c.filter),{z:j,x:U,y:$}=this.tileID.canonical,Q={z:j,x:U,y:$};for(let J=0;J<I.length;J++){const oe=I.feature(J);if(k.needGeometry){const me=i.a$(oe,!0);if(!k.filter(new i.aa(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!k.filter(new i.aa(this.tileID.overscaledZ),oe))continue;const pe=g.getId(oe,E),ce=new i.b0(oe,j,U,$,pe);ce.tile=Q,s.push(ce)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const g=i.b1(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let x=!1;if(this.expirationTime>g)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const E=this.expirationTime-c;E?this.expirationTime=g+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s,c){if(!this.latestFeatureIndex||!s.style)return;const g=this.latestFeatureIndex.loadVTLayers(),x=s.style.listImages(),E=s.style.getBrightness();for(const I in this.buckets){if(!s.style.hasLayer(I))continue;const k=this.buckets[I],j=k.layers[0],U=j.sourceLayer||"_geojsonTileLayer",$=g[U],Q=s.style.getLayerSourceCache(j);let J={};Q&&(J=Q._state.getState(U,void 0));const oe=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},pe=Object.keys(J).length>0&&!c;pe&&!k.stateDependentLayers.length&&!c||k.update(J,$,x,oe,pe?k.stateDependentLayers:k.layers,c,E),(k instanceof i.b2||k instanceof i.b3)&&s._terrain&&s._terrain.enabled&&Q&&k.uploadPending()&&s._terrain._clearRenderCacheForTile(Q.id,this.tileID);const ce=s&&s.style&&s.style.getOwnLayer(I);ce&&(this.queryPadding=Math.max(this.queryPadding,ce.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=i.q.now()+s}setTexture(s,c){const g=c.context,x=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s):(this.texture=new i.T(g,s,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(s,c){const g={};for(const x of c)g[x]=!0;this.dependencies[s]=g}hasDependency(s,c){for(const g of s){const x=this.dependencies[g];if(x){for(const E of c)if(x[E])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const g=i.b4(qp,this.tileID.canonical,this.tileTransform)[0],x=new i.b5,E=new i.b6;for(let I=0;I<g.length;I++){const{x:k,y:j}=g[I];x.emplaceBack(k,j),E.emplaceBack(I)}E.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(E),this._tileDebugBuffer=s.createVertexBuffer(x,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,x.length,E.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const g=i.b4(qp,this.tileID.canonical,this.tileTransform)[0];let x,E;if(this.isRaster){const I=function(k,j){const U=i.aR(k,j),$=Math.pow(2,k.z);for(let me=0;me<Qa;me++)for(let ve=0;ve<Qa;ve++){const Ee=i.aS((k.x+(ve+fg(ve))/Ra)/$),Pe=i.aT((k.y+(me+fg(me))/Ra)/$),Ie=j.project(Ee,Pe),Be=me*Qa+ve;el[2*Be+0]=Math.round((Ie.x*U.scale-U.x)*i.ai),el[2*Be+1]=Math.round((Ie.y*U.scale-U.y)*i.ai)}Us.fill(0),mi.fill(0);for(let me=2045;me>=0;me--){const ve=4*me,Ee=Sl[ve+0],Pe=Sl[ve+1],Ie=Sl[ve+2],Be=Sl[ve+3],Oe=Ee+Ie>>1,Ne=Pe+Be>>1,ze=Oe+Ne-Pe,Ue=Ne+Ee-Oe,Ye=Pe*Qa+Ee,vt=Be*Qa+Ie,ct=Ne*Qa+Oe,Pt=Math.hypot((el[2*Ye+0]+el[2*vt+0])/2-el[2*ct+0],(el[2*Ye+1]+el[2*vt+1])/2-el[2*ct+1])>=16;Us[ct]=Us[ct]||(Pt?1:0),me<1022&&(Us[ct]=Us[ct]||Us[(Pe+Ue>>1)*Qa+(Ee+ze>>1)]||Us[(Be+Ue>>1)*Qa+(Ie+ze>>1)])}const Q=new i.aU,J=new i.aV;let oe=0;function pe(me,ve){const Ee=ve*Qa+me;return mi[Ee]===0&&(Q.emplaceBack(el[2*Ee+0],el[2*Ee+1],me*i.ai/Ra,ve*i.ai/Ra),mi[Ee]=++oe),mi[Ee]-1}function ce(me,ve,Ee,Pe,Ie,Be){const Oe=me+Ee>>1,Ne=ve+Pe>>1;if(Math.abs(me-Ie)+Math.abs(ve-Be)>1&&Us[Ne*Qa+Oe])ce(Ie,Be,me,ve,Oe,Ne),ce(Ee,Pe,Ie,Be,Oe,Ne);else{const ze=pe(me,ve),Ue=pe(Ee,Pe),Ye=pe(Ie,Be);J.emplaceBack(ze,Ue,Ye)}}return ce(0,0,Ra,Ra,Ra,0),ce(Ra,Ra,0,0,0,Ra),{vertices:Q,indices:J}}(this.tileID.canonical,c);x=I.vertices,E=I.indices}else{x=new i.aU,E=new i.aV;for(const{x:k,y:j}of g)x.emplaceBack(k,j,0,0);const I=i.b9(x.int16,void 0,4);for(let k=0;k<I.length;k+=3)E.emplaceBack(I[k],I[k+1],I[k+2])}this._tileBoundsBuffer=s.createVertexBuffer(x,i.ba.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(E),this._tileBoundsSegments=i.b8.simpleSegment(0,0,x.length,E.length)}_makeGlobeTileDebugBuffers(s,c){const g=c.projection;if(!g||g.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,E=i.bb(x,c),I=i.bc(E),k=i.ag(c.zoom);let j;k>0&&(j=i.ad.mat4.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,x,c,I,j,k),this._makeGlobeTileDebugTextBuffer(s,x,c,I,j,k)}_globePoint(s,c,g,x,E,I,k){let j=i.bd(s,c,g);if(I){const U=1<<g.z,$=i.av(x.center.lng),Q=i.aC(x.center.lat),J=(g.x+.5)/U-$;let oe=0;J>.5?oe=-1:J<-.5&&(oe=1);let pe=(s/i.ai+g.x)/U+oe,ce=(c/i.ai+g.y)/U;pe=(pe-$)*x._pixelsPerMercatorPixel+$,ce=(ce-Q)*x._pixelsPerMercatorPixel+Q;const me=[pe*x.worldSize,ce*x.worldSize,0];i.ad.vec3.transformMat4(me,me,I),j=i.be(j,me,k)}return i.ad.vec3.transformMat4(j,j,E)}_makeGlobeTileDebugBorderBuffer(s,c,g,x,E,I){const k=new i.b5,j=new i.b6,U=new i.bf,$=(J,oe,pe,ce,me)=>{const ve=(pe-J)/(me-1),Ee=(ce-oe)/(me-1),Pe=k.length;for(let Ie=0;Ie<me;Ie++){const Be=J+Ie*ve,Oe=oe+Ie*Ee;k.emplaceBack(Be,Oe);const Ne=this._globePoint(Be,Oe,c,g,x,E,I);U.emplaceBack(Ne[0],Ne[1],Ne[2]),j.emplaceBack(Pe+Ie)}},Q=i.ai;$(0,0,Q,0,16),$(Q,0,Q,Q,16),$(Q,Q,0,Q,16),$(0,Q,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(j),this._tileDebugBuffer=s.createVertexBuffer(k,i.b7.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(U,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,k.length,j.length)}_makeGlobeTileDebugTextBuffer(s,c,g,x,E,I){const k=i.ai/4,j=new i.b5,U=new i.aV,$=new i.bf,Q=25;U.reserve(32),j.reserve(Q),$.reserve(Q);const J=(oe,pe)=>Q*oe+pe;for(let oe=0;oe<Q;oe++){const pe=oe*k;for(let ce=0;ce<Q;ce++){const me=ce*k;j.emplaceBack(me,pe);const ve=this._globePoint(me,pe,c,g,x,E,I);$.emplaceBack(ve[0],ve[1],ve[2])}}for(let oe=0;oe<4;oe++)for(let pe=0;pe<4;pe++){const ce=J(oe,pe),me=J(oe,pe+1),ve=J(oe+1,pe),Ee=J(oe+1,pe+1);U.emplaceBack(ce,me,ve),U.emplaceBack(ve,me,Ee)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(U),this._tileDebugTextBuffer=s.createVertexBuffer(j,i.b7.members),this._globeTileDebugTextBuffer=s.createVertexBuffer($,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,Q,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class Gs extends tl{constructor(s,c,g,x,E){super(s,c,g,x,E),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexture(s,c){const g=c.context,x=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s,{premultiply:!1}):this.texture=new i.T(g,s,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const g=this._mrt=new i.bh(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=i.bj(x,(E,I,k,j)=>{if(E)c(E);else try{const U=g.getHeaderLength(I);if(U>s)return void(this.request=this.fetchHeader(U,c));g.parseHeader(I),this._isHeaderLoaded=!0;let $=0;for(const Q of Object.values(g.layers))$=Math.max($,Q.dataIndex[Q.dataIndex.length-1].lastByte);I.byteLength>=$&&(this.entireBuffer=I),c(null,this.entireBuffer||I,k,j)}catch(U){c(U)}}),this.request}fetchBand(s,c,g){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void g(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void g(new Error("Can't fetch tile band without an actor"));let I;const k=(Q,J)=>{I.complete(Q,J),Q?g(Q):(this.updateTextureDescriptor(s,c),g(null,this.textureDescriptor&&this.textureDescriptor.img))},j=(Q,J)=>{if(Q)return g(Q);const oe=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:J,task:I},k,void 0,!0);this._workQueue.push(()=>{oe&&oe.cancel(),I.cancel()})},U=x.getLayer(s);if(!U)return void g(new Error(`Unknown sourceLayer "${s}"`));if(U.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const $=U.getDataRange([c]);if(I=x.createDecodingTask($),!I||I.tasks.length)if(this.flushQueues(),this.entireBuffer)j(null,this.entireBuffer.slice($.firstByte,$.lastByte+1));else{const Q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${$.firstByte}-${$.lastByte}`}}),J=i.bj(Q,j);this._fetchQueue.push(()=>{J.cancel(),I.cancel()})}else g(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&this.state!=="errored"}updateTextureDescriptor(s,c){if(!this._mrt)return;const g=this._mrt.getLayer(s);if(!g||!g.hasBand(c)||!g.hasDataForBand(c))return;const{bytes:x,tileSize:E,buffer:I,offset:k,scale:j}=g.getBandView(c),U=E+2*I,$=new i.r({width:U,height:U},x),Q=this.texture;Q&&Q instanceof i.T&&Q.update($,{premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:$,buffer:I,offset:k,tileSize:E,format:g.pixelFormat,mix:[j,256*j,65536*j,16777216*j]}}}class Y_{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,g){const x=s.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const E={value:c,timeout:void 0};if(g!==void 0&&(E.timeout=setTimeout(()=>{this.remove(s,E)},g)),this.data[x].push(E),this.order.push(x),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const g=s.wrapped().key,x=c===void 0?0:this.data[g].indexOf(c),E=this.data[g][x];return this.data[g].splice(x,1),E.timeout&&clearTimeout(E.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(E.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const g in this.data)for(const x of this.data[g])s(x.value)||c.push(x);for(const g of c)this.remove(g.value.tileID,g)}}class pg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,g){const x=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][x]=this.stateChanges[s][x]||{},i.l(this.stateChanges[s][x],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const E in this.state[s])E!==x&&(this.deletedStates[s][E]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][x]===null){this.deletedStates[s][x]={};for(const E in this.state[s][x])g[E]||(this.deletedStates[s][x][E]=null)}else for(const E in g)this.deletedStates[s]&&this.deletedStates[s][x]&&this.deletedStates[s][x][E]===null&&delete this.deletedStates[s][x][E]}removeFeatureState(s,c,g){if(this.deletedStates[s]===null)return;const x=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&c!==void 0)this.deletedStates[s][x]!==null&&(this.deletedStates[s][x]=this.deletedStates[s][x]||{},this.deletedStates[s][x][g]=null);else if(c!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][x])for(g in this.deletedStates[s][x]={},this.stateChanges[s][x])this.deletedStates[s][x][g]=null;else this.deletedStates[s][x]=null;else this.deletedStates[s]=null}getState(s,c){const g=this.state[s]||{},x=this.stateChanges[s]||{},E=this.deletedStates[s];if(E===null)return{};if(c!==void 0){const k=String(c),j=i.l({},g[k],x[k]);if(E){const U=E[c];if(U===null)return{};for(const $ in U)delete j[$]}return j}const I=i.l({},g,x);if(E)for(const k in E)delete I[k];return I}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const g={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const E={};for(const I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),i.l(this.state[x][I],this.stateChanges[x][I]),E[I]=this.state[x][I];g[x]=E}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const E={};if(this.deletedStates[x]===null)for(const I in this.state[x])E[I]={},this.state[x][I]={};else for(const I in this.deletedStates[x]){if(this.deletedStates[x][I]===null)this.state[x][I]={};else if(this.state[x][I])for(const k of Object.keys(this.deletedStates[x][I]))delete this.state[x][I][k];E[I]=this.state[x][I]}g[x]=g[x]||{},i.l(g[x],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const x in s)s[x].refreshFeatureState(c)}}class La extends i.E{constructor(s,c,g){super(),this.id=s,this._onlySymbols=g,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Y_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pg,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(s),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Fr).map(s=>s.key)}getRenderableIds(s,c){const g=[];for(const x in this._tiles)this._isIdRenderable(+x,s,c)&&g.push(this._tiles[x]);return s?g.sort((x,E)=>{const I=x.tileID,k=E.tileID,j=new i.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),U=new i.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-k.overscaledZ||U.y-j.y||U.x-j.x}).map(x=>x.tileID.key):g.map(x=>x.tileID).sort(Fr).map(x=>x.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,g){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(g||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=c),this._loadTile(g,this._tileLoaded.bind(this,g,s,c)))}_tileLoaded(s,c,g,x){if(x)if(s.state="errored",x.status!==404)this._source.fire(new i.z(x,{tile:s}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=i.q.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const E=c[x];if(s.neighboringTiles&&s.neighboringTiles[E]){const I=this.getTileByID(E);g(s,I),g(I,s)}}function g(x,E){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let I=E.tileID.canonical.x-x.tileID.canonical.x;const k=E.tileID.canonical.y-x.tileID.canonical.y,j=Math.pow(2,x.tileID.canonical.z),U=E.tileID.key;I===0&&k===0||Math.abs(k)>1||(Math.abs(I)>1&&(Math.abs(I+j)===1?I+=j:Math.abs(I-j)===1&&(I-=j)),E.dem&&x.dem&&(x.dem.backfillBorder(E.dem,I,k),x.neighboringTiles&&x.neighboringTiles[U]&&(x.neighboringTiles[U].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,g,x){for(const E in this._tiles){let I=this._tiles[E];if(x[E]||!I.hasData()||I.tileID.overscaledZ<=c||I.tileID.overscaledZ>g)continue;let k=I.tileID;for(;I&&I.tileID.overscaledZ>c+1;){const U=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[U.key],I&&I.hasData()&&(k=U)}let j=k;for(;j.overscaledZ>c;)if(j=j.scaledTo(j.overscaledZ-1),s[j.key]){x[k.key]=k;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=s.overscaledZ-1;g>=c;g--){const x=s.scaledTo(g),E=this._getLoadedTile(x);if(E)return E}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const g=Math.ceil(s.width/c)+1,x=Math.ceil(s.height/c)+1,E=Math.floor(g*x*5),I=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,E):E,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(k)}handleWrapJump(s){const c=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,c){const g={};for(const x in this._tiles){const E=this._tiles[x];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+c),g[E.tileID.key]=E}this._tiles=g;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(s,c,g,x){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(s,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,k=this._source.maxzoom;const j=this.map&&this.map.painter?this.map.painter._terrain:null;if(j&&j.sourceCache===this&&j.attenuationRange()){const Q=j.attenuationRange()[0],J=Math.floor(Q)-Math.log2(j.getDemUpscale());k>J&&(k=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new i.aH(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y));else if(this.tileCoverLift!==0){const Q=s.clone();Q.tileCoverLift=this.tileCoverLift,I=Q.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&s.projection.name==="globe"&&(I.push(new i.aH(1,0,1,0,0)),I.push(new i.aH(1,0,1,1,0)),I.push(new i.aH(1,0,1,0,1)),I.push(new i.aH(1,0,1,1,1)))}else if(I=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const Q=this._source.hasTile.bind(this._source);I=I.filter(J=>Q(J))}}else I=[];if(I.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zu(this._source.type)){const Q=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),J=Math.min(Q,this._source.maxzoom);if(E){const oe=s.extendTileCover(I,J);for(const pe of oe)I.push(pe)}else{const oe=s.extendTileCover(I,J,x);for(const pe of oe)this._shadowCasterTiles[pe.key]=!0,I.push(pe)}}const U=this._updateRetainedTiles(I);if(zu(this._source.type)&&I.length!==0){const Q={},J={},oe=Object.keys(U);for(const ce of oe){const me=U[ce],ve=this._tiles[ce];if(!ve||ve.fadeEndTime&&ve.fadeEndTime<=i.q.now())continue;const Ee=this.findLoadedParent(me,Math.max(me.overscaledZ-La.maxOverzooming,this._source.minzoom));Ee&&(this._addTile(Ee.tileID),Q[Ee.tileID.key]=Ee.tileID),J[ce]=me}const pe=I[I.length-1].overscaledZ;for(const ce in this._tiles){const me=this._tiles[ce];if(U[ce]||!me.hasData())continue;let ve=me.tileID;for(;ve.overscaledZ>pe;){ve=ve.scaledTo(ve.overscaledZ-1);const Ee=this._tiles[ve.key];if(Ee&&Ee.hasData()&&J[ve.key]){U[ce]=me.tileID;break}}}for(const ce in Q)U[ce]||(this._coveredTiles[ce]=!0,U[ce]=Q[ce])}for(const Q in U)this._tiles[Q].clearFadeHold();const $=i.bk(this._tiles,U);for(const Q of $){const J=this._tiles[Q];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+Q)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(s.length===0)return c;const g={},x=s.reduce((U,$)=>Math.min(U,$.overscaledZ),1/0),E=s[0].overscaledZ,I=Math.max(E-La.maxOverzooming,this._source.minzoom),k=Math.max(E+La.maxUnderzooming,this._source.minzoom),j={};for(const U of s){const $=this._addTile(U);c[U.key]=U,$.hasData()||x<this._source.maxzoom&&(j[U.key]=U)}this._retainLoadedChildren(j,x,k,c);for(const U of s){let $=this._tiles[U.key];if($.hasData())continue;if(U.canonical.z>=this._source.maxzoom){const J=U.children(this._source.maxzoom)[0],oe=this.getTile(J);if(oe&&oe.hasData()){c[J.key]=J;continue}}else{const J=U.children(this._source.maxzoom);if(c[J[0].key]&&c[J[1].key]&&c[J[2].key]&&c[J[3].key])continue}let Q=$.wasRequested();for(let J=U.overscaledZ-1;J>=I;--J){const oe=U.scaledTo(J);if(g[oe.key]||(g[oe.key]=!0,$=this.getTile(oe),!$&&Q&&($=this._addTile(oe)),$&&(c[oe.key]=oe,Q=$.wasRequested(),$.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let g,x=this._tiles[s].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){g=this._loadedParentTiles[x.key];break}c.push(x.key);const E=x.scaledTo(x.overscaledZ-1);if(g=this._getLoadedTile(E),g)break;x=E}for(const E of c)this._loadedParentTiles[E]=g}}_addTile(s){let c=this._tiles[s.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const g=!!c;if(!g){const x=this.map?this.map.painter:null,E=this._source.tileSize*s.overscaleFactor();c=this._source.type==="raster-array"?new Gs(s,E,this.transform.tileZoom,x,this._isRaster):new tl(s,E,this.transform.tileZoom,x,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,g||this._source.fire(new i.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=c.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,g){const x=[],E=this.transform;if(!E)return x;const I=E.projection.name==="globe",k=i.av(E.center.lng);for(const j in this._tiles){const U=this._tiles[j];if(g&&U.clearQueryDebugViz(),U.holdingForFade())continue;let $;if(I){const Q=U.tileID.canonical;if(Q.z===0){const J=[Math.abs(i.ay(k,...Sn(Q,-1))-k),Math.abs(i.ay(k,...Sn(Q,1))-k)];$=[0,2*J.indexOf(Math.min(...J))-1]}else{const J=[Math.abs(i.ay(k,...Sn(Q,-1))-k),Math.abs(i.ay(k,...Sn(Q,0))-k),Math.abs(i.ay(k,...Sn(Q,1))-k)];$=[J.indexOf(Math.min(...J))-1]}}else $=[0];for(const Q of $){const J=s.containsTile(U,E,c,Q);J&&x.push(J)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const g=this.getRenderableIds(s,c).map(E=>this._tiles[E].tileID),x=this.transform.projection.name==="globe";for(const E of g)E.projMatrix=this.transform.calculateProjMatrix(E.toUnwrapped()),E.expandedProjMatrix=x?this.transform.calculateProjMatrix(E.toUnwrapped(),!1,!0):E.projMatrix;return g}sortCoordinatesByDistance(s){const c=s.slice(),g=this.transform._camera.position,x=this.transform._camera.forward(),E={};for(const I of c){const k=1/(1<<I.canonical.z);E[I.key]=((I.canonical.x+.5)*k+I.wrap-g[0])*x[0]+((I.canonical.y+.5)*k-g[1])*x[1]-g[2]*x[2]}return c.sort((I,k)=>E[I.key]-E[k.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(zu(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(s,c,g){this._state.updateState(s=s||"_geojsonTileLayer",c,g)}removeFeatureState(s,c,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,g)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,g){const x=this._tiles[s];x&&x.setDependencies(c,g)}reloadTilesForDependencies(s,c){for(const g in this._tiles)this._tiles[g].hasDependency(s,c)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const j=()=>{this._sourceLoaded&&(this._source.off("data",j),this._preloadTiles(s,c))};return void this._source.on("data",j)}const g=new Map,x=Array.isArray(s)?s:[s],E=this.map.painter.terrain,I=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const j of x){const U=j.coveringTiles({tileSize:I,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const $ of U)g.set($.key,$);this.usedForTerrain&&j.updateElevation(!1)}const k=Array.from(g.values());i.bl(k,(j,U)=>{const $=new tl(j,this._source.tileSize*j.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile($,Q=>{this._source.type==="raster-dem"&&$.dem&&this._backfillDEM($),U(Q,$)})},c)}}function Fr(_,s){const c=Math.abs(2*_.wrap)-+(_.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||g-c||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function zu(_){return _==="raster"||_==="image"||_==="video"||_==="custom"}function Sn(_,s){const c=1<<_.z;return[_.x/c+s,(_.x+1)/c+s]}La.maxOverzooming=10,La.maxUnderzooming=3;class xc{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const g in this.style._mergedLayers){const x=this.style._mergedLayers[g];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:s,visibilityChanged:c});else if(x.type==="model"){const E=this.style.getLayerSource(x);E&&E.type==="batched-model"&&this.layers.push({layer:x,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const g=c.layer;let x=!1;g.type==="fill-extrusion"?x=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(x=!g.isHidden(s)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const x of this.layers){const E=x.layer,I=this.style.getLayerSourceCache(E);let k=1;E.type==="fill-extrusion"&&(k=x.visible?E.paint.get("fill-extrusion-vertical-scale"):0);let j=I?I.getTile(c):null;if(!j&&I&&c.canonical.z>I.getSource().minzoom){let U=c.scaledTo(Math.min(I.getSource().maxzoom,c.overscaledZ-1));for(;U.overscaledZ>=I.getSource().minzoom&&(j=I.getTile(U),!j&&U.overscaledZ!==0);)U=U.scaledTo(U.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:j?j.getBucket(E):null,tileID:j?j.tileID:c,verticalScale:k})}s.hasAnyZOffset=!1;let g=!1;for(let x=0;x<s.symbolInstances.length;x++){const E=s.symbolInstances.get(x),I=E.zOffset,k=this._getHeightAtTileOffset(c,E.tileAnchorX,E.tileAnchorY);E.zOffset=k!==Number.NEGATIVE_INFINITY?k:I,g||I===E.zOffset||(g=!0),s.hasAnyZOffset||E.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,g,x){let E=c,I=g;if(s.canonical.z!==x.canonical.z){const k=x.canonical,j=1/(1<<s.canonical.z-k.z);E=(c+s.canonical.x*i.ai)*j-k.x*i.ai|0,I=(g+s.canonical.y*i.ai)*j-k.y*i.ai|0}return{tileX:E,tileY:I}}_getHeightAtTileOffset(s,c,g){let x,E;for(let I=0;I<this.layers.length;++I){if(this.layers[I].layer.type!=="fill-extrusion")continue;const{bucket:k,tileID:j,verticalScale:U}=this.currentBuildingBuckets[I];if(!k)continue;const{tileX:$,tileY:Q}=this._mapCoordToOverlappingTile(s,c,g,j),J=k.getHeightAtTileCoord($,Q);J&&J.height!==void 0&&(J.hidden?x=J.height:E=Math.max(J.height*U,E||0))}if(E!==void 0)return E;for(let I=0;I<this.layers.length;++I){const k=this.layers[I];if(k.layer.type!=="model"||!k.visible)continue;const{bucket:j,tileID:U}=this.currentBuildingBuckets[I];if(!j)continue;const{tileX:$,tileY:Q}=this._mapCoordToOverlappingTile(s,c,g,U),J=j.getHeightAtTileCoord($,Q);if(J&&!J.hidden)return J.height===void 0&&x!==void 0?Math.min(J.maxHeight,x)*J.verticalScale:J.height?J.height*J.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Tf(_,s){const c={};for(const g in _)g!=="ref"&&(c[g]=_[g]);return i.bm.forEach(g=>{g in s&&(c[g]=s[g])}),c}function bc(_){_=_.slice();const s=Object.create(null);for(let c=0;c<_.length;c++)s[_[c].id]=_[c];for(let c=0;c<_.length;c++)"ref"in _[c]&&(_[c]=Tf(_[c],s[_[c].ref]));return _}const fr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function El(_,s,c){c.push({command:fr.addSource,args:[_,s[_]]})}function Hp(_,s,c){s.push({command:fr.removeSource,args:[_]}),c[_]=!0}function Bu(_,s,c,g){Hp(_,c,g),El(_,s,c)}function gn(_,s,c){let g;for(g in _[c])if(_[c].hasOwnProperty(g)&&g!=="data"&&!i.bn(_[c][g],s[c][g]))return!1;for(g in s[c])if(s[c].hasOwnProperty(g)&&g!=="data"&&!i.bn(_[c][g],s[c][g]))return!1;return!0}function Gr(_,s,c,g,x,E){let I;for(I in s=s||{},_=_||{})_.hasOwnProperty(I)&&(i.bn(_[I],s[I])||c.push({command:E,args:[g,I,s[I],x]}));for(I in s)s.hasOwnProperty(I)&&!_.hasOwnProperty(I)&&(i.bn(_[I],s[I])||c.push({command:E,args:[g,I,s[I],x]}))}function Er(_){return _.id}function ys(_,s){return _[s.id]=s,_}class If{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.ay(s,0,1);let c=1,g=this._distances[c];const x=s*this.paddedLength+this.padding;for(;g<x&&c<this._distances.length;)g=this._distances[++c];const E=c-1,I=this._distances[E],k=g-I,j=k>0?(x-I)/k:0;return this.points[E].mult(1-j).add(this.points[c].mult(j))}}class Cr{constructor(s,c,g){const x=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(c/g);for(let I=0;I<this.xCellCount*this.yCellCount;I++)x.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,g,x,E){this._forEachCell(c,g,x,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(E)}insertCircle(s,c,g,x){this._forEachCell(c-x,g-x,c+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(g),this.circles.push(x)}_insertBoxCell(s,c,g,x,E,I){this.boxCells[E].push(I)}_insertCircleCell(s,c,g,x,E,I){this.circleCells[E].push(I)}_query(s,c,g,x,E,I){if(g<0||s>this.width||x<0||c>this.height)return!E&&[];const k=[];if(s<=0&&c<=0&&this.width<=g&&this.height<=x){if(E)return!0;for(let j=0;j<this.boxKeys.length;j++)k.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const U=this.circles[3*j],$=this.circles[3*j+1],Q=this.circles[3*j+2];k.push({key:this.circleKeys[j],x1:U-Q,y1:$-Q,x2:U+Q,y2:$+Q})}return I?k.filter(I):k}return this._forEachCell(s,c,g,x,this._queryCell,k,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?k.length>0:k}_queryCircle(s,c,g,x,E){const I=s-g,k=s+g,j=c-g,U=c+g;if(k<0||I>this.width||U<0||j>this.height)return!x&&[];const $=[];return this._forEachCell(I,j,k,U,this._queryCellCircle,$,{hitTest:x,circle:{x:s,y:c,radius:g},seenUids:{box:{},circle:{}}},E),x?$.length>0:$}query(s,c,g,x,E){return this._query(s,c,g,x,!1,E)}hitTest(s,c,g,x,E){return this._query(s,c,g,x,!0,E)}hitTestCircle(s,c,g,x){return this._queryCircle(s,c,g,!0,x)}_queryCell(s,c,g,x,E,I,k,j){const U=k.seenUids,$=this.boxCells[E];if($!==null){const J=this.bboxes;for(const oe of $)if(!U.box[oe]){U.box[oe]=!0;const pe=4*oe;if(s<=J[pe+2]&&c<=J[pe+3]&&g>=J[pe+0]&&x>=J[pe+1]&&(!j||j(this.boxKeys[oe]))){if(k.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[oe],x1:J[pe],y1:J[pe+1],x2:J[pe+2],y2:J[pe+3]})}}}const Q=this.circleCells[E];if(Q!==null){const J=this.circles;for(const oe of Q)if(!U.circle[oe]){U.circle[oe]=!0;const pe=3*oe;if(this._circleAndRectCollide(J[pe],J[pe+1],J[pe+2],s,c,g,x)&&(!j||j(this.circleKeys[oe]))){if(k.hitTest)return I.push(!0),!0;{const ce=J[pe],me=J[pe+1],ve=J[pe+2];I.push({key:this.circleKeys[oe],x1:ce-ve,y1:me-ve,x2:ce+ve,y2:me+ve})}}}}}_queryCellCircle(s,c,g,x,E,I,k,j){const U=k.circle,$=k.seenUids,Q=this.boxCells[E];if(Q!==null){const oe=this.bboxes;for(const pe of Q)if(!$.box[pe]){$.box[pe]=!0;const ce=4*pe;if(this._circleAndRectCollide(U.x,U.y,U.radius,oe[ce+0],oe[ce+1],oe[ce+2],oe[ce+3])&&(!j||j(this.boxKeys[pe])))return I.push(!0),!0}}const J=this.circleCells[E];if(J!==null){const oe=this.circles;for(const pe of J)if(!$.circle[pe]){$.circle[pe]=!0;const ce=3*pe;if(this._circlesCollide(oe[ce],oe[ce+1],oe[ce+2],U.x,U.y,U.radius)&&(!j||j(this.circleKeys[pe])))return I.push(!0),!0}}}_forEachCell(s,c,g,x,E,I,k,j){const U=this._convertToXCellCoord(s),$=this._convertToYCellCoord(c),Q=this._convertToXCellCoord(g),J=this._convertToYCellCoord(x);for(let oe=U;oe<=Q;oe++)for(let pe=$;pe<=J;pe++)if(E.call(this,s,c,g,x,this.xCellCount*pe+oe,I,k,j))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,g,x,E,I){const k=x-s,j=E-c,U=g+I;return U*U>k*k+j*j}_circleAndRectCollide(s,c,g,x,E,I,k){const j=(I-x)/2,U=Math.abs(s-(x+j));if(U>j+g)return!1;const $=(k-E)/2,Q=Math.abs(c-(E+$));if(Q>$+g)return!1;if(U<=j||Q<=$)return!0;const J=U-j,oe=Q-$;return J*J+oe*oe<=g*g}}const nl={unknown:0,flipRequired:1,flipNotRequired:2},ju=Math.tan(85*Math.PI/180);function Cl(_,s,c,g,x,E,I){const k=i.ad.mat4.create();if(c)if(E.name==="globe"){const j=i.bo(x,s);i.ad.mat4.multiply(k,k,j)}else{const j=i.ad.mat2.invert([],I);k[0]=j[0],k[1]=j[1],k[4]=j[2],k[5]=j[3],g||i.ad.mat4.rotateZ(k,k,x.angle)}else i.ad.mat4.multiply(k,x.labelPlaneMatrix,_);return k}function vs(_,s,c,g,x,E,I){const k=Cl(_,s,c,g,x,E,I);return E.name==="globe"&&c||(k[2]=k[6]=k[10]=k[14]=0),k}function Qi(_,s,c,g,x,E,I){if(c){if(E.name==="globe"){const k=Cl(_,s,c,g,x,E,I);return i.ad.mat4.invert(k,k),i.ad.mat4.multiply(k,_,k),k}{const k=i.ad.mat4.clone(_),j=i.ad.mat4.identity([]);return j[0]=I[0],j[1]=I[1],j[4]=I[2],j[5]=I[3],i.ad.mat4.multiply(k,k,j),g||i.ad.mat4.rotateZ(k,k,-x.angle),k}}return x.glCoordMatrix}function rl(_,s,c,g){const x=[_,s,c,1];c?i.ad.vec4.transformMat4(x,x,g):di(x,x,g);const E=x[3];return x[0]/=E,x[1]/=E,x[2]/=E,x}function wc(_,s){return Math.min(.5+_/s*.5,1.5)}function Wp(_,s){const c=_[0]/_[3],g=_[1]/_[3];return c>=-s[0]&&c<=s[0]&&g>=-s[1]&&g<=s[1]}function _d(_,s,c,g,x,E,I,k,j,U){const $=c.transform,Q=g?_.textSizeData:_.iconSizeData,J=i.bp(Q,c.transform.zoom),oe=$.projection.name==="globe",pe=[256/c.width*2+1,256/c.height*2+1],ce=g?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ce.clear();let me=null;oe&&(me=g?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const ve=_.lineVertexArray,Ee=g?_.text.placedSymbolArray:_.icon.placedSymbolArray,Pe=c.transform.width/c.transform.height;let Ie,Be=!1;for(let Oe=0;Oe<Ee.length;Oe++){const Ne=Ee.get(Oe),{numGlyphs:ze,writingMode:Ue}=Ne;if(Ue!==i.bq.vertical||Be||Ie===i.bq.horizontal||(Be=!0),Ie=Ue,(Ne.hidden||Ue===i.bq.vertical)&&!Be){Tl(ze,ce);continue}Be=!1;const Ye=new i.P(Ne.tileAnchorX,Ne.tileAnchorY);let{x:vt,y:ct,z:Pt}=$.projection.projectTilePoint(Ye.x,Ye.y,U.canonical);if(j){const[tn,rn,fn]=j(Ye);vt+=tn,ct+=rn,Pt+=fn}const At=[vt,ct,Pt,1];if(i.ad.vec4.transformMat4(At,At,s),!Wp(At,pe)){Tl(ze,ce);continue}const jt=At[3],ut=wc(c.transform.getCameraToCenterDistance($.projection),jt),It=i.br(Q,J,Ne),nt=I?It/ut:It*ut,Mt=rl(vt,ct,Pt,x);if(Mt[3]<=0){Tl(ze,ce);continue}let St={};const Rt=i.ak(_.layers[0].layout.get("text-max-angle")),xt=Math.cos(Rt),Lt=I?null:j,en=Yo(Ne,nt,!1,k,s,x,E,_.glyphOffsetArray,ve,ce,me,Mt,Ye,St,Pe,Lt,$.projection,U,I,xt);Be=en.useVertical,Lt&&en.needsFlipping&&(St={}),(en.notEnoughRoom||Be||en.needsFlipping&&Yo(Ne,nt,!0,k,s,x,E,_.glyphOffsetArray,ve,ce,me,Mt,Ye,St,Pe,Lt,$.projection,U,I,xt).notEnoughRoom)&&Tl(ze,ce)}g?(_.text.dynamicLayoutVertexBuffer.updateData(ce),me&&_.text.globeExtVertexBuffer&&_.text.globeExtVertexBuffer.updateData(me)):(_.icon.dynamicLayoutVertexBuffer.updateData(ce),me&&_.icon.globeExtVertexBuffer&&_.icon.globeExtVertexBuffer.updateData(me))}function Ql(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me){const{lineStartIndex:ve,glyphStartIndex:Ee,segment:Pe}=k,Ie=Ee+k.numGlyphs,Be=ve+k.lineLength,Oe=s.getoffsetX(Ee),Ne=s.getoffsetX(Ie-1),ze=lh(_*Oe,c,g,x,E,I,Pe,ve,Be,j,U,$,Q,J,!0,oe,pe,ce,me);if(!ze)return null;const Ue=lh(_*Ne,c,g,x,E,I,Pe,ve,Be,j,U,$,Q,J,!0,oe,pe,ce,me);return Ue?{first:ze,last:Ue}:null}function yd(_,s,c,g){return _===i.bq.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:_===i.bq.vertical?g>0?{needsFlipping:!0}:null:s!==nl.unknown&&function(x,E){return x===0||Math.abs(E/x)>ju}(c,g)?s===nl.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Yo(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee,Pe){const Ie=s/24,Be=_.lineOffsetX*Ie,Oe=_.lineOffsetY*Ie,{lineStartIndex:Ne,glyphStartIndex:ze,numGlyphs:Ue,segment:Ye,writingMode:vt,flipState:ct}=_,Pt=Ne+_.lineLength,At=jt=>{if($){const[Mt,St,Rt]=jt.up,xt=U.length;i.bs($,xt+0,Mt,St,Rt),i.bs($,xt+1,Mt,St,Rt),i.bs($,xt+2,Mt,St,Rt),i.bs($,xt+3,Mt,St,Rt)}const[ut,It,nt]=jt.point;i.bt(U,ut,It,nt,jt.angle)};if(Ue>1){const jt=Ql(Ie,k,Be,Oe,c,Q,J,_,j,E,oe,ce,!1,me,ve,Ee,Pe);if(!jt)return{notEnoughRoom:!0};if(g&&!c){let[ut,It,nt]=jt.first.point,[Mt,St,Rt]=jt.last.point;[ut,It]=rl(ut,It,nt,I),[Mt,St]=rl(Mt,St,Rt,I);const xt=yd(vt,ct,(Mt-ut)*pe,St-It);if(_.flipState=xt&&xt.needsFlipping?nl.flipRequired:nl.flipNotRequired,xt)return xt}At(jt.first);for(let ut=ze+1;ut<ze+Ue-1;ut++){const It=lh(Ie*k.getoffsetX(ut),Be,Oe,c,Q,J,Ye,Ne,Pt,j,E,oe,ce,!1,!1,me,ve,Ee,Pe);if(!It)return U.length-=4*(ut-ze),{notEnoughRoom:!0};At(It)}At(jt.last)}else{if(g&&!c){const ut=rl(J.x,J.y,0,x),It=Ne+Ye+1,nt=new i.P(j.getx(It),j.gety(It)),Mt=rl(nt.x,nt.y,0,x),St=Mt[3]>0?Mt:Ko(J,nt,ut,1,x,void 0,me,ve.canonical),Rt=yd(vt,ct,(St[0]-ut[0])*pe,St[1]-ut[1]);if(_.flipState=Rt&&Rt.needsFlipping?nl.flipRequired:nl.flipNotRequired,Rt)return Rt}const jt=lh(Ie*k.getoffsetX(ze),Be,Oe,c,Q,J,Ye,Ne,Pt,j,E,oe,ce,!1,!1,me,ve,Ee,Pe);if(!jt)return{notEnoughRoom:!0};At(jt)}return{}}function eu(_,s,c,g,x){const{x:E,y:I,z:k}=g.projectTilePoint(_.x,_.y,s);if(!x)return rl(E,I,k,c);const[j,U,$]=x(_);return rl(E+j,I+U,k+$,c)}function Ko(_,s,c,g,x,E,I,k){const j=eu(_.sub(s)._unit()._add(_),k,x,I,E);return i.ad.vec3.sub(j,c,j),i.ad.vec3.normalize(j,j),i.ad.vec3.scaleAndAdd(j,c,j,g)}function lh(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee){const Pe=g?_-s:_+s;let Ie=Pe>0?1:-1,Be=0;g&&(Ie*=-1,Be=Math.PI),Ie<0&&(Be+=Math.PI);let Oe=k+I+(Ie>0?0:1)|0,Ne=x,ze=x,Ue=0,Ye=0;const vt=Math.abs(Pe),ct=[],Pt=[];let At=E,jt=At,ut=i.ad.vec3.zero([]);const It=()=>Ko(jt,At,ze,vt-Ue+1,$,J,ce,me.canonical);for(;Ue+Ye<=vt;){if(Oe+=Ie,Oe<k||Oe>=j)return null;if(ze=Ne,jt=At,ct.push(ze),oe&&Pt.push(jt),At=new i.P(U.getx(Oe),U.gety(Oe)),Ne=Q[Oe],!Ne){const fn=eu(At,me.canonical,$,ce,J);Ne=fn[3]>0?Q[Oe]=fn:It()}Ue+=Ye;const tn=i.ad.vec3.sub([],Ne,ze),rn=i.ad.vec3.distance(ze,Ne);if(c&&rn>0&&Ye>0&&i.ad.vec3.dot(ut,tn)/(Ye*rn)<Ee)return null;Ye=rn,ut=tn}pe&&J&&(Q[Oe]&&(Ne=It(),Ye=i.ad.vec3.distance(ze,Ne),ut=i.ad.vec3.sub([],Ne,ze)),Q[Oe]=Ne);const nt=(vt-Ue)/Ye,Mt=At.sub(jt)._mult(nt)._add(jt),St=i.ad.vec3.scaleAndAdd([],ze,ut,nt);let Rt=[0,0,1],xt=ut[0],Lt=ut[1];if(ve&&(Rt=ce.upVector(me.canonical,Mt.x,Mt.y),Rt[0]!==0||Rt[1]!==0||Rt[2]!==1)){const tn=[Rt[2],0,-Rt[0]],rn=i.ad.vec3.cross([],Rt,tn);i.ad.vec3.normalize(tn,tn),i.ad.vec3.normalize(rn,rn),xt=i.ad.vec3.dot(ut,tn),Lt=i.ad.vec3.dot(ut,rn)}if(c){const tn=i.ad.vec3.cross([],Rt,ut);i.ad.vec3.normalize(tn,tn),i.ad.vec3.scaleAndAdd(St,St,tn,c*Ie)}const en=Be+Math.atan2(Lt,xt);return ct.push(St),oe&&Pt.push(Mt),{point:St,angle:en,path:ct,tilePath:Pt,up:Rt}}function Tl(_,s){const c=s.length,g=c+4*_;s.resize(g),s.float32.fill(-1/0,4*c,4*g)}function di(_,s,c){const g=s[0],x=s[1];return _[0]=c[0]*g+c[4]*x+c[12],_[1]=c[1]*g+c[5]*x+c[13],_[3]=c[3]*g+c[7]*x+c[15],_}const ao=100;class tu{constructor(s,c,g=new Cr(s.width+200,s.height+200,25),x=new Cr(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ao,this.screenBottomBoundary=s.height+ao,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,g,x,E,I,k,j){let U=g.projectedAnchorX,$=g.projectedAnchorY,Q=g.projectedAnchorZ;const J=g.elevation,oe=g.tileID,pe=s.getProjection();if(J&&oe){const[Oe,Ne,ze]=pe.upVector(oe.canonical,g.tileAnchorX,g.tileAnchorY),Ue=pe.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=Oe*J*Ue,$+=Ne*J*Ue,Q+=ze*J*Ue}const ce=this.projectAndGetPerspectiveRatio(k,U,$,Q,g.tileID,pe.name==="globe"||!!J||this.transform.pitch>0,pe),me=I*ce.perspectiveRatio,ve=(g.x1*c+x.x-g.padding)*me+ce.point.x,Ee=(g.y1*c+x.y-g.padding)*me+ce.point.y,Pe=(g.x2*c+x.x+g.padding)*me+ce.point.x,Ie=(g.y2*c+x.y+g.padding)*me+ce.point.y,Be=ce.perspectiveRatio<=.55||ce.occluded;return!this.isInsideGrid(ve,Ee,Pe,Ie)||!E&&this.grid.hitTest(ve,Ee,Pe,Ie,j)||Be?{box:[],offscreen:!1,occluded:ce.occluded}:{box:[ve,Ee,Pe,Ie],offscreen:this.isOffscreen(ve,Ee,Pe,Ie),occluded:!1}}placeCollisionCircles(s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce){const me=[],ve=this.transform.elevation,Ee=s.getProjection(),Pe=ve?ve.getAtTileOffsetFunc(ce,this.transform.center.lat,this.transform.worldSize,Ee):null,Ie=new i.P(g.tileAnchorX,g.tileAnchorY);let{x:Be,y:Oe,z:Ne}=Ee.projectTilePoint(Ie.x,Ie.y,ce.canonical);if(Pe){const[Rt,xt,Lt]=Pe(Ie);Be+=Rt,Oe+=xt,Ne+=Lt}const ze=Ee.name==="globe",Ue=this.projectAndGetPerspectiveRatio(k,Be,Oe,Ne,ce,ze||!!ve||this.transform.pitch>0,Ee),{perspectiveRatio:Ye}=Ue,vt=(Q?I/Ye:I*Ye)/i.bw,ct=rl(Be,Oe,Ne,j),Pt=g.lineOffsetX*vt,At=g.lineOffsetY*vt,jt=i.ak(s.layers[0].layout.get("text-max-angle")),ut=Math.cos(jt),It=Ue.signedDistanceFromCamera>0?Ql(vt,E,Pt,At,!1,ct,Ie,g,x,j,{},ve&&!Q?Pe:null,Q&&!!ve,Ee,ce,Q,ut):null;let nt=!1,Mt=!1,St=!0;if(It&&!Ue.occluded){const Rt=.5*oe*Ye+pe,xt=new i.P(-100,-100),Lt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),en=new If,{first:tn,last:rn}=It,fn=tn.path.length;let kn=[];for(let Mn=fn-1;Mn>=1;Mn--)kn.push(tn.path[Mn]);for(let Mn=1;Mn<rn.path.length;Mn++)kn.push(rn.path[Mn]);const vn=2.5*Rt;U&&(kn=kn.map(([Mn,Hn,Nr],ii)=>(Pe&&!ze&&(Nr=Pe(ii<fn-1?tn.tilePath[fn-1-ii]:rn.tilePath[ii-fn+2])[2]),rl(Mn,Hn,Nr,U))),kn.some(Mn=>Mn[3]<=0)&&(kn=[]));let Ln=[];if(kn.length>0){let Mn=1/0,Hn=-1/0,Nr=1/0,ii=-1/0;for(const ir of kn)Mn=Math.min(Mn,ir[0]),Nr=Math.min(Nr,ir[1]),Hn=Math.max(Hn,ir[0]),ii=Math.max(ii,ir[1]);Hn>=xt.x&&Mn<=Lt.x&&ii>=xt.y&&Nr<=Lt.y&&(Ln=[kn.map(ir=>new i.P(ir[0],ir[1]))],(Mn<xt.x||Hn>Lt.x||Nr<xt.y||ii>Lt.y)&&(Ln=i.bu(Ln,xt.x,xt.y,Lt.x,Lt.y)))}for(const Mn of Ln){en.reset(Mn,.25*Rt);let Hn=0;Hn=en.length<=.5*Rt?1:Math.ceil(en.paddedLength/vn)+1;for(let Nr=0;Nr<Hn;Nr++){const ii=Nr/Math.max(Hn-1,1),ir=en.lerp(ii),Ii=ir.x+ao,Nn=ir.y+ao;me.push(Ii,Nn,Rt,0);const mn=Ii-Rt,_r=Nn-Rt,Pr=Ii+Rt,Ar=Nn+Rt;if(St=St&&this.isOffscreen(mn,_r,Pr,Ar),Mt=Mt||this.isInsideGrid(mn,_r,Pr,Ar),!c&&this.grid.hitTestCircle(Ii,Nn,Rt,J)&&(nt=!0,!$))return{circles:[],offscreen:!1,collisionDetected:nt,occluded:!1}}}}return{circles:!$&&nt||!Mt?[]:me,offscreen:St,collisionDetected:nt,occluded:Ue.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let g=1/0,x=1/0,E=-1/0,I=-1/0;for(const $ of s){const Q=new i.P($.x+ao,$.y+ao);g=Math.min(g,Q.x),x=Math.min(x,Q.y),E=Math.max(E,Q.x),I=Math.max(I,Q.y),c.push(Q)}const k=this.grid.query(g,x,E,I).concat(this.ignoredGrid.query(g,x,E,I)),j={},U={};for(const $ of k){const Q=$.key;if(j[Q.bucketInstanceId]===void 0&&(j[Q.bucketInstanceId]={}),j[Q.bucketInstanceId][Q.featureIndex])continue;const J=[new i.P($.x1,$.y1),new i.P($.x2,$.y1),new i.P($.x2,$.y2),new i.P($.x1,$.y2)];i.bv(c,J)&&(j[Q.bucketInstanceId][Q.featureIndex]=!0,U[Q.bucketInstanceId]===void 0&&(U[Q.bucketInstanceId]=[]),U[Q.bucketInstanceId].push(Q.featureIndex))}return U}insertCollisionBox(s,c,g,x,E){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:E},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,g,x,E){const I=c?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:x,collisionGroupID:E};for(let j=0;j<s.length;j+=4)I.insertCircle(k,s[j],s[j+1],s[j+2])}projectAndGetPerspectiveRatio(s,c,g,x,E,I,k){const j=[c,g,x,1];let U=!1;x||this.transform.pitch>0?(i.ad.vec4.transformMat4(j,j,s),this.fogState&&E&&k.name!=="globe"&&(U=function(J,oe,pe,ce,me,ve){const Ee=ve.calculateFogTileMatrix(me),Pe=[oe,pe,ce];return i.ad.vec3.transformMat4(Pe,Pe,Ee),cn(J,i.ad.vec3.length(Pe),ve.pitch,ve._fov)}(this.fogState,c,g,x,E.toUnwrapped(),this.transform)>.9)):di(j,j,s);const $=j[3];return{point:new i.P((j[0]/$+1)/2*this.transform.width+ao,(-j[1]/$+1)/2*this.transform.height+ao),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/$*.5,1.5),signedDistanceFromCamera:$,occluded:I&&j[2]>$||U}}isOffscreen(s,c,g,x){return g<ao||s>=this.screenRightBoundary||x<ao||c>this.screenBottomBoundary}isInsideGrid(s,c,g,x){return g>=0&&s<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=i.ad.mat4.identity([]);return i.ad.mat4.translate(s,s,[-100,-100,0]),s}}function Fi(_,s,c){const g=s.createTileMatrix(_,_.worldSize,c.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),_.projMatrix,g)}function K_(_,s,c){if(s.projection.name===c.projection.name)return _.projMatrix;const g=c.clone();return g.setProjection(s.projection),Fi(g,s.getProjection(),_)}function aa(_,s,c){return s.name===c.projection.name?_.projMatrix:Fi(c,s,_)}class uh{constructor(s,c,g,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Il{constructor(s,c,g,x,E,I=!1){this.text=new uh(s?s.text:null,c,g,E),this.icon=new uh(s?s.icon:null,c,x,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ml{constructor(s,c,g,x=!1){this.text=s,this.icon=c,this.skipFade=g,this.clipped=x}}class vv{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class Sc{constructor(s,c,g,x,E){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=E}}class Px{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[s]}}function mg(_,s,c,g,x){const{horizontalAlign:E,verticalAlign:I}=i.bD(_),k=-(E-.5)*s,j=-(I-.5)*c,U=i.bC(_,g);return new i.P(k+U[0]*x,j+U[1]*x)}function xs(_,s,c,g,x){const E=new i.P(_,s);return c&&E._rotate(g?x:-x),E}class Ax{constructor(s,c,g,x,E,I){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new tu(this.transform,E),this.buildingIndex=I,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Px(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,g,x,E=1){const I=g.getBucket(c),k=g.latestFeatureIndex;if(!I||!k||c.fqid!==I.layerIds[0])return;const j=I.layers[0].layout,U=I.layers[0].paint,$=g.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),J=g.tileSize/i.ai,oe=g.tileID.toUnwrapped();this.transform.setProjection(I.projection);const pe=(ce=g.tileID,me=I.getProjection(),ve=this.transform,me.name===this.projection?ve.calculateProjMatrix(ce.toUnwrapped()):Fi(ve,me,ce));var ce,me,ve;const Ee=j.get("text-pitch-alignment")==="map",Pe=j.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const Ie=c.dynamicFilter(),Be=c.dynamicFilterNeedsFeature(),Oe=this.transform.calculatePixelsToTileUnitsMatrix(g),Ne=vs(pe,g.tileID.canonical,Ee,Pe,this.transform,I.getProjection(),Oe);let ze=null;if(Ee){const It=Qi(pe,g.tileID.canonical,Ee,Pe,this.transform,I.getProjection(),Oe);ze=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,It)}let Ue=null;Ie&&g.latestFeatureIndex&&(Ue={unwrappedTileID:oe,dynamicFilter:Ie,dynamicFilterNeedsFeature:Be}),this.retainedQueryData[I.bucketInstanceId]=new Sc(I.bucketInstanceId,k,I.sourceLayerIndex,I.index,g.tileID);const[Ye,vt]=I.layers[0].layout.get("text-size-scale-range"),ct=i.ay(E,Ye,vt),[Pt,At]=j.get("icon-size-scale-range"),jt=i.ay(E,Pt,At),ut={bucket:I,layout:j,paint:U,posMatrix:pe,textLabelPlaneMatrix:Ne,labelToScreenMatrix:ze,clippingData:Ue,scale:Q,textPixelRatio:J,holdingForFade:g.holdingForFade(),collisionBoxArray:$,partiallyEvaluatedTextSize:i.bp(I.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:i.bp(I.iconSizeData,this.transform.zoom,jt),collisionGroup:this.collisionGroups.get(I.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(x)for(const It of I.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Mt,symbolInstanceEnd:St}=It;s.push({sortKey:nt,symbolInstanceStart:Mt,symbolInstanceEnd:St,parameters:ut})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:ut})}attemptAnchorPlacement(s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee){const{textOffset0:Pe,textOffset1:Ie,crossTileID:Be}=J,Oe=[Pe,Ie],Ne=mg(s,g,x,Oe,E),ze=this.collisionIndex.placeCollisionBox(pe,E,c,xs(Ne.x,Ne.y,I,k,this.transform.angle),Q,j,U,$.predicate);if(me){const Ue=pe.getSymbolInstanceIconSize(Ee,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(pe,Ue,me,xs(Ne.x,Ne.y,I,k,this.transform.angle),Q,j,U,$.predicate).box.length===0)return}if(ze.box.length>0){let Ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(Ue=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:Oe,width:g,height:x,anchor:s,textScale:E,prevAnchor:Ue},this.markUsedJustification(pe,s,J,ce),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,ce,J),this.placedOrientations[Be]=ce),{shift:Ne,placedGlyphBoxes:ze}}}placeLayerBucketPart(s,c,g,x,E=1){const{bucket:I,layout:k,paint:j,posMatrix:U,textLabelPlaneMatrix:$,labelToScreenMatrix:Q,clippingData:J,textPixelRatio:oe,holdingForFade:pe,collisionBoxArray:ce,partiallyEvaluatedTextSize:me,partiallyEvaluatedIconSize:ve,collisionGroup:Ee,latestFeatureIndex:Pe}=s.parameters,Ie=k.get("text-optional"),Be=k.get("icon-optional"),Oe=k.get("text-allow-overlap"),Ne=k.get("icon-allow-overlap"),ze=k.get("text-rotation-alignment")==="map",Ue=k.get("text-pitch-alignment")==="map",Ye=j.get("symbol-z-offset"),vt=k.get("symbol-elevation-reference")==="sea",[ct,Pt]=k.get("text-size-scale-range"),[At,jt]=k.get("icon-size-scale-range"),ut=i.ay(E,ct,Pt),It=i.ay(E,At,jt);this.transform.setProjection(I.projection);let nt=Oe&&(Ne||!I.hasIconData()||Be),Mt=Ne&&(Oe||!I.hasTextData()||Ie);const St=!Ye.isConstant();!I.collisionArrays&&ce&&I.deserializeCollisionBoxes(ce),g&&x&&I.updateCollisionDebugBuffers(this.transform.zoom,ce,ut,It);const Rt=(xt,Lt,en)=>{const{crossTileID:tn,numVerticalGlyphVertices:rn}=xt;let fn=null;if(J&&J.dynamicFilterNeedsFeature||St){const Or=this.retainedQueryData[I.bucketInstanceId];fn=Pe.loadFeature({featureIndex:xt.featureIndex,bucketIndex:Or.bucketIndex,sourceLayerIndex:Or.sourceLayerIndex,layoutVertexArrayOffset:0})}if(J&&!(0,J.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},fn,this.retainedQueryData[I.bucketInstanceId].tileID.canonical,new i.P(xt.tileAnchorX,xt.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[tn]=new Ml(!1,!1,!1,!0),void c.add(tn);const kn=Ye.evaluate(fn,{});if(c.has(tn))return;if(pe)return void(this.placements[tn]=new Ml(!1,!1,!1));let vn=!1,Ln=!1,Mn=!0,Hn=!1,Nr=!1,ii=null,ir={box:null,offscreen:null,occluded:null},Ii={box:null},Nn=null,mn=null,_r=null,Pr=0,Ar=0,gi=0;en.textFeatureIndex?Pr=en.textFeatureIndex:xt.useRuntimeCollisionCircles&&(Pr=xt.featureIndex),en.verticalTextFeatureIndex&&(Ar=en.verticalTextFeatureIndex);const uo=Or=>{Or.tileID=this.retainedQueryData[I.bucketInstanceId].tileID;const bi=this.transform.elevation;Or.elevation=vt?kn:kn+(bi?bi.getAtTileOffset(Or.tileID,Or.tileAnchorX,Or.tileAnchorY):0),Or.elevation+=xt.zOffset},_o=en.textBox;if(_o){uo(_o);const Or=kr=>{let Wr=i.bq.horizontal;if(I.allowVerticalPlacement&&!kr&&this.prevPlacement){const cs=this.prevPlacement.placedOrientations[tn];cs&&(this.placedOrientations[tn]=cs,Wr=cs,this.markUsedOrientation(I,Wr,xt))}return Wr},bi=(kr,Wr)=>{if(I.allowVerticalPlacement&&rn>0&&en.verticalTextBox){for(const cs of I.writingModes)if(cs===i.bq.vertical?(ir=Wr(),Ii=ir):ir=kr(),ir&&ir.box&&ir.box.length)break}else ir=kr()};if(k.get("text-variable-anchor")){let kr=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[tn]){const oi=this.prevPlacement.variableOffsets[tn];kr.indexOf(oi.anchor)>0&&(kr=kr.filter(vo=>vo!==oi.anchor),kr.unshift(oi.anchor))}const Wr=(oi,vo,Li)=>{const Ua=I.getSymbolInstanceTextSize(me,xt,this.transform.zoom,Lt),dl=(oi.x2-oi.x1)*Ua+2*oi.padding,_a=(oi.y2-oi.y1)*Ua+2*oi.padding,zl=xt.hasIconTextFit&&!Ne?vo:null;zl&&uo(zl);let ya={box:[],offscreen:!1,occluded:!1};const Qu=Oe?2*kr.length:kr.length;for(let ec=0;ec<Qu;++ec){const ts=this.attemptAnchorPlacement(kr[ec%kr.length],oi,dl,_a,Ua,ze,Ue,oe,U,Ee,ec>=kr.length,xt,Lt,I,Li,zl,me,ve);if(ts&&(ya=ts.placedGlyphBoxes,ya&&ya.box&&ya.box.length)){vn=!0,ii=ts.shift;break}}return ya};bi(()=>Wr(_o,en.iconBox,i.bq.horizontal),()=>{const oi=en.verticalTextBox;return oi&&uo(oi),I.allowVerticalPlacement&&!(ir&&ir.box&&ir.box.length)&&rn>0&&oi?Wr(oi,en.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),ir&&(vn=ir.box,Mn=ir.offscreen,Hn=ir.occluded);const cs=Or(!(!ir||!ir.box));if(!vn&&this.prevPlacement){const oi=this.prevPlacement.variableOffsets[tn];oi&&(this.variableOffsets[tn]=oi,this.markUsedJustification(I,oi.anchor,xt,cs))}}else{const kr=(Wr,cs)=>{const oi=I.getSymbolInstanceTextSize(me,xt,this.transform.zoom,Lt,E),vo=this.collisionIndex.placeCollisionBox(I,oi,Wr,new i.P(0,0),Oe,oe,U,Ee.predicate);return vo&&vo.box&&vo.box.length&&(this.markUsedOrientation(I,cs,xt),this.placedOrientations[tn]=cs),vo};bi(()=>kr(_o,i.bq.horizontal),()=>{const Wr=en.verticalTextBox;return I.allowVerticalPlacement&&rn>0&&Wr?(uo(Wr),kr(Wr,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Or(!!(ir&&ir.box&&ir.box.length))}}if(Nn=ir,vn=Nn&&Nn.box&&Nn.box.length>0,Mn=Nn&&Nn.offscreen,Hn=Nn&&Nn.occluded,xt.useRuntimeCollisionCircles){const Or=I.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex>=0?xt.centerJustifiedTextSymbolIndex:xt.verticalPlacedTextSymbolIndex),bi=i.br(I.textSizeData,me,Or),kr=k.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(I,Oe,Or,I.lineVertexArray,I.glyphOffsetArray,bi,U,$,Q,g,Ue,Ee.predicate,xt.collisionCircleDiameter*bi/i.bw,kr,this.retainedQueryData[I.bucketInstanceId].tileID),vn=Oe||mn.circles.length>0&&!mn.collisionDetected,Mn=Mn&&mn.offscreen,Hn=mn.occluded}if(en.iconFeatureIndex&&(gi=en.iconFeatureIndex),en.iconBox){const Or=bi=>{uo(bi);const kr=xt.hasIconTextFit&&ii?xs(ii.x,ii.y,ze,Ue,this.transform.angle):new i.P(0,0),Wr=I.getSymbolInstanceIconSize(ve,this.transform.zoom,xt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(I,Wr,bi,kr,Ne,oe,U,Ee.predicate)};Ii&&Ii.box&&Ii.box.length&&en.verticalIconBox?(_r=Or(en.verticalIconBox),Ln=_r.box.length>0):(_r=Or(en.iconBox),Ln=_r.box.length>0),Mn=Mn&&_r.offscreen,Nr=_r.occluded}const yo=Ie||xt.numHorizontalGlyphVertices===0&&rn===0,Xs=Be||xt.numIconVertices===0;if(yo||Xs?Xs?yo||(Ln=Ln&&vn):vn=Ln&&vn:Ln=vn=Ln&&vn,vn&&Nn&&Nn.box&&this.collisionIndex.insertCollisionBox(Nn.box,k.get("text-ignore-placement"),I.bucketInstanceId,Ii&&Ii.box&&Ar?Ar:Pr,Ee.ID),Ln&&_r&&this.collisionIndex.insertCollisionBox(_r.box,k.get("icon-ignore-placement"),I.bucketInstanceId,gi,Ee.ID),mn&&(vn&&this.collisionIndex.insertCollisionCircles(mn.circles,k.get("text-ignore-placement"),I.bucketInstanceId,Pr,Ee.ID),g)){const Or=I.bucketInstanceId;let bi=this.collisionCircleArrays[Or];bi===void 0&&(bi=this.collisionCircleArrays[Or]=new vv);for(let kr=0;kr<mn.circles.length;kr+=4)bi.circles.push(mn.circles[kr+0]),bi.circles.push(mn.circles[kr+1]),bi.circles.push(mn.circles[kr+2]),bi.circles.push(mn.collisionDetected?1:0)}const Ls=I.projection.name!=="globe";nt=nt&&(Ls||!Hn),Mt=Mt&&(Ls||!Nr),this.placements[tn]=new Ml(vn||nt,Ln||Mt,Mn||I.justReloaded),c.add(tn)};if(I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,this.retainedQueryData[I.bucketInstanceId].tileID),I.elevationType==="road"&&I.updateRoadElevation(),I.updateZOffset(),I.sortFeaturesByY){const xt=I.getSortedSymbolIndexes(this.transform.angle);for(let Lt=xt.length-1;Lt>=0;--Lt){const en=xt[Lt];Rt(I.symbolInstances.get(en),en,I.collisionArrays[en])}I.hasAnyZOffset&&i.w(`${I.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(I.hasAnyZOffset){const xt=I.getSortedIndexesByZOffset();for(let Lt=0;Lt<xt.length;++Lt){const en=xt[Lt];Rt(I.symbolInstances.get(en),en,I.collisionArrays[en])}}else for(let xt=s.symbolInstanceStart;xt<s.symbolInstanceEnd;xt++)Rt(I.symbolInstances.get(xt),xt,I.collisionArrays[xt]);if(g&&I.bucketInstanceId in this.collisionCircleArrays){const xt=this.collisionCircleArrays[I.bucketInstanceId];i.ad.mat4.invert(xt.invProjMatrix,U),xt.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(s,c,g,x){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:j,crossTileID:U}=g,$=i.bB(c),Q=x===i.bq.vertical?j:$==="left"?E:$==="center"?I:$==="right"?k:-1;E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=Q>=0&&E!==Q?0:U),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=Q>=0&&I!==Q?0:U),k>=0&&(s.text.placedSymbolArray.get(k).crossTileID=Q>=0&&k!==Q?0:U),j>=0&&(s.text.placedSymbolArray.get(j).crossTileID=Q>=0&&j!==Q?0:U)}markUsedOrientation(s,c,g){const x=c===i.bq.horizontal||c===i.bq.horizontalOnly?c:0,E=c===i.bq.vertical?c:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:U}=g,$=s.text.placedSymbolArray;I>=0&&($.get(I).placedOrientation=x),k>=0&&($.get(k).placedOrientation=x),j>=0&&($.get(j).placedOrientation=x),U>=0&&($.get(U).placedOrientation=E)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(s):1,E=c?c.opacities:{},I=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const j in this.placements){const U=this.placements[j],$=E[j];$?(this.opacities[j]=new Il($,x,U.text,U.icon,null,U.clipped),g=g||U.text!==$.text.placed||U.icon!==$.icon.placed):(this.opacities[j]=new Il(null,x,U.text,U.icon,U.skipFade,U.clipped),g=g||U.text||U.icon)}for(const j in E){const U=E[j];if(!this.opacities[j]){const $=new Il(U,x,!1,!1);$.isHidden()||(this.opacities[j]=$,g=g||U.text.placed||U.icon.placed)}}for(const j in I)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=I[j]);for(const j in k)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=k[j]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,g,x){const E=new Set;for(const I of c){const k=I.getBucket(s);k&&I.latestFeatureIndex&&s.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,E,I,I.collisionBoxArray,g,x,I.tileID,s.scope),k.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(k,I.tileID),k.elevationType==="road"&&k.updateRoadElevation(),k.updateZOffset())}}updateBucketOpacities(s,c,g,x,E,I,k,j){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const U=s.layers[0].layout,$=s.layers[0].paint,Q=!!s.layers[0].dynamicFilter(),J=new Il(null,0,!1,!1,!0),oe=U.get("text-allow-overlap"),pe=U.get("icon-allow-overlap"),ce=U.get("text-variable-anchor"),me=U.get("text-rotation-alignment")==="map",ve=U.get("text-pitch-alignment")==="map",Ee=$.get("symbol-z-offset"),Pe=U.get("symbol-elevation-reference")==="sea",Ie=!Ee.isConstant(),Be=new Il(null,0,oe&&(pe||!s.hasIconData()||U.get("icon-optional")),pe&&(oe||!s.hasTextData()||U.get("text-optional")),!0);!s.collisionArrays&&x&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(x);const Oe=(ze,Ue,Ye)=>{for(let vt=0;vt<Ue/4;vt++)ze.opacityVertexArray.emplaceBack(Ye)};let Ne=0;I&&s.updateReplacement(k,I);for(let ze=0;ze<s.symbolInstances.length;ze++){const Ue=s.symbolInstances.get(ze),{numHorizontalGlyphVertices:Ye,numVerticalGlyphVertices:vt,crossTileID:ct,numIconVertices:Pt,tileAnchorX:At,tileAnchorY:jt}=Ue;let ut=null;const It=this.retainedQueryData[s.bucketInstanceId];Ie&&Ue&&It&&(ut=g.latestFeatureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:It.bucketIndex,sourceLayerIndex:It.sourceLayerIndex,layoutVertexArrayOffset:0}));const nt=Ee.evaluate(ut,{}),Mt=c.has(ct);let St=this.opacities[ct];Mt?St=J:St||(St=Be,this.opacities[ct]=St),c.add(ct);const Rt=Ye>0||vt>0,xt=Pt>0,Lt=this.placedOrientations[ct],en=Lt===i.bq.vertical,tn=Lt===i.bq.horizontal||Lt===i.bq.horizontalOnly;!Rt&&!xt||St.isHidden()||Ne++;let rn=!1;if((Rt||xt)&&I)for(const fn of s.activeReplacements){if(i.bx(fn,E,i.by.Symbol,j)||fn.min.x>At||At>fn.max.x||fn.min.y>jt||jt>fn.max.y)continue;const kn=i.bz(At,jt,k.canonical,fn.footprintTileId.canonical);if(rn=i.bA(kn,fn.footprint),rn)break}if(Rt){const fn=rn?Ec:xd(St.text);Oe(s.text,Ye,en?Ec:fn),Oe(s.text,vt,tn?Ec:fn);const kn=St.text.isHidden(),{leftJustifiedTextSymbolIndex:vn,centerJustifiedTextSymbolIndex:Ln,rightJustifiedTextSymbolIndex:Mn,verticalPlacedTextSymbolIndex:Hn}=Ue,Nr=s.text.placedSymbolArray,ii=kn||en?1:0;vn>=0&&(Nr.get(vn).hidden=ii),Ln>=0&&(Nr.get(Ln).hidden=ii),Mn>=0&&(Nr.get(Mn).hidden=ii),Hn>=0&&(Nr.get(Hn).hidden=kn||tn?1:0);const ir=this.variableOffsets[ct];ir&&this.markUsedJustification(s,ir.anchor,Ue,Lt);const Ii=this.placedOrientations[ct];Ii&&(this.markUsedJustification(s,"left",Ue,Ii),this.markUsedOrientation(s,Ii,Ue))}if(xt){const fn=rn?Ec:xd(St.icon),{placedIconSymbolIndex:kn,verticalPlacedIconSymbolIndex:vn}=Ue,Ln=s.icon.placedSymbolArray,Mn=St.icon.isHidden()?1:0;kn>=0&&(Oe(s.icon,Pt,en?Ec:fn),Ln.get(kn).hidden=Mn),vn>=0&&(Oe(s.icon,Ue.numVerticalIconVertices,tn?Ec:fn),Ln.get(vn).hidden=Mn)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const fn=s.collisionArrays[ze];if(fn){let kn=new i.P(0,0),vn=!0;if(fn.textBox||fn.verticalTextBox){if(ce){const Mn=this.variableOffsets[ct];Mn?(kn=mg(Mn.anchor,Mn.width,Mn.height,Mn.textOffset,Mn.textScale),me&&kn._rotate(ve?this.transform.angle:-this.transform.angle)):vn=!1}Q&&(vn=!St.clipped),fn.textBox&&vd(s.textCollisionBox.collisionVertexArray,St.text.placed,!vn||en,nt,Pe,kn.x,kn.y),fn.verticalTextBox&&vd(s.textCollisionBox.collisionVertexArray,St.text.placed,!vn||tn,nt,Pe,kn.x,kn.y)}const Ln=vn&&!!(!tn&&fn.verticalIconBox);fn.iconBox&&vd(s.iconCollisionBox.collisionVertexArray,St.icon.placed,Ln,nt,Pe,Ue.hasIconTextFit?kn.x:0,Ue.hasIconTextFit?kn.y:0),fn.verticalIconBox&&vd(s.iconCollisionBox.collisionVertexArray,St.icon.placed,!Ln,nt,Pe,Ue.hasIconTextFit?kn.x:0,Ue.hasIconTextFit?kn.y:0)}}}if(s.fullyClipped=Ne===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ze.invProjMatrix,s.placementViewportMatrix=ze.viewportMatrix,s.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function vd(_,s,c,g,x,E,I){_.emplaceBack(s?1:0,c?1:0,E||0,I||0,g,x?1:0),_.emplaceBack(s?1:0,c?1:0,E||0,I||0,g,x?1:0),_.emplaceBack(s?1:0,c?1:0,E||0,I||0,g,x?1:0),_.emplaceBack(s?1:0,c?1:0,E||0,I||0,g,x?1:0)}const xv=Math.pow(2,25),Xp=Math.pow(2,24),Rx=Math.pow(2,17),bv=Math.pow(2,16),Zp=Math.pow(2,9),Yp=Math.pow(2,8),Lx=Math.pow(2,1);function xd(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,c=Math.floor(127*_.opacity);return c*xv+s*Xp+c*Rx+s*bv+c*Zp+s*Yp+c*Lx+s}const Ec=0;class gg{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,g,x,E,I){const k=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(k,x,s[this._currentTileIndex],this._sortAcrossTiles,I),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((j,U)=>j.sortKey-U.sortKey));this._currentPartIndex<k.length;){const j=k[this._currentPartIndex];if(c.placeLayerBucketPart(j,this._seenCrossTileIDs,g,j.symbolInstanceStart===0,I),this._currentPartIndex++,E())return!0}return!1}}class ch{constructor(s,c,g,x,E,I,k,j,U){this.placement=new Ax(s,E,I,k,j,U),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,c,g,x,E){const I=i.q.now(),k=()=>{const j=i.q.now()-I;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=c[s[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=U)&&(!j.maxzoom||j.maxzoom>U)){const $=j,Q=$.layout.get("symbol-z-elevate"),J=$.layout.get("symbol-sort-key").constantOr(1)!==void 0,oe=$.layout.get("symbol-z-order"),pe=oe==="viewport-y"||oe==="auto"&&!(oe!=="viewport-y"&&J),ce=$.layout.get("text-allow-overlap")||$.layout.get("icon-allow-overlap")||$.layout.get("text-ignore-placement")||$.layout.get("icon-ignore-placement"),me=pe&&ce,ve=this._inProgressLayer=this._inProgressLayer||new gg($),Ee=i.C(j.source,j.scope);if(ve.continuePlacement(Q||me?x[Ee]:g[Ee],this.placement,this._showCollisionBoxes,j,k,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const J_=512/i.ai/2;class wv{constructor(s,c,g){this.tileID=s,this.bucketInstanceId=g,this.index=new i.bE(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=s.canonical.x*i.ai,E=s.canonical.y*i.ai;for(let I=0;I<c.length;I++){const{key:k,crossTileID:j,tileAnchorX:U,tileAnchorY:$}=c.get(I),Q=Math.floor((x+U)*J_),J=Math.floor((E+$)*J_);this.index.add(Q,J),this.keys.push(k),this.crossTileIDs.push(j)}this.index.finish()}findMatches(s,c,g){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),E=J_/Math.pow(2,c.canonical.z-this.tileID.canonical.z),I=c.canonical.x*i.ai,k=c.canonical.y*i.ai;for(let j=0;j<s.length;j++){const U=s.get(j);if(U.crossTileID)continue;const{key:$,tileAnchorX:Q,tileAnchorY:J}=U,oe=Math.floor((I+Q)*E),pe=Math.floor((k+J)*E),ce=this.index.range(oe-x,pe-x,oe+x,pe+x);for(const me of ce){const ve=this.crossTileIDs[me];if(this.keys[me]===$&&!g.has(ve)){g.add(ve),U.crossTileID=ve;break}}}}}class Ox{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const g in this.indexes){const x=this.indexes[g],E={};for(const I in x){const k=x[I];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),E[k.tileID.key]=k}this.indexes[g]=E}this.lng=s}addBucket(s,c,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let E=0;E<c.symbolInstances.length;E++)c.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const x=this.usedCrossTileIDs[s.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>s.overscaledZ)for(const k in I){const j=I[k];j.tileID.isChildOf(s)&&j.findMatches(c.symbolInstances,s,x)}else{const k=I[s.scaledTo(Number(E)).key];k&&k.findMatches(c.symbolInstances,s,x)}}for(let E=0;E<c.symbolInstances.length;E++){const I=c.symbolInstances.get(E);I.crossTileID||(I.crossTileID=g.generate(),x.add(I.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new wv(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const g of c.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let c=!1;for(const g in this.indexes){const x=this.indexes[g];for(const E in x)s[x[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[E]),delete x[E],c=!0)}return c}}class Dx{constructor(){this.layerIndexes={},this.crossTileIDs=new Ox,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,g,x){let E=this.layerIndexes[s.fqid];E===void 0&&(E=this.layerIndexes[s.fqid]=new Sv);let I=!1;const k={};x.name!=="globe"&&E.handleWrapJump(g);for(const j of c){const U=j.getBucket(s);U&&s.fqid===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(j.tileID,U,this.crossTileIDs)&&(I=!0),k[U.bucketInstanceId]=!0)}return E.removeStaleBuckets(k)&&(I=!0),I}pruneUnusedLayers(s){const c={};s.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}const hh=771;class pr{constructor(s,c,g,x){this.blendFunction=s,this.blendColor=c,this.mask=g,this.blendEquation=x}}pr.Replace=[1,0,1,0],pr.disabled=new pr(pr.Replace,i.al.transparent,[!1,!1,!1,!1]),pr.unblended=new pr(pr.Replace,i.al.transparent,[!0,!0,!0,!0]),pr.alphaBlended=new pr([1,hh,1,hh],i.al.transparent,[!0,!0,!0,!0]),pr.alphaBlendedNonPremultiplied=new pr([770,hh,770,hh],i.al.transparent,[!0,!0,!0,!0]),pr.multiply=new pr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class En{constructor(s,c,g){this.func=s,this.mask=c,this.range=g}}En.ReadOnly=!1,En.ReadWrite=!0,En.disabled=new En(519,En.ReadOnly,[0,1]);const _g=7680;class Vn{constructor(s,c,g,x,E,I){this.test=s,this.ref=c,this.mask=g,this.fail=x,this.depthFail=E,this.pass=I}}Vn.disabled=new Vn({func:519,mask:0},0,0,_g,_g,_g);const il=1029,Mf=2305;class Fn{constructor(s,c,g){this.enable=s,this.mode=c,this.frontFace=g}}function yg(_,s){const c=i.bG(_,3);i.ad.mat4.fromQuat(_,s),i.bI(_,3,c)}function dh(_,s){const c=i.ad.quat.identity([]);return i.ad.quat.rotateZ(c,c,-s),i.ad.quat.rotateX(c,c,-_),c}function bd(_,s){const c=[_[0],_[1],0],g=[s[0],s[1],0];if(i.ad.vec3.length(c)>=1e-15){const I=i.ad.vec3.normalize([],c);i.ad.vec3.scale(g,I,i.ad.vec3.dot(g,I)),s[0]=g[0],s[1]=g[1]}const x=i.ad.vec3.cross([],s,_);if(i.ad.vec3.len(x)<1e-15)return null;const E=Math.atan2(-x[1],x[0]);return dh(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),E)}Fn.disabled=new Fn(!1,il,Mf),Fn.backCCW=new Fn(!0,il,Mf),Fn.backCW=new Fn(!0,il,2304),Fn.frontCW=new Fn(!0,1028,2304),Fn.frontCCW=new Fn(!0,1028,Mf);class vg{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof i.ac?s:new i.ac(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=i.bF(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(s)):0,E=i.ac.fromLngLat(s,x),I=[E.x-g.x,E.y-g.y,E.z-g.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=bd(I,c)}setPitchBearing(s,c){this.orientation=dh(i.ak(s),i.ak(-c))}}class nu{constructor(s,c){this._transform=i.ad.mat4.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new i.ac(s[0],s[1],s[2])}get position(){const s=i.bG(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&i.bI(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.ad.quat.identity([]),s&&yg(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=dh(s,c),yg(this._transform,this._orientation)}forward(){const s=i.bG(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=i.bG(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=i.bG(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const g=new Float64Array(16);return i.ad.mat4.invert(g,this.getWorldToCamera(s,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,g){const x=this.position;i.ad.vec3.scale(x,x,-s);const E=new Float64Array(16);return i.ad.mat4.fromScaling(E,[g,g,g]),i.ad.mat4.translate(E,E,x),E[10]*=c,E}getWorldToCamera(s,c){const g=new Float64Array(16),x=new Float64Array(4),E=this.position;return i.ad.quat.conjugate(x,this._orientation),i.ad.vec3.scale(E,E,-s),i.ad.mat4.fromQuat(g,x),i.ad.mat4.translate(g,g,E),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(s,c,g,x){const E=new Float64Array(16);return i.ad.mat4.perspective(E,s,c,g,x),E}getCameraToClipOrthographic(s,c,g,x,E,I){const k=new Float64Array(16);return i.ad.mat4.ortho(k,s,c,g,x,E,I),k}getDistanceToElevation(s,c=!1){const g=s===0?0:i.bH(s,c?i.aT(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new nu([...this.position],[...this.orientation])}}const Hi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Kp{constructor(s=0,c=0,g=0,x=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=g,this.right=x}interpolate(s,c,g){return c.top!=null&&s.top!=null&&(this.top=i.ah(s.top,c.top,g)),c.bottom!=null&&s.bottom!=null&&(this.bottom=i.ah(s.bottom,c.bottom,g)),c.left!=null&&s.left!=null&&(this.left=i.ah(s.left,c.left,g)),c.right!=null&&s.right!=null&&(this.right=i.ah(s.right,c.right,g)),this}getCenter(s,c){const g=i.ay((this.left+s-this.right)/2,0,s),x=i.ay((this.top+c-this.bottom)/2,0,c);return new i.P(g,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Kp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qt=15;class Jp{constructor(s,c,g,x,E,I,k){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(I),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Kp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new nu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Jp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Qt}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,c=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const g=this.getProjection(),x=!i.bn(c,g);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=i.ay(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.ak(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,E=0;for(let I=0;I<c.length;I++){const k=new i.P(c[I][0]*this.width,g+c[I][1]*(this.height-g)),j=s.pointCoordinate(k);if(!j)continue;const U=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);x+=j[3]*U,E+=U}return E===0?NaN:x/E}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(s),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(x-g,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const x=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,g));return i.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!i.ad.quat.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];i.ad.vec3.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new vg;return c.position=new i.ac(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!i.ad.quat.length(s))return!1;i.ad.quat.normalize(s,s);const c=i.ad.vec3.transformQuat([],[0,0,-1],s),g=i.ad.vec3.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const x=bd(c,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=i.ay(s[2],x/g,x/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,g){this._unmodified=!1,this._edgeInsets.interpolate(s,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new i.bQ(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new i.P(0,0)),x=this.pointCoordinate(new i.P(this.width,0)),E=this.pointCoordinate(new i.P(this.width,this.height)),I=this.pointCoordinate(new i.P(0,this.height)),k=Math.floor(Math.min(g.x,x.x,E.x,I.x)),j=Math.floor(Math.max(g.x,x.x,E.x,I.x)),U=1;for(let $=k-U;$<=j+U;$++)$!==0&&c.push(new i.bQ($,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,g){let x=[];const E=g!==void 0,I=!E;if(I&&this.zoom<c||E&&g[0]===0&&g[1]===0)return x;const k=new Set,j=($,Q,J,oe,pe)=>{const ce=i.c5(Q,$,J,oe,pe);k.has(ce)||(x.push(new i.aH($,Q,J,oe,pe)),k.add(ce))};for(let $=0;$<s.length;$++){const Q=s[$];if(I&&Q.canonical.z!==c)continue;const J=Q.canonical,oe=Q.overscaledZ,pe=Q.wrap,ce=1<<J.z,me=J.x+1<ce,ve=J.x>0,Ee=J.y+1<ce,Pe=J.y>0,Ie=Q.wrap-(ve?0:1),Be=Q.wrap+(me?0:1),Oe=ve?J.x-1:ce-1,Ne=me?J.x+1:0;if(E)g[0]<0?(j(oe,Be,J.z,Ne,J.y),g[1]<0&&Ee&&(j(oe,pe,J.z,J.x,J.y+1),j(oe,Be,J.z,Ne,J.y+1)),g[1]>0&&Pe&&(j(oe,pe,J.z,J.x,J.y-1),j(oe,Be,J.z,Ne,J.y-1))):g[0]>0?(j(oe,Ie,J.z,Oe,J.y),g[1]<0&&Ee&&(j(oe,pe,J.z,J.x,J.y+1),j(oe,Ie,J.z,Oe,J.y+1)),g[1]>0&&Pe&&(j(oe,pe,J.z,J.x,J.y-1),j(oe,Ie,J.z,Oe,J.y-1))):g[1]<0&&Ee?j(oe,pe,J.z,J.x,J.y+1):Pe&&j(oe,pe,J.z,J.x,J.y-1);else{const ze=Q.visibleQuadrants;1&ze&&(j(oe,Ie,J.z,Oe,J.y),Pe&&(j(oe,pe,J.z,J.x,J.y-1),j(oe,Ie,J.z,Oe,J.y-1))),2&ze&&(j(oe,Be,J.z,Ne,J.y),Pe&&(j(oe,pe,J.z,J.x,J.y-1),j(oe,Be,J.z,Ne,J.y-1))),4&ze&&(j(oe,Ie,J.z,Oe,J.y),Ee&&(j(oe,pe,J.z,J.x,J.y+1),j(oe,Ie,J.z,Oe,J.y+1))),8&ze&&(j(oe,Be,J.z,Ne,J.y),Ee&&(j(oe,pe,J.z,J.x,J.y+1),j(oe,Be,J.z,Ne,J.y+1)))}}const U=[];for(const $ of x)x.some(Q=>$.isChildOf(Q))||U.push($);if(x=U.filter($=>!s.some(Q=>!!($.overscaledZ<c&&Q.isChildOf($))||$.equals(Q)||$.isChildOf(Q))),I){const $=1<<c,Q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[$*Q.x,$*Q.y],oe=4,pe=oe*oe;x=x.filter(ce=>{const me=ce.canonical.x+.5-J[0],ve=ce.canonical.y+.5-J[1];return me*me+ve*ve<pe})}return x}coveringTiles(s){let c=this.coveringZoomLevel(s);const g=c,x=this.elevation&&this.elevation.exaggeration(),E=x&&!s.isTerrainDEM,I=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const k=this.locationCoordinate(this.center),j=this.center.lat,U=1<<c,$=[U*k.x,U*k.y,0],Q=this.projection.name==="globe",J=!Q,oe=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,J),pe=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ce=U*i.bH(1,this.center.lat),me=this._camera.position[2]/i.bH(1,this.center.lat),ve=[U*pe.x,U*pe.y,me*(J?1:ce)],Ee=Q||x,Pe=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),Ie=this.isLODDisabled(!0)?c:0;let Be;if(this._elevation&&s.isTerrainDEM)Be=1e4*this._elevation.exaggeration();else if(this._elevation){const nt=this._elevation.getMinMaxForVisibleTiles();Be=nt?nt.max:this._centerAltitude}else Be=this._centerAltitude;const Oe=s.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ne=this.projection.isReprojectedInTileSpace?i.bS(this):1,ze=nt=>{const St=new i.ac(nt.x+25e-6,nt.y,nt.z),Rt=new i.ac(nt.x,nt.y+25e-6,nt.z),xt=nt.toLngLat(),Lt=St.toLngLat(),en=Rt.toLngLat(),tn=this.locationCoordinate(xt),rn=this.locationCoordinate(Lt),fn=this.locationCoordinate(en),kn=Math.hypot(rn.x-tn.x,rn.y-tn.y),vn=Math.hypot(fn.x-tn.x,fn.y-tn.y);return Math.sqrt(kn*vn)*Ne/25e-6},Ue=nt=>{const Mt=Be,St=Oe;return{aabb:i.bV(this,U,0,0,0,nt,St,Mt,this.projection),zoom:0,x:0,y:0,minZ:St,maxZ:Mt,wrap:nt,fullyVisible:!1}},Ye=[];let vt=[];const ct=c,Pt=s.reparseOverscaled?g:c,At=(me-this._centerAltitude)*ce,jt=nt=>{if(!this._elevation||!nt.tileID||!I)return;const Mt=this._elevation.getMinMaxForTile(nt.tileID),St=nt.aabb;Mt?(St.min[2]=Mt.min,St.max[2]=Mt.max,St.center[2]=(St.min[2]+St.max[2])/2):(nt.shouldSplit=It(nt),nt.shouldSplit||(St.min[2]=St.max[2]=St.center[2]=this._centerAltitude))},ut=(nt,Mt)=>{if(.707*Mt<nt)return 1;const St=Mt/nt;return St/(1.4144271570014144+(Math.pow(1.1,St-1.4144271570014144+1)-1)/(1.1-1)-1)},It=nt=>{if(nt.zoom<Ie)return!0;if(nt.zoom===ct)return!1;if(nt.shouldSplit!=null)return nt.shouldSplit;const Mt=nt.aabb.distanceX(ve),St=nt.aabb.distanceY(ve);let Rt=At,xt=1;if(Q){Rt=nt.aabb.distanceZ(ve);const vn=Math.pow(2,nt.zoom),Ln=i.aT((nt.y+1)/vn),Mn=i.aT(nt.y/vn),Hn=Math.min(Math.max(j,Ln),Mn),Nr=i.ca(Hn)/i.ca(j);if(xt=Hn===j?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Nr/this._mercatorScaleRatio),this.zoom<=i.c6&&nt.zoom===ct-1&&Nr>=.9)return!0}else if(E&&(Rt=nt.aabb.distanceZ(ve)*ce),this.projection.isReprojectedInTileSpace&&g<=5){const vn=Math.pow(2,nt.zoom),Ln=ze(new i.ac((nt.x+.5)/vn,(nt.y+.5)/vn));xt=Ln>.85?1:Ln}if(!I){const vn=Math.sqrt(Mt*Mt+St*St+Rt*Rt);let Ln=(1<<ct-nt.zoom)*Pe*xt;return Ln*=ut(Math.max(Rt,At),vn),vn<Ln}let Lt=Number.MAX_VALUE,en=0;const tn=nt.aabb.getCorners(),rn=[];for(const vn of tn){i.ad.vec3.sub(rn,vn,ve),Q||(E?rn[2]*=ce:rn[2]=At);const Ln=i.ad.vec3.dot(rn,this._camera.forward());Ln<Lt&&(Lt=Ln,en=Math.abs(rn[2]))}let fn=(1<<ct-nt.zoom)*Pe*xt;if(fn*=ut(Math.max(en,At),Lt),Lt<fn)return!0;const kn=nt.aabb.closestPoint($);return kn[0]===$[0]&&kn[1]===$[1]};if(this.renderWorldCopies)for(let nt=1;nt<=3;nt++)Ye.push(Ue(-nt)),Ye.push(Ue(nt));for(Ye.push(Ue(0));Ye.length>0;){const nt=Ye.pop(),Mt=nt.x,St=nt.y;let Rt=nt.fullyVisible;const xt=()=>this.projection.name==="globe"&&(nt.y===0||nt.y===(1<<nt.zoom)-1);if(!Rt){let Lt=Ee?nt.aabb.intersects(oe):nt.aabb.intersectsFlat(oe);if(Lt===0&&xt()){const en=new i.bT(nt.zoom,Mt,St);Lt=i.bU(this,U,en,!0).intersects(oe)}if(Lt===0)continue;Rt=Lt===2}if(nt.zoom!==ct&&It(nt))for(let Lt=0;Lt<4;Lt++){const en=(Mt<<1)+Lt%2,tn=(St<<1)+(Lt>>1),rn={aabb:I?nt.aabb.quadrant(Lt):i.bV(this,U,nt.zoom+1,en,tn,nt.wrap,nt.minZ,nt.maxZ,this.projection),zoom:nt.zoom+1,x:en,y:tn,wrap:nt.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:nt.minZ,maxZ:nt.maxZ};E&&!Q&&(rn.tileID=new i.aH(nt.zoom+1===ct?Pt:nt.zoom+1,nt.wrap,nt.zoom+1,en,tn),jt(rn)),Ye.push(rn)}else{const Lt=nt.zoom===ct?Pt:nt.zoom;if(s.minzoom&&s.minzoom>Lt)continue;let en=0;if(!Rt){let kn=Ee?nt.aabb.intersectsPrecise(oe):nt.aabb.intersectsPreciseFlat(oe);if(kn===0&&xt()){const vn=new i.bT(nt.zoom,Mt,St);kn=i.bU(this,U,vn,!0).intersectsPrecise(oe)}if(kn===0)continue;if(s.calculateQuadrantVisibility)if(oe.containsPoint(nt.aabb.center))en=15;else for(let vn=0;vn<4;vn++)nt.aabb.quadrant(vn).intersects(oe)!==0&&(en|=1<<vn)}const tn=$[0]-(.5+Mt+(nt.wrap<<nt.zoom))*(1<<c-nt.zoom),rn=$[1]-.5-St,fn=nt.tileID?nt.tileID:new i.aH(Lt,nt.wrap,nt.zoom,Mt,St);s.calculateQuadrantVisibility&&(fn.visibleQuadrants=en),vt.push({tileID:fn,distanceSq:tn*tn+rn*rn})}}if(this.fogCullDistSq){const nt=this.fogCullDistSq,Mt=this.horizonLineFromTop();vt=vt.filter(St=>{const Rt=[0,0,0,1],xt=[i.ai,i.ai,0,1],Lt=this.calculateFogTileMatrix(St.tileID.toUnwrapped());i.ad.vec4.transformMat4(Rt,Rt,Lt),i.ad.vec4.transformMat4(xt,xt,Lt);const en=i.ad.vec4.min([],Rt,xt),tn=i.ad.vec4.max([],Rt,xt),rn=i.bW(en,tn);if(rn===0)return!0;let fn=!1;const kn=this._elevation;if(kn&&rn>nt&&Mt!==0){const vn=this.calculateProjMatrix(St.tileID.toUnwrapped());let Ln;s.isTerrainDEM||(Ln=kn.getMinMaxForTile(St.tileID)),Ln||(Ln={min:Oe,max:Be});const Mn=i.c7(this.rotation),Hn=[Mn[0]*i.ai,Mn[1]*i.ai,Ln.max];i.ad.vec3.transformMat4(Hn,Hn,vn),fn=(1-Hn[1])*this.height*.5<Mt}return rn<nt||fn})}return vt.sort((nt,Mt)=>nt.distanceSq-Mt.distanceSq).map(nt=>nt.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=i.ay(s.lat,-i.bX,i.bX),g=this.projection.project(s.lng,c);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let g,x;const E=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;g=(c.x-E.x)/k,x=(c.y-E.y)/k}else{const k=this.pointCoordinate(c),j=this.pointCoordinate(E);g=k.x-j.x,x=k.y-j.y}const I=this.locationCoordinate(s);this.setLocation(new i.ac(I.x-g,I.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,c){return this.projection.locationPoint(this,s,c)}locationPoint3D(s,c){return this.projection.locationPoint(this,s,c,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,c){return this.coordinateLocation(this.pointCoordinate3D(s,c))}locationCoordinate(s,c){const g=c?i.bH(c,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new i.ac(x.x,x.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const g=c??this._centerAltitude,x=[s.x,s.y,0,1],E=[s.x,s.y,1,1];i.ad.vec4.transformMat4(x,x,this.pixelMatrixInverse),i.ad.vec4.transformMat4(E,E,this.pixelMatrixInverse);const I=E[3];i.ad.vec4.scale(x,x,1/x[3]),i.ad.vec4.scale(E,E,1/I);const k=x[2],j=E[2];return{p0:x,p1:E,t:k===j?0:(g-k)/(j-k)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return i.ad.vec4.transformMat4(c,c,this.pixelMatrixInverse),i.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse),i.ad.vec4.scale(c,c,1/c[3]),i.ad.vec4.scale(g,g,1/g[3]),c[2]=i.bH(c[2],this._center.lat)*this.worldSize,g[2]=i.bH(g[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(c,c,1/this.worldSize),i.ad.vec4.scale(g,g,1/this.worldSize),new i.as([c[0],c[1],c[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],g,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:g,t:x}=s,E=i.bH(c[2],this._center.lat),I=i.bH(g[2],this._center.lat);return new i.ac(i.ah(c[0],g[0],x)/this.worldSize,i.ah(c[1],g[1],x)/this.worldSize,i.ah(E,I,x))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s,c){if(!this.elevation)return this.pointCoordinate(s,c);let g=this.projection.pointCoordinate3D(this,s.x,s.y);if(g)return new i.ac(g[0],g[1],g[2]);let x=0,E=this.horizonLineFromTop();if(s.y>E)return this.pointCoordinate(s,c);const I=.02*E,k=s.clone();for(let j=0;j<10&&E-x>I;j++){k.y=i.ah(x,E,.66);const U=this.projection.pointCoordinate3D(this,k.x,k.y);U?(E=k.y,g=U):x=k.y}return g?new i.ac(g[0],g[1],g[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return i.ad.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new i.P(x[0]/x[3],x[1]/x[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,E=this.pointLocation3D(new i.P(c,s)),I=this.pointLocation3D(new i.P(x,s)),k=this.pointLocation3D(new i.P(x,g)),j=this.pointLocation3D(new i.P(c,g));let U=Math.min(E.lng,I.lng,k.lng,j.lng),$=Math.max(E.lng,I.lng,k.lng,j.lng),Q=Math.min(E.lat,I.lat,k.lat,j.lat),J=Math.max(E.lat,I.lat,k.lat,j.lat);const oe=Math.pow(2,-this.zoom)/16*270,pe=this.projection.name==="globe"?1:4,ce=(me,ve,Ee,Pe,Ie)=>{const Be=(me+Ee)/2,Oe=(ve+Pe)/2,Ne=new i.P(Be,Oe),{lng:ze,lat:Ue}=this.pointLocation3D(Ne),Ye=Math.max(0,U-ze,Q-Ue,ze-$,Ue-J);U=Math.min(U,ze),$=Math.max($,ze),Q=Math.min(Q,Ue),J=Math.max(J,Ue),(Ie<pe||Ye>oe)&&(ce(me,ve,Be,Oe,Ie+1),ce(Be,Oe,Ee,Pe,Ie+1))};if(ce(c,s,x,s,1),ce(x,s,x,g,1),ce(x,g,c,g,1),ce(c,g,c,s,1),this.projection.name==="globe"){const[me,ve]=i.bZ(this);me?(J=90,$=180,U=-180):ve&&(Q=-90,$=180,U=-180)}return new i.aB(new i.bO(U,Q),new i.bO($,J))}_getBoundsRectangular(s,c){const{top:g,left:x}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,k=new i.P(x,g),j=new i.P(I,g),U=new i.P(I,E),$=new i.P(x,E);let Q=this.pointCoordinate(k,s),J=this.pointCoordinate(j,s);const oe=this.pointCoordinate(U,c),pe=this.pointCoordinate($,c),ce=(me,ve)=>(ve.y-me.y)/(ve.x-me.x);return Q.y>1&&J.y>=0?Q=new i.ac((1-pe.y)/ce(pe,Q)+pe.x,1):Q.y<0&&J.y<=1&&(Q=new i.ac(-pe.y/ce(pe,Q)+pe.x,0)),J.y>1&&Q.y>=0?J=new i.ac((1-oe.y)/ce(oe,J)+oe.x,1):J.y<0&&Q.y<=1&&(J=new i.ac(-oe.y/ce(oe,J)+oe.x,0)),new i.aB().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(pe)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((g,x)=>{if(x.dem){const E=x.dem.tree;g.min=Math.min(g.min,E.minimums[0]),g.max=Math.max(g.max,E.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,g=this._distanceTileDataCache;if(g[c])return g[c];const x=s.canonical,E=1/this.height,I=this.cameraWorldSize,k=I/this.zoomScale(x.z),j=(x.x+Math.pow(2,x.z)*s.wrap)*k,U=x.y*k,$=this.point;$.x*=I/this.worldSize,$.y*=I/this.worldSize;const Q=this.angle,J=Math.sin(-Q),oe=-Math.cos(-Q);return g[c]={bearing:[J,oe],center:[($.x-j)*E,($.y-U)*E],scale:k/i.ai*E},g[c]}calculateFogTileMatrix(s){const c=s.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.ad.mat4.multiply(x,this.worldToFogMatrix,x),g[c]=new Float32Array(x),g[c]}calculateProjMatrix(s,c=!1,g=!1){const x=s.key;let E;if(E=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,E[x])return E[x];const I=this.calculatePosMatrix(s,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(I,k,I),E[x]=new Float32Array(I),E[x]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const x=i.b_(s,this);return g[c]=x,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=i.ad.mat4.fromScaling([],[s,s,s]);return i.ad.mat4.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=i.bH(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),x=this._camera.forward(),E=i.bH(1,this._center.lat);g[2]/=E,x[2]/=E,i.ad.vec3.normalize(x,x);const I=s.raycast(g,x,s.exaggeration());if(I){const k=i.ad.vec3.scaleAndAdd([],g,x,I),j=new i.ac(k[0],k[1],i.bH(k[2],i.aT(k[1]))),U=(j.z+i.ad.vec3.length([j.x-g[0],j.y-g[1],j.z-g[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,g=i.bH(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),E=c.getAtPointOrZero(new i.ac(...x)),I=this.pixelsPerMeter/this.worldSize*E,k=this._minimumHeightOverTerrain(),j=x[2]-I;if(j<=k)if(j<0||s){const U=this.locationCoordinate(this._center,this._centerAltitude),$=[x[0],x[1],U.z-x[2]],Q=i.ad.vec3.length($);$[2]-=(k-j)/this._pixelsPerMercatorPixel;const J=i.ad.vec3.length($);if(J===0)return;i.ad.vec3.scale($,$,Q/J*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],U.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const J=this.center;return J.lat=i.ay(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(J.lng=i.ay(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const c=this._unmodified,{x:g,y:x}=this.point;let E=0,I=g,k=x;const j=this.width/2,U=this.height/2,$=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(x-U<$&&(k=$+U),x+U>Q&&(k=Q-U),Q-$<this.height&&(E=Math.max(E,this.height/(Q-$)),k=(Q+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,pe=this.worldSize/2-(J+oe)/2;I=(g+pe+this.worldSize)%this.worldSize-pe,I-j<J&&(I=J+j),I+j>oe&&(I=oe-j),oe-J<this.width&&(E=Math.max(E,this.width/(oe-J)),I=(oe+J)/2)}I===g&&k===x||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(I,k))),E&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const x=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this.projection.zAxisUnit==="meters"?g:1,I=this._camera.getWorldToCamera(this.worldSize,E);let k;const j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(j[8]=2*-s.x/this.width,j[9]=2*s.y/this.height,this.isOrthographic){let Ue=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ye=Ue*this.aspect,vt=-Ye,ct=-Ue;Ye-=s.x,vt-=s.x,Ue+=s.y,ct+=s.y,k=this._camera.getCameraToClipOrthographic(vt,Ye,ct,Ue,this._nearZ,this._farZ),((Pt,At,jt,ut)=>{for(let It=0;It<16;It++)Pt[It]=i.ah(At[It],jt[It],ut)})(k,k,j,i.c9(this.pitch>=Qt?1:this.pitch/Qt))}else k=j;const U=i.ad.mat4.mul([],j,I);let $=i.ad.mat4.mul([],k,I);if(this.projection.isReprojectedInTileSpace){const Ue=this.locationCoordinate(this.center),Ye=i.ad.mat4.identity([]);i.ad.mat4.translate(Ye,Ye,[Ue.x*this.worldSize,Ue.y*this.worldSize,0]),i.ad.mat4.multiply(Ye,Ye,i.c0(this)),i.ad.mat4.translate(Ye,Ye,[-Ue.x*this.worldSize,-Ue.y*this.worldSize,0]),i.ad.mat4.multiply($,$,Ye),i.ad.mat4.multiply(U,U,Ye),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],$,[this.worldSize,this.worldSize,this.worldSize/E,1]),this.projMatrix=$,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),c){const Ue=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ue[8]=2*-s.x/this.width,Ue[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],Ue,I)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=i.ad.mat4.invert([],k);this.frustumCorners=i.c2.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const J=new Float32Array(16);i.ad.mat4.identity(J),i.ad.mat4.scale(J,J,[1,-1,1]),i.ad.mat4.rotateX(J,J,this._pitch),i.ad.mat4.rotateZ(J,J,this.angle);const oe=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(oe);const pe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;oe[8]=2*-s.x/this.width,oe[9]=2*(s.y+pe)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(J,oe,J);const ce=this.point,me=ce.x,ve=ce.y,Ee=this.width%2/2,Pe=this.height%2/2,Ie=Math.cos(this.angle),Be=Math.sin(this.angle),Oe=me-Math.round(me)+Ie*Ee+Be*Pe,Ne=ve-Math.round(ve)+Ie*Pe+Be*Ee,ze=new Float64Array($);if(i.ad.mat4.translate(ze,ze,[Oe>.5?Oe-1:Oe,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=ze,$=i.ad.mat4.create(),i.ad.mat4.scale($,$,[this.width/2,-this.height/2,1]),i.ad.mat4.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=i.ad.mat4.create(),i.ad.mat4.scale($,$,[1,-1,1]),i.ad.mat4.translate($,$,[-1,-1,0]),i.ad.mat4.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,U),this._calcFogMatrices(),this._distanceTileDataCache={},$=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!$)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=$,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const Ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(Ue,Ue,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=$;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,E=[s,s,c];i.ad.vec3.scale(E,E,x),i.ad.vec3.scale(g,g,-1),i.ad.vec3.multiply(g,g,E);const I=i.ad.mat4.create();i.ad.mat4.translate(I,I,g),i.ad.mat4.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,x)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*E,x.y/this.worldSize-g[1]*E,s/this.worldSize*this._centerAltitude-g[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=s[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(E=Math.min((c-g)/x,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,s,E),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),E=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),k=Math.max((s[2]-E)/Math.cos(g),I),j=this._zoomFromMercatorZ(k);i.ad.vec3.scaleAndAdd(s,s,c,k),this._pitch=i.ay(g,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(x,-Math.PI,Math.PI),this._setZoom(i.ay(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,g=i.bY,x=0,E=1/0;for(;g-c>1e-6&&g>c;){const I=c+.5*(g-c),k=this.tileSize*Math.pow(2,I),j=this.getCameraToCenterDistance(this.projection,I,k),U=this.scaleZoom(j/(s*this.tileSize)),$=Math.abs(I-U);$<E&&(E=$,x=I),I<U?c=I:g=I}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const g=Math.min(s.x,c.x),x=Math.max(s.x,c.x),E=Math.min(s.y,c.y),I=Math.max(s.y,c.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new i.P(g,E),new i.P(x,I),new i.P(g,I),new i.P(x,E)],j=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const $ of k){const Q=this.pointRayIntersection($);if(Q.t<0)return!0;const J=this.rayIntersectionCoordinate(Q);if(J.x<j||J.y<0||J.x>U||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,c){const g=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,s)),x=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([c,g,x],E){const I=[c,g,x,1];i.ad.vec4.transformMat4(I,I,E);const k=I[3]=Math.max(I[3],1e-6);return I[0]/=k,I[1]/=k,I[2]/=k,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,g=this.worldSize){const x=i.b$(s,c,this.width,this.height,1024),E=s.pixelSpaceConversion(this.center.lat,g,x);let I=.5/Math.tan(.5*this._fov)*this.height*E;return this.isOrthographic&&(I=i.ah(1,I,i.c9(this.pitch>=Qt?1:this.pitch/Qt))),I}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(s,s,this.globeMatrix),s}getFrustum(s){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const Vu=(_,s)=>{if(s>0&&_.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||_.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=_.transform,g=Math.max(Math.abs(c._zoom-(_.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?i.ae(60,45,c.pitch):i.ae(30,15,c.pitch),E=c._farZ-c._nearZ,I=s*c.height,k=((1-(j=x))*c.cameraToCenterDistance+j*(c._farZ+I))*g;var j;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(k-c._nearZ)/E,(k-I-c._nearZ)/E]}}},Lo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Pf{constructor(s,c){this.aabb=s,this.lastCascade=c}}class xg{add(s,c){const g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[s.key]=new Pf(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,g){const x=i.ce.fromPoints(s.points);let E=0;for(const I in this.receivers){const k=this.receivers[I];if(!k||!x.intersectsAabb(k.aabb))continue;k.aabb.min=x.closestPoint(k.aabb.min),k.aabb.max=x.closestPoint(k.aabb.max);const j=k.aabb.getCorners();for(let U=0;U<g.length;U++){let $=!0;for(const Q of j){const J=[Q[0]*c,Q[1]*c,Q[2]];if(i.ad.vec3.transformMat4(J,J,g[U].matrix),J[0]<-1||J[0]>1||J[1]<-1||J[1]>1){$=!1;break}}if(k.lastCascade=U,E=Math.max(E,U),$)break}}return E+1}}class Pl{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new xg,this._depthMode=new En(s.context.gl.LEQUAL,En.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(Lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(Lo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(Lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=g.style.order.reduce((pe,ce)=>{const me=g.style._mergedLayers[ce];return pe+(me.hasShadowPass()&&!me.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const E=g.context,I=Lo.shadowMapResolution,k=Lo.shadowMapResolution;if(this._cascades.length===0||Lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let pe=0;pe<Lo.cascadeCount;++pe){const ce=g._shadowMapDebug,me=E.gl,ve=E.createFramebuffer(I,k,ce,"texture"),Ee=new i.T(E,{width:I,height:k,data:null},me.DEPTH_COMPONENT16);if(ve.depthAttachment.set(Ee.texture),ce){const Pe=new i.T(E,{width:I,height:k,data:null},me.RGBA8);ve.colorAttachment.set(Pe.texture)}this._cascades.push({framebuffer:ve,texture:Ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=Cc(c);let j=0;if(s.elevation){const pe=s.elevation,ce=[1e4,-1e4];pe.visibleDemTiles.filter(me=>me.dem).forEach(me=>{const ve=me.dem.tree;ce[0]=Math.min(ce[0],ve.minimums[0]),ce[1]=Math.max(ce[1],ve.maximums[0])}),ce[0]!==1e4&&(j=(ce[1]-ce[0])*pe.exaggeration())}const U=1.5*s.cameraToCenterDistance,$=3*U,Q=new Float64Array(16);for(let pe=0;pe<this._cascades.length;++pe){const ce=this._cascades[pe];let me=s.height/50,ve=1;Lo.cascadeCount===1?ve=$:pe===0?ve=U:(me=U,ve=$);const[Ee,Pe]=ph(s,this.shadowDirection,me,ve,Lo.shadowMapResolution,j);ce.scale=s.scale,ce.matrix=Ee,ce.boundingSphereRadius=Pe,i.ad.mat4.invert(Q,ce.matrix),ce.frustum=i.bR.fromInvProjectionMatrix(Q,1,0,!0),ce.far=ve}const J=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[J].far,this._cascades[J].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hi.ShadowMap0,this._uniformValues.u_shadowmap_1=Hi.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const oe=g.transform.elevation;for(const pe of this._groundShadowTiles){let ce={min:0,max:0};if(oe){const me=oe.getMinMaxForTile(pe);me&&(ce=me)}this.addShadowReceiver(pe.toUnwrapped(),ce.min,ce.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const g=this.painter,x=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),x.viewport.set([0,0,Lo.shadowMapResolution,Lo.shadowMapResolution]);for(let E=0;E<this._numCascadesToRender;++E){g.currentShadowCascade=E,x.bindFramebuffer.set(this._cascades[E].framebuffer.framebuffer),x.clear({color:i.al.white,depth:1});for(const I of s.order){const k=s._mergedLayers[I];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;const j=s.getLayerSourceCache(k),U=j?c[j.id]:void 0;(k.type==="model"||U&&U.length)&&g.renderLayer(g,j,k,U)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,g=s.context,x=c.directionalLight,E=c.ambientLight;if(!x||!E)return;const I=[],k=Vu(s,s.longestCutoffRange);k.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const j=fh(c,x,E),U=new En(g.gl.LEQUAL,En.ReadOnly,s.depthRangeFor3D);for(const $ of this._groundShadowTiles){const Q=$.toUnwrapped(),J=s.isTileAffectedByFog($),oe=s.getOrCreateProgram("groundShadow",{defines:I,overrideFog:J});this.setupShadows(Q,oe),s.uploadCommonUniforms(g,oe,Q,null,k);const pe={u_matrix:s.transform.calculateProjMatrix(Q),u_ground_shadow_factor:j};oe.draw(s,g.gl.TRIANGLES,U,Vn.disabled,pr.multiply,Fn.disabled,pe,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?pr.unblended:pr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,g=c.calculatePosMatrix(s,c.worldSize);return i.ad.mat4.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return i.ad.mat4.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,g,x=0){if(!this.enabled)return;const E=this.painter.transform,I=this.painter.context,k=I.gl,j=this._uniformValues,U=new Float64Array(16),$=E.calculatePosMatrix(s,E.worldSize);for(let Q=0;Q<this._cascades.length;Q++)i.ad.mat4.multiply(U,this._cascades[Q].matrix,$),j[Q===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(U),I.activeTexture.set(k.TEXTURE0+Hi.ShadowMap0+Q),this._cascades[Q].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const Q=i.cd(s.canonical),J=2/E.tileSize*i.ai/Lo.shadowMapResolution,oe=J*this._cascades[0].boundingSphereRadius,pe=J*this._cascades[this._cascades.length-1].boundingSphereRadius,ce=(g==="vector-tile"?1:3)/Math.pow(2,x-s.canonical.z-(1-E.zoom+Math.floor(E.zoom)));j.u_shadow_normal_offset=[Q,oe*ce,pe*ce],j.u_shadow_bias=[6e-5,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(I,j)}setupShadowsFromMatrix(s,c,g=!1){if(!this.enabled)return;const x=this.painter.context,E=x.gl,I=this._uniformValues,k=new Float64Array(16);for(let j=0;j<Lo.cascadeCount;j++)i.ad.mat4.multiply(k,this._cascades[j].matrix,s),I[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),x.activeTexture.set(E.TEXTURE0+Hi.ShadowMap0+j),this._cascades[j].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const j=Lo.normalOffset;I.u_shadow_normal_offset=[1,j,j],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,I)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,g,x){if(x[2]>=0)return{};const E=function(j,U,$){const Q=$/(1<<j.canonical.z);return new i.ce([j.canonical.x*Q+j.wrap*$,j.canonical.y*Q+j.wrap*$,0],[(j.canonical.x+1)*Q+j.wrap*$,(j.canonical.y+1)*Q+j.wrap*$,U])}(s,c,g).getCorners(),I=c/-x[2];x[0]<0?(i.ad.vec3.add(E[0],E[0],[x[0]*I,0,0]),i.ad.vec3.add(E[3],E[3],[x[0]*I,0,0])):x[0]>0&&(i.ad.vec3.add(E[1],E[1],[x[0]*I,0,0]),i.ad.vec3.add(E[2],E[2],[x[0]*I,0,0])),x[1]<0?(i.ad.vec3.add(E[0],E[0],[0,x[1]*I,0]),i.ad.vec3.add(E[1],E[1],[0,x[1]*I,0])):x[1]>0&&(i.ad.vec3.add(E[2],E[2],[0,x[1]*I,0]),i.ad.vec3.add(E[3],E[3],[0,x[1]*I,0]));const k={};return k.vertices=E,k.planes=[Af(E[1],E[0],E[4]),Af(E[2],E[1],E[5]),Af(E[3],E[2],E[6]),Af(E[0],E[3],E[7])],k}addShadowReceiver(s,c,g){this._receivers.add(s,i.ce.fromTileIdAndHeight(s,c,g))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function Af(_,s,c){const g=i.ad.vec3.sub([],c,s),x=i.ad.vec3.sub([],_,s),E=i.ad.vec3.cross([],g,x),I=i.ad.vec3.length(E);return I===0?[0,0,1,0]:(i.ad.vec3.scale(E,E,1/I),[E[0],E[1],E[2],-i.ad.vec3.dot(E,s)])}function Cc(_){const s=_.properties.get("direction"),c=i.cc(s.x,s.y,s.z);c[2]=i.ay(c[2],0,75);const g=i.cf([c[0],c[1],c[2]]);return i.ad.vec3.fromValues(g.x,g.y,g.z)}function fh(_,s,c){const g=s.properties.get("color-use-theme")==="none",x=s.properties.get("color"),E=s.properties.get("intensity"),I=s.properties.get("direction"),k=[I.x,I.y,I.z],j=c.properties.get("color-use-theme")==="none",U=c.properties.get("color"),$=c.properties.get("intensity"),Q=Math.max(i.ad.vec3.dot([0,0,1],k),0),J=[0,0,0];i.ad.vec3.scale(J,U.toRenderColor(j?null:_.getLut(s.scope)).toArray01Linear().slice(0,3),$);const oe=[0,0,0];return i.ad.vec3.scale(oe,x.toRenderColor(g?null:_.getLut(c.scope)).toArray01Linear().slice(0,3),Q*E),i.cg([J[0]>0?J[0]/(J[0]+oe[0]):0,J[1]>0?J[1]/(J[1]+oe[1]):0,J[2]>0?J[2]/(J[2]+oe[2]):0])}function ph(_,s,c,g,x,E){const I=_.zoom,k=_.scale,j=_.worldSize,U=1/j,$=_.aspect,Q=Math.sqrt(1+$*$)*Math.tan(.5*_.fovX),J=Q*Q,oe=g-c,pe=g+c;let ce,me;J>oe/pe?(ce=g,me=g*Q):(ce=.5*pe*(1+J),me=.5*Math.sqrt(oe*oe+2*(g*g+c*c)*J+pe*pe*J*J));const ve=_.projection.pixelsPerMeter(_.center.lat,j),Ee=_._camera.getCameraToWorldMercator(),Pe=[0,0,-ce*U];i.ad.vec3.transformMat4(Pe,Pe,Ee);let Ie=me*U;const Be=_._edgeInsets;if(!(Be.left===0&&Be.top===0&&Be.right===0&&Be.bottom===0||Be.left===Be.right&&Be.top===Be.bottom)){const Rt=_._camera.getWorldToCamera(_.worldSize,_.projection.zAxisUnit==="meters"?ve:1),xt=_._camera.getCameraToClipPerspective(_._fov,_.width/_.height,c,g);xt[8]=2*-_.centerOffset.x/_.width,xt[9]=2*_.centerOffset.y/_.height;const Lt=new Float64Array(16);i.ad.mat4.mul(Lt,xt,Rt);const en=new Float64Array(16);i.ad.mat4.invert(en,Lt);const tn=i.bR.fromInvProjectionMatrix(en,j,I,!0);for(const rn of tn.points){const fn=((Oe=rn)[0]/=k,Oe[1]/=k,Oe[2]=i.bH(Oe[2],_._center.lat),Oe);Ie=Math.max(Ie,i.ad.vec3.len(i.ad.vec3.subtract([],Pe,fn)))}}var Oe;Ie*=x/(x-1);const Ne=Math.acos(s[2]),ze=Math.atan2(-s[0],-s[1]),Ue=new nu;Ue.position=Pe,Ue.setPitchBearing(Ne,ze);const Ye=Ue.getWorldToCamera(j,ve),vt=Ie*j,ct=Math.min(_._mercatorZfromZoom(17)*j*-2,-2*vt),Pt=Ue.getCameraToClipOrthographic(-vt,vt,-vt,vt,ct,(vt+E*ve)/s[2]),At=new Float64Array(16);i.ad.mat4.multiply(At,Pt,Ye);const jt=i.ad.vec3.fromValues(Math.floor(1e6*Pe[0])/1e6*j,Math.floor(1e6*Pe[1])/1e6*j,0),ut=.5*x,It=[0,0,0];i.ad.vec3.transformMat4(It,jt,At),i.ad.vec3.scale(It,It,ut);const nt=[Math.floor(It[0]),Math.floor(It[1]),Math.floor(It[2])],Mt=[0,0,0];i.ad.vec3.sub(Mt,It,nt),i.ad.vec3.scale(Mt,Mt,-1/ut);const St=new Float64Array(16);return i.ad.mat4.identity(St),i.ad.mat4.translate(St,St,Mt),i.ad.mat4.multiply(At,St,At),[At,vt]}class Ev extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(s,c){return i.aN(this.requestManager.transformRequest(c,i.R.Model).url).then(g=>{if(!g)return;const x=i.aO(g),E=new i.aP(s,void 0,void 0,x);return E.computeBoundsAndApplyParent(),E}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${s} from ${c}: ${g.message}`)))})}load(s,c,g={keepNumReferences:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+x.length;const E=[];for(const I of x)E.push(this.loadModel(I,s[I]));Promise.allSettled(E).then(I=>{for(let k=0;k<I.length;k++){const{status:j,value:U}=I[k];if(j==="fulfilled"&&U){const $=this.models[c][x[k]];this.models[c][x[k]]={model:U,numReferences:g.keepNumReferences&&$?$.numReferences:1}}}this.numModelsLoading[c]-=x.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(I=>{this.fire(new i.z(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}addModel(s,c,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.modelUris[g][s]=this.requestManager.normalizeModelURL(c),this.load({[s]:this.modelUris[g][s]},g)}addModels(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const g=this.modelUris[c];for(const x in s)this.models[c][x]={},g[x]=this.requestManager.normalizeModelURL(s[x]);this.load(g,c,{keepNumReferences:!0})}reloadModels(s){this.load(this.modelUris[s],s)}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const g={};for(const x of s)this.hasModel(x,c)?this.models[c][x].numReferences++:(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),g[x]=this.modelUris[c][x]);this.load(g,c)}removeModel(s,c){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,this.models[c][s].numReferences===0)){const g=this.models[c][s].model;delete this.models[c][s],delete this.modelUris[c][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const g in this.models[c])this.models[c][g].model&&this.models[c][g].model.upload(s.context)}}const Cv=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),bg={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Tv(_){return _=_||{},Object.assign(_,bg)}class Iv extends i.E{constructor(s){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=s,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(s=>{s.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=s.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=s.stylesheet.indoor.buildingFeaturesetId,this._scope=s.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:s=>(s.feature&&s.feature.properties.floorplan&&this.selectFloorplan(s.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(s){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(I,k){const[j,U]=I,{center:$,radius:Q}=k,[J,oe]=$,pe=Math.abs(j-J);return Math.sqrt((pe>180?360-pe:pe)**2+(U-oe)**2)<=Q}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=new i.P(this._map.transform.width/2,this._map.transform.height/2),x=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],E=this._map.queryRenderedFeatures(s?x:g,c);E.length>0&&(this._selectedFloorplan&&E[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=E[0],this._floorplanSelected(!1)))}_floorplanSelected(s){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(E){const[[I,k],[j,U]]=E,$=(j-I+360)%360,Q=$>180?360-$:$;return{center:[(I+Q/2+360)%360,(k+U)/2],radius:Math.sqrt(Q**2+(U-k)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const c=this._floorplanStates[this._indoorData.id].selectedBuilding,g=this._floorplanStates[this._indoorData.id].selectedLevel;let x;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const E of this._indoorData.levels)E.id===this._selectedLevel.id&&(x=E.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:x})),c){const E=this._indoorData.buildings.find(I=>I.id===c);this._buildingSelected(E,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(g){const E=this._indoorData.levels.find(I=>I.id===g);this._updateLevels(E,s)}else s&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(s,c){c&&s&&s.extent&&this._map.fitBounds(s.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=s?s.id:void 0;const g=this._indoorData.levels.filter(x=>s.levels.includes(x.id));this.fire(new i.A("buildingselected",{buildingId:s.id,levels:g}))}_levelSelected(s){if(s==="overview")this._updateLevels(void 0,!0);else{const c=this._indoorData.levels.find(g=>g.id===s);this._updateLevels(c,!0)}this.fire(new i.A("levelselected",{levelId:s==="overview"?void 0:s}))}_updateLevels(s,c){if(!s)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(c&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function g(U){const $=U.indexOf("/floor/");if($===-1)return U;const Q=$+7,J=U.indexOf("/",Q);return J===-1?U.slice(Q):U.slice(Q,J)}this._selectedLevel=s,this._floorplanStates[this._indoorData.id].selectedLevel=s?s.id:void 0;const x=[],E={},I={},k={},j={};for(const U of this._indoorData.levels)if(x.push(U.id),E[U.id]=U.height,I[U.id]=U.base,s){if(this.mergeFloors){const $=g(s.id),Q=g(U.id);k[U.id]=Q===$?"true":"false"}else k[U.id]=U.id===s.id?"true":"false";j[U.id]=U.base<s.base?"true":"false"}else j[U.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",k]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",j]),s&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!s.isUnderground),c&&s.extent)){const U=this._map.cameraForBounds(s.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),$=this._map.getZoom(),Q=U.zoom?Math.abs($-U.zoom):0;this._map.fitBounds(s.extent,Q>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:$})}}selectFloorplan(s){const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},g=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(g,c);if(x.length>0){for(const E of x)if(JSON.parse(E.properties["indoor-data"]).floorplanIDs.includes(s)){this._selectedFloorplan=E,this._floorplanSelected(!0);break}}}selectBuilding(s){const c=this._indoorData.buildings.find(g=>g.id===s);this._buildingSelected(c,!0)}selectLevel(s){this._levelSelected(s)}}function Mv(_){if(!_.metadata||!_.metadata.content_area)return;const s=i.q.devicePixelRatio,{left:c,top:g,width:x,height:E}=_.metadata.content_area,I=c*s,k=g*s;return[I,k,I+x*s,k+E*s]}function wg(_){if(_)return _.map(([s,c])=>[s*i.q.devicePixelRatio,c*i.q.devicePixelRatio])}class Nx{constructor(s,c,g){this.id=s,this.scope=c,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return s;const g=this.sourceCache.getSource();if(!(g instanceof Fu))return s;const x=c.map(I=>this.sourceCache.getTile(I)),E=g.getImages(x,Array.from(this.pendingRequests));for(const[I,k]of E)s.set(i.I.from({name:I,iconsetId:this.id}),k),this.pendingRequests.delete(I);for(const I of this.pendingRequests)this.missingRequests.add(I);return this.pendingRequests.clear(),s}}const Cs=(_,s)=>_t(_,s&&s.filter(c=>c.identifier!=="source.canvas")),Qp=i.aA(fr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Pv=i.aA(fr,["setCenter","setZoom","setBearing","setPitch"]),em=new Set(["background","sky","slot","custom"]),Q_={version:8,layers:[],sources:{}},Rf={duration:300,delay:0};class ol extends i.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=i.l({},Rf),this._buildingIndex=new xc(this),this.crossTileSymbolIndex=new Dx,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new yi,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.cj(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Io(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.ck(s._requestManager,c.localFontFamily?i.cl.all:c.localIdeographFontFamily?i.cl.ideographs:i.cl.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Ev(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const g=this;this._rtlTextPluginCallback=ol.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(E,I)=>{if(i.cn(E),I&&I.every(k=>k))for(const k in g._sourceCaches){const j=g._sourceCaches[k],U=j.getSource().type;U!=="vector"&&U!=="geojson"||j.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const E=this.getOwnSource(x.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===E.id&&this._validateLayer(k)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.f(s))return s;const c=i.co(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.cp(JSON.stringify(s))}`}_diffStyle(s,c,g){this.globalId=this._getGlobalId(s);const x=(E,I)=>{try{I(null,this.setState(E,g))}catch(k){I(k,!1)}};if(typeof s=="string"){const E=this.map._requestManager.normalizeStyleURL(s),I=this.map._requestManager.transformRequest(E,i.R.Style);i.n(I,(k,j)=>{k?this.fire(new i.z(k)):j&&x(j,c)})}else typeof s=="object"&&x(s,c)}loadURL(s,c={}){this.fire(new i.A("dataloading",{dataType:"style"}));const g=typeof c.validate=="boolean"?c.validate:!i.f(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const x=this.importsCache.get(s);if(x)return this._load(x,g);const E=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.n(E,(I,k)=>{if(this._request=null,I)this.fire(new i.z(I));else if(k)return this.importsCache.set(s,k),this._load(k,g)})}loadJSON(s,c={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.q.frame(()=>{this._request=null,this._load(s,c.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Q_,!1)}_loadImports(s,c,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const E of s){const I=this._createFragmentStyle(E),k=new Promise($=>{I.once("style.import.load",$),I.once("error",$)}).then(()=>this.mergeAll());if(x.push(k),this.resolvedImports.has(E.url)){I.loadEmpty();continue}const j=E.data||this.importsCache.get(E.url);j?(I.loadJSON(j,{validate:c}),this._isInternalStyle(j)&&(I.globalId=null)):E.url?I.loadURL(E.url,{validate:c}):I.loadEmpty();const U={style:I,id:E.id,config:E.config};if(g){const $=this.fragments.findIndex(({id:Q})=>Q===g);this.fragments=this.fragments.slice(0,$).concat(U).concat(this.fragments.slice($))}else this.fragments.push(U)}return Promise.allSettled(x)}getImportGlobalIds(s=this,c=new Set){for(const g of s.fragments)g.style.globalId&&c.add(g.style.globalId),this.getImportGlobalIds(g.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?i.C(s.id,this.scope):s.id;let g;const x=this._initialConfig&&this._initialConfig[c];(s.config||x)&&(g=i.l({},s.config,x));const E=new ol(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers});return E.setEventedParent(this.map,{style:E}),E}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,c){const g=s.indoor?Tv(s.schema):s.schema;if(this._isInternalStyle(s)){const I=i.l({},Q_,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(I,c)}if(this.updateConfig(this._config,g),c&&Cs(this,Po(s)))return;this._loaded=!0,this.stylesheet=i.cq(s);const x=()=>{for(const U in s.sources)this.addSource(U,s.sources[U],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const U in s.iconsets)this.addIconset(U,s.iconsets[U]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(s.glyphs);const I=bc(this.stylesheet.layers);if(this._order=I.map(U=>U.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const U=this.stylesheet.lights[0];this.light=new bt(U.properties,U.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new bt(this.stylesheet.light)),this._layers={};for(const U of I){const $=i.cv(U,this.scope,this._styleColorTheme.lut,this.options);$.configDependencies.size!==0&&this._configDependentLayers.add($.fqid),$.setEventedParent(this,{layer:{id:$.id}}),this._layers[$.id]=$;const Q=this.getOwnLayerSourceCache($),J=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Q&&$.canCastShadows()&&J&&(Q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const j=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then(()=>{this._reloadImports(),this.fire(new i.A(j?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const E=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(E){const I=this._evaluateColorThemeData(E);this._loadColorTheme(I).then(()=>{x()}).catch(k=>{i.w(`Couldn't load color theme from the stylesheet: ${k}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,c,g,x,E,I,k,j,U,$;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(J=>{if(J.stylesheet){if(J.light!=null&&(s=J.light),J.stylesheet.lights)for(const oe of J.stylesheet.lights)oe.type==="ambient"&&J.ambientLight!=null&&(c=J.ambientLight),oe.type==="directional"&&J.directionalLight!=null&&(g=J.directionalLight);x=this._prioritizeTerrain(x,J.terrain,J.stylesheet.terrain),J.stylesheet.fog&&J.fog!=null&&(E=J.fog),J.stylesheet.snow&&J.snow!=null&&(I=J.snow),J.stylesheet.rain&&J.rain!=null&&(k=J.rain),J.stylesheet.camera!=null&&($=J.stylesheet.camera),J.stylesheet.projection!=null&&(j=J.stylesheet.projection),J.stylesheet.transition!=null&&(U=J.stylesheet.transition),Q[J.scope]=J._styleColorTheme}}),this.light=s,this.ambientLight=c,this.directionalLight=g,this.fog=E,this.snow=I,this.rain=k,this._styleColorThemeForScope=Q,x===null?delete this.terrain:this.terrain=x,this.camera=$||{"camera-projection":"perspective"},this.projection=j||{name:"mercator"},this.transition=i.l({},Rf,U),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=g=>{for(const x of g.fragments)c(x.style);s(g)};c(this)}_prioritizeTerrain(s,c,g){const x=s&&s.drapeRenderMode===0;return g===null?c&&c.drapeRenderMode===0?c:x?s:null:c!=null&&(!s||x||c&&c.drapeRenderMode===1)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},g={};this.forEachFragmentStyle(x=>{for(const E in x._sourceCaches){const I=i.C(E,x.scope);s[I]=x._sourceCaches[E]}for(const E in x._otherSourceCaches){const I=i.C(E,x.scope);c[I]=x._otherSourceCaches[E]}for(const E in x._symbolSourceCaches){const I=i.C(E,x.scope);g[I]=x._symbolSourceCaches[E]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeLayers(){const s={},c=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const I of E._order){const k=E._layers[I];if(k.type==="slot"){const j=i.cr(I);if(s[j])continue;s[j]=[]}k.slot&&s[k.slot]?s[k.slot].push(k):c.push(k)}}),this._mergedOrder=[];const x=(E=[])=>{for(const I of E)if(I.type==="slot"){const k=i.cr(I.id);s[k]&&x(s[k]),this._mergedSlots.push(k)}else{const k=i.C(I.id,I.scope);this._mergedOrder.push(k),g[k]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};x(c),this._mergedOrder.sort((E,I)=>{const k=g[E],j=g[I];return k.hasInitialOcclusionOpacityProperties?j.is3D(!!this.terrain)?1:0:k.is3D(!!this.terrain)&&j.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=i.l({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(c,g,x){const E=i.l({},g);for(const k of Object.keys(i.a5.colorTheme))E[k]===void 0&&(E[k]=i.a5.colorTheme[k].default);const I=new i.a6(Cv,c,new Map(x));return I.setTransitionOrValue(E,x),I.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,x)=>{const E="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let I=s;I.startsWith(E)||(I=E+I);const k=i.I.from("mapbox-reserved-lut"),j=new Image;j.src=I,j.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},j.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void g();this._styleColorTheme.lutLoading=!1;const{width:U,height:$,data:Q}=i.q.getImageData(j);if($>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(U!==$*$)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(k,this.scope)&&this.removeImage(k,this.scope),this.addImage(k,this.scope,{data:new i.r({width:U,height:$},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const J=this.imageManager.getImage(k,this.scope);J?(this._styleColorTheme.lut={image:J.data,data:s},g()):x(new Error("Missing LUT image."))}})}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,g,x){let E,I,k;const j=i.q.devicePixelRatio>1?"@2x":"";let U=i.n(g.transformRequest(g.normalizeSpriteURL(c,j,".json"),i.R.SpriteJSON),(J,oe)=>{U=null,k||(k=J,E=oe,Q())}),$=i.o(g.transformRequest(g.normalizeSpriteURL(c,j,".png"),i.R.SpriteImage),(J,oe)=>{$=null,k||(k=J,I=oe,Q())});function Q(){if(k)x(k);else if(E&&I){const J=i.q.getImageData(I),oe={};for(const pe in E){const{width:ce,height:me,x:ve,y:Ee,sdf:Pe,pixelRatio:Ie,stretchX:Be,stretchY:Oe,content:Ne}=E[pe],ze=new i.r({width:ce,height:me});i.r.copy(J,ze,{x:ve,y:Ee},{x:0,y:0},{width:ce,height:me},null),oe[pe]={data:ze,pixelRatio:Ie,sdf:Pe,stretchX:Be,stretchY:Oe,content:Ne,usvg:!1}}x(null,oe)}}return{cancel(){U&&(U.cancel(),U=null),$&&($.cancel(),$=null)}}}(s,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new i.z(c));else if(g){const x=new Map;for(const E in g)x.set(i.I.from(E),g[E]);this.addImages(x,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(s,c){if(c.type==="sprite")return void this._loadSprite(c.url);const g=this.getOwnSourceCache(c.source);if(!g)return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const x=g.getSource();if(x.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const E=new Nx(s,this.scope,g);this.imageManager.addImageProvider(E,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!i.f(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const c=this.map._spriteFormat==="auto";var g,x;this._spriteRequest=(x=(E,I)=>{if(this._spriteRequest=null,E)c?this._loadSprite(s):this.fire(new i.z(E));else if(I){const k=new Map;for(const j in I)k.set(i.I.from(j),I[j]);this.addImages(k,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(s),i.R.Iconset),(E,I)=>{if(E)return void x(E);const k={},j=i.ch(new i.bi(I));for(const U of j.icons){const $={version:1,pixelRatio:i.q.devicePixelRatio,content:Mv(U),stretchX:U.metadata?wg(U.metadata.stretch_x_areas):void 0,stretchY:U.metadata?wg(U.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:U};k[U.name]=$}x(null,k)}))}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const g=s.sourceLayer;g&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.z(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const g=this.fragments[c];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){const c=[];for(const g of s){const x=this._layers[g];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new i.z(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new i.z(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const g=this.map.painter;if(g)for(let x=s.minzoom||0;x<(s.maxzoom||25.5);x++){const E=s.getProgramIds();if(E)for(const I of E){const k=s.getDefaultProgramParams(I,c.zoom,this._styleColorTheme.lut);k&&(g.style=this,this.fog&&(g._fogVisible=!0,k.overrideFog=!0,g.getOrCreateProgram(I,k)),g._fogVisible=!1,k.overrideFog=!1,g.getOrCreateProgram(I,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,g.getOrCreateProgram(I,k)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const g=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const k=this._changes.getLayerUpdatesByScope();for(const j in k){const{updatedIds:U,removedIds:$}=k[j];(U||$)&&(this._updateWorkerLayers(j,U,$),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const E={};for(const k in this._mergedSourceCaches){const j=this._mergedSourceCaches[k];E[k]=j.used,j.used=!1,j.tileCoverLift=0}for(const k of this._mergedOrder){const j=this._mergedLayers[k];if(j.recalculate(s,this._availableImages),!j.isHidden(s.zoom)){const U=this.getLayerSourceCache(j);U&&(U.used=!0,U.tileCoverLift=Math.max(U.tileCoverLift,j.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(j,s)}):this.precompilePrograms(j,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const I=this.imageManager.getPendingImageProviders();for(const k of I)k.sourceCache.used=!0;for(const k in E){const j=this._mergedSourceCaches[k];E[k]!==j.used&&j.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:j.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const c of s){const g=c.resolvePendingRequests();this.addImages(g,c.scope)}}_updateTilesForChangedImages(){const s={};for(const c in this._mergedSourceCaches){const g=this._mergedSourceCaches[c].getSource().scope;s[g]=s[g]||this._changes.getUpdatedImages(g),s[g].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s[g])}for(const c in s)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(s,c,g){const x=this.getFragmentStyle(s);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:s,removedIds:g||[],options:x.options})}setState(s,c){if(this._checkLoaded(),Cs(this,Po(s)))return!1;(s=i.cq(s)).layers=bc(s.layers);const g=function(I,k){if(!I)return[{command:fr.setStyle,args:[k]}];let j=[];try{if(!i.bn(I.version,k.version))return[{command:fr.setStyle,args:[k]}];if(i.bn(I.center,k.center)||j.push({command:fr.setCenter,args:[k.center]}),i.bn(I.zoom,k.zoom)||j.push({command:fr.setZoom,args:[k.zoom]}),i.bn(I.bearing,k.bearing)||j.push({command:fr.setBearing,args:[k.bearing]}),i.bn(I.pitch,k.pitch)||j.push({command:fr.setPitch,args:[k.pitch]}),i.bn(I.sprite,k.sprite)||j.push({command:fr.setSprite,args:[k.sprite]}),i.bn(I.glyphs,k.glyphs)||j.push({command:fr.setGlyphs,args:[k.glyphs]}),i.bn(I.imports,k.imports)||function(oe=[],pe=[],ce){pe=pe||[];const me=(oe=oe||[]).map(Er),ve=pe.map(Er),Ee=oe.reduce(ys,{}),Pe=pe.reduce(ys,{}),Ie=me.slice();let Be,Oe,Ne,ze;for(Be=0,Oe=0;Be<me.length;Be++)Ne=me[Be],Pe.hasOwnProperty(Ne)?Oe++:(ce.push({command:fr.removeImport,args:[Ne]}),Ie.splice(Ie.indexOf(Ne,Oe),1));for(Be=0,Oe=0;Be<ve.length;Be++)Ne=ve[ve.length-1-Be],Ie[Ie.length-1-Be]!==Ne&&(Ee.hasOwnProperty(Ne)?(ce.push({command:fr.removeImport,args:[Ne]}),Ie.splice(Ie.lastIndexOf(Ne,Ie.length-Oe),1)):Oe++,ze=Ie[Ie.length-Be],ce.push({command:fr.addImport,args:[Pe[Ne],ze]}),Ie.splice(Ie.length-Be,0,Ne));for(const Ue of pe){const Ye=Ee[Ue.id];Ye&&!i.bn(Ye,Ue)&&ce.push({command:fr.updateImport,args:[Ue.id,Ue]})}}(I.imports,k.imports,j),i.bn(I.transition,k.transition)||j.push({command:fr.setTransition,args:[k.transition]}),i.bn(I.light,k.light)||j.push({command:fr.setLight,args:[k.light]}),i.bn(I.fog,k.fog)||j.push({command:fr.setFog,args:[k.fog]}),i.bn(I.snow,k.snow)||j.push({command:fr.setSnow,args:[k.snow]}),i.bn(I.rain,k.rain)||j.push({command:fr.setRain,args:[k.rain]}),i.bn(I.projection,k.projection)||j.push({command:fr.setProjection,args:[k.projection]}),i.bn(I.lights,k.lights)||j.push({command:fr.setLights,args:[k.lights]}),i.bn(I.camera,k.camera)||j.push({command:fr.setCamera,args:[k.camera]}),i.bn(I.iconsets,k.iconsets)||function(oe,pe,ce){let me;for(me in pe=pe||{},oe=oe||{})oe.hasOwnProperty(me)&&(pe.hasOwnProperty(me)||ce.push({command:fr.removeIconset,args:[me]}));for(me in pe){if(!pe.hasOwnProperty(me))continue;const ve=pe[me];oe.hasOwnProperty(me)?i.bn(oe[me],ve)||(ce.push({command:fr.removeIconset,args:[me]}),ce.push({command:fr.addIconset,args:[me,ve]})):ce.push({command:fr.addIconset,args:[me,ve]})}}(I.iconsets,k.iconsets,j),!i.bn(I["color-theme"],k["color-theme"]))return[{command:fr.setStyle,args:[k]}];const U={},$=[];(function(oe,pe,ce,me){let ve;for(ve in pe=pe||{},oe=oe||{})oe.hasOwnProperty(ve)&&(pe.hasOwnProperty(ve)||Hp(ve,ce,me));for(ve in pe){if(!pe.hasOwnProperty(ve))continue;const Ee=pe[ve];oe.hasOwnProperty(ve)?i.bn(oe[ve],Ee)||(oe[ve].type==="geojson"&&Ee.type==="geojson"&&gn(oe,pe,ve)?ce.push({command:fr.setGeoJSONSourceData,args:[ve,Ee.data]}):Bu(ve,pe,ce,me)):El(ve,pe,ce)}})(I.sources,k.sources,$,U);const Q=[];I.layers&&I.layers.forEach(oe=>{oe.source&&U[oe.source]?j.push({command:fr.removeLayer,args:[oe.id]}):Q.push(oe)});let J=I.terrain;J&&U[J.source]&&(j.push({command:fr.setTerrain,args:[void 0]}),J=void 0),j=j.concat($),i.bn(J,k.terrain)||j.push({command:fr.setTerrain,args:[k.terrain]}),function(oe,pe,ce){pe=pe||[];const me=(oe=oe||[]).map(Er),ve=pe.map(Er),Ee=oe.reduce(ys,{}),Pe=pe.reduce(ys,{}),Ie=me.slice(),Be=Object.create(null);let Oe,Ne,ze,Ue,Ye,vt,ct;for(Oe=0,Ne=0;Oe<me.length;Oe++)ze=me[Oe],Pe.hasOwnProperty(ze)?Ne++:(ce.push({command:fr.removeLayer,args:[ze]}),Ie.splice(Ie.indexOf(ze,Ne),1));for(Oe=0,Ne=0;Oe<ve.length;Oe++)ze=ve[ve.length-1-Oe],Ie[Ie.length-1-Oe]!==ze&&(Ee.hasOwnProperty(ze)?(ce.push({command:fr.removeLayer,args:[ze]}),Ie.splice(Ie.lastIndexOf(ze,Ie.length-Ne),1)):Ne++,vt=Ie[Ie.length-Oe],ce.push({command:fr.addLayer,args:[Pe[ze],vt]}),Ie.splice(Ie.length-Oe,0,ze),Be[ze]=!0);for(Oe=0;Oe<ve.length;Oe++)if(ze=ve[Oe],Ue=Ee[ze],Ye=Pe[ze],!Be[ze]&&!i.bn(Ue,Ye))if(i.bn(Ue.source,Ye.source)&&i.bn(Ue["source-layer"],Ye["source-layer"])&&i.bn(Ue.type,Ye.type)){for(ct in Gr(Ue.layout,Ye.layout,ce,ze,null,fr.setLayoutProperty),Gr(Ue.paint,Ye.paint,ce,ze,null,fr.setPaintProperty),i.bn(Ue.slot,Ye.slot)||ce.push({command:fr.setSlot,args:[ze,Ye.slot]}),i.bn(Ue.filter,Ye.filter)||ce.push({command:fr.setFilter,args:[ze,Ye.filter]}),i.bn(Ue.minzoom,Ye.minzoom)&&i.bn(Ue.maxzoom,Ye.maxzoom)||ce.push({command:fr.setLayerZoomRange,args:[ze,Ye.minzoom,Ye.maxzoom]}),Ue)Ue.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&ct!=="slot"&&(ct.indexOf("paint.")===0?Gr(Ue[ct],Ye[ct],ce,ze,ct.slice(6),fr.setPaintProperty):i.bn(Ue[ct],Ye[ct])||ce.push({command:fr.setLayerProperty,args:[ze,ct,Ye[ct]]}));for(ct in Ye)Ye.hasOwnProperty(ct)&&!Ue.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&ct!=="slot"&&(ct.indexOf("paint.")===0?Gr(Ue[ct],Ye[ct],ce,ze,ct.slice(6),fr.setPaintProperty):i.bn(Ue[ct],Ye[ct])||ce.push({command:fr.setLayerProperty,args:[ze,ct,Ye[ct]]}))}else ce.push({command:fr.removeLayer,args:[ze]}),vt=Ie[Ie.lastIndexOf(ze)+1],ce.push({command:fr.addLayer,args:[Ye,vt]})}(Q,k.layers,j)}catch(U){console.warn("Unable to compute style diff:",U),j=[{command:fr.setStyle,args:[k]}]}return j}(this.serialize(),s).filter(I=>!(I.command in Pv));if(g.length===0)return!1;const x=g.filter(I=>!(I.command in Qp));if(x.length>0)throw new Error(`Unimplemented: ${x.map(I=>I.command).join(", ")}.`);const E=[];return g.forEach(I=>{E.push(this[I.command].apply(this,I.args))}),c&&Promise.all(E).then(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(s){const c=this.getFragmentStyle(s);c&&(c._availableImages=c.imageManager.listImages(s),c.dispatcher.broadcast("setImages",{scope:s,images:c._availableImages}))}addImages(s,c){for(const[g,x]of s.entries()){if(this.getImage(g,c))return this.fire(new i.z(new Error(`An image with the name "${g.name}" already exists.`)));this.imageManager.addImage(g,c,x),this._changes.updateImage(g,c)}return this._updateWorkerImages(c),this.fire(new i.A("data",{dataType:"style"})),this}addImage(s,c,g){return this.getImage(s,c)?this.fire(new i.z(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,c,g),this._changes.updateImage(s,c),this._updateWorkerImages(c),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(s,c,g,x=!1){this.imageManager.updateImage(s,c,g),x&&(this._changes.updateImage(s,c),this._updateWorkerImages(c),this.fire(new i.A("data",{dataType:"style"})))}getImage(s,c){return this.imageManager.getImage(s,c)}removeImage(s,c){return this.getImage(s,c)?(this.imageManager.removeImage(s,c),this._changes.updateImage(s,c),this._updateWorkerImages(c),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,g={}){return this._checkLoaded(),this._validate(Xe,`models.${s}`,c,null,g)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(sa,`sources.${s}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=dg(s,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const E=I=>{const k=(I?"symbol:":"other:")+x.id,j=i.C(k,this.scope),U=this._sourceCaches[k]=new La(j,x,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=U,U.onAdd(this.map)};E(!1),c.type!=="vector"&&c.type!=="geojson"||E(!0),x.onAdd&&x.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new i.z(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.z(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([E,I])=>I.type==="source"&&I.source===s);if(x)return this.fire(new i.z(new Error(`Source "${s}" cannot be removed while iconset "${x[0]}" is using it.`)))}const g=this.getOwnSourceCaches(s);for(const x of g){const E=i.cr(x.id);delete this._sourceCaches[E],this._changes.discardSourceCacheUpdate(x.id),x.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const g=this.getOwnSourceCache(c);g&&s.push(g.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const g=s[c]._tiles;for(const x in g){const E=g[x];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const x of s){if(this._validate(Lr,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(x),E.updateTransitions(c)}else this.ambientLight=new Vi(x,mr||(mr=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(x),E.updateTransitions(c)}else this.directionalLight=new Vi(x,Zr||(Zr=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new i.aa(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const g=J=>.2126*(J[0]<=.03928?J[0]/12.92:Math.pow((J[0]+.055)/1.055,2.4))+.7152*(J[1]<=.03928?J[1]/12.92:Math.pow((J[1]+.055)/1.055,2.4))+.0722*(J[2]<=.03928?J[2]/12.92:Math.pow((J[2]+.055)/1.055,2.4)),x=s.properties.get("color").toRenderColor(null).toArray01(),E=s.properties.get("intensity"),I=s.properties.get("direction"),k=1-i.cc(I.x,I.y,I.z)[2]/90,j=g(x)*E*k,U=c.properties.get("color").toRenderColor(null).toArray01(),$=c.properties.get("intensity"),Q=g(U)*$;return Number(((j+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(i.cs(s)){const c=i.ct(s),g=this.fragments.find(({id:E})=>E===c);if(!g)throw new Error(`Style import '${s}' not found`);const x=i.cr(s);return g.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:g})=>g===s);return c?c.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const c={},g=(x,E="")=>`${x}::${E}`;this._featuresetSelectors={};for(const x in s){const E=this._featuresetSelectors[x]=[];for(const I of s[x].selectors){if(I.featureNamespace){const j=this.getOwnLayer(I.layer);if(!j){i.w(`Layer is undefined for selector: ${I.layer}`);continue}const U=g(j.source,j.sourceLayer);if(U in c&&c[U]!==I.featureNamespace){i.w(`"featureNamespace ${I.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[U]=I.featureNamespace}let k;if(I.properties)for(const j in I.properties){const U=i.X(I.properties[j]);U.result==="success"&&(k=k||{},k[j]=U.value)}E.push({layerId:I.layer,namespace:I.featureNamespace,properties:k,uniqueFeatureID:I._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const g=[];for(const x in c.stylesheet.featuresets)g.push({featuresetId:x,importId:c.scope?c.scope:void 0});return g}getFeaturesetLayers(s,c){const g=this.getFragmentStyle(c),x=g.stylesheet.featuresets;if(!x||!x[s])return this.fire(new i.z(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const E=[];for(const I of x[s].selectors){const k=g.getOwnLayer(I.layer);k&&E.push(k)}return E}getConfigProperty(s,c){const g=this.getFragmentStyle(s);if(!g)return null;const x=i.C(c,g.scope),E=g.options.get(x),I=E?E.value||E.default:null;return I?I.serialize():null}setConfigProperty(s,c,g){const x=this.getFragmentStyle(s);if(!x)return;const E=x.stylesheet.indoor?Tv(x.stylesheet.schema):x.stylesheet.schema;if(!E||!E[c])return;const I=i.X(g);if(I.result!=="success")return void Cs(this,I.value);const k=I.value.expression,j=i.C(c,x.scope),U=x.options.get(j);if(!U)return;let $;const{minValue:Q,maxValue:J,stepValue:oe,type:pe,values:ce}=E[c],me=i.X(E[c].default);me.result==="success"&&($=me.value.expression),$?(this.options.set(j,Object.assign({},U,{value:k,default:$,minValue:Q,maxValue:J,stepValue:oe,type:pe,values:ce})),this.updateConfigDependencies(c)):this.fire(new i.z(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const g=c.stylesheet.schema;if(!g)return null;const x={};for(const E in g){const I=i.C(E,c.scope),k=c.options.get(I),j=k?k.value||k.default:null;x[E]=j?j.serialize():null}return x}setConfig(s,c){const g=this.getFragmentStyle(s);g&&(g.updateConfig(c,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=c,g.updateConfig(g._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const g in c){let x,E;const I=i.X(c[g].default);if(I.result==="success"&&(x=I.value.expression),s&&s[g]!==void 0){const J=i.X(s[g]);J.result==="success"&&(E=J.value.expression)}const{minValue:k,maxValue:j,stepValue:U,type:$,values:Q}=c[g];if(x){const J=i.C(g,this.scope);this.options.set(J,{default:x,value:E,minValue:k,maxValue:j,stepValue:U,type:$,values:Q})}else this.fire(new i.z(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const c of this._configDependentLayers){const g=this.getLayer(c);if(g){if(s&&!g.configDependencies.has(s))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const g=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(g){const x=c._evaluateColorThemeData(g);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(g)}}),this._changes.setDirty()}addLayer(s,c,g={}){this._checkLoaded();const x=s.id;if(this._layers[x])return void this.fire(new i.z(new Error(`Layer with id "${x}" already exists on this map`)));let E;if(s.type==="custom"){if(Cs(this,i.cu(s)))return;E=i.cv(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=i.cq(s),s=i.l(s,{source:x})),this._validate(ge,`layers.${x}`,s,{arrayIndex:-1},g))return;E=i.cv(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(E),E.setEventedParent(this,{layer:{id:x}})}E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid);let I=this._order.length;if(c){const $=this._order.indexOf(c);if($===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));E.slot===this._layers[c].slot?I=$:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,x),this._layerOrderChanged=!0,this._layers[x]=E;const k=this.getOwnLayerSourceCache(E),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&E.canCastShadows()&&j&&(k.castsShadows=!0);const U=this._changes.getRemovedLayer(E);if(U&&E.source&&k&&E.type!=="custom"){this._changes.discardLayerRemoval(E);const $=i.C(E.source,E.scope);U.type!==E.type?this._changes.updateSourceCache($,"clear"):(this._changes.updateSourceCache($,"reload"),k.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),E.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const g=this._checkLayer(s);if(!g||s===c)return;const x=this._order.indexOf(s);this._order.splice(x,1);let E=this._order.length;if(c){const I=this._order.indexOf(c);if(I===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot===this._layers[c].slot?E=I:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let E=!1;for(const I in this._layers)if(this._layers[I].source===c.source&&this._layers[I].canCastShadows()){E=!0;break}x.castsShadows=E}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,g){this._checkLoaded();const x=this._checkLayer(s);x&&(x.minzoom===c&&x.maxzoom===g||(c!=null&&(x.minzoom=c),g!=null&&(x.maxzoom=g),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const g=this._checkLayer(s);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(s,c,g={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!i.bn(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(be,`layers.${x.id}.filter`,c,{layerType:x.type},g)||(x.filter=i.cq(c),this._updateLayer(x)))}getFilter(s){const c=this._checkLayer(s);if(c)return i.cq(c.filter)}setLayoutProperty(s,c,g,x={}){this._checkLoaded();const E=this._checkLayer(s);if(E&&!i.bn(E.getLayoutProperty(c),g)){if(g!=null&&(!x||x.validate!==!1)&&Cs(E,qe.call(Po,{key:`layers.${s}.layout.${c}`,layerType:E.type,objectKey:c,value:g,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;E.setLayoutProperty(c,g),E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),this._updateLayer(E)}}getLayoutProperty(s,c){const g=this._checkLayer(s);if(g)return g.getLayoutProperty(c)}setPaintProperty(s,c,g,x={}){this._checkLoaded();const E=this._checkLayer(s);if(!E||i.bn(E.getPaintProperty(c),g)||g!=null&&(!x||x.validate!==!1)&&Cs(E,ke.call(Po,{key:`layers.${s}.paint.${c}`,layerType:E.type,objectKey:c,value:g,styleSpec:i.a5})))return;const I=E.setPaintProperty(c,g);E.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),I&&this._updateLayer(E),this._changes.updatePaintProperties(E)}getPaintProperty(s,c){const g=this._checkLayer(s);if(g)return g.getPaintProperty(c)}setFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:j,importId:U}=s.target,$=this.getFragmentStyle(U),Q=$.getFeaturesetLayers(j);for(const{source:J,sourceLayer:oe}of Q)$.setFeatureState({id:s.id,source:J,sourceLayer:oe},c)}else if("layerId"in s.target){const{layerId:j}=s.target,U=this.getLayer(j);this.setFeatureState({id:s.id,source:U.source,sourceLayer:U.sourceLayer},c)}return}const g=s.source,x=s.sourceLayer,E=this._checkSource(g);if(!E)return;const I=E.type;if(I==="geojson"&&x)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(g);for(const j of k)j.setFeatureState(x,s.id,c)}removeFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:j,importId:U}=s.target,$=this.getFragmentStyle(U),Q=$.getFeaturesetLayers(j);for(const{source:J,sourceLayer:oe}of Q)$.removeFeatureState({id:s.id,source:J,sourceLayer:oe},c)}else if("layerId"in s.target){const{layerId:j}=s.target,U=this.getLayer(j);this.removeFeatureState({id:s.id,source:U.source,sourceLayer:U.sourceLayer},c)}return}const g=s.source,x=this._checkSource(g);if(!x)return;const E=x.type,I=E==="vector"?s.sourceLayer:void 0;if(E==="vector"&&!I)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(g);for(const j of k)j.removeFeatureState(I,s.id,c)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let E;if("featuresetId"in s.target){const{featuresetId:I,importId:k}=s.target,j=this.getFragmentStyle(k),U=j.getFeaturesetLayers(I);for(const{source:$,sourceLayer:Q}of U){const J=j.getFeatureState({id:s.id,source:$,sourceLayer:Q});if(J&&!E)E=J;else if(!i.bn(E,J))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:I}=s.target,k=this.getLayer(I);E=this.getFeatureState({id:s.id,source:k.source,sourceLayer:k.sourceLayer})}return E}const c=s.source,g=s.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||g)return s.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(g,s.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=i.l({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),g=i.C(s.source,s.scope),x=this._changes.getUpdatedSourceCaches();s.source&&!x[g]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=k=>this._mergedLayers[k].is3D(!!this.terrain),g=this.order,x={},E=[];for(let k=g.length-1;k>=0;k--){const j=g[k];if(c(j)){x[j]=k;for(const U of s){const $=U[j];if($)for(const Q of $)E.push(Q)}}}E.sort((k,j)=>j.intersectionZ-k.intersectionZ);const I=[];for(let k=g.length-1;k>=0;k--){const j=g[k];if(c(j))for(let U=E.length-1;U>=0;U--){const $=E[U].feature;if($.layer&&x[$.layer.id]<k)break;I.push($),E.pop()}else for(const U of s){const $=U[j];if($)for(const Q of $)I.push(Q.feature)}}return I}queryRenderedFeatures(s,c,g){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(be,"queryRenderedFeatures.filter",c.filter,null,c),x=i.a_(c.filter));const E={},I=$=>{if(em.has($.type))return;const Q=this.getOwnLayerSourceCache($),J=E[Q.id]=E[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};$.is3D(!!this.terrain)&&(J.has3DLayers=!0),J.layers[$.fqid]=J.layers[$.fqid]||{styleLayer:$,targets:[]},J.layers[$.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const $ of c.layers){const Q=this._layers[$];if(!Q)return this.fire(new i.z(new Error(`The layer '${$}' does not exist in the map's style and cannot be queried for features.`))),[];I(Q)}}else for(const $ in this._layers)I(this._layers[$]);const k=this._queryRenderedFeatures(s,E,g),j=this._flattenAndSortRenderedFeatures(k),U=[];for(const $ of j)i.ct($.layer.id)===this.scope&&U.push($);return U}queryRenderedFeatureset(s,c,g){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(be,"queryRenderedFeatures.filter",c.filter,null,c),x=i.a_(c.filter));const E="mock",I=[];if(c&&c.target)I.push(Object.assign({},c,{targetId:E,filter:x}));else{const $=this.getFeaturesetDescriptors();for(const Q of $)I.push({targetId:E,filter:x,target:Q});for(const{style:Q}of this.fragments){const J=Q.getFeaturesetDescriptors();for(const oe of J)I.push({targetId:E,filter:x,target:oe})}}const k=this.queryRenderedTargets(s,I,g),j=[],U=new Set;for(const $ of k)for(const Q of $.variants[E])vc(Q,$,U)||j.push(new i.cx($,Q));return j}queryRenderedTargets(s,c,g){const x={},E=(k,j,U,$)=>{const Q=x[j.id]=x[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};if(Q.layers[k.fqid]=Q.layers[k.fqid]||{styleLayer:k,targets:[]},k.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!$)return U.uniqueFeatureID=!1,void Q.layers[k.fqid].targets.push(U);Q.layers[k.fqid].targets.push(Object.assign({},U,{namespace:$.namespace,properties:$.properties,uniqueFeatureID:$.uniqueFeatureID}))};for(const k of c)if("featuresetId"in k.target){const{featuresetId:j,importId:U}=k.target,$=this.getFragmentStyle(U);if(!$||!$._featuresetSelectors)continue;const Q=$._featuresetSelectors[j];if(!Q){this.fire(new i.z(new Error(`The featureset '${j}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const J of Q){const oe=$.getOwnLayer(J.layerId);oe&&!em.has(oe.type)&&E(oe,$.getOwnLayerSourceCache(oe),k,J)}}else if("layerId"in k.target){const{layerId:j}=k.target,U=this.getLayer(j);if(!U||em.has(U.type))continue;E(U,this.getLayerSourceCache(U),k)}const I=this._queryRenderedFeatures(s,x,g);return this._flattenAndSortRenderedFeatures(I)}_queryRenderedFeatures(s,c,g){const x=[],E=!!this.map._showQueryGeometry,I=Vo.createFromScreenPoints(s,g);for(const k in c){const j=gd(I,c[k],this._availableImages,g,E);Object.keys(j).length&&x.push(j)}if(this.placement)for(const k in c){if(!c[k].sourceCache._onlySymbols)continue;const j=$p(I.screenGeometry,c[k],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(j).length&&x.push(j)}return x}querySourceFeatures(s,c){const g=c&&c.filter;g&&this._validate(be,"querySourceFeatures.filter",g,null,c);let x=[];const E=this.getOwnSourceCaches(s);for(const I of E)x=x.concat(yv(I,c));return x}addSourceType(s,c,g){return ol.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(ol.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,g={}){this._checkLoaded();const x=this.light.getLight();let E=!1;for(const k in s)if(!i.bn(s[k],x[k])){E=!0;break}if(!E)return;const I=this._getTransitionParameters();this.light.setLight(s,c,g),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s;const x=s.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const k="terrain-dem-src";this.addSource(k,g.source),g=i.cq(g),g=i.l(g,{source:k})}const E=i.l({},g),I={};if(this.terrain&&x){E.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(I.style=k.serialize())}if(this._validate(fo,"terrain",E,I))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new i.A("data",{dataType:"style"}))}else{const E=this.terrain,I=E.get();for(const k of Object.keys(i.a5.terrain))!g.hasOwnProperty(k)&&i.a5.terrain[k].default&&(g[k]=i.a5.terrain[k].default);for(const k in s)if(!i.bn(s[k],I[k])){E.set(s,this.options),this.stylesheet.terrain=s;const j=this._getTransitionParameters({duration:0});E.updateTransitions(j),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new Jn(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_createSnow(s){const c=this.snow=new Yn(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_createRain(s){const c=this.rain=new Kr(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.snow=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.rain=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void s();const g=this._evaluateColorThemeData(c);this._loadColorTheme(g).then(()=>{this.fire(new i.A("colorthemeset")),s()}).catch(x=>{i.w(`Couldn't set color theme: ${x}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,c){const g=this.getFragmentStyle(s);g&&(g._styleColorTheme.colorThemeOverride=c,g._reloadColorTheme())}_getTransitionParameters(s){return{now:i.q.now(),transition:i.l(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?s.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const g=this.terrain=new Ct(s,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,g,x,E={}){if(E&&E.validate===!1)return!1;const I=i.l({},this.serialize());return Cs(this,s.call(Po,i.l({key:c,style:I,value:g,styleSpec:i.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const g of c)g.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const g of c)g.resume(),g.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let c;this.directionalLight&&(c=Cc(this.directionalLight));for(const g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,g,x,E,I,k=!1){let j=!1,U=!1;const $={},Q={};for(const J of this._mergedOrder){const oe=this._mergedLayers[J];if(oe.type!=="symbol")continue;const pe=i.C(oe.source,oe.scope);let ce=$[pe];if(!ce){const ve=this.getLayerSourceCache(oe);if(!ve)continue;const Ee=ve.getRenderableIds(!0).map(Pe=>ve.getTileByID(Pe));Q[pe]=Ee.slice(),ce=$[pe]=Ee.sort((Pe,Ie)=>Ie.tileID.overscaledZ-Pe.tileID.overscaledZ||(Pe.tileID.isLessThan(Ie.tileID)?-1:1))}const me=this.crossTileSymbolIndex.addLayer(oe,ce,c.center.lng,c.projection);j=j||me}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),c.zoom))&&(this.pauseablePlacement=new ch(c,this._mergedOrder,k,g,x,E,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,$,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),U=!0),j&&this.pauseablePlacement.placement.setStale()),U||j){this._buildingIndex.onNewFrame(c.zoom);for(let J=0;J<this._mergedOrder.length;J++){const oe=this._mergedLayers[this._mergedOrder[J]];if(oe.type!=="symbol")continue;const pe=this.isLayerClipped(oe);this.placement.updateLayerOpacities(oe,$[i.C(oe.source,oe.scope)],J,pe?I:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:E})=>E===s.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return g.push(s),this._loadImports([s],!0);const x=g.findIndex(({id:E})=>E===c);return x===-1&&this.fire(new i.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,x).concat(s).concat(g.slice(x)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);return x===-1?this:typeof c=="string"?(this.setImportUrl(s,c),this):(c.url&&c.url!==g[x].url&&this.setImportUrl(s,c.url),i.bn(c.config,g[x].config)||this.setImportConfig(s,c.config,c.data.schema),i.bn(c.data,g[x].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let g=this.stylesheet.imports||[];const x=this.getImportIndex(s);if(x===-1)return this;const E=this.getImportIndex(c);if(E===-1)return this;const I=g[x],k=this.fragments[x];return g=g.filter(({id:j})=>j!==s),this.fragments=this.fragments.filter(({id:j})=>j!==s),this.stylesheet.imports=g.slice(0,E).concat(I).concat(g.slice(E)),this.fragments=this.fragments.slice(0,E).concat(k).concat(this.fragments.slice(E)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);if(x===-1)return this;g[x].url=c;const E=this.fragments[x];return E.style=this._createFragmentStyle(g[x]),E.style.on("style.import.load",()=>this.mergeAll()),E.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const g=this.getImportIndex(s),x=this.stylesheet.imports||[];return g===-1?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete x[g].data,this.setImportUrl(s,x[g].url))}setImportConfig(s,c,g){this._checkLoaded();const x=this.getImportIndex(s),E=this.stylesheet.imports||[];if(x===-1)return this;c?E[x].config=c:delete E[x].config;const I=this.fragments[x];g&&I.style.stylesheet&&(I.style.stylesheet.schema=g);const k=I.style.stylesheet&&I.style.stylesheet.schema;return I.config=c,I.style.updateConfig(c,k),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return c===-1&&this.fire(new i.z(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[c];g&&s.push(g.getSource())}return s}getSource(s,c){const g=this.getSourceCache(s,c);return g&&g.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const g=i.C(s,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){const c=i.C(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const g=s[c];g==="reload"?this.reloadSource(c):g==="clear"&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const g of c){const x=this.getLayer(g);x&&x.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s,this.scope)}getImages(s,c,g){this.imageManager.getImages(c.images,c.scope,g),this._updateTilesForChangedImages();const x=I=>{if(I){const k=c.images.map(j=>i.I.toString(j));I.setDependencies(c.tileID.key,c.type,k)}},E=i.C(c.source,c.scope);x(this._mergedOtherSourceCaches[E]),x(this._mergedSymbolSourceCaches[E])}rasterizeImages(s,c,g){this.imageManager.rasterizeImages(c,g)}getGlyphs(s,c,g){this.glyphManager.getGlyphs(c.stacks,c.scope,g)}getResource(s,c,g){return i.cz(c,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return c.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${s}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&s.type!=="fill-extrusion")return!1;const g=s.type==="fill-extrusion"&&s.sourceLayer==="building";if(s.is3D(!!this.terrain)){if(g||c&&c.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ol.getSourceType=function(_){return X_[_]},ol.setSourceType=function(_,s){X_[_]=s},ol.registerForPluginStateChange=i.ci;var ey=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Sg=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Uu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Lf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Al=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Of=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Eg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Gu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ru=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,wd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Df=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Rl=[];iu(ey,Rl),iu(Uu,Rl),iu(Sg,Rl);const mh={"_prelude_fog.vertex.glsl":Of,"_prelude_terrain.vertex.glsl":Al,"_prelude_shadow.vertex.glsl":wd,"_prelude_fog.fragment.glsl":Eg,"_prelude_shadow.fragment.glsl":Df,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Gu,"_prelude_raster_particle.glsl":ru},Sd={};hr("",Al),hr(Eg,Of),hr(Df,wd),hr(Gu,""),hr(ru,"");const Cg=hr(Sg,Uu),tm=ey;var Nf={background:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:hr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:hr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:hr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:hr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:hr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:hr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:hr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:hr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:hr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:hr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:hr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:hr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lf),skyboxGradient:hr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Lf),skyboxCapture:hr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:hr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:hr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:hr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:hr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:hr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:hr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function iu(_,s){const c=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of c)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const E of x)s.includes(E)||s.push(E)}}function hr(_,s){const c=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(U=>{const $=U.split(" ");return $[$.length-1]}),x=[...new Set(x)]);const E={},I=[],k=[];if(_=_.replace(c,(U,$)=>(k.push($),"")),(s=s.replace(c,(U,$)=>(I.push($),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let j=[...Rl];iu(_,j),iu(s,j);for(const U of[...I,...k])mh[U]||console.error(`Undefined include: ${U}`),Sd[U]||(Sd[U]=[],iu(mh[U],Sd[U])),j=[...j,...Sd[U]];return{fragmentSource:_=_.replace(g,(U,$,Q,J,oe)=>(E[oe]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
in ${Q} ${J} ${oe};
#else
uniform ${Q} ${J} u_${oe};
#endif
`:$==="initialize"?`
#ifdef HAS_UNIFORM_u_${oe}
    ${Q} ${J} ${oe} = u_${oe};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    in ${Q} ${J} ${oe};
#endif
`:$==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(U,$,Q,J,oe)=>{const pe=J==="float"?"vec2":J,ce=oe.match(/color/)?"color":pe;return $==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
in ${Q} ${J} a_${oe};
#endif
`:E[oe]?$==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${Q} ${pe} a_${oe};
out ${Q} ${J} ${oe};
#else
uniform ${Q} ${J} u_${oe};
#endif
`:$==="initialize"?ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = a_${oe};
#else
    ${Q} ${J} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = unpack_mix_${ce}(a_${oe}, u_${oe}_t);
#else
    ${Q} ${J} ${oe} = u_${oe};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    in ${Q} ${J} a_${oe};
    out ${Q} ${J} ${oe};
#endif
`:$==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    ${oe} = a_${oe};
#endif
`:void 0:$==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${Q} ${pe} a_${oe};
#else
uniform ${Q} ${J} u_${oe};
#endif
`:$==="define-instanced"?ce==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${oe}0;
in vec4 a_${oe}1;
in vec4 a_${oe}2;
in vec4 a_${oe}3;
#else
uniform ${Q} ${J} u_${oe};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Q} ${pe} a_${oe};
#else
uniform ${Q} ${J} u_${oe};
#endif
`:$==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    ${Q} ${J} ${oe} = a_${oe};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${Q} ${J} ${oe} = a_${oe};
#else
    ${Q} ${J} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${Q} ${J} ${oe} = unpack_mix_${ce}(a_${oe}, u_${oe}_t);
#else
    ${Q} ${J} ${oe} = u_${oe};
#endif
`}),staticAttributes:x,usedDefines:j,vertexIncludes:I,fragmentIncludes:k}}class Tg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,g,x,E,I,k,j){this.context=s;let U=this.boundPaintVertexBuffers.length!==x.length;for(let Q=0;!U&&Q<x.length;Q++)this.boundPaintVertexBuffers[Q]!==x[Q]&&(U=!0);let $=this.boundDynamicVertexBuffers.length!==k.length;for(let Q=0;!$&&Q<k.length;Q++)this.boundDynamicVertexBuffers[Q]!==k[Q]&&($=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||U||$||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(c,g,x,E,I,k,j);else{s.bindVertexArrayOES.set(this.vao);for(const Q of k)Q&&(Q.bind(),j&&Q.instanceCount&&Q.setVertexAttribDivisor(s.gl,c,j));E&&E.dynamicDraw&&E.bind()}}freshBind(s,c,g,x,E,I,k){const j=s.numAttributes,U=this.context,$=U.gl;this.vao&&this.destroy(),this.vao=U.gl.createVertexArray(),U.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I,c.enableAttributes($,s),c.bind(),c.setVertexAttribPointers($,s,E);for(const Q of g)Q.enableAttributes($,s),Q.bind(),Q.setVertexAttribPointers($,s,E);for(const Q of I)Q&&(Q.enableAttributes($,s),Q.bind(),Q.setVertexAttribPointers($,s,E),k&&Q.instanceCount&&Q.setVertexAttribDivisor($,s,k));x&&x.bind(),U.currentNumAttributes=j}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ig(_,s){const c=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new i.ac(0,g/c).toLngLat().lat,new i.ac(0,(g+1)/c).toLngLat().lat]}function kf(_,s,c,g,x,E,I){const k=_.context,j=k.gl,U=c.hillshadeFBO;if(!U)return;_.prepareDrawTile();const $=_.isTileAffectedByFog(s),Q=_.getOrCreateProgram("hillshade",{overrideFog:$});k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,U.colorAttachment.get());const J=((me,ve,Ee,Pe)=>{const Ie=Ee.paint.get("hillshade-shadow-color"),Be=Ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Oe=Ee.paint.get("hillshade-highlight-color"),Ne=Ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ze=Ee.paint.get("hillshade-accent-color"),Ue=Ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ye=Ee.paint.get("hillshade-emissive-strength");let vt=i.ak(Ee.paint.get("hillshade-illumination-direction"));if(Ee.paint.get("hillshade-illumination-anchor")==="viewport")vt-=me.transform.angle;else if(me.style&&me.style.enable3dLights()&&me.style.directionalLight){const Pt=me.style.directionalLight.properties.get("direction"),At=i.cc(Pt.x,Pt.y,Pt.z);vt=i.ak(At[1])}const ct=!me.options.moving;return{u_matrix:Pe||me.transform.calculateProjMatrix(ve.tileID.toUnwrapped(),ct),u_image:0,u_latrange:Ig(0,ve.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),vt],u_shadow:Ie.toRenderColor(Be?null:Ee.lut),u_highlight:Oe.toRenderColor(Ne?null:Ee.lut),u_emissive_strength:Ye,u_accent:ze.toRenderColor(Ue?null:Ee.lut)}})(_,c,g,_.terrain?s.projMatrix:null);_.uploadCommonUniforms(k,Q,s.toUnwrapped());const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:pe,tileBoundsSegments:ce}=_.getTileBoundsBuffers(c);Q.draw(_,j.TRIANGLES,x,E,I,Fn.disabled,J,g.id,oe,pe,ce)}function ty(_,s,c){if(!s.needsDEMTextureUpload)return;const g=_.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(c.stride);const E=c.getPixels();s.demTexture?s.demTexture.update(E,{premultiply:!1}):s.demTexture=new i.T(g,E,x.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function nm(_,s,c){const g=_.context,x=g.gl;if(!s.dem)return;const E=s.dem;if(g.activeTexture.set(x.TEXTURE1),ty(_,s,E),!s.demTexture)return;s.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const I=E.dim;g.activeTexture.set(x.TEXTURE0);let k=s.hillshadeFBO;if(!k){const J=new i.T(g,{width:I,height:I,data:null},x.RGBA8);J.bind(x.LINEAR,x.CLAMP_TO_EDGE),k=s.hillshadeFBO=g.createFramebuffer(I,I,!0,"renderbuffer"),k.colorAttachment.set(J.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,I,I]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=_.getMercatorTileBoundsBuffers(),Q=[];_.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),_.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(_,x.TRIANGLES,En.disabled,Vn.disabled,pr.unblended,Fn.disabled,((J,oe)=>{const pe=oe.stride,ce=i.ad.mat4.create();return i.ad.mat4.ortho(ce,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(ce,ce,[0,-i.ai,0]),{u_matrix:ce,u_image:1,u_dimension:[pe,pe],u_zoom:J.overscaledZ}})(s.tileID,E),c.id,j,U,$),s.needsHillshadePrepare=!1}class Ti{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Av extends Ti{getDefault(){return i.al.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Mg extends Ti{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Wi extends Ti{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class rm extends Ti{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ff extends Ti{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class zf extends Ti{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class ny extends Ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class ry extends Ti{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Tc extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class gh extends Ti{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ed extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class Oa extends Ti{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class iy extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Pg extends Ti{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class im extends Ti{getDefault(){return i.al.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Bf extends Ti{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class jf extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class om extends Ti{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Vf extends Ti{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let sm=class extends Ti{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class am extends Ti{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Ag extends Ti{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class oy extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Rv extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Uf extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class sy extends Ti{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class _h extends Ti{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Lv extends Ti{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Gf extends Ti{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class $u extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class lm extends Ti{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class sl extends Ti{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class um extends sl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ay extends sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class $f extends sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class yh extends ay{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const qf=(_,s,c)=>({u_matrix:_,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),vh=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:k,u_frustum_br:j,u_frustum_bl:U,u_globe_pos:$,u_globe_radius:Q,u_viewport:J,u_grid_matrix:ce?Float32Array.from(ce):new Float32Array(9),u_skirt_height:oe,u_far_z_cutoff:pe});function Cd(_,s){return _!=null&&s!=null&&!(!_.hasData()||!s.hasData())&&_.demTexture!=null&&s.demTexture!=null&&_.tileID.key!==s.tileID.key}const Da=new class{constructor(){this.operations={}}newMorphing(_,s,c,g,x){if(_ in this.operations){const E=this.operations[_];E.to.tileID.key!==c.tileID.key&&(E.queued=c)}else this.operations[_]={startTime:g,phase:0,duration:x,from:s,to:c,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const s=this.operations[_];return{from:s.from,to:s.to,phase:s.phase}}update(_){for(const s in this.operations){const c=this.operations[s];for(c.phase=(_-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,_)){delete this.operations[s];break}}}_nextOp(_,s){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=s,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},xh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function $s(_,s,c){if(s===0)return 0;const g=s<1&&c===514?.25/s:1;return 6*Math.pow(1.5,22-_)*Math.max(s,1)*g}function Xi(_,s){const c=1<<_.z;return!s&&(_.x===0||_.x===c-1)||_.y===0||_.y===c-1}const Ri=_=>({u_matrix:_});function ou(_,s,c,g,x){if(x>0){const E=i.q.now(),I=(E-_.timeAdded)/x,k=s?(E-s.timeAdded)/x:-1,j=c.getSource(),U=g.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),$=!s||Math.abs(s.tileID.overscaledZ-U)>Math.abs(_.tileID.overscaledZ-U),Q=$&&_.refreshedUponExpiration?1:i.ay($?I:1-k,0,1);return _.refreshedUponExpiration&&I>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}class Ts extends La{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new i.D(i.cj(),null),x=dg("mock-dem",c,g,s.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class qs extends La{constructor(s){const c=dg("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new i.D(i.cj(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,g){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const k=new tl(I,this._source.tileSize*I.overscaleFactor(),s.tileZoom);k.state="loaded",this._tiles[I.key]=k}return E},{});for(const E in this._tiles)E in x||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qu extends i.aH{constructor(s,c,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class Td extends i.cK{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,E]=function(j){const U=new i.b5,$=new i.aV,Q=131;U.reserve(17161),$.reserve(33800);const J=i.ai/128,oe=i.ai+J/2,pe=oe+J;for(let me=-J;me<pe;me+=J)for(let ve=-J;ve<pe;ve+=J){const Ee=ve<0||ve>oe||me<0||me>oe?24575:0,Pe=i.ay(Math.round(ve),0,i.ai),Ie=i.ay(Math.round(me),0,i.ai);U.emplaceBack(Pe+Ee,Ie)}const ce=(me,ve)=>{const Ee=ve*Q+me;$.emplaceBack(Ee+1,Ee,Ee+Q),$.emplaceBack(Ee+Q,Ee+Q+1,Ee+1)};for(let me=1;me<129;me++)for(let ve=1;ve<129;ve++)ce(ve,me);return[0,129].forEach(me=>{for(let ve=0;ve<130;ve++)ce(ve,me),ce(me,ve)}),[U,$,32768]}(),I=s.context;this.gridBuffer=I.createVertexBuffer(g,i.b7.members),this.gridIndexBuffer=I.createIndexBuffer(x),this.gridSegments=i.b8.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,g.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qs(c.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const k=I.gl;this._overlapStencilMode=new Vn({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ts(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const x=s.terrain.properties,E=s.terrain.drapeRenderMode===0,I=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const k=s.terrain&&s.terrain.scope,j=x.get("source"),U=E?this._mockSourceCache:s.getSourceCache(j,k);if(!U)return void i.w(`Couldn't find terrain source "${j}".`);if(this.sourceCache=U,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=I?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&I&&this._exaggeration===0)return void this._disable();this.enabled=!0;const $=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(c,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,$(),this._initializing=!0),$(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;const x=c!=null?g-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const E=s.zoom,I=this._style.terrain;if(!this._previousUpdateTimestamp)return I.getExaggeration(E);let k=E-this._previousZoom;const j=this._previousUpdateTimestamp;let U=E;this._evaluationZoom!=null&&(U=this._evaluationZoom,Math.abs(E-U)>.5&&(k=.5*(E-U+k)),k*x<0&&(U+=k)),this._evaluationZoom=U;const $=I.getExaggeration(U),Q=$===I.getExaggeration(Math.max(0,U-.1));if(Q&&Math.abs($-this._exaggeration)<.01)return $;let J=Math.min(.1,.00375*(this._updateTimestamp-j));return(Q||$<.1||Math.abs(k)<1e-4)&&(J=Math.min(.2,4*J)),i.ah(this._exaggeration,$,J)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(j=>{const U=c.getTileByID(j).tileID;return U.projMatrix=g.calculateProjMatrix(U.toUnwrapped()),U});(function(j,U){const $=U.transform.pointCoordinate(U.transform.getCameraPoint()),Q=new i.P($.x,$.y);j.sort((J,oe)=>{if(oe.overscaledZ-J.overscaledZ)return oe.overscaledZ-J.overscaledZ;const pe=new i.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ce=new i.P(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),me=Q.mult(1<<J.canonical.z);return me.x-=.5,me.y-=.5,me.distSqr(pe)-me.distSqr(ce)})})(x,this.painter);const E=this.proxyToSource||{};this.proxyToSource={},x.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const I=this._style._mergedSourceCaches;for(const j in I){const U=I[j];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,s[j],E),U.usedForTerrain))continue;const $=s[j];U.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[c.id]=x.map(j=>new qu(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const U=this.terrainTileForTile[j.key];if(!U)continue;const $=U.tileID.key;$ in k||(this._visibleDemTiles.push(U),k[$]=$)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],E=x.dem;!E||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),ty(this.painter,x,E))}}_prepareDemTileUniforms(s,c,g,x){if(!c||c.demTexture==null)return!1;const E=s.tileID.canonical,I=Math.pow(2,c.tileID.canonical.z-E.z),k=x||"";return g[`u_dem_tl${k}`]=[E.x*I%1,E.y*I%1],g[`u_dem_scale${k}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const E=x.dem.tree.minimums[0];return E>0&&s++,g+E},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new i.cL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new i.T(s,x,c.R32F,{premultiply:!1}),E}setupElevationDraw(s,c,g){const x=this.painter.context,E=x.gl,I={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};I.u_exaggeration=this.exaggeration();let k=null,j=null,U=1;if(g&&g.morphing&&this._useVertexMorphing){const oe=g.morphing.srcDemTile,pe=g.morphing.dstDemTile;U=g.morphing.phase,oe&&pe&&(this._prepareDemTileUniforms(s,oe,I,"_prev")&&(j=oe),this._prepareDemTileUniforms(s,pe,I)&&(k=pe))}const $=oe=>oe&&oe.demTexture&&this.painter.linearFloatFilteringSupported()?E.LINEAR:E.NEAREST;let Q=null;var J;if(this.enabled?j&&k?(Q=k.demTexture,x.activeTexture.set(E.TEXTURE4),j.demTexture.bind($(j),E.CLAMP_TO_EDGE),I.u_dem_lerp=U):(k=this.terrainTileForTile[s.tileID.key],Q=this._prepareDemTileUniforms(s,k,I)?k.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,x.activeTexture.set(E.TEXTURE2),Q&&(I.u_dem_size=(J=Q).size[0]===1?1:J.size[0]-2,Q.bind($(k),E.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,c,I),g&&g.useMeterToDem&&k){const oe=(1<<k.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=oe}if(g&&g.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(x,I),this.painter.transform.projection.name==="globe"){const oe=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,oe)}}globeUniformValues(s,c,g){const x=s.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,i.ai,0),u_tile_br_up:x.upVector(c,i.ai,i.ai),u_tile_bl_up:x.upVector(c,0,i.ai),u_tile_up_scale:g?i.cM(1):x.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,E,I,k,j){if(x.transform.projection.name==="globe")(function(U,$,Q,J,oe){const pe=U.context,ce=pe.gl;let me,ve;const Ee=U.transform,Pe=i.cD(U,pe,Ee),Ie=(Pt,At)=>{if(ve===At)return;const jt=[xh[At],"PROJECTION_GLOBE_VIEW"];Pe&&jt.push("CUSTOM_ANTIALIASING");const ut=U.isTileAffectedByFog(Pt);me=U.getOrCreateProgram("globeRaster",{defines:jt,overrideFog:ut}),ve=At},Be=U.colorModeForRenderPass(),Oe=new En(ce.LEQUAL,En.ReadWrite,U.depthRangeFor3D);Da.update(oe);const Ne=i.cE(Ee),ze=[i.av(Ee.center.lng),i.aC(Ee.center.lat)],Ue=U.globeSharedBuffers,Ye=[Ee.width*i.q.devicePixelRatio,Ee.height*i.q.devicePixelRatio],vt=Float32Array.from(Ee.globeMatrix),ct={useDenormalizedUpVectorScale:!0};{const Pt=U.transform,At=$s(Pt.zoom,$.exaggeration(),$.sourceCache._source.tileSize);ve=-1;const jt=ce.TRIANGLES;for(const ut of J){const It=Q.getTile(ut),nt=Vn.disabled,Mt=$.prevTerrainTileForTile[ut.key],St=$.terrainTileForTile[ut.key];Cd(Mt,St)&&Da.newMorphing(ut.key,Mt,St,oe,250),pe.activeTexture.set(ce.TEXTURE0),It.texture&&It.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Rt=Da.getMorphValuesForProxy(ut.key),xt=Rt?1:0;Rt&&i.L(ct,{morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:i.cC(Rt.phase)}});const Lt=i.cF(ut.canonical),en=i.cG(Lt.getCenter().lat),tn=i.cH(ut.canonical,Lt,en,Pt.worldSize/Pt._pixelsPerMercatorPixel),rn=i.bc(i.cI(ut.canonical)),fn=vh(Pt.expandedFarZProjMatrix,vt,Ne,rn,i.ag(Pt.zoom),ze,Pt.frustumCorners.TL,Pt.frustumCorners.TR,Pt.frustumCorners.BR,Pt.frustumCorners.BL,Pt.globeCenterInViewSpace,Pt.globeRadius,Ye,At,Pt._farZ,tn);if(Ie(ut,xt),me&&($.setupElevationDraw(It,me,ct),U.uploadCommonUniforms(pe,me,ut.toUnwrapped()),Ue)){const[kn,vn,Ln]=Ue.getGridBuffers(en,At!==0);me.draw(U,jt,Oe,nt,Be,Fn.backCCW,fn,"globe_raster",kn,vn,Ln)}}}if(Ue&&(U.renderDefaultNorthPole||U.renderDefaultSouthPole)){const Pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Pe&&Pt.push("CUSTOM_ANTIALIASING"),me=U.getOrCreateProgram("globeRaster",{defines:Pt});for(const At of J){const{x:jt,y:ut,z:It}=At.canonical,nt=ut===0,Mt=ut===(1<<It)-1,[St,Rt,xt,Lt]=Ue.getPoleBuffers(It,!1);if(Lt&&(nt||Mt)){const en=Q.getTile(At);pe.activeTexture.set(ce.TEXTURE0),en.texture&&en.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let tn=i.cJ(It,jt,Ee);const rn=i.bc(i.cI(At.canonical)),fn=(kn,vn)=>kn.draw(U,ce.TRIANGLES,Oe,Vn.disabled,Be,Fn.disabled,vh(Ee.expandedFarZProjMatrix,tn,tn,rn,0,ze,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,Ye,0,Ee._farZ),"globe_pole_raster",vn,xt,Lt);$.setupElevationDraw(en,me,ct),U.uploadCommonUniforms(pe,me,At.toUnwrapped()),nt&&U.renderDefaultNorthPole&&fn(me,St),Mt&&U.renderDefaultSouthPole&&(tn=i.ad.mat4.scale(i.ad.mat4.create(),tn,[1,-1,1]),fn(me,Rt))}}}})(x,E,I,k,j);else{const U=x.context,$=U.gl;let Q,J;const oe=x.shadowRenderer,pe=Vu(x,x.longestCutoffRange),ce=Be=>{if(J===Be)return;const Oe=[];Oe.push(xh[Be]),pe.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),oe&&(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),oe.useNormalOffset&&Oe.push("NORMAL_OFFSET")),Q=x.getOrCreateProgram("terrainRaster",{defines:Oe}),J=Be},me=x.colorModeForRenderPass(),ve=new En($.LEQUAL,En.ReadWrite,x.depthRangeFor3D);Da.update(j);const Ee=x.transform,Pe=$s(Ee.zoom,E.exaggeration(),E.sourceCache._source.tileSize);let Ie=[0,0,0];if(oe){const Be=x.style.directionalLight,Oe=x.style.ambientLight;Be&&Oe&&(Ie=fh(x.style,Be,Oe))}{J=-1;const Be=$.TRIANGLES,[Oe,Ne]=[E.gridIndexBuffer,E.gridSegments];for(const ze of k){const Ue=I.getTile(ze),Ye=Vn.disabled,vt=E.prevTerrainTileForTile[ze.key],ct=E.terrainTileForTile[ze.key];Cd(vt,ct)&&Da.newMorphing(ze.key,vt,ct,j,250),U.activeTexture.set($.TEXTURE0),Ue.texture&&Ue.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Pt=Da.getMorphValuesForProxy(ze.key),At=Pt?1:0;let jt;Pt&&(jt={morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:i.cC(Pt.phase)}});const ut=qf(ze.projMatrix,Xi(ze.canonical,Ee.renderWorldCopies)?Pe/10:Pe,Ie);if(ce(At),!Q)continue;E.setupElevationDraw(Ue,Q,jt);const It=ze.toUnwrapped();oe&&oe.setupShadows(It,Q),x.uploadCommonUniforms(U,Q,It,null,pe),Q.draw(x,Be,ve,Ye,me,Fn.backCCW,ut,"terrain_raster",E.gridBuffer,Oe,Ne)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,x=this.proxySourceCache,E=this.proxiedCoords[x.id],I=this._drapedRenderBatches.shift(),k=c.style.order,j=[];let U=0;for(const $ of E){const Q=x.getTileByID($.proxyTileKey),J=x.proxyCachedFBO[$.key]?x.proxyCachedFBO[$.key][s]:void 0,oe=J!==void 0?x.renderCache[J]:this.pool[U++],pe=J!==void 0;if(Q.texture=oe.tex,pe&&!oe.dirty){j.push(Q.tileID);continue}let ce;g.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(g.clear({color:i.al.transparent,stencil:0}),oe.dirty=!1);for(let me=I.start;me<=I.end;++me){const ve=c.style._mergedLayers[k[me]];if(ve.isHidden(c.transform.zoom))continue;const Ee=c.style.getLayerSourceCache(ve),Pe=Ee?this.proxyToSource[$.key][Ee.id]:[$];if(!Pe)continue;const Ie=Pe;g.viewport.set([0,0,oe.fb.width,oe.fb.height]),ce!==(Ee?Ee.id:null)&&(this._setupStencil(oe,Pe,ve,Ee),ce=Ee?Ee.id:null),c.renderLayer(c,Ee,ve,Ie)}if(this._drapedRenderBatches.length===0)for(const me of this._pendingGroundEffectLayers){const ve=c.style._mergedLayers[k[me]];if(ve.isHidden(c.transform.zoom))continue;const Ee=c.style.getLayerSourceCache(ve),Pe=Ee?this.proxyToSource[$.key][Ee.id]:[$];if(!Pe)continue;const Ie=Pe;g.viewport.set([0,0,oe.fb.width,oe.fb.height]),ce!==(Ee?Ee.id:null)&&(this._setupStencil(oe,Pe,ve,Ee),ce=Ee?Ee.id:null),c.renderLayer(c,Ee,ve,Ie)}this.renderedToTile?(oe.dirty=!0,j.push(Q.tileID)):pe||--U,U===5&&(U=0,this.renderToBackBuffer(j))}return this.renderToBackBuffer(j),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),I.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let g=-1,x=c;for(let E=0;E<c;++E)this._style.isLayerDraped(s._mergedLayers[s.order[E]])?g=Math.max(g,E):x=Math.min(x,E);return x>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,c,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,k=1<<I.overscaledZ,{x:j,y:U}=I.canonical,$=j/k,Q=(j+1)/k,J=U/k,oe=(U+1)/k;return{minx:$,miny:J,maxx:Q,maxy:oe,t:E.dem.tree.raycastRoot($,J,Q,oe,s,c,g),tile:E}});x.sort((E,I)=>(E.t!==null?E.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const E of x){if(E.t==null)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,s,c,g);if(I!=null)return I}return null}_createFBO(){const s=this.painter.context,c=s.gl,g=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const x=new i.T(s,{width:g[0],height:g[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const E=s.createFramebuffer(g[0],g[1],!0,null);return E.colorAttachment.set(x.texture),E.depthAttachment=new yh(s,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:E,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],g=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style.getSources())if(g instanceof Cf){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],E=this._style.getLayerSourceCache(x);if(E&&!c[E.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ab){c[E.id]=!0;for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][E.id];if(k)for(const j of k)this._clearRenderCacheForTile(E.id,j)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Ro){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],E=this._style.getLayerSourceCache(x);if(!E||c[E.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const I=x.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const j=this.proxyToSource[k.key][E.id];if(j)for(const U of j){const $=ou(E.getTile(U),E.findLoadedParent(U,0),E,this.painter.transform,I);($.opacity!==1||$.mix!==0)&&this._clearRenderCacheForTile(E.id,U)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,c=s.length;if(c===0)return;const g=[];this._pendingGroundEffectLayers=[];let x,E=0,I=this._style._mergedLayers[s[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<c;)I=this._style._mergedLayers[s[E]];for(;E<c;++E){const k=this._style._mergedLayers[s[E]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?x===void 0&&(x=E):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(E),x!==void 0&&(g.push({start:x,end:E-1}),x=void 0)))}if(x!==void 0&&g.push({start:x,end:E-1}),g.length!==0){const k=g[g.length-1];this._pendingGroundEffectLayers.every(j=>j>k.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const I=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<I.length;++k){const j=Object.values(I[k]);c.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let I=g.length-1;I>=0;I--){const k=g[I];if(c.getTileByID(k.key),c.proxyCachedFBO[k.key]!==void 0){const j=s[k.key],U=this.proxyToSource[k.key];let $=0;for(const Q in U){const J=U[Q],oe=j[Q];if(!oe||oe.length!==J.length||J.some((pe,ce)=>pe!==oe[ce]||x[Q]&&x[Q].hasOwnProperty(pe.key))){$=-1;break}++$}for(const Q in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][Q]].dirty=$<0||$!==Object.values(j).length}}const E=[...this._drapedRenderBatches];E.sort((I,k)=>k.end-k.start-(I.end-I.start));for(const I of E)for(const k of g){if(c.proxyCachedFBO[k.key])continue;let j=c.renderCachePool.pop();j===void 0&&c.renderCache.length<50&&(j=c.renderCache.length,c.renderCache.push(this._createFBO())),j!==void 0&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][I.start]=j,c.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=c.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Vn.disabled}_renderTileClippingMasks(s,c){const g=this.painter,x=this.painter.context,E=x.gl;g._tileClippingMaskIDs={},x.setColorMode(pr.disabled),x.setDepthMode(En.disabled);const I=g.getOrCreateProgram("clippingMask");for(const k of s){const j=g._tileClippingMaskIDs[k.key]=--c;I.draw(g,E.TRIANGLES,En.disabled,new Vn({func:E.ALWAYS,mask:0},j,255,E.KEEP,E.KEEP,E.REPLACE),pr.disabled,Fn.disabled,Ri(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const g=[s.x,s.y,1,1];i.ad.vec4.transformMat4(g,g,c.pixelMatrixInverse),i.ad.vec4.scale(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const x=c._camera.position,E=i.bH(1,c.center.lat),I=[x[0],x[1],x[2]/E,0],k=i.ad.vec3.subtract([],g.slice(0,3),I);i.ad.vec3.normalize(k,k);const j=this.raycast(I,k,this._exaggeration);return j!==null&&j?(i.ad.vec3.scaleAndAdd(I,I,k,j),I[3]=I[2],I[2]*=E,I):null}_setupProxiedCoordsForOrtho(s,c,g){if(s.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(s,c,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],E=this.proxyCoords;for(let j=0;j<E.length;j++){const U=E[j],$=this._findTileCoveringTileID(U,s);if($){const Q=this._createProxiedId(U,$,g[U.key]&&g[U.key][s.id]);x.push(Q),this.proxyToSource[U.key][s.id]=[Q]}}let I=!1;const k=new Set;for(let j=0;j<c.length;j++){const U=s.getTile(c[j]);if(!U||!U.hasData())continue;const $=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==U.tileID.canonical.z){const Q=this.proxyToSource[$.tileID.key][s.id],J=this._createProxiedId($.tileID,U,g[$.tileID.key]&&g[$.tileID.key][s.id]);Q?Q.splice(Q.length-1,0,J):this.proxyToSource[$.tileID.key][s.id]=[J];const oe=this.proxyToSource[$.tileID.key][s.id];k.has(oe)||k.add(oe),x.push(J),I=!0}}if(this._sourceTilesOverlap[s.id]=I,I&&this._debugParams.sortTilesHiZFirst)for(const j of k)j.sort((U,$)=>$.overscaledZ-U.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,g){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],E=this.proxyCoords,I=s.getSource(),k=I.tileID;if(!k)return;const j=new i.P(k.x,k.y)._div(1<<k.z),U=I.coordinates.map(i.ac.fromLngLat).reduce((Q,J)=>(Q.min.x=Math.min(Q.min.x,J.x-j.x),Q.min.y=Math.min(Q.min.y,J.y-j.y),Q.max.x=Math.max(Q.max.x,J.x-j.x),Q.max.y=Math.max(Q.max.y,J.y-j.y),Q),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(Q,J)=>{const oe=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),pe=Q.canonical.y/(1<<Q.canonical.z),ce=i.ai/(1<<Q.canonical.z),me=J.wrap+J.canonical.x/(1<<J.canonical.z),ve=J.canonical.y/(1<<J.canonical.z);return oe+ce<me+U.min.x||oe>me+U.max.x||pe+ce<ve+U.min.y||pe>ve+U.max.y};for(let Q=0;Q<E.length;Q++){const J=E[Q];for(let oe=0;oe<c.length;oe++){const pe=s.getTile(c[oe]);if(!pe||!pe.hasData()||$(J,pe.tileID))continue;const ce=this._createProxiedId(J,pe,g[J.key]&&g[J.key][s.id]),me=this.proxyToSource[J.key][s.id];me?me.push(ce):this.proxyToSource[J.key][s.id]=[ce],x.push(ce)}}}_createProxiedId(s,c,g){let x=this.orthoMatrix;if(g){const E=g.find(I=>I.key===c.tileID.key);if(E)return E}if(c.tileID.key!==s.key){const E=s.canonical.z-c.tileID.canonical.z;let I,k,j;x=i.ad.mat4.create();const U=c.tileID.wrap-s.wrap<<s.overscaledZ;E>0?(I=i.ai>>E,k=I*((c.tileID.canonical.x<<E)-s.canonical.x+U),j=I*((c.tileID.canonical.y<<E)-s.canonical.y)):(I=i.ai<<-E,k=i.ai*(c.tileID.canonical.x-(s.canonical.x+U<<-E)),j=i.ai*(c.tileID.canonical.y-(s.canonical.y<<-E))),i.ad.mat4.ortho(x,0,I,0,I,0,1),i.ad.mat4.translate(x,x,[k,j,0])}return new qu(c.tileID,s.key,x)}_findTileCoveringTileID(s,c){let g=c.getTile(s);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[c.id],E=x[s.key];if(g=E?c.getTileByID(E):null,g&&g.hasData()||E===null)return g;let I=g?g.tileID:s,k=I.overscaledZ;const j=c.getSource().minzoom,U=[];if(!E){const Q=c.getSource().maxzoom;if(s.canonical.z>=Q){const J=s.canonical.z-Q;c.getSource().reparseOverscaled?(k=Math.max(s.canonical.z+2,c.transform.tileZoom),I=new i.aH(k,s.wrap,Q,s.canonical.x>>J,s.canonical.y>>J)):J!==0&&(k=Q,I=new i.aH(k,s.wrap,Q,s.canonical.x>>J,s.canonical.y>>J))}I.key!==s.key&&(U.push(I.key),g=c.getTile(I))}const $=Q=>{U.forEach(J=>{x[J]=Q}),U.length=0};for(k-=1;k>=j&&(!g||!g.hasData());k--){g&&$(g.tileID.key);const Q=I.calculateScaledKey(k);if(g=c.getTileByID(Q),g&&g.hasData())break;const J=x[Q];if(J===null)break;J===void 0?U.push(Q):g=c.getTileByID(J)}return $(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[c.key]=!0}}function la(_,s,c){const g=function(k,j,U){const $=i.ad.vec3.dot(j,k),Q=i.ad.vec3.dot(U,[.2126,.7152,.0722]),J=(pe,ce,me)=>(1-me)*pe+me*ce,oe=J(1-.3*Math.min(Q,1),1,Math.min($+1,1));return J(.92,1,Math.asin(i.ay(j[2],-1,1))/Math.PI+.5)*oe}(_,[0,0,1],s),x=[0,0,0];i.ad.vec3.scale(x,c.slice(0,3),g);const E=[0,0,0];i.ad.vec3.scale(E,s.slice(0,3),_[2]);const I=[0,0,0];return i.ad.vec3.add(I,x,E),i.cg(I)}const bh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ov=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ly{static cacheKey(s,c,g,x){let E=`${c}${x?x.cacheKey:""}`;for(const I of g)s.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(s,c,g,x,E,I){const k=s.gl;this.program=k.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...I];const j=x?x.getBinderAttributes():[],U=(g.staticAttributes||[]).concat(j);let $=x?x.defines():[];$=$.concat(I.map(me=>`#define ${me}`));const Q=`#version 300 es
`;let J=Q+$.concat("precision mediump float;",tm,Cg.fragmentSource).join(`
`);for(const me of g.fragmentIncludes)J+=`
${mh[me]}`;J+=`
${g.fragmentSource}`;let oe=Q+$.concat("precision highp float;",tm,Cg.vertexSource).join(`
`);for(const me of g.vertexIncludes)oe+=`
${mh[me]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&g.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(oe+=`
uniform int u_instanceID;
`),oe+=`
${g.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(oe=oe.replaceAll("gl_InstanceID","u_instanceID"));const pe=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(pe,J),k.compileShader(pe),k.attachShader(this.program,pe);const ce=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(ce,oe),k.compileShader(ce),k.attachShader(this.program,ce),this.attributes={},this.numAttributes=U.length;for(let me=0;me<this.numAttributes;me++)if(U[me]){const ve=U[me].startsWith("a_")?U[me]:`a_${U[me]}`;k.bindAttribLocation(this.program,me,ve),this.attributes[ve]=me}k.linkProgram(this.program),k.deleteShader(ce),k.deleteShader(pe),this.fixedUniforms=E(s),this.binderUniforms=x?x.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(me=>({u_instanceID:new i.bN(me)}))(s)),(I.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(me=>({u_dem:new i.bN(me),u_dem_prev:new i.bN(me),u_dem_tl:new i.bK(me),u_dem_scale:new i.bM(me),u_dem_tl_prev:new i.bK(me),u_dem_scale_prev:new i.bM(me),u_dem_size:new i.bM(me),u_dem_lerp:new i.bM(me),u_exaggeration:new i.bM(me),u_depth:new i.bN(me),u_depth_size_inv:new i.bK(me),u_depth_range_unpack:new i.bK(me),u_occluder_half_size:new i.bM(me),u_occlusion_depth_offset:new i.bM(me),u_meter_to_dem:new i.bM(me),u_label_plane_matrix_inv:new i.bJ(me)}))(s)),I.includes("GLOBE")&&(this.globeUniforms=(me=>({u_tile_tl_up:new i.bL(me),u_tile_tr_up:new i.bL(me),u_tile_br_up:new i.bL(me),u_tile_bl_up:new i.bL(me),u_tile_up_scale:new i.bM(me)}))(s)),I.includes("FOG")&&(this.fogUniforms=(me=>({u_fog_matrix:new i.bJ(me),u_fog_range:new i.bK(me),u_fog_color:new i.cb(me),u_fog_horizon_blend:new i.bM(me),u_fog_vertical_limit:new i.bK(me),u_fog_temporal_offset:new i.bM(me),u_frustum_tl:new i.bL(me),u_frustum_tr:new i.bL(me),u_frustum_br:new i.bL(me),u_frustum_bl:new i.bL(me),u_globe_pos:new i.bL(me),u_globe_radius:new i.bM(me),u_globe_transition:new i.bM(me),u_is_globe:new i.bN(me),u_viewport:new i.bK(me)}))(s)),I.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(me=>({u_cutoff_params:new i.cb(me)}))(s)),I.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(me=>({u_lighting_ambient_color:new i.bL(me),u_lighting_directional_dir:new i.bL(me),u_lighting_directional_color:new i.bL(me),u_ground_radiance:new i.bL(me)}))(s)),I.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(me=>({u_light_matrix_0:new i.bJ(me),u_light_matrix_1:new i.bJ(me),u_fade_range:new i.bK(me),u_shadow_normal_offset:new i.bL(me),u_shadow_intensity:new i.bM(me),u_shadow_texel_size:new i.bM(me),u_shadow_map_resolution:new i.bM(me),u_shadow_direction:new i.bL(me),u_shadow_bias:new i.bL(me),u_shadowmap_0:new i.bN(me),u_shadowmap_1:new i.bN(me)}))(s))}}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)g[x]&&g[x].set(this.program,x,c[x])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)g[x]&&g[x].set(this.program,x,c[x])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)g[x].set(this.program,x,c[x])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)g[x].set(this.program,x,c[x])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)g[x].set(this.program,x,c[x])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;s.program.set(this.program);for(const x in c)g[x].set(this.program,x,c[x])}_drawDebugWireframe(s,c,g,x,E,I,k,j,U,$){const Q=s.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const J=s.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||s._terrain&&s._terrain.renderingToTexture||!bh.includes(this.name))||!(!Q.layers3D||!Ov.includes(this.name))))return;const oe=J.gl,pe=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,E,J);if(!pe)return;const ce=[...this.fixedDefines];ce.push("DEBUG_WIREFRAME");const me=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ce});J.program.set(me.program);const ve=(Ie,Be,Oe)=>{if(Be[Ie]&&Oe[Ie])for(const Ne in Be[Ie])Oe[Ie][Ne]&&Oe[Ie][Ne].set(Oe.program,Ne,Be[Ie][Ne].current)};U&&U.setUniforms(me.program,J,me.binderUniforms,k,{zoom:j}),ve("fixedUniforms",this,me),ve("terrainUniforms",this,me),ve("globeUniforms",this,me),ve("fogUniforms",this,me),ve("lightsUniforms",this,me),ve("shadowUniforms",this,me),pe.bind(),J.setColorMode(new pr([oe.ONE,oe.ONE_MINUS_SRC_ALPHA,oe.ZERO,oe.ONE],i.al.transparent,[!0,!0,!0,!1])),J.setDepthMode(new En(c.func===oe.LESS?oe.LEQUAL:c.func,En.ReadOnly,c.range)),J.setStencilMode(Vn.disabled);const Ee=3*I.primitiveLength*2,Pe=3*I.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ie=$||1;for(let Be=0;Be<Ie;++Be)me.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),oe.drawElements(oe.LINES,Ee,oe.UNSIGNED_SHORT,Pe)}else $&&$>1?oe.drawElementsInstanced(oe.LINES,Ee,oe.UNSIGNED_SHORT,Pe,$):oe.drawElements(oe.LINES,Ee,oe.UNSIGNED_SHORT,Pe);E.bind(),J.program.set(this.program),J.setDepthMode(c),J.setStencilMode(g),J.setColorMode(x)}checkUniforms(s,c,g){if(this.fixedDefines.includes(c)){for(const x of Object.keys(g))if(!g[x].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${x} not set but required by ${c} being defined`)}}draw(s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me){const ve=s.context,Ee=ve.gl;if(this.failedToCreate)return;ve.program.set(this.program),ve.setDepthMode(g),ve.setStencilMode(x),ve.setColorMode(E),ve.setCullFace(I);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,k[Be]);pe&&pe.setUniforms(this.program,ve,this.binderUniforms,J,{zoom:oe});const Pe={[Ee.POINTS]:1,[Ee.LINES]:2,[Ee.TRIANGLES]:3,[Ee.LINE_STRIP]:1}[c];this.checkUniforms(j,"RENDER_SHADOWS",this.shadowUniforms);const Ie=me&&me>0?1:void 0;for(const Be of Q.get()){const Oe=Be.vaos||(Be.vaos={});if((Oe[j]||(Oe[j]=new Tg)).bind(ve,this,U,pe?pe.getPaintVertexBuffers():[],$,Be.vertexOffset,ce||[],Ie),this.forceManualRenderingForInstanceIDShaders){const Ne=me||1;for(let ze=0;ze<Ne;++ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ze),$?Ee.drawElements(c,Be.primitiveLength*Pe,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Pe*2):Ee.drawArrays(c,Be.vertexOffset,Be.vertexLength)}else me&&me>1?Ee.drawElementsInstanced(c,Be.primitiveLength*Pe,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Pe*2,me):$?Ee.drawElements(c,Be.primitiveLength*Pe,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Pe*2):Ee.drawArrays(c,Be.vertexOffset,Be.vertexLength);c===Ee.TRIANGLES&&$&&this._drawDebugWireframe(s,g,x,E,$,Be,J,oe,pe,me)}}}function Hf(_,s){const c=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,_.transform.tileZoom)/c,x=g*(s.tileID.canonical.x+s.tileID.wrap*c),E=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(s,1,_.transform.tileZoom),u_pixel_coord_upper:[x>>16,E>>16],u_pixel_coord_lower:[65535&x,65535&E]}}const cm={terrain:0,flat:1},su=i.ad.mat4.create(),Id=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve)=>{const Ee=s.style.light,Pe=Ee.properties.get("position"),Ie=[Pe.x,Pe.y,Pe.z],Be=i.ad.mat3.create();Ee.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(Be,-s.transform.angle),i.ad.vec3.transformMat3(Ie,Ie,Be));const Oe=Ee.properties.get("color"),Ne=s.transform,ze={u_matrix:_,u_lightpos:Ie,u_lightintensity:Ee.properties.get("intensity"),u_lightcolor:[Oe.r,Oe.g,Oe.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:su,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:cm[U],u_base_type:cm[$],u_ao:x,u_edge_radius:E,u_width_scale:I,u_flood_light_color:pe,u_vertical_scale:ce,u_flood_light_intensity:me,u_ground_shadow_factor:ve};return Ne.projection.name==="globe"&&(ze.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ze.u_zoom_transition=Q,ze.u_inv_rot_matrix=oe,ze.u_merc_center=J,ze.u_up_dir=Ne.projection.upVector(new i.bT(0,0,0),J[0]*i.ai,J[1]*i.ai),ze.u_height_lift=j),ze},wh=(_,s,c,g,x,E)=>({u_matrix:_,u_edge_radius:s,u_width_scale:c,u_vertical_scale:g,u_height_type:cm[x],u_base_type:cm[E]}),Rg=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me)=>{const ve=Id(_,s,c,g,x,E,I,k,U,$,Q,J,oe,pe,ce,me,1,[0,0,0]),Ee={u_height_factor:-Math.pow(2,k.overscaledZ)/j.tileSize/8};return i.l(ve,Hf(s,j),Ee)},Wf=(_,s)=>({u_matrix:_,u_emissive_strength:s}),Hu=(_,s,c,g)=>i.l(Wf(_,s),Hf(c,g)),Ic=(_,s,c)=>({u_matrix:_,u_world:c,u_emissive_strength:s}),Mc=(_,s,c,g,x)=>i.l(Hu(_,s,c,g),{u_world:x}),Sh=(_,s,c,g,x)=>({u_matrix:_,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:c,u_height_scale:g,u_reset_depth:x}),hm=(_,s,c,g)=>{const x=i.ai/c.tileSize;return{u_matrix:_,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/x,s.pixelsToGLUnits[1]/x]}},al=(_,s,c=1)=>({u_matrix:_,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),Is=i.ad.mat4.create(),Wu=(_,s,c,g,x,E,I)=>{const k=_.transform,j=k.projection.name==="globe",U=j?i.cO(k.zoom,s.canonical)*k._pixelsPerMercatorPixel:i.at(c,1,E),$={u_matrix:s.projMatrix,u_extrude_scale:U,u_intensity:I,u_inv_rot_matrix:Is,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){$.u_inv_rot_matrix=g,$.u_merc_center=x,$.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],$.u_zoom_transition=i.ag(k.zoom);const Q=x[0]*i.ai,J=x[1]*i.ai;$.u_up_dir=k.projection.upVector(new i.bT(0,0,0),Q,J)}return $};function on(_,[s,c,g,x],[E,I]){if(E===I)return[0,0,0,0];const k=255*(_-1)/(_*(I-E));return[s*k,c*k,g*k,x*k]}function au(_,s,[c,g]){return c===g?0:.5/_+(s-c)*(_-1)/(_*(g-c))}const Pc=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee,Pe,Ie)=>({u_matrix:_,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:E,u_scale_parent:U,u_fade_t:$.mix,u_opacity:$.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(Q.paint.get("raster-saturation")),u_contrast_factor:i.cQ(Q.paint.get("raster-contrast")),u_spin_weights:Ac(Q.paint.get("raster-hue-rotate")),u_perspective_transform:J,u_raster_elevation:oe,u_zoom_transition:I,u_merc_center:k,u_cutoff_params:j,u_colorization_mix:on(i.cR,ce,ve),u_colorization_offset:au(i.cR,me,ve),u_color_ramp:pe,u_texture_offset:[Pe/(Ee+2*Pe),Ee/(Ee+2*Pe)],u_texture_res:[Ee+2*Pe,Ee+2*Pe],u_emissive_strength:Ie});function Ac(_){_*=Math.PI/180;const s=Math.sin(_),c=Math.cos(_);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const ua=.05,Cn=(_,s,c,g,x,E,I,k,j,U,$,Q)=>({u_matrix:_,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:E,u_scale_parent:U,u_fade_t:$.mix,u_opacity:$.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:I,u_merc_center:k,u_cutoff_params:j}),ca=(_,s,c,g,x,E,I,k,j,U)=>({u_particle_texture:_,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:g,u_color_ramp:E,u_velocity_res:x,u_max_speed:I,u_uv_offset:k,u_data_scale:[255*j[0],255*j[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[ua,ua]}),ll=(_,s,c,g,x,E,I,k,j,U)=>({u_particle_texture:_,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:g,u_max_speed:x,u_speed_factor:E,u_reset_rate:I,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*j[0],255*j[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[ua,ua]}),lo=i.ad.mat4.create(),Na=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee,Pe,Ie,Be)=>{const Oe=x.transform,Ne={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Oe.getCameraToCenterDistance(Ee),u_rotate_symbol:+c,u_aspect_ratio:Oe.width/Oe.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:k,u_is_text:+U,u_elevation_from_sea:j?1:0,u_pitch_with_map:+g,u_texsize:$,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lo,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Ie||0,u_gamma_scale:g?x.transform.getCameraToCenterDistance(Ee)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Be||1};return Ee.name==="globe"&&(Ne.u_tile_id=[oe.canonical.x,oe.canonical.y,1<<oe.canonical.z],Ne.u_zoom_transition=pe,Ne.u_inv_rot_matrix=me,Ne.u_merc_center=ce,Ne.u_camera_forward=Oe._camera.forward(),Ne.u_ecef_origin=i.cS(Oe.globeMatrix,oe.toUnwrapped()),Ne.u_tile_matrix=Float32Array.from(Oe.globeMatrix),Ne.u_up_vector=ve),Ne},Lg=(_,s,c,g)=>({u_matrix:_,u_emissive_strength:s,u_opacity:c,u_color:g}),uy=(_,s,c,g,x,E,I,k,j)=>i.l(function(U,$,Q,J,oe,pe){const{width:ce,height:me}=J.imageManager.getPixelSize($),ve=Math.pow(2,pe.tileID.overscaledZ),Ee=pe.tileSize*Math.pow(2,J.transform.tileZoom)/ve,Pe=Ee*(pe.tileID.canonical.x+pe.tileID.wrap*ve),Ie=Ee*pe.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[ce,me],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:oe?[J.transform.width,-1*J.transform.height]:[1/i.at(pe,1,J.transform.tileZoom),1/i.at(pe,1,J.transform.tileZoom)],u_pixel_coord_upper:[Pe>>16,Ie>>16],u_pixel_coord_lower:[65535&Pe,65535&Ie]}}(0,E,I,g,k,j),{u_matrix:_,u_emissive_strength:s,u_opacity:c}),Xf=new Float32Array(i.ad.mat4.identity([])),dm=(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe=[0,0,0],pe)=>{const ce=x.style.light,me=ce.properties.get("position"),ve=[-me.x,-me.y,me.z],Ee=i.ad.mat3.create();ce.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(Ee,-x.transform.angle),i.ad.vec3.transformMat3(ve,ve,Ee));const Pe=$.alphaMode==="MASK",Ie=ce.properties.get("color").toRenderColor(null),Be=J.paint.get("model-ambient-occlusion-intensity"),Oe=J.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),Ne=J.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:_,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:g||Xf,u_lightpos:ve,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_camera_pos:oe,u_opacity:E,u_baseTextureIsAlpha:0,u_alphaMask:+Pe,u_alphaCutoff:$.alphaCutoff,u_baseColorFactor:[I.r,I.g,I.b,I.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:j,u_roughnessFactor:U,u_baseColorTexture:Hi.BaseColor,u_metallicRoughnessTexture:Hi.MetallicRoughness,u_normalTexture:Hi.Normal,u_occlusionTexture:Hi.Occlusion,u_emissionTexture:Hi.Emission,u_lutTexture:Hi.LUT,u_color_mix:[Oe.r,Oe.g,Oe.b,Ne],u_aoIntensity:Be,u_emissive_strength:Q,u_occlusionTextureTransform:pe||[0,0,0,0]}},cy=(_,s=Xf,c=Xf)=>({u_matrix:_,u_instance:s,u_node_matrix:c}),Zf={fillExtrusion:_=>({u_matrix:new i.bJ(_),u_lightpos:new i.bL(_),u_lightintensity:new i.bM(_),u_lightcolor:new i.bL(_),u_vertical_gradient:new i.bM(_),u_opacity:new i.bM(_),u_edge_radius:new i.bM(_),u_width_scale:new i.bM(_),u_ao:new i.bK(_),u_height_type:new i.bN(_),u_base_type:new i.bN(_),u_tile_id:new i.bL(_),u_zoom_transition:new i.bM(_),u_inv_rot_matrix:new i.bJ(_),u_merc_center:new i.bK(_),u_up_dir:new i.bL(_),u_height_lift:new i.bM(_),u_flood_light_color:new i.bL(_),u_vertical_scale:new i.bM(_),u_flood_light_intensity:new i.bM(_),u_ground_shadow_factor:new i.bL(_)}),fillExtrusionDepth:_=>({u_matrix:new i.bJ(_),u_edge_radius:new i.bM(_),u_width_scale:new i.bM(_),u_vertical_scale:new i.bM(_),u_height_type:new i.bN(_),u_base_type:new i.bN(_)}),fillExtrusionPattern:_=>({u_matrix:new i.bJ(_),u_lightpos:new i.bL(_),u_lightintensity:new i.bM(_),u_lightcolor:new i.bL(_),u_vertical_gradient:new i.bM(_),u_height_factor:new i.bM(_),u_edge_radius:new i.bM(_),u_width_scale:new i.bM(_),u_ao:new i.bK(_),u_height_type:new i.bN(_),u_base_type:new i.bN(_),u_tile_id:new i.bL(_),u_zoom_transition:new i.bM(_),u_inv_rot_matrix:new i.bJ(_),u_merc_center:new i.bK(_),u_up_dir:new i.bL(_),u_height_lift:new i.bM(_),u_image:new i.bN(_),u_texsize:new i.bK(_),u_pixel_coord_upper:new i.bK(_),u_pixel_coord_lower:new i.bK(_),u_tile_units_to_pixels:new i.bM(_),u_opacity:new i.bM(_)}),fillExtrusionGroundEffect:_=>({u_matrix:new i.bJ(_),u_opacity:new i.bM(_),u_ao_pass:new i.bM(_),u_meter_to_tile:new i.bM(_),u_ao:new i.bK(_),u_flood_light_intensity:new i.bM(_),u_flood_light_color:new i.bL(_),u_attenuation:new i.bM(_),u_edge_radius:new i.bM(_),u_fb:new i.bN(_),u_fb_size:new i.bM(_),u_dynamic_offset:new i.bM(_)}),fill:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_)}),fillPattern:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_),u_image:new i.bN(_),u_texsize:new i.bK(_),u_pixel_coord_upper:new i.bK(_),u_pixel_coord_lower:new i.bK(_),u_tile_units_to_pixels:new i.bM(_)}),fillOutline:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_),u_world:new i.bK(_)}),fillOutlinePattern:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_),u_world:new i.bK(_),u_image:new i.bN(_),u_texsize:new i.bK(_),u_pixel_coord_upper:new i.bK(_),u_pixel_coord_lower:new i.bK(_),u_tile_units_to_pixels:new i.bM(_)}),elevatedStructures:_=>({u_matrix:new i.bJ(_)}),elevatedStructuresDepthReconstruct:_=>({u_matrix:new i.bJ(_),u_camera_pos:new i.bL(_),u_depth_bias:new i.bM(_),u_height_scale:new i.bM(_),u_reset_depth:new i.bM(_)}),circle:i.cT,collisionBox:_=>({u_matrix:new i.bJ(_),u_camera_to_center_distance:new i.bM(_),u_extrude_scale:new i.bK(_)}),collisionCircle:_=>({u_matrix:new i.bJ(_),u_inv_matrix:new i.bJ(_),u_camera_to_center_distance:new i.bM(_),u_viewport_size:new i.bK(_)}),debug:_=>({u_color:new i.cA(_),u_matrix:new i.bJ(_),u_overlay:new i.bN(_),u_overlay_scale:new i.bM(_)}),clippingMask:_=>({u_matrix:new i.bJ(_)}),heatmap:_=>({u_extrude_scale:new i.bM(_),u_intensity:new i.bM(_),u_matrix:new i.bJ(_),u_inv_rot_matrix:new i.bJ(_),u_merc_center:new i.bK(_),u_tile_id:new i.bL(_),u_zoom_transition:new i.bM(_),u_up_dir:new i.bL(_)}),heatmapTexture:_=>({u_image:new i.bN(_),u_color_ramp:new i.bN(_),u_opacity:new i.bM(_)}),hillshade:_=>({u_matrix:new i.bJ(_),u_image:new i.bN(_),u_latrange:new i.bK(_),u_light:new i.bK(_),u_shadow:new i.cA(_),u_highlight:new i.cA(_),u_emissive_strength:new i.bM(_),u_accent:new i.cA(_)}),hillshadePrepare:_=>({u_matrix:new i.bJ(_),u_image:new i.bN(_),u_dimension:new i.bK(_),u_zoom:new i.bM(_)}),line:i.cU,linePattern:i.cV,raster:_=>({u_matrix:new i.bJ(_),u_normalize_matrix:new i.bJ(_),u_globe_matrix:new i.bJ(_),u_merc_matrix:new i.bJ(_),u_grid_matrix:new i.cB(_),u_tl_parent:new i.bK(_),u_scale_parent:new i.bM(_),u_fade_t:new i.bM(_),u_opacity:new i.bM(_),u_image0:new i.bN(_),u_image1:new i.bN(_),u_brightness_low:new i.bM(_),u_brightness_high:new i.bM(_),u_saturation_factor:new i.bM(_),u_contrast_factor:new i.bM(_),u_spin_weights:new i.bL(_),u_perspective_transform:new i.bK(_),u_raster_elevation:new i.bM(_),u_zoom_transition:new i.bM(_),u_merc_center:new i.bK(_),u_cutoff_params:new i.cb(_),u_colorization_mix:new i.cb(_),u_colorization_offset:new i.bM(_),u_color_ramp:new i.bN(_),u_texture_offset:new i.bK(_),u_texture_res:new i.bK(_),u_emissive_strength:new i.bM(_)}),rasterParticle:_=>({u_matrix:new i.bJ(_),u_normalize_matrix:new i.bJ(_),u_globe_matrix:new i.bJ(_),u_merc_matrix:new i.bJ(_),u_grid_matrix:new i.cB(_),u_tl_parent:new i.bK(_),u_scale_parent:new i.bM(_),u_fade_t:new i.bM(_),u_opacity:new i.bM(_),u_image0:new i.bN(_),u_image1:new i.bN(_),u_raster_elevation:new i.bM(_),u_zoom_transition:new i.bM(_),u_merc_center:new i.bK(_),u_cutoff_params:new i.cb(_)}),rasterParticleTexture:_=>({u_texture:new i.bN(_),u_opacity:new i.bM(_)}),rasterParticleDraw:_=>({u_particle_texture:new i.bN(_),u_particle_texture_side_len:new i.bM(_),u_tile_offset:new i.bK(_),u_velocity:new i.bN(_),u_color_ramp:new i.bN(_),u_velocity_res:new i.bK(_),u_max_speed:new i.bM(_),u_uv_offset:new i.bK(_),u_data_scale:new i.bK(_),u_data_offset:new i.bM(_),u_particle_pos_scale:new i.bM(_),u_particle_pos_offset:new i.bK(_)}),rasterParticleUpdate:_=>({u_particle_texture:new i.bN(_),u_particle_texture_side_len:new i.bM(_),u_velocity:new i.bN(_),u_velocity_res:new i.bK(_),u_max_speed:new i.bM(_),u_speed_factor:new i.bM(_),u_reset_rate:new i.bM(_),u_rand_seed:new i.bM(_),u_uv_offset:new i.bK(_),u_data_scale:new i.bK(_),u_data_offset:new i.bM(_),u_particle_pos_scale:new i.bM(_),u_particle_pos_offset:new i.bK(_)}),symbol:_=>({u_is_size_zoom_constant:new i.bN(_),u_is_size_feature_constant:new i.bN(_),u_size_t:new i.bM(_),u_size:new i.bM(_),u_camera_to_center_distance:new i.bM(_),u_rotate_symbol:new i.bN(_),u_aspect_ratio:new i.bM(_),u_fade_change:new i.bM(_),u_matrix:new i.bJ(_),u_label_plane_matrix:new i.bJ(_),u_coord_matrix:new i.bJ(_),u_is_text:new i.bN(_),u_elevation_from_sea:new i.bN(_),u_pitch_with_map:new i.bN(_),u_texsize:new i.bK(_),u_texsize_icon:new i.bK(_),u_texture:new i.bN(_),u_texture_icon:new i.bN(_),u_gamma_scale:new i.bM(_),u_device_pixel_ratio:new i.bM(_),u_tile_id:new i.bL(_),u_zoom_transition:new i.bM(_),u_inv_rot_matrix:new i.bJ(_),u_merc_center:new i.bK(_),u_camera_forward:new i.bL(_),u_tile_matrix:new i.bJ(_),u_up_vector:new i.bL(_),u_ecef_origin:new i.bL(_),u_is_halo:new i.bN(_),u_icon_transition:new i.bM(_),u_color_adj_mat:new i.bJ(_),u_scale_factor:new i.bM(_)}),background:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_),u_opacity:new i.bM(_),u_color:new i.cA(_)}),backgroundPattern:_=>({u_matrix:new i.bJ(_),u_emissive_strength:new i.bM(_),u_opacity:new i.bM(_),u_image:new i.bN(_),u_pattern_tl:new i.bK(_),u_pattern_br:new i.bK(_),u_texsize:new i.bK(_),u_pattern_size:new i.bK(_),u_pixel_coord_upper:new i.bK(_),u_pixel_coord_lower:new i.bK(_),u_pattern_units_to_pixels:new i.bK(_)}),terrainRaster:_=>({u_matrix:new i.bJ(_),u_image0:new i.bN(_),u_skirt_height:new i.bM(_),u_ground_shadow_factor:new i.bL(_)}),skybox:_=>({u_matrix:new i.bJ(_),u_sun_direction:new i.bL(_),u_cubemap:new i.bN(_),u_opacity:new i.bM(_),u_temporal_offset:new i.bM(_)}),skyboxGradient:_=>({u_matrix:new i.bJ(_),u_color_ramp:new i.bN(_),u_center_direction:new i.bL(_),u_radius:new i.bM(_),u_opacity:new i.bM(_),u_temporal_offset:new i.bM(_)}),skyboxCapture:_=>({u_matrix_3f:new i.cB(_),u_sun_direction:new i.bL(_),u_sun_intensity:new i.bM(_),u_color_tint_r:new i.cb(_),u_color_tint_m:new i.cb(_),u_luminance:new i.bM(_)}),globeRaster:_=>({u_proj_matrix:new i.bJ(_),u_globe_matrix:new i.bJ(_),u_normalize_matrix:new i.bJ(_),u_merc_matrix:new i.bJ(_),u_zoom_transition:new i.bM(_),u_merc_center:new i.bK(_),u_image0:new i.bN(_),u_grid_matrix:new i.cB(_),u_skirt_height:new i.bM(_),u_far_z_cutoff:new i.bM(_),u_frustum_tl:new i.bL(_),u_frustum_tr:new i.bL(_),u_frustum_br:new i.bL(_),u_frustum_bl:new i.bL(_),u_globe_pos:new i.bL(_),u_globe_radius:new i.bM(_),u_viewport:new i.bK(_)}),globeAtmosphere:_=>({u_frustum_tl:new i.bL(_),u_frustum_tr:new i.bL(_),u_frustum_br:new i.bL(_),u_frustum_bl:new i.bL(_),u_horizon:new i.bM(_),u_transition:new i.bM(_),u_fadeout_range:new i.bM(_),u_color:new i.cb(_),u_high_color:new i.cb(_),u_space_color:new i.cb(_),u_temporal_offset:new i.bM(_),u_horizon_angle:new i.bM(_)}),model:_=>({u_matrix:new i.bJ(_),u_lighting_matrix:new i.bJ(_),u_normal_matrix:new i.bJ(_),u_node_matrix:new i.bJ(_),u_lightpos:new i.bL(_),u_lightintensity:new i.bM(_),u_lightcolor:new i.bL(_),u_camera_pos:new i.bL(_),u_opacity:new i.bM(_),u_baseColorFactor:new i.cb(_),u_emissiveFactor:new i.cb(_),u_metallicFactor:new i.bM(_),u_roughnessFactor:new i.bM(_),u_baseTextureIsAlpha:new i.bN(_),u_alphaMask:new i.bN(_),u_alphaCutoff:new i.bM(_),u_baseColorTexture:new i.bN(_),u_metallicRoughnessTexture:new i.bN(_),u_normalTexture:new i.bN(_),u_occlusionTexture:new i.bN(_),u_emissionTexture:new i.bN(_),u_lutTexture:new i.bN(_),u_color_mix:new i.cb(_),u_aoIntensity:new i.bM(_),u_emissive_strength:new i.bM(_),u_occlusionTextureTransform:new i.cb(_)}),modelDepth:_=>({u_matrix:new i.bJ(_),u_instance:new i.bJ(_),u_node_matrix:new i.bJ(_)}),groundShadow:_=>({u_matrix:new i.bJ(_),u_ground_shadow_factor:new i.bL(_)}),stars:_=>({u_matrix:new i.bJ(_),u_up:new i.bL(_),u_right:new i.bL(_),u_intensity_multiplier:new i.bM(_)}),snowParticle:_=>({u_modelview:new i.bJ(_),u_projection:new i.bJ(_),u_time:new i.bM(_),u_cam_pos:new i.bL(_),u_velocityConeAperture:new i.bM(_),u_velocity:new i.bM(_),u_horizontalOscillationRadius:new i.bM(_),u_horizontalOscillationRate:new i.bM(_),u_boxSize:new i.bM(_),u_billboardSize:new i.bM(_),u_simpleShapeParameters:new i.bK(_),u_screenSize:new i.bK(_),u_thinningCenterPos:new i.bK(_),u_thinningShape:new i.bL(_),u_thinningAffectedRatio:new i.bM(_),u_thinningParticleOffset:new i.bM(_),u_particleColor:new i.cb(_),u_direction:new i.bL(_)}),rainParticle:_=>({u_modelview:new i.bJ(_),u_projection:new i.bJ(_),u_time:new i.bM(_),u_cam_pos:new i.bL(_),u_texScreen:new i.bN(_),u_velocityConeAperture:new i.bM(_),u_velocity:new i.bM(_),u_boxSize:new i.bM(_),u_rainDropletSize:new i.bK(_),u_distortionStrength:new i.bM(_),u_rainDirection:new i.bL(_),u_color:new i.cb(_),u_screenSize:new i.bK(_),u_thinningCenterPos:new i.bK(_),u_thinningShape:new i.bL(_),u_thinningAffectedRatio:new i.bM(_),u_thinningParticleOffset:new i.bM(_),u_shapeDirectionalPower:new i.bM(_),u_shapeNormalPower:new i.bM(_),u_mode:new i.bM(_)}),vignette:_=>({u_vignetteShape:new i.bL(_),u_vignetteColor:new i.cb(_)}),occlusion:_=>({u_matrix:new i.bJ(_),u_anchorPos:new i.bL(_),u_screenSizePx:new i.bK(_),u_occluderSizePx:new i.bK(_),u_color:new i.cb(_)})};class lu{constructor(s,c,g,x){this.id=lu.uniqueIdxCounter,lu.uniqueIdxCounter++,this.context=s;const E=s.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=lu.uniqueIdxCounter,lu.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}lu.uniqueIdxCounter=0;const Eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fm{constructor(s,c,g,x,E,I){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=I,this.context=s;const k=s.gl;this.buffer=k.createBuffer(),s.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||E||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let g=0;g<this.attributes.length;g++){const x=c.attributes[this.attributes[g].name];x!==void 0&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,c,g){for(let x=0;x<this.attributes.length;x++){const E=this.attributes[x],I=c.attributes[E.name];I!==void 0&&s.vertexAttribPointer(I,E.components,s[Eh[E.type]],!1,this.itemSize,E.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,c,g){for(let x=0;x<this.attributes.length;x++){const E=c.attributes[this.attributes[x].name];E!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(E,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ha{constructor(s,c,g,x,E){this.context=s,this.width=c,this.height=g;const I=this.framebuffer=s.gl.createFramebuffer();x&&(this.colorAttachment=new um(s,I)),E&&(this.depthAttachmentType=E,this.depthAttachment=E==="renderbuffer"?new ay(s,I):new $f(s,I))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class Ll{constructor(s,c){this.gl=s,this.clearColor=new Av(this),this.clearDepth=new Mg(this),this.clearStencil=new Wi(this),this.colorMask=new rm(this),this.depthMask=new Ff(this),this.stencilMask=new zf(this),this.stencilFunc=new ny(this),this.stencilOp=new ry(this),this.stencilTest=new Tc(this),this.depthRange=new gh(this),this.depthTest=new Ed(this),this.depthFunc=new Oa(this),this.blend=new iy(this),this.blendFunc=new Pg(this),this.blendColor=new im(this),this.blendEquation=new Bf(this),this.cullFace=new jf(this),this.cullFaceSide=new om(this),this.frontFace=new Vf(this),this.program=new sm(this),this.activeTexture=new am(this),this.viewport=new Ag(this),this.bindFramebuffer=new oy(this),this.bindRenderbuffer=new Rv(this),this.bindTexture=new Uf(this),this.bindVertexBuffer=new sy(this),this.bindElementBuffer=new _h(this),this.bindVertexArrayOES=new Lv(this),this.pixelStoreUnpack=new Gf(this),this.pixelStoreUnpackPremultiplyAlpha=new $u(this),this.pixelStoreUnpackFlipY=new lm(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,g){return new lu(this,s,c,g)}createVertexBuffer(s,c,g,x,E){return new fm(this,s,c,g,x,E)}createRenderbuffer(s,c,g){const x=this.gl,E=x.createRenderbuffer();return this.bindRenderbuffer.set(E),x.renderbufferStorage(x.RENDERBUFFER,s,c,g),this.bindRenderbuffer.set(null),E}createFramebuffer(s,c,g,x){return new ha(this,s,c,g,x)}clear({color:s,depth:c,stencil:g,colorMask:x}){const E=this.gl;let I=0;s&&(I|=E.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(I|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),g!==void 0&&(I|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),E.clear(I)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){i.bn(s.blendFunction,pr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ch;function pm(_,s,c,g,x,E,I){const k=_.context,j=k.gl,U=_.transform,$=_.getOrCreateProgram("collisionBox"),Q=[];let J=0,oe=0;for(let Ie=0;Ie<g.length;Ie++){const Be=g[Ie],Oe=s.getTile(Be),Ne=Oe.getBucket(c);if(!Ne)continue;const ze=K_(Be,Ne,U);let Ue=ze;x[0]===0&&x[1]===0||(Ue=_.translatePosMatrix(ze,Oe,x,E));const Ye=I?Ne.textCollisionBox:Ne.iconCollisionBox,vt=Ne.collisionCircleArray;if(vt.length>0){const ct=i.ad.mat4.create(),Pt=Ue;i.ad.mat4.mul(ct,Ne.placementInvProjMatrix,U.glCoordMatrix),i.ad.mat4.mul(ct,ct,Ne.placementViewportMatrix),Q.push({circleArray:vt,circleOffset:oe,transform:Pt,invTransform:ct,projection:Ne.getProjection()}),J+=vt.length/4,oe=J}Ye&&(_.terrain&&_.terrain.setupElevationDraw(Oe,$),$.draw(_,j.LINES,En.disabled,Vn.disabled,_.colorModeForRenderPass(),Fn.disabled,hm(Ue,U,Oe,Ne.getProjection()),c.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,null,U.zoom,null,[Ye.collisionVertexBuffer,Ye.collisionVertexBufferExt]))}if(!I||!Q.length)return;const pe=_.getOrCreateProgram("collisionCircle"),ce=new i.cW;ce.resize(4*J),ce._trim();let me=0;for(const Ie of Q)for(let Be=0;Be<Ie.circleArray.length/4;Be++){const Oe=4*Be,Ne=Ie.circleArray[Oe+0],ze=Ie.circleArray[Oe+1],Ue=Ie.circleArray[Oe+2],Ye=Ie.circleArray[Oe+3];ce.emplace(me++,Ne,ze,Ue,Ye,0),ce.emplace(me++,Ne,ze,Ue,Ye,1),ce.emplace(me++,Ne,ze,Ue,Ye,2),ce.emplace(me++,Ne,ze,Ue,Ye,3)}(!Ch||Ch.length<2*J)&&(Ch=function(Ie){const Be=2*Ie,Oe=new i.aV;Oe.resize(Be),Oe._trim();for(let Ne=0;Ne<Be;Ne++){const ze=6*Ne;Oe.uint16[ze+0]=4*Ne+0,Oe.uint16[ze+1]=4*Ne+1,Oe.uint16[ze+2]=4*Ne+2,Oe.uint16[ze+3]=4*Ne+2,Oe.uint16[ze+4]=4*Ne+3,Oe.uint16[ze+5]=4*Ne+0}return Oe}(J));const ve=k.createIndexBuffer(Ch,!0),Ee=k.createVertexBuffer(ce,i.cX.members,!0);for(const Ie of Q){const Be={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(Pe=U).getCameraToCenterDistance(Ie.projection),u_viewport_size:[Pe.width,Pe.height]};pe.draw(_,j.TRIANGLES,En.disabled,Vn.disabled,_.colorModeForRenderPass(),Fn.disabled,Be,c.id,Ee,ve,i.b8.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,U.zoom)}var Pe;Ee.destroy(),ve.destroy()}const Md=i.ad.mat4.create();function Rc(_){const s=_._camera.getWorldToCamera(_.worldSize,1),c=i.ad.mat4.multiply([],s,_.globeMatrix);i.ad.mat4.invert(c,c);const g=[0,0,0],x=[0,1,0,0];return i.ad.vec4.transformMat4(x,x,c),g[0]=x[0],g[1]=x[1],g[2]=x[2],i.ad.vec3.normalize(g,g),g}function hy({width:_,height:s,anchor:c,textOffset:g,textScale:x},E){const{horizontalAlign:I,verticalAlign:k}=i.bD(c),j=-(I-.5)*_,U=-(k-.5)*s,$=i.bC(c,g);return new i.P((j/x+$[0])*E,(U/x+$[1])*E)}function da(_,s,c,g,x,E,I,k,j,U,$){const Q=_.text.placedSymbolArray,J=_.text.dynamicLayoutVertexArray,oe=_.icon.dynamicLayoutVertexArray,pe={},ce=_.getProjection(),me=aa(k,ce,E),ve=E.elevation,Ee=ce.upVectorScale(k.canonical,E.center.lat,E.worldSize).metersToTile;J.clear();for(let Pe=0;Pe<Q.length;Pe++){const Ie=Q.get(Pe),{tileAnchorX:Be,tileAnchorY:Oe,numGlyphs:Ne}=Ie,ze=Ie.hidden||!Ie.crossTileID||_.allowVerticalPlacement&&!Ie.placedOrientation?null:g[Ie.crossTileID];if(ze){let Ue=0,Ye=0,vt=0;if(ve){const St=ve?ve.getAtTileOffset(k,Be,Oe):0,[Rt,xt,Lt]=ce.upVector(k.canonical,Be,Oe);Ue=St*Rt*Ee,Ye=St*xt*Ee,vt=St*Lt*Ee}let[ct,Pt,At,jt]=rl(Ie.projectedAnchorX+Ue,Ie.projectedAnchorY+Ye,Ie.projectedAnchorZ+vt,c?me:I);const ut=wc(E.getCameraToCenterDistance(ce),jt);let It=x.evaluateSizeForFeature(_.textSizeData,U,Ie)*ut/i.bw;c&&(It*=_.tilePixelRatio/j);const nt=hy(ze,It);c?({x:ct,y:Pt,z:At}=ce.projectTilePoint(Be+nt.x,Oe+nt.y,k.canonical),[ct,Pt,At]=rl(ct+Ue,Pt+Ye,At+vt,I)):(s&&nt._rotate(-E.angle),ct+=nt.x,Pt+=nt.y,At=0);const Mt=_.allowVerticalPlacement&&Ie.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let St=0;St<Ne;St++)i.bt(J,ct,Pt,At,Mt);$&&Ie.associatedIconIndex>=0&&(pe[Ie.associatedIconIndex]={x:ct,y:Pt,z:At,angle:Mt})}else Tl(Ne,J)}if($){oe.clear();const Pe=_.icon.placedSymbolArray;for(let Ie=0;Ie<Pe.length;Ie++){const Be=Pe.get(Ie),{numGlyphs:Oe}=Be,Ne=pe[Ie];if(Be.hidden||!Ne)Tl(Oe,oe);else{const{x:ze,y:Ue,z:Ye,angle:vt}=Ne;for(let ct=0;ct<Oe;ct++)i.bt(oe,ze,Ue,Ye,vt)}}_.icon.dynamicLayoutVertexBuffer.updateData(oe)}_.text.dynamicLayoutVertexBuffer.updateData(J)}function ei(_,s,c,g,x,E,I={}){const k=c.paint.get("icon-translate"),j=c.paint.get("text-translate"),U=c.paint.get("icon-translate-anchor"),$=c.paint.get("text-translate-anchor"),Q=c.layout.get("icon-rotation-alignment"),J=c.layout.get("text-rotation-alignment"),oe=c.layout.get("icon-pitch-alignment"),pe=c.layout.get("text-pitch-alignment"),ce=c.layout.get("icon-keep-upright"),me=c.layout.get("text-keep-upright"),ve=c.paint.get("icon-color-saturation"),Ee=c.paint.get("icon-color-contrast"),Pe=c.paint.get("icon-color-brightness-min"),Ie=c.paint.get("icon-color-brightness-max"),Be=c.layout.get("symbol-elevation-reference")==="sea",Oe=_.context,Ne=Oe.gl,ze=_.transform,Ue=Q==="map",Ye=J==="map",vt=oe==="map",ct=pe==="map",Pt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let At=!1;const jt=_.depthModeForSublayer(0,En.ReadOnly),ut=[i.av(ze.center.lng),i.aC(ze.center.lat)],It=c.layout.get("text-variable-anchor"),nt=ze.projection.name==="globe",Mt=[],St=[0,-1,0];for(const Rt of g){const xt=s.getTile(Rt),Lt=xt.getBucket(c);if(!Lt||Lt.projection.name==="mercator"&&nt||Lt.fullyClipped)continue;const en=Lt.projection.name==="globe",tn=en?i.ag(ze.zoom):0,rn=aa(Rt,Lt.getProjection(),ze),fn=ze.calculatePixelsToTileUnitsMatrix(xt),kn=It&&Lt.hasTextData(),vn=Lt.hasIconTextFit()&&kn&&Lt.hasIconData(),Ln=Lt.getProjection().createInversionMatrix(ze,Rt.canonical),Mn=Pr=>{ze.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||_.terrain)&&(Pr.push("DEPTH_D24"),Pr.push("DEPTH_OCCLUSION"))},Hn=()=>{const Pr=Ue&&c.layout.get("symbol-placement")!=="point",Ar=[];Mn(Ar);const gi=Pr||vn,uo=c.paint.get("icon-image-cross-fade").constantOr(0);_.terrainRenderModeElevated()&&vt&&Ar.push("PITCH_WITH_MAP_TERRAIN"),en&&(Ar.push("PROJECTION_GLOBE_VIEW"),gi&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),uo>0&&Ar.push("ICON_TRANSITION"),Lt.icon.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),ve===0&&Ee===0&&Pe===0&&Ie===1||Ar.push("COLOR_ADJUSTMENT"),Lt.sdfIcons&&Ar.push("RENDER_SDF");const _o=Lt.icon.programConfigurations.get(c.id),yo=_.getOrCreateProgram("symbol",{config:_o,defines:Ar}),Xs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Ls=Lt.iconSizeData,Or=i.bp(Ls,ze.zoom),bi=vt||ze.pitch!==0,kr=Cl(rn,xt.tileID.canonical,vt,Ue,ze,Lt.getProjection(),fn),Wr=Qi(rn,xt.tileID.canonical,vt,Ue,ze,Lt.getProjection(),fn),cs=_.translatePosMatrix(Wr,xt,k,U,!0),oi=_.translatePosMatrix(rn,xt,k,U),vo=gi?Md:kr,Li=Ue&&!vt&&!Pr;let Ua=St;!nt&&!ze.mercatorFromTransition||Ue||(Ua=Rc(ze));const dl=en?Ua:St,_a=c.getColorAdjustmentMatrix(ve,Ee,Pe,Ie),zl=Na(Ls.kind,Or,Li,vt,_,oi,vo,cs,Be,!1,Xs,[0,0],!0,Rt,tn,ut,Ln,dl,Lt.getProjection(),_a,uo),ya=xt.imageAtlasTexture?xt.imageAtlasTexture:null,Qu=c.layout.get("icon-size").constantOr(0)!==1||Lt.iconsNeedLinear,ec=Lt.sdfIcons||_.options.rotating||_.options.zooming||Qu||bi?Ne.LINEAR:Ne.NEAREST,ts=Lt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Nm=_.terrain&&vt&&Pr?i.ad.mat4.invert(i.ad.mat4.create(),kr):Md;if(Pr&&Lt.icon){const lp=ze.elevation,gu=lp?lp.getAtTileOffsetFunc(Rt,ze.center.lat,ze.worldSize,Lt.getProjection()):null,up=vs(rn,xt.tileID.canonical,vt,Ue,ze,Lt.getProjection(),fn);_d(Lt,rn,_,!1,up,Wr,vt,ce,gu,Rt)}return{program:yo,buffers:Lt.icon,uniformValues:zl,atlasTexture:ya,atlasTextureIcon:null,atlasInterpolation:ec,atlasInterpolationIcon:null,isSDF:Lt.sdfIcons,hasHalo:ts,tile:xt,labelPlaneMatrixInv:Nm}},Nr=()=>{const Pr=Ye&&c.layout.get("symbol-placement")!=="point",Ar=[],gi=Pr||It||vn;_.terrainRenderModeElevated()&&ct&&Ar.push("PITCH_WITH_MAP_TERRAIN"),en&&(Ar.push("PROJECTION_GLOBE_VIEW"),gi&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),Lt.text.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),Lt.iconsInText&&Ar.push("RENDER_TEXT_AND_SYMBOL"),Ar.push("RENDER_SDF"),Mn(Ar);const uo=Lt.text.programConfigurations.get(c.id),_o=_.getOrCreateProgram("symbol",{config:uo,defines:Ar});let yo,Xs=[0,0],Ls=null;const Or=Lt.textSizeData;Lt.iconsInText&&(Xs=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Ls=xt.imageAtlasTexture?xt.imageAtlasTexture:null,yo=ct||ze.pitch!==0||_.options.rotating||_.options.zooming||Or.kind==="composite"||Or.kind==="camera"?Ne.LINEAR:Ne.NEAREST);const bi=xt.glyphAtlasTexture?xt.glyphAtlasTexture.size:[0,0],kr=c.layout.get("text-size-scale-range"),Wr=i.ay(_.scaleFactor,kr[0],kr[1]),cs=i.bp(Or,ze.zoom,Wr),oi=Cl(rn,xt.tileID.canonical,ct,Ye,ze,Lt.getProjection(),fn),vo=Qi(rn,xt.tileID.canonical,ct,Ye,ze,Lt.getProjection(),fn),Li=_.translatePosMatrix(vo,xt,j,$,!0),Ua=_.translatePosMatrix(rn,xt,j,$),dl=gi?Md:oi,_a=Ye&&!ct&&!Pr;let zl=St;!nt&&!ze.mercatorFromTransition||Ye||(zl=Rc(ze));const ya=Na(Or.kind,cs,_a,ct,_,Ua,dl,Li,Be,!0,bi,Xs,!0,Rt,tn,ut,Ln,en?zl:St,Lt.getProjection(),null,null,Wr),Qu=xt.glyphAtlasTexture?xt.glyphAtlasTexture:null,ec=Ne.LINEAR,ts=c.paint.get("text-halo-width").constantOr(1)!==0,Nm=_.terrain&&ct&&Pr?i.ad.mat4.invert(i.ad.mat4.create(),oi):Md;if(Pr&&Lt.text){const lp=ze.elevation,gu=lp?lp.getAtTileOffsetFunc(Rt,ze.center.lat,ze.worldSize,Lt.getProjection()):null,up=vs(rn,xt.tileID.canonical,ct,Ye,ze,Lt.getProjection(),fn);_d(Lt,rn,_,!0,up,vo,ct,me,gu,Rt)}return{program:_o,buffers:Lt.text,uniformValues:ya,atlasTexture:Qu,atlasTextureIcon:Ls,atlasInterpolation:ec,atlasInterpolationIcon:yo,isSDF:!0,hasHalo:ts,tile:xt,labelPlaneMatrixInv:Nm}},ii=Lt.icon.segments.get().length,ir=Lt.text.segments.get().length,Ii=ii&&!I.onlyText?Hn():null,Nn=ir&&!I.onlyIcons?Nr():null,mn=c.paint.get("icon-opacity").constantOr(1),_r=c.paint.get("text-opacity").constantOr(1);if(Pt&&Lt.canOverlap){At=!0;const Pr=mn&&!I.onlyText?Lt.icon.segments.get():[],Ar=_r&&!I.onlyIcons?Lt.text.segments.get():[];for(const gi of Pr)Mt.push({segments:new i.b8([gi]),sortKey:gi.sortKey,state:Ii});for(const gi of Ar)Mt.push({segments:new i.b8([gi]),sortKey:gi.sortKey,state:Nn})}else I.onlyText||Mt.push({segments:mn?Lt.icon.segments:new i.b8([]),sortKey:0,state:Ii}),I.onlyIcons||Mt.push({segments:_r?Lt.text.segments:new i.b8([]),sortKey:0,state:Nn})}At&&Mt.sort((Rt,xt)=>Rt.sortKey-xt.sortKey);for(const Rt of Mt){const xt=Rt.state;if(xt)if(_.terrain?_.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:ze.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}):_.setupDepthForOcclusion(ze.depthOcclusionForSymbolsAndCircles,xt.program),Oe.activeTexture.set(Ne.TEXTURE0),xt.atlasTexture&&xt.atlasTexture.bind(xt.atlasInterpolation,Ne.CLAMP_TO_EDGE,!0),xt.atlasTextureIcon&&(Oe.activeTexture.set(Ne.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,Ne.CLAMP_TO_EDGE,!0)),_.uploadCommonLightUniforms(_.context,xt.program),xt.hasHalo){const Lt=xt.uniformValues;Lt.u_is_halo=1,uu(xt.buffers,Rt.segments,c,_,xt.program,jt,x,E,Lt,2),Lt.u_is_halo=0}else{if(xt.isSDF){const Lt=xt.uniformValues;xt.hasHalo&&(Lt.u_is_halo=1,uu(xt.buffers,Rt.segments,c,_,xt.program,jt,x,E,Lt,1)),Lt.u_is_halo=0}uu(xt.buffers,Rt.segments,c,_,xt.program,jt,x,E,xt.uniformValues,1)}}}function uu(_,s,c,g,x,E,I,k,j,U){const $=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.iconTransitioningVertexBuffer,_.globeExtVertexBuffer,_.zOffsetVertexBuffer];x.draw(g,g.context.gl.TRIANGLES,E,I,k,Fn.disabled,j,c.id,_.layoutVertexBuffer,_.indexBuffer,s,c.paint,g.transform.zoom,_.programConfigurations.get(c.id),$,U)}function mm(_,s){const c=1<<_.canonical.z,g=(s.x*c-_.canonical.x-_.wrap*c)*i.ai,x=(s.y*c-_.canonical.y)*i.ai,E=i.d5(s.z,s.y);return i.ad.vec3.fromValues(g,x,E)}function gm(_,s,c,g,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const E=_.context.gl,I=new En(_.context.gl.LEQUAL,En.ReadWrite,_.depthRangeFor3D),k=new En(_.context.gl.GREATER,En.ReadWrite,_.depthRangeFor3D),j=function(oe){const pe=i.c4(oe.pitch);let ce=.01;return oe.isOrthographic&&(ce=i.ah(1e-4,ce,i.c9(pe>=Qt?1:pe/Qt))),2*ce}(_.transform),U=_.transform.getFreeCameraOptions().position,$="elevatedStructuresDepthReconstruct",Q=_.getOrCreateProgram($,{defines:["DEPTH_RECONSTRUCTION"]}),J=_.getOrCreateProgram($);for(const oe of g){const pe=s.getTile(oe),ce=pe.getBucket(c);if(!ce)continue;const me=ce.elevatedStructures;if(!me)continue;const ve=ce.elevationBufferData.heightRange,Ee=mm(oe.toUnwrapped(),U),Pe=_.translatePosMatrix(oe.projMatrix,pe,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let Ie,Be,Oe,Ne;if(x==="initialize"){if(!ve||ve.min>=1||me.depthSegments.segments[0].primitiveLength===0)continue;Ie=Sh(Pe,Ee,j,1,0),Be=I,Oe=me.depthSegments,Ne=Q}else if(x==="reset"){if(!ve||ve.min>=0||me.maskSegments.segments[0].primitiveLength===0)continue;Ie=Sh(Pe,Ee,0,0,1),Be=k,Oe=me.maskSegments,Ne=Q}else if(x==="geometry"){if(me.depthSegments.segments[0].primitiveLength===0)continue;Ie=Sh(Pe,Ee,j,1,0),Be=I,Oe=me.depthSegments,Ne=J}Ne.draw(_,E.TRIANGLES,Be,Vn.disabled,pr.disabled,Fn.disabled,Ie,c.id,me.vertexBuffer,me.indexBuffer,Oe,c.paint,_.transform.zoom)}}function Yf(_,s,c){const{painter:g,sourceCache:x,layer:E,coords:I,colorMode:k,elevationType:j,terrainEnabled:U,pass:$}=_,Q=g.context.gl,J=E.paint.get("fill-pattern");let oe=j;j!=="road"||s&&!U||(oe="none");const pe=oe==="road",ce=new En(g.context.gl.LEQUAL,En.ReadWrite,g.depthRangeFor3D),me=J&&J.constantOr(1),ve=(Ee,Pe)=>{let Ie,Be,Oe,Ne,ze;Pe?(Be=me&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ie=Q.LINES):(Be=me?"fillPattern":"fill",Ie=Q.TRIANGLES);for(const Ue of I){const Ye=x.getTile(Ue);if(me&&!Ye.patternsLoaded())continue;const vt=Ye.getBucket(E);if(!vt)continue;const ct=s?vt.elevationBufferData:vt.bufferData;if(ct.isEmpty())continue;g.prepareDrawTile();const Pt=ct.programConfigurations.get(E.id),At=g.isTileAffectedByFog(Ue),jt=[],ut=[];pe&&(jt.push("ELEVATED_ROADS"),ut.push(ct.elevatedLayoutVertexBuffer));const It=g.getOrCreateProgram(Be,{config:Pt,overrideFog:At,defines:jt});me&&(g.context.activeTexture.set(Q.TEXTURE0),Ye.imageAtlasTexture&&Ye.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Pt.updatePaintBuffers());const nt=J.constantOr(null);if(nt&&Ye.imageAtlas){const Rt=Ye.imageAtlas,xt=i.d0.from(nt).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),Lt=Rt.patternPositions.get(xt);Lt&&Pt.setConstantPatternPositions(Lt)}const Mt=g.translatePosMatrix(Ue.projMatrix,Ye,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor")),St=E.paint.get("fill-emissive-strength");if(Pe){Ne=ct.lineIndexBuffer,ze=ct.lineSegments;const Rt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[Q.drawingBufferWidth,Q.drawingBufferHeight];Oe=Be==="fillOutlinePattern"&&me?Mc(Mt,St,g,Ye,Rt):Ic(Mt,St,Rt)}else Ne=ct.indexBuffer,ze=ct.triangleSegments,Oe=me?Hu(Mt,St,g,Ye):Wf(Mt,St);g.uploadCommonUniforms(g.context,It,Ue.toUnwrapped()),It.draw(g,Ie,oe!=="none"?ce:Ee,c||g.stencilModeForClipping(Ue),k,Fn.disabled,Oe,E.id,ct.layoutVertexBuffer,Ne,ze,E.paint,g.transform.zoom,Pt,ut)}};g.renderPass===$&&ve(g.depthModeForSublayer(1,g.renderPass==="opaque"?En.ReadWrite:En.ReadOnly),!1),oe==="none"&&g.renderPass==="translucent"&&E.paint.get("fill-antialias")&&ve(g.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,En.ReadOnly),!0)}function Pd(_,s,c,g,x,E,I,k){c.resetLayerRenderingStats(_);const j=_.context,U=j.gl,$=_.transform,Q=c.paint.get("fill-extrusion-pattern"),J=Q.constantOr(1),oe=c.paint.get("fill-extrusion-opacity"),pe=_.style.enable3dLights(),ce=c.paint.get(pe&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),me=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ce],ve=c.layout.get("fill-extrusion-edge-radius"),Ee=ve>0&&!c.paint.get("fill-extrusion-rounded-roof"),Pe=Ee?0:ve,Ie=$.projection.name==="globe"?i.d6():0,Be=$.projection.name==="globe",Oe=Be?i.ag($.zoom):0,Ne=[i.av($.center.lng),i.aC($.center.lat)],ze=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ue=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(ze?null:c.lut).toArray01().slice(0,3),Ye=c.paint.get("fill-extrusion-flood-light-intensity"),vt=c.paint.get("fill-extrusion-vertical-scale"),ct=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pt=c.paint.get("fill-extrusion-height-alignment"),At=c.paint.get("fill-extrusion-base-alignment"),jt=Vu(_,c.paint.get("fill-extrusion-cutoff-fade-range")),ut=[];let It;Be&&ut.push("PROJECTION_GLOBE_VIEW"),me[0]>0&&ut.push("FAUX_AO"),Ee&&ut.push("ZERO_ROOF_RADIUS"),k&&ut.push("HAS_CENTROID"),Ye>0&&ut.push("FLOOD_LIGHT"),jt.shouldRenderCutoff&&ut.push("RENDER_CUTOFF"),ct&&ut.push("RENDER_WALL_MODE");const nt=_.renderPass==="shadow",Mt=_.shadowRenderer,St=nt&&!!Mt;_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!0);let Rt=[0,0,0];if(Mt){const en=_.style.directionalLight,tn=_.style.ambientLight;en&&tn&&(Rt=fh(_.style,en,tn)),nt||(ut.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Mt.useNormalOffset&&ut.push("NORMAL_OFFSET")),It=ut.concat(["SHADOWS_SINGLE_CASCADE"])}const xt=St?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",Lt=c.getLayerRenderingStats();for(const en of g){const tn=s.getTile(en),rn=tn.getBucket(c);if(!rn||rn.projection.name!==$.projection.name)continue;let fn=!1;Mt&&(fn=Mt.getMaxCascadeForTile(en.toUnwrapped())===0);const kn=_.isTileAffectedByFog(en),vn=rn.programConfigurations.get(c.id),Ln=_.getOrCreateProgram(xt,{config:vn,defines:fn?It:ut,overrideFog:kn});if(_.terrain&&_.terrain.setupElevationDraw(tn,Ln,{useMeterToDem:!0}),!rn.centroidVertexBuffer){const Nn=Ln.attributes.a_centroid_pos;Nn!==void 0&&U.vertexAttrib2f(Nn,0,0)}!nt&&Mt&&Mt.setupShadows(tn.tileID.toUnwrapped(),Ln,"vector-tile",tn.tileID.overscaledZ),J&&(_.context.activeTexture.set(U.TEXTURE0),tn.imageAtlasTexture&&tn.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),vn.updatePaintBuffers());const Mn=Q.constantOr(null);if(Mn&&tn.imageAtlas){const Nn=tn.imageAtlas,mn=i.d0.from(Mn).getPrimary().scaleSelf(i.q.devicePixelRatio),_r=Nn.patternPositions.get(mn.toString());_r&&vn.setConstantPatternPositions(_r)}const Hn=c.paint.get("fill-extrusion-vertical-gradient"),Nr=1/rn.tileToMeter;let ii;if(nt&&Mt){if(ka(tn.tileID,rn,_))continue;const Nn=Mt.calculateShadowPassMatrixFromTile(tn.tileID.toUnwrapped());ii=wh(Nn,Pe,Nr,vt,Pt,At)}else{const Nn=_.translatePosMatrix(en.expandedProjMatrix,tn,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),mn=$.projection.createInversionMatrix($,en.canonical);ii=J?Rg(Nn,_,Hn,oe,me,Pe,Nr,en,tn,Ie,Pt,At,Oe,Ne,mn,Ue,vt):Id(Nn,_,Hn,oe,me,Pe,Nr,en,Ie,Pt,At,Oe,Ne,mn,Ue,vt,Ye,Rt)}_.uploadCommonUniforms(j,Ln,en.toUnwrapped(),null,jt);let ir=rn.segments;if($.projection.name==="mercator"&&!nt&&(ir=rn.getVisibleSegments(tn.tileID,_.terrain,_.transform.getFrustum(0)),!ir.get().length))continue;if(Lt)if(nt)for(const Nn of ir.get())Lt.numRenderedVerticesInShadowPass+=Nn.primitiveLength;else for(const Nn of ir.get())Lt.numRenderedVerticesInTransparentPass+=Nn.primitiveLength;const Ii=[];(_.terrain||k)&&Ii.push(rn.centroidVertexBuffer),Be&&Ii.push(rn.layoutVertexExtBuffer),ct&&Ii.push(rn.wallVertexBuffer),Ln.draw(_,j.gl.TRIANGLES,x,E,I,Fn.backCCW,ii,c.id,rn.layoutVertexBuffer,rn.indexBuffer,ir,c.paint,_.transform.zoom,vn,Ii)}_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!1)}function cu(_,s,c,g,x,E,I,k,j,U,$,Q,J,oe,pe,ce,me,ve,Ee){const Pe=_.context,Ie=Pe.gl,Be=_.transform,Oe=_.transform.zoom,Ne=[],ze=Vu(_,c.paint.get("fill-extrusion-cutoff-fade-range"));U==="clear"?(Ne.push("CLEAR_SUBPASS"),Ee&&(Ne.push("CLEAR_FROM_TEXTURE"),Pe.activeTexture.set(Ie.TEXTURE0),Ee.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):U==="sdf"&&Ne.push("SDF_SUBPASS"),me&&Ne.push("HAS_CENTROID"),ze.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF");const Ue=c.layout.get("fill-extrusion-edge-radius"),Ye=(vt,ct,Pt,At,jt)=>{const ut=ct.programConfigurations.get(c.id),It=_.isTileAffectedByFog(vt),nt=_.getOrCreateProgram("fillExtrusionGroundEffect",{config:ut,defines:Ne,overrideFog:It}),Mt=((Rt,xt,Lt,en,tn,rn,fn,kn,vn,Ln,Mn)=>({u_matrix:xt,u_opacity:Lt,u_ao_pass:en?1:0,u_meter_to_tile:tn,u_ao:rn,u_flood_light_intensity:fn,u_flood_light_color:kn,u_attenuation:vn,u_edge_radius:Ln,u_fb:0,u_fb_size:Mn,u_dynamic_offset:1}))(0,At,$,j,jt,[Q,J*jt],oe,pe,ce,Oe>=17?0:Ue*jt,Ee?Ee.size[0]:0),St=[];me&&St.push(ct.hiddenByLandmarkVertexBuffer),_.uploadCommonUniforms(Pe,nt,vt.toUnwrapped(),null,ze),nt.draw(_,Pe.gl.TRIANGLES,x,E,I,k,Mt,c.id,ct.vertexBuffer,ct.indexBuffer,Pt,c.paint,Oe,ut,St)};for(const vt of g){const ct=s.getTile(vt),Pt=ct.getBucket(c);if(!Pt||Pt.projection.name!==Be.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const At=Pt.groundEffect,jt=1/Pt.tileToMeter;{const ut=_.translatePosMatrix(vt.projMatrix,ct,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),It=At.getDefaultSegment();Ye(vt,At,It,ut,jt)}if(ve)for(let ut=0;ut<4;ut++){const It=i.d7[ut](vt),nt=s.getTile(It);if(!nt)continue;const Mt=nt.getBucket(c);if(!Mt||Mt.projection.name!==Be.projection.name||!Mt.groundEffect||Mt.groundEffect&&!Mt.groundEffect.hasData())continue;const St=Mt.groundEffect;let Rt,xt;ut===0?(Rt=[-i.ai,0,0],xt=1):ut===1?(Rt=[i.ai,0,0],xt=0):ut===2?(Rt=[0,-i.ai,0],xt=3):(Rt=[0,i.ai,0],xt=2);const Lt=St.regionSegments[xt];if(!Lt)continue;const en=new Float32Array(16);i.ad.mat4.translate(en,vt.projMatrix,Rt),Ye(vt,St,Lt,_.translatePosMatrix(en,ct,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),jt)}}}function Ms(_,s,c,g,x,E,I){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const k=E?E.findDEMTileFor(c):null;if(!(k&&k.dem||I))return;E&&k&&k.dem&&g.selfDEMTileTimestamp!==k.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=k.dem._timestamp);const j=ve=>new i.P(Math.ceil((ve+i.da)*i.db),0),U=ve=>{const Ee=s.getSource().minzoom,Pe=Be=>{const Oe=s.getTileByID(Be);if(Oe&&Oe.hasData())return Oe.getBucket(x)},Ie=[0,-1,1];for(const Be of Ie){if(ve.overscaledZ+Be<Ee)continue;const Oe=Pe(ve.calculateScaledKey(ve.overscaledZ+Be));if(Oe)return Oe}},$=[0,0,0],Q=(ve,Ee)=>($[0]=Math.min(ve.min.y,Ee.min.y),$[1]=Math.max(ve.max.y,Ee.max.y),$[2]=i.ai-Ee.min.x>ve.max.x?Ee.min.x-i.ai:ve.max.x,$),J=(ve,Ee)=>($[0]=Math.min(ve.min.x,Ee.min.x),$[1]=Math.max(ve.max.x,Ee.max.x),$[2]=i.ai-Ee.min.y>ve.max.y?Ee.min.y-i.ai:ve.max.y,$),oe=[(ve,Ee)=>Q(ve,Ee),(ve,Ee)=>Q(Ee,ve),(ve,Ee)=>J(ve,Ee),(ve,Ee)=>J(Ee,ve)],pe=(ve,Ee,Pe,Ie,Be,Oe,Ne)=>{if(!E)return 0;const ze=[[Oe?Pe:ve,Oe?ve:Pe,0],[Oe?Pe:Ee,Oe?Ee:Pe,0]],Ue=Ne<0?i.ai+Ne:Ne,Ye=[Oe?Ue:(ve+Ee)/2,Oe?(ve+Ee)/2:Ue,0];return Pe===0&&Ne<0||Pe!==0&&Ne>0?E.getForTilePoints(Be,[Ye],!0,Ie):ze.push(Ye),E.getForTilePoints(c,ze,!0,k),Math.max(ze[0][2],ze[1][2],Ye[2])/E.exaggeration()};for(let ve=0;ve<4;ve++){const Ee=g.borderFeatureIndices[ve];if(Ee.length===0)continue;const Pe=i.d7[ve](c),Ie=U(Pe);if(!(Ie&&Ie instanceof i.d8))continue;const Be=E?E.findDEMTileFor(Pe):null;if(!(Be&&Be.dem||I)||(E&&Be&&Be.dem&&g.borderDEMTileTimestamp[ve]!==Be.dem._timestamp&&(g.borderDoneWithNeighborZ[ve]=-1,g.borderDEMTileTimestamp[ve]=Be.dem._timestamp),g.borderDoneWithNeighborZ[ve]===Ie.canonical.z))continue;Ie.centroidVertexArray.length===0&&Ie.createCentroidsBuffer();const Oe=(ve<2?1:5)-ve,Ne=Ie.borderDoneWithNeighborZ[Oe]!==g.canonical.z,ze=Ie.borderFeatureIndices[Oe];let Ue=0;if(g.canonical.z!==Ie.canonical.z){for(const Ye of Ee)g.showCentroid(g.featuresOnBorder[Ye]);if(Ne)for(const Ye of ze)Ie.showCentroid(Ie.featuresOnBorder[Ye]);g.borderDoneWithNeighborZ[ve]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Oe]=g.canonical.z}for(const Ye of Ee){const vt=g.featuresOnBorder[Ye],ct=g.centroidData[vt.centroidDataIndex],Pt=vt.borders[ve];let At;for(;Ue<ze.length;){At=Ie.featuresOnBorder[ze[Ue]];const jt=At.borders[Oe];if(jt[1]>Pt[0]+3||jt[0]>Pt[0]-3)break;Ie.showCentroid(At),Ue++}if(At&&Ue<ze.length){const jt=Ue;let ut=0;for(;!(At.borders[Oe][0]>Pt[1]-3)&&(ut++,++Ue!==ze.length);)At=Ie.featuresOnBorder[ze[Ue]];At=Ie.featuresOnBorder[ze[jt]];let It=!1;if(ut>=1){const St=At.borders[Oe];Math.abs(Pt[0]-St[0])<3&&Math.abs(Pt[1]-St[1])<3&&(ut=1,It=!0,Ue=jt+1)}else if(ut===0){g.showCentroid(vt);continue}const nt=Ie.centroidData[At.centroidDataIndex];I&&It&&(((ce=ct).flags|(me=nt).flags)&i.d9?(ce.flags|=i.d9,me.flags|=i.d9):(ce.flags&=~i.d9,me.flags&=~i.d9));const Mt=vt.intersectsCount()>1||At.intersectsCount()>1;if(ut>1)Ue=jt,ct.centroidXY=nt.centroidXY=new i.P(0,0);else if(Be&&Be.dem&&!Mt){const St=oe[ve](ct,nt),Rt=ve%2?i.ai-1:0,xt=pe(St[0],Math.min(i.ai-1,St[1]),Rt,Be,Pe,ve<2,St[2]);ct.centroidXY=nt.centroidXY=j(xt)}else Mt?ct.centroidXY=nt.centroidXY=new i.P(0,0):(ct.centroidXY=g.encodeBorderCentroid(vt),nt.centroidXY=Ie.encodeBorderCentroid(At));g.writeCentroidToBuffer(ct),Ie.writeCentroidToBuffer(nt)}else g.showCentroid(vt)}g.borderDoneWithNeighborZ[ve]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Oe]=g.canonical.z}var ce,me;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(_)}const Ol=[1,0,0],Xt=[0,1,0],ln=[0,0,1];function ka(_,s,c){const g=c.transform,x=c.shadowRenderer;if(!x)return!0;const E=_.toUnwrapped(),I=g.tileSize*x._cascades[c.currentShadowCascade].scale;let k=s.maxHeight;if(g.elevation){const ce=g.elevation.getMinMaxForTile(_);ce&&(k+=ce.max)}const j=[...x.shadowDirection];j[2]=-j[2];const U=x.computeSimplifiedTileShadowVolume(E,k,I,j);if(!U)return!1;const $=[Ol,Xt,ln,j,[j[0],0,j[2]],[0,j[1],j[2]]],Q=g.projection.name==="globe",J=g.scaleZoom(I),oe=i.bR.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,J,!Q),pe=x.getCurrentCascadeFrustum();return oe.intersectsPrecise(U.vertices,U.planes,$)===0||pe.intersectsPrecise(U.vertices,U.planes,$)===0}function li(_){return[_[0]*i.dc,_[1]*i.dc,_[2]*i.dc,0]}function ft(_,s,c,g,x,E,I,k,j){const U=g.getSource(),$=c.globeSharedBuffers;if(!$)return;let Q,J,oe;if(s&&(Q=g.getTile(s)),U instanceof i.aK?(J=U.texture,oe=i.cJ(0,0,c.transform)):Q&&s&&(J=Q.texture,oe=i.cJ(s.canonical.z,s.canonical.x,c.transform)),!J||!oe)return;_||(oe=i.ad.mat4.scale(i.ad.mat4.create(),oe,[1,-1,1]));const pe=c.context,ce=pe.gl,me=x.paint.get("raster-resampling")==="nearest"?ce.NEAREST:ce.LINEAR,ve=c.colorModeForDrapableLayerRenderPass(E),Ee=I.defines;Ee.push("GLOBE_POLES");const Pe=new En(ce.LEQUAL,En.ReadWrite,c.depthRangeFor3D),Ie=Float32Array.from(c.transform.expandedFarZProjMatrix),Be=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),pe.activeTexture.set(ce.TEXTURE0),J.bind(me,ce.CLAMP_TO_EDGE),pe.activeTexture.set(ce.TEXTURE1),J.bind(me,ce.CLAMP_TO_EDGE),"useMipmap"in J&&pe.extTextureFilterAnisotropic&&c.transform.pitch>20&&ce.texParameterf(ce.TEXTURE_2D,pe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,pe.extTextureFilterAnisotropicMax);const[Oe,Ne,ze,Ue]=s?$.getPoleBuffers(s.canonical.z,!1):$.getPoleBuffers(0,!0),Ye=x.paint.get("raster-elevation");let vt;_?(vt=Oe,c.renderDefaultNorthPole=Ye!==0):(vt=Ne,c.renderDefaultSouthPole=Ye!==0);const ct=li(I.mix),Pt=((jt,ut,It,nt,Mt,St,Rt,xt,Lt,en,tn,rn,fn)=>Pc(jt,ut,It,new Float32Array(16),new Float32Array(9),[0,0],nt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},St,[0,0],xt,2,en,tn,rn,1,0,fn))(Ie,Be,oe,i.ag(c.transform.zoom),0,x,0,Ye,0,ct,I.offset,I.range,E),At=c.getOrCreateProgram("raster",{defines:Ee});c.uploadCommonUniforms(pe,At,null),At.draw(c,ce.TRIANGLES,Pe,j,ve,k,Pt,x.id,vt,ze,Ue)}function dy(_){const s=_._nearZ,c=_.projection.farthestPixelDistance(_),g=c-s,x=.2*_.height,E=s+x;return[s,c,(E-x-s)/g,(E-s)/g]}function Dl(_,s,c,g){if(_)return s instanceof Fu&&_ instanceof Gs?s.getTextureDescriptor(_,c,!0):{texture:_.texture,mix:li(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Xu=i.dd([{name:"a_index",type:"Int16",components:1}]);class Kf{constructor(s,c,g,x){const E={width:g[0],height:g[1],data:null},I=s.gl;this.targetColorTexture=new i.T(s,E,I.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,E,I.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,x=c.width*c.height;this.particleTexture0=new i.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1});const E=new i.de;E.reserve(x);for(let I=0;I<x;I++)E.emplaceBack(I);this.particleIndexBuffer=this.context.createVertexBuffer(E,Xu.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fy(_,s,c){if(!_)return null;const g=s.getTextureDescriptor(_,c,!0);if(!g)return null;let{texture:x,mix:E,offset:I,tileSize:k,buffer:j,format:U}=g;if(!x||!U)return null;let $=!1;return U==="uint32"&&($=!0,E[3]=0,E=on(i.df,E,[0,c.paint.get("raster-particle-max-speed")]),I=au(i.df,I,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[j/(k+2*j),k/(k+2*j)],tileSize:k,scalarData:$,scale:E,offset:I,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[U]]}}function _m(_){const s=_._nearZ,c=_.projection.farthestPixelDistance(_),g=c-s,x=.2*_.height,E=s+x;return[s,c,(E-x-s)/g,(E-s)/g]}const Ad=new i.al(1,0,0,1),ym=new i.al(0,1,0,1),Zu=new i.al(0,0,1,1),Jf=new i.al(1,0,1,1),Th=new i.al(0,1,1,1);function Fa(_,s,c,g,x,E,I){const k=_.context,j=_.transform,U=k.gl,$=j.projection.name==="globe",Q=$?["PROJECTION_GLOBE_VIEW"]:[];let J=i.ad.mat4.clone(c.projMatrix);if($&&i.ag(j.zoom)>0){const ct=i.bb(c.canonical,j),Pt=i.dg(ct);J=i.ad.mat4.multiply(new Float32Array(16),j.globeMatrix,Pt),i.ad.mat4.multiply(J,j.projMatrix,J)}const oe=i.ad.mat4.create();oe[12]+=2*x/(i.q.devicePixelRatio*j.width),oe[13]+=2*E/(i.q.devicePixelRatio*j.height),i.ad.mat4.multiply(J,oe,J);const pe=_.getOrCreateProgram("debug",{defines:Q}),ce=s.getTileByID(c.key);_.terrain&&_.terrain.setupElevationDraw(ce,pe);const me=En.disabled,ve=Vn.disabled,Ee=_.colorModeForRenderPass(),Pe="$debug";k.activeTexture.set(U.TEXTURE0),_.emptyTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$?ce._makeGlobeTileDebugBuffers(_.context,j):ce._makeDebugTileBoundsBuffers(_.context,j.projection);const Ie=ce._tileDebugBuffer||_.debugBuffer,Be=ce._tileDebugIndexBuffer||_.debugIndexBuffer,Oe=ce._tileDebugSegments||_.debugSegments;if(pe.draw(_,U.LINE_STRIP,me,ve,Ee,Fn.disabled,al(J,g),Pe,Ie,Be,Oe,null,null,null,[ce._globeTileDebugBorderBuffer]),I){const ct=ce.latestRawTileData,Pt=Math.floor((ct&&ct.byteLength||0)/1024);let At=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(At+=` => ${c.overscaledZ}`),At+=` ${ce.state}`,At+=` ${Pt}kb`,function(jt,ut){jt.initDebugOverlayCanvas();const It=jt.debugOverlayCanvas,nt=jt.context.gl,Mt=jt.debugOverlayCanvas.getContext("2d");Mt.clearRect(0,0,It.width,It.height),Mt.shadowColor="white",Mt.shadowBlur=2,Mt.lineWidth=1.5,Mt.strokeStyle="white",Mt.textBaseline="top",Mt.font="bold 36px Open Sans, sans-serif",Mt.fillText(ut,5,5),Mt.strokeText(ut,5,5),jt.debugOverlayTexture.update(It),jt.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}(_,At)}const Ne=s.getTile(c).tileSize,ze=512/Math.min(Ne,512)*(c.overscaledZ/j.zoom)*.5,Ue=ce._tileDebugTextBuffer||_.debugBuffer,Ye=ce._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,vt=ce._tileDebugTextSegments||_.debugSegments;pe.draw(_,U.TRIANGLES,me,ve,pr.alphaBlended,Fn.disabled,al(J,i.al.transparent,ze),Pe,Ue,Ye,vt,null,null,null,[ce._globeTileDebugTextBuffer])}function vm(_,s,c,g){Mh(_,0,s+c/2,_.transform.width,c,g)}function Ih(_,s,c,g){Mh(_,s-c/2,0,c,_.transform.height,g)}function Mh(_,s,c,g,x,E){const I=_.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(s*i.q.devicePixelRatio,c*i.q.devicePixelRatio,g*i.q.devicePixelRatio,x*i.q.devicePixelRatio),I.clear({color:E}),k.disable(k.SCISSOR_TEST)}const Qf=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gi}=Qf;function Nl(_,s,c,g){_.emplaceBack(s,c,g)}class Og{constructor(s){this.vertexArray=new i.dh,this.indices=new i.aV,Nl(this.vertexArray,-1,-1,1),Nl(this.vertexArray,1,-1,1),Nl(this.vertexArray,-1,1,1),Nl(this.vertexArray,1,1,1),Nl(this.vertexArray,-1,-1,-1),Nl(this.vertexArray,1,-1,-1),Nl(this.vertexArray,-1,1,-1),Nl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Gi),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function Oo(_,s,c,g,x,E){const I=_.context.gl,k=s.paint.get("sky-atmosphere-color"),j=s.paint.get("sky-atmosphere-halo-color"),U=s.paint.get("sky-atmosphere-sun-intensity"),$=((Q,J,oe,pe,ce)=>({u_matrix_3f:Q,u_sun_direction:J,u_sun_intensity:oe,u_color_tint_r:[pe.r,pe.g,pe.b,pe.a],u_color_tint_m:[ce.r,ce.g,ce.b,ce.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),g),x,U,k,j);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,s.skyboxTexture,0),c.draw(_,I.TRIANGLES,En.disabled,Vn.disabled,pr.unblended,Fn.frontCW,$,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Dg=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rd{constructor(s){const c=new i.di;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const g=new i.aV;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,Dg.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Jr=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jo{constructor(s){this.colorModeAlphaBlendedWriteRGB=new pr([1,hh,1,hh],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new pr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new qn,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Rd(c);const g=this.params.sizeRange,x=this.params.intensityRange,E=function($){const Q=i.dl(30),J=[];for(let oe=0;oe<$;++oe){const pe=2*Math.PI*Q(),ce=Math.acos(1-2*Q())-.5*Math.PI;J.push(i.ad.vec3.fromValues(Math.cos(ce)*Math.cos(pe),Math.cos(ce)*Math.sin(pe),Math.sin(ce)))}return J}(this.params.starsCount),I=i.dl(300),k=new i.dj,j=new i.aV;let U=0;for(let $=0;$<E.length;++$){const Q=i.ad.vec3.scale([],E[$],200),J=Math.max(0,1+.01*g*(1*I()-.5)),oe=Math.max(0,1+.01*x*(1*I()-.5));k.emplaceBack(Q[0],Q[1],Q[2],-1,-1,J,oe),k.emplaceBack(Q[0],Q[1],Q[2],1,-1,J,oe),k.emplaceBack(Q[0],Q[1],Q[2],1,1,J,oe),k.emplaceBack(Q[0],Q[1],Q[2],-1,1,J,oe),j.emplaceBack(U+0,U+1,U+2),j.emplaceBack(U+0,U+2,U+3),U+=4}this.starsVx=c.createVertexBuffer(k,Jr.members),this.starsIdx=c.createIndexBuffer(j),this.starsSegments=i.b8.simpleSegment(0,0,k.length,j.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const g=s.context,x=g.gl,E=s.transform,I=new En(x.LEQUAL,En.ReadOnly,[0,1]),k=i.ag(E.zoom),j=s.style.getLut(c.scope),U=c.properties.get("color-use-theme")==="none",$=c.properties.get("color").toRenderColor(U?null:j).toArray01(),Q=c.properties.get("high-color-use-theme")==="none",J=c.properties.get("high-color").toRenderColor(Q?null:j).toArray01(),oe=c.properties.get("space-color-use-theme")==="none",pe=c.properties.get("space-color").toRenderColor(oe?null:j).toArray01PremultipliedAlpha(),ce=5e-4,me=i.dk(c.properties.get("horizon-blend"),0,1,ce,.25),ve=i.cD(s,g,E)&&me===ce?E.worldSize/(2*Math.PI*1.025)-1:E.globeRadius,Ee=s.frameCounter/1e3%1,Pe=i.ad.vec3.length(E.globeCenterInViewSpace),Ie=Math.sqrt(Math.pow(Pe,2)-Math.pow(ve,2)),Be=Math.acos(Ie/Pe),Oe=Ne=>{const ze=E.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ne&&ze.push("ALPHA_PASS");const Ue=s.getOrCreateProgram("globeAtmosphere",{defines:ze}),Ye=((ct,Pt,At,jt,ut,It,nt,Mt,St,Rt,xt,Lt)=>({u_frustum_tl:ct,u_frustum_tr:Pt,u_frustum_br:At,u_frustum_bl:jt,u_horizon:ut,u_transition:It,u_fadeout_range:nt,u_color:Mt,u_high_color:St,u_space_color:Rt,u_temporal_offset:xt,u_horizon_angle:Lt}))(E.frustumCorners.TL,E.frustumCorners.TR,E.frustumCorners.BR,E.frustumCorners.BL,E.frustumCorners.horizon,k,me,$,J,pe,Ee,Be);s.uploadCommonUniforms(g,Ue);const vt=this.atmosphereBuffer;vt&&Ue.draw(s,x.TRIANGLES,I,Vn.disabled,Ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Fn.backCW,Ye,Ne?"atmosphere_glow_alpha":"atmosphere_glow",vt.vertexBuffer,vt.indexBuffer,vt.segments)};Oe(!1),Oe(!0)}drawStars(s,c){const g=i.ay(c.properties.get("star-intensity"),0,1);if(g===0)return;const x=s.context,E=x.gl,I=s.transform,k=s.getOrCreateProgram("stars"),j=i.ad.quat.identity([]);i.ad.quat.rotateX(j,j,-I._pitch),i.ad.quat.rotateZ(j,j,-I.angle),i.ad.quat.rotateX(j,j,i.ak(I._center.lat)),i.ad.quat.rotateY(j,j,-i.ak(I._center.lng));const U=i.ad.mat4.fromQuat(new Float32Array(16),j),$=i.ad.mat4.multiply([],I.starsProjMatrix,U),Q=i.ad.mat3.fromMat4([],U),J=i.ad.mat3.invert([],Q),oe=[0,1,0];i.ad.vec3.transformMat3(oe,oe,J),i.ad.vec3.scale(oe,oe,this.params.sizeMultiplier);const pe=[1,0,0];i.ad.vec3.transformMat3(pe,pe,J),i.ad.vec3.scale(pe,pe,this.params.sizeMultiplier);const ce=(me=oe,ve=pe,Ee=g,{u_matrix:Float32Array.from($),u_up:me,u_right:ve,u_intensity_multiplier:Ee});var me,ve,Ee;s.uploadCommonUniforms(x,k),this.starsVx&&this.starsIdx&&k.draw(s,E.TRIANGLES,En.disabled,Vn.disabled,this.colorModeAlphaBlendedWriteRGB,Fn.disabled,ce,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function eo(_,s){const c=[..._],g=s.cameraWorldSizeForFog/s.worldSize,x=i.ad.mat4.identity([]);return i.ad.mat4.scale(x,x,[g,g,1]),i.ad.mat4.multiply(c,x,c),i.ad.mat4.multiply(c,s.worldToFogMatrix,c),c}function Lc(_,s,c,g,x){const E=c.material,I=g.context,{baseColorTexture:k,metallicRoughnessTexture:j}=E.pbrMetallicRoughness,{normalTexture:U,occlusionTexture:$,emissionTexture:Q}=E;function J(pe,ce,me){if(pe&&(_.push(ce),I.activeTexture.set(I.gl.TEXTURE0+me),pe.gfxTexture)){const{minFilter:ve,magFilter:Ee,wrapS:Pe,wrapT:Ie}=pe.sampler;pe.gfxTexture.bindExtraParam(ve,Ee,Pe,Ie)}}J(k,"HAS_TEXTURE_u_baseColorTexture",Hi.BaseColor),J(j,"HAS_TEXTURE_u_metallicRoughnessTexture",Hi.MetallicRoughness),J(U,"HAS_TEXTURE_u_normalTexture",Hi.Normal),J($,"HAS_TEXTURE_u_occlusionTexture",Hi.Occlusion),J(Q,"HAS_TEXTURE_u_emissionTexture",Hi.Emission),x&&(x.texture||(x.texture=new i.dn(g.context,x.image,[x.image.height,x.image.height,x.image.height],I.gl.RGBA8)),I.activeTexture.set(I.gl.TEXTURE0+Hi.LUT),x.texture&&x.texture.bind(I.gl.LINEAR,I.gl.CLAMP_TO_EDGE),_.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(_.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(_.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(_.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(_.push("HAS_ATTRIBUTE_a_pbr"),_.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),E.alphaMode!=="OPAQUE"&&E.alphaMode!=="MASK"||_.push("UNPREMULT_TEXTURE_IN_SHADER"),E.defined||_.push("DIFFUSE_SHADED");const oe=g.shadowRenderer;oe&&(_.push("RENDER_SHADOWS","DEPTH_TEXTURE"),oe.useNormalOffset&&_.push("NORMAL_OFFSET"))}function ul(_,s,c,g,x,E){const I=c.paint.get("model-opacity").constantOr(1),k=s.context,j=new En(s.context.gl.LEQUAL,En.ReadWrite,s.depthRangeFor3D),U=s.transform,$=_.mesh,Q=$.material,J=Q.pbrMetallicRoughness,oe=s.style.fog;let pe;pe=s.transform.projection.zAxisUnit==="pixels"?[..._.nodeModelMatrix]:i.ad.mat4.multiply([],g.zScaleMatrix,_.nodeModelMatrix),i.ad.mat4.multiply(pe,g.negCameraPosMatrix,pe);const ce=i.ad.mat4.invert([],pe);i.ad.mat4.transpose(ce,ce);const me=c.paint.get("model-color-use-theme").constantOr("default")==="none",ve=c.paint.get("model-emissive-strength").constantOr(0),Ee=dm(new Float32Array(_.worldViewProjection),new Float32Array(pe),new Float32Array(ce),null,s,I,J.baseColorFactor.toRenderColor(null),Q.emissiveFactor,J.metallicFactor,J.roughnessFactor,Q,ve,c),Pe={defines:[]},Ie=[],Be=s.shadowRenderer;Be&&(Be.useNormalOffset=!1),Lc(Pe.defines,Ie,$,s,me?null:c.lut);let Oe=null;if(oe){const Ue=eo(_.nodeModelMatrix,s.transform);if(Oe=new Float32Array(Ue),U.projection.name!=="globe"){const Ye=$.aabb.min,vt=$.aabb.max,[ct,Pt]=oe.getOpacityForBounds(Ue,Ye[0],Ye[1],vt[0],vt[1]);Pe.overrideFog=ct>=sn||Pt>=sn}}const Ne=Vu(s,c.paint.get("model-cutoff-fade-range"));Ne.shouldRenderCutoff&&Pe.defines.push("RENDER_CUTOFF");const ze=s.getOrCreateProgram("model",Pe);s.uploadCommonUniforms(k,ze,null,Oe,Ne),s.renderPass!=="shadow"&&Be&&Be.setupShadowsFromMatrix(_.nodeModelMatrix,ze),ze.draw(s,k.gl.TRIANGLES,j,x,E,$.material.doubleSided?Fn.disabled:Fn.backCCW,Ee,c.id,$.vertexBuffer,$.indexBuffer,$.segments,c.paint,s.transform.zoom,void 0,Ie)}function hu(_,s,c,g,x,E,I){let k;k=_.projection.name==="globe"?i.dp(c,_):[...c],i.ad.mat4.multiply(k,k,s.matrix);const j=i.ad.mat4.multiply([],g,k);if(s.meshes)for(const U of s.meshes){if(U.material.alphaMode!=="BLEND"){I.push({mesh:U,depth:0,modelIndex:x,worldViewProjection:j,nodeModelMatrix:k});continue}const $=i.ad.vec3.transformMat4([],U.centroid,j);!_.isOrthographic&&$[2]<=0||E.push({mesh:U,depth:$[2],modelIndex:x,worldViewProjection:j,nodeModelMatrix:k})}if(s.children)for(const U of s.children)hu(_,U,c,g,x,E,I)}function xm(_,s,c,g){const x=c.shadowRenderer;if(!x)return;const E=x.getShadowPassDepthMode(),I=x.getShadowPassColorMode(),k=x.calculateShadowPassMatrixFromMatrix(s),j=cy(k);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,E,Vn.disabled,I,Fn.backCCW,j,g.id,_.vertexBuffer,_.indexBuffer,_.segments,g.paint,c.transform.zoom,void 0,void 0)}function bs(_,s,c){const g=s.updateZoomBasedPaintProperties(),x=function(E,I,k){let j,U,$,Q=E.terrain?E.terrain.exaggeration():0;if(E.terrain&&Q>0){const J=E.terrain,oe=J.findDEMTileFor(k);oe&&oe.dem?j=i.dr.create(J,k,oe):Q=0}if(Q===0&&(I.terrainElevationMin=0,I.terrainElevationMax=0),Q===I.validForExaggeration&&(Q===0||j&&j._demTile&&j._demTile.tileID===I.validForDEMTile.id&&j._dem._timestamp===I.validForDEMTile.timestamp))return!1;for(const J in I.instancesPerModel){const oe=I.instancesPerModel[J];for(let pe=0;pe<oe.instancedDataArray.length;++pe){const ce=(j?Q*j.getElevationAt(0|oe.instancedDataArray.float32[16*pe],0|oe.instancedDataArray.float32[16*pe+1],!0,!0):0)+oe.instancesEvaluatedElevation[pe];oe.instancedDataArray.float32[16*pe+6]=ce,U=U?Math.min(I.terrainElevationMin,ce):ce,$=$?Math.max(I.terrainElevationMax,ce):ce}}return I.terrainElevationMin=U||0,I.terrainElevationMax=$||0,I.validForExaggeration=Q,I.validForDEMTile=j&&j._demTile?{id:j._demTile.tileID,timestamp:j._dem._timestamp}:{id:void 0,timestamp:0},!0}(_,s,c);(g||x)&&(s.uploaded=!1,s.upload(_.context))}const za={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function bm(_,s){const c=1<<_.canonical.z,g=s.getFreeCameraOptions().position,x=s.elevation,E=_.canonical.x/c,I=(_.canonical.x+1)/c,k=_.canonical.y/c,j=(_.canonical.y+1)/c;let U=s._centerAltitude;if(x){const oe=x.getMinMaxForTile(_);oe&&oe.max>U&&(U=oe.max)}const $=i.ay(g.x,E,I)-g.x,Q=i.ay(g.y,k,j)-g.y,J=i.bH(U,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt($*$+Q*Q+J*J))}function cl(_,s,c,g,x,E,I){const k=_.context,j=_.renderPass==="shadow",U=_.shadowRenderer,$=j&&U?U.getShadowPassDepthMode():new En(k.gl.LEQUAL,En.ReadWrite,_.depthRangeFor3D),Q=_.isTileAffectedByFog(E);if(c.meshes)for(const J of c.meshes){const oe=["MODEL_POSITION_ON_GPU"],pe=[];let ce,me,ve;g.instancedDataArray.length>20&&oe.push("INSTANCED_ARRAYS");const Ee=Vu(_,s.paint.get("model-cutoff-fade-range"));if(Ee.shouldRenderCutoff&&oe.push("RENDER_CUTOFF"),j&&U)ce=_.getOrCreateProgram("modelDepth",{defines:oe}),me=cy(I.shadowTileMatrix,I.shadowTileMatrix,Float32Array.from(c.matrix)),ve=U.getShadowPassColorMode();else{Lc(oe,pe,J,_,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),ce=_.getOrCreateProgram("model",{defines:oe,overrideFog:Q});const Ie=J.material,Be=Ie.pbrMetallicRoughness,Oe=s.paint.get("model-opacity").constantOr(1),Ne=s.paint.get("model-emissive-strength").constantOr(0);me=dm(E.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,_,Oe,Be.baseColorFactor.toRenderColor(null),Ie.emissiveFactor,Be.metallicFactor,Be.roughnessFactor,Ie,Ne,s,x),U&&(I.shadowUniformsInitialized?ce.setShadowUniformValues(k,U.getShadowUniformValues()):(U.setupShadows(E.toUnwrapped(),ce,"model-tile",E.overscaledZ),I.shadowUniformsInitialized=!0)),ve=Ee.shouldRenderCutoff||Oe<1||Ie.alphaMode!=="OPAQUE"?pr.alphaBlended:pr.unblended}_.uploadCommonUniforms(k,ce,E.toUnwrapped(),null,Ee);const Pe=J.material.doubleSided?Fn.disabled:Fn.backCCW;if(g.instancedDataArray.length>20)pe.push(g.instancedDataBuffer),ce.draw(_,k.gl.TRIANGLES,$,Vn.disabled,ve,Pe,me,s.id,J.vertexBuffer,J.indexBuffer,J.segments,s.paint,_.transform.zoom,void 0,pe,g.instancedDataArray.length);else{const Ie=j?"u_instance":"u_normal_matrix";for(let Be=0;Be<g.instancedDataArray.length;++Be)me[Ie]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Be,16),ce.draw(_,k.gl.TRIANGLES,$,Vn.disabled,ve,Pe,me,s.id,J.vertexBuffer,J.indexBuffer,J.segments,s.paint,_.transform.zoom,void 0,pe)}}if(c.children)for(const J of c.children)cl(_,s,J,g,x,E,I)}const Ps=[1,-1,1];function fa(_,s,c,g){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const E=c.shadowRenderer,I=s.aabb;let k=!0,j=_.maxHeight;if(j===0){let $=0;for(const Q in _.instancesPerModel){const J=x.getModel(Q,g);J?$=Math.max($,Math.max(Math.max(J.aabb.max[0],J.aabb.max[1]),J.aabb.max[2])):k=!1}j=_.maxScale*$*1.41+_.maxVerticalOffset,k&&(_.maxHeight=j)}I.max[2]=j,I.min[2]+=_.terrainElevationMin,I.max[2]+=_.terrainElevationMax,i.ad.vec3.transformMat4(I.min,I.min,s.tileMatrix),i.ad.vec3.transformMat4(I.max,I.max,s.tileMatrix);const U=I.intersects(E.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(_.isInsideFirstShadowMapFrustum=U===2),U===0}function Ph(_,s){const c=_.uniformValues.u_cutoff_params[0],g=_.uniformValues.u_cutoff_params[1],x=_.uniformValues.u_cutoff_params[2],E=_.uniformValues.u_cutoff_params[3];return g===c||E===x?1:i.ay(((s-c)/(g-c)-x)/(E-x),0,1)}function wm(_,s,c,g){if(s.pitch<20)return 1;const x=s.getWorldToCameraMatrix();i.ad.mat4.multiply(x,x,_);const E=i.ad.vec4.fromValues(c.min[0],c.min[1],c.min[2],1);let I=i.ad.vec4.transformMat4(i.ad.vec4.create(),E,x),k=I,j=I;E[1]=c.max[1],I=i.ad.vec4.transformMat4(i.ad.vec4.create(),E,x),k=I[1]<k[1]?I:k,j=I[1]>j[1]?I:j,E[0]=c.max[0],I=i.ad.vec4.transformMat4(i.ad.vec4.create(),E,x),k=I[1]<k[1]?I:k,j=I[1]>j[1]?I:j,E[1]=c.min[1],I=i.ad.vec4.transformMat4(i.ad.vec4.create(),E,x),k=I[1]<k[1]?I:k,j=I[1]>j[1]?I:j;const U=i.ay(g[0],0,1),$=100*s.pixelsPerMeter*i.ay(g[1],0,1),Q=i.ay(g[2],0,1),J=i.ad.vec4.lerp(i.ad.vec4.create(),k,j,U),oe=Math.tan(.5*s.fovX),pe=-J[2]*oe;if($===0)return J[1]<-Math.abs(pe)?Q:1;const ce=(-Math.abs(pe)-J[1])/$,me=(Ee,Pe,Ie)=>(1-Ie)*Ee+Ie*Pe,ve=i.ay(me(1,Q,ce),Q,1);return me(1,ve,i.ay((s.pitch-20)/20,0,1))}class Sm{}class Ah{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,g){{const Q=this._storage.get(c.id);if(Q)return Q.lastUsedFrameIdx=s,Q.buf}const x=g.gl,E=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),I=new ArrayBuffer(E),k=new Int16Array(I);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(I));const j=new i.dt;for(let Q=0;Q<E/2;Q+=3){const J=k[Q],oe=k[Q+1],pe=k[Q+2];j.emplaceBack(J,oe),j.emplaceBack(oe,pe),j.emplaceBack(pe,J)}const U=g.bindVertexArrayOES.current,$=new Sm;return $.buf=new lu(g,j),$.lastUsedFrameIdx=s,this._storage.set(c.id,$),g.bindVertexArrayOES.set(U),$.buf}update(s){for(const[c,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class Ng{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Oc=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class kg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ep{constructor(s,c){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Fg=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class zg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,c){const g=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const I=new i.du,k=new i.aV;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(1,1),I.emplaceBack(-1,1),k.emplaceBack(0,1,2),k.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(I,Fg.members),this.vignetteIdx=s.context.createIndexBuffer(k)}const x=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,g);const I={u_vignetteShape:(E={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:E.vignetteColor};g.draw(s,s.context.gl.TRIANGLES,En.disabled,Vn.disabled,pr.alphaBlended,Fn.disabled,I,"vignette",this.vignetteVx,this.vignetteIdx,x)}var E}}class Qo{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,c){const g=s.getFreeCameraOptions().position,x=g.toAltitude(),E=g.toLngLat(),I=i.ak(E.lng),k=i.ak(E.lat),j=s.pixelsPerMeter/c,U=I*i.dv,$=i.dv*Math.log(Math.tan(Math.PI/4+k/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+$,J=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+U)*j,this._accumulatedOffsetY+=Q*j,this._accumulatedElevation+=J*j,this._offsetXPrev=U,this._offsetYPrev=$,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Rh(_,s){return[-(_[0]-Math.floor(_[0]/s)*s),-(_[1]-Math.floor(_[1]/s)*s),-(_[2]-Math.floor(_[2]/s)*s)]}function Em(_){const s=i.dl(1323123451230),c=[];for(let g=0;g<_;++g){const x=2*s()-1,E=2*s()-1,I=2*s()-1;c.push(i.ad.vec3.fromValues(x,E,I))}return c}function As(_,s,c,g,x){const E=i.ay((x-c)/(g-c),0,1);return(1-E)*_+E*s}class Ld{constructor(s){this._movement=new Qo,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new zg,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,c){const g=s.transform;this._movement.update(g,this._ppmScaleFactor);const x=g.starsProjMatrix,E=i.ad.quat.identity([]);i.ad.quat.rotateX(E,E,i.ak(90)-g._pitch),i.ad.quat.rotateZ(E,E,-g.angle);const I=i.ad.mat4.fromQuat(new Float32Array(16),E),k=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),j=i.ad.mat4.transpose([],k),U=i.ad.mat4.multiply([],j,I),$=Date.now()/1e3;return this._accumulatedTimeFromStart+=($-this._prevTime)*c,this._prevTime=$,{projectionMatrix:x,modelviewMatrix:U}}}class Bg extends Ld{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ep(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const g=Em(this.particlesCount),x=new i.dw,E=new i.aV;let I=0;const k=i.dl(1323123451230);for(let j=0;j<g.length;++j){const U=g[j],$=[2*k()-1,k(),k(),k()];x.emplaceBack(U[0],U[1],U[2],-1,-1,...$),x.emplaceBack(U[0],U[1],U[2],1,-1,...$),x.emplaceBack(U[0],U[1],U[2],1,1,...$),x.emplaceBack(U[0],U[1],U[2],-1,1,...$),E.emplaceBack(I+0,I+1,I+2),E.emplaceBack(I+0,I+2,I+3),I+=4}this.particlesVx=c.createVertexBuffer(x,Oc.members),this.particlesIdx=c.createIndexBuffer(E)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=s.transform.zoom;if(c.revealStart>g)return;const x=As(0,1,c.revealStart,c.revealStart+c.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const E=structuredClone(this._params);let I=[-E.direction.x,E.direction.y,-100];i.ad.vec3.normalize(I,I);const k=structuredClone(this._vignetteParams);k.strength*=x,E.overrideStyleParameters||(E.intensity=s.style.rain.state.density,E.timeFactor=s.style.rain.state.intensity,E.color=structuredClone(s.style.rain.state.color),I=structuredClone(s.style.rain.state.direction),E.screenThinning.intensity=s.style.rain.state.centerThinning,E.dropletSizeX=s.style.rain.state.dropletSize[0],E.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],E.distortionStrength=100*s.style.rain.state.distortionStrength,k.strength=1,k.color=structuredClone(s.style.rain.state.vignetteColor));const j=this.updateOnRender(s,E.timeFactor),U=s.context,$=U.gl,Q=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new i.T(U,{width:s.width,height:s.height,data:null},$.RGBA8)),E.distortionStrength>0&&(U.activeTexture.set($.TEXTURE0),this.screenTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),$.copyTexSubImage2D($.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const J=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(U,J),U.activeTexture.set($.TEXTURE0),this.screenTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const oe=[E.color.r,E.color.g,E.color.b,E.color.a],pe=(ce,me)=>{const ve=Rh(this._movement.getPosition(),ce),Ee=E.dropletSizeX,Pe=E.dropletSizeX*E.dropletSizeYScale,Ie=s.width/2,Be=s.height/2,Oe=As(0,E.screenThinning.start,0,1,E.screenThinning.intensity),Ne=As(.001,E.screenThinning.range,0,1,E.screenThinning.intensity),ze=As(0,E.screenThinning.particleOffset,0,1,E.screenThinning.intensity),Ue=(Ye={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ve,velocityConeAperture:E.velocityConeAperture,velocity:E.velocity,boxSize:ce,rainDropletSize:[Ee,Pe],distortionStrength:E.distortionStrength,rainDirection:I,color:oe,screenSize:[Q.width,Q.height],thinningCenterPos:[Ie,Be],thinningShape:[Oe,Ne,Math.pow(10,E.screenThinning.fadePower)],thinningAffectedRatio:E.screenThinning.affectedRatio,thinningParticleOffset:ze,shapeDirectionalPower:E.shapeDirPower,shapeNormalPower:E.shapeNormalPower,mode:me?0:1},{u_modelview:Float32Array.from(Ye.modelview),u_projection:Float32Array.from(Ye.projection),u_time:Ye.time,u_cam_pos:Ye.camPos,u_texScreen:0,u_velocityConeAperture:Ye.velocityConeAperture,u_velocity:Ye.velocity,u_boxSize:Ye.boxSize,u_rainDropletSize:Ye.rainDropletSize,u_distortionStrength:Ye.distortionStrength,u_rainDirection:Ye.rainDirection,u_color:Ye.color,u_screenSize:Ye.screenSize,u_thinningCenterPos:Ye.thinningCenterPos,u_thinningShape:Ye.thinningShape,u_thinningAffectedRatio:Ye.thinningAffectedRatio,u_thinningParticleOffset:Ye.thinningParticleOffset,u_shapeDirectionalPower:Ye.shapeDirectionalPower,u_shapeNormalPower:Ye.shapeNormalPower,u_mode:Ye.mode});var Ye;const vt=Math.round(E.intensity*this.particlesCount),ct=i.b8.simpleSegment(0,0,4*vt,2*vt);J.draw(s,$.TRIANGLES,En.disabled,Vn.disabled,pr.alphaBlended,Fn.disabled,Ue,"rain_particles",this.particlesVx,this.particlesIdx,ct)};E.distortionStrength>0&&pe(E.boxSize,!0),pe(E.boxSize,!1),this._vignette.draw(s,k)}}const Cm=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Od extends Ld{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ep(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const g=Em(this.particlesCount),x=new i.dx,E=new i.aV;let I=0;const k=i.dl(1323123451230);for(let j=0;j<g.length;++j){const U=g[j],$=k(),Q=k(),J=k(),oe=[j/g.length,$,Q,J],pe=[k(),k()];x.emplaceBack(U[0],U[1],U[2],-1,-1,...oe,...pe),x.emplaceBack(U[0],U[1],U[2],1,-1,...oe,...pe),x.emplaceBack(U[0],U[1],U[2],1,1,...oe,...pe),x.emplaceBack(U[0],U[1],U[2],-1,1,...oe,...pe),E.emplaceBack(I+0,I+1,I+2),E.emplaceBack(I+0,I+2,I+3),I+=4}this.particlesVx=c.createVertexBuffer(x,Cm.members),this.particlesIdx=c.createIndexBuffer(E)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const c=structuredClone(this._params);let g=[-c.direction.x,c.direction.y,-100];i.ad.vec3.normalize(g,g);const x=structuredClone(this._vignetteParams),E=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},I=s.transform.zoom;if(E.revealStart>I)return;const k=As(0,1,E.revealStart,E.revealStart+E.revealRange,I);x.strength*=k,c.overrideStyleParameters||(c.intensity=s.style.snow.state.density,c.timeFactor=s.style.snow.state.intensity,c.color=structuredClone(s.style.snow.state.color),g=structuredClone(s.style.snow.state.direction),c.screenThinning.intensity=s.style.snow.state.centerThinning,c.billboardSize=2.79*s.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(s.style.snow.state.vignetteColor));const j=this.updateOnRender(s,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const U=s.context,$=U.gl,Q=s.transform,J=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(U,J),((oe,pe,ce)=>{const me=Rh(this._movement.getPosition(),oe),ve=Q.width/2,Ee=Q.height/2,Pe=As(0,ce.screenThinning.start,0,1,ce.screenThinning.intensity),Ie=As(.001,ce.screenThinning.range,0,1,ce.screenThinning.intensity),Be=As(0,ce.screenThinning.particleOffset,0,1,ce.screenThinning.intensity),Oe=(Ne={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:ce.velocityConeAperture,velocity:ce.velocity,horizontalOscillationRadius:ce.horizontalOscillationRadius,horizontalOscillationRate:ce.horizontalOscillationRate,boxSize:oe,billboardSize:1*ce.billboardSize,simpleShapeParameters:[ce.shapeFadeStart,ce.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[ve,Ee],thinningShape:[Pe,Ie,Math.pow(10,ce.screenThinning.fadePower)],thinningAffectedRatio:ce.screenThinning.affectedRatio,thinningParticleOffset:Be,color:[ce.color.r,ce.color.g,ce.color.b,ce.color.a],direction:g},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_horizontalOscillationRadius:Ne.horizontalOscillationRadius,u_horizontalOscillationRate:Ne.horizontalOscillationRate,u_boxSize:Ne.boxSize,u_billboardSize:Ne.billboardSize,u_simpleShapeParameters:Ne.simpleShapeParameters,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_particleColor:Ne.color,u_direction:Ne.direction});var Ne;const ze=Math.round(ce.intensity*this.particlesCount),Ue=i.b8.simpleSegment(0,0,4*ze,2*ze);this.particlesVx&&this.particlesIdx&&J.draw(s,$.TRIANGLES,En.disabled,Vn.disabled,pr.alphaBlended,Fn.disabled,Oe,"snow_particles",this.particlesVx,this.particlesIdx,Ue)})(c.boxSize,0,c),this._vignette.draw(s,x)}}const tp={symbol:function(_,s,c,g,x){if(_.renderPass!=="translucent")return;const E=Vn.disabled,I=_.colorModeForRenderPass(),k=c.layout.get("text-variable-anchor"),j=c.layout.get("text-size-scale-range"),U=i.ay(_.scaleFactor,j[0],j[1]);k&&function(J,oe,pe,ce,me,ve,Ee,Pe){const Ie=oe.transform,Be=me==="map",Oe=ve==="map";for(const Ne of J){const ze=ce.getTile(Ne),Ue=ze.getBucket(pe);if(!Ue||!Ue.text||!Ue.text.segments.get().length)continue;const Ye=i.bp(Ue.textSizeData,Ie.zoom,Pe),vt=aa(Ne,Ue.getProjection(),Ie),ct=Ie.calculatePixelsToTileUnitsMatrix(ze),Pt=Cl(vt,ze.tileID.canonical,Oe,Be,Ie,Ue.getProjection(),ct),At=Ue.hasIconTextFit()&&Ue.hasIconData();if(Ye){const jt=Math.pow(2,Ie.zoom-ze.tileID.overscaledZ);da(Ue,Be,Oe,Ee,i.cY,Ie,Pt,Ne,jt,Ye,At)}}}(g,_,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,U);const $=c.paint.get("icon-opacity").constantOr(1)!==0,Q=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&($||Q)?ei(_,s,c,g,E,I):($&&ei(_,s,c,g,E,I,{onlyIcons:!0}),Q&&ei(_,s,c,g,E,I,{onlyText:!0})),s.map.showCollisionBoxes&&(pm(_,s,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),pm(_,s,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(_,s,c,g){if(_.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),E=c.paint.get("circle-stroke-width"),I=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0,j=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(E.constantOr(1)===0||I.constantOr(1)===0))return;const U=_.context,$=U.gl,Q=_.transform,J=_.depthModeForSublayer(0,En.ReadOnly),oe=Vn.disabled,pe=_.colorModeForDrapableLayerRenderPass(j),ce=Q.projection.name==="globe",me=[i.av(Q.center.lng),i.aC(Q.center.lat)],ve=[];for(let Pe=0;Pe<g.length;Pe++){const Ie=g[Pe],Be=s.getTile(Ie),Oe=Be.getBucket(c);if(!Oe||Oe.projection.name!==Q.projection.name)continue;const Ne=Oe.programConfigurations.get(c.id),ze=i.cZ(c),Ue=_.isTileAffectedByFog(Ie);ce&&ze.push("PROJECTION_GLOBE_VIEW"),ze.push("DEPTH_D24"),_.terrain&&Q.depthOcclusionForSymbolsAndCircles&&ze.push("DEPTH_OCCLUSION");const Ye=_.getOrCreateProgram("circle",{config:Ne,defines:ze,overrideFog:Ue}),vt=Oe.layoutVertexBuffer,ct=Oe.globeExtVertexBuffer,Pt=Oe.indexBuffer,At=Q.projection.createInversionMatrix(Q,Ie.canonical),jt={programConfiguration:Ne,program:Ye,layoutVertexBuffer:vt,globeExtVertexBuffer:ct,indexBuffer:Pt,uniformValues:i.c_(_,Ie,Be,At,me,c),tile:Be};if(k){const ut=Oe.segments.get();for(const It of ut)ve.push({segments:new i.b8([It]),sortKey:It.sortKey,state:jt})}else ve.push({segments:Oe.segments,sortKey:0,state:jt})}k&&ve.sort((Pe,Ie)=>Pe.sortKey-Ie.sortKey);const Ee={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Pe of ve){const{programConfiguration:Ie,program:Be,layoutVertexBuffer:Oe,globeExtVertexBuffer:Ne,indexBuffer:ze,uniformValues:Ue,tile:Ye}=Pe.state,vt=Pe.segments;_.terrain&&_.terrain.setupElevationDraw(Ye,Be,Ee),_.uploadCommonUniforms(U,Be,Ye.tileID.toUnwrapped()),Be.draw(_,$.TRIANGLES,J,oe,pe,Fn.disabled,Ue,c.id,Oe,ze,vt,c.paint,Q.zoom,Ie,[Ne])}},heatmap:function(_,s,c,g){if(c.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const x=_.context,E=x.gl,I=Vn.disabled,k=new pr([E.ONE,E.ONE,E.ONE,E.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(oe,pe,ce,me){const ve=oe.gl,Ee=pe.width*me,Pe=pe.height*me;oe.activeTexture.set(ve.TEXTURE1),oe.viewport.set([0,0,Ee,Pe]);let Ie=ce.heatmapFbo;if(!Ie||Ie&&(Ie.width!==Ee||Ie.height!==Pe)){Ie&&Ie.destroy();const Be=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,Be),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),Ie=ce.heatmapFbo=oe.createFramebuffer(Ee,Pe,!0,null),function(Oe,Ne,ze,Ue,Ye,vt){const ct=Oe.gl;ct.texImage2D(ct.TEXTURE_2D,0,Oe.extRenderToTextureHalfFloat?ct.RGBA16F:ct.RGBA,Ye,vt,0,ct.RGBA,Oe.extRenderToTextureHalfFloat?ct.HALF_FLOAT:ct.UNSIGNED_BYTE,null),Ue.colorAttachment.set(ze)}(oe,0,Be,Ie,Ee,Pe)}else ve.bindTexture(ve.TEXTURE_2D,Ie.colorAttachment.get()),oe.bindFramebuffer.set(Ie.framebuffer)})(x,_,c,_.transform.projection.name==="globe"?.5:.25),x.clear({color:i.al.transparent});const j=_.transform,U=j.projection.name==="globe",$=U?["PROJECTION_GLOBE_VIEW"]:[],Q=U?Fn.frontCCW:Fn.disabled,J=[i.av(j.center.lng),i.aC(j.center.lat)];for(let oe=0;oe<g.length;oe++){const pe=g[oe];if(s.hasRenderableParent(pe))continue;const ce=s.getTile(pe),me=ce.getBucket(c);if(!me||me.projection.name!==j.projection.name)continue;const ve=_.isTileAffectedByFog(pe),Ee=me.programConfigurations.get(c.id),Pe=_.getOrCreateProgram("heatmap",{config:Ee,defines:$,overrideFog:ve}),{zoom:Ie}=_.transform;_.terrain&&_.terrain.setupElevationDraw(ce,Pe),_.uploadCommonUniforms(x,Pe,pe.toUnwrapped());const Be=j.projection.createInversionMatrix(j,pe.canonical);Pe.draw(_,E.TRIANGLES,En.disabled,I,k,Q,Wu(_,pe,ce,Be,J,Ie,c.paint.get("heatmap-intensity")),c.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,c.paint,_.transform.zoom,Ee,U?[me.globeExtVertexBuffer]:null)}x.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(x,E){const I=x.context,k=I.gl,j=E.heatmapFbo;if(!j)return;I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,j.colorAttachment.get()),I.activeTexture.set(k.TEXTURE1);let U=E.colorRampTexture;U||(U=E.colorRampTexture=new i.T(I,E.colorRamp,k.RGBA8)),U.bind(k.LINEAR,k.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,k.TRIANGLES,En.disabled,Vn.disabled,x.colorModeForRenderPass(),Fn.disabled,(($,Q,J,oe)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,E),E.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,E.paint,x.transform.zoom)}(_,c))},line:function(_,s,c,g){if(_.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),E=c.paint.get("line-width");if(x.constantOr(1)===0||E.constantOr(1)===0)return;const I=c.paint.get("line-emissive-strength"),k=c.paint.get("line-occlusion-opacity"),j=c.layout.get("line-elevation-reference"),U=c.layout.get("line-width-unit")==="meters",$=j==="sea",Q=_.context,J=Q.gl;if(c.hasElevatedBuckets&&_.transform.projection.name==="globe")return;const oe=c.layout.get("line-cross-slope"),pe=oe!==void 0,ce=oe<1,me=_.colorModeForDrapableLayerRenderPass(I),ve=_.terrain&&_.terrain.renderingToTexture,Ee=ve?1:i.q.devicePixelRatio,Pe=c.paint.get("line-dasharray"),Ie=Pe.constantOr(1),Be=c.layout.get("line-cap"),Oe=Pe.constantOr(null),Ne=Be.constantOr(null),ze=c.paint.get("line-pattern"),Ue=ze.constantOr(1),Ye=ze.constantOr(null),vt=c.paint.get("line-opacity").constantOr(1);let ct=!Ue&&vt!==1||_.depthOcclusion&&k>0&&k<1;const Pt=c.paint.get("line-gradient"),At=Ue?"linePattern":"line",jt=i.c$(c);let ut;if(ve&&_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(ct=!1),k!==0&&_.depthOcclusion){const nt=c.paint._values["line-opacity"];nt&&nt.value&&nt.value.kind==="constant"?ut=nt.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}E.value.kind!=="constant"&&E.value.isLineProgressConstant===!1&&jt.push("VARIABLE_LINE_WIDTH");const It=(nt,Mt,St,Rt,xt,Lt)=>{for(const en of nt){const tn=s.getTile(en);if(Ue&&!tn.patternsLoaded())continue;const rn=tn.getBucket(c);if(!rn||rn.hasZOffset&&!xt||!rn.hasZOffset&&xt)continue;_.prepareDrawTile();const fn=rn.programConfigurations.get(c.id),kn=_.isTileAffectedByFog(en),vn=_.getOrCreateProgram(At,{config:fn,defines:Mt,overrideFog:kn,overrideRtt:!xt&&void 0});if(Ye&&tn.imageAtlas){const Nn=i.d0.from(Ye).getPrimary().scaleSelf(Ee).toString(),mn=tn.imageAtlas.patternPositions.get(Nn);mn&&fn.setConstantPatternPositions(mn)}if(!Ue&&Oe&&Ne&&tn.lineAtlas){const Nn=tn.lineAtlas.getDash(Oe,Ne);Nn&&fn.setConstantPatternPositions(Nn)}let[Ln,Mn]=c.paint.get("line-trim-offset");(Ne==="round"||Ne==="square")&&Ln!==Mn&&(Ln===0&&(Ln-=1),Mn===1&&(Mn+=1));const Hn=ve?en.projMatrix:null,Nr=U?1/rn.tileToMeter/i.at(tn,1,_.transform.zoom):1,ii=U?1/rn.tileToMeter/i.at(tn,1,Math.floor(_.transform.zoom)):1,ir=Ue?i.d1(_,tn,c,Hn,Ee,Nr,ii,[Ln,Mn]):i.d2(_,tn,c,Hn,rn.lineClipsArray.length,Ee,Nr,ii,[Ln,Mn]);if(Pt){const Nn=rn.gradients[c.id];let mn=Nn.texture;if(c.gradientVersion!==Nn.version){let _r=256;if(c.stepInterpolant){const Pr=s.getSource().maxzoom,Ar=en.canonical.z===Pr?Math.ceil(1<<_.transform.maxZoom-en.canonical.z):1;_r=i.ay(i.d3(rn.maxLineLength/i.ai*1024*Ar),256,Q.maxTextureSize)}Nn.gradient=i.d4({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:_r,image:Nn.gradient||void 0,clips:rn.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new i.T(Q,Nn.gradient,J.RGBA8),Nn.version=c.gradientVersion,mn=Nn.texture}Q.activeTexture.set(J.TEXTURE1),mn.bind(c.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Ie&&(Q.activeTexture.set(J.TEXTURE0),tn.lineAtlasTexture&&tn.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),fn.updatePaintBuffers()),Ue&&(Q.activeTexture.set(J.TEXTURE0),tn.imageAtlasTexture&&tn.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),fn.updatePaintBuffers()),xt&&!$&&_.terrain.setupElevationDraw(tn,vn),_.uploadCommonUniforms(Q,vn,en.toUnwrapped());const Ii=Nn=>{ut!=null&&(ut.value=vt*k),vn.draw(_,J.TRIANGLES,St,Nn,me,Fn.disabled,ir,c.id,rn.layoutVertexBuffer,rn.indexBuffer,rn.segments,c.paint,_.transform.zoom,fn,[rn.layoutVertexBuffer2,rn.patternVertexBuffer,rn.zOffsetVertexBuffer]),ut!=null&&(ut.value=vt)};if(ct&&!xt){const Nn=_.stencilModeForClipping(en).ref;Nn===0&&ve&&Q.clear({stencil:0});const mn={func:J.EQUAL,mask:255};ir.u_alpha_discard_threshold=.8,Ii(new Vn(mn,Nn,255,J.KEEP,J.KEEP,J.INVERT)),ir.u_alpha_discard_threshold=0,Ii(new Vn(mn,Nn,255,J.KEEP,J.KEEP,J.KEEP))}else ir.u_alpha_discard_threshold=ct&&xt&&Lt?.8:0,Ii(xt?Rt:_.stencilModeForClipping(en))}};if(c.hasNonElevatedBuckets){const nt=!ve&&_.terrain;k!==0&&nt?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):nt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):It(g,jt,_.depthModeForSublayer(0,En.ReadOnly),Vn.disabled,!1,!0)}if(c.hasElevatedBuckets){jt.push("ELEVATED"),pe&&jt.push(ce?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),$&&jt.push("ELEVATION_REFERENCE_SEA");const nt=ct?_.stencilModeFor3D():Vn.disabled,Mt=new En(_.depthOcclusion?J.GREATER:J.LEQUAL,En.ReadOnly,_.depthRangeFor3D);_.forceTerrainMode=!0,It(g,jt,Mt,nt,!0,!0),ct&&It(g,jt,Mt,nt,!0,!1),_.forceTerrainMode=!1}ct&&(_.resetStencilClippingMasks(),ve&&Q.clear({stencil:0})),k===0||_.depthOcclusion||ve||_.layersWithOcclusionOpacity.push(_.currentLayer)},fill:function(_,s,c,g){const x=c.paint.get("fill-color"),E=c.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const I=c.paint.get("fill-emissive-strength"),k=_.colorModeForDrapableLayerRenderPass(I),j=c.paint.get("fill-pattern"),U=_.opaquePassEnabledForLayer()&&!j.constantOr(1)&&x.constantOr(i.al.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";let $="none";c.layout.get("fill-elevation-reference")!=="none"?$="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&($="offset");const Q=!(!_.terrain||!_.terrain.enabled),J={painter:_,sourceCache:s,layer:c,coords:g,colorMode:k,elevationType:$,terrainEnabled:Q,pass:U};if($!=="offset"){if(Yf(J,!1),$==="road"){const oe=!Q&&_.renderPass==="translucent";oe&&gm(_,s,c,g,"geometry"),Yf(J,!0,Vn.disabled),oe&&function(pe){const{painter:ce,sourceCache:me,layer:ve,coords:Ee,colorMode:Pe}=pe,Ie=ce.context.gl,Be=new En(ce.context.gl.LEQUAL,En.ReadOnly,ce.depthRangeFor3D);for(const Oe of Ee){const Ne=me.getTile(Oe),ze=Ne.getBucket(ve);if(!ze)continue;const Ue=ze.elevatedStructures;if(!Ue||!Ue.renderableSegments||Ue.renderableSegments.segments[0].primitiveLength===0)continue;ce.prepareDrawTile();const Ye=ze.bufferData.programConfigurations.get(ve.id),vt=ce.isTileAffectedByFog(Oe),ct=ce.getOrCreateProgram("elevatedStructures",{config:Ye,overrideFog:vt,defines:["NORMAL_OFFSET"]}),Pt={u_matrix:ce.translatePosMatrix(Oe.projMatrix,Ne,ve.paint.get("fill-translate"),ve.paint.get("fill-translate-anchor"))};ce.uploadCommonUniforms(ce.context,ct,Oe.toUnwrapped()),ct.draw(ce,Ie.TRIANGLES,Be,Vn.disabled,Pe,Fn.backCCW,Pt,ve.id,Ue.vertexBuffer,Ue.indexBuffer,Ue.renderableSegments,ve.paint,ce.transform.zoom,Ye,[Ue.vertexBufferNormal])}}(J)}}else Yf(J,!1,_.stencilModeFor3D())},"fill-extrusion":function(_,s,c,g){const x=c.paint.get("fill-extrusion-opacity"),E=_.context,I=E.gl,k=_.terrain,j=k&&k.renderingToTexture;if(x===0)return;const U=_.conflationActive&&_.style.isLayerClipped(c,s.getSource()),$=_.style.order.indexOf(c.fqid);if(U&&function(Q,J,oe,pe,ce){for(const me of pe){const ve=J.getTile(me).getBucket(oe);ve&&(ve.updateReplacement(me,Q.replacementSource,ce),ve.uploadCentroid(Q.context))}}(_,s,c,g,$),k||U)for(const Q of g){const J=s.getTile(Q).getBucket(c);J&&Ms(_.context,s,Q,J,c,k,U)}if(_.renderPass==="shadow"&&_.shadowRenderer){const Q=_.shadowRenderer;if(k&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const J=Q.getShadowPassDepthMode(),oe=Q.getShadowPassColorMode();Pd(_,s,c,g,J,Vn.disabled,oe,U)}else if(_.renderPass==="translucent"){const Q=!c.paint.get("fill-extrusion-pattern").constantOr(1),J=c.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!j&&J.a!==0){const oe=new En(_.context.gl.LEQUAL,En.ReadWrite,_.depthRangeFor3D);x===1&&Q?Pd(_,s,c,g,oe,Vn.disabled,pr.unblended,U):(Pd(_,s,c,g,oe,Vn.disabled,pr.disabled,U),Pd(_,s,c,g,oe,_.stencilModeFor3D(),_.colorModeForRenderPass(),U),_.resetStencilClippingMasks())}if(_.style.enable3dLights()&&Q&&(!k&&_.transform.projection.name!=="globe"||j)){const oe=c.paint.get("fill-extrusion-opacity"),pe=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ce=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),me=c.paint.get("fill-extrusion-flood-light-intensity"),ve=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ee=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(ve?null:c.lut).toArray01().slice(0,3),Pe=pe>0&&ce>0,Ie=me>0,Be=(Ne,ze,Ue)=>(1-Ue)*Ne+Ue*ze,Oe=Ne=>{const ze=_.depthModeForSublayer(1,En.ReadOnly,I.LEQUAL,!0),Ue=c.paint.get(Ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=Be(.1,3,Ue),vt=_._showOverdrawInspector;if(!vt){const ct=new Vn({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),Pt=new pr([I.ONE,I.ONE,I.ONE,I.ONE],i.al.transparent,[!1,!1,!1,!0],I.MIN);cu(_,s,c,g,ze,ct,Pt,Fn.disabled,Ne,"sdf",oe,pe,ce,me,Ee,Ye,U,!1)}{const ct=vt?Vn.disabled:new Vn({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),Pt=vt?_.colorModeForRenderPass():new pr([I.ONE_MINUS_DST_ALPHA,I.DST_ALPHA,I.ONE,I.ONE],i.al.transparent,[!0,!0,!0,!0]);cu(_,s,c,g,ze,ct,Pt,Fn.disabled,Ne,"color",oe,pe,ce,me,Ee,Ye,U,!1)}};if(j){const Ne=(ze,Ue,Ye)=>{const vt=_.depthModeForSublayer(1,En.ReadOnly,I.LEQUAL,!1),ct=c.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pt=Be(.1,3,ct);{const At=new pr([I.ONE,I.ONE,I.ONE,I.ONE],i.al.transparent,[!1,!1,!1,!0]);cu(_,s,c,g,vt,Vn.disabled,At,Fn.disabled,ze,"clear",oe,pe,ce,me,Ee,Pt,U,Ue)}{const At=new Vn({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),jt=new pr([I.ONE,I.ONE,I.ONE,I.ONE],i.al.transparent,[!1,!1,!1,!0],I.MIN);cu(_,s,c,g,vt,At,jt,Fn.disabled,ze,"sdf",oe,pe,ce,me,Ee,Pt,U,Ue)}{const At=ze?I.ZERO:I.ONE_MINUS_DST_ALPHA,jt=new Vn({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),ut=new pr([At,I.DST_ALPHA,I.ONE_MINUS_DST_ALPHA,I.ZERO],i.al.transparent,[!0,!0,!0,!0]);cu(_,s,c,g,vt,jt,ut,Fn.disabled,ze,"color",oe,pe,ce,me,Ee,Pt,U,Ue)}{const At=new pr([I.ONE,I.ONE,I.ONE,ze?I.ZERO:I.ONE],i.al.transparent,[!1,!1,!1,!0],ze?I.FUNC_ADD:I.MAX);cu(_,s,c,g,vt,Vn.disabled,At,Fn.disabled,ze,"clear",oe,pe,ce,me,Ee,Pt,U,Ue,Ye)}};if(Pe||Ie){let ze;if(_.prepareDrawTile(),k){const Ue=k.drapeBufferSize[0],Ye=k.drapeBufferSize[1];ze=k.framebufferCopyTexture,ze&&(!ze||ze.size[0]===Ue&&ze.size[1]===Ye)||(ze&&ze.destroy(),ze=k.framebufferCopyTexture=new i.T(E,new i.r({width:Ue,height:Ye}),I.RGBA8)),ze.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,Ue,Ye)}Pe&&Ne(!0,!1,ze),Ie&&Ne(!1,!0,ze)}}else Pe&&Oe(!0),Ie&&Oe(!1),(Pe||Ie)&&_.resetStencilClippingMasks()}}},hillshade:function(_,s,c,g){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent"||_.style.disableElevatedTerrain)return;const x=_.context,E=_.terrain&&_.terrain.renderingToTexture,[I,k]=_.renderPass!=="translucent"||E?[{},g]:_.stencilConfigForOverlap(g);for(const j of k){const U=s.getTile(j);if(U.needsHillshadePrepare&&_.renderPass==="offscreen")nm(_,U,c);else if(_.renderPass==="translucent"){const $=_.depthModeForSublayer(0,En.ReadOnly),Q=c.paint.get("hillshade-emissive-strength"),J=_.colorModeForDrapableLayerRenderPass(Q),oe=E&&_.terrain?_.terrain.stencilModeForRTTOverlap(j):I[j.overscaledZ];kf(_,j,U,c,$,oe,J)}}x.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,s,c,g,x,E){if(_.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const I=_.transform.projection.name==="globe",k=c.paint.get("raster-elevation")!==0,j=k&&I;if(_.renderElevatedRasterBackface&&!j)return;const U=_.context,$=U.gl,Q=s.getSource(),J=function(Oe,Ne,ze,Ue){const Ye=Ne.paint.get("raster-color"),vt=Oe.type==="raster-array",ct=[],Pt=Ne.paint.get("raster-resampling"),At=Ne.paint.get("raster-color-mix");let jt=Ne.paint.get("raster-color-range");const ut=[At[0],At[1],At[2],0],It=At[3];let nt=Pt==="nearest"?Ue.NEAREST:Ue.LINEAR;if(vt&&(ct.push("RASTER_ARRAY"),Ye||ct.push("RASTER_COLOR"),Pt==="linear"&&ct.push("RASTER_ARRAY_LINEAR"),nt=Ue.NEAREST,!jt&&Oe.rasterLayers)){const Mt=Oe.rasterLayers.find(({id:St})=>St===Ne.sourceLayer);Mt&&Mt.fields&&Mt.fields.range&&(jt=Mt.fields.range)}if(jt=jt||[0,1],Ye){ct.push("RASTER_COLOR"),ze.activeTexture.set(Ue.TEXTURE2),Ne.updateColorRamp(jt);let Mt=Ne.colorRampTexture;Mt||(Mt=Ne.colorRampTexture=new i.T(ze,Ne.colorRamp,Ue.RGBA8)),Mt.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}return{mix:ut,range:jt,offset:It,defines:ct,resampling:nt}}(Q,c,U,$);if(Q instanceof i.aK&&!g.length&&!I)return;const oe=c.paint.get("raster-emissive-strength"),pe=_.colorModeForDrapableLayerRenderPass(oe),ce=_.terrain&&_.terrain.renderingToTexture,me=!_.options.moving,ve=c.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;if(Q instanceof i.aK&&!g.length&&(Q.onNorthPole||Q.onSouthPole)){const Oe=k?_.stencilModeFor3D():Vn.disabled;return void ft(!!Q.onNorthPole,null,_,s,c,oe,J,Fn.disabled,Oe)}if(!g.length)return;const[Ee,Pe]=Q instanceof i.aK||ce?[{},g]:_.stencilConfigForOverlap(g),Ie=Pe[Pe.length-1].overscaledZ;j&&J.defines.push("PROJECTION_GLOBE_VIEW"),k&&J.defines.push("RENDER_CUTOFF");const Be=(Oe,Ne,ze)=>{for(const Ue of Oe){const Ye=Ue.toUnwrapped(),vt=s.getTile(Ue);if(ce&&(!vt||!vt.hasData()))continue;U.activeTexture.set($.TEXTURE0);const ct=Dl(vt,Q,c,J);if(!ct||!ct.texture)continue;const{texture:Pt,mix:At,offset:jt,tileSize:ut,buffer:It}=ct;let nt,Mt;ce?(nt=En.disabled,Mt=Ue.projMatrix):k?(nt=new En($.LEQUAL,En.ReadWrite,_.depthRangeFor3D),Mt=I?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(Ye,me)):(nt=_.depthModeForSublayer(Ue.overscaledZ-Ie,c.paint.get("raster-opacity")===1?En.ReadWrite:En.ReadOnly,$.LESS),Mt=_.transform.calculateProjMatrix(Ye,me));const St=_.terrain&&ce?_.terrain.stencilModeForRTTOverlap(Ue):Ee[Ue.overscaledZ],Rt=E?0:c.paint.get("raster-fade-duration");vt.registerFadeDuration(Rt);const xt=s.findLoadedParent(Ue,0),Lt=ou(vt,xt,s,_.transform,Rt);let en,tn;_.terrain&&_.terrain.prepareDrawTile(),U.activeTexture.set($.TEXTURE0),Pt.bind(ve,$.CLAMP_TO_EDGE),U.activeTexture.set($.TEXTURE1),xt?(xt.texture&&xt.texture.bind(ve,$.CLAMP_TO_EDGE),en=Math.pow(2,xt.tileID.overscaledZ-vt.tileID.overscaledZ),tn=[vt.tileID.canonical.x*en%1,vt.tileID.canonical.y*en%1]):Pt.bind(ve,$.CLAMP_TO_EDGE),"useMipmap"in Pt&&U.extTextureFilterAnisotropic&&_.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const rn=_.transform;let fn;const kn=k?dy(rn):[0,0,0,0];let vn,Ln,Mn,Hn,Nr,ii=0;if(j&&Q instanceof i.aK&&Q.coordinates.length>3)vn=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),Ln=Float32Array.from(rn.globeMatrix),Mn=Float32Array.from(i.cE(rn)),Hn=[i.av(rn.center.lng),i.aC(rn.center.lat)],fn=Q.elevatedGlobePerspectiveTransform,Nr=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(j){const mn=i.cF(Ue.canonical);ii=i.cG(mn.getCenter().lat),vn=Float32Array.from(i.bc(i.cI(Ue.canonical))),Ln=Float32Array.from(rn.globeMatrix),Mn=Float32Array.from(i.cE(rn)),Hn=[i.av(rn.center.lng),i.aC(rn.center.lat)],fn=[0,0],Nr=Float32Array.from(i.cH(Ue.canonical,mn,ii,rn.worldSize/rn._pixelsPerMercatorPixel))}else fn=Q instanceof i.aK?Q.perspectiveTransform:[0,0],vn=new Float32Array(16),Ln=new Float32Array(9),Mn=new Float32Array(16),Hn=[0,0],Nr=new Float32Array(9);const ir=Pc(Mt,vn,Ln,Mn,Nr,tn||[0,0],i.ag(_.transform.zoom),Hn,kn,en||1,Lt,c,fn,k?c.paint.get("raster-elevation"):0,2,At,jt,J.range,ut,It,oe),Ii=_.isTileAffectedByFog(Ue),Nn=_.getOrCreateProgram("raster",{defines:J.defines,overrideFog:Ii});if(_.uploadCommonUniforms(U,Nn,Ye),Q instanceof i.aK){const mn=Q.elevatedGlobeVertexBuffer,_r=Q.elevatedGlobeIndexBuffer;if(ce||!I)Q.boundsBuffer&&Q.boundsSegments&&Nn.draw(_,$.TRIANGLES,nt,Vn.disabled,pe,Fn.disabled,ir,c.id,Q.boundsBuffer,_.quadTriangleIndexBuffer,Q.boundsSegments);else if(mn&&_r){const Pr=rn.zoom<=i.c6?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(rn.center.lng);Pr&&Nn.draw(_,$.TRIANGLES,nt,Vn.disabled,pe,Ne,ir,c.id,mn,_r,Pr)}}else if(j){nt=new En($.LEQUAL,En.ReadOnly,_.depthRangeFor3D);const mn=_.globeSharedBuffers;if(mn){const[_r,Pr,Ar]=mn.getGridBuffers(ii,!1);Nn.draw(_,$.TRIANGLES,nt,ze||St,_.colorModeForRenderPass(),Ne,ir,c.id,_r,Pr,Ar)}}else{const{tileBoundsBuffer:mn,tileBoundsIndexBuffer:_r,tileBoundsSegments:Pr}=_.getTileBoundsBuffers(vt);Nn.draw(_,$.TRIANGLES,nt,St,pe,Fn.disabled,ir,c.id,mn,_r,Pr)}}if(!(Q instanceof i.aK)&&j)for(const Ue of Oe){const Ye=Ue.canonical.y===(1<<Ue.canonical.z)-1;Ue.canonical.y===0&&ft(!0,Ue,_,s,c,oe,J,Ne,ze||Vn.disabled),Ye&&ft(!1,Ue,_,s,c,oe,J,Ne===Fn.frontCW?Fn.backCW:Fn.frontCW,ze||Vn.disabled)}};j?Be(Pe,_.renderElevatedRasterBackface?Fn.backCW:Fn.frontCW,_.stencilModeFor3D()):Be(Pe,Fn.disabled,void 0),_.resetStencilClippingMasks()},"raster-particle":function(_,s,c,g,x,E){_.renderPass==="offscreen"&&function(I,k,j,U){if(!U.length)return;const $=I.context,Q=$.gl,J=k.getSource();if(!(J instanceof Fu))return;const oe=Math.ceil(Math.sqrt(j.paint.get("raster-particle-count")));let pe=j.particlePositionRGBAImage;if(!pe||pe.width!==oe){const Pe=function(Ie){const Be=Ie*Ie,Oe=new Uint8Array(4*Be),Ne=function(Ue){return Ue|=0,Ue=Math.imul(2747636419^Ue,2654435769),Ue=Math.imul(Ue^Ue>>>16,2654435769),((Ue=Math.imul(Ue^Ue>>>16,2654435769))>>>0)/4294967296},ze=1/1.1;for(let Ue=0;Ue<Be;Ue++){const Ye=ze*(Ne(2*Ue+0)+ua),vt=ze*(Ne(2*Ue+1)+ua),ct=255*Ye%1,Pt=255*vt%1,At=ct,jt=vt-Pt/255,ut=Pt;Oe[4*Ue+0]=255*(Ye-ct/255),Oe[4*Ue+1]=255*At,Oe[4*Ue+2]=255*jt,Oe[4*Ue+3]=255*ut}return Oe}(oe);pe=j.particlePositionRGBAImage=new i.r({width:oe,height:oe},Pe)}let ce=j.particleFramebuffer;ce?ce.width!==oe&&(ce.destroy(),ce=j.particleFramebuffer=$.createFramebuffer(oe,oe,!0,null)):ce=j.particleFramebuffer=$.createFramebuffer(oe,oe,!0,null);const me=[];for(const Pe of U){const Ie=k.getTile(Pe);if(!(Ie instanceof Gs))continue;const Be=fy(Ie,J,j);if(!Be)continue;const Oe=[Ie.tileSize,Ie.tileSize];let Ne=j.tileFramebuffer;Ne||(Ne=j.tileFramebuffer=$.createFramebuffer(Oe[0],Oe[1],!0,null));let ze=Ie.rasterParticleState;ze||(ze=Ie.rasterParticleState=new Kf($,Pe,Oe,pe));const Ue=ze.update(j.lastInvalidatedAt);ze.particleTextureDimension!==oe&&ze.updateParticleTexture(Pe,pe);const Ye=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=Ye;const vt=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=vt,me.push([Pe,Be,ze,Ue])}if(me.length===0)return;const ve=i.q.now(),Ee=j.previousDrawTimestamp?.001*(ve-j.previousDrawTimestamp):.0167;if(j.previousDrawTimestamp=ve,j.hasColorMap()){$.activeTexture.set(Q.TEXTURE0+2);let Pe=j.colorRampTexture;Pe||(Pe=j.colorRampTexture=new i.T($,j.colorRamp,Q.RGBA8)),Pe.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}$.bindFramebuffer.set(j.tileFramebuffer.framebuffer),function(Pe,Ie,Be){const Oe=Pe.context,Ne=Oe.gl,ze=Ie.tileFramebuffer;Oe.activeTexture.set(Ne.TEXTURE0);const Ue={u_texture:0,u_opacity:1.05*(vt=Ie.paint.get("raster-particle-fade-opacity-factor"))/(vt+.05)},Ye=Pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var vt;for(const ct of Be){const[,,Pt,At]=ct;ze.colorAttachment.set(Pt.targetColorTexture.texture),Oe.viewport.set([0,0,ze.width,ze.height]),Oe.clear({color:i.al.transparent}),At&&(Pt.backgroundColorTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE),Ye.draw(Pe,Ne.TRIANGLES,En.disabled,Vn.disabled,pr.alphaBlended,Fn.disabled,Ue,Ie.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments))}}(I,j,me),function(Pe,Ie,Be,Oe){const Ne=Pe.context,ze=Ne.gl,Ue=Be.tileFramebuffer,Ye=Pe.transform.projection.name==="globe",vt=Be.paint.get("raster-particle-max-speed");for(const ct of Oe){const[Pt,At,jt]=ct;Ne.activeTexture.set(ze.TEXTURE0+0),At.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ue.colorAttachment.set(jt.targetColorTexture.texture);const ut=Pe.getOrCreateProgram("rasterParticleDraw",{defines:At.defines,overrideFog:!1});Ne.activeTexture.set(ze.TEXTURE0+1);const It=At.scalarData?[]:[0,1,2,3].map(St=>i.d7[St](Pt));It.push(Pt);const nt=Pt.canonical.x,Mt=Pt.canonical.y;for(const St of It){const Rt=Ie.getTile(Ye?St.wrapped():St);if(!Rt)continue;const xt=Rt.rasterParticleState;if(!xt)continue;const Lt=St.canonical.x+(1<<St.canonical.z)*(St.wrap-Pt.wrap),en=St.canonical.y;xt.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const tn=ca(1,xt.particleTexture0.size[0],[Lt-nt,en-Mt],0,At.texture.size,2,vt,At.textureOffset,At.scale,At.offset);ut.draw(Pe,ze.POINTS,En.disabled,Vn.disabled,pr.alphaBlended,Fn.disabled,tn,Be.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}}(I,k,j,me),$.bindFramebuffer.set(j.particleFramebuffer.framebuffer),function(Pe,Ie,Be,Oe){const Ne=Pe.context,ze=Ne.gl,Ue=Ie.paint.get("raster-particle-max-speed"),Ye=Oe*Ie.paint.get("raster-particle-speed-factor")*.15,vt=function(Pt){return Math.pow(Pt,6)}(.01+1*Ie.paint.get("raster-particle-reset-rate-factor")),ct=Ie.particleFramebuffer;Ne.viewport.set([0,0,ct.width,ct.height]);for(const Pt of Be){const[,At,jt]=Pt;Ne.activeTexture.set(ze.TEXTURE0+0),At.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ne.activeTexture.set(ze.TEXTURE0+1);const ut=jt.particleTexture0;ut.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const It=ll(1,ut.size[0],0,At.texture.size,Ue,Ye,vt,At.textureOffset,At.scale,At.offset);ct.colorAttachment.set(jt.particleTexture1.texture),Ne.clear({color:i.al.transparent}),Pe.getOrCreateProgram("rasterParticleUpdate",{defines:At.defines}).draw(Pe,ze.TRIANGLES,En.disabled,Vn.disabled,pr.unblended,Fn.disabled,It,Ie.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments)}}(I,j,me,Ee)}(_,s,c,g),_.renderPass==="translucent"&&(function(I,k,j,U,$){const Q=I.context,J=Q.gl,oe=k.getSource().tileSize,pe=5*(1-i.ae(i.bY,i.bY+1,I.transform.zoom))*oe+j.paint.get("raster-particle-elevation"),ce=!I.options.moving,me=I.transform.projection.name==="globe";if(!U.length)return;const[ve,Ee]=I.stencilConfigForOverlap(U),Pe=[];me&&Pe.push("PROJECTION_GLOBE_VIEW");const Ie=I.stencilModeFor3D();for(const Be of Ee){const Oe=Be.toUnwrapped(),Ne=k.getTile(Be);if(!Ne.rasterParticleState)continue;const ze=Ne.rasterParticleState,Ue=100;Ne.registerFadeDuration(Ue);const Ye=k.findLoadedParent(Be,0),vt=ou(Ne,Ye,k,I.transform,Ue);let ct,Pt;I.terrain&&I.terrain.prepareDrawTile(),Q.activeTexture.set(J.TEXTURE0),ze.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Q.activeTexture.set(J.TEXTURE1),Ye&&Ye.rasterParticleState?(Ye.rasterParticleState.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ct=Math.pow(2,Ye.tileID.overscaledZ-Ne.tileID.overscaledZ),Pt=[Ne.tileID.canonical.x*ct%1,Ne.tileID.canonical.y*ct%1]):ze.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const At=me?Float32Array.from(I.transform.expandedFarZProjMatrix):I.transform.calculateProjMatrix(Oe,ce),jt=I.transform,ut=_m(jt),It=i.cF(Be.canonical),nt=i.cG(It.getCenter().lat);let Mt,St,Rt,xt,Lt;me?(Mt=Float32Array.from(i.bc(i.cI(Be.canonical))),St=Float32Array.from(jt.globeMatrix),Rt=Float32Array.from(i.cE(jt)),xt=[i.av(jt.center.lng),i.aC(jt.center.lat)],Lt=Float32Array.from(i.cH(Be.canonical,It,nt,jt.worldSize/jt._pixelsPerMercatorPixel))):(Mt=new Float32Array(16),St=new Float32Array(9),Rt=new Float32Array(16),xt=[0,0],Lt=new Float32Array(9));const en=Cn(At,Mt,St,Rt,Lt,Pt||[0,0],i.ag(I.transform.zoom),xt,ut,ct||1,vt,pe),tn=I.isTileAffectedByFog(Be),rn=I.getOrCreateProgram("rasterParticle",{defines:Pe,overrideFog:tn});if(I.uploadCommonUniforms(Q,rn,Oe),me){const fn=new En(J.LEQUAL,En.ReadOnly,I.depthRangeFor3D),kn=0,vn=I.globeSharedBuffers;if(vn){const[Ln,Mn,Hn]=vn.getGridBuffers(nt,kn!==0);rn.draw(I,J.TRIANGLES,fn,Ie,pr.alphaBlended,I.renderElevatedRasterBackface?Fn.frontCCW:Fn.backCCW,en,j.id,Ln,Mn,Hn)}}else{const fn=I.depthModeForSublayer(0,En.ReadOnly),kn=ve[Be.overscaledZ],{tileBoundsBuffer:vn,tileBoundsIndexBuffer:Ln,tileBoundsSegments:Mn}=I.getTileBoundsBuffers(Ne);rn.draw(I,J.TRIANGLES,fn,kn,pr.alphaBlended,Fn.disabled,en,j.id,vn,Ln,Mn)}}I.resetStencilClippingMasks()}(_,s,c,g),_.style.map.triggerRepaint())},background:function(_,s,c,g){const x=c.paint.get("background-color"),E=c.paint.get("background-color-use-theme").constantOr("default")==="none",I=c.paint.get("background-opacity"),k=c.paint.get("background-emissive-strength"),j=c.paint.get("background-pitch-alignment")==="viewport";if(I===0)return;const U=_.context,$=U.gl,Q=_.transform,J=Q.tileSize,oe=c.paint.get("background-pattern");let pe;if(oe!==void 0&&(oe===null||(pe=_.imageManager.getPattern(i.I.from(oe.toString()),c.scope,_.style.getLut(c.scope)),!pe)))return;const ce=!oe&&x.a===1&&I===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==ce)return;const me=Vn.disabled,ve=_.depthModeForSublayer(0,ce==="opaque"?En.ReadWrite:En.ReadOnly),Ee=_.colorModeForDrapableLayerRenderPass(k),Pe=oe?"backgroundPattern":"background";let Ie,Be=g;if(Be||(Ie=_.getBackgroundTiles(),Be=Object.values(Ie).map(Oe=>Oe.tileID)),oe&&(U.activeTexture.set($.TEXTURE0),_.imageManager.bind(_.context,c.scope)),j){const Oe=_.getOrCreateProgram(Pe,{overrideFog:!1,overrideRtt:!0}),Ne=new Float32Array(i.ad.mat4.identity([])),ze=new i.aH(0,0,0,0,0),Ue=oe?uy(Ne,k,I,_,0,c.scope,pe,j,{tileID:ze,tileSize:J}):Lg(Ne,k,I,x.toRenderColor(E?null:c.lut));Oe.draw(_,$.TRIANGLES,ve,me,Ee,Fn.disabled,Ue,c.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments)}else for(const Oe of Be){const Ne=_.isTileAffectedByFog(Oe),ze=_.getOrCreateProgram(Pe,{overrideFog:Ne}),Ue=Oe.toUnwrapped(),Ye=g?Oe.projMatrix:_.transform.calculateProjMatrix(Ue);_.prepareDrawTile();const vt=s?s.getTile(Oe):Ie?Ie[Oe.key]:new tl(Oe,J,Q.zoom,_),ct=oe?uy(Ye,k,I,_,0,c.scope,pe,j,{tileID:Oe,tileSize:J}):Lg(Ye,k,I,x.toRenderColor(E?null:c.lut));_.uploadCommonUniforms(U,ze,Ue);const{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:At,tileBoundsSegments:jt}=_.getTileBoundsBuffers(vt);ze.draw(_,$.TRIANGLES,ve,me,Ee,Fn.disabled,ct,c.id,Pt,At,jt)}},sky:function(_,s,c){const g=_._atmosphere?i.ag(_.transform.zoom):1,x=c.paint.get("sky-opacity")*g;if(x===0)return;const E=_.context,I=c.paint.get("sky-type"),k=new En(E.gl.LEQUAL,En.ReadOnly,[0,1]),j=_.frameCounter/1e3%1;I==="atmosphere"?_.renderPass==="offscreen"?c.needsSkyboxCapture(_)&&(function(U,$,Q,J){const oe=U.context,pe=oe.gl;let ce=$.skyboxFbo;if(!ce){ce=$.skyboxFbo=oe.createFramebuffer(32,32,!0,null),$.skyboxGeometry=new Og(oe),$.skyboxTexture=oe.gl.createTexture(),pe.bindTexture(pe.TEXTURE_CUBE_MAP,$.skyboxTexture),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MAG_FILTER,pe.LINEAR);for(let Pe=0;Pe<6;++Pe)pe.texImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,pe.RGBA,32,32,0,pe.RGBA,pe.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(ce.framebuffer),oe.viewport.set([0,0,32,32]);const me=$.getCenter(U,!0),ve=U.getOrCreateProgram("skyboxCapture"),Ee=new Float64Array(16);i.ad.mat4.identity(Ee),i.ad.mat4.rotateY(Ee,Ee,.5*-Math.PI),Oo(U,$,ve,Ee,me,0),i.ad.mat4.identity(Ee),i.ad.mat4.rotateY(Ee,Ee,.5*Math.PI),Oo(U,$,ve,Ee,me,1),i.ad.mat4.identity(Ee),i.ad.mat4.rotateX(Ee,Ee,.5*-Math.PI),Oo(U,$,ve,Ee,me,2),i.ad.mat4.identity(Ee),i.ad.mat4.rotateX(Ee,Ee,.5*Math.PI),Oo(U,$,ve,Ee,me,3),i.ad.mat4.identity(Ee),Oo(U,$,ve,Ee,me,4),i.ad.mat4.identity(Ee),i.ad.mat4.rotateY(Ee,Ee,Math.PI),Oo(U,$,ve,Ee,me,5),oe.viewport.set([0,0,U.width,U.height])}(_,c),c.markSkyboxValid(_)):_.renderPass==="sky"&&function(U,$,Q,J,oe){const pe=U.context,ce=pe.gl,me=U.transform,ve=U.getOrCreateProgram("skybox");pe.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,$.skyboxTexture);const Ee=((Pe,Ie,Be,Oe,Ne)=>({u_matrix:Pe,u_sun_direction:Ie,u_cubemap:0,u_opacity:Oe,u_temporal_offset:Ne}))(me.skyboxMatrix,$.getCenter(U,!1),0,J,oe);U.uploadCommonUniforms(pe,ve),ve.draw(U,ce.TRIANGLES,Q,Vn.disabled,U.colorModeForRenderPass(),Fn.backCW,Ee,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,c,k,x,j):I==="gradient"&&_.renderPass==="sky"&&function(U,$,Q,J,oe){const pe=U.context,ce=pe.gl,me=U.transform,ve=U.getOrCreateProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new Og(pe)),pe.activeTexture.set(ce.TEXTURE0);let Ee=$.colorRampTexture;Ee||(Ee=$.colorRampTexture=new i.T(pe,$.colorRamp,ce.RGBA8)),Ee.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Pe=((Ie,Be,Oe,Ne,ze)=>({u_matrix:Ie,u_color_ramp:0,u_center_direction:Be,u_radius:i.ak(Oe),u_opacity:Ne,u_temporal_offset:ze}))(me.skyboxMatrix,$.getCenter(U,!1),$.paint.get("sky-gradient-radius"),J,oe);U.uploadCommonUniforms(pe,ve),ve.draw(U,ce.TRIANGLES,Q,Vn.disabled,U.colorModeForRenderPass(),Fn.backCW,Pe,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,c,k,x,j)},debug:function(_,s,c,g,x,E){for(let I=0;I<c.length;I++)if(x){const U=new i.al(g.r*.8,g.g*.8,g.b*.8,1);Fa(_,s,c[I],g,-1,-1,E),Fa(_,s,c[I],g,-1,1,E),Fa(_,s,c[I],g,1,1,E),Fa(_,s,c[I],g,1,-1,E),Fa(_,s,c[I],U,0,0,E)}else Fa(_,s,c[I],g,0,0,E)},custom:function(_,s,c,g){const x=_.context,E=c.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||_.renderPass==="offscreen")&&c.isDraped(s)){if(_.renderPass==="offscreen"){const I=E.prerender;if(I){if(_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),_.transform.projection.name==="globe"){const k=_.transform.pointMerc;I.call(E,x.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),i.ag(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else I.call(E,x.gl,_.transform.customLayerMatrix());x.setDirty(),_.setBaseState()}}else if(_.renderPass==="translucent"){if(_.terrain&&_.terrain.renderingToTexture){const k=E.renderToTile;if(k){const j=g[0].canonical,U=new i.ac(j.x+g[0].wrap*(1<<j.z),j.y,j.z);x.setDepthMode(En.disabled),x.setStencilMode(Vn.disabled),x.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),k.call(E,x.gl,U),x.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),x.setStencilMode(Vn.disabled);const I=E.renderingMode==="3d"?new En(_.context.gl.LEQUAL,En.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,En.ReadOnly);if(x.setDepthMode(I),_.transform.projection.name==="globe"){const k=_.transform.pointMerc;E.render(x.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),i.ag(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else E.render(x.gl,_.transform.customLayerMatrix());x.setDirty(),_.setBaseState(),x.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(_,s,c,g){if(_.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1);if(x===0)return;const E=c.paint.get("model-cast-shadows");if(_.renderPass==="shadow"&&(!E||_.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const I=_.shadowRenderer,k=c.paint.get("model-receive-shadows");I&&(I.useNormalOffset=!0,k||(I.enabled=!1));const j=()=>{I&&(I.useNormalOffset=!0,k||(I.enabled=!0))},U=s.getSource();if(_.renderPass==="light-beam"&&U.type!=="batched-model")return;if(U.type==="vector"||U.type==="geojson")return function(ve,Ee,Pe,Ie,Be){const Oe=ve.transform;if(Oe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Oe.projection.name} projection is not yet implemented`);const Ne=Oe.getFreeCameraOptions().position;if(!ve.modelManager)return;const ze=ve.modelManager;Pe.modelManager=ze;const Ue=ve.shadowRenderer;if(!Pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ye=Pe._unevaluatedLayout._values["model-id"],vt=Object.assign({},Pe.layout.get("model-id").parameters),ct=ve.style.order.indexOf(Pe.fqid);for(const Pt of Ie){const At=Ee.getTile(Pt).getBucket(Pe);if(!At||At.projection.name!==Oe.projection.name)continue;const jt=At.getModelUris();jt&&!At.modelsRequested&&(ze.addModelsFromBucket(jt,Be),At.modelsRequested=!0);const ut=bm(Pt,Oe);vt.zoom=ut;const It=Ye.possiblyEvaluate(vt);if(bs(ve,At,Pt),za.shadowUniformsInitialized=!1,za.useSingleShadowCascade=!!Ue&&Ue.getMaxCascadeForTile(Pt.toUnwrapped())===0,ve.renderPass==="shadow"&&Ue){if(ve.currentShadowCascade===1&&At.isInsideFirstShadowMapFrustum)continue;const St=Oe.calculatePosMatrix(Pt.toUnwrapped(),Oe.worldSize);if(za.tileMatrix.set(St),za.shadowTileMatrix=Float32Array.from(Ue.calculateShadowPassMatrixFromMatrix(St)),za.aabb.min.fill(0),za.aabb.max[0]=za.aabb.max[1]=i.ai,za.aabb.max[2]=0,fa(At,za,ve,Pe.scope))continue}const nt=1<<Pt.canonical.z,Mt=[((Ne.x-Pt.wrap)*nt-Pt.canonical.x)*i.ai,(Ne.y*nt-Pt.canonical.y)*i.ai,Ne.z*nt*i.ai];ve.conflationActive&&Object.keys(At.instancesPerModel).length>0&&ve.style.isLayerClipped(Pe,Ee.getSource())&&At.updateReplacement(Pt,ve.replacementSource,ct,Be)&&(At.uploaded=!1,At.upload(ve.context));for(let St in At.instancesPerModel){const Rt=At.instancesPerModel[St];Rt.features.length>0&&(St=It.evaluate(Rt.features[0].feature,{}));const xt=ze.getModel(St,Be);if(xt&&xt.uploaded)for(const Lt of xt.nodes)cl(ve,Pe,Lt,Rt,Mt,Pt,za)}}}(_,s,c,g,U.type==="vector"?c.scope:""),void j();if(!U.loaded())return;if(U.type==="batched-model")return function(ve,Ee,Pe,Ie){Pe.resetLayerRenderingStats(ve);const Be=ve.context,Oe=ve.transform,Ne=ve.style.fog,ze=ve.shadowRenderer;if(Oe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Oe.projection.name} projection is not yet implemented`);const Ue=ve.transform.getFreeCameraOptions().position,Ye=i.ad.vec3.scale([],[Ue.x,Ue.y,Ue.z],ve.transform.worldSize),vt=i.ad.vec3.negate([],Ye),ct=i.ad.mat4.identity([]),Pt=i.dm(Oe.center.lat,Oe.zoom),At=i.ad.mat4.fromScaling([],[1,1,1/Pt]);i.ad.mat4.translate(ct,ct,vt);const jt=Pe.paint.get("model-opacity").constantOr(1),ut=new En(Be.gl.LEQUAL,En.ReadWrite,ve.depthRangeFor3D),It=new En(Be.gl.LEQUAL,En.ReadOnly,ve.depthRangeFor3D),nt=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Mt=ve.renderPass==="shadow",St=Mt&&ze?ze.getCurrentCascadeFrustum():Oe.getFrustum(Oe.scaleZoom(Oe.worldSize)),Rt=Pe.paint.get("model-front-cutoff"),xt=Rt[2]<1,Lt=Vu(ve,Pe.paint.get("model-cutoff-fade-range")),en=Pe.getLayerRenderingStats();(function(tn,rn,fn,kn){const vn=tn.terrain?tn.terrain.exaggeration():0,Ln=tn.transform.zoom;for(const Mn of kn){const Hn=rn.getTile(Mn).getBucket(fn);Hn&&(Hn.setFilter(fn.filter),tn.conflationActive&&Hn.updateReplacement(Mn,tn.replacementSource),Hn.evaluateScale(tn,fn),tn.terrain&&vn>0&&Hn.elevationUpdate(tn.terrain,vn,Mn,fn.source),Hn.needsReEvaluation(tn,Ln,fn)&&Hn.evaluate(fn))}})(ve,Ee,Pe,Ie),function(){let tn,rn,fn;xt?(tn=Ie.length-1,rn=-1,fn=-1):(tn=0,rn=Ie.length,fn=1);const kn=new Float64Array(16),vn=i.ad.vec3.create(),Ln=new i.P(0,0);for(let Mn=tn;Mn!==rn;Mn+=fn){const Hn=Ie[Mn],Nr=Ee.getTile(Hn).getBucket(Pe);if(!Nr||!Nr.uploaded)continue;let ii=!1;ze&&(ii=ze.getMaxCascadeForTile(Hn.toUnwrapped())===0);const ir=Oe.calculatePosMatrix(Hn.toUnwrapped(),Oe.worldSize),Ii=Nr.modelTraits;!Mt&&xt&&(i.ad.mat4.invert(kn,ir),i.ad.vec3.transformMat4(vn,Ye,kn),Ln.x=vn[0],Ln.y=vn[1]);const Nn=[];Nr.setFilter(Pe.filter);for(const mn of Nr.getNodesInfo()){if(mn.hiddenByReplacement||!mn.node.meshes)continue;const _r=mn.node;let Pr=0;ve.terrain&&_r.elevation&&(Pr=_r.elevation*ve.terrain.exaggeration());const Ar=(()=>{const Wr=mn.aabb;return nt.min=[...Wr.min],nt.max=[...Wr.max],nt.min[2]+=Pr,nt.max[2]+=Pr,i.ad.vec3.transformMat4(nt.min,nt.min,ir),i.ad.vec3.transformMat4(nt.max,nt.max,ir),nt})(),gi=mn.evaluatedScale;if(gi[0]<=1&&gi[1]<=1&&gi[2]<=1&&Ar.intersects(St)===0)continue;if(!Mt&&xt){const Wr=.16666666666666666;mn.cameraCollisionOpacity=Ye[0]>Ar.min[0]&&Ye[0]<Ar.max[0]&&Ye[1]>Ar.min[1]&&Ye[1]<Ar.max[1]&&Ye[2]*Pt<Ar.max[2]&&_r.footprint&&i.bA(Ln,_r.footprint)?Math.max(mn.cameraCollisionOpacity-Wr,0):Math.min(1,mn.cameraCollisionOpacity+Wr)}const uo=[...ir],_o=_r.anchor?_r.anchor[0]:0,yo=_r.anchor?_r.anchor[1]:0;i.ad.mat4.translate(uo,uo,[_o*(gi[0]-1),yo*(gi[1]-1),Pr]),i.ad.vec3.exactEquals(gi,i.dq)||i.ad.mat4.scale(uo,uo,gi);const Xs=i.ad.mat4.multiply([],uo,_r.matrix),Ls=i.ad.mat4.multiply([],Oe.expandedFarZProjMatrix,Xs),Or=i.ad.mat4.multiply([],Oe.expandedFarZProjMatrix,uo),bi=i.ad.vec4.transformMat4([],[_o,yo,Pr,1],Ls)[2];_r.hidden=!1;let kr=jt;Mt||(xt&&(kr*=mn.cameraCollisionOpacity,kr*=wm(uo,Oe,mn.aabb,Rt)),kr*=Ph(Lt,bi)),kr!==0?Nn.push({nodeInfo:mn,depth:bi,opacity:kr,wvpForNode:Ls,wvpForTile:Or,nodeModelMatrix:Xs,tileModelMatrix:uo}):_r.hidden=!0}Mt||Nn.sort((mn,_r)=>!xt||mn.opacity===1&&_r.opacity===1?mn.depth<_r.depth?-1:1:mn.opacity===1?-1:_r.opacity===1?1:mn.depth>_r.depth?-1:1);for(const mn of Nn){const _r=mn.nodeInfo,Pr=_r.node;let Ar=i.ad.mat4.multiply([],At,mn.tileModelMatrix);i.ad.mat4.multiply(Ar,ct,Ar);const gi=i.ad.mat4.invert([],Ar);i.ad.mat4.transpose(gi,gi),i.ad.mat4.scale(gi,gi,Ps),Ar=i.ad.mat4.multiply(Ar,Ar,Pr.matrix);const uo=ve.renderPass==="light-beam",_o=Pe.paint.get("model-color-use-theme").constantOr("default")==="none",yo=Ii&i.ds.HasMapboxMeshFeatures,Xs=yo?0:_r.evaluatedRMEA[0][2];for(let Ls=0;Ls<Pr.meshes.length;++Ls){const Or=Pr.meshes[Ls],bi=Ls===Pr.lightMeshIndex;let kr=mn.wvpForNode;if(bi){if(!uo&&!ve.terrain&&ve.shadowRenderer){ve.currentLayer<ve.firstLightBeamLayer&&(ve.firstLightBeamLayer=ve.currentLayer);continue}kr=mn.wvpForTile}else if(uo)continue;const Wr={defines:[]},cs=[];if(!Mt&&ze&&(ze.useNormalOffset=!!Or.normalBuffer),Lc(Wr.defines,cs,Or,ve,_o?null:Pe.lut),yo||Wr.defines.push("DIFFUSE_SHADED"),ii&&Wr.defines.push("SHADOWS_SINGLE_CASCADE"),en&&(Mt?en.numRenderedVerticesInShadowPass+=Or.vertexArray.length:en.numRenderedVerticesInTransparentPass+=Or.vertexArray.length),Mt){xm(Or,mn.nodeModelMatrix,ve,Pe);continue}let oi=null;if(Ne){const zl=eo(mn.nodeModelMatrix,ve.transform);if(oi=new Float32Array(zl),Oe.projection.name!=="globe"){const ya=Or.aabb.min,Qu=Or.aabb.max,[ec,ts]=Ne.getOpacityForBounds(zl,ya[0],ya[1],Qu[0],Qu[1]);Wr.overrideFog=ec>=sn||ts>=sn}}const vo=Or.material;let Li;vo.occlusionTexture&&vo.occlusionTexture.offsetScale&&(Li=vo.occlusionTexture.offsetScale,Wr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ua=ve.getOrCreateProgram("model",Wr);!Mt&&ze&&ze.setupShadowsFromMatrix(mn.tileModelMatrix,Ua,ze.useNormalOffset),ve.uploadCommonUniforms(Be,Ua,null,oi);const dl=vo.pbrMetallicRoughness;dl.metallicFactor=.9,dl.roughnessFactor=.5;const _a=dm(new Float32Array(kr),new Float32Array(Ar),new Float32Array(gi),new Float32Array(Pr.matrix),ve,mn.opacity,dl.baseColorFactor.toRenderColor(null),vo.emissiveFactor,dl.metallicFactor,dl.roughnessFactor,vo,Xs,Pe,[0,0,0],Li);!bi&&(_r.hasTranslucentParts||mn.opacity<1)&&Ua.draw(ve,Be.gl.TRIANGLES,ut,Vn.disabled,pr.disabled,Fn.backCCW,_a,Pe.id,Or.vertexBuffer,Or.indexBuffer,Or.segments,Pe.paint,ve.transform.zoom,void 0,cs),Ua.draw(ve,Be.gl.TRIANGLES,bi?It:ut,Vn.disabled,bi||mn.opacity<1||_r.hasTranslucentParts?pr.alphaBlended:pr.unblended,Fn.backCCW,_a,Pe.id,Or.vertexBuffer,Or.indexBuffer,Or.segments,Pe.paint,ve.transform.zoom,void 0,cs)}}}}()}(_,s,c,g),void j();if(U.type!=="model")return;const $=U.getModels(),Q=[],J=_.transform.getFreeCameraOptions().position,oe=i.ad.vec3.scale([],[J.x,J.y,J.z],_.transform.worldSize);i.ad.vec3.negate(oe,oe);const pe=[],ce=[];let me=0;for(const ve of $){const Ee=c.paint.get("model-rotation").constantOr(null),Pe=c.paint.get("model-scale").constantOr(null),Ie=c.paint.get("model-translation").constantOr(null);ve.computeModelMatrix(_,Ee,Pe,Ie,!0,!0,!1);const Be=i.ad.mat4.identity([]),Oe=i.dm(ve.position.lat,_.transform.zoom),Ne=i.ad.mat4.fromScaling([],[1,1,1/Oe]);i.ad.mat4.translate(Be,Be,oe),Q.push({zScaleMatrix:Ne,negCameraPosMatrix:Be});for(const ze of ve.nodes)hu(_.transform,ze,ve.matrix,_.transform.expandedFarZProjMatrix,me,pe,ce);me++}if(pe.sort((ve,Ee)=>Ee.depth-ve.depth),_.renderPass!=="shadow"){if(x===1)for(const ve of ce)ul(ve,_,c,Q[ve.modelIndex],Vn.disabled,_.colorModeForRenderPass());else{for(const ve of ce)ul(ve,_,c,Q[ve.modelIndex],Vn.disabled,pr.disabled);for(const ve of ce)ul(ve,_,c,Q[ve.modelIndex],_.stencilModeFor3D(),_.colorModeForRenderPass());_.resetStencilClippingMasks()}for(const ve of pe)ul(ve,_,c,Q[ve.modelIndex],Vn.disabled,_.colorModeForRenderPass());j()}else{for(const ve of ce)xm(ve.mesh,ve.nodeModelMatrix,_,c);for(const ve of pe)xm(ve.mesh,ve.nodeModelMatrix,_,c);j()}}},Tm={line:function(_,s,c){if(_.hasElevatedBuckets=!1,_.hasNonElevatedBuckets=!1,_._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||_._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const g=s.getVisibleCoordinates();for(const x of g){const E=s.getTile(x).getBucket(_);if(E&&(E.hasZOffset?_.hasElevatedBuckets=!0:_.hasNonElevatedBuckets=!0,_.hasElevatedBuckets&&_.hasNonElevatedBuckets))break}}}else _.hasNonElevatedBuckets=!0},model:function(_,s,c){const g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,g.type==="vector"?_.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const x=g.getModels();for(const E of x)E.upload(c.context)},raster:function(_,s,c){const g=s.getSource();if(!(g instanceof Fu&&g.loaded()))return;const x=_.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const E=_.paint.get("raster-array-band")||g.getInitialBand(x);if(E==null)return;const I=s.getIds().map(k=>s.getTileByID(k));for(const k of I)k.updateNeeded(x,E)&&g.prepareTile(k,x,E)},"raster-particle":function(_,s,c){const g=s.getSource();if(!(g instanceof Fu&&g.loaded()))return;const x=_.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const E=_.paint.get("raster-particle-array-band")||g.getInitialBand(x);if(E==null)return;const I=s.getIds().map(k=>s.getTileByID(k));for(const k of I)k.updateNeeded(x,E)&&g.prepareTile(k,x,E)}},Im={fill:gm};class np{constructor(s,c,g,x,E){this.context=new Ll(s,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=E,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const j of I)this._debugParams.enabledLayers[j]=!0;E.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),E.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),E.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),E.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const j of I)E.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],j);this.occlusionParams=new Ng(E),this.setup(),this.numSublayers=La.maxUnderzooming+La.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Pl(this),this._wireframeDebugCache=new Ah,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,k,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x}updateTerrain(s,c){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Td(this,s));const x=this._terrain;this.transform.elevation=g?x:null,x.update(s,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=c.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const E=g+.78*(x-g);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Td(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*i.q.devicePixelRatio,this.height=c*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const s=this.context,c=new i.b5;c.emplaceBack(0,0),c.emplaceBack(i.ai,0),c.emplaceBack(0,i.ai),c.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=s.createVertexBuffer(c,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const g=new i.b5;g.emplaceBack(0,0),g.emplaceBack(i.ai,0),g.emplaceBack(0,i.ai),g.emplaceBack(i.ai,i.ai),this.debugBuffer=s.createVertexBuffer(g,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const x=new i.b5;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const E=new i.aU;E.emplaceBack(0,0,0,0),E.emplaceBack(i.ai,0,i.ai,0),E.emplaceBack(0,i.ai,0,i.ai),E.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=s.createVertexBuffer(E,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const I=new i.aV;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(I);const k=new i.b6;for(const U of[0,1,3,2,0])k.emplaceBack(U);this.debugIndexBuffer=s.createIndexBuffer(k),this.emptyTexture=new i.T(s,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=i.ad.mat4.create();const j=this.context.gl;this.stencilClearMode=new Vn({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,En.disabled,this.stencilClearMode,pr.disabled,Fn.disabled,Ri(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,g){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const j of g)if(this._tileClippingMaskIDs[j.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const x=this.context,E=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(pr.disabled),x.setDepthMode(En.disabled);const I=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of g){const j=c.getTile(k),U=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:J}=this.getTileBoundsBuffers(j);I.draw(this,E.TRIANGLES,En.disabled,new Vn({func:E.ALWAYS,mask:0},U,255,E.KEEP,E.KEEP,E.REPLACE),pr.disabled,Fn.disabled,Ri(k.projMatrix),"$clipping",$,Q,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Vn({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Vn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,g=s.sort((I,k)=>k.overscaledZ-I.overscaledZ),x=g[g.length-1].overscaledZ,E=g[0].overscaledZ-x+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let k=0;k<E;k++)I[k+x]=new Vn({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=E,[I,g]}return[{[x]:Vn.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new pr([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pr.unblended:pr.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new pr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,g,x=!1){if(this.depthOcclusion)return new En(this.context.gl.GREATER,En.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return En.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new En(g||this.context.gl.LEQUAL,c,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),g=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),E=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&g!==0&&(this.depthFBO=new ha(this.context,c,g,!1,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:g,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),s.bindTexture(s.TEXTURE_2D,E),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,g,0,0,c,g,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,c)=>s+c/this._fpsHistory.length,0))}render(s,c){const g=i.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const x=this.style._mergedLayers,E=!(!this.terrain||!this.terrain.enabled),I=()=>this.style._getOrder(E).filter(ut=>{const It=x[ut];return!(It.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[It.type]});let k=I(),j=!1,U=!1;for(const ut of k){const It=x[ut];It.type==="circle"&&(j=!0),It.type==="symbol"&&(It.hasInitialOcclusionOpacityProperties?U=!0:j=!0)}let $=k.map(ut=>x[ut]);const Q=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let J=0,oe=!1;for(const ut in Q){const It=Q[ut];It.used&&(It.prepare(this.context),It.getSource().usedInConflation&&++J)}let pe=!1;for(const ut of $)ut.isHidden(this.transform.zoom)||(ut.type==="clip"&&(pe=!0),this.prepareLayer(ut));const ce={},me={},ve={},Ee={},Pe={};for(const ut in Q){const It=Q[ut];ce[ut]=It.getVisibleCoordinates(),me[ut]=ce[ut].slice().reverse(),ve[ut]=It.getVisibleCoordinates(!0).reverse(),Ee[ut]=It.getShadowCasterCoordinates(),Pe[ut]=It.sortCoordinatesByDistance(ce[ut])}const Ie=ut=>{const It=this.style.getLayerSourceCache(ut);return It&&It.used?It.getSource():null};if(J||pe||this._clippingActiveLastFrame){const ut=[],It=[];let nt=0;for(const Mt of $)this.isSourceForClippingOrConflation(Mt,Ie(Mt))&&(ut.push(Mt),It.push(nt)),nt++;if(ut&&(pe||ut.length>1)||this._clippingActiveLastFrame){pe=!1;const Mt=[];for(let St=0;St<ut.length;St++){const Rt=ut[St],xt=It[St],Lt=this.style.getLayerSourceCache(Rt);if(!Lt||!Lt.used||!Lt.getSource().usedInConflation&&Rt.type!=="clip")continue;let en=i.dA,tn=i.by.None;const rn=[];let fn=!0;if(Rt.type==="clip"){en=xt;for(const kn of Rt.layout.get("clip-layer-types"))tn|=kn==="model"?i.by.Model:kn==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const kn of Rt.layout.get("clip-layer-scope"))rn.push(kn);Rt.isHidden(this.transform.zoom)?fn=!1:pe=!0}fn&&Mt.push({layer:Rt.fqid,cache:Lt,order:en,clipMask:tn,clipScope:rn})}this.replacementSource.setSources(Mt),oe=!0}}this._clippingActiveLastFrame=pe,oe||this.replacementSource.clear(),this.conflationActive=oe,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ut=0;ut<$.length;ut++){const It=$[ut],nt=It.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Mt=Ie(It);Mt&&(this.minCutoffZoom=Math.max(Mt.minzoom,this.minCutoffZoom)),It.minzoom&&(this.minCutoffZoom=Math.max(It.minzoom,this.minCutoffZoom))}It.is3D(E)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ut),this._lastOcclusionLayer=ut)}const Be=this.style&&this.style.fog;Be?(this._fogVisible=Be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ve),this.opaquePassCutoff=0,k=I(),$=k.map(ut=>x[ut]));const Oe=this._shadowRenderer;if(Oe){Oe.updateShadowParameters(this.transform,this.style.directionalLight);for(const ut in Q)for(const It of ce[ut]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(It)||nt),Oe.addShadowReceiver(It.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jo(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ne=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ze=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ne&&!this._snow&&(this._snow=new Od(this)),!Ne&&this._snow&&(this._snow.destroy(),delete this._snow),ze&&!this._rain&&(this._rain=new Bg(this)),!ze&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Rr.has(this.context.gl))return;this.renderPass="offscreen";for(const ut of $){const It=s.getLayerSourceCache(ut);if(!ut.hasOffscreenPass()||ut.isHidden(this.transform.zoom))continue;const nt=It?me[It.id]:void 0;(ut.type==="custom"||ut.type==="raster"||ut.type==="raster-particle"||ut.isSky()||nt&&nt.length)&&this.renderLayer(this,It,ut,nt)}this.depthRangeFor3D=[0,1-($.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ue=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ye=(()=>{if(c.showOverdrawInspector)return i.al.black;const ut=this.style.fog;if(ut&&this.transform.projection.supportsFog){const It=this.style.getLut(ut.scope);if(!Ue){const nt=ut.properties.get("color-use-theme")==="none",Mt=ut.properties.get("color").toRenderColor(nt?null:It).toArray01();return new i.al(...Mt)}if(Ue){const nt=ut.properties.get("space-color-use-theme")==="none",Mt=ut.properties.get("space-color").toRenderColor(nt?null:It).toArray01();return new i.al(...Mt)}}return i.al.transparent})();if(this.context.clear({color:Ye,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=k.length-1;this.currentLayer>=0;this.currentLayer--){const ut=$[this.currentLayer],It=s.getLayerSourceCache(ut);if(ut.isSky())continue;const nt=It?(ut.is3D(E)?Pe:me)[It.id]:void 0;this._renderTileClippingMasks(ut,It,nt),this.renderLayer(this,It,ut,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const ut=$[this.currentLayer],It=s.getLayerSourceCache(ut);ut.isSky()&&this.renderLayer(this,It,ut,It?me[It.id]:void 0)}function vt(ut,It){let nt;return It&&(nt=(ut.type==="symbol"?ve:ut.is3D(E)?Pe:me)[It.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<k.length;){const ut=$[this.currentLayer];if(ut.type==="raster"||ut.type==="raster-particle"){const It=s.getLayerSourceCache(ut);this.renderLayer(this,It,ut,vt(ut,It))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ct=0;Oe&&(ct=Oe.getShadowCastingLayerCount());let Pt=!1,At=-1;for(let ut=0;ut<k.length;++ut){const It=$[ut];It.isHidden(this.transform.zoom)||It.is3D(E)&&(At=ut)}U&&At===-1&&(j=!0);let jt=!1;for(;this.currentLayer<k.length;){const ut=$[this.currentLayer],It=s.getLayerSourceCache(ut);if(ut.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ut)){if(ut.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!jt&&ut.is3D(E)&&!E){const nt=this.currentLayer,Mt=St=>{for(this.currentLayer=0;this.currentLayer<$.length;this.currentLayer++){const Rt=$[this.currentLayer];if(Im[Rt.type]){const xt=this.style.getLayerSourceCache(Rt);Im[Rt.type](this,xt,Rt,vt(Rt,xt),St)}}};Mt("initialize"),Mt("reset"),this.currentLayer=nt,jt=!0}if(j&&!Pt&&this.terrain&&!this.transform.isOrthographic&&(Pt=!0,this.blitDepth()),U&&At!==-1&&this.currentLayer===At+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ut,It,It?ce[It.id]:void 0),this.renderLayer(this,It,ut,vt(ut,It)),!this.terrain&&Oe&&ct>0&&ut.hasShadowPass()&&--ct==0&&(Oe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Mt=$[this.currentLayer];if(!Mt.hasLightBeamPass())continue;const St=s.getLayerSourceCache(Mt);this.renderLayer(this,St,Mt,St?me[St.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Mt of this.layersWithOcclusionOpacity){this.currentLayer=Mt;const St=$[this.currentLayer],Rt=s.getLayerSourceCache(St),xt=Rt?me[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(St,Rt,Rt?ce[Rt.id]:void 0),this.renderLayer(this,Rt,St,xt)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ut=null;$.forEach(It=>{const nt=s.getLayerSourceCache(It);nt&&!It.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!ut||ut.getSource().maxzoom<nt.getSource().maxzoom)&&(ut=nt)}),ut&&this.options.showTileBoundaries&&tp.debug(this,ut,ut.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&tp.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ut){const It=ut.transform.padding;vm(ut,ut.transform.height-(It.top||0),3,Ad),vm(ut,It.bottom||0,3,ym),Ih(ut,It.left||0,3,Zu),Ih(ut,ut.transform.width-(It.right||0),3,Jf);const nt=ut.transform.centerPoint;(function(Mt,St,Rt,xt){Mh(Mt,St-1,Rt-10,2,20,xt),Mh(Mt,St-10,Rt-1,20,2,xt)})(ut,nt.x,ut.transform.height-nt.y,Th)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),oe||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,g=!c||!c.includes(s.type);if(Tm[s.type]&&(g||this.terrain&&s.type==="custom")){const x=this.style.getLayerSourceCache(s);Tm[s.type](s,x,this)}this.gpuTimingEnd()}renderLayer(s,c,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||tp[g.type](s,c,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,g=this.context.gl;let x=this.gpuTimers[s.id];x||(x=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),x.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const g in s){const x=s[g],E=this.context.extTimerQuery,I=E.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;E.deleteQueryEXT(x.query),c[g]=I}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let g=0;for(const x of s)g+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return g}translatePosMatrix(s,c,g,x,E){if(!g[0]&&!g[1])return s;const I=E?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(I){const U=Math.sin(I),$=Math.cos(I);g=[g[0]*$-g[1]*U,g[0]*U+g[1]*$]}const k=[E?g[0]:i.at(c,g[0],this.transform.zoom),E?g[1]:i.at(c,g[1],this.transform.zoom),0],j=new Float32Array(16);return i.ad.mat4.translate(j,s,k),j}saveTileTexture(s){const c=s.size[0],g=this._tileTextures[c];g?g.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,c,g){const x=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,E=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||E.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||E.push("FOG","FOG_DITHERING"),x&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(s,c){this.cache=this.cache||{};const g=c&&c.defines||[],x=c&&c.config,E=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(g),I=ly.cacheKey(Nf[s],s,E,x);return this.cache[I]||(this.cache[I]=new ly(this.context,s,Nf[s],x,Zf[s],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const g=this.style.directionalLight,x=this.style.ambientLight;if(g&&x){const E=((I,k,j)=>{const U=I.properties.get("direction"),$=I.properties.get("color-use-theme")==="none",Q=I.properties.get("color").toRenderColor($?null:j.getLut(I.scope)).toArray01(),J=I.properties.get("intensity"),oe=k.properties.get("color-use-theme")==="none",pe=k.properties.get("color").toRenderColor(oe?null:j.getLut(k.scope)).toArray01(),ce=k.properties.get("intensity"),me=[U.x,U.y,U.z],ve=i.cN(pe,ce),Ee=i.cN(Q,J);return{u_lighting_ambient_color:ve,u_lighting_directional_dir:me,u_lighting_directional_color:Ee,u_ground_radiance:la(me,Ee,ve)}})(g,x,this.style);c.setLightsUniformValues(s,E)}}}uploadCommonUniforms(s,c,g,x,E){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const k=I.getOpacity(this.transform.pitch),j=((U,$,Q,J,oe,pe,ce,me,ve,Ee,Pe,Ie)=>{const Be=U.transform,Oe=$.properties.get("color-use-theme")==="none",Ne=$.properties.get("color").toRenderColor(Oe?null:U.style.getLut($.scope)).toArray01();Ne[3]=J;const ze=U.frameCounter/1e3%1,[Ue,Ye]=$.properties.get("vertical-range");return{u_fog_matrix:Q?Be.calculateFogTileMatrix(Q):Ie||U.identityMat,u_fog_range:$.getFovAdjustedRange(Be._fov),u_fog_color:Ne,u_fog_horizon_blend:$.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ue,Ye),Ye],u_fog_temporal_offset:ze,u_frustum_tl:oe,u_frustum_tr:pe,u_frustum_br:ce,u_frustum_bl:me,u_globe_pos:ve,u_globe_radius:Ee,u_viewport:Pe,u_globe_transition:i.ag(Be.zoom),u_is_globe:+(Be.projection.name==="globe")}})(this,I,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],x);c.setFogUniformValues(s,j)}E&&c.setCutoffUniformValues(s,E.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)c[x.key]=s[x.key]||new tl(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=sn||c[1]>=sn}setupDepthForOcclusion(s,c,g){const x=this.context,E=x.gl,I=!!g;var k;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(E.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),x.activeTexture.set(E.TEXTURE0),I||c.setTerrainUniformValues(x,g)}}function Mm(_,s){let c=!1,g=null;const x=()=>{g=null,c&&(_(),g=setTimeout(x,s),c=!1)};return()=>(c=!0,g||x(),g)}class jg{constructor(s){this._hashName=s&&encodeURIComponent(s),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mm(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=Vg(s);if(this._hashName){const g=this._hashName;let x=!1;const E=location.hash.slice(1).split("&").map(I=>{const k=I.split("=")[0];return k===g?(x=!0,`${k}=${c}`):I}).filter(I=>I);return x||E.push(`${g}=${c}`),`#${E.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Vg(_,s){const c=_.getCenter(),g=Math.round(100*_.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,x),I=Math.round(c.lng*E)/E,k=Math.round(c.lat*E)/E,j=_.getBearing(),U=_.getPitch();let $=s?`/${I}/${k}/${g}`:`${g}/${k}/${I}`;return(j||U)&&($+="/"+Math.round(10*j)/10),U&&($+=`/${Math.round(U)}`),$}const Pm={linearity:.3,easing:i.dB(0,0,.3,1)},py=i.l({deceleration:2500,maxSpeed:1400},Pm),Dv=i.l({deceleration:20,maxSpeed:1400},Pm),Nv=i.l({deceleration:1e3,maxSpeed:360},Pm),my=i.l({deceleration:1e3,maxSpeed:90},Pm);class gy{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=i.q.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)c.zoom+=E.zoomDelta||0,c.bearing+=E.bearingDelta||0,c.pitch+=E.pitchDelta||0,E.panDelta&&c.pan._add(E.panDelta),E.around&&(c.around=E.around),E.pinchAround&&(c.pinchAround=E.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const E=Lh(c.pan.mag(),g,i.l({},py,s||{}));x.offset=c.pan.mult(E.amount/c.pan.mag()),x.center=this._map.transform.center,rp(x,E)}if(c.zoom){const E=Lh(c.zoom,g,Dv);x.zoom=this._map.transform.zoom+E.amount,rp(x,E)}if(c.bearing){const E=Lh(c.bearing,g,Nv);x.bearing=this._map.transform.bearing+i.ay(E.amount,-179,179),rp(x,E)}if(c.pitch){const E=Lh(c.pitch,g,my);x.pitch=this._map.transform.pitch+E.amount,rp(x,E)}if(x.zoom||x.bearing){const E=c.pinchAround===void 0?c.around:c.pinchAround;x.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function rp(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function Lh(_,s,c){const{maxSpeed:g,linearity:x,deceleration:E}=c,I=i.ay(_*x/(s/1e3),-g,g),k=Math.abs(I)/(E*x);return{easing:c.easing,duration:1e3*k,amount:I*(k/2)}}class Ba extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g,x={}){const E=Se(c.getCanvasContainer(),g),I=c.unproject(E);super(s,i.l({point:E,lngLat:I,originalEvent:g},x)),this._defaultPrevented=!1,this.target=c}}class Am extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g){const x=s==="touchend"?g.changedTouches:g.touches,E=je(c.getCanvasContainer(),x),I=E.map(j=>c.unproject(j)),k=E.reduce((j,U,$,Q)=>j.add(U.div(Q.length)),new i.P(0,0));super(s,{points:E,point:k,lngLats:I,lngLat:c.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class kv extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class kl{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new kv(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new Ba(s.type,this._map,s))}mouseup(s){this._map.fire(new Ba(s.type,this._map,s))}preclick(s){const c=i.l({},s);c.type="preclick",this._map.fire(new Ba(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Ba(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Ba(s.type,this._map,s))}mouseover(s){this._map.fire(new Ba(s.type,this._map,s))}mouseout(s){this._map.fire(new Ba(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Am(s.type,this._map,s))}touchmove(s){this._map.fire(new Am(s.type,this._map,s))}touchend(s){this._map.fire(new Am(s.type,this._map,s))}touchcancel(s){this._map.fire(new Am(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _y{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Ba(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ba("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Ba(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ug{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(ae(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const g=c,x=this._startPos,E=this._lastPos;if(!x||!E||E.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=X("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const I=Math.min(x.x,g.x),k=Math.max(x.x,g.x),j=Math.min(x.y,g.y),U=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${j}px)`,this._box.style.width=k-I+"px",this._box.style.height=U-j+"px")})}mouseupWindow(s,c){if(!this._active)return;const g=this._startPos,x=c;if(g&&s.button===0){if(this.reset(),ye(),g.x!==x.x||g.y!==x.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:s})),{cameraAnimation:E=>E.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new i.A(s,{originalEvent:c}))}}function xi(_,s){const c={};for(let g=0;g<_.length;g++)c[_[g].identifier]=s[g];return c}class yy{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const E=new i.P(0,0);for(const I of x)E._add(I);return E.div(x.length)}(c),this.touches=xi(g,c)))}touchmove(s,c,g){if(this.aborted||!this.centroid)return;const x=xi(g,c);for(const E in this.touches){const I=x[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(s,c,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Gg{constructor(s){this.singleTap=new yy(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,g){this.singleTap.touchstart(s,c,g)}touchmove(s,c,g){this.singleTap.touchmove(s,c,g)}touchend(s,c,g){const x=this.singleTap.touchend(s,c,g);if(x){const E=s.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(x)<30;if(E&&I||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class vy{constructor(){this._zoomIn=new Gg({numTouches:1,numTaps:2}),this._zoomOut=new Gg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,g){this._zoomIn.touchstart(s,c,g),this._zoomOut.touchstart(s,c,g)}touchmove(s,c,g){this._zoomIn.touchmove(s,c,g),this._zoomOut.touchmove(s,c,g)}touchend(s,c,g){const x=this._zoomIn.touchend(s,c,g),E=this._zoomOut.touchend(s,c,g);return x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(x)},{originalEvent:s})}):E?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Yu={0:1,2:2},Rm={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Dd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const g=Re(s);this._correctButton(s,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(s,c){const g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(x,E){const I=Yu[E];return x.buttons===void 0||(x.buttons&I)!==I}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}}mouseupWindow(s){this._lastPoint&&Re(s)===this._eventButton&&(this._moved&&ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $g extends Dd{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class du extends Dd{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Rm[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const g=.8*(c.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class ip extends Dd{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Rm[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const g=-.5*(c.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class to{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,c,g){return this._calculateTransform(s,c,g)}touchmove(s,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,g)}}touchend(s,c,g){this._calculateTransform(s,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,g){g.length>0&&(this._active=!0);const x=xi(g,c),E=new i.P(0,0),I=new i.P(0,0);let k=0;for(const U in x){const $=x[U],Q=this._touches[U];Q&&(E._add($),I._add($.sub(Q)),k++,x[U]=$)}if(this._touches=x,k<this._minTouches||!I.mag())return;const j=I.div(k);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(k),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=X("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,g){return{}}touchstart(s,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,g){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[E,I]=x,k=Nd(g,c,E),j=Nd(g,c,I);if(!k||!j)return;const U=this._aroundCenter?null:k.add(j).div(2);return this._move([k,j],U,s)}touchend(s,c,g){if(!this._firstTwoTouches)return;const[x,E]=this._firstTwoTouches,I=Nd(g,c,x),k=Nd(g,c,E);I&&k||(this._active&&ye(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nd(_,s,c){for(let g=0;g<_.length;g++)if(_[g].identifier===c)return s[g]}function Lm(_,s){return Math.log(_/s)/Math.LN2}class pa extends hl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Lm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lm(this._distance,g),pinchAround:c}}}function Hs(_,s){return 180*_.angleWith(s)/Math.PI}class op extends hl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hs(this._vector,g),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=Hs(s,g);return Math.abs(x)<c}}function qg(_){return Math.abs(_.y)>Math.abs(_.x)}class Fv extends hl{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,qg(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,g){const x=this._lastPoints;if(!x)return;const E=s[0].sub(x[0]),I=s[1].sub(x[1]);return this._map._cooperativeGestures&&!i.dC()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(s,c,g){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,E=c.mag()>=2;if(!x&&!E)return;if(!x||!E)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const I=s.y>0==c.y>0;return qg(s)&&qg(c)&&I}}const Hg={panStep:100,bearingStep:15,pitchStep:10};class Wg{constructor(){const s=Hg;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,g=0,x=0,E=0,I=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),E=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),E=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),I=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:k=>{const j=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:kd,zoom:c?Math.round(j)+c*(s.shiftKey?2:1):j,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+x*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:k.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kd(_){return _*(2-_)}const Oh=4.000244140625,fu=1/450;class Fl{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fu,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=i.q.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,c!==0&&c%Oh==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Se(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const U=this._type==="wheel"&&Math.abs(this._delta)>Oh?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&$!==0&&($=1/$);const Q=c(),J=Math.pow(2,Q),oe=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):J;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(oe*$))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,E=this._easing;let I,k=!1;if(this._type==="wheel"&&x&&E){const U=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),$=E(U);I=i.ah(x,g,$),U<1?this._frameId||(this._frameId=!0):k=!0}else I=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let j=I-c();return j*this._lastDelta<0&&(j=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:j,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=i.dD;if(this._prevEase){const g=this._prevEase,x=(i.q.now()-g.start)/g.duration,E=g.easing(x+.01)-g.easing(x),I=.27/Math.sqrt(E*E+1e-4)*.01,k=Math.sqrt(.0729-I*I);c=i.dB(I,k,.25,1)}return this._prevEase={start:i.q.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=X("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Dc{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ku{constructor(){this._tap=new Gg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,c,g))}touchmove(s,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=c[0],E=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(s,c,g)}touchend(s,c,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,c,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zv{constructor(s,c,g){this._el=s,this._mousePan=c,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xy{constructor(s,c,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xg{constructor(s,c,g,x){this._el=s,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zg=_=>_.zoom||_.drag||_.pitch||_.rotate;class by extends i.A{}class ws{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const g=i.ad.vec3.sub([],c,s);this.radius=i.ad.vec3.length(g[2]<0?i.ad.vec3.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){i.ad.vec3.div(s,s,this.constants),i.ad.vec3.normalize(s,s),i.ad.vec3.mul(s,s,this.constants);const c=i.ad.vec3.scale([],s,this.radius);if(c[2]>0){const g=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(c,[0,0,1])),x=i.ad.vec3.scale([],i.ad.vec3.normalize([],[c[0],c[1],0]),this.radius),E=i.ad.vec3.add([],c,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],x,g),c),2));c[0]=E[0],c[1]=E[1]}return c}}function Fd(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Om{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gy(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ws,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aQ(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,E,I]of this._listeners){const k=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(E,k,I)}}destroy(){for(const[s,c,g]of this._listeners){const x=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,x,g)}}_addDefaultHandlers(s){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new kl(c,s));const x=c.boxZoom=new Ug(c,s);this._add("boxZoom",x);const E=new vy,I=new Nc;c.doubleClickZoom=new Dc(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const k=new Ku;this._add("tapDragZoom",k);const j=c.touchPitch=new Fv(c);this._add("touchPitch",j);const U=new du(s),$=new ip(s);c.dragRotate=new xy(s,U,$),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const Q=new $g(s),J=new to(c,s);c.dragPan=new zv(g,Q,J),this._add("mousePan",Q),this._add("touchPan",J,["touchZoom","touchRotate"]);const oe=new op,pe=new pa;c.touchZoomRotate=new Xg(g,pe,oe,k),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _y(c));const ce=c.scrollZoom=new Fl(c,this);this._add("scrollZoom",ce,["mousePan"]);const me=c.keyboard=new Wg;this._add("keyboard",me);for(const ve of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ve]&&c[ve].enable(s[ve])}_add(s,c,g){this._handlers.push({handlerName:s,handler:c,allowed:g}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,g){for(const x in s)if(x!==g&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const g of s)this._el.contains(g.target)&&c.push(g);return c}handleEvent(s,c){this._updatingCamera=!0;const g=s.type==="renderFrame",x=g?void 0:s,E={needsRenderFrame:!1},I={},k={},j=s.touches?this._getMapTouches(s.touches):void 0,U=j?je(this._el,j):g?void 0:Se(this._el,s);for(const{handlerName:J,handler:oe,allowed:pe}of this._handlers){if(!oe.isEnabled())continue;let ce;this._blockedByActive(k,pe,J)?oe.reset():oe[c||s.type]&&(ce=oe[c||s.type](s,U,j),this.mergeHandlerResult(E,I,ce,J,x),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||oe.isActive())&&(k[J]=oe)}const $={};for(const J in this._previousActiveHandlers)k[J]||($[J]=x);this._previousActiveHandlers=k,(Object.keys($).length||Fd(E))&&(this._changes.push([E,I,$]),this._triggerRenderFrame()),(Object.keys(k).length||Fd(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=E;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(s,c,g,x,E){if(!g)return;i.l(s,g);const I={handlerName:x,originalEvent:g.originalEvent||E};g.zoomDelta!==void 0&&(c.zoom=I),g.panDelta!==void 0&&(c.drag=I),g.pitchDelta!==void 0&&(c.pitch=I),g.bearingDelta!==void 0&&(c.rotate=I)}_applyChanges(){const s={},c={},g={};for(const[x,E,I]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),i.l(c,E),i.l(g,I);this._updateMapTransform(s,c,g),this._changes=[]}_updateMapTransform(s,c,g){const x=this._map,E=x.transform,I=Ee=>[Ee.x,Ee.y,Ee.z];if((Ee=>{const Pe=this._eventsInProgress.drag;return Pe&&!this._handlersById[Pe.handlerName].isActive()})()&&!Fd(s)){const Ee=E.zoom;E.cameraElevationReference="sea",this._originalZoom!=null&&E._orthographicProjectionAtLowPitch&&E.projection.name!=="globe"&&E.pitch===0?(E.cameraElevationReference="ground",E.zoom=this._originalZoom):(E.recenterOnTerrain(),E.cameraElevationReference="ground"),Ee!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&x._stop(!0),!Fd(s))return void this._fireEvents(c,g,!0);let{panDelta:k,zoomDelta:j,bearingDelta:U,pitchDelta:$,around:Q,aroundCoord:J,pinchAround:oe}=s;E._isCameraConstrained&&(j>0&&(j=0),E._isCameraConstrained=!1),oe!==void 0&&(Q=oe),(j||(Ee=>c[Ee]&&!this._eventsInProgress[Ee])("drag"))&&Q&&(this._dragOrigin=I(E.pointCoordinate3D(Q)),this._originalZoom=E.zoom,this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",x._stop(!0),Q=Q||x.transform.centerPoint,U&&(E.bearing+=U),$&&(E.pitch+=$),E._updateCameraState();const pe=[0,0,0];if(k)if(E.projection.name==="mercator"){const Ee=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(Q).dir),Pe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(Q.sub(k)).dir);pe[0]=Pe[0]-Ee[0],pe[1]=Pe[1]-Ee[1]}else{const Ee=E.pointCoordinate(Q);if(E.projection.name==="globe"){k=k.rotate(-E.angle);const Pe=E._pixelsPerMercatorPixel/E.worldSize;pe[0]=-k.x*i.dE(i.aT(Ee.y))*Pe,pe[1]=-k.y*i.dE(E.center.lat)*Pe}else{const Pe=E.pointCoordinate(Q.sub(k));Ee&&Pe&&(pe[0]=Pe.x-Ee.x,pe[1]=Pe.y-Ee.y)}}const ce=E.zoom,me=[0,0,0];if(j){const Ee=I(J||E.pointCoordinate3D(Q)),Pe={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],Ee,E._camera.position))};if(Pe.dir[2]<0){const Ie=E.zoomDeltaToMovement(Ee,j);i.ad.vec3.scale(me,Pe.dir,Ie)}}const ve=i.ad.vec3.add(pe,pe,me);E._translateCameraConstrained(ve),j&&Math.abs(E.zoom-ce)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,g,!0)}_fireEvents(s,c,g){const x=Zg(this._eventsInProgress),E=Zg(s),I={};for(const $ in s){const{originalEvent:Q}=s[$];this._eventsInProgress[$]||(I[`${$}start`]=Q),this._eventsInProgress[$]=s[$]}!x&&E&&this._fireEvent("movestart",E.originalEvent);for(const $ in I)this._fireEvent($,I[$]);E&&this._fireEvent("move",E.originalEvent);for(const $ in s){const{originalEvent:Q}=s[$];this._fireEvent($,Q)}const k={};let j;for(const $ in this._eventsInProgress){const{handlerName:Q,originalEvent:J}=this._eventsInProgress[$];this._handlersById[Q].isActive()||(delete this._eventsInProgress[$],j=c[Q]||J,k[`${$}end`]=j)}for(const $ in k)this._fireEvent($,k[$]);const U=Zg(this._eventsInProgress);if(g&&(x||E)&&!U){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;$?(Q($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:j})):(this._map.fire(new i.A("moveend",{originalEvent:j})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new i.A(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new by("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ju="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class sp extends i.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,g){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,i.l({offset:s},c),g)}panTo(s,c,g){return this.easeTo(i.l({center:s},c),g)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,g){return this.easeTo(i.l({zoom:s},c),g)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,g){return this.easeTo(i.l({bearing:s},c),g)}resetNorth(s,c){return this.rotateTo(0,i.l({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=i.aB.convert(s);const g=c&&c.bearing||0,x=c&&c.pitch||0,E=s.getNorthWest(),I=s.getSouthEast();return this._cameraForBounds(this.transform,E,I,g,x,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return s==null?i.l({},c,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:i.l({},c,s)}_extendCameraOptions(s){return(s=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const g=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return g/x>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):x/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,g,x,E,I){const k=s.clone(),j=this._extendCameraOptions(I);k.bearing=x,k.pitch=E;const U=i.bO.convert(c),$=i.bO.convert(g),Q=.5*(U.lat+$.lat),J=.5*(U.lng+$.lng),oe=i.dF(Q,J),pe=i.ad.vec3.normalize([],oe),ce=i.ad.vec3.normalize([],i.ad.vec3.cross([],pe,[0,1,0])),me=i.ad.vec3.cross([],ce,pe),ve=[ce[0],ce[1],ce[2],0,me[0],me[1],me[2],0,pe[0],pe[1],pe[2],0,0,0,0,1],Ee=[oe,i.dF(U.lat,U.lng),i.dF($.lat,U.lng),i.dF($.lat,$.lng),i.dF(U.lat,$.lng),i.dF(Q,U.lng),i.dF(Q,$.lng),i.dF(U.lat,J),i.dF($.lat,J)];let Pe=i.ce.fromPoints(Ee.map(St=>[i.ad.vec3.dot(ce,St),i.ad.vec3.dot(me,St),i.ad.vec3.dot(pe,St)]));const Ie=i.ad.vec3.transformMat4([],Pe.center,ve);i.ad.vec3.squaredLength(Ie)===0&&i.ad.vec3.set(Ie,0,0,1),i.ad.vec3.normalize(Ie,Ie),i.ad.vec3.scale(Ie,Ie,i.az),k.center=i.dG(Ie);const Be=k.getWorldToCameraMatrix(),Oe=i.ad.mat4.invert(new Float64Array(16),Be);Pe=i.ce.applyTransform(Pe,i.ad.mat4.multiply([],Be,ve));const Ne=this._extendAABB(Pe,k,j,x);if(!Ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Pe=Ne,i.ad.vec3.transformMat4(Ie,Ie,Be);const ze=.5*(Pe.max[2]-Pe.min[2]),Ue=this._minimumAABBFrustumDistance(k,Pe),Ye=i.ad.vec3.scale([],[0,0,1],ze),vt=i.ad.vec3.add(Ye,Ie,Ye),ct=Ue+(k.pitch===0?0:i.ad.vec3.distance(Ie,vt)),Pt=k.globeCenterInViewSpace,At=i.ad.vec3.sub([],Ie,[Pt[0],Pt[1],Pt[2]]);i.ad.vec3.normalize(At,At),i.ad.vec3.scale(At,At,ct);const jt=i.ad.vec3.add([],Ie,At);i.ad.vec3.transformMat4(jt,jt,Oe);const ut=i.dv/i.az,It=i.ad.vec3.length(jt),nt=i.bH(Math.max(It*ut-i.dv,Number.EPSILON),0),Mt=Math.min(k.zoomFromMercatorZAdjusted(nt),j.maxZoom);return Mt>.5*(i.c6+i.bY)?(k.setProjection({name:"mercator"}),k.zoom=Mt,this._cameraForBounds(k,c,g,x,E,I)):{center:k.center,zoom:Mt,bearing:x,pitch:E}}_extendAABB(s,c,g,x){const E=.5*((g.padding.left||0)+(g.padding.right||0)),I=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=I,j=E,U=E,$=I,Q=c.width-(j+U),J=c.height-(k+$),oe=i.ad.vec3.sub([],s.max,s.min),pe=Math.min(Q/oe[0],J/oe[1]),ce=Math.min(c.scaleZoom(c.scale*pe),g.maxZoom);if(isNaN(ce))return null;const me=c.scale/c.zoomScale(ce),ve=new i.ce([s.min[0]-j*me,s.min[1]-$*me,s.min[2]],[s.max[0]+U*me,s.max[1]+k*me,s.max[2]]),Ee=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.ak(x));return ve.center[0]-=Ee.x*me,ve.center[1]+=Ee.y*me,ve}queryTerrainElevation(s,c){const g=this.transform.elevation;return g?(c=i.l({},{exaggerated:!0},c),g.getAtPoint(i.ac.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,g,x,E,I){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,g,x,E,I);const k=s.clone(),j=this._extendCameraOptions(I);k.bearing=x,k.pitch=E;const U=i.bO.convert(c),$=i.bO.convert(g),Q=new i.bO(U.lng,$.lat),J=new i.bO($.lng,U.lat),oe=k.project(U),pe=k.project($),ce=this.queryTerrainElevation(U),me=this.queryTerrainElevation($),ve=this.queryTerrainElevation(Q),Ee=this.queryTerrainElevation(J),Pe=[[oe.x,oe.y,Math.min(ce||0,me||0,ve||0,Ee||0)],[pe.x,pe.y,Math.max(ce||0,me||0,ve||0,Ee||0)]];let Ie=i.ce.fromPoints(Pe);const Be=k.getWorldToCameraMatrix(),Oe=i.ad.mat4.invert(new Float64Array(16),Be);Ie=i.ce.applyTransform(Ie,Be);const Ne=this._extendAABB(Ie,k,j,x);if(!Ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ie=Ne;const ze=.5*i.ad.vec3.sub([],Ie.max,Ie.min)[2],Ue=this._minimumAABBFrustumDistance(k,Ie),Ye=[0,0,1,0];i.ad.vec4.transformMat4(Ye,Ye,Be),i.ad.vec4.normalize(Ye,Ye);const vt=i.ad.vec3.scale([],Ye,Ue+ze),ct=i.ad.vec3.add([],Ie.center,vt);i.ad.vec3.transformMat4(Ie.center,Ie.center,Oe),i.ad.vec3.transformMat4(ct,ct,Oe);const Pt=k.unproject(new i.P(Ie.center[0],Ie.center[1])),At=i.dH(k.projection,Pt),jt=Math.pow(2,At),ut=Math.min(k._zoomFromMercatorZ(ct[2]*k.pixelsPerMeter*jt/k.worldSize),j.maxZoom);return k.mercatorFromTransition&&ut<.5*(i.c6+i.bY)?(k.setProjection({name:"globe"}),k.zoom=ut,this._cameraForBounds(k,c,g,x,E,I)):{center:Pt,zoom:ut,bearing:x,pitch:E}}fitBounds(s,c,g){const x=this.cameraForBounds(s,c);return this._fitInternal(x,c,g)}fitScreenCoordinates(s,c,g,x,E){const I=i.P.convert(s),k=i.P.convert(c),j=new i.P(Math.min(I.x,k.x),Math.min(I.y,k.y)),U=new i.P(Math.max(I.x,k.x),Math.max(I.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,k))return this;const $=this.transform.pointLocation3D(j),Q=this.transform.pointLocation3D(U),J=this.transform.pointLocation3D(new i.P(j.x,U.y)),oe=this.transform.pointLocation3D(new i.P(U.x,j.y)),pe=[Math.min($.lng,Q.lng,J.lng,oe.lng),Math.min($.lat,Q.lat,J.lat,oe.lat)],ce=[Math.max($.lng,Q.lng,J.lng,oe.lng),Math.max($.lat,Q.lat,J.lat,oe.lat)],me=x&&x.pitch?x.pitch:this.getPitch(),ve=this._cameraForBounds(this.transform,pe,ce,g,me,x);return this._fitInternal(ve,x,E)}_fitInternal(s,c,g){return s?(c=i.l(s,c)).linear?this.easeTo(c,g):this.flyTo(c,g):this}jumpTo(s,c){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let x=!1,E=!1,I=!1;"zoom"in s&&g.zoom!==+s.zoom&&(x=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=i.bO.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(E=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(I=!0,g.pitch=+s.pitch);const k=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!g.isPaddingEqual(k))if(s.retainPadding===!1){const j=g.clone();j.padding=k,g.setLocationAtPoint(g.center,j.centerPoint)}else g.padding=k;return s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),x&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),E&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),I&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Ju),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(Ju),this;this.stop();const x=g.zoom,E=g.pitch,I=g.bearing;g.setFreeCameraOptions(s);const k=x!==g.zoom,j=E!==g.pitch,U=I!==g.bearing;return this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),k&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),U&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),j&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=i.l({offset:[0,0],duration:500,easing:i.dD},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,x=this.getZoom(),E=this.getBearing(),I=this.getPitch(),k=this.getPadding(),j="zoom"in s?+s.zoom:x,U="bearing"in s?this._normalizeBearing(s.bearing,E):E,$="pitch"in s?+s.pitch:I,Q=this._extendPadding(s.padding),J=i.P.convert(s.offset);let oe,pe,ce;if(g.projection.name==="globe"){const Ye=i.ac.fromLngLat(g.center),vt=J.rotate(-g.angle);Ye.x+=vt.x/g.worldSize,Ye.y+=vt.y/g.worldSize;const ct=Ye.toLngLat(),Pt=i.bO.convert(s.center||ct);this._normalizeCenter(Pt),oe=g.centerPoint.add(vt),pe=new i.P(Ye.x,Ye.y).mult(g.worldSize),ce=new i.P(i.av(Pt.lng),i.aC(Pt.lat)).mult(g.worldSize).sub(pe)}else{oe=g.centerPoint.add(J);const Ye=g.pointLocation(oe),vt=i.bO.convert(s.center||Ye);this._normalizeCenter(vt),pe=g.project(Ye),ce=g.project(vt).sub(pe)}const me=g.zoomScale(j-x);let ve,Ee;s.around&&(ve=i.bO.convert(s.around),Ee=g.locationPoint(ve));const Pe=this._zooming||j!==x,Ie=this._rotating||E!==U,Be=this._pitching||$!==I,Oe=!g.isPaddingEqual(Q),Ne=s.retainPadding===!1?g.clone():g,ze=Ye=>vt=>{if(Pe&&(Ye.zoom=i.ah(x,j,vt)),Ie&&(Ye.bearing=i.ah(E,U,vt)),Be&&(Ye.pitch=i.ah(I,$,vt)),Oe&&(Ne.interpolatePadding(k,Q,vt),oe=Ne.centerPoint.add(J)),ve)Ye.setLocationAtPoint(ve,Ee);else{const ct=Ye.zoomScale(Ye.zoom-x),Pt=j>x?Math.min(2,me):Math.max(.5,me),At=Math.pow(Pt,1-vt),jt=Ye.unproject(pe.add(ce.mult(vt*At)).mult(ct));Ye.setLocationAtPoint(Ye.renderWorldCopies?jt.wrap():jt,oe)}return s.preloadOnly||this._fireMoveEvents(c),Ye};if(s.preloadOnly){const Ye=this._emulate(ze,s.duration,g);return this._preloadTiles(Ye),this}const Ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Pe,this._rotating=Ie,this._pitching=Be,this._padding=Oe,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Ue),this._ease(ze(g),Ye=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(c,Ye)},s),this}_prepareEase(s,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new i.A("movestart",s)),this._zooming&&!g.zooming&&this.fire(new i.A("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new i.A("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new i.A("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.A("move",s)),this._zooming&&this.fire(new i.A("zoom",s)),this._rotating&&this.fire(new i.A("rotate",s)),this._pitching&&this.fire(new i.A("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.A("zoomend",s)),x&&this.fire(new i.A("rotateend",s)),E&&this.fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const St=i.aA(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(St,c)}this.stop(),s=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},s);const g=this.transform,x=this.getZoom(),E=this.getBearing(),I=this.getPitch(),k=this.getPadding(),j="zoom"in s?i.ay(+s.zoom,g.minZoom,g.maxZoom):x,U="bearing"in s?this._normalizeBearing(s.bearing,E):E,$="pitch"in s?+s.pitch:I,Q=this._extendPadding(s.padding),J=g.zoomScale(j-x),oe=i.P.convert(s.offset);let pe=g.centerPoint.add(oe);const ce=g.pointLocation(pe),me=i.bO.convert(s.center||ce);this._normalizeCenter(me);const ve=g.project(ce),Ee=g.project(me).sub(ve);let Pe=s.curve;const Ie=Math.max(g.width,g.height),Be=Ie/J,Oe=Ee.mag();if("minZoom"in s){const St=i.ay(Math.min(s.minZoom,x,j),g.minZoom,g.maxZoom),Rt=Ie/g.zoomScale(St-x);Pe=Math.sqrt(Rt/Oe*2)}const Ne=Pe*Pe;function ze(St){const Rt=(Be*Be-Ie*Ie+(St?-1:1)*Ne*Ne*Oe*Oe)/(2*(St?Be:Ie)*Ne*Oe);return Math.log(Math.sqrt(Rt*Rt+1)-Rt)}function Ue(St){return(Math.exp(St)-Math.exp(-St))/2}function Ye(St){return(Math.exp(St)+Math.exp(-St))/2}const vt=ze(0);let ct=function(St){return Ye(vt)/Ye(vt+Pe*St)},Pt=function(St){return Ie*((Ye(vt)*(Ue(Rt=vt+Pe*St)/Ye(Rt))-Ue(vt))/Ne)/Oe;var Rt},At=(ze(1)-vt)/Pe;if(Math.abs(Oe)<1e-6||!isFinite(At)){if(Math.abs(Ie-Be)<1e-6)return this.easeTo(s,c);const St=Be<Ie?-1:1;At=Math.abs(Math.log(Be/Ie))/Pe,Pt=function(){return 0},ct=function(Rt){return Math.exp(St*Pe*Rt)}}s.duration="duration"in s?+s.duration:1e3*At/("screenSpeed"in s?+s.screenSpeed/Pe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const jt=E!==U,ut=$!==I,It=!g.isPaddingEqual(Q),nt=s.retainPadding===!1?g.clone():g,Mt=St=>Rt=>{const xt=Rt*At,Lt=1/ct(xt);St.zoom=Rt===1?j:x+St.scaleZoom(Lt),jt&&(St.bearing=i.ah(E,U,Rt)),ut&&(St.pitch=i.ah(I,$,Rt)),It&&(nt.interpolatePadding(k,Q,Rt),pe=nt.centerPoint.add(oe));const en=Rt===1?me:St.unproject(ve.add(Ee.mult(Pt(xt))).mult(Lt));return St.setLocationAtPoint(St.renderWorldCopies?en.wrap():en,pe),St._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),St};if(s.preloadOnly){const St=this._emulate(Mt,s.duration,g);return this._preloadTiles(St),this}return this._zooming=!0,this._rotating=jt,this._pitching=ut,this._padding=It,this._prepareEase(c,!1),this._ease(Mt(g),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,c,g){g.animate===!1||g.duration===0?(s(1),c()):(this._easeStart=i.q.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=i.bF(s,-180,180);const g=Math.abs(s-c);return Math.abs(s-360-c)<g&&(s-=360),Math.abs(s+360-c)<g&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const g=s.lng-c.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,g){const x=Math.ceil(15*c/1e3),E=[],I=s(g.clone());for(let k=0;k<=x;k++){const j=I(k/x);E.push(j.clone())}return E}_preloadTiles(s,c){}}class Dm{constructor(s={}){this.options=s,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,g=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const x=X("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",g),this._innerContainer=X("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(s){const g=c.reduce((x,E,I)=>(E.value&&(x+=`${E.key}=${E.value}${I<c.length-1?"&":""}`),x),"?");s.href=`${i.e.FEEDBACK_URL}/${g}#${Vg(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const E=c[x];if(E.used){const I=E.getSource();I.attribution&&s.indexOf(I.attribution)<0&&s.push(I.attribution)}}s.sort((x,E)=>x.length-E.length),s=s.filter((x,E)=>{for(let I=E+1;I<s.length;I++)if(s[I].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ma{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=X("div","mapboxgl-ctrl");const c=X("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const g=s[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class ja{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const x of g)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zd{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=i.cC((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,g){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+g}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Do extends i.A{constructor(s,c,g,x){const{point:E,lngLat:I,originalEvent:k,target:j}=s;super(s.type,{point:E,lngLat:I,originalEvent:k,target:j}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=g,this.feature=x}}class wy{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const g=c.filter;let x=c.type;g&&this.filters.set(s,i.a_(g)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const E=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,c)):E.size===0&&this.map.on(x,this.handleType),E.size===0&&this.interactionsByType.set(x,E),E.set(s,c),this.typeById.set(s,x)}get(s){const c=this.typeById.get(s);if(!c)return;const g=this.interactionsByType.get(c);return g?g.get(s):void 0}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const g=this.interactionsByType.get(c);g&&(g.delete(s),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(c,this.handleType))}queryTargets(s,c){const g=[];for(const[x,E]of c)E.target&&g.push({targetId:x,target:E.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(s,g,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());c.length&&(s.type="mouseenter",this.handleType(s,c));const g=new Map;for(const[x,{feature:E}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||g.set(E.id,E);g.size&&(s.type="mouseleave",this.handleType(s,Array.from(g.values())))}handleOut(s){const c=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);c.length&&(s.type="mouseleave",this.handleType(s,c)),this.hoveredFeatures.clear()}handleType(s,c){const g=Array.from(this.interactionsByType.get(s.type)).reverse(),x=!!c;c=c||this.queryTargets(s.point,g);const E=s.type==="mouseenter";let I=!1;const k=new Set;for(const j of c){for(const[U,$]of g){if(!$.target)continue;const Q=j.variants?j.variants[U]:null;if(Q){for(const J of Q){if(vc(J,j,k,U))continue;const oe=new i.cx(j,J),pe=sh(J,j,U);x&&(oe.state=this.map.getFeatureState(oe));const ce=E?this.prevHoveredFeatures.get(pe):null,me=new Do(s,U,$,oe),ve=ce?ce.stop:$.handler(me);if(E&&this.hoveredFeatures.set(pe,{feature:j,stop:ve}),ve!==!1){I=!0;break}}if(I)break}}if(I)break}if(!I)for(const[j,U]of g){const{handler:$,target:Q}=U;if(!Q&&$(new Do(s,j,U,null))!==!1)break}}}function zr(_,s){if(Array.isArray(_)&&Array.isArray(s)){const c=new Set(_),g=new Set(s);return c.size===g.size&&_.every(x=>g.has(x))}return i.bn(_,s)}const mu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ws={showCompass:!0,showZoom:!0,visualizePitch:!1};class kx{constructor(s,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new du({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new ip({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),ae()}move(s,c){const g=this.map,x=this.mouseRotate.mousemoveWindow(s,c),E=x&&x.bearingDelta;if(E&&g.setBearing(g.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(s,c),k=I&&I.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(i.l({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Se(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Se(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=je(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=je(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function $n(_,s,c){if(_=new i.bO(_.lng,_.lat),s){const g=new i.bO(_.lng-360,_.lat),x=new i.bO(_.lng+360,_.lat),E=360*Math.ceil(Math.abs(_.lng-c.center.lng)/360),I=c.locationPoint3D(_).distSqr(s),k=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint3D(g).distSqr(s)<I&&(k||Math.abs(g.lng-c.center.lng)<E)?_=g:c.locationPoint3D(x).distSqr(s)<I&&(k||Math.abs(x.lng-c.center.lng)<E)&&(_=x)}for(;Math.abs(_.lng-c.center.lng)>180;){const g=c.locationPoint3D(_);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;_.lng>c.center.lng?_.lng-=360:_.lng+=360}return _}const ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},es={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class us extends i.E{constructor(s,c){super(),(s instanceof HTMLElement||c)&&(s=i.l({element:s},c)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:x="#3FB1CE",scale:E=1,draggable:I=!1,clickTolerance:k=0,rotation:j=es.rotation,rotationAlignment:U=es.rotationAlignment,pitchAlignment:$=es.pitchAlignment,occludedOpacity:Q=es.occludedOpacity,altitude:J=es.altitude}=s||{};this._anchor=g,this._color=x,this._scale=E,this._draggable=I,this._clickTolerance=k,this._rotation=j,this._rotationAlignment=U,this._pitchAlignment=$,this._occludedOpacity=Q,this._altitude=J,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ce=>{ce.preventDefault()}),this._element.addEventListener("mousedown",ce=>{ce.preventDefault()});const oe=this._element.classList;for(const ce in ga)oe.remove(`mapboxgl-marker-anchor-${ce}`);oe.add(`mapboxgl-marker-anchor-${this._anchor}`);const pe=s&&s.className?s.className.trim().split(/\s+/):[];oe.add(...pe),this._popup=null}_createDefaultMarker(){const s=X("div"),c=ue("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const g=ue("radialGradient",{id:"shadowGradient"},ue("defs",{},c));ue("stop",{offset:"10%","stop-opacity":.4},g),ue("stop",{offset:"100%","stop-opacity":.05},g),ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.bO.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||es.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,g=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const g=s.unproject(c,this._altitude),x=s.getFreeCameraOptions();if(!x.position)return!1;const E=x.position.toLngLat();return E.distanceTo(g)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(c,this._altitude);let x;s._showingGlobe()&&i.dK(s.transform,this._lngLat)?x=0:(x=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${ga[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!s||g!=="map")return"";if(!c._showingGlobe()){const j=c.getPitch();return j?`rotateX(${j}deg)`:""}const x=i.c4(i.dL(c.transform,this._lngLat)),E=s.sub(i.dM(c.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(I===0)return"";const k=x/I;return`rotateX(${-E.y*k}deg) rotateY(${E.x*k}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const E=c.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),I=c.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(E);g=i.c4(Math.atan2(I.y,I.x))-90}else g=-c.getBearing();else if(x==="horizon"){const E=i.ae(4,6,c.getZoom()),I=i.dM(c.transform);I.y+=E*c.transform.height;const k=s.sub(I),j=i.c4(Math.atan2(k.y,k.x));g=(j>90?j-270:j+90)*(1-E)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=$n(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const E=this._clickTolerance||c._clickTolerance;if(s.point.dist(g)<E)return;this._isDragging=!0}this._pos=s.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,g=this._pos;c&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||es.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||es.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||es.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||es.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Va={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},go={maxWidth:100,unit:"metric"},ap={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Rs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Sy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kc(_=new i.P(0,0),s="bottom"){if(typeof _=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(s){case"top":return new i.P(0,_);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-_);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(_,0);case"right":return new i.P(-_,0)}return new i.P(0,0)}return _ instanceof i.P||Array.isArray(_)?i.P.convert(_):i.P.convert(_[s]||[0,0])}return{version:b,supported:W.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends sp{constructor(_){A.mark(C.create);const s=_;if((_=i.l({},mu,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&i.dI(window)&&(_.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Jp(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies,null,null),_),this._repaint=!!_.repaint,this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new ja,this._domRenderTaskQueue=new ja,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},pu,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._tessellationStep=_.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=_.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=_.scaleFactor,this._requestManager=new Fe(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,this._contextCreateOptions=_.contextCreateOptions?Object.assign({},_.contextCreateOptions):{},typeof _.container=="string"){const c=document.getElementById(_.container);if(!c)throw new Error(`Container '${_.container.toString()}' not found.`);this._container=c}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),this._spriteFormat=_.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new kg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Om(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,(_.style||!_.testMode)&&this.setStyle(_.style||i.e.DEFAULT_STYLE,{config:_.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this.indoor=new Iv(this),_.hash&&(this._hash=new jg(typeof _.hash=="string"&&_.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch});const c=_.bounds;c&&(this.resize(),this.fitBounds(c,i.l({},_.fitBoundsOptions,{duration:0})))}this.resize(),_.attributionControl&&this.addControl(new Dm({customAttribution:_.customAttribution})),this._logoControl=new ma,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.A(`${c.dataType}dataloading`,c))}),this._interactions=new wy(this)}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=_.onAdd(this);this._controls.push(_);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new i.A("movestart",_)).fire(new i.A("move",_)),this.fire(new i.A("resize",_)),s&&this.fire(new i.A("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(i.aB.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(_){return this._scaleFactor=_,this.painter.scaleFactor=_,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(s=>s==="auto"?navigator.language:s):_}setLanguage(_){const s=this._parseLanguage(_);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,s=_.projection.name;let c;s==="globe"&&_.zoom>=i.bY?(_.setMercatorFromTransition(),c=!0):s==="mercator"&&_.zoom<i.bY&&(_.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,s){return this._updateProjection(_||s||{name:"mercator"})}_updateProjection(_){let s;return s=_.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(_,s){return this.transform.locationPoint3D(i.bO.convert(_),s)}unproject(_,s){return this.transform.pointLocation3D(i.P.convert(_),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,s,c){const g=x=>{let E=[];if(Array.isArray(s)){const I=s.filter(k=>this.getLayer(k));E=I.length?this.queryRenderedFeatures(x,{layers:I}):[]}else E=this.queryRenderedFeatures(x,{target:s});return E};if(_==="mouseenter"||_==="mouseover"){let x=!1;return{listener:c,targets:s,delegates:{mousemove:I=>{const k=g(I.point);k.length?x||(x=!0,c.call(this,new Ba(_,this,I.originalEvent,{features:k}))):x=!1},mouseout:()=>{x=!1}}}}if(_==="mouseleave"||_==="mouseout"){let x=!1;return{listener:c,targets:s,delegates:{mousemove:k=>{g(k.point).length?x=!0:x&&(x=!1,c.call(this,new Ba(_,this,k.originalEvent)))},mouseout:k=>{x&&(x=!1,c.call(this,new Ba(_,this,k.originalEvent)))}}}}{const x=E=>{const I=g(E.point);I.length&&(E.features=I,c.call(this,E),delete E.features)};return{listener:c,targets:s,delegates:{[_]:x}}}}on(_,s,c){if(typeof s=="function"||c===void 0)return super.on(_,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(_,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(_,s,c){if(typeof s=="function"||c===void 0)return super.once(_,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(_,s,c);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(_,s,c){if(typeof s=="function"||c===void 0)return super.off(_,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._delegatedListeners?this._delegatedListeners[_]:void 0;return g&&(x=>{for(let E=0;E<x.length;E++){const I=x[E];if(I.listener===c&&zr(I.targets,s)){for(const k in I.delegates)this.off(k,I.delegates[k]);return x.splice(E,1),this}}})(g),this}queryRenderedFeatures(_,s){if(!this.style)return[];if(_===void 0||_ instanceof i.P||Array.isArray(_)||s!==void 0||(s=_,_=void 0),_=_||[[0,0],[this.transform.width,this.transform.height]],!s){const E=this.style.queryRenderedFeatures(_,void 0,this.transform),I=this.style.queryRenderedFeatureset(_,void 0,this.transform);return E.concat(I)}let c=!0;if(s.target&&(c=this._isTargetValid(s.target),c&&!s.layers))return this.style.queryRenderedFeatureset(_,s,this.transform);let g=!0;if(s.layers&&Array.isArray(s.layers)){for(const E of s.layers)if(!this._isValidId(E)){g=!1;break}if(g&&!s.target)return this.style.queryRenderedFeatures(_,s,this.transform)}let x=[];return g&&(x=x.concat(this.style.queryRenderedFeatures(_,s,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(_,s,this.transform))),x}querySourceFeatures(_,s){return!_||typeof _=="string"&&!this._isValidId(_)?[]:this.style.querySourceFeatures(_,s)}isPointOnSurface(_){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(_))}addInteraction(_,s){return this._interactions.add(_,s),this}removeInteraction(_){return this._interactions.remove(_),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(_){return this._cooperativeGestures=_,this}setStyle(_,s){return s=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&_&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(_,(c,g)=>{c?(i.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(_,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(_,s))}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_){const c=i.l({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new ol(this,c).load(_),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ol(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(_){return _==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(_)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${_}".`))),!1)}_isTargetValid(_){return"featuresetId"in _?this._isValidId("importId"in _?_.importId:_.featuresetId):"layerId"in _&&this._isValidId(_.layerId)}_areTargetsValid(_){if(Array.isArray(_)){for(const s of _)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(_)}addSource(_,s){return this._isValidId(_)?(this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)):this}isSourceLoaded(_){return!!this._isValidId(_)&&!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(_,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(_,s,c)}removeSource(_){return this._isValidId(_)?(this.style.removeSource(_),this._updateTerrain(),this._update(!0)):this}getSource(_){return this._isValidId(_)?this.style.getOwnSource(_):null}addImage(_,s,{pixelRatio:c=1,sdf:g=!1,stretchX:x,stretchY:E,content:I}={}){this._lazyInitEmptyStyle();const k=i.I.from(_);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:j,height:U,data:$}=i.q.getImageData(s);this.style.addImage(k,this.style.scope,{data:new i.r({width:j,height:U},$),pixelRatio:c,stretchX:x,stretchY:E,content:I,sdf:g,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:j,height:U}=s,$=s;this.style.addImage(k,this.style.scope,{data:new i.r({width:j,height:U},new Uint8Array($.data)),pixelRatio:c,stretchX:x,stretchY:E,content:I,sdf:g,usvg:!1,version:0,userImage:$}),$.onAdd&&$.onAdd(this,_)}}updateImage(_,s){this._lazyInitEmptyStyle();const c=i.I.from(_),g=this.style.getImage(c,this.style.scope);if(!g)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.q.getImageData(s):s,{width:E,height:I,data:k}=x;if(E===void 0||I===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(E!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||I!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${E}, ${I})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const j=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let U=!1;g.usvg?(g.data=new i.r({width:E,height:I},new Uint8Array(k)),g.usvg=!1,g.icon=void 0,U=!0):g.data.replace(k,j),this.style.updateImage(c,this.style.scope,g,U)}hasImage(_){return _?!!this.style&&!!this.style.getImage(i.I.from(_),this.style.scope):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(i.I.from(_),this.style.scope)}loadImage(_,s){i.o(this._requestManager.transformRequest(_,i.R.Image),(c,g)=>{s(c,g instanceof HTMLImageElement?i.q.getImageData(g):g)})}listImages(){return this.style.listImages().map(_=>_.name)}addModel(_,s){this._lazyInitEmptyStyle(),this.style.addModel(_,s)}hasModel(_){return _?this.style.hasModel(_):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(_){this.style.removeModel(_)}listModels(){return this.style.listModels()}addLayer(_,s){return this._isValidId(_.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)):this}getSlot(_){const s=this.getLayer(_);return s&&s.slot||null}setSlot(_,s){return this.style.setSlot(_,s),this.style.mergeLayers(),this._update(!0)}addImport(_,s){return this.style.addImport(_,s),this}updateImport(_,s){return typeof s!="string"&&s.id!==_?(this.removeImport(_),this.addImport(s)):(this.style.updateImport(_,s),this._update(!0))}removeImport(_){return this.style.removeImport(_),this}moveImport(_,s){return this.style.moveImport(_,s),this._update(!0)}moveLayer(_,s){return this._isValidId(_)?(this.style.moveLayer(_,s),this._update(!0)):this}removeLayer(_){return this._isValidId(_)?(this.style.removeLayer(_),this._update(!0)):this}getLayer(_){if(!this._isValidId(_))return null;const s=this.style.getOwnLayer(_);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(_,s,c){return this._isValidId(_)?(this.style.setLayerZoomRange(_,s,c),this._update(!0)):this}setFilter(_,s,c={}){return this._isValidId(_)?(this.style.setFilter(_,s,c),this._update(!0)):this}getFilter(_){return this._isValidId(_)?this.style.getFilter(_):null}setPaintProperty(_,s,c,g={}){return this._isValidId(_)?(this.style.setPaintProperty(_,s,c,g),this._update(!0)):this}getPaintProperty(_,s){return this._isValidId(_)?this.style.getPaintProperty(_,s):null}setLayoutProperty(_,s,c,g={}){return this._isValidId(_)?(this.style.setLayoutProperty(_,s,c,g),this._update(!0)):this}getLayoutProperty(_,s){return this._isValidId(_)?this.style.getLayoutProperty(_,s):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(_){return this.style.setGlyphsUrl(_),this._update(!0)}getSchema(_){return this.style.getSchema(_)}setSchema(_,s){return this.style.setSchema(_,s),this._update(!0)}getConfig(_){return this.style.getConfig(_)}setConfig(_,s){return this.style.setConfig(_,s),this._update(!0)}getConfigProperty(_,s){return this.style.getConfigProperty(_,s)}setConfigProperty(_,s,c){return this.style.setConfigProperty(_,s,c),this._update(!0)}getFeaturesetDescriptors(_){return this.style.getFeaturesetDescriptors(_)}setLights(_){if(this._lazyInitEmptyStyle(),_&&_.length===1&&_[0].type==="flat"){const s=_[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(_),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const _=this.style.getLights()||[];return _.length===0&&_.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),_}setLight(_,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:_}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(_){return this._lazyInitEmptyStyle(),this.style.setSnow(_),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(_){return this._lazyInitEmptyStyle(),this.style.setRain(_),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(_){return this._lazyInitEmptyStyle(),this.style.setColorTheme(_),this._update(!0)}setImportColorTheme(_,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(_,s),this._update(!0)}setCamera(_){return this.style.setCamera(_),this._triggerCameraUpdate(_)}_triggerCameraUpdate(_){return this._update(this.transform.setOrthographicProjectionAtLowPitch(_["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(_),this.transform):0}setFeatureState(_,s){return _.source&&!this._isValidId(_.source)?this:(this.style.setFeatureState(_,s),this._update())}removeFeatureState(_,s){return _.source&&!this._isValidId(_.source)?this:(this.style.removeFeatureState(_,s),this._update())}getFeatureState(_){return _.source&&!this._isValidId(_.source)?null:this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,g,x,E=this._container;for(;E&&(!g||!x);){const I=window.getComputedStyle(E).transform;I&&I!=="none"&&(c=I.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(g=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),E=E.parentElement}this._containerWidth=g?Math.abs(_/g):_,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=X("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=X("div","mapboxgl-canvas-container",_);this._canvas=X("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=X("div","mapboxgl-control-container",_),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{g[x]=X("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s){const c=i.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(_),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const s=this._markers.indexOf(_);s!==-1&&this._markers.splice(s,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const s=this._popups.indexOf(_);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const _=i.l({},W.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",_);s?(Mr(s,!0),this.painter=new np(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(s)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let s;this.fire(new i.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,g=i.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,$=this.transform.pitch,Q=i.q.now(),J=new i.aa(U,{now:Q,fadeDuration:E,pitch:$,transition:this.style.transition});this.style.update(J)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(g);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,A.mark(C.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const U=i.q.now()-g;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const $=x.getQueryParameter(s,x.QUERY_RESULT)/1e6;x.deleteQuery(s),this.fire(new i.A("gpu-timing-frame",{cpuTime:U,gpuTime:$}))},50)}if(this.listens("gpu-timing-layer")){const U=this.painter.collectGpuTimers();setTimeout(()=>{const $=this.painter.queryGpuTimers(U);this.fire(new i.A("gpu-timing-layer",{layerTimes:$}))},50)}if(this.listens("gpu-timing-deferred-render")){const U=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const $=this.painter.queryGpuTimeDeferredRender(U);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:$}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(j||this._repaint)this.triggerRepaint();else{const U=this.idle();if(U&&(I=this._updateAverageElevation(g,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),U&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,A.mark(C.fullLoad),this._performanceMetricsCollection&&wn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const s of this._markers)_&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!_||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(_,s=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const x=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=_;const I=Math.abs(x-E);if(I>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(E),c(E);this._averageElevation.easeTo(E,_,300)}else if(I>1e-4)return this._averageElevation.jumpTo(E),c(E)}return!!this._averageElevation.isEasing(_)&&c(this._averageElevation.getValue(_))}_authenticate(){we(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===ot||_.status===401)){const s=this.painter.context.gl;Mr(s,!1),this._logoControl instanceof ma&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Yt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&nn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function x(E){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,E,0);const I=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,I),I}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(x(_),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(_,s,c){let g=c[1]-c[0];const x=_.length/4;for(let E=0;E<s.length;E++){const I=s[E];let k=0;for(let j=0;j<I.length;j+=4)I[j]===_[j]&&I[j+1]===_[j+1]&&I[j+2]===_[j+2]&&I[j+3]===_[j+3]&&(k+=1);g+=(c[E+2]-c[E+1])*(1-k/x)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Rr.delete(this.painter.context.gl),Pn.remove(),gt.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=i.q.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(_){const s=this.style?this.style.getSourceCaches():[];return i.bl(s,(c,g)=>c._preloadTiles(_,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(_){this._showParseStatus!==_&&(this._showParseStatus=_,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(_){this._showLayers2DWireframe!==_&&(this._showLayers2DWireframe=_,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(_){this._showLayers3DWireframe!==_&&(this._showLayers3DWireframe=_,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,this._tp.refreshUI(),_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,this._tp.refreshUI(),_&&this._update())}_setCacheLimits(_,s){i.dJ(_,s)}get version(){return b}},NavigationControl:class{constructor(_={}){this.options=i.l({},Ws,_),this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),X("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),X("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=X("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const s=_.getZoom(),c=s===_.getMaxZoom(),g=s===_.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kx(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,s){const c=X("button",_,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(_,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);_.setAttribute("aria-label",c),_.firstElementChild&&_.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(_={}){super();const s=navigator.geolocation;this.options=i.l({geolocation:s},Va,_),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,_(c)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>s(c.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),c=_.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",_)),this._finish()}}_updateCamera(_){const s=new i.bO(_.coords.longitude,_.coords.latitude),c=_.coords.accuracy,g=this._map.getBearing(),x=i.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),x,{geolocateSource:!0})}_updateMarker(_){if(_){const s=new i.bO(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,s=i.bH(1,_._center.lat)*_.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=X("button","mapboxgl-ctrl-geolocate",this._container),X("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X("div","mapboxgl-user-location"),this._dotElement.appendChild(X("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(X("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new us({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=X("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new us({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dm,ScaleControl:class{constructor(_={}){this.options=i.l({},go,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,g=s._containerWidth/2-_/2,x=s.unproject([g,c]),E=s.unproject([g+_,c]),I=x.distanceTo(E);if(this.options.unit==="imperial"){const k=3.2808*I;k>5280?this._setScale(_,k/5280,"mile"):this._setScale(_,k,"foot")}else this.options.unit==="nautical"?this._setScale(_,I/1852,"nautical-mile"):I>=1e3?this._setScale(_,I/1e3,"kilometer"):this._setScale(_,I,"meter")}_setScale(_,s,c){this._map._requestDomTask(()=>{const g=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let k=E/I;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(j){const U=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*U)/U}(k),I*k}(s),x=g/s;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${ap[c]}`,this._container.style.width=_*x+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_={}){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=X("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(_){super(),this.options=i.l(Object.create(Rs),_),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=i.bO.convert(_),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(_){return this._altitude=_,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=_;g=c.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=X("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(_),this.options.closeButton){const c=this._closeButton=X("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let s;return this._classList.delete(_)?s=!1:(this._classList.add(_),s=!0),this._updateClassList(),s}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,g=this._pos;if(!s||!c||!g)return"bottom";const x=c.offsetWidth,E=c.offsetHeight,I=g.x<x/2,k=g.x>s.transform.width-x/2;if(g.y+_<E)return I?"top-left":k?"top-right":"top";if(g.y>s.transform.height-E){if(I)return"bottom-left";if(k)return"bottom-right"}return I?"left":k?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),_.className=s.join(" ")}_update(_){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=X("div","mapboxgl-popup",s.getContainer()),this._tip=X("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$n(this._lngLat,this._pos,s.transform)),!this._trackPointer||_){const x=this._pos=this._trackPointer&&_ instanceof i.P?_:s.project(this._lngLat,this._altitude),E=kc(this.options.offset),I=this._anchor=this._getAnchor(E.y),k=kc(this.options.offset,I),j=x.add(k).round();s._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${ga[I]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&s._showingGlobe()){const x=i.dK(s.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Sy);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:us,Style:ol,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:vg,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(_){i.e.ACCESS_TOKEN=_},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(_){i.e.API_URL=_},get workerCount(){return i.dR.workerCount},set workerCount(_){i.dR.workerCount=_},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){i.e.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){i.dS(_)},get workerUrl(){return i.dT.workerUrl},set workerUrl(_){i.dT.workerUrl=_},get workerClass(){return i.dT.workerClass},set workerClass(_){i.dT.workerClass=_},get workerParams(){return i.dT.workerParams},set workerParams(_){i.dT.workerParams=_},get dracoUrl(){return i.dU()},set dracoUrl(_){i.dV(_)},get meshoptUrl(){return i.dW()},set meshoptUrl(_){i.dX(_)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var p=a;return p})}(RS)),RS.exports}var Eoe=Soe();const MV=dd(Eoe),V2=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on(u,p,i){if(n[u]===void 0)throw new Error(`Invalid event type: ${u}`);n[u].push({selector:p,fn:i})},render(u){t.store.featureChanged(u)}},a=function(u,p){const i=n[u];let b=i.length;for(;b--;){const C=i[b];if(C.selector(p)){C.fn.call(r,p)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(r),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(u){a("drag",u)},click(u){a("click",u)},mousemove(u){a("mousemove",u)},mousedown(u){a("mousedown",u)},mouseup(u){a("mouseup",u)},mouseout(u){a("mouseout",u)},keydown(u){a("keydown",u)},keyup(u){a("keyup",u)},touchstart(u){a("touchstart",u)},touchmove(u){a("touchmove",u)},touchend(u){a("touchend",u)},tap(u){a("tap",u)}}};var pS={},A1={},mk;function Coe(){return mk||(mk=1,A1.RADIUS=6378137,A1.FLATTENING=1/298.257223563,A1.POLAR_RADIUS=63567523142e-4),A1}var gk;function Toe(){if(gk)return pS;gk=1;var e=Coe();pS.geometry=t,pS.ring=r;function t(u){var p=0,i;switch(u.type){case"Polygon":return n(u.coordinates);case"MultiPolygon":for(i=0;i<u.coordinates.length;i++)p+=n(u.coordinates[i]);return p;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<u.geometries.length;i++)p+=t(u.geometries[i]);return p}}function n(u){var p=0;if(u&&u.length>0){p+=Math.abs(r(u[0]));for(var i=1;i<u.length;i++)p-=Math.abs(r(u[i]))}return p}function r(u){var p,i,b,C,A,R,z,V=0,W=u.length;if(W>2){for(z=0;z<W;z++)z===W-2?(C=W-2,A=W-1,R=0):z===W-1?(C=W-1,A=0,R=1):(C=z,A=z+1,R=z+2),p=u[C],i=u[A],b=u[R],V+=(a(b[0])-a(p[0]))*Math.sin(a(i[1]));V=V*e.RADIUS*e.RADIUS/2}return V}function a(u){return u*Math.PI/180}return pS}var Ioe=Toe();const Moe=dd(Ioe),ic={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},$h={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},as={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},sc={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Sr={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Pi={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Lu={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Xb={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},$l={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Xa={ACTIVE:"true",INACTIVE:"false"},PV=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Poe=-90,U2=-85,Aoe=90,G2=85,Roe=-270,Loe=270,AV=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Aoe,LAT_MIN:Poe,LAT_RENDERED_MAX:G2,LAT_RENDERED_MIN:U2,LNG_MAX:Loe,LNG_MIN:Roe,activeStates:Xa,classes:ic,cursors:as,events:Lu,geojsonTypes:Sr,interactions:PV,meta:$l,modes:Pi,sources:$h,types:sc,updateActions:Xb},Symbol.toStringTag,{value:"Module"})),_k={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Ooe(e,t){const n=_k[e.geometry.type]-_k[t.geometry.type];return n===0&&e.geometry.type===Sr.POLYGON?e.area-t.area:n}function RV(e){return e.map(t=>(t.geometry.type===Sr.POLYGON&&(t.area=Moe.geometry({type:Sr.FEATURE,property:{},geometry:t.geometry})),t)).sort(Ooe).map(t=>(delete t.area,t))}function LV(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Yh(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Yh.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Yh.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Yh.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Yh.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};Yh.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Doe=[$l.FEATURE,$l.MIDPOINT,$l.VERTEX],tx={click:Noe,touch:koe};function Noe(e,t,n){return OV(e,t,n,n.options.clickBuffer)}function koe(e,t,n){return OV(e,t,n,n.options.touchBuffer)}function OV(e,t,n,r){if(n.map===null)return[];const a=e?LV(e,r):t,u={};n.options.styles&&(u.layers=n.options.styles.map(C=>C.id).filter(C=>n.map.getLayer(C)!=null));const p=n.map.queryRenderedFeatures(a,u).filter(C=>Doe.indexOf(C.properties.meta)!==-1),i=new Yh,b=[];return p.forEach(C=>{const A=C.properties.id;i.has(A)||(i.add(A),b.push(C))}),RV(b)}function LS(e,t){const n=tx.click(e,null,t),r={mouse:as.NONE};return n[0]&&(r.mouse=n[0].properties.active===Xa.ACTIVE?as.MOVE:as.POINTER,r.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(r.mouse=as.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),n[0]}function PP(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}const Foe=4,zoe=12,Boe=500;function $2(e,t,n={}){const r=n.fineTolerance!=null?n.fineTolerance:Foe,a=n.grossTolerance!=null?n.grossTolerance:zoe,u=n.interval!=null?n.interval:Boe;e.point=e.point||t.point,e.time=e.time||t.time;const p=PP(e.point,t.point);return p<r||p<a&&t.time-e.time<u}const joe=25,Voe=250;function q2(e,t,n={}){const r=n.tolerance!=null?n.tolerance:joe,a=n.interval!=null?n.interval:Voe;return e.point=e.point||t.point,e.time=e.time||t.time,PP(e.point,t.point)<r&&t.time-e.time<a}let Uoe=(e,t=21)=>(n=t)=>{let r="",a=n|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};const Goe=Uoe("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function AP(){return Goe()}const Ou=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||AP(),this.type=t.geometry.type};Ou.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Ou.prototype.incomingCoords=function(e){this.setCoordinates(e)};Ou.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Ou.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Ou.prototype.setProperty=function(e,t){this.properties[e]=t};Ou.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Sr.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Ou.prototype.internal=function(e){const t={id:this.id,meta:$l.FEATURE,"meta:type":this.type,active:Xa.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:Sr.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const W_=function(e,t){Ou.call(this,e,t)};W_.prototype=Object.create(Ou.prototype);W_.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};W_.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};W_.prototype.getCoordinate=function(){return this.getCoordinates()};const Gp=function(e,t){Ou.call(this,e,t)};Gp.prototype=Object.create(Ou.prototype);Gp.prototype.isValid=function(){return this.coordinates.length>1};Gp.prototype.addCoordinate=function(e,t,n){this.changed();const r=parseInt(e,10);this.coordinates.splice(r,0,[t,n])};Gp.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};Gp.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};Gp.prototype.updateCoordinate=function(e,t,n){const r=parseInt(e,10);this.coordinates[r]=[t,n],this.changed()};const oh=function(e,t){Ou.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};oh.prototype=Object.create(Ou.prototype);oh.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};oh.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};oh.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};oh.prototype.addCoordinate=function(e,t,n){this.changed();const r=e.split(".").map(u=>parseInt(u,10));this.coordinates[r[0]].splice(r[1],0,[t,n])};oh.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(r=>parseInt(r,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};oh.prototype.getCoordinate=function(e){const t=e.split(".").map(r=>parseInt(r,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};oh.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};oh.prototype.updateCoordinate=function(e,t,n){this.changed();const r=e.split("."),a=parseInt(r[0],10),u=parseInt(r[1],10);this.coordinates[a]===void 0&&(this.coordinates[a]=[]),this.coordinates[a][u]=[t,n]};const $oe={MultiPoint:W_,MultiLineString:Gp,MultiPolygon:oh},dC=(e,t,n,r,a)=>{const u=n.split("."),p=parseInt(u[0],10),i=u[1]?u.slice(1).join("."):null;return e[p][t](i,r,a)},Cu=function(e,t){if(Ou.call(this,e,t),delete this.coordinates,this.model=$oe[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};Cu.prototype=Object.create(Ou.prototype);Cu.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:AP(),type:Sr.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};Cu.prototype.isValid=function(){return this.features.every(e=>e.isValid())};Cu.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};Cu.prototype.getCoordinate=function(e){return dC(this.features,"getCoordinate",e)};Cu.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===Sr.POLYGON?e.getCoordinates():e.coordinates)))};Cu.prototype.updateCoordinate=function(e,t,n){dC(this.features,"updateCoordinate",e,t,n),this.changed()};Cu.prototype.addCoordinate=function(e,t,n){dC(this.features,"addCoordinate",e,t,n),this.changed()};Cu.prototype.removeCoordinate=function(e){dC(this.features,"removeCoordinate",e),this.changed()};Cu.prototype.getFeatures=function(){return this.features};function hi(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}hi.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};hi.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};hi.prototype.getSelected=function(){return this._ctx.store.getSelected()};hi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};hi.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};hi.prototype.getFeature=function(e){return this._ctx.store.get(e)};hi.prototype.select=function(e){return this._ctx.store.select(e)};hi.prototype.deselect=function(e){return this._ctx.store.deselect(e)};hi.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};hi.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};hi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};hi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};hi.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};hi.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};hi.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};hi.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};hi.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};hi.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return tx[n](e,t,this._ctx)};hi.prototype.newFeature=function(e){const t=e.geometry.type;return t===Sr.POINT?new W_(this._ctx,e):t===Sr.LINE_STRING?new Gp(this._ctx,e):t===Sr.POLYGON?new oh(this._ctx,e):new Cu(this._ctx,e)};hi.prototype.isInstanceOf=function(e,t){if(e===Sr.POINT)return t instanceof W_;if(e===Sr.LINE_STRING)return t instanceof Gp;if(e===Sr.POLYGON)return t instanceof oh;if(e==="MultiFeature")return t instanceof Cu;throw new Error(`Unknown feature class: ${e}`)};hi.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};hi.prototype.onSetup=function(){};hi.prototype.onDrag=function(){};hi.prototype.onClick=function(){};hi.prototype.onMouseMove=function(){};hi.prototype.onMouseDown=function(){};hi.prototype.onMouseUp=function(){};hi.prototype.onMouseOut=function(){};hi.prototype.onKeyUp=function(){};hi.prototype.onKeyDown=function(){};hi.prototype.onTouchStart=function(){};hi.prototype.onTouchMove=function(){};hi.prototype.onTouchEnd=function(){};hi.prototype.onTap=function(){};hi.prototype.onStop=function(){};hi.prototype.onTrash=function(){};hi.prototype.onCombineFeature=function(){};hi.prototype.onUncombineFeature=function(){};hi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const DV={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},qoe=Object.keys(DV);function Hoe(e){const t=Object.keys(e);return function(n,r={}){let a={};const u=t.reduce((i,b)=>(i[b]=e[b],i),new hi(n));function p(i){return b=>u[i](a,b)}return{start(){a=u.onSetup(r),qoe.forEach(i=>{const b=DV[i];let C=()=>!1;e[b]&&(C=()=>!0),this.on(i,C,p(b))})},stop(){u.onStop(a)},trash(){u.onTrash(a)},combineFeatures(){u.onCombineFeatures(a)},uncombineFeatures(){u.onUncombineFeatures(a)},render(i,b){u.toDisplayFeatures(a,i,b)}}}}function Woe(e){const t=Object.keys(e.options.modes).reduce((z,V)=>(z[V]=Hoe(e.options.modes[V]),z),{});let n={},r={};const a={};let u=null,p=null;a.drag=function(z,V){V({point:z.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:as.DRAG}),p.drag(z)):z.originalEvent.stopPropagation()},a.mousedrag=function(z){a.drag(z,V=>!$2(n,V))},a.touchdrag=function(z){a.drag(z,V=>!q2(r,V))},a.mousemove=function(z){if((z.originalEvent.buttons!==void 0?z.originalEvent.buttons:z.originalEvent.which)===1)return a.mousedrag(z);const W=LS(z,e);z.featureTarget=W,p.mousemove(z)},a.mousedown=function(z){n={time:new Date().getTime(),point:z.point};const V=LS(z,e);z.featureTarget=V,p.mousedown(z)},a.mouseup=function(z){const V=LS(z,e);z.featureTarget=V,$2(n,{point:z.point,time:new Date().getTime()})?p.click(z):p.mouseup(z)},a.mouseout=function(z){p.mouseout(z)},a.touchstart=function(z){if(!e.options.touchEnabled)return;r={time:new Date().getTime(),point:z.point};const V=tx.touch(z,null,e)[0];z.featureTarget=V,p.touchstart(z)},a.touchmove=function(z){if(e.options.touchEnabled)return p.touchmove(z),a.touchdrag(z)},a.touchend=function(z){if(z.originalEvent.preventDefault(),!e.options.touchEnabled)return;const V=tx.touch(z,null,e)[0];z.featureTarget=V,q2(r,{time:new Date().getTime(),point:z.point})?p.tap(z):p.touchend(z)};const i=z=>!(z===8||z===46||z>=48&&z<=57);a.keydown=function(z){(z.srcElement||z.target).classList.contains(ic.CANVAS)&&((z.keyCode===8||z.keyCode===46)&&e.options.controls.trash?(z.preventDefault(),p.trash()):i(z.keyCode)?p.keydown(z):z.keyCode===49&&e.options.controls.point?b(Pi.DRAW_POINT):z.keyCode===50&&e.options.controls.line_string?b(Pi.DRAW_LINE_STRING):z.keyCode===51&&e.options.controls.polygon&&b(Pi.DRAW_POLYGON))},a.keyup=function(z){i(z.keyCode)&&p.keyup(z)},a.zoomend=function(){e.store.changeZoom()},a.data=function(z){if(z.dataType==="style"){const{setup:V,map:W,options:X,store:ue}=e;X.styles.some(K=>W.getLayer(K.id))||(V.addLayers(),ue.setDirty(),ue.render())}};function b(z,V,W={}){p.stop();const X=t[z];if(X===void 0)throw new Error(`${z} is not valid`);u=z;const ue=X(e,V);p=V2(ue,e),W.silent||e.map.fire(Lu.MODE_CHANGE,{mode:z}),e.store.setDirty(),e.store.render()}const C={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function A(z){let V=!1;Object.keys(z).forEach(W=>{if(C[W]===void 0)throw new Error("Invalid action type");C[W]!==z[W]&&(V=!0),C[W]=z[W]}),V&&e.map.fire(Lu.ACTIONABLE,{actions:C})}return{start(){u=e.options.defaultMode,p=V2(t[u](e),e)},changeMode:b,actionable:A,currentModeName(){return u},currentModeRender(z,V){return p.render(z,V)},fire(z,V){e.map&&e.map.fire(z,V)},addEventListeners(){e.map.on("mousemove",a.mousemove),e.map.on("mousedown",a.mousedown),e.map.on("mouseup",a.mouseup),e.map.on("data",a.data),e.map.on("touchmove",a.touchmove),e.map.on("touchstart",a.touchstart),e.map.on("touchend",a.touchend),e.container.addEventListener("mouseout",a.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",a.keydown),e.container.addEventListener("keyup",a.keyup))},removeEventListeners(){e.map.off("mousemove",a.mousemove),e.map.off("mousedown",a.mousedown),e.map.off("mouseup",a.mouseup),e.map.off("data",a.data),e.map.off("touchmove",a.touchmove),e.map.off("touchstart",a.touchstart),e.map.off("touchend",a.touchend),e.container.removeEventListener("mouseout",a.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",a.keydown),e.container.removeEventListener("keyup",a.keyup))},trash(z){p.trash(z)},combineFeatures(){p.combineFeatures()},uncombineFeatures(){p.uncombineFeatures()},getMode(){return u}}}function Zb(e){return[].concat(e).filter(t=>t!==void 0)}function Xoe(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource($h.HOT)!==void 0))return b();const n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});let r=[],a=[];e.isDirty?a=e.getAllIds():(r=e.getChangedIds().filter(C=>e.get(C)!==void 0),a=e.sources.hot.filter(C=>C.properties.id&&r.indexOf(C.properties.id)===-1&&e.get(C.properties.id)!==void 0).map(C=>C.properties.id)),e.sources.hot=[];const u=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(C=>{const A=C.properties.id||C.properties.parent;return r.indexOf(A)===-1});const p=u!==e.sources.cold.length||a.length>0;r.forEach(C=>i(C,"hot")),a.forEach(C=>i(C,"cold"));function i(C,A){const z=e.get(C).internal(n);e.ctx.events.currentModeRender(z,V=>{V.properties.mode=n,e.sources[A].push(V)})}p&&e.ctx.map.getSource($h.COLD).setData({type:Sr.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource($h.HOT).setData({type:Sr.FEATURE_COLLECTION,features:e.sources.hot}),b();function b(){e.isDirty=!1,e.clearChangedIds()}}function Bo(e){this._features={},this._featureIds=new Yh,this._selectedFeatureIds=new Yh,this._selectedCoordinates=[],this._changedFeatureIds=new Yh,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,Xoe.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Lu.SELECTION_CHANGE,{features:this.getSelected().map(n=>n.toGeoJSON()),points:this.getSelectedCoordinates().map(n=>({type:Sr.FEATURE,properties:{},geometry:{type:Sr.POINT,coordinates:n.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Lu.RENDER,{})}))},this.isDirty=!1}Bo.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};Bo.prototype.setDirty=function(){return this.isDirty=!0,this};Bo.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const r=this.get(e);this.ctx.events.fire(Lu.CREATE,{features:[r.toGeoJSON()]})}return this};Bo.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Lu.UPDATE,{action:t.action?t.action:Xb.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Bo.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Bo.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Bo.prototype.getAllIds=function(){return this._featureIds.values()};Bo.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};Bo.prototype.delete=function(e,t={}){const n=[];return Zb(e).forEach(r=>{this._featureIds.has(r)&&(this._featureIds.delete(r),this._selectedFeatureIds.delete(r),t.silent||n.indexOf(this._features[r])===-1&&n.push(this._features[r].toGeoJSON()),delete this._features[r],this.isDirty=!0)}),n.length&&this.ctx.events.fire(Lu.DELETE,{features:n}),NV(this,t),this};Bo.prototype.get=function(e){return this._features[e]};Bo.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Bo.prototype.select=function(e,t={}){return Zb(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};Bo.prototype.deselect=function(e,t={}){return Zb(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),NV(this,t),this};Bo.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Bo.prototype.setSelected=function(e,t={}){return e=Zb(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};Bo.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Bo.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Bo.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Bo.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Bo.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};Bo.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Bo.prototype.setFeatureProperty=function(e,t,n,r={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:r.silent,action:Xb.CHANGE_PROPERTIES})};function NV(e,t={}){const n=e._selectedCoordinates.filter(r=>e._selectedFeatureIds.has(r.feature_id));e._selectedCoordinates.length!==n.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=n}Bo.prototype.storeMapConfig=function(){PV.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Bo.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Bo.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const Zoe=["mode","feature","mouse"];function Yoe(e){const t={};let n=null,r={mode:null,feature:null,mouse:null},a={mode:null,feature:null,mouse:null};function u(){p({mode:null,feature:null,mouse:null}),i()}function p(V){a=Object.assign(a,V)}function i(){if(!e.container)return;const V=[],W=[];Zoe.forEach(X=>{a[X]!==r[X]&&(V.push(`${X}-${r[X]}`),a[X]!==null&&W.push(`${X}-${a[X]}`))}),V.length>0&&e.container.classList.remove(...V),W.length>0&&e.container.classList.add(...W),r=Object.assign(r,a)}function b(V,W={}){const X=document.createElement("button");return X.className=`${ic.CONTROL_BUTTON} ${W.className}`,X.setAttribute("title",W.title),W.container.appendChild(X),X.addEventListener("click",ue=>{if(ue.preventDefault(),ue.stopPropagation(),ue.target===n){C(),W.onDeactivate();return}A(V),W.onActivate()},!0),X}function C(){n&&(n.classList.remove(ic.ACTIVE_BUTTON),n=null)}function A(V){C();const W=t[V];W&&W&&V!=="trash"&&(W.classList.add(ic.ACTIVE_BUTTON),n=W)}function R(){const V=e.options.controls,W=document.createElement("div");return W.className=`${ic.CONTROL_GROUP} ${ic.CONTROL_BASE}`,V&&(V[sc.LINE]&&(t[sc.LINE]=b(sc.LINE,{container:W,className:ic.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(Pi.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),V[sc.POLYGON]&&(t[sc.POLYGON]=b(sc.POLYGON,{container:W,className:ic.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(Pi.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),V[sc.POINT]&&(t[sc.POINT]=b(sc.POINT,{container:W,className:ic.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(Pi.DRAW_POINT),onDeactivate:()=>e.events.trash()})),V.trash&&(t.trash=b("trash",{container:W,className:ic.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),V.combine_features&&(t.combine_features=b("combineFeatures",{container:W,className:ic.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),V.uncombine_features&&(t.uncombine_features=b("uncombineFeatures",{container:W,className:ic.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),W}function z(){Object.keys(t).forEach(V=>{const W=t[V];W.parentNode&&W.parentNode.removeChild(W),delete t[V]})}return{setActiveButton:A,queueMapClasses:p,updateMapClasses:i,clearMapClasses:u,addButtons:R,removeButtons:z}}function Koe(e){let t=null,n=null;const r={onRemove(){return e.map.off("load",r.connect),clearInterval(n),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",r.connect),clearInterval(n),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(a){if(e.map=a,e.events=Woe(e),e.ui=Yoe(e),e.container=a.getContainer(),e.store=new Bo(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=a.boxZoom.isEnabled(),a.boxZoom.disable();const u=a.dragPan.isEnabled();a.dragPan.disable(),a.dragPan.enable(),u||a.dragPan.disable()}return a.loaded()?r.connect():(a.on("load",r.connect),n=setInterval(()=>{a.loaded()&&r.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource($h.COLD,{data:{type:Sr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource($h.HOT,{data:{type:Sr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(a=>{e.map.addLayer(a)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(a=>{e.map.getLayer(a.id)&&e.map.removeLayer(a.id)}),e.map.getSource($h.COLD)&&e.map.removeSource($h.COLD),e.map.getSource($h.HOT)&&e.map.removeSource($h.HOT)}};return e.setup=r,r}const TI="#3bb2d0",R1="#fbb03b",yk="#fff",kV=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],R1,TI],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],R1,TI],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":yk}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],R1,TI]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":yk}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":R1}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":R1}}];function fC(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}}function FV(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function gv(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Xa.ACTIVE&&e.featureTarget.properties.meta===$l.FEATURE}function RP(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Xa.INACTIVE&&e.featureTarget.properties.meta===$l.FEATURE}function pC(e){return e.featureTarget===void 0}function LP(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===$l.FEATURE}function Yb(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===$l.VERTEX}function pE(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function mC(e){return e.keyCode===27}function gC(e){return e.keyCode===13}function Joe(){return!0}const Qoe=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:gv,isEnterKey:gC,isEscapeKey:mC,isFeature:LP,isInactiveFeature:RP,isOfMetaType:fC,isShiftDown:pE,isShiftMousedown:FV,isTrue:Joe,isVertex:Yb,noTarget:pC},Symbol.toStringTag,{value:"Module"}));function __(e,t){this.x=e,this.y=t}__.prototype={clone(){return new __(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,a=n*this.x+t*this.y;return this.x=r,this.y=a,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),a=t.x+n*(this.x-t.x)-r*(this.y-t.y),u=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=a,this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:__};__.convert=function(e){if(e instanceof __)return e;if(Array.isArray(e))return new __(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new __(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function OP(e,t){const n=t.getBoundingClientRect();return new __(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function nx(e,t,n,r){return{type:Sr.FEATURE,properties:{meta:$l.VERTEX,parent:e,coord_path:n,active:r?Xa.ACTIVE:Xa.INACTIVE},geometry:{type:Sr.POINT,coordinates:t}}}function zV(e,t,n){const r=t.geometry.coordinates,a=n.geometry.coordinates;if(r[1]>G2||r[1]<U2||a[1]>G2||a[1]<U2)return null;const u={lng:(r[0]+a[0])/2,lat:(r[1]+a[1])/2};return{type:Sr.FEATURE,properties:{meta:$l.MIDPOINT,parent:e,lng:u.lng,lat:u.lat,coord_path:n.properties.coord_path},geometry:{type:Sr.POINT,coordinates:[u.lng,u.lat]}}}function _C(e,t={},n=null){const{type:r,coordinates:a}=e.geometry,u=e.properties&&e.properties.id;let p=[];r===Sr.POINT?p.push(nx(u,a,n,b(n))):r===Sr.POLYGON?a.forEach((A,R)=>{i(A,n!==null?`${n}.${R}`:String(R))}):r===Sr.LINE_STRING?i(a,n):r.indexOf(Sr.MULTI_PREFIX)===0&&C();function i(A,R){let z="",V=null;A.forEach((W,X)=>{const ue=R!=null?`${R}.${X}`:String(X),ie=nx(u,W,ue,b(ue));if(t.midpoints&&V){const ee=zV(u,V,ie);ee&&p.push(ee)}V=ie;const K=JSON.stringify(W);z!==K&&p.push(ie),X===0&&(z=K)})}function b(A){return t.selectedPaths?t.selectedPaths.indexOf(A)!==-1:!1}function C(){const A=r.replace(Sr.MULTI_PREFIX,"");a.forEach((R,z)=>{const V={type:Sr.FEATURE,properties:e.properties,geometry:{type:A,coordinates:R}};p=p.concat(_C(V,t,z))})}return p}const _f={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:mS,LAT_MAX:gS,LAT_RENDERED_MIN:vk,LAT_RENDERED_MAX:xk,LNG_MIN:bk,LNG_MAX:wk}=AV;function ese(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),r=n.map(i=>i[0]),a=n.map(i=>i[1]),u=i=>Math.min.apply(null,i),p=i=>Math.max.apply(null,i);return[u(r),u(a),p(r),p(a)]}function DP(e,t){let n=mS,r=gS,a=mS,u=gS,p=wk,i=bk;e.forEach(C=>{const A=ese(C),R=A[1],z=A[3],V=A[0],W=A[2];R>n&&(n=R),z<r&&(r=z),z>a&&(a=z),R<u&&(u=R),V<p&&(p=V),W>i&&(i=W)});const b=t;return n+b.lat>xk&&(b.lat=xk-n),a+b.lat>gS&&(b.lat=gS-a),r+b.lat<vk&&(b.lat=vk-r),u+b.lat<mS&&(b.lat=mS-u),p+b.lng<=bk&&(b.lng+=Math.ceil(Math.abs(b.lng)/360)*360),i+b.lng>=wk&&(b.lng-=Math.ceil(Math.abs(b.lng)/360)*360),b}function NP(e,t){const n=DP(e.map(r=>r.toGeoJSON()),t);e.forEach(r=>{const a=r.getCoordinates(),u=C=>{const A={lng:C[0]+n.lng,lat:C[1]+n.lat};return[A.lng,A.lat]},p=C=>C.map(A=>u(A)),i=C=>C.map(A=>p(A));let b;r.type===Sr.POINT?b=u(a):r.type===Sr.LINE_STRING||r.type===Sr.MULTI_POINT?b=a.map(u):r.type===Sr.POLYGON||r.type===Sr.MULTI_LINE_STRING?b=a.map(p):r.type===Sr.MULTI_POLYGON&&(b=a.map(i)),r.incomingCoords(b)})}const Co={};Co.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};Co.fireUpdate=function(){this.fire(Lu.UPDATE,{action:Xb.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};Co.fireActionable=function(){const e=this.getSelected(),t=e.filter(u=>this.isInstanceOf("MultiFeature",u));let n=!1;if(e.length>1){n=!0;const u=e[0].type.replace("Multi","");e.forEach(p=>{p.type.replace("Multi","")!==u&&(n=!1)})}const r=t.length>0,a=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:r,trash:a})};Co.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,r)=>(n.add(r),n),new Yh).values():[]};Co.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};Co.onStop=function(){_f.enable(this)};Co.onMouseMove=function(e,t){return LP(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};Co.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};Co.onTap=Co.onClick=function(e,t){if(pC(t))return this.clickAnywhere(e,t);if(fC($l.VERTEX)(t))return this.clickOnVertex(e,t);if(LP(t))return this.clickOnFeature(e,t)};Co.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),_f.enable(this),this.stopExtendedInteractions(e)};Co.clickOnVertex=function(e,t){this.changeMode(Pi.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:as.MOVE})};Co.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};Co.clickOnFeature=function(e,t){_f.disable(this),this.stopExtendedInteractions(e);const n=pE(t),r=this.getSelectedIds(),a=t.featureTarget.properties.id,u=this.isSelected(a);if(!n&&u&&this.getFeature(a).type!==Sr.POINT)return this.changeMode(Pi.DIRECT_SELECT,{featureId:a});u&&n?(this.deselect(a),this.updateUIClasses({mouse:as.POINTER}),r.length===1&&_f.enable(this)):!u&&n?(this.select(a),this.updateUIClasses({mouse:as.MOVE})):!u&&!n&&(r.forEach(p=>this.doRender(p)),this.setSelected(a),this.updateUIClasses({mouse:as.MOVE})),this.doRender(a)};Co.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),gv(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&FV(t))return this.startBoxSelect(e,t)};Co.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=OP(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};Co.onTouchStart=function(e,t){if(gv(t))return this.startOnActiveFeature(e,t)};Co.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};Co.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:as.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(ic.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=OP(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,n.x),a=Math.max(e.boxSelectStartLocation.x,n.x),u=Math.min(e.boxSelectStartLocation.y,n.y),p=Math.max(e.boxSelectStartLocation.y,n.y),i=`translate(${r}px, ${u}px)`;e.boxSelectElement.style.transform=i,e.boxSelectElement.style.WebkitTransform=i,e.boxSelectElement.style.width=`${a-r}px`,e.boxSelectElement.style.height=`${p-u}px`};Co.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};NP(this.getSelected(),n),e.dragMoveLocation=t.lngLat};Co.onTouchEnd=Co.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,OP(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,n,"click"),a=this.getUniqueIds(r).filter(u=>!this.isSelected(u));a.length&&(this.select(a),a.forEach(u=>this.doRender(u)),this.updateUIClasses({mouse:as.MOVE}))}this.stopExtendedInteractions(e)};Co.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?Xa.ACTIVE:Xa.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==Xa.ACTIVE||t.geometry.type===Sr.POINT)&&_C(t).forEach(n)};Co.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};Co.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],r=e[0].type.replace("Multi","");for(let a=0;a<e.length;a++){const u=e[a];if(u.type.replace("Multi","")!==r)return;u.type.includes("Multi")?u.getCoordinates().forEach(p=>{t.push(p)}):t.push(u.getCoordinates()),n.push(u.toGeoJSON())}if(n.length>1){const a=this.newFeature({type:Sr.FEATURE,properties:n[0].properties,geometry:{type:`Multi${r}`,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.fire(Lu.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};Co.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let r=0;r<e.length;r++){const a=e[r];this.isInstanceOf("MultiFeature",a)&&(a.getFeatures().forEach(u=>{this.addFeature(u),u.properties=a.properties,t.push(u.toGeoJSON()),this.select([u.id])}),this.deleteFeature(a.id,{silent:!0}),n.push(a.toGeoJSON()))}t.length>1&&this.fire(Lu.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const BV=fC($l.VERTEX),jV=fC($l.MIDPOINT),To={};To.fireUpdate=function(){this.fire(Lu.UPDATE,{action:Xb.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};To.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};To.startDragging=function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};To.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};To.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(n.coord_path);!pE(t)&&r===-1?e.selectedCoordPaths=[n.coord_path]:pE(t)&&r===-1&&e.selectedCoordPaths.push(n.coord_path);const a=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(a)};To.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};To.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};To.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};To.dragFeature=function(e,t,n){NP(this.getSelected(),n),e.dragMoveLocation=t.lngLat};To.dragVertex=function(e,t,n){const r=e.selectedCoordPaths.map(p=>e.feature.getCoordinate(p)),a=r.map(p=>({type:Sr.FEATURE,properties:{},geometry:{type:Sr.POINT,coordinates:p}})),u=DP(a,n);for(let p=0;p<r.length;p++){const i=r[p];e.feature.updateCoordinate(e.selectedCoordPaths[p],i[0]+u.lng,i[1]+u.lat)}};To.clickNoTarget=function(){this.changeMode(Pi.SIMPLE_SELECT)};To.clickInactive=function(){this.changeMode(Pi.SIMPLE_SELECT)};To.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};To.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===Sr.POINT)throw new TypeError("direct_select mode doesn't handle point features");const r={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),_f.disable(this),this.setActionableState({trash:!0}),r};To.onStop=function(){_f.enable(this),this.clearSelectedCoordinates()};To.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=Xa.ACTIVE,n(t),_C(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=Xa.INACTIVE,n(t)),this.fireActionable(e)};To.onTrash=function(e){e.selectedCoordPaths.sort((t,n)=>n.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(Pi.SIMPLE_SELECT,{}))};To.onMouseMove=function(e,t){const n=gv(t),r=BV(t),a=jV(t),u=e.selectedCoordPaths.length===0;return n&&u?this.updateUIClasses({mouse:as.MOVE}):r&&!u?this.updateUIClasses({mouse:as.MOVE}):this.updateUIClasses({mouse:as.NONE}),(r||n||a)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};To.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};To.onTouchStart=To.onMouseDown=function(e,t){if(BV(t))return this.onVertex(e,t);if(gv(t))return this.onFeature(e,t);if(jV(t))return this.onMidpoint(e,t)};To.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};To.onClick=function(e,t){if(pC(t))return this.clickNoTarget(e,t);if(gv(t))return this.clickActiveFeature(e,t);if(RP(t))return this.clickInactive(e,t);this.stopDragging(e)};To.onTap=function(e,t){if(pC(t))return this.clickNoTarget(e,t);if(gv(t))return this.clickActiveFeature(e,t);if(RP(t))return this.clickInactive(e,t)};To.onTouchEnd=To.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const zp={};zp.onSetup=function(){const e=this.newFeature({type:Sr.FEATURE,properties:{},geometry:{type:Sr.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:as.ADD}),this.activateUIButton(sc.POINT),this.setActionableState({trash:!0}),{point:e}};zp.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT)};zp.onTap=zp.onClick=function(e,t){this.updateUIClasses({mouse:as.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(Lu.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.point.id]})};zp.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};zp.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.point.id;if(t.properties.active=r?Xa.ACTIVE:Xa.INACTIVE,!r)return n(t)};zp.onTrash=zp.stopDrawingAndRemove;zp.onKeyUp=function(e,t){if(mC(t)||gC(t))return this.stopDrawingAndRemove(e,t)};function mE(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const yf={};yf.onSetup=function(){const e=this.newFeature({type:Sr.FEATURE,properties:{},geometry:{type:Sr.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),_f.disable(this),this.updateUIClasses({mouse:as.ADD}),this.activateUIButton(sc.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};yf.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&mE(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:as.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};yf.clickOnVertex=function(e){return this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};yf.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Yb(t)&&this.updateUIClasses({mouse:as.POINTER})};yf.onTap=yf.onClick=function(e,t){return Yb(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};yf.onKeyUp=function(e,t){mC(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT)):gC(t)&&this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};yf.onStop=function(e){this.updateUIClasses({mouse:as.NONE}),_f.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(Lu.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT,{},{silent:!0})))};yf.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.polygon.id;if(t.properties.active=r?Xa.ACTIVE:Xa.INACTIVE,!r)return n(t);if(t.geometry.coordinates.length===0)return;const a=t.geometry.coordinates[0].length;if(!(a<3)){if(t.properties.meta=$l.FEATURE,n(nx(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),a>3){const u=t.geometry.coordinates[0].length-3;n(nx(e.polygon.id,t.geometry.coordinates[0][u],`0.${u}`,!1))}if(a<=4){const u=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:Sr.FEATURE,properties:t.properties,geometry:{coordinates:u,type:Sr.LINE_STRING}}),a===3)return}return n(t)}};yf.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT)};const vf={};vf.onSetup=function(e){e=e||{};const t=e.featureId;let n,r,a="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let u=e.from;if(u&&u.type==="Feature"&&u.geometry&&u.geometry.type==="Point"&&(u=u.geometry),u&&u.type==="Point"&&u.coordinates&&u.coordinates.length===2&&(u=u.coordinates),!u||!Array.isArray(u))throw new Error("Please use the `from` property to indicate which point to continue the line from");const p=n.coordinates.length-1;if(n.coordinates[p][0]===u[0]&&n.coordinates[p][1]===u[1])r=p+1,n.addCoordinate(r,...n.coordinates[p]);else if(n.coordinates[0][0]===u[0]&&n.coordinates[0][1]===u[1])a="backwards",r=0,n.addCoordinate(r,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:Sr.FEATURE,properties:{},geometry:{type:Sr.LINE_STRING,coordinates:[]}}),r=0,this.addFeature(n);return this.clearSelectedFeatures(),_f.disable(this),this.updateUIClasses({mouse:as.ADD}),this.activateUIButton(sc.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:r,direction:a}};vf.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&mE(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&mE(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:as.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};vf.clickOnVertex=function(e){return this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.line.id]})};vf.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Yb(t)&&this.updateUIClasses({mouse:as.POINTER})};vf.onTap=vf.onClick=function(e,t){if(Yb(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};vf.onKeyUp=function(e,t){gC(t)?this.changeMode(Pi.SIMPLE_SELECT,{featureIds:[e.line.id]}):mC(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT))};vf.onStop=function(e){_f.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(Lu.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT,{},{silent:!0})))};vf.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Pi.SIMPLE_SELECT)};vf.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.line.id;if(t.properties.active=r?Xa.ACTIVE:Xa.INACTIVE,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=$l.FEATURE,n(nx(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};const VV={simple_select:Co,direct_select:To,draw_point:zp,draw_polygon:yf,draw_line_string:vf},tse={defaultMode:Pi.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:kV,modes:VV,controls:{},userProperties:!1,suppressAPIEvents:!0},nse={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},rse={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Sk(e,t){return e.map(n=>n.source?n:Object.assign({},n,{id:`${n.id}.${t}`,source:t==="hot"?$h.HOT:$h.COLD}))}function ise(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},rse,e.controls):t.controls=Object.assign({},nse,e.controls),t=Object.assign({},tse,t),t.styles=Sk(t.styles,"cold").concat(Sk(t.styles,"hot")),t}var II,Ek;function ose(){return Ek||(Ek=1,II=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,a,u;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(a=r;a--!==0;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(u=Object.keys(t),r=u.length,r!==Object.keys(n).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,u[a]))return!1;for(a=r;a--!==0;){var p=u[a];if(!e(t[p],n[p]))return!1}return!0}return t!==t&&n!==n}),II}var sse=ose();const Ck=dd(sse);var MI,Tk;function ase(){if(Tk)return MI;Tk=1,MI=t;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function t(n){if(!n||!n.type)return null;var r=e[n.type];if(!r)return null;if(r==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:n}]};if(r==="feature")return{type:"FeatureCollection",features:[n]};if(r==="featurecollection")return n}return MI}var lse=ase();const use=dd(lse);function UV(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())}const cse={Polygon:oh,LineString:Gp,Point:W_,MultiPolygon:Cu,MultiLineString:Cu,MultiPoint:Cu};function hse(e,t){t.modes=Pi;const n=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(r){return tx.click({point:r},null,e).map(u=>u.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:Sr.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(r=>e.store.get(r)).map(r=>r.toGeoJSON())}},t.getSelectedPoints=function(){return{type:Sr.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(r=>({type:Sr.FEATURE,properties:{},geometry:{type:Sr.POINT,coordinates:r.coordinates}}))}},t.set=function(r){if(r.type===void 0||r.type!==Sr.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");const a=e.store.createRenderBatch();let u=e.store.getAllIds().slice();const p=t.add(r),i=new Yh(p);return u=u.filter(b=>!i.has(b)),u.length&&t.delete(u),a(),p},t.add=function(r){const u=JSON.parse(JSON.stringify(use(r))).features.map(p=>{if(p.id=p.id||AP(),p.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(p.id)===void 0||e.store.get(p.id).type!==p.geometry.type){const i=cse[p.geometry.type];if(i===void 0)throw new Error(`Invalid geometry type: ${p.geometry.type}.`);const b=new i(e,p);e.store.add(b,{silent:n})}else{const i=e.store.get(p.id),b=i.properties;i.properties=p.properties,Ck(b,p.properties)||e.store.featureChanged(i.id,{silent:n}),Ck(i.getCoordinates(),p.geometry.coordinates)||i.incomingCoords(p.geometry.coordinates)}return p.id});return e.store.render(),u},t.get=function(r){const a=e.store.get(r);if(a)return a.toGeoJSON()},t.getAll=function(){return{type:Sr.FEATURE_COLLECTION,features:e.store.getAll().map(r=>r.toGeoJSON())}},t.delete=function(r){return e.store.delete(r,{silent:n}),t.getMode()===Pi.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(Pi.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===Pi.DIRECT_SELECT?e.events.changeMode(Pi.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(r,a={}){return r===Pi.SIMPLE_SELECT&&t.getMode()===Pi.SIMPLE_SELECT?(UV(a.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(a.featureIds,{silent:n}),e.store.render()),t):(r===Pi.DIRECT_SELECT&&t.getMode()===Pi.DIRECT_SELECT&&a.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,a,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(r,a,u){return e.store.setFeatureProperty(r,a,u,{silent:n}),t},t}const dse=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:Qoe,ModeHandler:V2,StringSet:Yh,constrainFeatureMovement:DP,createMidPoint:zV,createSupplementaryPoints:_C,createVertex:nx,doubleClickZoom:_f,euclideanDistance:PP,featuresAt:tx,getFeatureAtAndSetCursors:LS,isClick:$2,isEventAtCoordinates:mE,isTap:q2,mapEventToBoundingBox:LV,moveFeatures:NP,sortFeatures:RV,stringSetsAreEqual:UV,theme:kV,toDenseArray:Zb},Symbol.toStringTag,{value:"Module"})),fse=function(e,t){e=ise(e);const n={options:e};t=hse(n,t),n.api=t;const r=Koe(n);return t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=sc,t.options=e,t};function yC(e){fse(e,this)}yC.modes=VV;yC.constants=AV;yC.lib=dse;const GV=pb(e=>({draw:null,setDraw:t=>e({draw:t})}));MV.accessToken="pk.eyJ1IjoibW9ydGVuZWQiLCJhIjoiY203YXZ4Y2dzMDRyczJqcXduaTJuMG5rZCJ9.Pq6gaGK0J0BglS7Mtig5fA";function pse(){const e=Y.useRef(null),t=Y.useRef(null),{setMap:n}=qh();return Y.useEffect(()=>{if(!e.current)return;const r=new MV.Map({container:e.current,style:DS.dark,center:[10.4,63.425],zoom:12,preserveDrawingBuffer:!0});return t.current=new yC({displayControlsDefault:!0}),r.addControl(t.current,"top-left"),GV.getState().setDraw(t.current),r.on("load",()=>{n(r)}),r.on("draw.create",a=>{console.log(a)}),()=>r.remove()},[]),G.jsx("div",{ref:e,className:"w-full h-full z-0 absolute map-container"})}function mse({selected:e,onSelect:t}){const[n,r]=Y.useState(!1),[a,u]=Y.useState(null),p=Y.useRef(null),i=V=>V.type==="application/json"||V.name.toLowerCase().endsWith(".geojson"),b=V=>{const W=Array.from(V).filter(i);W.length?(t([...e,...W]),u(null)):u("Please upload GeoJSON file(s)")},C=V=>{V.preventDefault(),V.stopPropagation(),r(V.type==="dragenter"||V.type==="dragover")},A=V=>{V.preventDefault(),V.stopPropagation(),r(!1),V.dataTransfer.files&&b(V.dataTransfer.files)},R=V=>{V.target.files&&b(V.target.files)},z=V=>{const W=e.filter(X=>X.name!==V.name);t(W)};return G.jsxs(DM,{onDragEnter:C,onDragLeave:C,onDragOver:C,onDrop:A,className:`border-2 border-secondary border-dashed transition-colors duration-200 ${n?"bg-secondary border-white":""}`,children:[G.jsxs(NM,{children:[G.jsx(kM,{children:"File upload"}),G.jsx(jB,{children:"Drag GeoJSON files here or click the button below"})]}),G.jsxs(FM,{className:"min-h-[100px] flex flex-col items-center justify-center gap-4",children:[G.jsx("input",{ref:p,type:"file",accept:".json,.geojson",multiple:!0,className:"hidden",onChange:R}),G.jsxs(Qr,{variant:"ghost",onClick:()=>{var V;return(V=p.current)==null?void 0:V.click()},className:"flex items-center gap-2 bg-secondary rounded-xl",children:[G.jsx(t$,{className:"h-4 w-4"}),"Choose file",e.length!==1&&"s"]}),e.length>0&&G.jsx("ul",{className:"text-sm text-gray-600 space-y-0.5 text-center",children:e.map(V=>G.jsxs("li",{className:"flex justify-between",children:[G.jsx("span",{children:V.name}),G.jsx("button",{onClick:()=>z(V),className:"text-red-500 hover:text-red-700",children:G.jsx(fb,{className:"h-4 w-4"})})]},V.name))}),a&&G.jsx("p",{className:"mt-1 text-red-500 text-sm",children:a})]})]})}function gse({open:e,onOpenChange:t}){const[,n]=Y.useState(""),[r,a]=Y.useState(null),[,u]=Y.useState(Ds()),[,p]=Y.useState(.8),{addLayer:i}=wo(),[b,C]=Y.useState([]),[A,R]=Y.useState(!1),[z,V]=Y.useState(0);Y.useEffect(()=>{if(r){const ee=r.name.split(".").slice(0,-1).join("."),ae=ba(ee);n(ae)}},[r]);function W(){n(""),a(null),u(Ds()),p(.8),C([])}const X=ee=>{const ae=new Set,he=ee.map(xe=>{const ye=Ds([...ae]);return ae.add(ye),{file:xe,name:ba(xe.name.replace(/\.geojson$/i,"")),color:ye,opacity:.8}});C(he)},ue=async()=>{for(const ee of b)try{const ae=JSON.parse(await ee.file.text());i({data:ae,id:cg(),name:ba(ee.name),visible:!0,fillColor:ee.color,fillOpacity:ee.opacity,geometryType:ae.features[0].geometry.type},ee.color,ee.opacity)}catch{C_({title:"Error",description:"Invalid GeoJSN",icon:D8})}C_({title:"Layers added successfully",description:`${b.length} layer${b.length>1?"s":""} added`,icon:v8}),C([]),t(!1)};function ie(){R(!1)}function K(ee){V(Math.max(0,Math.min(ee,ik.length-1)))}return G.jsxs(G.Fragment,{children:[G.jsxs(Pb,{open:e,onOpenChange:ee=>{t(ee),ee||(R(!1),W(),V(0))},children:[G.jsx(OM,{className:"z-[99] bg-black/10"}),G.jsxs(dx,{id:"upload-dialog",className:"z-[100] bg-primary-light sm:rounded-2xl border-0",children:[G.jsxs(fx,{children:[G.jsx(mx,{children:"Add a new layer"}),G.jsx(gx,{children:"Upload a GeoJSON file to add as a new layer"})]}),G.jsx("div",{className:"upload-files",children:G.jsx(mse,{selected:b.map(ee=>ee.file),onSelect:X})}),G.jsx("div",{className:"layer-form",children:b.length===1?G.jsx(jp,{layerName:ba(b[0].name),onNameChange:ee=>C([{...b[0],name:ee}]),fillColor:b[0].color,onFillColorChange:ee=>C([{...b[0],color:ee}]),fillOpacity:b[0].opacity,onFillOpacityChange:ee=>C([{...b[0],opacity:ee}])}):b.length>1?G.jsx(TV,{layers:b,onChange:(ee,ae)=>C(he=>he.map((xe,ye)=>ye===ee?{...xe,...ae}:xe))}):null}),G.jsx(px,{children:G.jsxs("div",{className:"flex flex-row w-full",children:[G.jsx("div",{className:"flex-1",children:G.jsx(Qr,{onClick:()=>R(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})})}),G.jsxs("div",{className:"flex-3 gap-3 flex ",children:[G.jsx(_x,{className:"rounded-xl",children:"Cancel"}),G.jsxs(VE,{disabled:b.length===0,onClick:ue,className:"rounded-xl layer-upload-btn",children:["Add"," ",b.length>1?`${b.length} layers`:"layer"]})]})]})})]})]}),G.jsx(mv,{steps:ik,run:A&&e,onStop:ie,disableOverlay:!1,stepIndex:z,onStepChange:K})]})}function Vh({children:e,label:t,side:n="bottom"}){return G.jsx(LF,{delayDuration:300,children:G.jsxs(OF,{children:[G.jsx(DF,{asChild:!0,children:e}),G.jsxs(fM,{side:n,sideOffset:8,className:"rounded-md bg-secondary text-zinc-100 text-xs shadow-lg px-3 py-2",children:[t,G.jsx(AF,{className:"fill-zinc-900"})]})]})})}function _se(){const[e,t]=Y.useState(!1),[n,r]=Y.useState(!1),[a,u]=Y.useState(null),p=GV(ie=>ie.draw),{setOpen:i}=cx(),{addLayer:b,layers:C}=wo(),[A,R]=Y.useState(!1),[z,V]=Y.useState(0),W=G.jsx(Qr,{onClick:()=>R(!0),variant:"secondary",size:"icon",children:G.jsx(B_,{style:{width:"1.8rem",height:"1.8rem",fill:"#ff8847"}})});function X(ie){if(p){switch(u(ie),r(!0),ie){case"point":p.changeMode("draw_point");break;case"line":p.changeMode("draw_line_string");break;case"polygon":p.changeMode("draw_polygon");break}i(!1)}}function ue(ie){if(!ie||ie.features.length===0)return;const K={...ie,features:ie.features.map((ae,he)=>({...ae,properties:{...ae.properties||{},DrawID:he+1,Geometry:ae.geometry.type}}))},ee=K.features[0].geometry.type;b({id:`layer-${C.length+1}`,name:`Layer ${C.length+1}`,data:K,fillColor:Ds(),fillOpacity:1,visible:!0,geometryType:ee},Ds(),1)}return G.jsxs(G.Fragment,{children:[G.jsx(jS,{side:"top",className:"bg-white/90",children:G.jsxs("div",{className:"flex flex-row justify-center",children:[G.jsx(Vh,{label:"Upload GeoJSON layer(s) to the map",side:"top",children:G.jsxs(Qr,{variant:"ghost",size:"default",onClick:()=>t(!0),className:"flex flex-row items-center upload-btn",disabled:n,children:[G.jsx(bO,{className:"h-8 w-8"}),G.jsx("span",{className:"text-xs",children:"Upload"})]})}),G.jsx(gse,{open:e,onOpenChange:t}),G.jsx(Vh,{label:"Draw a new point layer on the map",side:"top",children:G.jsx(Qr,{variant:"ghost",size:"sm",className:" h-100",onClick:()=>X("point"),disabled:n,children:G.jsx("img",{src:Cp("/icons/point.svg"),className:"h-6 w-6"})})}),G.jsx(Vh,{label:"Draw a new line layer on the map",side:"top",children:G.jsx(Qr,{variant:"ghost",size:"sm",className:" h-100 line-drawing-btn",onClick:()=>X("line"),disabled:n,children:G.jsx("img",{src:Cp("/icons/line.svg"),className:"h-6 w-6"})})}),G.jsx(Vh,{label:"Draw a new polygon layer on the map",side:"top",children:G.jsx(Qr,{variant:"ghost",size:"sm",className:" h-100",onClick:()=>X("polygon"),disabled:n,children:G.jsx("img",{src:Cp("/icons/polygon.svg"),className:"h-6 w-6"})})})]})}),n&&G.jsx(jS,{side:"bottom",className:"bg-white/90 bottom-toolbar",children:G.jsxs("div",{className:"flex flex-row justify-center",children:[a==="line"&&W,G.jsx(Vh,{label:"Cancel drawing and delete all drawn features",side:"top",children:G.jsxs(Qr,{variant:"ghost",size:"default",onClick:()=>{p&&(p.changeMode("simple_select"),p.deleteAll(),u(null),i(!1),r(!1))},children:[G.jsx(fb,{className:"h-8 w-8"}),G.jsx("span",{className:"text-base",children:"Cancel"})]})}),G.jsx(Vh,{label:"Delete all drawn features",side:"top",children:G.jsxs(Qr,{variant:"ghost",size:"default",onClick:()=>{p&&(p.deleteAll(),X(a))},children:[G.jsx(Uk,{className:"h-8 w-8"}),G.jsx("span",{className:"text-base",children:"Clear all"})]})}),G.jsx(Vh,{label:"Add another drawn feature",side:"top",children:G.jsxs(Qr,{variant:"ghost",size:"default",onClick:()=>{X(a)},children:[G.jsx(bO,{className:"h-8 w-8"}),G.jsx("span",{className:"text-base",children:"Add another"})]})}),G.jsx(Vh,{label:"Finish drawing and save the layer",side:"top",children:G.jsxs(Qr,{variant:"ghost",size:"default",className:"finish-btn",onClick:()=>{r(!1),ue((p==null?void 0:p.getAll())??null),p==null||p.deleteAll()},children:[G.jsx(Sa,{className:"h-8 w-8"}),G.jsx("span",{className:"text-base",children:"Finish"})]})})]})}),G.jsx(mv,{steps:Qne,run:A&&n&&a==="line",onStop:()=>{R(!1),V(0)},stepIndex:z,onStepChange:ie=>V(ie),disableOverlay:!0})]})}const yse=bE("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function vse({className:e,variant:t,...n}){return G.jsx("div",{className:dn(yse({variant:t}),e),...n})}var xse=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],$V=xse.reduce((e,t)=>{const n=kk(`Primitive.${t}`),r=Y.forwardRef((a,u)=>{const{asChild:p,...i}=a,b=p?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(b,{...i,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),kP="Progress",FP=100,[bse,Sae]=Zl(kP),[wse,Sse]=bse(kP),qV=Y.forwardRef((e,t)=>{const{__scopeProgress:n,value:r=null,max:a,getValueLabel:u=Ese,...p}=e;(a||a===0)&&!Ik(a)&&console.error(Cse(`${a}`,"Progress"));const i=Ik(a)?a:FP;r!==null&&!Mk(r,i)&&console.error(Tse(`${r}`,"Progress"));const b=Mk(r,i)?r:null,C=gE(b)?u(b,i):void 0;return G.jsx(wse,{scope:n,value:b,max:i,children:G.jsx($V.div,{"aria-valuemax":i,"aria-valuemin":0,"aria-valuenow":gE(b)?b:void 0,"aria-valuetext":C,role:"progressbar","data-state":XV(b,i),"data-value":b??void 0,"data-max":i,...p,ref:t})})});qV.displayName=kP;var HV="ProgressIndicator",WV=Y.forwardRef((e,t)=>{const{__scopeProgress:n,...r}=e,a=Sse(HV,n);return G.jsx($V.div,{"data-state":XV(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:t})});WV.displayName=HV;function Ese(e,t){return`${Math.round(e/t*100)}%`}function XV(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function gE(e){return typeof e=="number"}function Ik(e){return gE(e)&&!isNaN(e)&&e>0}function Mk(e,t){return gE(e)&&!isNaN(e)&&e<=t&&e>=0}function Cse(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${FP}\`.`}function Tse(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${FP} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ZV=qV,Ise=WV;const YV=Y.forwardRef(({className:e,value:t,...n},r)=>G.jsx(ZV,{ref:r,className:dn("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...n,children:G.jsx(Ise,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));YV.displayName=ZV.displayName;function zP(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var _v=zP();function KV(e){_v=e}var j1={exec:()=>null};function io(e,t=""){let n=typeof e=="string"?e:e.source;const r={replace:(a,u)=>{let p=typeof u=="string"?u:u.source;return p=p.replace(Su.caret,"$1"),n=n.replace(a,p),r},getRegex:()=>new RegExp(n,t)};return r}var Su={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},Mse=/^(?:[ \t]*(?:\n|$))+/,Pse=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ase=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Kb=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Rse=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,BP=/(?:[*+-]|\d{1,9}[.)])/,JV=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,QV=io(JV).replace(/bull/g,BP).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Lse=io(JV).replace(/bull/g,BP).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),jP=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ose=/^[^\n]+/,VP=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Dse=io(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",VP).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Nse=io(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,BP).getRegex(),vC="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",UP=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,kse=io("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",UP).replace("tag",vC).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),eU=io(jP).replace("hr",Kb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vC).getRegex(),Fse=io(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",eU).getRegex(),GP={blockquote:Fse,code:Pse,def:Dse,fences:Ase,heading:Rse,hr:Kb,html:kse,lheading:QV,list:Nse,newline:Mse,paragraph:eU,table:j1,text:Ose},Pk=io("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Kb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vC).getRegex(),zse={...GP,lheading:Lse,table:Pk,paragraph:io(jP).replace("hr",Kb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Pk).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vC).getRegex()},Bse={...GP,html:io(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",UP).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:j1,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:io(jP).replace("hr",Kb).replace("heading",` *#{1,6} *[^
]`).replace("lheading",QV).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},jse=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Vse=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,tU=/^( {2,}|\\)\n(?!\s*$)/,Use=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,xC=/[\p{P}\p{S}]/u,$P=/[\s\p{P}\p{S}]/u,nU=/[^\s\p{P}\p{S}]/u,Gse=io(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,$P).getRegex(),rU=/(?!~)[\p{P}\p{S}]/u,$se=/(?!~)[\s\p{P}\p{S}]/u,qse=/(?:[^\s\p{P}\p{S}]|~)/u,Hse=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,iU=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Wse=io(iU,"u").replace(/punct/g,xC).getRegex(),Xse=io(iU,"u").replace(/punct/g,rU).getRegex(),oU="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Zse=io(oU,"gu").replace(/notPunctSpace/g,nU).replace(/punctSpace/g,$P).replace(/punct/g,xC).getRegex(),Yse=io(oU,"gu").replace(/notPunctSpace/g,qse).replace(/punctSpace/g,$se).replace(/punct/g,rU).getRegex(),Kse=io("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,nU).replace(/punctSpace/g,$P).replace(/punct/g,xC).getRegex(),Jse=io(/\\(punct)/,"gu").replace(/punct/g,xC).getRegex(),Qse=io(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),eae=io(UP).replace("(?:-->|$)","-->").getRegex(),tae=io("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",eae).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_E=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,nae=io(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_E).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),sU=io(/^!?\[(label)\]\[(ref)\]/).replace("label",_E).replace("ref",VP).getRegex(),aU=io(/^!?\[(ref)\](?:\[\])?/).replace("ref",VP).getRegex(),rae=io("reflink|nolink(?!\\()","g").replace("reflink",sU).replace("nolink",aU).getRegex(),qP={_backpedal:j1,anyPunctuation:Jse,autolink:Qse,blockSkip:Hse,br:tU,code:Vse,del:j1,emStrongLDelim:Wse,emStrongRDelimAst:Zse,emStrongRDelimUnd:Kse,escape:jse,link:nae,nolink:aU,punctuation:Gse,reflink:sU,reflinkSearch:rae,tag:tae,text:Use,url:j1},iae={...qP,link:io(/^!?\[(label)\]\((.*?)\)/).replace("label",_E).getRegex(),reflink:io(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_E).getRegex()},H2={...qP,emStrongRDelimAst:Yse,emStrongLDelim:Xse,url:io(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},oae={...H2,br:io(tU).replace("{2,}","*").getRegex(),text:io(H2.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},_S={normal:GP,gfm:zse,pedantic:Bse},L1={normal:qP,gfm:H2,breaks:oae,pedantic:iae},sae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ak=e=>sae[e];function mp(e,t){if(t){if(Su.escapeTest.test(e))return e.replace(Su.escapeReplace,Ak)}else if(Su.escapeTestNoEncode.test(e))return e.replace(Su.escapeReplaceNoEncode,Ak);return e}function Rk(e){try{e=encodeURI(e).replace(Su.percentDecode,"%")}catch{return null}return e}function Lk(e,t){var u;const n=e.replace(Su.findPipe,(p,i,b)=>{let C=!1,A=i;for(;--A>=0&&b[A]==="\\";)C=!C;return C?"|":" |"}),r=n.split(Su.splitPipe);let a=0;if(r[0].trim()||r.shift(),r.length>0&&!((u=r.at(-1))!=null&&u.trim())&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Su.slashPipe,"|");return r}function O1(e,t,n){const r=e.length;if(r===0)return"";let a=0;for(;a<r&&e.charAt(r-a-1)===t;)a++;return e.slice(0,r-a)}function aae(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let r=0;r<e.length;r++)if(e[r]==="\\")r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return n>0?-2:-1}function Ok(e,t,n,r,a){const u=t.href,p=t.title||null,i=e[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;const b={type:e[0].charAt(0)==="!"?"image":"link",raw:n,href:u,title:p,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,b}function lae(e,t,n){const r=e.match(n.other.indentCodeCompensation);if(r===null)return t;const a=r[1];return t.split(`
`).map(u=>{const p=u.match(n.other.beginningSpace);if(p===null)return u;const[i]=p;return i.length>=a.length?u.slice(a.length):u}).join(`
`)}var yE=class{constructor(e){bo(this,"options");bo(this,"rules");bo(this,"lexer");this.options=e||_v}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:O1(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],r=lae(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const r=O1(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:O1(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=O1(t[0],`
`).split(`
`),r="",a="";const u=[];for(;n.length>0;){let p=!1;const i=[];let b;for(b=0;b<n.length;b++)if(this.rules.other.blockquoteStart.test(n[b]))i.push(n[b]),p=!0;else if(!p)i.push(n[b]);else break;n=n.slice(b);const C=i.join(`
`),A=C.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${C}`:C,a=a?`${a}
${A}`:A;const R=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(A,u,!0),this.lexer.state.top=R,n.length===0)break;const z=u.at(-1);if((z==null?void 0:z.type)==="code")break;if((z==null?void 0:z.type)==="blockquote"){const V=z,W=V.raw+`
`+n.join(`
`),X=this.blockquote(W);u[u.length-1]=X,r=r.substring(0,r.length-V.raw.length)+X.raw,a=a.substring(0,a.length-V.text.length)+X.text;break}else if((z==null?void 0:z.type)==="list"){const V=z,W=V.raw+`
`+n.join(`
`),X=this.list(W);u[u.length-1]=X,r=r.substring(0,r.length-z.raw.length)+X.raw,a=a.substring(0,a.length-V.raw.length)+X.raw,n=W.substring(u.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:u,text:a}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const r=n.length>1,a={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");const u=this.rules.other.listItemRegex(n);let p=!1;for(;e;){let b=!1,C="",A="";if(!(t=u.exec(e))||this.rules.block.hr.test(e))break;C=t[0],e=e.substring(C.length);let R=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,ie=>" ".repeat(3*ie.length)),z=e.split(`
`,1)[0],V=!R.trim(),W=0;if(this.options.pedantic?(W=2,A=R.trimStart()):V?W=t[1].length+1:(W=t[2].search(this.rules.other.nonSpaceChar),W=W>4?1:W,A=R.slice(W),W+=t[1].length),V&&this.rules.other.blankLine.test(z)&&(C+=z+`
`,e=e.substring(z.length+1),b=!0),!b){const ie=this.rules.other.nextBulletRegex(W),K=this.rules.other.hrRegex(W),ee=this.rules.other.fencesBeginRegex(W),ae=this.rules.other.headingBeginRegex(W),he=this.rules.other.htmlBeginRegex(W);for(;e;){const xe=e.split(`
`,1)[0];let ye;if(z=xe,this.options.pedantic?(z=z.replace(this.rules.other.listReplaceNesting,"  "),ye=z):ye=z.replace(this.rules.other.tabCharGlobal,"    "),ee.test(z)||ae.test(z)||he.test(z)||ie.test(z)||K.test(z))break;if(ye.search(this.rules.other.nonSpaceChar)>=W||!z.trim())A+=`
`+ye.slice(W);else{if(V||R.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||ee.test(R)||ae.test(R)||K.test(R))break;A+=`
`+z}!V&&!z.trim()&&(V=!0),C+=xe+`
`,e=e.substring(xe.length+1),R=ye.slice(W)}}a.loose||(p?a.loose=!0:this.rules.other.doubleBlankLine.test(C)&&(p=!0));let X=null,ue;this.options.gfm&&(X=this.rules.other.listIsTask.exec(A),X&&(ue=X[0]!=="[ ] ",A=A.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:C,task:!!X,checked:ue,loose:!1,text:A,tokens:[]}),a.raw+=C}const i=a.items.at(-1);if(i)i.raw=i.raw.trimEnd(),i.text=i.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let b=0;b<a.items.length;b++)if(this.lexer.state.top=!1,a.items[b].tokens=this.lexer.blockTokens(a.items[b].text,[]),!a.loose){const C=a.items[b].tokens.filter(R=>R.type==="space"),A=C.length>0&&C.some(R=>this.rules.other.anyLine.test(R.raw));a.loose=A}if(a.loose)for(let b=0;b<a.items.length;b++)a.items[b].loose=!0;return a}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:a}}}table(e){var p;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=Lk(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(p=t[3])!=null&&p.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],u={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(const i of r)this.rules.other.tableAlignRight.test(i)?u.align.push("right"):this.rules.other.tableAlignCenter.test(i)?u.align.push("center"):this.rules.other.tableAlignLeft.test(i)?u.align.push("left"):u.align.push(null);for(let i=0;i<n.length;i++)u.header.push({text:n[i],tokens:this.lexer.inline(n[i]),header:!0,align:u.align[i]});for(const i of a)u.rows.push(Lk(i,u.header.length).map((b,C)=>({text:b,tokens:this.lexer.inline(b),header:!1,align:u.align[C]})));return u}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const u=O1(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{const u=aae(t[2],"()");if(u===-2)return;if(u>-1){const i=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let r=t[2],a="";if(this.options.pedantic){const u=this.rules.other.pedanticHrefTitle.exec(r);u&&(r=u[1],a=u[3])}else a=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),Ok(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=t[r.toLowerCase()];if(!a){const u=n[0].charAt(0);return{type:"text",raw:u,text:u}}return Ok(n,a,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(r[1]||r[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const u=[...r[0]].length-1;let p,i,b=u,C=0;const A=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(A.lastIndex=0,t=t.slice(-1*e.length+u);(r=A.exec(t))!=null;){if(p=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!p)continue;if(i=[...p].length,r[3]||r[4]){b+=i;continue}else if((r[5]||r[6])&&u%3&&!((u+i)%3)){C+=i;continue}if(b-=i,b>0)continue;i=Math.min(i,i+b+C);const R=[...r[0]][0].length,z=e.slice(0,u+r.index+R+i);if(Math.min(u,i)%2){const W=z.slice(1,-1);return{type:"em",raw:z,text:W,tokens:this.lexer.inlineTokens(W)}}const V=z.slice(2,-2);return{type:"strong",raw:z,text:V,tokens:this.lexer.inlineTokens(V)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,r;return t[2]==="@"?(n=t[1],r="mailto:"+n):(n=t[1],r=n),{type:"link",raw:t[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let r,a;if(t[2]==="@")r=t[0],a="mailto:"+r;else{let u;do u=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(u!==t[0]);r=t[0],t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},Hm=class W2{constructor(t){bo(this,"tokens");bo(this,"options");bo(this,"state");bo(this,"tokenizer");bo(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||_v,this.options.tokenizer=this.options.tokenizer||new yE,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:Su,block:_S.normal,inline:L1.normal};this.options.pedantic?(n.block=_S.pedantic,n.inline=L1.pedantic):this.options.gfm&&(n.block=_S.gfm,this.options.breaks?n.inline=L1.breaks:n.inline=L1.gfm),this.tokenizer.rules=n}static get rules(){return{block:_S,inline:L1}}static lex(t,n){return new W2(n).lex(t)}static lexInline(t,n){return new W2(n).inlineTokens(t)}lex(t){t=t.replace(Su.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],r=!1){var a,u,p;for(this.options.pedantic&&(t=t.replace(Su.tabCharGlobal,"    ").replace(Su.spaceLine,""));t;){let i;if((u=(a=this.options.extensions)==null?void 0:a.block)!=null&&u.some(C=>(i=C.call({lexer:this},t,n))?(t=t.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);const C=n.at(-1);i.raw.length===1&&C!==void 0?C.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);const C=n.at(-1);(C==null?void 0:C.type)==="paragraph"||(C==null?void 0:C.type)==="text"?(C.raw+=`
`+i.raw,C.text+=`
`+i.text,this.inlineQueue.at(-1).src=C.text):n.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);const C=n.at(-1);(C==null?void 0:C.type)==="paragraph"||(C==null?void 0:C.type)==="text"?(C.raw+=`
`+i.raw,C.text+=`
`+i.raw,this.inlineQueue.at(-1).src=C.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),n.push(i);continue}let b=t;if((p=this.options.extensions)!=null&&p.startBlock){let C=1/0;const A=t.slice(1);let R;this.options.extensions.startBlock.forEach(z=>{R=z.call({lexer:this},A),typeof R=="number"&&R>=0&&(C=Math.min(C,R))}),C<1/0&&C>=0&&(b=t.substring(0,C+1))}if(this.state.top&&(i=this.tokenizer.paragraph(b))){const C=n.at(-1);r&&(C==null?void 0:C.type)==="paragraph"?(C.raw+=`
`+i.raw,C.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=C.text):n.push(i),r=b.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);const C=n.at(-1);(C==null?void 0:C.type)==="text"?(C.raw+=`
`+i.raw,C.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=C.text):n.push(i);continue}if(t){const C="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(C);break}else throw new Error(C)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){var i,b,C;let r=t,a=null;if(this.tokens.links){const A=Object.keys(this.tokens.links);if(A.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)A.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let u=!1,p="";for(;t;){u||(p=""),u=!1;let A;if((b=(i=this.options.extensions)==null?void 0:i.inline)!=null&&b.some(z=>(A=z.call({lexer:this},t,n))?(t=t.substring(A.raw.length),n.push(A),!0):!1))continue;if(A=this.tokenizer.escape(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.tag(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.link(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(A.raw.length);const z=n.at(-1);A.type==="text"&&(z==null?void 0:z.type)==="text"?(z.raw+=A.raw,z.text+=A.text):n.push(A);continue}if(A=this.tokenizer.emStrong(t,r,p)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.codespan(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.br(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.del(t)){t=t.substring(A.raw.length),n.push(A);continue}if(A=this.tokenizer.autolink(t)){t=t.substring(A.raw.length),n.push(A);continue}if(!this.state.inLink&&(A=this.tokenizer.url(t))){t=t.substring(A.raw.length),n.push(A);continue}let R=t;if((C=this.options.extensions)!=null&&C.startInline){let z=1/0;const V=t.slice(1);let W;this.options.extensions.startInline.forEach(X=>{W=X.call({lexer:this},V),typeof W=="number"&&W>=0&&(z=Math.min(z,W))}),z<1/0&&z>=0&&(R=t.substring(0,z+1))}if(A=this.tokenizer.inlineText(R)){t=t.substring(A.raw.length),A.raw.slice(-1)!=="_"&&(p=A.raw.slice(-1)),u=!0;const z=n.at(-1);(z==null?void 0:z.type)==="text"?(z.raw+=A.raw,z.text+=A.text):n.push(A);continue}if(t){const z="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(z);break}else throw new Error(z)}}return n}},vE=class{constructor(e){bo(this,"options");bo(this,"parser");this.options=e||_v}space(e){return""}code({text:e,lang:t,escaped:n}){var u;const r=(u=(t||"").match(Su.notSpaceStart))==null?void 0:u[0],a=e.replace(Su.endingNewline,"")+`
`;return r?'<pre><code class="language-'+mp(r)+'">'+(n?a:mp(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:mp(a,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let r="";for(let p=0;p<e.items.length;p++){const i=e.items[p];r+=this.listitem(i)}const a=t?"ol":"ul",u=t&&n!==1?' start="'+n+'"':"";return"<"+a+u+`>
`+r+"</"+a+`>
`}listitem(e){var n;let t="";if(e.task){const r=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+mp(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let a=0;a<e.header.length;a++)n+=this.tablecell(e.header[a]);t+=this.tablerow({text:n});let r="";for(let a=0;a<e.rows.length;a++){const u=e.rows[a];n="";for(let p=0;p<u.length;p++)n+=this.tablecell(u[p]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${mp(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const r=this.parser.parseInline(n),a=Rk(e);if(a===null)return r;e=a;let u='<a href="'+e+'"';return t&&(u+=' title="'+mp(t)+'"'),u+=">"+r+"</a>",u}image({href:e,title:t,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));const a=Rk(e);if(a===null)return mp(n);e=a;let u=`<img src="${e}" alt="${n}"`;return t&&(u+=` title="${mp(t)}"`),u+=">",u}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:mp(e.text)}},HP=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},Wm=class X2{constructor(t){bo(this,"options");bo(this,"renderer");bo(this,"textRenderer");this.options=t||_v,this.options.renderer=this.options.renderer||new vE,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new HP}static parse(t,n){return new X2(n).parse(t)}static parseInline(t,n){return new X2(n).parseInline(t)}parse(t,n=!0){var a,u;let r="";for(let p=0;p<t.length;p++){const i=t[p];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[i.type]){const C=i,A=this.options.extensions.renderers[C.type].call({parser:this},C);if(A!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(C.type)){r+=A||"";continue}}const b=i;switch(b.type){case"space":{r+=this.renderer.space(b);continue}case"hr":{r+=this.renderer.hr(b);continue}case"heading":{r+=this.renderer.heading(b);continue}case"code":{r+=this.renderer.code(b);continue}case"table":{r+=this.renderer.table(b);continue}case"blockquote":{r+=this.renderer.blockquote(b);continue}case"list":{r+=this.renderer.list(b);continue}case"html":{r+=this.renderer.html(b);continue}case"paragraph":{r+=this.renderer.paragraph(b);continue}case"text":{let C=b,A=this.renderer.text(C);for(;p+1<t.length&&t[p+1].type==="text";)C=t[++p],A+=`
`+this.renderer.text(C);n?r+=this.renderer.paragraph({type:"paragraph",raw:A,text:A,tokens:[{type:"text",raw:A,text:A,escaped:!0}]}):r+=A;continue}default:{const C='Token with "'+b.type+'" type was not found.';if(this.options.silent)return console.error(C),"";throw new Error(C)}}}return r}parseInline(t,n=this.renderer){var a,u;let r="";for(let p=0;p<t.length;p++){const i=t[p];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[i.type]){const C=this.options.extensions.renderers[i.type].call({parser:this},i);if(C!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=C||"";continue}}const b=i;switch(b.type){case"escape":{r+=n.text(b);break}case"html":{r+=n.html(b);break}case"link":{r+=n.link(b);break}case"image":{r+=n.image(b);break}case"strong":{r+=n.strong(b);break}case"em":{r+=n.em(b);break}case"codespan":{r+=n.codespan(b);break}case"br":{r+=n.br(b);break}case"del":{r+=n.del(b);break}case"text":{r+=n.text(b);break}default:{const C='Token with "'+b.type+'" type was not found.';if(this.options.silent)return console.error(C),"";throw new Error(C)}}}return r}},PI,OS=(PI=class{constructor(e){bo(this,"options");bo(this,"block");this.options=e||_v}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Hm.lex:Hm.lexInline}provideParser(){return this.block?Wm.parse:Wm.parseInline}},bo(PI,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),PI),uae=class{constructor(...e){bo(this,"defaults",zP());bo(this,"options",this.setOptions);bo(this,"parse",this.parseMarkdown(!0));bo(this,"parseInline",this.parseMarkdown(!1));bo(this,"Parser",Wm);bo(this,"Renderer",vE);bo(this,"TextRenderer",HP);bo(this,"Lexer",Hm);bo(this,"Tokenizer",yE);bo(this,"Hooks",OS);this.use(...e)}walkTokens(e,t){var r,a;let n=[];for(const u of e)switch(n=n.concat(t.call(this,u)),u.type){case"table":{const p=u;for(const i of p.header)n=n.concat(this.walkTokens(i.tokens,t));for(const i of p.rows)for(const b of i)n=n.concat(this.walkTokens(b.tokens,t));break}case"list":{const p=u;n=n.concat(this.walkTokens(p.items,t));break}default:{const p=u;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[p.type]?this.defaults.extensions.childTokens[p.type].forEach(i=>{const b=p[i].flat(1/0);n=n.concat(this.walkTokens(b,t))}):p.tokens&&(n=n.concat(this.walkTokens(p.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){const u=t.renderers[a.name];u?t.renderers[a.name]=function(...p){let i=a.renderer.apply(this,p);return i===!1&&(i=u.apply(this,p)),i}:t.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const u=t[a.level];u?u.unshift(a.tokenizer):t[a.level]=[a.tokenizer],a.start&&(a.level==="block"?t.startBlock?t.startBlock.push(a.start):t.startBlock=[a.start]:a.level==="inline"&&(t.startInline?t.startInline.push(a.start):t.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(t.childTokens[a.name]=a.childTokens)}),r.extensions=t),n.renderer){const a=this.defaults.renderer||new vE(this.defaults);for(const u in n.renderer){if(!(u in a))throw new Error(`renderer '${u}' does not exist`);if(["options","parser"].includes(u))continue;const p=u,i=n.renderer[p],b=a[p];a[p]=(...C)=>{let A=i.apply(a,C);return A===!1&&(A=b.apply(a,C)),A||""}}r.renderer=a}if(n.tokenizer){const a=this.defaults.tokenizer||new yE(this.defaults);for(const u in n.tokenizer){if(!(u in a))throw new Error(`tokenizer '${u}' does not exist`);if(["options","rules","lexer"].includes(u))continue;const p=u,i=n.tokenizer[p],b=a[p];a[p]=(...C)=>{let A=i.apply(a,C);return A===!1&&(A=b.apply(a,C)),A}}r.tokenizer=a}if(n.hooks){const a=this.defaults.hooks||new OS;for(const u in n.hooks){if(!(u in a))throw new Error(`hook '${u}' does not exist`);if(["options","block"].includes(u))continue;const p=u,i=n.hooks[p],b=a[p];OS.passThroughHooks.has(u)?a[p]=C=>{if(this.defaults.async)return Promise.resolve(i.call(a,C)).then(R=>b.call(a,R));const A=i.call(a,C);return b.call(a,A)}:a[p]=(...C)=>{let A=i.apply(a,C);return A===!1&&(A=b.apply(a,C)),A}}r.hooks=a}if(n.walkTokens){const a=this.defaults.walkTokens,u=n.walkTokens;r.walkTokens=function(p){let i=[];return i.push(u.call(this,p)),a&&(i=i.concat(a.call(this,p))),i}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Hm.lex(e,t??this.defaults)}parser(e,t){return Wm.parse(e,t??this.defaults)}parseMarkdown(e){return(n,r)=>{const a={...r},u={...this.defaults,...a},p=this.onError(!!u.silent,!!u.async);if(this.defaults.async===!0&&a.async===!1)return p(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return p(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return p(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));u.hooks&&(u.hooks.options=u,u.hooks.block=e);const i=u.hooks?u.hooks.provideLexer():e?Hm.lex:Hm.lexInline,b=u.hooks?u.hooks.provideParser():e?Wm.parse:Wm.parseInline;if(u.async)return Promise.resolve(u.hooks?u.hooks.preprocess(n):n).then(C=>i(C,u)).then(C=>u.hooks?u.hooks.processAllTokens(C):C).then(C=>u.walkTokens?Promise.all(this.walkTokens(C,u.walkTokens)).then(()=>C):C).then(C=>b(C,u)).then(C=>u.hooks?u.hooks.postprocess(C):C).catch(p);try{u.hooks&&(n=u.hooks.preprocess(n));let C=i(n,u);u.hooks&&(C=u.hooks.processAllTokens(C)),u.walkTokens&&this.walkTokens(C,u.walkTokens);let A=b(C,u);return u.hooks&&(A=u.hooks.postprocess(A)),A}catch(C){return p(C)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const r="<p>An error occurred:</p><pre>"+mp(n.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(n);throw n}}},sv=new uae;function co(e,t){return sv.parse(e,t)}co.options=co.setOptions=function(e){return sv.setOptions(e),co.defaults=sv.defaults,KV(co.defaults),co};co.getDefaults=zP;co.defaults=_v;co.use=function(...e){return sv.use(...e),co.defaults=sv.defaults,KV(co.defaults),co};co.walkTokens=function(e,t){return sv.walkTokens(e,t)};co.parseInline=sv.parseInline;co.Parser=Wm;co.parser=Wm.parse;co.Renderer=vE;co.TextRenderer=HP;co.Lexer=Hm;co.lexer=Hm.lex;co.Tokenizer=yE;co.Hooks=OS;co.parse=co;co.options;co.setOptions;co.use;co.walkTokens;co.parseInline;Wm.parse;Hm.lex;function cae(){const e=qh(z=>z.map),{phase:t,nextPhase:n,prevPhase:r,reset:a}=MP(),[u,p]=Y.useState(!1),i={onPointerDown:z=>{z.preventDefault(),z.stopPropagation()},onClick:z=>{z.preventDefault(),z.stopPropagation()}},b=u?G.jsx(b8,{style:{width:"60%",height:"60%"}}):G.jsx(B_,{style:{width:"60%",height:"60%"}}),C=z=>{z&&t<0&&a(),p(z)},A=t>=0?(t+1)/jm.length*100:0,R=t>=jm.length-1;return G.jsxs("div",{className:"fixed top-1/2 right-6 -translate-y-1/2 z-50 flex flex-col items-center gap-4",children:[u&&G.jsx(Vh,{label:"Reset tutorial",side:"top",children:G.jsx(Qr,{...i,variant:"secondary",size:"icon",className:"rounded-2xl w-10 h-10 hover:bg-red-50 hover:border-red-200 transition-colors",onClick:z=>{z.preventDefault(),z.stopPropagation(),a()},disabled:!e,children:G.jsx(Uk,{style:{width:"60%",height:"60%"},className:"text-red-600"})})}),G.jsx(Vh,{label:t<=0?"Start tutorial":"Continue tutorial",side:"left",children:G.jsxs(Kh,{open:u,onOpenChange:C,children:[G.jsx(Jh,{asChild:!0,children:G.jsx(Qr,{variant:"secondary",size:"icon",className:`rounded-3xl w-20 h-20 shadow-lg transition-all duration-300 hover:scale-105 ${R?"bg-green-100 hover:bg-green-200 border-2 border-green-300":""} ${e?"":"opacity-40 cursor-not-allowed"}`,disabled:!e,children:R?G.jsx(DT,{style:{width:"60%",height:"60%"}}):b})}),G.jsxs(Wc,{side:"left",sideOffset:12,className:"w-80 rounded-2xl bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[G.jsx(_4,{className:"fill-white/95"}),t>=0&&G.jsxs("div",{className:"space-y-4",children:[G.jsxs("div",{className:"space-y-3",children:[G.jsxs("div",{className:"flex items-center justify-between",children:[G.jsxs(vse,{variant:R?"default":"secondary",className:`px-3 py-1 text-xs font-medium ${R?"bg-green-100 text-green-800":""}`,children:["Step ",t+1," of ",jm.length]}),R&&G.jsx(DT,{className:"w-5 h-5 text-green-600"})]}),G.jsx(YV,{value:A,className:"h-2 bg-gray-100"})]}),G.jsx("h3",{className:"text-lg font-bold text-gray-900 leading-tight",children:jm[t].title}),jm[t].image&&G.jsx("div",{className:"relative overflow-hidden rounded-lg border border-gray-200",children:G.jsx("img",{src:jm[t].image,alt:jm[t].imageAlt,className:"w-full h-32 object-cover"})}),G.jsx("div",{className:"text-sm text-gray-700 leading-relaxed prose max-w-none",dangerouslySetInnerHTML:{__html:co.parse(jm[t].body)}})]})]})]})}),u&&G.jsxs("div",{className:"flex gap-2",children:[G.jsx(Vh,{label:"Previous step",side:"bottom",children:G.jsx(Qr,{...i,variant:"secondary",size:"icon",className:"rounded-2xl w-10 h-10",onClick:z=>{z.preventDefault(),z.stopPropagation(),r()},disabled:t<=0||!e,children:G.jsx(f8,{style:{width:"60%",height:"60%"}})})}),G.jsx(Vh,{label:"Next step",side:"bottom",children:G.jsx(Qr,{...i,variant:"secondary",size:"icon",className:`rounded-2xl w-10 h-10 ${R?"bg-green-100 hover:bg-green-200 border border-green-300":""}`,onClick:z=>{z.preventDefault(),z.stopPropagation(),R?p(!1):n()},disabled:!e,children:R?G.jsx(DT,{style:{width:"60%",height:"60%"},className:"text-green-600"}):G.jsx(m8,{style:{width:"60%",height:"60%"}})})})]})]})}function hae(){const{phase:e}=MP(),t=aoe[e],[n,r]=Y.useState(!1);return Y.useEffect(()=>{if(r(!1),!t)return;const a=setTimeout(()=>r(!0),1e3);return()=>clearTimeout(a)},[e,t]),Y.useEffect(()=>{if(!n||!t)return;const a=document.querySelector(t.target);if(!a)return;const u=()=>r(!1);return a.addEventListener("click",u,{once:!0}),()=>a.removeEventListener("click",u)},[n,t]),Y.useEffect(()=>{n||(document.body.style.position="",document.body.style.overflow="")},[n]),!n||!t?null:G.jsx(xj,{run:!0,steps:[{target:t.target,content:t.content,disableBeacon:!0,disableOverlay:!0,spotlightClicks:!0,placement:t.placement??"left"}],continuous:!1,showSkipButton:!1,disableScrollParentFix:!0,disableScrolling:!1,scrollToFirstStep:!1,styles:{options:{primaryColor:"#4182C4",zIndex:1200},tooltip:{borderRadius:"0.5rem",width:300,fontSize:16,height:"auto",pointerEvents:"auto"},tooltipContent:{padding:"12px"},buttonNext:{backgroundColor:"#4182C4",fontSize:14,padding:"8px 16px"},buttonBack:{color:"grey",fontSize:14,padding:"8px 16px"},buttonClose:{padding:"8px",color:"red"}}})}function dae(){return G.jsx("div",{className:"fixed inset-0 w-screen h-screen",children:G.jsxs(kF,{children:[G.jsx(boe,{}),G.jsx(lY,{richColors:!0,position:"top-center"}),G.jsx(FF,{className:"relative z-50 hover:bg-white/90"}),G.jsx(pse,{}),G.jsx(hae,{}),G.jsx(cae,{}),G.jsx(_se,{})]})})}r8.createRoot(document.getElementById("root")).render(G.jsx(Y.StrictMode,{children:G.jsx(dae,{})}));
